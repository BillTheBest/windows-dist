//>>built
require({cache:{"xide/types":function(){define(["dcl/dcl"],function(k){return k(null,{declaredClass:"xide/types"})})},"dcl/dcl":function(){(function(k){"undefined"!=typeof define?define(["./mini"],k):"undefined"!=typeof module?module.exports=k(require("./mini")):dcl=k(dcl)})(function(k){function p(){}function m(c,b,a){var f=c||p,n=b||p,q=a||p,d=function(){var a,b;f.apply(this,arguments);try{a=q.apply(this,arguments)}catch(h){a=h,b=!0}n.call(this,arguments,a);if(b)throw a;return a};d.advices={before:c,
after:b,around:a};return d}function g(c){return function(b,a){var f=b._meta,n;f&&((n=+f.weaver[a]||0)&&n!=c&&k._error("set chaining",a,b,c,n),f.weaver[a]=c)}}var c=k(k.Super,{constructor:function(){this.before=this.around.before;this.after=this.around.after;this.around=this.around.around}});k.mix(k,{Advice:c,advise:function(e){return k._makeSuper(e,c)},before:function(c){return k.advise({before:c})},after:function(c){return k.advise({after:c})},around:k.superCall,chainBefore:g(1),chainAfter:g(2),
isInstanceOf:function(c,b){if(c instanceof b)return!0;var a=c.constructor._meta,f;if(a)for(a=a.bases,f=a.length-1;0<=f;--f)if(a[f]===b)return!0;return!1},_stub:function(c,b,a,f){f=f[a]=k._extractChain(b,a,"around");var n=k._extractChain(b,a,"before").reverse();b=k._extractChain(b,a,"after");f=c?k._stubChainSuper(f,1==c?function(a){return k._stubChain(a.reverse())}:k._stubChain,a):k._stubSuper(f,a);return n.length||b.length?m(k._stubChain(n),k._stubChain(b),f):f||function(){}}});return k})},"dcl/mini":function(){(function(k){"undefined"!=
typeof define?define([],k):"undefined"!=typeof module?module.exports=k():dcl=k()})(function(){function k(a,f){var n=[0],c,d,l,r,h,t,e,u,v=0,p;if(a)if(a instanceof Array){h={};e=a.slice(0).reverse();for(u=e.length-1;0<=u;--u)if(d=e[u],d._uniqueId=d._uniqueId||g++,c=d._meta){t=c.bases;for(v=t.length-1;0<v;--v)p=t[v]._uniqueId,h[p]=(h[p]||0)+1;e[u]=t.slice(0)}else e[u]=[d];c={};a:for(;e.length;){for(u=0;u<e.length;++u)if(t=e[u],d=t[0],p=d._uniqueId,!h[p]){c[p]||(n.push(d),c[p]=1);t.shift();t.length?
--h[t[0]._uniqueId]:e.splice(u,1);continue a}k._error("cycle",f,e)}a=a[0];v=n.length-((r=a._meta)&&a===n[n.length-(v=r.bases.length)]?v:1)-1}else a._uniqueId=a._uniqueId||g++,n=n.concat((r=a._meta)?r.bases:a);c=a?k.delegate(a.prototype):{};for(t=a&&(r=a._meta)?k.delegate(r.weaver):{constructor:2};0<v;--v)if(d=n[v],r=d._meta,k.mix(c,r&&r.ownProps||d.prototype),r)for(p in e=r.weaver)t[p]=(+t[p]||0)|e[p];for(p in f)m(r=f[p])?t[p]=+t[p]||0:c[p]=r;r={bases:n,ownProps:f,weaver:t,chains:{}};n[0]={_meta:r,
prototype:c};d=c;h=r.weaver;t=r.bases;e=r.chains;for(l in h)d[l]=k._stub(h[l],t,l,e);l=c.constructor;l._meta=r;l.prototype=c;n[0]=l;n=k._postprocess(l);f.declaredClass&&!b[f.declaredClass]&&(b[f.declaredClass]=n);return n}function p(a){this.around=a}function m(a){return a&&a.spr instanceof p}var g=0,c={},e,b={};(e=function(a,b){for(var n in b)a[n]=b[n]})(k,{mix:e,delegate:function(a){return Object.create(a)},allKeys:function(a){var b=[],n;for(n in a)b.push(n);return b},Super:p,superCall:function(a){return k._makeSuper(a)},
_makeSuper:function(a,b){var n=function(){};n.spr=new (b||p)(a);return n},_postprocess:function(a){return a},_error:function(a){throw Error("dcl: "+a);},_instantiate:function(a,b,n){b=a.spr.around(b);b.ctr=a.ctr;return b},_extractChain:function(a,b,n){for(var q=a.length-1,d=[],l,r,h="around"==n;l=a[q];--q)if((r=l._meta)?(r=r.ownProps).hasOwnProperty(b)&&(m(r=r[b])?h?r.spr.around:r=r.spr[n]:h):h&&(r="constructor"==b?l:l.prototype[b])&&r!==c[b])"function"==typeof r?(r.ctr=l,d.push(r)):k._error("wrong super",
l,b);return d},_stubChain:function(a){var b=a.length,n;return b?1==b?(n=a[0],function(){n.apply(this,arguments)}):function(){for(var n=0;n<b;++n)a[n].apply(this,arguments)}:0},_stubSuper:function(a,b){for(var n=0,q,d=c[b];q=a[n];++n)d=m(q)?a[n]=k._instantiate(q,d,b):q;return"constructor"!=b?d:function(){d.apply(this,arguments)}},_stubChainSuper:function(a,b,n){for(var c=0,d,l,r=0;d=a[c];++c)m(d)&&(l=c-r,a[c]=k._instantiate(d,l?1==l?a[r]:b(a.slice(r,c)):0,n),r=c);return(l=c-r)?1==l&&"constructor"!=
n?a[r]:b(r?a.slice(r):a):0},_stub:function(a,b,n,c){b=c[n]=k._extractChain(b,n,"around");return(a?k._stubChainSuper(b,k._stubChain,n):k._stubSuper(b,n))||function(){}}});k.getObject=function(a){return b[a]};return k})},"xide/types/Types":function(){define(["dojo/_base/lang","xide/types","dojo/_base/json","dojo/_base/kernel"],function(k,p,m,g){null==p.customTypes&&(p.customTypes={});null==p.customEnumerations&&(p.customEnumerations={});null==p.widgetMappings&&(p.widgetMappings={});null==p.customMimeIcons&&
(p.customMimeIcons={});p.resolveType=function(c){return p.customTypes[c]?p.customTypes[c]:null};p.registerType=function(c,e){p.customTypes[c]=e};p.registerWidgetMapping=function(c,e){p.widgetMappings[c]=e};p.registerEnumeration=function(c,e){p.customEnumerations[c]=e};p.resolveEnumeration=function(c){return p.customEnumerations[c]?p.customEnumerations[c]:null};p.resolveWidgetMapping=function(c){return p.widgetMappings[c]?p.widgetMappings[c]:null};p.GRID_FEATURE={KEYBOARD_NAVIGATION:"KEYBOARD_NAVIGATION",
KEYBOARD_SELECT:"KEYBOARD_SELECT",SELECTION:"SELECTION",ACTIONS:"ACTIONS",CONTEXT_MENU:"CONTEXT_MENU"};p.VIEW_FEATURE={KEYBOARD_NAVIGATION:"KEYBOARD_NAVIGATION",KEYBOARD_SELECT:"KEYBOARD_SELECT",SELECTION:"SELECTION",ACTIONS:"ACTIONS",CONTEXT_MENU:"CONTEXT_MENU"};p.KEYBOARD_PROFILE={DEFAULT:{prevent_default:!0,prevent_repeat:!1},PASS_THROUGH:{prevent_default:!1,prevent_repeat:!1},SEQUENCE:{prevent_default:!0,is_sequence:!0,prevent_repeat:!0}};p.CI_STATE={NONE:0,PENDING:1,PROCESSING:2,FAILED:4,SUCCESSED:8,
PROCESSED:16,DEQUEUED:32,SOLVED:64,END:128};p.CIFLAG={NONE:0,BASE_64:1,USE_FUNCTION:2,REPLACE_VARIABLES:4,REPLACE_VARIABLES_EVALUATED:8,ESCAPE:16,REPLACE_BLOCK_CALLS:32,REMOVE_DELIMTTERS:64,ESCAPE_SPECIAL_CHARS:128,USE_REGEX:256,USE_FILTREX:512,CASCADE:1024,EXPRESSION:2048,DONT_PARSE:4096,TO_HEX:8192,REPLACE_HEX:16384,WAIT:32768,DONT_ESCAPE:65536,END:131072};p.CI_CORDER={};p.ECIType={BOOL:0,BOX:1,COLOUR:2,ENUMERATION:3,FILE:4,FLAGS:5,FLOAT:6,INTEGER:7,MATRIX:8,OBJECT:9,REFERENCE:10,QUATERNION:11,
RECTANGLE:12,STRING:13,VECTOR:14,VECTOR2D:15,VECTOR4D:16,ICON:17,IMAGE:18,BANNER:19,LOGO:20,STRUCTURE:21,BANNER2:22,ICON_SET:23,SCRIPT:24,EXPRESSION:25,RICHTEXT:26,ARGUMENT:27,JSON_DATA:28,EXPRESSION_EDITOR:29,WIDGET_REFERENCE:30,DOM_PROPERTIES:31,BLOCK_REFERENCE:32,BLOCK_SETTINGS:33,FILE_EDITOR:34,END:35,UNKNOWN:-1};p.ITEM_TYPE={FILE:"BTFILE",WIDGET:"WIDGET",BLOCK:"BLOCK",TEXT:"TEXT",EXPRESSION:"EXPRESSION"};p.EXPRESSION_PARSER||(p.EXPRESSION_PARSER={});p.COMPONENT_NAMES={XIDEVE:"xideve",XNODE:"xnode",
XBLOX:"xblox",XFILE:"xfile",XACE:"xace",XEXPRESSION:"xexpression",XCONSOLE:"xconsole"};p.WIDGET_REFERENCE_MODE={BY_ID:"byid",BY_CLASS:"byclass",BY_CSS:"bycss",BY_EXPRESSION:"expression"};p.VIEW_SPLIT_MODE={DESIGN:1,SOURCE:2,SPLIT_VERTICAL:6,SPLIT_HORIZONTAL:7};p.RESOURCE_VARIABLES={ACE:"ACE",APP_URL:"APP_URL",SITE_URL:"SITE_URL"};p.EVENTS={ERROR:"onError",STATUS:"onStatus",ON_CREATED_MANAGER:"onCreatedManager",ON_ITEM_SELECTED:"onItemSelected",ON_ITEM_REMOVED:"onItemRemoved",ON_ITEM_CLOSED:"onItemClosed",
ON_ITEM_ADDED:"onItemAdded",ON_ITEM_MODIFIED:"onItemModified",ON_NODE_SERVICE_STORE_READY:"onNodeServiceStoreReady",ON_FILE_STORE_READY:"onFileStoreReady",ON_CONTEXT_MENU_OPEN:"onContextMenuOpen",ON_CI_UPDATE:"onCIUpdate",ON_WIDGET_READY:"onWidgetReady",ON_CREATED_WIDGET:"onWidgetCreated",RESIZE:"onResize",ON_MODULE_RELOADED:"onModuleReloaded",ON_MODULE_UPDATED:"onModuleUpdated",ON_DID_OPEN_ITEM:"onDidOpenItem",ON_DID_RENDER_COLLECTION:"onDidRenderCollection",ON_PLUGIN_LOADED:"onPluginLoaded",ON_PLUGIN_READY:"onPluginReady",
ALL_PLUGINS_READY:"onAllPluginsReady",ON_CREATE_EDITOR_BEGIN:"onCreateEditorBegin",ON_CREATE_EDITOR_END:"onCreateEditorEnd",REGISTER_EDITOR:"registerEditor",ON_EXPRESSION_EDITOR_ADD_FUNCTIONS:"onExpressionEditorAddFunctions",ON_ACE_READY:"onACEReady",ON_UNSAVED_CONTENT:"onUnSavedContent",ON_FILE_CHANGED:"fileChanged",ON_FILE_DELETED:"fileDeleted",IMAGE_LOADED:"imageLoaded",IMAGE_ERROR:"imageError",UPLOAD_BEGIN:"uploadBegin",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_FINISH:"uploadFinish",UPLOAD_FAILED:"uploadFailed",
ON_FILE_CONTENT_CHANGED:"onFileContentChanged",ON_COPY_BEGIN:"onCopyBegin",ON_COPY_END:"onCopyEnd",ON_DELETE_BEGIN:"onDeleteBegin",ON_DELETE_END:"onDeleteEnd",ON_MOVE_BEGIN:"onMoveBegin",ON_MOVE_END:"onMoveEnd",ON_CHANGED_CONTENT:"onChangedContent",ON_COMPRESS_BEGIN:"onCompressBegin",ON_COMPRESS_END:"onCompressEnd",ON_COMPONENT_READY:"onComponentReady",ON_ALL_COMPONENTS_LOADED:"onAllComponentsLoaded",ON_APP_READY:"onAppReady",ON_CREATE_STORE:"onCreateStore",ON_STORE_CREATED:"onStoreCreated",ON_STORE_CHANGED:"onStoreChanged",
ON_STATUS_MESSAGE:"onStatusMessage",SAVE_LAYOUT:"layoutSave",RESTORE_LAYOUT:"layoutRestore",ON_SHOW_PANEL:"onShowPanel",ON_PANEL_CLOSED:"onPanelClosed",ON_PANEL_CREATED:"onPanelCreated",ON_MAIN_VIEW_READY:"onMainViewReady",ON_MAIN_MENU_READY:"onMainMenuReady",ON_MAIN_MENU_OPEN:"onMainMenuOpen",ON_VIEW_REMOVED:"onViewRemoved",ON_VIEW_SHOW:"onViewShow",ON_VIEW_HIDE:"onViewHide",ON_VIEW_ADDED:"onViewAdded",ON_OPEN_VIEW:"onOpenView",ON_VIEW_MAXIMIZE_START:"onViewMaximizeStart",ON_VIEW_MAXIMIZE_END:"onViewMaximizeEnd",
ON_CONTAINER_ADDED:"onContainerAdded",ON_CONTAINER_REMOVED:"onContainerRemoved",ON_REMOVE_CONTAINER:"onRemoveContainer",ON_CONTAINER_REPLACED:"onContainerReplaced",ON_CONTAINER_SPLIT:"onContainerSplit"};p.DIALOG_SIZE={SIZE_NORMAL:"size-normal",SIZE_SMALL:"size-small",SIZE_WIDE:"size-wide",SIZE_LARGE:"size-large"};p.DIALOG_TYPE={DEFAULT:"type-default",INFO:"type-info",PRIMARY:"type-primary",SUCCESS:"type-success",WARNING:"type-warning",DANGER:"type-danger"};k.mixin(p,{LAYOUT_RIGHT_CENTER_BOTTOM:"LAYOUT_RIGHT_CENTER_BOTTOM",
LAYOUT_CENTER_BOTTOM:"LAYOUT_CENTER_BOTTOM",LAYOUT_CENTER_RIGHT:"LAYOUT_CENTER_RIGHT",LAYOUT_LEFT_CENTER_RIGHT:"LAYOUT_LEFT_CENTER_RIGHT",LAYOUT_LEFT_CENTER_RIGHT_BOTTOM:"LAYOUT_LEFT_CENTER_RIGHT_BOTTOM"});g.fromJson=function(c,e){var b=null,a=!1;try{b=eval("("+c+")")}catch(f){a=!0}if(a){a=c.substring(c.indexOf("{"),c.lastIndexOf("}")+1);try{a&&(b=eval("("+a+")"))}catch(n){!1!==e&&console.error("error in json parsing! "+c);if(-1!==c.indexOf("error"))return{jsonrpc:"2.0",result:{error:{code:1,message:c,
data:null}},id:0};throw Error(c);}}return b};return p})},"xide/utils/ObjectUtils":function(){define(["xide/utils","require","dojo/Deferred","xide/lodash"],function(k,p,m,g){function c(a){var b=parseInt(a,10);return b.toString()===a?b:a}function e(a,b,d,l){g.isNumber(b)&&(b=[b]);if(g.isEmpty(b))return a;if(g.isString(b))return e(a,b.split(".").map(c),d,l);var r=b[0];if(1===b.length)return b=a[r],void 0!==b&&l||(a[r]=d),b;void 0===a[r]&&(g.isNumber(b[1])?a[r]=[]:a[r]={});return e(a[r],b.slice(1),d,
l)}function b(a,f){g.isNumber(f)&&(f=[f]);if(!g.isEmpty(a)){if(g.isEmpty(f))return a;if(g.isString(f))return b(a,f.split("."));var d=c(f[0]),l=a[d];if(1===f.length)void 0!==l&&(g.isArray(a)?a.splice(d,1):delete a[d]);else if(void 0!==a[d])return b(a[d],f.slice(1));return a}}"use strict";k.debounce=function(a,b,d,l,r,h,t){var f=a[b+"_debounced"];f||(f=a[b+"_debounced"]=g.debounce(d,l,r));!0!==h||a[b+"_debouncedFirst"]||(a[b+"_debouncedFirst"]=!0,d.apply(a,t));return f()};k.pluck=function(a,b){return g.map(a,
b)};k.download=function(a,b){var d=document.createElement("a");b=g.isString(b)?b:JSON.stringify(b,null,2);d.setAttribute("href","data:text/plain;charset\x3dutf-8,"+encodeURIComponent(b));d.setAttribute("download",a);d.style.display="none";document.body.appendChild(d);d.click();document.body.removeChild(d)};k.hasObject=function(a){var b=null;try{b=p(a)}catch(d){console.error("error in utils.hasObject ",d)}return b};k.getObject=function(a,b){var d=null;if(k.isString(a)){try{d=p(a)}catch(l){}try{if(!d){var r=
new m,d=p([a],function(a){r.resolve(a)});return r.promise}}catch(h){}return d}return k.isObject(a)?a:null!==d?d:b};k.toArray=function(a){var b=[],d;for(d in a)b.push({name:d,value:a[d]});return b};k.toObject=function(a,b){if(!a)return{};if(!1!==b)return b.object(b.map(a,b.values));if(k.isObject(a)&&a[0])return a[0];for(var d={},l=0;l<a.length;++l)d[l]=a[l];return d};k.byString=function(a,b,d){b=b.replace(/\[(\w+)\]/g,".$1");b=b.replace(/^\./,"");for(b=b.split(".");b.length;)if(d=b.shift(),d in a)a=
a[d];else return;return a};var a=Object.prototype.hasOwnProperty,f={has:function(b,f){if(g.isEmpty(b))return!1;g.isNumber(f)?f=[f]:g.isString(f)&&(f=f.split("."));if(g.isEmpty(f)||0===f.length)return!1;for(var d=0;d<f.length;d++){var l=f[d];if((g.isObject(b)||g.isArray(b))&&a.call(b,l))b=b[l];else return!1}return!0},ensureExists:function(a,b,d){return e(a,b,d,!0)},set:function(a,b,d,l){return e(a,b,d,l)},insert:function(a,b,d,l){var r=f.get(a,b);l=~~l;g.isArray(r)||(r=[],f.set(a,b,r));r.splice(l,
0,d)},empty:function(b,c){if(g.isEmpty(c))return b;if(!g.isEmpty(b)){var d,l;if(!(d=f.get(b,c)))return b;if(g.isString(d))return f.set(b,c,"");if(g.isBoolean(d))return f.set(b,c,!1);if(g.isNumber(d))return f.set(b,c,0);if(g.isArray(d))d.length=0;else if(g.isObject(d))for(l in d)a.call(d,l)&&delete d[l];else return f.set(b,c,null)}},push:function(a,b){var d=f.get(a,b);g.isArray(d)||(d=[],f.set(a,b,d));d.push.apply(d,Array.prototype.slice.call(arguments,2))},coalesce:function(a,b,d){for(var l,r=0,h=
b.length;r<h;r++)if(void 0!==(l=f.get(a,b[r])))return l;return d},get:function(a,b,d){g.isNumber(b)&&(b=[b]);if(g.isEmpty(b))return a;if(g.isEmpty(a)&&a&&null===a.innerHTML)return d;if(g.isString(b))return f.get(a,b.split("."),d);var l=c(b[0]);if(1===b.length){if(a&&void 0===a[l])return d;if(a)return a[l]}return a?f.get(a[l],b.slice(1),d):d},del:function(a,f){return b(a,f)}};k.getAt=function(a,b,d){return f.get(a,b,d)};k.setAt=function(a,b,d){return f.set(a,b,d)};k.hasAt=function(a,b){return f.has(a,
b)};k.ensureAt=function(a,b,d){return f.ensureExists(a,b,d)};k.deleteAt=function(a,b){return f.del(a,b)};k.merge=function(a,b){for(var d in b)"object"!=typeof a[d]?a[d]=b[d]:"object"==typeof b[d]&&(a[d]=k.merge(a[d],b[d]));return a};k.clone=function(a){if(!a||"object"!=typeof a||k.isFunction(a))return a;if(a.nodeType&&"cloneNode"in a)return a.cloneNode(!0);if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return new RegExp(a);var b,d,l;if(k.isArray(a))for(b=[],d=0,l=a.length;d<
l;++d)d in a&&b.push(k.clone(a[d]));else b=a.constructor?new a.constructor:{};return k._mixin(b,a,k.clone)};k._mixin=function(a,b,d){var l,f,h={};for(l in b)f=b[l],l in a&&(a[l]===f||l in h&&h[l]===f)||(a[l]=d?d(f):f);return a};k.mixin=function(a,b){if(b){a||(a={});for(var d=arguments.length,l=1;l<d;l++)k._mixin(a,arguments[l])}return a};k.cloneKeys=function(a,b){var d={},l;for(l in a)if(!0!==b||l in a)d[l]=a[l];return d};k.isArray=function(a){return g.isArray(a)};k.isObject=function(a){return g.isObject(a)};
k.isString=function(a){return g.isString(a)};k.isNumber=function(a){return g.isNumber(a)};k.isFunction=function(a){return g.isFunction(a)};return k})},"xide/utils":function(){define(["dcl/dcl"],function(k){return k(null,{declaredClass:"xide.utils"})})},"xide/lodash":function(){define([],function(){if("undefined"!==typeof _)return _})},"xlog/Server":function(){define(["dcl/dcl","xide/types","xide/factory","dojo/node!winston"],function(k,p,m,g){return k(null,{declaredClass:"xlog.Server",fileLogger:null,
loggly:null,delegate:null,publishLog:!0,loggers:{},constructor:function(c){for(var e in arguments)arguments.hasOwnProperty(e)&&(this[e]=c[e])},createLogger:function(c){var e=new g.Logger({transports:[new g.transports.File(c)]});if(this.publishLog)e.on("logging",function(b,a,f,n){n.logId=c.filename;b={level:a,message:f,data:n,time:(new Date).getTime()};m.publish(p.EVENTS.ON_SERVER_LOG_MESSAGE,b)});return e},start:function(c){this.loggers={};this.options=c;if(c.fileLogger&&(this.fileLogger=g.add(g.transports.File,
c.fileLogger),this.publishLog))this.fileLogger.on("logging",function(c,b,a,f){c={level:b,message:a,data:f,time:(new Date).getTime()};m.publish(p.EVENTS.ON_SERVER_LOG_MESSAGE,c)});c.loggly&&(this.loggly=g.add(g.transports.Loggly,c.loggly));null===c.console&&g.remove(g.transports.Console)}})})},"xide/factory":function(){define([],function(){return{}})},"nxapp/types":function(){define(["dojo/_base/declare"],function(k){return k("nxapp.types",null,{})})},"nxapp/utils/FileUtils":function(){define("dojo/_base/json dojo/node!path dojo/node!fs dojo/node!util nxapp/utils xdojo/has!host-node?dojo/node!glob-fs xdojo/has!host-node?dojo/node!glob-base xdojo/has!host-node?dojo/node!glob".split(" "),
function(k,p,m,g,c,e,b,a){c.list=function(a){try{var c={},q=b(a);q.base&&(c.cwd=q.base,q.isGlob&&(a=q.glob));var d=(new e).readdirSync(a,c),l=[];_.each(d,function(a){l.push((c.cwd?c.cwd+p.sep:"")+a)})}catch(r){return null}return l};c.__toObject=function(a){try{var b=m.statSync(a,function(a){}),c=b.isDirectory();return{path:a,sizeBytes:b.size,size:c?"Folder":"",owner:b.uid,group:b.gid,mode:b.mode,isDir:c,directory:c,name:p.win32.basename(a),fileType:c?"folder":"file",modified:b.mtime.getTime()/1E3}}catch(d){return{path:a,
sizeBytes:0,size:0,owner:0,group:0,mode:0,directory:!1,mime:"unknown",name:p.win32.basename(a),fileType:"file",modified:0}}};c.ls=function(b){function n(a,h){return a?a=!d||h&&"/"!==h?b.join(h,a):""+a:""}var e={},d="win32"===process.platform;if("/*"===b&&d){var l=[];flop.read("/",function(a,b){_.each(b.files,function(a){l.push({path:"/"+a.name+":",sizeBytes:0,size:0,owner:0,group:0,mode:0,directory:!0,mime:"unknown",name:a.name,fileType:"folder",modified:0,drive:!0})})})}else{var r="";if(d)if(5===
b.length){var h=b.split(":/");2==h.length&&(r=h[0][1]+":/",e={root:r},b="/*")}else h=b.split(":/"),2==h.length&&(r=h[0][1]+":/",e={root:r},b=""+h[1]);e=a.sync(b,e);_.isArray(e)||(e=[e]);l=[];_.each(e,function(a){a=c.__toObject(a);d&&a&&a.path&&(a.path=p.resolve(n(a.path)));a.realPath=p.resolve(a.path);a&&l.push(a)});return l}};c.resolve=function(a){var b=p.resolve(a);try{if(m.statSync(b))return b}catch(c){return b}try{if(m.statSync(a))return a;var d=process.cwd()+p.sep+a;if(m.statSync(d))return d}catch(l){}return null};
c.isDirectory=function(a){return(a=c.resolve(a))&&(a=m.statSync(a))&&a.isDirectory()?!0:!1};c.getExtension=function(a){a=p.extname(a||"").split(".");return a[a.length-1]};c.readFile=function(a){var b=m.statSync(a).size,c=new Buffer(b);a=m.openSync(a,"r");if(!b)return"";m.readSync(a,c,0,b,0);m.closeSync(a);return c.toString()};c.writeFile=function(a,b){m.writeFile(a,b,function(a){a&&console.log(a)})};c.writeJSONFile=function(a,b){var c=JSON.stringify(b,null,4);m.writeFile(a,c,function(a){a&&console.log(a)})};
return c})},"nxapp/utils":function(){define(["dojo/_base/declare"],function(k){return k("nxapp.utils",null,{})})},"xdojo/has":function(){define(["dojo/has"],function(k){return k})},"nxapp/utils/TCPUtils":function(){define(["dojo/node!net","nxapp/utils","nxapp/server/WebSocket","nxapp/server/DeviceServer","nxapp/server/FileServer"],function(k,p,m,g,c){p.checkPort=function(c,b,a){var f=new k.Socket,n=null;f.on("connect",function(){n="open";f.end()});f.setTimeout(1500);f.on("timeout",function(){n="closed";
f.destroy()});f.on("error",function(a){n="closed"});f.on("close",function(f){a(null,n,b,c)});f.connect(c,b)};p.createSocketServer=function(c,b){var a=new m;a.init({options:{port:c.socket_server.port,context:b,host:c.socket_server.host}});a.ctx=b;a.start(null,c);return m};p.createDeviceServer=function(c,b){var a=new g;a.init({options:{port:c.socket_server.port,context:b,host:c.socket_server.host}});a.ctx=b;a.start(null,c);return a};p.createFileServer=function(e,b){var a=new c;a.init({options:{port:e.socket_server.port,
context:b,host:e.socket_server.host}});a.ctx=b;console.error("create file server "+e.socket_server.host);a.start(null,e);return m};p.connect=function(c,b){};return p})},"nxapp/server/WebSocket":function(){define("dcl/dcl dojo/_base/lang xide/types xide/factory nxapp/server/ServerBase nxapp/utils/_LogMixin nxapp/server/_CommandsParserMixin dojo/node!http dojo/node!sockjs dojo/node!colors xide/utils".split(" "),function(k,p,m,g,c,e,b,a,f,n,q){var d=!1;return k([c,e,b],{declaredClass:"nxapp.server.WebSocket",
_io_socket:null,clients:null,handleManagerCommand:function(a,b){switch(a.manager_command){case m.SOCKET_SERVER_COMMANDS.MANAGER_TEST:console.dir("Test Manager command");break;case m.SOCKET_SERVER_COMMANDS.WATCH:var h=this.ctx.getFileManager();h&&h.watch(a.path,a.watch);break;case m.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH:return this.sendMQTTMessage(a,b);case m.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER:return this.startDriver(a,b);case m.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES:return this.getVariables(a,
b);case m.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE:this.logClientMessage(a);break;case m.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER:this.stopDriver(a);break;case m.SOCKET_SERVER_COMMANDS.MANAGER_STATUS:a={message:"returning status",deviceConnections:this.options.context.getConnectionManager().getNumberOfConnections()};this.emit(m.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,JSON.stringify(a));break;case m.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL:this.options.context.getConnectionManager().closeAll()}},
handleDeviceCommand:function(a,b){var h=a.device_command,t=this.options.context,f=this;d=!1;this.showDebugMsg("socket_server")&&d&&console.log("Handle device command: "+h+" | "+m.SOCKET_SERVER_COMMANDS.CALL_METHOD);console.error("handle device command",a);var c=t.getConnectionManager().connect(a.host,a.protocol,a.port,null,null,b);b||d&&console.error("---have no client connect");try{t.getConnectionManager().registerFeedBack(c,function(b,h){f.profile.debug.debugDevices&&d&&console.log("Data received from "+
b.host);if(_.isString(h))a.lastResponse=""+h;else if(_.isObject(h))try{a.lastResponse=JSON.stringify(h)}catch(t){d&&console.error("error serializing data")}f.onDeviceMessage(b,h)})}catch(n){console.error("-register feed back function failed",n),console.trace()}try{switch(h){case m.SOCKET_SERVER_COMMANDS.CALL_METHOD:this.options.context.getConnectionManager().callMethod(c,a,b);break;case m.SOCKET_SERVER_COMMANDS.DEVICE_SEND:this.options.context.getConnectionManager().send(c,a.command,a.options)}}catch(e){console.error("error command parser "+
h,e)}},broadCastMessage:function(a,b){for(var h=this.clients.length;h--;)if(void 0!==this.clients[h]){var t={event:a,data:b};3===this.clients[h].readyState?(this.clients[h].close(),this.clients.remove(this.clients[h])):(d&&console.log(n.green("writing broadcast message "+t.event+" have "+this.clients.length+" clients  readystate : "+this.clients[h].readyState)),t=JSON.stringify(t),this.clients[h].write(t))}},onFileChanged:function(a){this.broadCastMessage(m.EVENTS.ON_FILE_CHANGED,{path:a.path,type:a.type})},
start:function(b,r){this.profile=r;this.options=p.mixin(this.options,b);this.clients=[];var h=this;console.error("######",r);var t=this.options.port,c=this.options.host;if(t){this.initLogger(r.debug);this.log("Socket server running in "+t,"socket_server");var n={};this.showDebugMsg("socket_server")||(n.log=function(){});var n=f.createServer(n),e=a.createServer(this._handler);n.installHandlers(e);e.listen(t,c);this._handleSocketEmits(n);g.publish(m.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:t,
socket_handler:n}},this);n.on("connection",function(a){var b=h.clients.push(a);a.on("close",function(){d&&console.error("close connection :  "+b);delete h.clients[b]})});return!0}console.error("Port must be provided into options");return!1},emit:function(a,b){console.log("emit + "+this.id+"#"+a,b);this.showDebugMsg("socket_server")&&!_.isString(b)&&_.isObject(b)&&(b=JSON.stringify(b));this.socket?this.socket.write(b):d&&console.error("-------- WebSocket::emit failed. Have no socket! "+a+" id "+this.id)},
_handleSocketEmits:function(a){var b=this.options.port,h=this;a.on("connection",function(a){h.socket=a;d&&console.log("client connected");g.publish(m.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:b,socket_handler:a}},this);a.on("data",function(b){p.isString(b)&&(b=dojo.fromJson(b));b.manager_command?h.handleManagerCommand(b,a):h.handleDeviceCommand(b,a)});a.on("close",function(){console.error("closed!")})})},constructor:function(){this.id=q.createUUID()}})})},"nxapp/server/ServerBase":function(){define(["dcl/dcl",
"xide/model/Base","xide/utils","xide/mixins/EventedMixin"],function(k,p,m,g){return k([p.dcl,g.dcl],{options:null,delegate:null,ctx:null,declaredClass:"nxapp.server.ServerBase",_defaultOptions:function(){return{delegate:this}},init:function(c){this.options=m.mixin(this._defaultOptions(),c.options)}})})},"xide/model/Base":function(){define(["dcl/dcl","dojo/_base/declare","xide/utils"],function(k,p,m){var g={declaredClass:"xide/model/Base",constructor:function(c){m.mixin(this,c)},getLabel:function(){return null},
getID:function(){return null}};p=p("xide/model/Base",null,g);p.dcl=k(null,g);return p})},"xide/mixins/EventedMixin":function(){define("dojo/_base/array dcl/dcl xdojo/declare xdojo/has xide/types xide/factory".split(" "),function(k,p,m,g,c,e){g={_didRegisterSubscribers:!1,subscribers:null,subscribes:{},emits:{},__events:null,addPublishFilter:function(b,a){b&&(null!=a?this.emits[b]=a:b in this.emits&&delete this.emits[b])},filterSubscribe:function(b){return this.subscribes?!1!==this.subscribes[b]:!0},
filterPublish:function(b){return this.emits?!1!==this.emits[b]:!0},subscribe:function(b,a,f){this.__events||(this.__events={});b=e.subscribe(b,a,f||this,this.filterSubscribe.bind(this));a=this.__events;f=0;for(var c=b.length;f<c;f++){var q=b[f].type;a[q]||(a[q]=[]);a[q].push(b[f])}return b},publish:function(b,a,f,c){var q=this;0<c?setTimeout(function(){e.publish(b,a,f||q,q.filterPublish.bind(q))}.bind(q),c):e.publish(b,a,f||q,q.filterPublish.bind(q))},_destroyHandle:function(b){},_destroyHandles:function(){if(this.__events){for(var b in this.__events)k.forEach(this.__events[b],
function(a){a&&a.remove&&a.remove()});delete this.__events}},destroy:function(){this._emit("destroy");this.inherited&&this.inherited(arguments);this._destroyHandles()},once:function(b,a){function f(){c.unsubscribe(b,a);return a.apply(c,arguments)}var c=this;f.listener=a;c._on(b,f);return this},_emit:function(b){if(this.__events){if(!this._didRegisterSubscribers&&this.subscribers){for(var a=0;a<this.subscribers.length;a++){var f=this.subscribers[a];this._on(f.event,f.handler,f.owner)}this._didRegisterSubscribers=
!0}if(!0===arguments[2])throw Error("Please use emit.sticky() instead of passing sticky\x3dtrue for event: "+b);a=this.__events[b];f=1<arguments.length?arguments[2]:null;if(a){var c;if("function"==typeof a)switch(arguments.length){case 1:return a.call(this);case 2:return a.call(this,arguments[1]);case 3:return a.call(this,arguments[1],arguments[2]);default:var e=Array.prototype.slice.call(arguments,1);c=a.apply(this,e)}else if(_.isArray(a))for(var e=Array.prototype.slice.call(arguments,1),d=a.slice(),
l,r=null,h=null,a=0,t=d.length;a<t;a++)r=d[a],h=r.owner||this,e&&e[0]&&(e[0].owner=e[0]?e[0].owner||h:null),r.handler&&(l=r.handler.apply(h,e)),void 0!==l&&(c=l);f&&!0===f["public"]&&this.publish(b,e);return c}}},unsubscribe:function(b,a){if(!this.__events||!this.__events[b])return this;if("function"!==typeof a||!a)return k.forEach(this.__events[b],dojo.unsubscribe),delete this.__events[b],this.__events[b]=[],this;var f=this.__events[b];if(_.isArray(f)){var c=[];_.each(f,function(b,d,l){(b.handler==
a?b.handler:b.handler.listener==a&&b.handler.listener)&&c.push(b)});_.each(c,function(a){a.remove()});0===f.length&&delete this.__events[b]}else(this.__events[b].listener||this.__events[b])===a&&delete this.__events[b];return this},listeners:function(b){this.__events||(this.__events={});this.__events[b]||(this.__events[b]=[]);isArray(this.__events[b])||(this.__events[b]=[this.__events[b]]);return this.__events[b]},addHandle:function(b,a){this.__events||(this.__events={});this.__events[b]||(this.__events[b]=
[]);a.type=b;this.__events[b].push(a);return a},__on:function(b,a,f,c){var e=c;"function"!=typeof f||c||(c=f,f=null);b=b.jquery?b:$(b);b.on(a,f,c);this.__events||(this.__events={});this.__events[a]||(this.__events[a]=[]);var d=this.__events[a];b={handler:e,owner:this,type:a,element:b,selector:f,remove:function(){d.remove(this);this.element.off(this.type,this.selector,this.handler)}};d.push(b);return b},_on:function(b,a,f){try{this.__events||(this.__events={});this.__events[b]||(this.__events[b]=[]);
var c=this.__events[b];if(!c)this.__events[b]=a;else if(_.isArray(c)){if(-1!=c.indexOf(a))return console.warn("adding same listener twice",b);a={handler:a,owner:f||this,type:b,remove:function(){c.remove(this);f&&f.__events&&f.__events[b]&&f.__events[b].remove(this);this.handler=this.owner=null;delete this.type}};c.push(a);return a}}catch(e){logError(e)}return this}};m=m(null,g);m.Impl=g;m.dcl=p(null,g);p.chainAfter(m.dcl,"destroy");return m})},"xdojo/declare":function(){define(["dojo/_base/declare"],
function(k){return k})},"nxapp/utils/_LogMixin":function(){define(["dcl/dcl"],function(k){return k(null,{declaredClass:"nxapp.utils._LogMixin",debug_conf:null,logger:null,initLogger:function(k){this.debug_conf=k},log:function(k,m,g,c){m||(m=this._debugContext().main);m&&!this.showDebugMsg(m)||!this.logger||(g=g||"info",c.time=(new Date).getTime(),this.logger.log(g,k,c))},logEx:function(k,m,g,c){this.logger?(m=m||"info",c=c||{},c.type=g||"Unknown",c.time=c.time||(new Date).getTime(),this.logger.log(m,
k,c)):console.error("have no logger!")},showDebugMsg:function(k){if(null!=this.debug_conf)return this.debug_conf.all?!0:this.debug_conf[k]?!0:!1;this.debug_conf={all:!0};return!0}})})},"nxapp/server/_CommandsParserMixin":function(){define(["dcl/dcl","nxapp/types/Types","nxapp/utils/_console"],function(k,p,m){var g=!1;return k(null,{declaredClass:"nxapp.server._CommandsParserMixin",handleManagerCommand:function(c,e){switch(c.manager_command){case p.SOCKET_SERVER_COMMANDS.MANAGER_TEST:console.dir("Test Manager command");
break;case p.SOCKET_SERVER_COMMANDS.WATCH:var b=this.ctx.getFileManager();b&&b.watch(c.path,c.watch);break;case p.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH:return this.sendMQTTMessage(c,e);case p.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER:return this.startDriver(c,e);case p.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES:return this.getVariables(c,e);case p.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE:this.logClientMessage(c);break;case p.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER:this.stopDriver(c);break;case p.SOCKET_SERVER_COMMANDS.MANAGER_STATUS:c=
{message:"returning status",deviceConnections:this.options.context.getConnectionManager().getNumberOfConnections()};this.emit(p.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,JSON.stringify(c));break;case p.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL:this.options.context.getConnectionManager().closeAll()}},handleDeviceCommand:function(c,e){var b=c.device_command,a=this.options.context,f=this;g=!1;this.showDebugMsg("socket_server")&&g&&console.log("Handle device command: "+b+" | "+p.SOCKET_SERVER_COMMANDS.CALL_METHOD);
console.error("handle device command",c);var n=a.getConnectionManager().connect(c.host,c.protocol,c.port,null,null,e);e||g&&console.error("---have no client connect");try{a.getConnectionManager().registerFeedBack(n,function(a,b){f.profile.debug.debugDevices&&g&&console.log("Data received from "+a.host);if(_.isString(b))c.lastResponse=""+b;else if(_.isObject(b))try{c.lastResponse=JSON.stringify(b)}catch(h){g&&console.error("error serializing data")}f.onDeviceMessage(a,b)})}catch(q){console.error("-register feed back function failed",
q),console.trace()}try{switch(b){case p.SOCKET_SERVER_COMMANDS.CALL_METHOD:this.options.context.getConnectionManager().callMethod(n,c,e);break;case p.SOCKET_SERVER_COMMANDS.DEVICE_SEND:this.options.context.getConnectionManager().send(n,c.command,c.options)}}catch(d){console.error("error command parser "+b,d)}}})})},"nxapp/types/Types":function(){define(["dojo/_base/lang","xide/types/Types","xcf/types/Types"],function(k,p){k.mixin(p.EVENTS,{ON_FILE_CHANGED:"fileChanged",ON_CONNECTION_CREATED:"connectionCreated",
ON_CONNECTION_ERROR:"connectionError",ON_WEBSOCKET_START:"webSocketStart",ON_WEBSOCKET_CONNECTION:"webSocketConnection",ON_MQTT_MESSAGE:"onMQTTMessage",ON_DEVICE_MESSAGE:"onDeviceMessage",ON_COMMAND_FINISH:"onCommandFinish",ON_COMMAND_ERROR:"onCommandError",ON_DEVICE_DISCONNECTED:"onDeviceDisconnected",ON_DEVICE_CONNECTED:"onDeviceConnected",STORE_CHANGED:"storeChange",BEFORE_STORE_CHANGE:"beforeStoreChange",STORE_REFRESHED:"storeRefreshed",ON_DID_OPEN_ITEM:"onDidOpenItem",ON_SHOW_PANEL:"onShowPanel",
ITEM_SELECTED:"itemSelected",ERROR:"fileOperationError",STATUS:"fileOperationStatus",IMAGE_LOADED:"imageLoaded",IMAGE_ERROR:"imageError",RESIZE:"resize",UPLOAD_BEGIN:"uploadBegin",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_FINISH:"uploadFinish",ON_CLIPBOARD_COPY:"onClipboardCopy",ON_CLIPBOARD_PASTE:"onClipboardPaste",ON_CLIPBOARD_CUT:"onClipboardCut",ON_CONTEXT_MENU_OPEN:"onContextMenuOpen",ON_PLUGIN_LOADED:"onPluginLoaded",ON_PLUGIN_READY:"onPluginReady",ON_MAIN_VIEW_READY:"onMainViewReady2",REGISTER_EDITOR:"registerEditor",
REGISTER_ACTION:"registerAction",ON_FILE_CONTENT_CHANGED:"onFileContentChanged",ON_PANEL_CLOSED:"onPanelClosed",ON_PANEL_CREATED:"onPanelCreated",SET_DEVICE_VARIABLES:"setDeviceVariables"});p.LOG_CONTEXT={DEVICE:"Device"};p.test=2;return p})},"xcf/types/Types":function(){define(["xaction/types","xide/types/Types","xide/types","xide/utils/ObjectUtils"],function(k,p,m,g){m.VARIABLE_FLAGS={PUBLISH:2,PUBLISH_IF_SERVER:4};m.LOGGING_FLAGS={NONE:0,GLOBAL_CONSOLE:1,STATUS_BAR:2,POPUP:4,FILE:8,DEV_CONSOLE:16,
DEVICE_CONSOLE:32};g.mixin(m.ITEM_TYPE,{DEVICE:"Device",DEVICE_GROUP:"Device Group",DRIVER:"Driver",DRIVER_GROUP:"Driver Group",PROTOCOL:"Protocol",PROTOCOL_GROUP:"Protocol Group"});m.SERVICE_STATUS={OFFLINE:"offline",ONLINE:"online",TIMEOUT:"timeout"};m.PROTOCOL={TCP:"tcp",UDP:"udp",SERIAL:"serial",DRIVER:"driver",SSH:"ssh",MQTT:"mqtt"};g.mixin(m.EVENTS,{ON_DEBUGGER_READY:"onDebuggerReady",ON_DEVICE_SELECTED:"onDeviceSelected",ON_DEVICE_GROUP_SELECTED:"onDeviceGroupSelected",ON_PROTOCOL_SELECTED:"onProtocolSelected",
ON_PROTOCOL_GROUP_SELECTED:"onProtocolGroupSelected",ON_PROTOCOL_CHANGED:"onProtocolChanged",ON_MQTT_MESSAGE:"onMQTTMessage",ON_DEVICE_MESSAGE:"onDeviceMessage",ON_DEVICE_MESSAGE_EXT:"onDeviceMessageExt",ON_COMMAND_FINISH:"onCommandFinish",ON_COMMAND_PROGRESS:"onCommandProgress",ON_COMMAND_PAUSED:"onCommandPaused",ON_COMMAND_STOPPED:"onCommandStopped",ON_COMMAND_ERROR:"onCommandError",ON_DEVICE_DISCONNECTED:"onDeviceDisconnected",ON_DEVICE_CONNECTED:"onDeviceConnected",ON_DEVICE_COMMAND:"onDeviceCommand",
ON_DEVICE_STATE_CHANGED:"onDeviceStateChanged",ON_DEVICE_DRIVER_INSTANCE_READY:"onDeviceDriveInstanceReady",ON_DRIVER_SELECTED:"onDriverSelected",ON_DRIVER_GROUP_SELECTED:"onDriverGroupSelected",ON_DRIVER_VARIABLE_ADDED:"onDriverVariableAdded",ON_DRIVER_VARIABLE_REMOVED:"onDriverVariableRemoved",ON_DRIVER_VARIABLE_CHANGED:"onDriverVariableChanged",ON_DRIVER_COMMAND_ADDED:"onDriverCommandAdded",ON_DRIVER_COMMAND_REMOVED:"onDriverCommandRemoved",ON_DRIVER_COMMAND_CHANGE:"onDriverVariableChanged",ON_SCOPE_CREATED:"onScopeCreated",
ON_DRIVER_MODIFIED:"onDriverModified",SET_DEVICE_VARIABLES:"setDeviceVariables",ON_SERVER_LOG_MESSAGE:"onServerLogMessage",ON_CLIENT_LOG_MESSAGE:"onClientLogMessage",ON_DEVICE_SERVER_CONNECTED:"onDeviceServerConnected",ON_RUN_CLASS_EVENT:"onRunClassEvent"});m.MESSAGE_SOURCE={DEVICE:"DEVICE",GUI:"GUI",BLOX:"BLOX",CODE:"CODE"};m.DEVICE_STATE={CONNECTING:"DeviceIsConnecting",CONNECTED:"DeviceIsConnected",SYNCHRONIZING:"DeviceIsSynchronizing",READY:"DeviceIsReady",DISCONNECTED:"DeviceIsDisconnected",
DISABLED:"DeviceIsDisabled",LOST_DEVICE_SERVER:"LostDeviceServerConnection"};m.DRIVER_PROPERTY={CF_DRIVER_NAME:"CF_DRIVER_NAME",CF_DRIVER_ICON:"CF_DRIVER_ICON",CF_DRIVER_CLASS:"CF_DRIVER_CLASS",CF_DRIVER_ID:"CF_DRIVER_ID",CF_DRIVER_COMMANDS:"CF_DRIVER_COMMANDS",CF_DRIVER_VARIABLES:"CF_DRIVER_VARIABLES",CF_DRIVER_RESPONSES:"CF_DRIVER_RESPONSES"};m.PROTOCOL_PROPERTY={CF_PROTOCOL_TITLE:"Title",CF_PROTOCOL_ICON:"CF_PROTOCOL_ICON",CF_PROTOCOL_CLASS:"CF_PROTOCOL_CLASS",CF_PROTOCOL_ID:"CF_PROTOCOL_ID",CF_PROTOCOL_COMMANDS:"CF_PROTOCOL_COMMANDS",
CF_PROTOCOL_VARIABLES:"CF_PROTOCOL_VARIABLES",CF_PROTOCOL_RESPONSES:"CF_PROTOCOL_RESPONSES"};m.DEVICE_PROPERTY={CF_DEVICE_DRIVER:"Driver",CF_DEVICE_HOST:"Host",CF_DEVICE_PORT:"Port",CF_DEVICE_PROTOCOL:"Protocol",CF_DEVICE_TITLE:"Title",CF_DEVICE_ID:"Id",CF_DEVICE_ENABLED:"Enabled",CF_DEVICE_OPTIONS:"Options",CF_DEVICE_DRIVER_OPTIONS:"DriverOptions",CF_DEVICE_LOGGING_FLAGS:"Logging Flags"};m.LOG_OUTPUT={DEVICE_CONNECTED:"Device Connected",DEVICE_DISCONNECTED:"Device Disonnected",RESPONSE:"Response",
SEND_COMMAND:"Send Command",DEVICE_ERROR:"Device Error"};m.DEFAULT_DEVICE_LOGGING_FLAGS={};k=m.LOGGING_FLAGS;m.DEFAULT_DEVICE_LOGGING_FLAGS[m.LOG_OUTPUT.DEVICE_CONNECTED]=k.GLOBAL_CONSOLE|k.POPUP|k.STATUS_BAR|k.DEVICE_CONSOLE;m.DEFAULT_DEVICE_LOGGING_FLAGS[m.LOG_OUTPUT.DEVICE_DISCONNECTED]=k.GLOBAL_CONSOLE|k.POPUP|k.STATUS_BAR|k.DEVICE_CONSOLE;m.DEFAULT_DEVICE_LOGGING_FLAGS[m.LOG_OUTPUT.RESPONSE]=k.DEVICE_CONSOLE|k.GLOBAL_CONSOLE;m.DEFAULT_DEVICE_LOGGING_FLAGS[m.LOG_OUTPUT.SEND_COMMAND]=k.DEVICE_CONSOLE|
k.GLOBAL_CONSOLE;m.DEFAULT_DEVICE_LOGGING_FLAGS[m.LOG_OUTPUT.DEVICE_ERROR]=k.GLOBAL_CONSOLE|k.POPUP|k.STATUS_BAR|k.DEV_CONSOLE|k.DEVICE_CONSOLE;m.DRIVER_FLAGS={RUNS_ON_SERVER:2,DEBUG:4,SERVER:16};g.mixin(m.ITEM_TYPE,{CF_DRIVER_VARIABLE:"DriverVariable",CF_DRIVER_BASIC_COMMAND:"DriverBasicCommand",CF_DRIVER_CONDITIONAL_COMMAND:"DriverConditionalCommand",CF_DRIVER_RESPONSE_VARIABLE:"DriverResponseVariable"});m.BLOCK_GROUPS={CF_DRIVER_VARIABLE:"DriverVariable",CF_DRIVER_BASIC_COMMAND:"DriverBasicCommand",
CF_DRIVER_CONDITIONAL_COMMAND:"DriverConditionalCommand",CF_DRIVER_RESPONSE_VARIABLE:"DriverResponseVariable",CF_DRIVER_RESPONSE_BLOCKS:"conditionalProcess",CF_DRIVER_RESPONSE_VARIABLES:"processVariables",CF_DRIVER_BASIC_VARIABLES:"basicVariables"};m.COMMAND_TYPES={BASIC_COMMAND:"basic",CONDITIONAL_COMMAND:"conditional",INIT_COMMAND:"init"};g.mixin(m.ECIType,{DEVICE_NETWORK_SETTINGS:m.ECIType.END+1,DRIVER_COMMAND_SETTINGS:"CommandSettings"});m.VFS_ROOTS={SYSTEM_DRIVERS:"system_drivers",USER_DRIVERS:"user_drivers"};
m.SOCKET_SERVER_COMMANDS={SIGNAL_MANAGER:"Manager_command",RUN_FILE:"Run_File",RUN_CLASS:"Run_Class",SIGNAL_DEVICE:"Device_command",SIGNAL_RESPONSE:"WebSocket_response",MANAGER_TEST:"Manager_Test",MANAGER_CLOSE_ALL:"Close_All_Connections",MANAGER_STATUS:"status",MANAGER_START_DRIVER:"startDriver",START_DEVICE:"startDevice",STOP_DEVICE:"stopDevice",CREATE_CONNECTION:"createConnection",MANAGER_STOP_DRIVER:"stopDriver",DEVICE_SEND:"Device_Send",CALL_METHOD:"Call_Method",RUN_SHELL:"Run_Shell",WATCH:"Watch_Directory",
MQTT_PUBLISH:"MQTT_PUBLISH",MQTT_SUBSCRIBE:"MQTT_SUBSCRIBE",GET_DEVICE_VARIABLES:"getVariables",WRITE_LOG_MESSAGE:"Write_Log_Message",INIT_DEVICES:"INIT_DEVICES"};return m})},"xaction/types":function(){define(["xide/types","dojo/_base/lang"],function(k,p){p.mixin(k.EVENTS,{ON_ACTION_CHANGE_CONTEXT:"onChangeActionContext",ON_ACTION_CONTEXT_CHANGED:"onActionContextChanged",REGISTER_ACTION:"registerAction",SET_ITEM_ACTIONS:"onSetItemsActions",ON_CLIPBOARD_COPY:"onClipboardCopy",ON_CLIPBOARD_PASTE:"onClipboardPaste",
ON_CLIPBOARD_CUT:"onClipboardCut",ON_RENDER_ACTIONS:"onRenderActions",ON_DID_ACTION:"onDidAction",ON_AFTER_ACTION:"onAfterAction"});k.ACTION={LAYOUT:"View/Layout",COLUMNS:"View/Columns",SELECTION:"File/Select",CLIPBOARD:"Edit/Clipboard",UNDO:"Edit/Undo",REDO:"Edit/Redo",CLIPBOARD_COPY:"Edit/Clipboard/Copy",CLIPBOARD_PASTE:"Edit/Clipboard/Paste",CLIPBOARD_CUT:"Edit/Clipboard/Cut",COPY:"File/Copy",MOVE:"File/Move",RENAME:"File/Rename",DELETE:"File/Delete",OPEN:"File/Open",EDIT:"File/Edit",SAVE:"File/Save",
SEARCH:"File/Search",TOOLBAR:"View/Show/Toolbar",STATUSBAR:"View/Show/Statusbar",BREADCRUMB:"View/Show/Breadcrumb",HEADER:"View/Show/Header",DOWNLOAD:"File/Download",DOWNLOAD_TO:"File/downloadTo",INFO:"File/Info",COMPRESS:"File/Compress",RELOAD:"File/Reload",UPLOAD:"File/Upload",PREVIEW:"File/Preview",OPEN_IN:"File/Open In",INSERT_IMAGE:"insertImage",COPY_PASTE:"copypaste",DND:"dnd",OPTIONS:"options",NEW_FILE:"File/New/New File",NEW_DIRECTORY:"File/New/New Folder",GET_CONTENT:"get",SET_CONTENT:"set",
FIND:"File/Find",CUSTOM:"custom",PERMA_LINK:"permaLink",ADD_MOUNT:"ADD_MOUNT",REMOVE_MOUNT:"REMOVE_MOUNT",EDIT_MOUNT:"EDIT_MOUNT",PERSPECTIVE:"PERSPECTIVE",RUN:"File/Run",GO_UP:"Navigation/Go Up",STOP:"File/Stop",CLOSE:"View/Close",FULLSCREEN:"View/Fullscreen",OPEN_IN_TAB:"File/OpenInNewTab",SOURCE:"Navigation/Source",RIBBON:"View/Show/Ribbon",MAIN_MENU:"View/Show/MainMenu",NAVIGATION:"View/Show/Navigation",BASH_CONSOLE:"File/Console/Bash",JS_CONSOLE:"File/Console/JS",PHP_CONSOLE:"File/Console/PHP",
CONSOLE:"File/Console/PHP",SIZE_STATS:"View/Show/SizeStats",WELCOME:"Window/Welcome",CONTEXT_MENU:"File/ContextMenu"};k.ACTION_TYPE={MULTI_TOGGLE:"multiToggle",SINGLE_TOGGLE:"singleToggle"};k.ACTION_ICON={CLIPBOARD_COPY:"fa-copy",CLIPBOARD_PASTE:"fa-paste",UPLOAD:"fa-upload",RENAME:"el-icon-edit",DELETE:"text-danger fa-remove",RELOAD:"fa-refresh",EDIT:"fa-pencil",SAVE:"fa-floppy-o",SEARCH:"fa-search",NEW_DIRECTORY:"fa-magic",NEW_FILE:"fa-magic",RUN:"text-success el-icon-play",COMPRESS:"fa-file-archive-o",
EXTRACT:"fa-folder-open",DOWNLOAD:"fa-download",GO_UP:"fa-level-up",TOOLBAR:"fa-bars",STATUSBAR:"fa-terminal",PREVIEW:"fa-eye",MAXIMIZE:"fa-arrows-alt",UNDO:"fa-undo",REDO:"fa-repeat"};return k})},"nxapp/utils/_console":function(){define(["dojo/has!host-node?dojo/node!tracer","dojo/has!host-node?dojo/node!util","nxapp/utils"],function(k,p,m){var g=g;k&&(g=k.colorConsole({format:"\x3c{{title}}\x3e {{message}} (in {{file}}:{{line}})",dateformat:"HH:MM:ss.L"}));"undefined"==typeof logError&&(global.logError=
function(c,e){g.error("Error "+e,c)});m.stack=function(){g.log(Error().stack)};g.clear=function(){p.print("\u001b[2J\u001b[0;0H")};return g})},"nxapp/server/DeviceServer":function(){define("dcl/dcl dojo/_base/lang xide/types xide/factory nxapp/server/WebSocket dojo/node!http dojo/node!sockjs dojo/node!path dojo/node!fs-jetpack nxapp/utils/_console xide/utils nxapp/model/Connection".split(" "),function(k,p,m,g,c,e,b,a,f,n,q,d){var l=!1;return k([c],{mqttManager:null,declaredClass:"nxapp.server.DeviceServer",
handleManagerCommand:function(a,b){switch(a.manager_command){case m.SOCKET_SERVER_COMMANDS.MANAGER_TEST:n.dir("Test Manager command");break;case m.SOCKET_SERVER_COMMANDS.RUN_SHELL:return this.ctx.getDeviceManager().runShell(a.cmd,a.args,a.options);case m.SOCKET_SERVER_COMMANDS.RUN_FILE:return this.ctx.runFile(a);case m.SOCKET_SERVER_COMMANDS.INIT_DEVICES:return this.ctx.loadDevices(a);case m.SOCKET_SERVER_COMMANDS.RUN_CLASS:return this.ctx.runClass(a);case m.SOCKET_SERVER_COMMANDS.WATCH:var d=this.ctx.getFileManager();
d&&d.watch(a.path,a.watch);break;case m.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH:return this.sendMQTTMessage(a,b);case m.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER:return this.startDriver(a,b);case m.SOCKET_SERVER_COMMANDS.CREATE_CONNECTION:return this.createConnection(a,b);case m.SOCKET_SERVER_COMMANDS.START_DEVICE:return this.startDevice(a,b);case m.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES:return this.getVariables(a,b);case m.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE:this.logClientMessage(a);break;
case m.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER:this.stopDriver(a);break;case m.SOCKET_SERVER_COMMANDS.MANAGER_STATUS:a={message:"returning status",deviceConnections:this.options.context.getConnectionManager().getNumberOfConnections()};this.emit(m.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,JSON.stringify(a));break;case m.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL:this.options.context.getConnectionManager().closeAll()}},handleDeviceCommand:function(a,b){var d=a.device_command,f=this.options.context,c=
this;l=!1;var e=a.options,g=null;b||l&&n.error("---have no client ");e.host&&e.protocol?g=f.getConnectionManager().connect(e.host,e.protocol,e.port||"",null,e,b):n.error("handle device command: invalid args. data.options is not xide/types/DeviceInfo",q.inspect(a));try{g&&(g.options=e,f.getConnectionManager().registerFeedBack2(g,function(b,h){if(_.isString(h))a.lastResponse=""+h;else if(_.isObject(h))try{a.lastResponse=JSON.stringify(h)}catch(d){l&&n.error("error serializing data")}c.onDeviceMessage(b,
h)}))}catch(k){n.error("-register feed back function failed",k),n.trace(k)}try{switch(d){case m.SOCKET_SERVER_COMMANDS.CALL_METHOD:this.options.context.getConnectionManager().callMethod(g,a,b);break;case m.SOCKET_SERVER_COMMANDS.DEVICE_SEND:this.options.context.getConnectionManager().send(g,a.command,a.options)}}catch(p){n.error("error command parser "+d,p.stack)}},sendMQTTMessage:function(a,b){var d=a.data.device;a.data.sourceHost=b.remoteAddress;a.data.sourcePort=b.remotePort;if(d){if((d=this.ctx.getConnectionManager().getConnection2(d))&&
d.variables){var l=a.topic.split("/");if(4==l.length&&"Variable"==l[2]){l=l[3];if(!l)return;for(var f=0;f<d.variables.length;f++){var c=d.variables[f];c.name===l&&(c.value=a.data.value)}}}}else n.error("cant find device");this.mqttManager&&this.mqttManager.publishTopic(a.topic,a.data)},updateDeviceState:function(a,b){this.mqttManager&&this.mqttManager.publishTopic(a,b)},sendClientMessage:function(a,b,d,l){b={data:q.mixin({device:b},l),event:d};a.write(JSON.stringify(b))},getVariables:function(a,b){var d=
a.device,l=this.ctx.getConnectionManager().getConnection2(d),f=[];if(l){l.options=d;var c=l.variables;c?(f=c,this.sendClientMessage(b,d,m.EVENTS.SET_DEVICE_VARIABLES,{variables:c})):(f=l.variables=a.variables,_.each(f,function(a){a.value=a.initial}),this.sendClientMessage(b,d,m.EVENTS.SET_DEVICE_VARIABLES,{variables:a.variables}))}else n.error("cant find device connection");if((l=b.mqtt)&&!l.didSubscribe)for(c=0;c<f.length;c++)l.subscribe(d.host+"/"+d.port+"/Variable/"+f[c].name)},logClientMessage:function(a){var b=
a.data.device;a.data.device?this.logEx(a.message,a.level,a.type,{device:b,deviceMessage:"",time:a.time}):n.error("wrong log parameters, host missing",a)},getLogger:function(b){var h=this.ctx.getLogManager(),d=h.options,l=q.replaceAll("/","_",b.host)+"_"+b.port+"_"+b.protocol+".json",c=h.loggers[l],d=(b=b[b.deviceScope])?f.dir(b+a.sep+"logs").path():d.fileLogger.dirname;c||(c=h.createLogger({filename:l,dirname:d,json:!0,console:null}),h.loggers[l]=c);return c},logEx:function(a,b,d,l){var f=this.getLogger(l.device);
b=b||"info";l=l||{};l.type=d||"Unknown";l.time=l.time||(new Date).getTime();f.log(b,a,l)},stopDriver:function(a){var b=this.ctx.getConnectionManager(),t=this.ctx.getDeviceManager(),f=b.getConnection2(a);f&&(f.options=a,f.client.close());b.removeConnection(f,null,!0);!f&&l&&n.log("have no such connection "+d.generateId(a));t.stopDevice(a.id)},sendClientEvent:function(a){},startDriver:function(a,b){var f=this.ctx.getConnectionManager(),c=this.ctx.getDeviceManager(),e=f.getConnection2(a),q=a.driverOptions&
1<<m.DRIVER_FLAGS.RUNS_ON_SERVER,g=a.driverOptions&1<<m.DRIVER_FLAGS.SERVER;l&&n.log("start driver "+a.host+" : "+a.port+"@"+a.protocol+" server side \x3d "+q+" device Scope "+a.deviceScope+" is server \x3d "+g+" found connection:"+(e?"true":"false")+" external client "+b.isExternal());if(q&&q&&!e)if(c&&c.startDevice||n.error("!deviceManager || !startDevice"),q=c.getItemById(a.id)){if(g=c.toDeviceControlInfo(q))return c.startDevice(q,!0),!0;g&&l&&n.log("driver runs server side, start device! "+g.toString())}else{n.warn("DeviceServer::startDriver : cant find device");
return}if(!e)return l&&n.log("start driver: connection doesnt exists "+a.host+" : "+a.port+"@"+a.protocol+" : "+a.deviceScope+" id : "+d.generateId(a)),a[a.driverScope]?f.connect(a.host,a.protocol,a.port,a.mqtt,a,b):(n.error("have no driver scope"),null);e.options=a;f.onConnect2(e,!0,!0);if(!a.deviceScope)throw n.error("has no device scope",a),Error("has no device scope",a);return"xxxx"},startDevice:function(a,b){var d=this.ctx.getDeviceManager(),f=this.ctx.getConnectionManager(),c=a.driverOptions&
1<<m.DRIVER_FLAGS.RUNS_ON_SERVER,e=a.driverOptions&1<<m.DRIVER_FLAGS.SERVER;l&&n.log("start device "+a.host+" : "+a.port+"@"+a.protocol+" server side \x3d "+c+" device Scope "+a.deviceScope+" is server \x3d "+e+" external client "+b.isExternal());if(c=d.getItemById(a.id)){if(e=d.toDeviceControlInfo(c))return d.startDevice(c,null,b).then(function(){var b=f.getConnection2(a);if(b)f.onConnect2(b,!0,!0);else n.error("DeviceServer::startDevice : cant find connection")}),!0;e&&l&&n.log("driver runs server side, start device! "+
e.toString())}else n.warn("Cant find device")},createConnection:function(a,b){var f=this.ctx.getConnectionManager(),c=f.getConnection2(a),e=a.driverOptions&1<<m.DRIVER_FLAGS.RUNS_ON_SERVER,q=a.driverOptions&1<<m.DRIVER_FLAGS.SERVER;l&&n.log("createConnection "+a.host+" : "+a.port+"@"+a.protocol+" server side \x3d "+e+" device Scope "+a.deviceScope+" is server \x3d "+q+" found connection:"+(c?"true":"false")+" | is external client:"+b.isExternal());if(!c)return l&&n.log("createConnection: connection doesnt exists "+
a.host+" : "+a.port+"@"+a.protocol+" : "+a.deviceScope+" id : "+d.generateId(a)),a[a.driverScope]?f.connect(a.host,a.protocol,a.port,a.mqtt,a,b):(n.error("have no driver scope"),null);c.options=a;f.onConnect2(c,!0,!0);if(!a.deviceScope)throw n.error("has no device scope",a),Error("has no device scope",a);return c},onFileChanged:function(a){this.broadCastMessage(m.EVENTS.ON_FILE_CHANGED,{path:a.path,event:a.event})},onDeviceMessage:function(a,b,f){if(a)if(null===b)l&&n.error("---onDeviceMessage:have no data "+
a.options.id+" server id \x3d "+d.generateId(a.options));else{f={device:a.options,deviceMessage:b,bytes:f&&f.join?f.join(","):""};var c=b.event||m.EVENTS.ON_DEVICE_MESSAGE;if(a&&a.isRunAsServer()&&c===m.EVENTS.ON_DEVICE_MESSAGE)this.ctx.getDeviceManager().onDeviceServerMessage({event:m.EVENTS.ON_DEVICE_MESSAGE,data:{data:f}});else this.broadCastMessage(b.event||m.EVENTS.ON_DEVICE_MESSAGE,f)}else n.error("---onDeviceMessage:have no connection object")},onLogMessage:function(a){this.broadCastMessage(m.EVENTS.ON_SERVER_LOG_MESSAGE,
a)},onClientDisconnect:function(a){a.mqtt&&(a.mqtt.end(),delete a.mqtt)},onClientConnection:function(a){if(this.mqttManager){var b=this;if(!a)l&&n.error("DeviceServer::onClientConnection connection null");else if(!a.mqtt){var d=this.mqttManager.createMQTTClient(a.remoteAddress,a.remotePort);d.client=a;a.mqtt=d;d.on("message",function(d,l){l.sourceHost!==a.remoteAddress&&l.sourcePort!==a.remotePort&&b.sendClientMessage(a,{},m.EVENTS.ON_MQTT_MESSAGE,{topic:d,message:l.toString(),host:a.remoteAddress,
port:a.remotePort})})}}},start:function(a,d){this.profile=d;this.options=p.mixin(this.options,a);this.clients=[];var f=this,c=this.options.port,q=this.options.host;this.subscribe(m.EVENTS.ON_SERVER_LOG_MESSAGE,this.onLogMessage,this);if(c){this.initLogger(d.debug);this.log("Socket server running in "+c,"socket_server");var g={heartbeat_delay:1E3};l||(g.log=function(){});var g=b.createServer(g),k=e.createServer(this._handler);g.installHandlers(k);k.listen(c,q);this._handleSocketEmits(g);this.publish(m.EVENTS.ON_WEBSOCKET_START,
{socket_server:{port:c,socket_handler:g}},this);g.on("connection",function(a){var b=f.clients.push(a);l&&n.log("on device server client connection "+b);f.onClientConnection(a);a.isExternal=function(){return!0};a.on("close",function(){l&&n.info("close client connection "+b);f.onClientDisconnect(a);f.clients.remove(a)})});return!0}n.error("Port must be provided into options");return!1},_handleSocketEmits:function(a){var b=this.options.port,d=this;a.on("connection",function(a){d.socket=a;g.publish(m.EVENTS.ON_WEBSOCKET_CONNECTION,
{connection:{port:b,socket_handler:a}},this);a.on("data",function(b){_.isString(b)&&(b=q.fromJson(b));b.manager_command?d.handleManagerCommand(b,a):d.handleDeviceCommand(b,a)})})}})})},"nxapp/model/Connection":function(){define("dcl/dcl xide/model/Base xide/mixins/EventedMixin xide/encoding/MD5 xide/utils xide/types".split(" "),function(k,p,m,g,c,e){function b(a,b){var n=a[a.deviceScope],q=a[a.driverScope];if(!n&&b){var d=b.ctx.getDeviceManager();if(d){var l=d.getDeviceById(a.id);l&&(q=d.toDeviceControlInfo(l),
n=q[q.deviceScope],q=q[q.driverScope])}}n=c.replaceAll("/","",n+q);n=c.replaceAll("\\","",n);return g(JSON.stringify({protocol:a.protocol,port:a.port,host:a.host,hash:n,isServer:a.driverOptions&1<<e.DRIVER_FLAGS.SERVER,runAsServer:a.driverOptions&1<<e.DRIVER_FLAGS.RUNS_ON_SERVER}),1)}k=k([m.dcl],{connected:!1,__registered:!1,declaredClass:"nxapp/model/Connection",client:null,options:null,socket:null,id:null,toString:function(){var a=this.options;return a.deviceScope+"://"+a.host+":"+a.port+"@"+a.protocol+
"@"+(this.isServer()?"server":"")},constructor:function(a,f){this.client=a;this.options=f;c.mixin(this,{protocol:f.protocol,port:f.port,host:f.host});this.id=b(f);a.connection=this},isServer:function(){return this.options.driverOptions&1<<e.DRIVER_FLAGS.SERVER},isRunAsServer:function(){return this.options.driverOptions&1<<e.DRIVER_FLAGS.RUNS_ON_SERVER}});k.generateId=b;k.generateHash=function(a){var b=c.replaceAll("/","",a[a.deviceScope]+a[a.driverScope]),b=c.replaceAll("\\","",b);return{protocol:a.protocol,
port:a.port,host:a.host,hash:b,isServer:a.driverOptions&1<<e.DRIVER_FLAGS.SERVER,runAsServer:a.driverOptions&1<<e.DRIVER_FLAGS.RUNS_ON_SERVER}};return k})},"xide/encoding/MD5":function(){define(["./_base"],function(k){function p(a,b){return a<<b|a>>>32-b}function m(a,b,c,e,d,l){return k.addWords(p(k.addWords(k.addWords(b,a),k.addWords(e,l)),d),c)}function g(a,b,c,e,d,l,r){return m(b&c|~b&e,a,b,d,l,r)}function c(a,b,c,e,d,l,r){return m(b&e|c&~e,a,b,d,l,r)}function e(a,b,c,e,d,l,r){return m(c^(b|~e),
a,b,d,l,r)}function b(a,b){a[b>>5]|=128<<b%32;a[(b+64>>>9<<4)+14]=b;for(var n=1732584193,q=-271733879,d=-1732584194,l=271733878,r=0;r<a.length;r+=16)var h=n,t=q,y=d,u=l,n=g(n,q,d,l,a[r+0],7,-680876936),l=g(l,n,q,d,a[r+1],12,-389564586),d=g(d,l,n,q,a[r+2],17,606105819),q=g(q,d,l,n,a[r+3],22,-1044525330),n=g(n,q,d,l,a[r+4],7,-176418897),l=g(l,n,q,d,a[r+5],12,1200080426),d=g(d,l,n,q,a[r+6],17,-1473231341),q=g(q,d,l,n,a[r+7],22,-45705983),n=g(n,q,d,l,a[r+8],7,1770035416),l=g(l,n,q,d,a[r+9],12,-1958414417),
d=g(d,l,n,q,a[r+10],17,-42063),q=g(q,d,l,n,a[r+11],22,-1990404162),n=g(n,q,d,l,a[r+12],7,1804603682),l=g(l,n,q,d,a[r+13],12,-40341101),d=g(d,l,n,q,a[r+14],17,-1502002290),q=g(q,d,l,n,a[r+15],22,1236535329),n=c(n,q,d,l,a[r+1],5,-165796510),l=c(l,n,q,d,a[r+6],9,-1069501632),d=c(d,l,n,q,a[r+11],14,643717713),q=c(q,d,l,n,a[r+0],20,-373897302),n=c(n,q,d,l,a[r+5],5,-701558691),l=c(l,n,q,d,a[r+10],9,38016083),d=c(d,l,n,q,a[r+15],14,-660478335),q=c(q,d,l,n,a[r+4],20,-405537848),n=c(n,q,d,l,a[r+9],5,568446438),
l=c(l,n,q,d,a[r+14],9,-1019803690),d=c(d,l,n,q,a[r+3],14,-187363961),q=c(q,d,l,n,a[r+8],20,1163531501),n=c(n,q,d,l,a[r+13],5,-1444681467),l=c(l,n,q,d,a[r+2],9,-51403784),d=c(d,l,n,q,a[r+7],14,1735328473),q=c(q,d,l,n,a[r+12],20,-1926607734),n=m(q^d^l,n,q,a[r+5],4,-378558),l=m(n^q^d,l,n,a[r+8],11,-2022574463),d=m(l^n^q,d,l,a[r+11],16,1839030562),q=m(d^l^n,q,d,a[r+14],23,-35309556),n=m(q^d^l,n,q,a[r+1],4,-1530992060),l=m(n^q^d,l,n,a[r+4],11,1272893353),d=m(l^n^q,d,l,a[r+7],16,-155497632),q=m(d^l^n,q,
d,a[r+10],23,-1094730640),n=m(q^d^l,n,q,a[r+13],4,681279174),l=m(n^q^d,l,n,a[r+0],11,-358537222),d=m(l^n^q,d,l,a[r+3],16,-722521979),q=m(d^l^n,q,d,a[r+6],23,76029189),n=m(q^d^l,n,q,a[r+9],4,-640364487),l=m(n^q^d,l,n,a[r+12],11,-421815835),d=m(l^n^q,d,l,a[r+15],16,530742520),q=m(d^l^n,q,d,a[r+2],23,-995338651),n=e(n,q,d,l,a[r+0],6,-198630844),l=e(l,n,q,d,a[r+7],10,1126891415),d=e(d,l,n,q,a[r+14],15,-1416354905),q=e(q,d,l,n,a[r+5],21,-57434055),n=e(n,q,d,l,a[r+12],6,1700485571),l=e(l,n,q,d,a[r+3],10,
-1894986606),d=e(d,l,n,q,a[r+10],15,-1051523),q=e(q,d,l,n,a[r+1],21,-2054922799),n=e(n,q,d,l,a[r+8],6,1873313359),l=e(l,n,q,d,a[r+15],10,-30611744),d=e(d,l,n,q,a[r+6],15,-1560198380),q=e(q,d,l,n,a[r+13],21,1309151649),n=e(n,q,d,l,a[r+4],6,-145523070),l=e(l,n,q,d,a[r+11],10,-1120210379),d=e(d,l,n,q,a[r+2],15,718787259),q=e(q,d,l,n,a[r+9],21,-343485551),n=k.addWords(n,h),q=k.addWords(q,t),d=k.addWords(d,y),l=k.addWords(l,u);return[n,q,d,l]}k.MD5=function(a,c){var e=c||k.outputTypes.Base64,g=b(k.stringToWord(a),
8*a.length);switch(e){case k.outputTypes.Raw:return g;case k.outputTypes.Hex:return k.wordToHex(g);case k.outputTypes.String:return k.wordToString(g);default:return k.wordToBase64(g)}};k.MD5._hmac=function(a,c,e){e=e||k.outputTypes.Base64;var g=k.stringToWord(c);16<g.length&&(g=b(g,8*c.length));var d=[];c=[];for(var l=0;16>l;l++)d[l]=g[l]^909522486,c[l]=g[l]^1549556828;a=b(d.concat(k.stringToWord(a)),512+8*a.length);a=b(c.concat(a),640);switch(e){case k.outputTypes.Raw:return a;case k.outputTypes.Hex:return k.wordToHex(a);
case k.outputTypes.String:return k.wordToString(a);default:return k.wordToBase64(a)}};return k.MD5})},"xide/encoding/_base":function(){define(["dojo/_base/lang"],function(k){return{outputTypes:{Base64:0,Hex:1,String:2,Raw:3},addWords:function(k,m){var g=(k&65535)+(m&65535);return(k>>16)+(m>>16)+(g>>16)<<16|g&65535},stringToWord:function(k){for(var m=[],g=0,c=8*k.length;g<c;g+=8)m[g>>5]|=(k.charCodeAt(g/8)&255)<<g%32;return m},wordToString:function(k){for(var m=[],g=0,c=32*k.length;g<c;g+=8)m.push(String.fromCharCode(k[g>>
5]>>>g%32&255));return m.join("")},wordToHex:function(k){for(var m=[],g=0,c=4*k.length;g<c;g++)m.push("0123456789abcdef".charAt(k[g>>2]>>g%4*8+4&15)+"0123456789abcdef".charAt(k[g>>2]>>g%4*8&15));return m.join("")},wordToBase64:function(k){for(var m=[],g=0,c=4*k.length;g<c;g+=3)for(var e=(k[g>>2]>>g%4*8&255)<<16|(k[g+1>>2]>>(g+1)%4*8&255)<<8|k[g+2>>2]>>(g+2)%4*8&255,b=0;4>b;b++)8*g+6*b>32*k.length?m.push("\x3d"):m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>6*
(3-b)&63));return m.join("")},stringToUtf8:function(k){for(var m="",g=-1,c,e;++g<k.length;)c=k.charCodeAt(g),e=g+1<k.length?k.charCodeAt(g+1):0,55296<=c&&56319>=c&&56320<=e&&57343>=e&&(c=65536+((c&1023)<<10)+(e&1023),g++),127>=c?m+=String.fromCharCode(c):2047>=c?m+=String.fromCharCode(192|c>>>6&31,128|c&63):65535>=c?m+=String.fromCharCode(224|c>>>12&15,128|c>>>6&63,128|c&63):2097151>=c&&(m+=String.fromCharCode(240|c>>>18&7,128|c>>>12&63,128|c>>>6&63,128|c&63));return m}}})},"nxapp/server/FileServer":function(){define("dojo/_base/declare dojo/_base/lang xide/types xide/factory nxapp/server/WebSocket nxapp/utils/_LogMixin dojo/node!http dojo/node!sockjs".split(" "),
function(k,p,m,g,c,e,b,a){return k("nxapp.server.WebSocket",[c,e],{onFileChanged:function(a){this.broadCastMessage(m.EVENTS.ON_FILE_CHANGED,{path:a.path,modulePath:a.modulePath,mask:a.mask,type:a.type})},start:function(c,e){this.profile=e;this.options=p.mixin(this.options,c);this.clients=[];var q=this;g.subscribe(m.EVENTS.ON_FILE_CHANGED,this.onFileChanged,this);var d=this.options.port,l=this.options.host;if(d){this.initLogger(e.debug);this.log("File Socket server running in "+d,"socket_server");
var r={};this.showDebugMsg("socket_server")||(r.log=function(){});var r=a.createServer(r),h=b.createServer(this._handler);r.installHandlers(h);h.listen(d,l);this._handleSocketEmits(r);g.publish(m.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:d,socket_handler:r}},this);r.on("connection",function(a){var b=q.clients.push(a);a.on("close",function(){delete q.clients[b]})});return!0}console.error("Port must be provided into options");return!1},_handleSocketEmits:function(a){var b=this.options.port,c=this;
a.on("connection",function(a){c.socket=a;g.publish(m.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:b,socket_handler:a}},this);a.on("close",function(){})})}})})},"nxappmain/nxAppBase":function(){define("dcl/dcl nxapp/utils/FileUtils dojo/node!commander dojo/node!fs dojo/node!os dojo/node!path dojo/node!util xide/factory/Events dojo/has xide/model/Base xide/utils".split(" "),function(k,p,m,g,c,e,b,a,f,n,q){f.add("windows",function(){return"win32"===c.platform()});f.add("osx",function(){return"darwin"===
c.platform()});f.add("linux",function(){return"linux"===c.platform()});f.add("arm",function(){return"arm"===c.arch()});return k(n.dcl,{declaredClass:"nxappmain.nxAppBase",profile:null,commander:null,profilePath:"/nxappmain/profile_device_server.json",getDefaultProfilePath:function(){return process.cwd()+this.profilePath},getProfile:function(a){var b={};a||(a=this.commander.profile&&0<this.commander.profile.length?this.commander.profile:this.getDefaultProfilePath());g.existsSync(a)||(a=process.cwd()+
this.profilePath);var c=p.readFile(a);c?b=dojo.fromJson(c):console.error("have no profile at : "+a);if(c=(c=this.commander.system)?p.resolve(c):null)b.data=c,b.watchr.paths=[c+a.sep+"system",c+a.sep+"workspace"];return b},init:function(){this.commander||(m.version("0.0.1").option("-i, --info","return service profile").option("-f, --file \x3cpath\x3e","run a file").option("-u, --user \x3cpath\x3e","user directory").option("--diagnose \x3cboolean\x3e","do some diagnose").option("--modules","list all modules").option("--start \x3cboolean\x3e",
"start devices").option("--serverSide \x3cboolean\x3e","make devices server side").option("-s, --system \x3cname\x3e","path to system scope").option("-j, --jhelp","output options as json").option("-t, --test","enable test mode").option("--mqtt \x3cboolean\x3e","enable or disable MQTT functionality"),this.commander=m,this.commander.allowUnknownOption(!0),this.commander.parse(process.argv));if(m.jhelp){var a=[];m.options.map(function(b){a.push(b)});console.log(JSON.stringify(a));process.exit()}this.profile=
this.getProfile(this.profilePath);q.mixin(this.profile,this.commander);var b=e.resolve(this.profile.system);g.existsSync(b)||(b=process.cwd()+"/data/system",this.profile.system=b,m.system=b);this.profile.user&&(b=e.resolve(this.profile.user),g.existsSync(b)&&(this.profile.user=b));this.commander.start&&(this.profile.start="true"===this.commander.start);this.commander.serverSide&&(this.profile.serverSide="true"===this.commander.serverSide)}})})},"xide/factory/Events":function(){define(["xide/factory",
"dojo/_base/connect","dojo/_base/lang","dojo/on","dojo/has"],function(k,p,m,g,c){var e={click:null,dblclick:null,mousedown:null,mouseup:null,mouseover:null,mousemove:null,mouseout:null,keypress:null,keydown:null,keyup:null,focus:null,blur:null,change:null};k.publish=function(b,a,c,e){a=a?_.isString(a)?{message:a}:a:{};c=b;var g=p.publish,d=[];_.isArray(b)||(c=[b]);b=0;for(var l=c.length;b<l;b++){var r=c[b];if(!e||e(r))d=g(r,a)}return d};k.subscribe=function(b,a,c,n){var q=b,d=p.subscribe,l=[];_.isArray(b)||
(q=[b]);b=0;for(var r=q.length;b<r;b++)if(q[b]&&(!n||n(y))){var h=q[b],t=_.isString(h),y=t?h:h.key,h=t?a:h.handler,t=y in e;null!=c?(h=null!=h?h:c[y],t=t?g(c,y,m.hitch(c,h)):d(y,m.hitch(c,h)),t.handler=m.hitch(c,h)):(t=p.subscribe(y,h),t.handler=h);t.type=y;l.push(t)}return l};return k})},"nxapp/manager/Context":function(){define("dcl/dcl ./ConnectionManager xide/manager/ContextBase require nxapp/utils/_console xide/types xide/utils dojo/node!path".split(" "),function(k,p,m,g,c,e,b,a){return k(m,
{declaredClass:"nxapp.manager.Context",connectionManager:null,blockManager:null,deviceServer:null,logManager:null,loadDevices:function(b){c.log("load devices",b);var e=this.getDeviceManager(),g=this.getDriverManager();e.debug();var d=e.getStores()[b.scope],l=b.path;d?d.connected?c.warn("store "+d.scope+" is already connected"):c.info("connecting store "+d.scope):(c.info("connecting store "+b.scope),g.createStore({items:this.getDrivers(a.resolve(l+"/drivers"),"user_drivers")},"user_drivers",!0),e.initStore({items:this.getDevices(a.resolve(l+
"/devices"),"user_devices")},"user_devices",!0))},runFile:function(a){c.log("run file",a)},broadCastMessage:function(a,c){this.getDeviceServer().broadCastMessage(e.EVENTS.ON_RUN_CLASS_EVENT,b.mixin({event:e.EVENTS.ON_RUN_CLASS_EVENT},c))},runClass:function(a){var b=a["class"],e=this;try{g([b],function(d){d=new d(a.args);try{d.run({data:a,clear:function(){this.data.progress=null;this.data.finish=null;this.data.error=null;this.data.data=null},onProgress:function(a,b){this.clear();this.data.progress=
a;this.data.data=b;e.broadCastMessage(null,this.data)},onFinish:function(a,b){this.clear();this.data.finish=a;this.data.data=b;e.broadCastMessage(null,this.data)},onError:function(a,b){this.clear();this.data.error=a;this.data.data=b;e.broadCastMessage(null,this.data)}})}catch(r){c.error("error running class "+b,r),a.error=r.message,e.broadCastMessage(null,a)}})}catch(d){c.error("error loading class "+b,d)}},getDeviceServer:function(){return this.deviceServer},getConnectionManager:function(){return this.connectionManager},
initManagers:function(a){this.connectionManager.init(a)},constructManagers:function(){this.connectionManager=new p({ctx:this})},getLogManager:function(){return this.logManager}})})},"nxapp/manager/ConnectionManager":function(){define("dcl/dcl nxapp/manager/ManagerBase nxapp/utils/_LogMixin nxapp/protocols/Tcp nxapp/protocols/Udp nxapp/protocols/Driver nxapp/protocols/SSH nxapp/protocols/Serial nxapp/protocols/MQTT nxapp/protocols/ProtocolBase nxapp/types/Types xide/factory xide/utils nxapp/utils/_console xide/data/_Base nxapp/model/Connection xide/data/TreeMemory xide/data/ObservableStore dstore/Trackable dojo/_base/declare".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d,l,r,h,t,y,u,v,z){return k([p,m],{declaredClass:"nxapp.manager.ConnectionManager",options:null,profile:null,lastUpTime:null,mqttManager:null,pool:[],poolNotFound:-1,store:null,onWakeup:function(){this.lastUpTime=(new Date).getTime();for(var a=0;a<this.pool.length;a++){var b=this.pool[a];b.socket&&b.socket.close&&b.socket.close();b.socket&&b.socket._socket&&b.socket._socket.close&&b.socket._socket.close()}this.pool=[]},init:function(a){this.profile=a;this.initLogger(a.debug);
this.lastUpTime=(new Date).getTime();this.store=new (z("nxapp.data.Store",[y,v,u],{}))({idProperty:"id",Model:t});var b=this;setInterval(function(){var a=(new Date).getTime();if(3E3<a-b.lastUpTime)b.onWakeup();b.lastUpTime=a},1E3)},connect:function(l,h,n,y,u,k){if(!l)return r.error("ConnectionManager::connect : have no host"),null;if(!h)return r.error("ConnectionManager::connect : have no protocol"),null;if(!u)return r.error("ConnectionManager::connect : have no options"),null;k=t.generateId(u,this);
if(k=this.store.getSync(k)){if(!k.isServer()&&!k.isRunAsServer())this.onConnect2(k,!0,!0);return k}var v=k=null;switch(h){case q.PROTOCOL.TCP:k=new g({owner:this,options:u,delegate:this});break;case q.PROTOCOL.UDP:k=new c({owner:this,options:u,delegate:this});break;case q.PROTOCOL.DRIVER:k=new e({owner:this,options:u,delegate:this});break;case q.PROTOCOL.SSH:k=new b({owner:this,options:u,delegate:this});break;case q.PROTOCOL.SERIAL:k=new a({owner:this,options:u,delegate:this});break;case q.PROTOCOL.MQTT:k=
new f({owner:this,options:u,delegate:this})}if(k){l=this.addConnection2(k,u);k.init();k.connection=l;v=k.connect();l.socket=v;d.publish(q.EVENTS.ON_CONNECTION_CREATED,{connection:l},this);if(this.mqttManager)this.mqttManager.onConnectedToDevice(u,k,y);return l}d.publish(q.EVENTS.ON_CONNECTION_ERROR,{connection:{port:n,host:l,protocol:h}},this);return!1},send:function(a,b,d){if(a){var l=a.client;if(l){var h=l._socket;a.client||r.error("connection has no client");if(h){if(!h.writable)return r.error("socket not writable, closing connection"+
a.lastError),this.close(a,!0),!1}else return r.error("have no socket"),!1;a&&a.options&&this.logEx(q.LOG_OUTPUT.SEND_COMMAND+" : "+b,"info","server",q.LOG_OUTPUT.SEND_COMMAND,a);return l.send(b,d)}r.error("send "+b+" have no client")}else r.error("send "+b+" have no connection")},callMethod:function(a,b){b=l.getJson(b);var d=b.method,h=b.args;if(a)if(a.client){if(a.client[d])return a.client[d].apply(a.client,[h,b]);r.error("no such method "+d)}else r.error("call method : connection has no client object");
else r.error("call method : invalid connection")},close:function(a){if(a){a._destroyed=!0;var b=a.client._socket;a.client=null;b&&b._socket&&b._socket.close&&b._socket.close()}},closeAll:function(){var a=this;this.forEachPool(function(b,d){a.close(d)});this.clearPool()},onTimeout:function(a){},onClose:function(a,b){a&&a.options&&(this.logEx(q.LOG_OUTPUT.DEVICE_DISCONNECTED,"info","server",q.LOG_OUTPUT.DEVICE_DISCONNECTED,a),this.publish(q.EVENTS.ON_DEVICE_DISCONNECTED,{device:a.options,connection:a}));
a._destroyed=!0;this.removeConnection(a,b)},onDrain:function(a){},onError:function(a,b,d){d&&r.log(" Error: "+d.host+":"+d.port+"@"+d.protocol,b);a&&(a.lastError=b);this.removeConnection(a,d)},onFinish:function(a,b,d){b=this.connectionExists(a.host,a.port,a.protocol);b!=this.poolNotFound?this.callFeedBack(b,data):r.error("ConnectionManager::onData : cant find pool - reference:"+b+":"+a.host+":"+a.port+":"+a.protocol)},onData:function(a,b,d){try{this.callFeedBack2(a,b,d)}catch(l){r.error("call feedback error : "+
l.message),r.log(l.stack)}a&&a.options&&this.logEx(q.LOG_OUTPUT.RESPONSE+":"+b,"info","server",q.LOG_OUTPUT.RESPONSE,a)},hasFlag:function(a,b){var d=q.LOGGING_FLAGS,h=a.loggingFlags,h=_.isString(h)?l.fromJson(h):h||{},h=h[b];return null!=h&&h&d.FILE?!0:!1},onConnect2:function(a,b,d){if(a.connected){b={device:a.options,isReplay:d};var l=this.ctx.getDeviceServer();this.getConnection2(a.options);l.broadCastMessage(q.EVENTS.ON_DEVICE_CONNECTED,b);this.publish(q.EVENTS.ON_DEVICE_CONNECTED,{device:a.options,
isReplay:d,connection:a});a&&!a.__registered&&(this.registerFeedBack2(a,function(a,b,d){b&&(b.lastResponse=_.isString(b)?b:JSON.stringify(b,null,2));l.onDeviceMessage(a,b,d)}),a.__registered=!0);a&&a.options&&!d&&this.logEx(q.LOG_OUTPUT.ON_DEVICE_CONNECTED,"info","server",q.LOG_OUTPUT.ON_DEVICE_CONNECTED,a);if(a.client&&a.client.onConnect)a.client.onConnect();return a}},logEx:function(a,b,d,l,h){var c=this.ctx.getDeviceServer();if(h&&h.options){var t=h.options;this.hasFlag(t,l)&&c.logEx(a+" "+h.toString(),
b||"info",d||"server",{device:t})}},_onConnect:function(a,b,d,l){r.log("Connected to "+l.declaredClass+":"+a+":"+b+" via "+d+" : ",l.options);if(!l.options)throw r.error("have no options: ",l),Error("Asdf");a={device:{host:a,port:b,protocol:d,options:l?l.options:null}};this.ctx.getDeviceServer().broadCastMessage(q.EVENTS.ON_DEVICE_CONNECTED,a);var h=this.ctx.getDeviceServer();l&&(l.__registered?r.error("already registered"):(this.registerFeedBack2(connection,function(a,b,d){b.lastResponse=""+b;h.onDeviceMessage(a,
b)}),l.__registered=!0))},onHandle:function(a,b){},getNumberOfConnections:function(){return this.pool.length},getDeviceConnection:function(){if(this.getNumberOfConnections())for(var a=0;a<this.pool.length;a++);},addConnection:function(a,b,d,l,h,c,f,e){f=new t(f,a,e);this.store.putSync(f);this.pool.push({socket:a,host:b,port:d,protocol:l,user:h,customFields:c,feedbackTo:[]});return f},addConnection2:function(a,b){var d=new t(a,b);return this.store.putSync(d)},removeConnection:function(a,b,d){var l=
this;a&&(a=this.getConnection2(a.options));a&&(a=this.getConnection2(a.options),this.ctx.getDeviceServer()&&setTimeout(function(){var b={device:a.options,error:a.lastError,stopped:d};l.ctx.getDeviceServer().broadCastMessage(q.EVENTS.ON_DEVICE_DISCONNECTED,b)},1E3),this.store.removeSync(a.id),a._destroyed=!0)},clearPool:function(){this.pool=[]},getConnection:function(a){if(3==arguments.length){for(var b=arguments[0],d=arguments[1],l=arguments[2],h=0;h<this.pool.length;h++){var c=this.pool[h];if(c.host==
b&&c.port==l&&c.protocol==d)return c}return null}return this.pool[a]},getConnection2:function(a){return this.store.getSync(t.generateId(a,this))},getConnectionById:function(a){return this.store.getSync(a)},registerFeedBack2:function(a,b){a&&(a.feedbackTo||(a.feedbackTo=[]),a&&0<a.feedbackTo.length||a.feedbackTo.push(b))},_registerFeedBack:function(a,b){var d=this.getConnection(a);null==d?r.error("cant find connection for pool ref:"+a):d&&0<d.feedbackTo.length||d.feedbackTo.push(b)},callFeedBack:function(a,
b){throw Error();},callFeedBack2:function(a,b,d){if(a)if(a.feedbackTo&&0!=a.feedbackTo.length)for(var l=0;l<a.feedbackTo.length;l++)a.feedbackTo[l](a,b,d);else r.error("-- call feed back: have no feedback targets",a.options.host);else r.error("-- call feed back: have no connection")},connectionExists:function(a,b,d){var l=this.poolNotFound;_.each(this.pool,function(h,c){h&&h.host===a&&h.port===b&&h.protocol===d&&(l=c)});return l},forEachPool:function(a){_.each(this.pool,function(b,d){a(b,d)})}})})},
"nxapp/manager/ManagerBase":function(){define(["dcl/dcl","xide/model/Base","xide/mixins/EventedMixin"],function(k,p,m){p=k([p.dcl,m.dcl],{declaredClass:"nxapp.manager.ManagerBase",ctx:null,profile:null,init:function(g){this.profile=g}});k.chainAfter(p,"init");return p})},"nxapp/protocols/Tcp":function(){define("dcl/dcl nxapp/utils nxapp/protocols/ProtocolBase dojo/node!net dojo/node!child_process dojo/node!util dojo/node!path xide/mixins/EventedMixin xide/mixins/ReloadMixin xide/types dojo/Deferred xcf/model/Variable".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d){k=k(m,{declaredClass:"nxapp.protocols.Tcp",_socket:null,protocolName:"tcp",delegate:null,driverInstance:null,_handleSocketEmits:function(a){var b=this;b.clients=[];var d=this.blockScope,c=d.getVariable("value"),f=d.getVariables({group:n.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES}),e=d.getBlocks({group:n.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS});a.on("connection",function(a){b.socket=a;b.clients.push(a);a.on("data",function(a){a=[{string:a.toString(),bytes:a.join(",")}];
for(var b=0;b<a.length;b++)if(0!==a[b].length){c.value=new String(a[b].string);c.value.setBytes(a[b].bytes);for(var l=0;l<f.length;l++){var r=f[l];if("value"!=f[l].title){var g=null,g=c.value;"number"!=typeof g&&(g=""+g,g="'"+g+"'");r.target&&"None"!=r.target&&null!==g&&"null"!=g&&"'null'"!=g&&(r=d.getVariable(r.target))&&(r.value=g,this.publish(n.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:r,scope:d,owner:this,save:!1,source:n.MESSAGE_SOURCE.BLOX}))}}for(r=0;r<a.length;r++)if(g=a[r],_.isObject(g)&&g.src&&
(l=d.getBlockById(g.src))&&l.onData)l.onData(g);for(r=0;r<e.length;r++)if(l=e[r],!1!==l.enabled){l.override={args:[c.value]};try{d.solveBlock(e[r],{highlight:!1})}catch(q){console.log("----solving response block crashed ",q),console.trace()}}}});a.on("close",function(){})})},_creatingServer:!1,makeServer:function(){if(!this._creatingServer){this._creatingServer=!0;try{var a=this.options,b=a.port,d=a.host,c=this;this.owner.ctx.getDriverManager().createDriverInstance(a).then(function(a){c.blockScope=
a.blockScope;c.driverInstance=a.driverInstance});var f=new g.Server;f.listen(b,d);c._socket=f;f.writable=!0;c._handleSocketEmits(f);c.connection.connected=!0;c.delegate.onConnect2(c.connection);this.subscribe(n.EVENTS.ON_DEVICE_CONNECTED,this.onDeviceConnected);this.subscribe(n.EVENTS.ON_DEVICE_DISCONNECTED,this.onDeviceDisconnected)}catch(e){console.error("error creating server",e)}return this}},connections:null,onDeviceConnected:function(a){if(a=a.connection){var b=a.options,d=this.options;this.connections||
(this.connections=[]);a.id!==this.connection.id&&this.delegate.getConnectionById(a.id)&&d.host===b.host&&d.port===b.port&&d.protocol===b.protocol&&!a.isServer()&&-1===this.connections.indexOf(a)&&this.connections.push(a)}},onDeviceDisconnected:function(a){if(a=a.connection)this.connections||(this.connections=[]),-1!==this.connections.indexOf(a)&&this.connections.remove(a)},connect:function(){if(this.isServer())return this.makeServer();var a=this.options,b=this.options.port,d=this.options.host;this.clients=
[];this._socket=new g.Socket(p.mixin({allowHalfOpen:!0,writable:!0,readable:!0},a.options));var c=this;this.isDebug()&&console.log("TCP-Client-\x3eConnect to "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this._socket.connect(b,d,function(){c.connection.connected=!0;c.delegate.onConnect2(c.connection)});this._socket.setNoDelay(!0);this._socket.setKeepAlive(!0,0);this._socket.owner=this;this._setupEventListeners(this._socket,this.delegate);return this},broadCastMessage:function(a,
b){var d=this;this.connections&&_.each(this.connections,function(a){a&&a._destroyed&&d.connections.remove(a);if(a)if(a.client)a.client.delegate.onData(a,b.toString(),b);else console.error("not at a real connection",a);else console.error("invalid connection",a)})},send:function(a){null==a?console.error("TCP : invalid command"):(a=p.bufferFromDecString(a),a=new Buffer(a),this.isServer()?this.broadCastMessage(n.EVENTS.ON_DEVICE_MESSAGE,a):this._socket.write(a))},destroy:function(){this.blockScope&&this.blockScope.destroy();
this.driverInstance&&this.driverInstance.destroy();delete this.blockScope;delete this.driverInstance;delete this.connections;delete this.clients;delete this._socket;this._destroyed=!0},close:function(){this.isServer()?(this._socket.close(),this.destroy()):this._socket.end()}});k.net=g;return k})},"nxapp/protocols/ProtocolBase":function(){define("dcl/dcl xide/model/Base xide/types xide/utils nxapp/utils/_LogMixin xide/mixins/ReloadMixin".split(" "),function(k,p,m,g,c,e){p=k([p.dcl,c,e.dcl],{onReloaded:function(){console.error("on reloaded")},
options:null,declaredClass:"nxapp.protocols.ProtocolBase",protocolName:"undefined",debug_connection:"protocol_connection",debug_messages:"protocol_messages",delegate:null,connection:null,_setupEventListeners:function(b,a){var c=this,e=c.connection;b.handle=function(b){a.onHandle(e,b)};b.on("data",function(b){a.onData(e,b.toString(),b);for(var d=0;d<b.length;d++);});a||(console.error("have no handler"),g.stack());e||(console.error("have no connection"),g.stack());b.on("error",function(b){c.isDebug()&&
console.error("socket error : ",b);a.onError(e,b)});b.on("drain",function(){a.onDrain(e)});b.on("timeout",function(){a.onTimeout(e)});b.on("close",function(b){a.onClose(e,b)})},isDebug:function(){var b=this.connection;return b&&(b=b.options)&&(b=b.driverOptions)&&b&1<<m.DRIVER_FLAGS.DEBUG?!0:!1},isServer:function(){var b=this.connection;return b&&(b=b.options)&&(b=b.driverOptions)&&b&1<<m.DRIVER_FLAGS.SERVER?!0:!1},runAsServer:function(){var b=this.connection;return b&&(b=b.options)&&(b=b.driverOptions)&&
b&1<<m.DRIVER_FLAGS.RUNS_ON_SERVER?!0:!1},_defaultOptions:function(){return{port:23,text_encoding:"utf8",end_of_command:"\r"}},toString:function(b,a){var c=g.bufferFromDecString(b);return(new Buffer(c)).toString(a)},init:function(){this.initLogger(this.options.debug);this.initReload();var b=this;this.subscribe(m.EVENTS.ON_MODULE_RELOADED,function(a){b.modulePath&&a.module&&b.modulePath===a.module&&(b.mergeFunctions(b,a.newModule.prototype),b.onReloaded())})},mergeFunctions:function(b,a){for(var c in a)"constructor"!==
c&&"inherited"!==c&&_.isFunction(a[c])&&(b[c]=null,b[c]=a[c],console.log("update : "+c))},logConnection:function(b){this.log(b,this.debug_connection)},logMessages:function(b){this.log(b,this.debug_messages)},send:function(b){},onConnect:function(){},destroy:function(){}});k.chainAfter(p,"onConnect");k.chainAfter(p,"init");k.chainAfter(p,"close");k.chainAfter(p,"destroy");return p})},"xide/mixins/ReloadMixin":function(){define(["xdojo/declare","dcl/dcl","xide/types","xide/utils","xide/mixins/EventedMixin"],
function(k,p,m,g,c){var e={_mergeFunctions:!0,_mergeMissingVariables:!0,isInstanceOf_:function(b){try{if(!!this instanceof b||this.isInstanceOf&&this.isInstanceOf(b))return!0;var a=g.getAt(this,"constructor._meta.bases",[]),c=b.prototype.declaredClass;return _.findWhere(a,function(a){return a==b||g.getAt(a,"superclass.declaredClass")===c||g.getAt(a,"prototype.declaredClass")===c})}catch(e){console.log("ReloadMixin :: this.isInstanceOf_ crashed "+e)}return!1},mergeFunctions:function(b,a){for(var c in a)"constructor"!==
c&&"inherited"!==c&&(_.isFunction(a[c])&&(b[c]=null,b[c]=a[c]),_.isArray(a[c])&&null==b[c]&&(b[c]=a[c]))},onModuleReloaded:function(b){var a=b.newModule;if(a&&a.prototype&&!b._processed){var c=a.prototype,e=c.declaredClass,q=!1,d=this.declaredClass;e&&(e&&d&&(q=g.replaceAll("/",".",d)===g.replaceAll("/",".",e)),q?(this.mergeFunctions(this,c),this.onReloaded&&(b._processed=!0,this.onReloaded(a))):b.module&&g.replaceAll("//","/",b.module)===d&&this.mergeFunctions(this,c))}},initReload:function(){this.subscribe(m.EVENTS.ON_MODULE_RELOADED)}};
k=k(null,e);k.Impl=e;k.dcl=p(c.dcl,e);return k})},"xcf/model/Variable":function(){define(["dcl/dcl","xide/types","xblox/model/variables/Variable"],function(k,p,m){return k(m,{declaredClass:"xcf.model.Variable",hasInlineEdits:!0,gui:"off",cmd:"off",save:!1,target:"None",name:"No Title",value:-1,observed:["value","initial","name"],solve:function(){var g="";if("processVariables"==this.group){var c=this.scope.getVariable("value");c&&(c=c.value,this.isNumber(c)||(c="'"+c+"'"),g="var value \x3d "+c+";\n")}return this.scope.parseExpression(g+
this.getValue(),!0)},canEdit:function(){return!0},canDisable:function(){return!1},getFields:function(){var g=this.getDefaultFields();g.push(this.utils.createCI("title",13,this.name,{group:"General",title:"Name",dst:"name"}));var c=this;g.push(this.utils.createCI("value",this.types.ECIType.EXPRESSION,this.value,{group:"General",title:"Value",dst:"value",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!1,autoFocus:!1,hasConsole:!1},aceOptions:{hasEmmet:!1,hasLinking:!1,
hasMultiDocs:!1},item:this},delegate:{runExpression:function(e,b,a){if("processVariables"==c.group){var f=c.scope.getVariable("value"),n="";f&&(f=f.value,c.isNumber(f)||(f="'"+f+"'"),n="var value \x3d "+f+";\n")}return c.scope.expressionModel.parse(c.scope,n+e,!1,b,a)}}}));g.push(this.utils.createCI("flags",5,this.flags,{group:"General",title:"Flags",dst:"flags",data:[{value:4096,label:"Dont parse",title:"Do not parse the string and use it as is"},{value:2048,label:"Expression",title:"Parse it as Javascript"}],
widget:{hex:!0}}));return g},onChangeField:function(g,c,e){"value"===g&&this.publish(p.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:this,scope:this.scope,save:!1,source:p.MESSAGE_SOURCE.GUI})}})})},"xblox/model/variables/Variable":function(){define(["dcl/dcl","xide/types","xblox/model/Block"],function(k,p,m){return k(m,{declaredClass:"xblox.model.variables.Variable",name:null,value:null,register:!0,readOnly:!1,initial:null,isVariable:!0,flags:4096,getValue:function(){return this.value},canDisable:function(){return!1},
canMove:function(){return!1},getIconClass:function(){return"el-icon-quotes-alt"},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e '},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon()+this.makeEditable("name","right","text","Enter a unique name","inline")+"\x3c/span\x3e"},solve:function(){this.scope.parseExpression(this.getValue(),!0);return[]},getFields:function(){var g=this.getDefaultFields(),c=this;g.push(this.utils.createCI("title",
p.ECIType.STRING,this.name,{group:"General",title:"Name",dst:"name"}));g.push(this.utils.createCI("value",p.ECIType.EXPRESSION,this.value,{group:"General",title:"Value",dst:"value",delegate:{runExpression:function(e,b,a){return c.scope.expressionModel.parse(c.scope,e,!1,b,a)}}}));return g}})})},"xblox/model/Block":function(){define("dcl/dcl dojo/Deferred dojo/_base/lang dojo/has xblox/model/ModelBase xide/factory xide/utils xide/types xide/utils/ObjectUtils xdojo/has!xblox-ui?xblox/model/Block_UI".split(" "),
function(k,p,m,g,c,e,b,a,f,n){function q(a,b){for(var c=0;c<b.length;c++)if(a.id===b[c].id)return c}c=[c];c.push(k(null,{getStatusIcon:function(){},getStatusClass:function(){},setStatusClass:function(){},onActivity:function(){},onRun:function(){},onFailed:function(){},onSuccess:function(){},getIconClass:function(){}}));b.mixin(a,{BLOCK_FLAGS:{NONE:0,ACTIVE:1,SCRIPT:2,RESERVED1:4,USEFUNCTION:8,RESERVED2:16,SINGLE:32,WAITSFORMESSAGE:64,VARIABLEINPUTS:128,VARIABLEOUTPUTS:256,VARIABLEPARAMETERINPUTS:512,
VARIABLEPARAMETEROUTPUTS:1024,TOPMOST:16384,BUILDINGBLOCK:32768,MESSAGESENDER:65536,MESSAGERECEIVER:131072,TARGETABLE:262144,CUSTOMEDITDIALOG:524288,RESERVED0:1048576,EXECUTEDLASTFRAME:2097152,DEACTIVATENEXTFRAME:4194304,RESETNEXTFRAME:8388608,INTERNALLYCREATEDINPUTS:16777216,INTERNALLYCREATEDOUTPUTS:33554432,INTERNALLYCREATEDINPUTPARAMS:67108864,INTERNALLYCREATEDOUTPUTPARAMS:134217728,INTERNALLYCREATEDLOCALPARAMS:1073741824,ACTIVATENEXTFRAME:268435456,LOCKED:536870912,LAUNCHEDONCE:2147483648},BLOCK_CALLBACKMASK:{PRESAVE:1,
DELETE:2,ATTACH:4,DETACH:8,PAUSE:16,RESUME:32,CREATE:64,RESET:4096,POSTSAVE:256,LOAD:512,EDITED:1024,SETTINGSEDITED:2048,READSTATE:4096,NEWSCENE:8192,ACTIVATESCRIPT:16384,DEACTIVATESCRIPT:32768,RESETINBREAKPOINT:65536,RENAME:131072,BASE:14,SAVELOAD:769,PPR:304,EDITIONS:3072,ALL:4294967295}});c=k(c,{declaredClass:"xblox.model.Block",scopeId:null,isCommand:!1,outlet:0,_destroyed:!1,enabled:!0,serializeMe:!0,name:null,shareTitle:"",sharable:!1,items:null,parent:null,_return:null,_lastResult:null,_deferredObject:null,
_currentIndex:0,_lastRunSettings:null,_onLoaded:!1,beanType:"BLOCK",override:{},ignoreSerialize:"_didSubscribe _currentIndex _deferredObject _destroyed _return parent __started ignoreSerialize _lastRunSettings _onLoaded beanType sharable override virtual _scenario _didRegisterSubscribers additionalProperties renderBlockIcon serializeMe _statusIcon _statusClass hasInlineEdits _loop help owner _lastCommand allowActionOverride canDelete isCommand lastCommand autoCreateElse _postCreated _counter".split(" "),
_parseString:function(d,l,c,h){try{l=l||this._lastSettings||{};h=h||l.flags||a.CIFLAG.EXPRESSION;var f=this.scope,e=!(h&a.CIFLAG.DONT_PARSE),n=h&a.CIFLAG.EXPRESSION;h&a.CIFLAG.TO_HEX&&(d=b.to_hex(d));!1!==e&&(d=b.convertAllEscapes(d,"none"));var g=l.override||this.override||{},q=g&&g.variables?g.variables:null,k="",k=n&&!1!==e?f.parseExpression(d,null,q,null,null,null,g.args,h):""+d}catch(m){console.error(m)}return k},postCreate:function(){},childrenByClass:function(a){for(var b=this.getChildren(),
c=[],h=0;h<b.length;h++){var f=b[h];f.isInstanceOf(a)&&c.push(f)}return c},childrenByNotClass:function(a){for(var b=this.getChildren(),c=[],h=0;h<b.length;h++){var f=b[h];f.isInstanceOf(a)||c.push(f)}return c},getInstance:function(){var a=this.scope.instance;return a?a:null},pause:function(){},mergeNewModule:function(a){for(var b in a){var c=a[b];c&&_.isFunction(c)&&(this[b]=c)}},__onReloaded:function(a){this.mergeNewModule(a.prototype);a=this.declaredClass;(a=m.getObject(b.replaceAll("/",".",a))||
m.getObject(a))&&a.prototype&&a.prototype.solve&&this.mergeNewModule(a.prototype)},reparent:function(){if(!this)return!1;if(!this.getParent()){var a=this.next(null,1)||this.next(null,-1);a&&(this.group=null,a._add(this))}},unparent:function(a,b){if(!this)return!1;var c=this.getParent();c&&c.removeBlock&&c.removeBlock(this,!1);this.group=a;this.parent=this.parentId=null;!1!==b&&(this._place(null,-1,null),this._place(null,-1,null))},move:function(a){if(!this)return!1;var b=this.getParent(),c=null;if(b){c=
b[b._getContainer(this)];if(!c||2>c.length||!this.containsItem(c,this))return!1;b=this.indexOf(c,this);if(0>b+a)return!1;var h=c[b+a];if(!h)return!1;c[b+a]=this;c[b]=h}else this._place(null,a);return!0},_place:function(a,b,c){var h=this._store,f=this;(a=a||f.next(null,b))?(a=_.isString(a)?h.getSync(a):a,f=_.isString(f)?h.getSync(f):f,c=c||h.storage.fullData,b=-1==b?0:1,c.remove(f),-1==b&&(b=0),c.splice(Math.max(q(a,c)+b,0),0,f),h._reindex()):console.error("have no next",this)},index:function(){var a=
this.getParent(),b=null,c=this.group,b=this._store;if(a)return b=a[a._getContainer(this)]||[],b=b.filter(function(a){return a.group===c}),!b||2>b.length||!this.containsItem(b,this)?!1:this.indexOf(b,this);b=b.storage.fullData;b=b.filter(function(a){return a.group===c});return this.indexOf(b,this)},numberOfParents:function(){var a=0,b=this.getParent();b&&(a++,a+=b.numberOfParents());return a},getTopRoot:function(){var a=this.getParent();if(a){var b=a.getParent();b&&(a=b)}return a},next:function(a,
b){function c(a,b,d){var l=a.indexOf(b,a);if(l=b[l+d*h]){if(!l.parentId&&l.group&&l.group===a.group)return l;h++;return c(a,b,d)}return null}var h=1;a=a||this._store.storage.fullData;return c(this,a,b)},getParent:function(){return this.parentId?this.scope.getBlockById(this.parentId):null},getScope:function(){var a=this.scope;if(this.scopeId&&0<this.scopeId.length){var b=a.owner;b&&b.hasScope&&(b.hasScope(this.scopeId)?a=b.getScope(this.scopeId):console.error("have scope id but cant resolve it",this))}return a},
canAdd:function(){return null},getTarget:function(){var a=this._targetReference;if(a)return a;var b=this.getParent();b&&b.getTarget&&(a=b.getTarget());return a},addToEnd:function(a,b){b&&null!=a.length&&null!=b.length&&a.push.apply(a,b);return a},removeBlock:function(a,b){a&&(!1!==b&&a.empty&&a.empty(),!1!==b&&delete a.items,a.parent=null,this.items&&this.items.remove(a))},_getContainer:function(a){return"items"},empty:function(a){try{this._empty(a)}catch(b){debugger}},_empty:function(a){if(a=a||
this.items)for(var b=0;b<a.length;b++){var c=a[b];c&&c.empty&&c.empty();c&&this.scope&&this.scope.blockStore&&this.scope.blockStore.remove(c.id)}},containsItem:function(a,b){for(var c=a.length;c--;)if(a[c].id===b.id)return!0;return!1},indexOf:function(a,b){for(var c=a.length;c--;)if(a[c].id===b.id)return c;return-1},_getBlock:function(a){try{if(!this||!this.parentId)return!1;var b=this.scope.getBlockById(this.parentId);if(!b)return null;var c=b[b._getContainer(this)];if(!c||2>c.length||!this.containsItem(c,
this))return null;var h=this.indexOf(c,this);if(0>h+a)return!1;var f=c[h+a];if(f)return f}catch(e){debugger}return null},getPreviousBlock:function(){return this._getBlock(-1)},getNextBlock:function(){return this._getBlock(1)},_getPreviousResult:function(){var a=this.getPreviousBlock()||this.getParent();return a&&null!=a._lastResult?this.isArray(a._lastResult)?a._lastResult:[a._lastResult]:null},getPreviousResult:function(){var a=null;if((a=(a=this.getPreviousBlock())&&a._lastResult&&a.enabled?a:this.getParent())&&
!a._lastResult){var b=a.getParent();b&&(a=b)}return a&&null!=a._lastResult?(this.isArray(a._lastResult),a._lastResult):null},_getArg:function(a,b){var c=parseFloat(a);return isNaN(c)?"true"===a||"false"===a?"true"===a?!0:!1:a&&b&&_.isString(a)?"'"+a+"'":a:c},getArgs:function(a){var c=[];a=a||{};var f=a.args||this._get("args");a.override&&a.override.args&&(f=a.override.args);f&&(c=b.getJson(f,null,!1));if(c&&0==c.length&&f&&f.length&&_.isString(f)){if(-1!==f.indexOf(",")){f=f.split(",");for(a=0;a<
f.length;a++){var h=parseFloat(f[a]);isNaN(h)?"true"===f[a]||"false"===f[a]?c.push(b.toBoolean(f[a])):c.push(f[a]):c.push(h)}return c}c=[this._getArg(f)]}!_.isArray(c)&&(c=[]);a=this.getPreviousResult();null!=a&&(_.isArray(a)&&1==a.length?c.push(a[0]):c.push(a));return c||[f]},remove:function(a){this._destroyed=!0;null!=this.parentId&&null==this.parent&&(this.parent=this.scope.getBlockById(this.parentId));if(this.parent&&this.parent.removeBlock)this.parent.removeBlock(this);else if(a=a||this)a.empty&&
a.empty(),delete a.items,a.parent=null,this.items&&this.items.remove(a)},prepareBlockContructorArgs:function(a){a||(a={});a.id||(a.id=this.createUUID());a.items||(a.items=[])},_add:function(a,b,c,h){var f=null;try{b?(this.prepareBlockContructorArgs(b),f=e.createBlock(a,b,null,h)):null==b&&(f=a);(f.scope=this.scope)&&(f=this.scope.registerBlock(f,h));if(f.id===this.id){console.error("adding new block to our self");debugger}f.parent=this;f.parentId=this.id;var n=c||this._getContainer();if(n)if(this[n]||
(this[n]=[]),-1!=this.indexOf(this[n],f))console.error(" have already "+f.id+" in "+n);else{if(this.id==f.id){console.error("tried to add our self to "+n);return}this[n].push(f)}return f}catch(g){logError(g,"_add")}return null},getStore:function(){return this.getScope().getStore()},add:function(a,b,c){a=this._add(a,b,c);return a.getStore().getSync(a.id)},getContext:function(){return this.scope.instance&&this.scope.instance?this.scope.instance:null},resolved:function(){this._deferredObject&&(this._deferredObject.resolve(),
delete this._deferredObject)},_solve:function(a,b){b=b||{highlight:!1};for(var c=[],h=0;h<this.items.length;h++)this.addToEnd(c,this.items[h].solve(a,b));return c},solve:function(a,b){b=b||{highlight:!1};for(var c=[],h=0;h<this.items.length;h++)this.addToEnd(c,this.items[h].solve(a,b));return c},solveMany:function(a,b){!this._lastRunSettings&&b&&(this._lastRunSettings=b);b=this._lastRunSettings||b;this._currentIndex=0;this._return=[];var c=this[this._getContainer()];if(c.length)return c=this.runFrom(c,
0,b),this.onSuccess(this,b),c;this.onSuccess(this,b);return[]},runFrom:function(a,b,c){var h=this;a=a||this.items;var f=function(b){b._deferredObject.then(function(l){b._lastResult=b._lastResult||l;h._currentIndex++;h.runFrom(a,h._currentIndex,c)})};if(a.length)for(;b<a.length;b++){var e=a[b];if(!0===e.deferred){e._deferredObject=new p;this._currentIndex=b;f(e);this.addToEnd(this._return,e.solve(this.scope,c));break}else this.addToEnd(this._return,e.solve(this.scope,c))}else this.onSuccess(this,c);
return this._return},serializeField:function(a){return-1==this.ignoreSerialize.indexOf(a)},onLoad:function(){},activate:function(){},deactivate:function(){},_get:function(a){if(this.override)return a in this.override?this.override[a]:this[a]},onDidRun:function(){this.override&&(this.override.args&&delete this.override.args,delete this.override)},destroy:function(){this.stop(!0);this.reset();this._destroyed=!0},reset:function(){this._lastSettings={};this._loop&&(clearTimeout(this._loop),this._loop=
null);delete this.override;this.override={}},stop:function(){this.reset()}});c.FLAGS=a.BLOCK_FLAGS;c.EMITS=a.BLOCK_CALLBACKMASK;g("xblox-ui")&&m.mixin(c.prototype,n.prototype);c.prototype.onSuccess||(c.prototype.onSuccess=function(){},c.prototype.onRun=function(){},c.prototype.onFailed=function(){});k.chainAfter(c,"stop");k.chainAfter(c,"destroy");k.chainAfter(c,"onDidRun");return c})},"xblox/model/ModelBase":function(){define(["dcl/dcl","xide/utils","xide/types","xide/mixins/EventedMixin"],function(k,
p,m,g){g=k(g.dcl,{declaredClass:"xblox.model.ModelBase",id:null,description:"",parent:null,parentId:null,group:null,order:0,_store:null,outputs:function(){return[]},takes:function(){return[]},needs:function(){return[]},constructor:function(c){for(var e in c)c.hasOwnProperty(e)&&(this[e]=c[e]);this.id||(this.id=this.createUUID());this.utils=p;this.types=m},keys:function(c){var e=[],b;for(b in c)e.push(b);return e},values:function(c){var e=[],b;for(b in c)e.push(c[b]);return e},toArray:function(){return this.map()},
size:function(){return this.toArray().length},createUUID:function(){var c=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()},canEdit:function(){return!0},getFields:function(){return null},isString:function(c){return"string"==typeof c},isNumber:function(c){return"number"==typeof c},isBoolean:function(c){return"boolean"==typeof c},isObject:function(c){return"object"===typeof c},isArray:function(c){return Array.isArray?Array.isArray(c):
!1},getValue:function(c){var e=parseFloat(c);return isNaN(e)?"true"===c||!0===c?!0:"false"===c||!1===c?!1:c:e},isScript:function(c){return this.isString(c)&&(-1!=c.indexOf("return")||-1!=c.indexOf(";")||-1!=c.indexOf("(")||-1!=c.indexOf("+")||-1!=c.indexOf("-")||-1!=c.indexOf("\x3c")||-1!=c.indexOf("*")||-1!=c.indexOf("/")||-1!=c.indexOf("%")||-1!=c.indexOf("\x3d")||-1!=c.indexOf("\x3d\x3d")||-1!=c.indexOf("\x3e")||-1!=c.indexOf("[")||-1!=c.indexOf("{")||-1!=c.indexOf("}"))},replaceAll:function(c,
e,b){return this.isString(b)?b.split(c).join(e):b},isInValidState:function(){return!0},destroy:function(){}});k.chainAfter(g,"destroy");return g})},"nxapp/protocols/Udp":function(){define(["dcl/dcl","nxapp/protocols/ProtocolBase","dojo/node!dgram","xide/utils"],function(k,p,m,g){return k(p,{declaredClass:"nxapp.protocols.Udp",_socket:null,protocolName:"udp",port:null,host:null,onData:function(c){var e=this.delegate;this.isDebug()&&console.log("UDP: got data : "+this.connection.toString(),c);e.onData(this.connection,
c)},makeServer:function(c,e){var b=this;c.bind(e.port,e.ip);b.isDebug()&&console.log("UDP: Make server, bind socket to "+e.ip+" :: "+e.port);c.on("listening",function(){var a=c.address();b.isDebug()&&console.log("\t UDP Server listening on "+a.address+":"+a.port)});c.on("message",function(a,c){b.isDebug()&&console.log("UDP: on server message "+b.connection.toString()+" - "+c.address+":"+c.port+" - "+a);b.onData(a.toString())})},connect:function(){var c=this.options;this.port=this.options.port;this.host=
this.options.host;this.protocol=this.protocolName;this._socket=m.createSocket("udp4");c=g.getJson(c.options);this._setupEventListeners(this._socket,this.delegate);this._socket.writable=!0;this.connection.connected=!0;this.delegate.onConnect2(this.connection);c&&!0===c.server&&this.makeServer(this._socket,c);return this},send:function(c,e){try{var b=this,a=g.bufferFromDecString(c),f=new Buffer(a),n=f.toString();console.log("UDP - "+b.connection.toString()+" Sending command: "+c+" \x3d "+n+" l\x3d "+
n.length);this._socket.send(f,0,f.length,this.port,this.host,function(a,c){if(a)b.delegate.onError(a)})}catch(q){console.error("crash !")}},close:function(){try{this._socket.close()}catch(c){console.error("Error closing udp connection : ",c)}}})})},"nxapp/protocols/Driver":function(){define("dcl/dcl nxapp/utils nxapp/protocols/ProtocolBase dojo/node!path require xide/types nxapp/utils/_console".split(" "),function(k,p,m,g,c,e,b){m=k(m,{declaredClass:"nxapp.protocols.Driver",_socket:null,protocolName:"driver",
instance:null,constructor:function(a){p.mixin(this,a)},onError:function(a,c,n){this.isDebug()&&b.info("Driver-\x3eonError "+a+" id "+c.params.id+" src "+c.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:e.EVENTS.ON_COMMAND_ERROR,result:n.toString()},c),n)}catch(g){b.error("onFinish-Error:",g)}},onConnected:function(){this.isDebug()&&b.log("# driver onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.connection.connected=!0;this.delegate.onConnect2(this.connection)},
onConnect:function(){this._socket.onConnect&&this._socket.onConnect()},onFinish:function(a,c,n){this.isDebug()&&b.info("Driver-\x3eonFinish "+a+" id "+c.params.id+" src "+c.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:e.EVENTS.ON_COMMAND_FINISH,result:n.toString()},c),n)}catch(g){b.error("onFinish-Error:",g)}},onProgress:function(a,c,n){this.isDebug()&&b.info("Driver-\x3eonProgress "+a+" id "+c.params.id+" src "+c.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,
event:e.EVENTS.ON_COMMAND_PROGRESS,result:n.toString()},c),n)}catch(g){b.error("onFinish-Progress:",g)}},onPaused:function(a,c,n){this.isDebug()&&b.info("Driver-\x3eonPaused "+a+" id "+c.params.id+" src "+c.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:e.EVENTS.ON_COMMAND_PAUSED,result:n.toString()},c),n)}catch(g){b.error("onFinish-Paused:",g)}},onStopped:function(a,c,n){this.isDebug()&&b.info("Driver-\x3eonStopped "+a+" id "+c.params.id+" src "+c.params.src);try{this.delegate.onData(this.connection,
p.mixin({cmd:a,event:e.EVENTS.ON_COMMAND_STOPPED,result:n.toString()},c),n)}catch(g){b.error("onFinish-Stopped:",g)}},_connect:function(a,c,e){a=new a(c);a.owner=this;a.options=this.options;a.delegate=this.delegate;a.connection=this.connection;this.modulePath=a.modulePath=e;a.connect||b.error("have no connect");this._socket=a;this._socket.writable=!0;a.connect()},onDeviceDisconnected:function(a){this.delegate.onClose(this.connection,this.options)},onData:function(a,c){this.isDebug()&&b.log("Driver on data : ");
c=c||new Buffer(a);this.delegate.onData(this.connection,a,c);this._socket&&this._socket.onData&&this._socket.onData(this.connection,a,c)},connect:function(){var a=this.options;this.isDebug()&&b.log("connect custom driver");if(!a||!a.driver)return b.error("no driver in options",a),this;try{var f=a[a.driverScope],e=f+"/"+a.driver,e=p.replaceAll("/",g.sep,e);this.isDebug()&&b.log("load driver : "+e+" drivers root : "+f+" from "+g.dirname(e));var q=this;try{c.undef(e),c([e],function(c){if("function"!==
typeof c)q.close(),q.onDeviceDisconnected();else try{q._connect?q._connect(c,a,e):b.error("have no _connect")}catch(h){b.error("error calling connect on "+e+" | Error "+h.message,h)}})}catch(d){b.error("-----error loading driver module at drivers root "+f+" and module "+a.driver+" :: "+d.message,d.stack)}}catch(l){b.error("Error connecting driver "+l.message)}return this},send:function(a,c){a?(this.isDebug()&&b.log("send : ",a),this._socket.write(a,c)):b.error("TCP : invalid command")},close:function(){this._socket&&
this._socket.destroy&&this._socket.destroy()}});k.chainAfter(m,"close");k.chainAfter(m,"destroy");return m})},"nxapp/protocols/SSH":function(){define("dcl/dcl xide/utils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!fs dojo/node!path dojo/node!ssh2 dojo/node!strip-ansi dojo/node!child_process dojo/node!util dojo/node!deferred dojo/node!ansi-to-html dojo/node!ansi_up nxapp/utils/_console".split(" "),function(k,p,m,g,c,e,b,a,f,n,q,d,l,r,h){var t=!1;return k(g,{declaredClass:"nxapp.protocols.SSH",
_socket:null,protocolName:"ssh",instance:null,sshOptions:null,getOptions:function(a,c,d){var l=null;if(d.privateKeyPath){var f=b.resolve(d.privateKeyPath);f?l=e.readFileSync(f).toString():t||this.isDebug()&&h.warn("Sorry, cant resolve file "+d.privateKeyPath)}a={config:!1,host:a,username:d.username,password:d.password,agent:"",agentForward:!1,port:c,proxy:{port:c},ignoreErrors:!1,minimatch:{},debug:t||this.isDebug()?function(a){h.log("SSH _ DEBUG : "+a)}:null,suppressRemoteErrors:!1,callback:function(){}};
l&&(a.privateKey=l);return p.mixin(a,d)},onConnected:function(){t||this.isDebug()&&h.log("# "+this.protocolName+" - Protocol:: onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.connection.connected=!0;this.delegate.onConnect2(this.connection)},onError:function(a,b){this.delegate.onError(this.connection,p.mixin({code:a},b),this.options)},onClose:function(){this.delegate.onClose(this.connection,this.options)},connect:function(){var b=this.options,c=this;if(!b||!b.driver)return t||
c.isDebug()&&h.error("no driver in options",b),this;var d=b.host,l=b.port,b=p.getJson(b.options);!0===b.debug&&(t=!0);var f=this.getOptions(d,l,b),b=function(a){var b={host:a.host,port:a.port,username:a.username,readyTimeout:a.readyTimeout,agentForward:a.agentForward};a.privateKey?(b.privateKey=a.privateKey.trim(),a.passphrase&&(b.passphrase=a.passphrase.trim())):a.password?(b.password=a.password,a.agent&&(b.agent=a.agent)):b.agent=a.agent;return b}(f);this.sshOptions=f;this.host=d;this.port=l;this.protocol=
this.protocolName;t||c.isDebug()&&h.log("SSH-\x3econnecting SSH with");var e=new a;e.on("keyboard-interactive",function(a,b,c,h,d){h.forEach(function(a){-1!==a.prompt.toLowerCase().indexOf("password")&&d([f.password])})});e.on("connect",function(){t||c.isDebug()&&h.log("SSH-\x3eConnection :: connect")});e.on("ready",function(){t||c.isDebug()&&h.log("SSH-\x3eConnection :: ready");var a,b,d;e.once("session",function(l,f){l().once("pty",function(c,l,f){a=f.rows;b=f.cols;d=f.term;c&&c();t&&h.log("SSH-\x3e pty "+
a+" "+b+" "+d)}).once("shell",function(a,b){t||c.isDebug()&&h.log("SSH-\x3eshell")})});c.onConnected()});e.on("error",function(a){t||c.isDebug()&&h.warn("SSH-\x3eConnection - Error :: "+a);a=a.level+":"+a.message;c.onError(a);c.lastError=a});e.on("debug",function(a){t||c.isDebug()&&h.log("SSH-\x3eConnection :: debug :: "+a)});e.on("end",function(){t||c.isDebug()&&h.log("SSH-\x3eConnection :: end");c.onClose()});e.on("close",function(a){if(a)t||c.isDebug()&&h.log("SSH - Connection :: Close, had Error ");
else c.onClose()});e.connect(b);this._socket=e;this._socket.writable=!0;return this},onData:function(a,b){this.isDebug()&&h.log("SSH-\x3eonData",a);this.delegate.onData(this.connection,a||"",b)},onProgress:function(a,b,c){this.isDebug()&&h.info("SSH-\x3eonProgress "+a+" id "+b.params.id+" src "+b.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:m.EVENTS.ON_COMMAND_PROGRESS,result:c.toString()},b),c)}catch(d){h.error("onFinish-Progress:",d)}},onCommandError:function(a,b,c){t||
this.isDebug()&&h.log("SSH-\x3eonCommandError "+a+" id "+b.params.id+" src "+b.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:m.EVENTS.ON_COMMAND_ERROR},b),c)}catch(d){h.error("---",d)}},onFinish:function(a,b,c){t||this.isDebug()&&h.info("SSH-\x3eonFinish "+a+" id "+b.params.id+" src "+b.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:m.EVENTS.ON_COMMAND_FINISH},b),c)}catch(d){h.error("onFinish-Error:",d)}},execCommand:function(a,b){var c=this._socket,
f=this,e=f.sshOptions,n=d(),g=b.params,q=g.id,k=g.wait,x=new l(e.ansiOptions||{}),m=1==e.waitForEOF,p="";if(0===a.length)f.isDebug()&&h.log("SSH-\x3eno more SSH commands, call Defered::resolve");else{var A=a.shift();f.isDebug()&&h.log("SSH-\x3eExecuting :: "+A,b.params);c.exec(A,e,function(c,d){if(c)t||f.isDebug()&&h.log("---error in SSH ",c);else{var l;d.on("data",function(a,c){l=String(a);!0!==e.ansiUp&&1==e.html?l=x.toHtml(l):1==e.ansiUp&&1==e.html&&(l=r.ansi_to_html(l));f.isDebug()&&h.log("SSH DATA : signal \x3d "+
c+" : "+l);if("stderr"!==c)if(m)p+=l,d.lastData=p;else{if(k)f.onProgress(A,b,a);else f.onData(l,a);d.lastData=l}});d.on("end",function(a){t||f.isDebug()&&h.log("SSH-\x3eStream :: EOF, had Error "+(1==d.hadError));l&&"function"===typeof e.callback&&e.callback(l.trim());!0!==d.hadError?(m&&(t||f.isDebug()&&h.error("--------------release data on EOF"),f.onData(d.lastData)),n.resolve(q)):n.reject({id:q,error:d.lastData})});d.on("exit",function(){t||f.isDebug()&&h.log("SSH-\x3eStream :: exit")});d.on("close",
function(c,l){t||f.isDebug()&&h.log("SSH-\x3eStream :: close :: code: "+c+", signal: "+l);127==c&&(d.hadError=!0,n.reject({id:q,error:d.lastData}));e.ignoreErrors||0===c?f.execCommand(a,b):(t||f.isDebug()&&h.error("SSH-\x3eError executing task "+A+" _ code "+c),f.onCommandError(A,b))})}})}return n.promise},send:function(a,b){if(null==a)h.error("SSH: invalid command");else{b=b||{id:p.createUUID()};a=this.toString(a);t||this.isDebug()&&h.log("SSH-\x3esend : "+a);var c=this.execCommand([a],b),d=this;
c.then(function(c){d.onFinish(a,b)},function(c){b.error=c.error;d.onCommandError(a,b)});return c}},close:function(){this._socket&&this._socket.end()}})})},"nxapp/protocols/Serial":function(){define("dcl/dcl xide/utils xide/utils/StringUtils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!path dojo/node!child_process dojo/node!util dojo/node!deferred nxapp/utils/_console xdojo/has dojo/has!serialport?dojo/node!serialport".split(" "),function(k,p,m,g,c,e,b,a,f,n,q,d,l){var r=
!1;return k(c,{declaredClass:"nxapp.protocols.Serial",_socket:null,protocolName:"serial",instance:null,client:null,sshOptions:null,getOptions:function(a,b,c,d){return p.mixin({baudrate:9600,parity:"none",rtscts:!1,xon:!1,xoff:!1,xany:!1,hupcl:!0,cts:!1,dtr:!0,dts:!1,brk:!1,rts:!1,databits:8,stopbits:1,bufferSize:65536,parser:l.parsers.raw},c)},onConnected:function(){this.connection.connected=!0;this.delegate.onConnect2(this.connection)},onError:function(a,b){this.delegate.onError(this.connection,
p.mixin({code:a},b),this.options)},onClose:function(){this.delegate.onClose(this.connection,this.options)},connect:function(){try{var a=this.options;if(!d("serialport"))return this.onError("have serial port");if(!a||!a.driver)return this;var b=this,c=a.host,f=a.port,e=p.getJson(a.options||{});!0===e.debug&&(r=!0);var n=this.getOptions(c,f,e,(a.responseSettings||{}).delimiter);this.serialOptions=n;this.protocol=this.protocolName;var g=new l(c,n);this.client=g;g.on("error",function(a){b.onError(a.toString(),
a)});try{g.on("open",function(a){if(a){var h=a.level+":"+a.message;b.onError(h);b.lastError=h;b.isDebug()&&q.warn("Serial-\x3eConnection - Error :: "+c+":"+a)}else b.onConnected(),g.on("data",function(a){b.isDebug()&&q.log("Serial-\x3eonData "+a.toString());b.onData(a.toString(),a)})})}catch(k){this.isDebug()&&q.error("Serial-\x3econnect error :: code: ",k)}g.on("close",function(a){try{b.isDebug()&&q.log("Serial-\x3eclose :: code: ",a),b.onClose(),g.close()}catch(c){b.isDebug()&&q.error("Serial-\x3eclose :: code: ",
c)}});this._socket={};this._socket.writable=!0;return this}catch(m){return this.isDebug()&&q.error("error connection serial ",m),b.onError(m.message),q.trace(),this}},onData:function(a,b){this.delegate.onData(this.connection,a,b)},onCommandError:function(a,b){r||this.isDebug()&&q.log("SERIAL-\x3eCommandError "+a+" id "+b.id+" src "+b.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:g.EVENTS.ON_COMMAND_ERROR},b))}catch(c){q.error("---",c)}},onFinish:function(a,b){r||this.isDebug()&&
q.log("SERIAL-\x3eonFinish "+a+" id "+b.id+" src "+b.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:g.EVENTS.ON_COMMAND_FINISH},b))}catch(c){q.error("onFinish-Error:",c)}},send:function(a,b){if(null==a)q.error("SERIAL invalid command");else{b||p.createUUID();var c=p.bufferFromDecString(a),c=new Buffer(c),d=c.toString();this.isDebug()&&q.log("Serial - Sending command: "+a+" \x3d "+d+" l\x3d "+d.length);this.client.write(c)}},close:function(){this.client&&this.client.close()}})})},
"xide/utils/StringUtils":function(){define(["dojo/_base/lang","xide/utils","xide/types","dojo/json","xide/lodash"],function(k,p,m,g,c){function e(b){var c="";b=parseInt(b,16);65535>=b?c+=String.fromCharCode(b):1114111>=b?(b-=65536,c+=String.fromCharCode(55296|b>>10)+String.fromCharCode(56320|b&1023)):c+="hex2Char error: Code point out of range: "+a(b);return c}function b(b){var c="";65535>=b?c+=String.fromCharCode(b):1114111>=b?(b-=65536,c+=String.fromCharCode(55296|b>>10)+String.fromCharCode(56320|
b&1023)):c+="dec2char error: Code point out of range: "+a(b);return c}function a(a){return(a+0).toString(16).toUpperCase()}function f(a){return E[a>>4&15]+E[a&15]}function n(a){return a=a.replace(/0x([A-Fa-f0-9]{1,4})(\s)?/g,function(a,b){e(b);return e(b)})}function q(a){a=a.replace(/[Uu]\+10([A-Fa-f0-9]{4})/g,function(a,b){return e("10"+b)});return a=a.replace(/[Uu]\+([A-Fa-f0-9]{1,5})/g,function(a,b){return e(b)})}function d(a){return a=a.replace(/&#x([A-Fa-f0-9]{1,6});/g,function(a,b){return e(b)})}
function l(a){return a=a.replace(/&#([0-9]{1,7});/g,function(a,c){return b(c)})}function r(a){return a=a.replace(/0x([A-Fa-f0-9]{1,6})/g,function(a,b){return e(b)})}function h(a,b){b?(a=a.replace(/\\([A-Fa-f0-9]{1,6})(\s)?/g,function(a,b){return e(b)}),a=a.replace(/\\/g,"")):a=a.replace(/\\([A-Fa-f0-9]{2,6})(\s)?/g,function(a,b){return e(b)});return a}function t(a,b){a=a.replace(/\\u\{([A-Fa-f0-9]{1,})\}/g,function(a,b){return e(b)});a=a.replace(/\\U([A-Fa-f0-9]{8})/g,function(a,b){return e(b)});
a=a.replace(/\\u([A-Fa-f0-9]{4})/g,function(a,b){return e(b)});b&&(a=a.replace(/\\b/g,"\b"),a=a.replace(/\\t/g,"\t"),a=a.replace(/\\n/g,"\n"),a=a.replace(/\\v/g,"\v"),a=a.replace(/\\f/g,"\f"),a=a.replace(/\\r/g,"\r"),a=a.replace(/\\\'/g,"'"),a=a.replace(/\\\"/g,'"'),a=a.replace(/\\\\/g,"\\"));return a}function y(c){return c=c.replace(/((%[A-Fa-f0-9]{2})+)/g,function(c,h){for(var d="",l=0,f=0,e=h.split("%"),t=1;t<e.length;t++){var n=parseInt(e[t],16);switch(l){case 0:0<=n&&127>=n?d+=b(n):192<=n&&223>=
n?(l=1,f=n&31):224<=n&&239>=n?(l=2,f=n&15):240<=n&&247>=n?(l=3,f=n&7):d+="convertpEsc2Char: error "+a(n)+"! ";break;case 1:if(128>n||191<n)d+="convertpEsc2Char: error "+a(n)+"! ";l--;d+=b(f<<6|n-128);f=0;break;case 2:case 3:if(128>n||191<n)d+="convertpEsc2Char: error "+a(n)+"! ";f=f<<6|n-128;l--}}return d})}function u(a){return a=a.replace(/&([A-Za-z0-9]+);/g,function(a,b){return b in entities?entities[b]:a})}function v(a,c){"hex"==c?a=a.replace(/(\b[A-Fa-f0-9]{2,6}\b)/g,function(a,b){return e(b)}):
"dec"==c?a=a.replace(/(\b[0-9]+\b)/g,function(a,c){return b(c)}):"utf8"==c?a=a.replace(/(( [A-Fa-f0-9]{2})+)/g,function(a,b){return z(b)}):"utf16"==c&&(a=a.replace(/(( [A-Fa-f0-9]{1,6})+)/g,function(a,b){return C(b)}));return a}function z(c){var h="",d=0,l=0;c=c.replace(/^\s+/,"");c=c.replace(/\s+$/,"");if(0==c.length)return"";c=c.replace(/\s+/g," ");c=c.split(" ");for(var f=0;f<c.length;f++){var e=parseInt(c[f],16);switch(d){case 0:0<=e&&127>=e?h+=b(e):192<=e&&223>=e?(d=1,l=e&31):224<=e&&239>=e?
(d=2,l=e&15):240<=e&&247>=e?(d=3,l=e&7):h+="convertUTF82Char: error1 "+a(e)+"! ";break;case 1:if(128>e||191<e)h+="convertUTF82Char: error2 "+a(e)+"! ";d--;h+=b(l<<6|e-128);l=0;break;case 2:case 3:if(128>e||191<e)h+="convertUTF82Char: error3 "+a(e)+"! ";l=l<<6|e-128;d--}}return h.replace(/ $/,"")}function C(c){var h=0,d="";c=c.replace(/^\s+/,"");c=c.replace(/\s+$/,"");if(0==c.length)return null;c=c.replace(/\s+/g," ");c=c.split(" ");for(var l=0;l<c.length;l++){var f=parseInt(c[l],16);if(0>f||65535<
f)d+="!Error in convertUTF162Char: unexpected value, b\x3d"+a(f)+"!";if(0!=h)if(56320<=f&&57343>=f){d+=b(65536+(h-55296<<10)+(f-56320));h=0;continue}else d+="Error in convertUTF162Char: low surrogate expected, b\x3d"+a(f)+"!",h=0;55296<=f&&56319>=f?h=f:d+=b(f)}return d}function B(a,b){var c=[],h=[];null==b&&(b=function(a,b){return c[0]===b?"[Circular ~]":"[Circular ~."+h.slice(0,c.indexOf(b)).join(".")+"]"});return function(d,l){if(0<c.length){var f=c.indexOf(this);~f?c.splice(f+1):c.push(this);~f?
h.splice(f,Infinity,d):h.push(d);~c.indexOf(l)&&(l=b.call(this,d,l))}else c.push(l);return null==a?l:a.call(this,d,l)}}var E="0123456789ABCDEF".split("");p.dec2hex4=function(a){return E[a>>12&15]+E[a>>8&15]+E[a>>4&15]+E[a&15]};p.dec2hex=a;p.dec2char=b;p.dec2hex2=f;p.convertUTF82Char=z;p.convertUTF162Char=C;p.convertUnicode2Char=q;p.convertCharStr2pEsc=function(b){var c="",h;h=0;for(var d="",l=0;l<b.length;l++){var e=b.charCodeAt(l);if(0>e||65535<e)d+="Error in convertChar2CP: byte out of range "+
a(e)+"!";if(0!=h)if(56320<=e&&57343>=e){d+=a(65536+(h-55296<<10)+(e-56320))+" ";h=0;continue}else d+="Error in convertChar2CP: surrogate out of range "+a(h)+"!",h=0;55296<=e&&56319>=e?h=e:d+=a(e)+" "}h=d.substring(0,d.length-1);if(0==b.length)return"";b=h.split(" ");for(h=0;h<b.length;h++)d=parseInt(b[h],16),c=32==d?c+"%20":65<=d&&90>=d?c+String.fromCharCode(d):97<=d&&122>=d?c+String.fromCharCode(d):48<=d&&57>=d?c+String.fromCharCode(d):45==d||46==d||95==d||126==d?c+String.fromCharCode(d):127>=d?
c+("%"+f(d)):2047>=d?c+("%"+f(192|d>>6&31)+"%"+f(128|d&63)):65535>=d?c+("%"+f(224|d>>12&15)+"%"+f(128|d>>6&63)+"%"+f(128|d&63)):1114111>=d?c+("%"+f(240|d>>18&7)+"%"+f(128|d>>12&63)+"%"+f(128|d>>6&63)+"%"+f(128|d&63)):c+("!Error "+a(d)+"!");return c};p.convertAllEscapes=function(a,b){a=q(a);a=n(a);a=r(a);a=d(a);a=l(a);a=t(a,!1);a=h(a,!1);a=y(a);a=u(a);return a=v(a,b)};var G="0123456789abcdef".split("");p.round=function(a,b,c){if("number"!==typeof a||isNaN(a)||Infinity===a||-Infinity===a)return"";b=
"undefined"===typeof b?3:parseInt(b,10)||0;var h=Math.pow(10,b);a=(Math.round(a*h)/h).toFixed(b);c||(a=""+ +a);return a};p.replaceHex=function(a){return c.isString(a)?a.replace(/x([0-9A-Fa-f]{2})/gmi,function(a,b){return String.fromCharCode(parseInt(b,16))}):a};var F=function(a,b){for(a=a.toString(16).toUpperCase();a.length<b;)a="0"+a;return a};p.stringToHex=function(a){for(var b="",c=0,h=a.length,d;c<h;c+=1)d=a.charCodeAt(c),b+=F(d.toString(16),2)+" ";return b};p.stringToBufferStr=function(a){for(var b=
0,c=a.length,h,d=[];b<c;b+=1)h=a.charCodeAt(b),d.push(h);return d.join(",")};p.stringToBuffer=function(a){for(var b=0,c=a.length,h,d=[];b<c;b+=1)h=a.charCodeAt(b),d.push(h);return d};p.bufferToHexString=function(a){a=-1!==a.indexOf(",")?a.split(","):[a];for(var b=[],c=0;c<a.length;c++)b.push(p.dec2hex2(a[c]));return b.join(" ")};p.bufferFromDecString=function(a){a=-1!==a.indexOf(",")?a.split(","):[a];for(var b=0;b<a.length;b++)a[b]=parseInt(a[b]);return a};p.stringFromDecString=function(a){a=p.bufferFromDecString(a);
for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c],16);return b};p.stringToHex2=function(a){for(var b="",c=0,h=a.length,d;c<h;c+=1)d=a.charCodeAt(c),b+=F(d.toString(16),2)+" ";return b};p.hexToString=function(a){a=a.split(" ");for(var b="",c=0,h=a.length,d;c<h;c+=1)d=String.fromCharCode(parseInt(a[c],16)),b+=d;return b};p.prettyHex=function(a){var b=Math.ceil(a.length/16),c=a.length%16||16,h=a.length.toString(16).length;6>h&&(h=6);for(var d="Offset";d.length<h;)d+=" ";var d="\u001b[36m"+
d+"  ",l;for(l=0;16>l;l++)d+=" "+F(l,2);d+="\u001b[0m\n";a.length&&(d+="\n");var f=0,e,t;for(l=0;l<b;l++){d+="\u001b[36m"+F(f,h)+"\u001b[0m  ";e=l===b-1?c:16;t=16-e;var n;for(n=0;n<e;n++)d+=" "+F(a[f],2),f++;for(n=0;n<t;n++)d+="   ";f-=e;d+="   ";for(n=0;n<e;n++)t=a[f],d+=31<t&&127>t||159<t?String.fromCharCode(t):".",f++;d+="\n"}return d};p.hexEncode=function(a,b){var c,d,h="";for(d=0;d<a.length;d++)c=a.charCodeAt(d).toString(16),h+=((null!==b?b:"000")+c).slice(-4);return h};p.markHex=function(a,
b,c,d){b=b||"";c=c||"";var h=""+a;a=/[^\x20-\x7E]/gim;a.exec(h);h.match(a);h.replace(a,function(a,d){var l=p.hexEncode(a,"$");2==l.length&&(l=l.replace("$","$0"));l=l.toUpperCase();h=h.replace(a,b+l+c)});return h};p.to_hex=function(a){for(var b="",c=!0,d=32;0<d;){var d=d-4,h=a>>d&15;c&&0==h||(c=!1,b+=G[h])}return"0x"+(""==b?"0":b)};p.stringify=function(a){return JSON.stringify(a,B(),2)};p.humanFileSize=function(a,b){var c=b?1E3:1024;if(Math.abs(a)<c)return a+" B";var d=b?"kB MB GB TB PB EB ZB YB".split(" "):
"KiB MiB GiB TiB PiB EiB ZiB YiB".split(" "),h=-1;do a/=c,++h;while(Math.abs(a)>=c&&h<d.length-1);return a.toFixed(1)+" "+d[h]};"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return 0===this.indexOf(a)});"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.substring(this.length-a.length,this.length)===a});p.isNativeEvent=function(a){var b={onclick:null,ondblclick:null,onmousedown:null,onmouseup:null,onmouseover:null,
onmousemove:null,onmouseout:null,onkeypress:null,onkeydown:null,onkeyup:null,onfocus:null,onblur:null,onchange:null};if(a in b)return!0;b={click:null,dblclick:null,mousedown:null,mouseup:null,mouseover:null,mousemove:null,mouseout:null,keypress:null,keydown:null,keyup:null,focus:null,blur:null,change:null};return a in b};p.isSystemEvent=function(a){for(var b in m.EVENTS)if(m.EVENTS[b]===a)return!0;return!1};p.contains=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1};p.getObjectKeyByValue=
function(a,b){if(a&&b)for(var c in a)if(a.hasOwnProperty(c)&&a[c]===b)return c;return null};p.removeURLParameter=function(a,b){var c=a.split("?");if(2<=c.length){for(var d=encodeURIComponent(b)+"\x3d",h=c[1].split(/[&;]/g),l=h.length;0<l--;)-1!==h[l].lastIndexOf(d,0)&&h.splice(l,1);a=c[0]+"?"+h.join("\x26")}return a};p.replaceUrlParam=function(a,b,c){if(-1==a.indexOf(b))return a+=(0<a.indexOf("?")?"\x26":"?")+b+"\x3d"+c;var d=a.replace(new RegExp("("+b+"\x3d).*?(\x26|$)"),"$1"+c+"$2");d==a&&(d=d+
(0<d.indexOf("?")?"\x26":"?")+b+"\x3d"+c);return d};p.buildPath=function(a,b,c){var d=""+a,d=p.replaceAll("/","",a);a=(""+b).replace("./","/").replace(/^\/|\/$/g,"");d=d+"://"+a;return!0===c?encodeURIComponent(d):d};p.isImage=function(a){return null!=a.toLowerCase().match(/\.(jpeg|jpg|gif|png)$/)};p.hasFlag3=function(a,b){return 1<<b&a?!0:!1};p.hasFlag=function(a,b){return 1<<b&a?!0:!1};p.disableFlag=function(a,b){return a&~(1<<b)};p.cleanUrl=function(a){a&&(a=a.replace("//","/"),a=a.replace("./",
"/"),a=a.replace("http:/","http://"),a=a.replace("./","/"),a=a.replace("////","/"),a=a.replace("///","/"));return a};p.getJson=function(a,b,d){try{return c.isString(a)?g.parse(a,!1):!0===b?null:a}catch(h){!1!==d&&console.error("error parsing json data "+a+" error \x3d "+h)}return null};p.fromJson=function(a){if(!c.isString(a))return a;var b=null,d=!1;try{b=eval("("+a+")",{})}catch(h){d=!0}if(d){a=a.substring(a.indexOf("{"),a.lastIndexOf("}")+1);try{b=eval("("+a+")",{})}catch(l){throw Error(a);}}return b};
p.replaceAll=function(a,b,c){return c?c.split(a).join(b):""};p.isValidString=function(a){return null!=a&&null!=a.length&&0<a.length&&"undefined"!=a};p.substituteString=function(a,b){return a.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(a,c){return b[c]})};p.findOcurrences=function(a,b){var c=p.escapeRegExp(b.begin),d=p.escapeRegExp(b.end);return a.match(new RegExp(c+"([^"+d+"]*)"+d,"g"))};p.escapeRegExp=function(a){for(var b="[ ] ( ) { } * + . | ||".split(" "),c=0;c<b.length;c++)a=a.replace(b[c],
"\\"+b[c]);return a};p.multipleReplace=function(a,b){var c=[],d;for(d in b)c[c.length]=d;return a.replace(new RegExp(c.join("\\b|\\b"),"g"),function(a){return b[a]||b["\\"+a]})};p.replace=function(a,b,d,h){if(!a)return"";if(d&&c.isObject(d)||c.isArray(d)){if(h){b=p.findOcurrences(a,h);var l=p.replaceAll;if(b)for(var f=0,e=b.length;f<e;f++){var t=b[f],n=l(h.begin,"",t),n=l(h.end,"",n);a=l(t,d[n],a)}}else return p.multipleReplace(a,d);return a}return p.replaceAll(b,d,a)};p.capitalize=function(a){return a.substring(0,
1).toUpperCase()+a.substring(1)};p.vsprintf=function(a,b){return p.sprintf.apply(this,[a].concat(b))};p.sprintf=function(){var a=arguments,b=0,c=function(a,b,c,d){c||(c=" ");b=a.length>=b?"":Array(1+b-a.length>>>0).join(c);return d?a+b:b+a},d=function(a,b,d,h,l,f){var e=h-a.length;0<e&&(a=d||!l?c(a,h,f,d):a.slice(0,b.length)+c("",e,"0",!0)+a.slice(b.length));return a},h=function(a,b,h,l,f,e,t){a>>>=0;h=h&&a&&{2:"0b",8:"0",16:"0x"}[b]||"";a=h+c(a.toString(b),e||0,"0",!1);return d(a,h,l,f,t)};return a[b++].replace(/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,
function(l,f,e,t,n,r,g){var q,u;if("%%"===l)return"%";var y=!1;u="";var k=n=!1;q=" ";for(var m=e.length,p=0;e&&p<m;p++)switch(e.charAt(p)){case " ":u=" ";break;case "+":u="+";break;case "-":y=!0;break;case "'":q=e.charAt(p+1);break;case "0":n=!0;break;case "#":k=!0}t=t?"*"===t?+a[b++]:"*"==t.charAt(0)?+a[t.slice(1,-1)]:+t:0;0>t&&(t=-t,y=!0);if(!isFinite(t))throw Error("sprintf: (minimum-)width must be finite");r=r?"*"===r?+a[b++]:"*"==r.charAt(0)?+a[r.slice(1,-1)]:+r:-1<"fFeE".indexOf(g)?6:"d"===
g?0:void 0;f=f?a[f.slice(0,-1)]:a[b++];switch(g){case "s":return g=String(f),null!=r&&(g=g.slice(0,r)),d(g,"",y,t,n,q);case "c":return g=String.fromCharCode(+f),null!=r&&(g=g.slice(0,r)),d(g,"",y,t,n,void 0);case "b":return h(f,2,k,y,t,r,n);case "o":return h(f,8,k,y,t,r,n);case "x":return h(f,16,k,y,t,r,n);case "X":return h(f,16,k,y,t,r,n).toUpperCase();case "u":return h(f,10,k,y,t,r,n);case "i":case "d":return q=+f||0,q=Math.round(q-q%1),l=0>q?"-":u,f=l+c(String(Math.abs(q)),r,"0",!1),d(f,l,y,t,
n);case "e":case "E":case "f":case "F":case "g":case "G":return q=+f,l=0>q?"-":u,u=["toExponential","toFixed","toPrecision"]["efg".indexOf(g.toLowerCase())],g=["toString","toUpperCase"]["eEfFgG".indexOf(g)%2],f=l+Math.abs(q)[u](r),d(f,l,y,t,n)[g]();default:return l}})};p.cleanString=function(a){return a?a=a.replace(/[\r]/g,"").replace(/[\b]/g,"").replace(/[\f]/g,"").replace(/[\n]/g,"").replace(/\\/g,""):null};p.normalizePath=function(a){if(!a)return null;a=p.cleanString(a);a=a.replace("./","");a=
a.replace("/.","");return a=a.replace(/([^:]\/)\/+/g,"$1")};m.PATH_PARTS={DIRNAME:1,BASENAME:2,EXTENSION:4,FILENAME:8,PATHINFO_ALL:0};p.basename=function(a,b){var c=a,d=c.charAt(c.length-1);if("/"===d||"\\"===d)c=c.slice(0,-1);c=c.replace(/^.*[\/\\]/g,"");"string"===typeof b&&c.substr(c.length-b.length)==b&&(c=c.substr(0,c.length-b.length));return c};p.pathinfo=function(a,b){var c="",d="",h="",l=0,f={},e=0,t=0,n=e=!1,r=!1;if(!a)return!1;b||(b="PATHINFO_ALL");var g={PATHINFO_DIRNAME:1,PATHINFO_BASENAME:2,
PATHINFO_EXTENSION:4,PATHINFO_FILENAME:8,PATHINFO_ALL:0};for(h in g)g.hasOwnProperty(h)&&(g.PATHINFO_ALL|=g[h]);if("number"!==typeof b){b=[].concat(b);for(t=0;t<b.length;t++)g[b[t]]&&(l|=g[b[t]]);b=l}h=function(a){a+="";var b=a.lastIndexOf(".")+1;return b?b!==a.length?a.substr(b):"":!1};b&g.PATHINFO_DIRNAME&&(l=a.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,""),f.dirname=l===a?".":l);b&g.PATHINFO_BASENAME&&(!1===e&&(e=p.basename(a)),f.basename=e);b&g.PATHINFO_EXTENSION&&(!1===e&&(e=p.basename(a)),!1===
n&&(n=h(e)),!1!==n&&(f.extension=n));b&g.PATHINFO_FILENAME&&(!1===e&&(e=p.basename(a)),!1===n&&(n=h(e)),!1===r&&(r=e.slice(0,e.length-(n?n.length+1:!1===n?0:1))),f.filename=r);e=0;for(c in f)f.hasOwnProperty(c)&&(e++,d=c);return 1===e?f[d]:f};p.parse_url=function(a,b){var c;c="source scheme authority userInfo user pass host port relative path directory file query fragment".split(" ");for(var d=this.php_js&&this.php_js.ini||{},h=d["phpjs.parse_url.mode"]&&d["phpjs.parse_url.mode"].local_value||"php",
l={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},
l=l[h].exec(a),f={},e=14;e--;)l[e]&&(f[c[e]]=l[e]);if(b)return f[b.replace("PHP_URL_","").toLowerCase()];if("php"!==h){var t=d["phpjs.parse_url.queryKey"]&&d["phpjs.parse_url.queryKey"].local_value||"queryKey",l=/(?:^|&)([^&=]*)=?([^&]*)/g;f[t]={};c=f[c[12]]||"";c.replace(l,function(a,b,c){b&&(f[t][b]=c)})}delete f.source;return f};p.getMimeTable=function(){return{}};p.getMimeTable2=function(){return{mid:"fa-file-audio-o",txt:"fa-file-text-o",sql:"fa-cube",js:"fa-cube",gif:"fa-file-picture-o",jpg:"fa-file-picture-o",
html:"fa-cube",htm:"fa-cube",rar:"fa-file-zip-o",gz:"fa-file-zip-o",tgz:"fa-file-zip-o",z:"fa-file-zip-o",ra:"fa-file-movie-o",ram:"fa-file-movie-o",rm:"fa-file-movie-o",pl:"source_pl.png",zip:"fa-file-zip-o",wav:"fa-file-audio-o",php:"fa-cube",php3:"fa-cube",phtml:"fa-cube",exe:"fa-file-o",bmp:"fa-file-picture-o",png:"fa-file-picture-o",css:"fa-cube",mp3:"fa-file-audio-o",m4a:"fa-file-audio-o",aac:"fa-file-audio-o",xls:"fa-file-excel-o",xlsx:"fa-file-excel-o",ods:"fa-file-excel-o",sxc:"fa-file-excel-o",
csv:"fa-file-excel-o",tsv:"fa-file-excel-o",doc:"fa-file-word-o",docx:"fa-file-word-o",odt:"fa-file-word-o",swx:"fa-file-word-o",rtf:"fa-file-word-o",ppt:"fa-file-powerpoint-o",pps:"fa-file-powerpoint-o",odp:"fa-file-powerpoint-o",sxi:"fa-file-powerpoint-o",pdf:"fa-file-pdf-o",mov:"fa-file-movie-o",avi:"fa-file-movie-o",mpg:"fa-file-movie-o",mpeg:"fa-file-movie-o",mp4:"fa-file-movie-o",m4v:"fa-file-movie-o",ogv:"fa-file-movie-o",webm:"fa-file-movie-o",wmv:"fa-file-movie-o",swf:"fa-file-movie-o",flv:"fa-file-movie-o",
tiff:"fa-file-picture-o",tif:"fa-file-picture-o",svg:"fa-file-picture-o",psd:"fa-file-picture-o",ers:"horo.png"}};p.getIconTable=function(){return{}};p.urlDecode=function(a,b){if(!a||!a.length)return{};for(var c={},d=a.split("\x26"),h,l,f=0,e=d.length;f<e;f++)h=d[f].split("\x3d"),l=decodeURIComponent(h[0]),h=decodeURIComponent(h[1]),null!=h&&"true"===h?h=!0:"false"===h&&(h=!1),!0!==b?"undefined"==typeof c[l]?c[l]=h:("string"==typeof c[l]&&(c[l]=[c[l]]),c[l].push(h)):c[l]=h;return c};p.getUrlArgs=
function(a){var b={};if(a&&(-1!=a.indexOf("?")||-1!=a.indexOf("\x26"))){a=(a.substr(a.indexOf("?")+1)||location.search.substring(1)).split("\x26");for(var c=0;c<a.length;c++){var d=a[c].indexOf("\x3d"),h=a[c].substring(0,d),d=a[c].substring(d+1),d=decodeURIComponent(d);b[h]=d}}return b};p.urlArgs=function(a){a=p.getUrlArgs(a);var b={},c;for(c in a){var d=a[c],h=p.findOcurrences(d,{begin:"|",end:"|"}),l=null;if(h&&h.length)for(var d=d.replace(h[0],""),h=h[0].substr(1,h[0].length-2).split(","),l={},
f=0;f<h.length;f++){var e=h[f].split(":");l[e[0]]=e[1]}d&&d.length&&(b[c]={value:d,options:l})}return b};p.getIcon=function(a){if(!a)return"txt2.png";if(a=p.getFileExtension(a)){var b=p.getMimeTable();if(null!=b[a])return b[a]}return"txt2.png"};p.getIconClass=function(a){if(!a)return"fa-file-o";a=p.getFileExtension(a);if(m.customMimeIcons[a])return m.customMimeIcons[a];if(a){var b=p.getMimeTable2();if(null!=b[a])return b[a]}return"fa-file-o"};p.getFileExtension=function(a){if(!a||""==a)return"";a=
p.getBaseName(a).split(".");return 1<a.length?a[a.length-1].toLowerCase():""};p.createUUID=function(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()};p.getBaseName=function(a){if(null==a)return null;var b="/";-1!==a.indexOf("\\")&&(b="\\");return a.substr(a.lastIndexOf(b)+1,a.length)};p.basename=function(a,b){var c=a,d=c.charAt(c.length-1);if("/"===d||"\\"===d)c=c.slice(0,-1);c=c.replace(/^.*[\/\\]/g,"");"string"===
typeof b&&c.substr(c.length-b.length)===b&&(c=c.substr(0,c.length-b.length));return c};p.pathinfo=function(a,b){var c=p.basename,d="",h="",l="",f=0,e={},t=0,n=0,r=t=!1,g=!1;if(!a)return!1;b||(b="PATHINFO_ALL");var q={PATHINFO_DIRNAME:1,PATHINFO_BASENAME:2,PATHINFO_EXTENSION:4,PATHINFO_FILENAME:8,PATHINFO_ALL:0};for(l in q)q.hasOwnProperty(l)&&(q.PATHINFO_ALL|=q[l]);if("number"!==typeof b){b=[].concat(b);for(n=0;n<b.length;n++)q[b[n]]&&(f|=q[b[n]]);b=f}l=function(a){a+="";var b=a.lastIndexOf(".")+
1;return b?b!==a.length?a.substr(b):"":!1};b&q.PATHINFO_DIRNAME&&(f=a.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,""),e.dirname=f===a?".":f);b&q.PATHINFO_BASENAME&&(!1===t&&(t=c(a)),e.basename=t);b&q.PATHINFO_EXTENSION&&(!1===t&&(t=c(a)),!1===r&&(r=l(t)),!1!==r&&(e.extension=r));b&q.PATHINFO_FILENAME&&(!1===t&&(t=c(a)),!1===r&&(r=l(t)),!1===g&&(g=t.slice(0,t.length-(r?r.length+1:!1===r?0:1))),e.filename=g);t=0;for(d in e)e.hasOwnProperty(d)&&(t++,h=d);return 1===t?e[h]:e};p.strip_tags=function(a,b){b=
(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return a.replace(/\x3c!--[\s\S]*?--\x3e|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(a,c){return-1<b.indexOf("\x3c"+c.toLowerCase()+"\x3e")?a:""})};return p})},"nxapp/protocols/MQTT":function(){define("dcl/dcl xdojo/declare xide/utils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!path dojo/node!child_process dojo/node!util dojo/node!deferred nxapp/utils/_console dojo/node!mqtt".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d){var l=!0;return k(c,{declaredClass:"nxapp.protocols.MQTT",_socket:null,protocolName:"mqtt",instance:null,subscriptions:null,mqttClient:null,getOptions:function(a,b,c){return m.mixin({clean:!1,clientId:c.clientId||a+":"+b,port:b},c)},onConnected:function(){l&&q.log("# "+this.protocolName+" - Protocol:: onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.connection.connected=!0;this.delegate.onConnect2(this.connection)},onError:function(a,
b){this.delegate.onError(this.connection,m.mixin({code:a},b),this.options)},onClose:function(a){this.delegate.onClose(this.connection,a)},connect:function(){var a=this.options;if(!a||!a.driver)return l||this.isDebug()&&q.error("no driver in options",a),this;var b=this,c=a.host,f=a.port,a=m.getJson(a.options||{});!0===a.debug&&(l=!0);a=this.getOptions(c,f,a);this.host=c;this.port=f;this.protocol=this.protocolName;l||this.isDebug()&&q.log("MQTT-\x3econnecting to "+c+" with",a);var e=d.connect(c,a);
this.mqttClient=e;try{e.on("connect",function(a){b.onConnected()})}catch(n){l||this.isDebug()&&q.error("MQTT-\x3econnect error :: code: ",n)}e.on("close",function(a){l||b.isDebug()&&q.log("MQTT-\x3eclose :: code: ",a);b.onClose();e.end()});this._socket={};this._socket.writable=!0;return this},onData:function(a,b){this.delegate.onData(this.connection,a,b)},onCommandError:function(a,b){l||this.isDebug()&&q.log("MQTT-\x3eCommandError "+a+" id "+b.id+" src "+b.src);try{this.delegate.onData(this.connection,
m.mixin({cmd:a,event:g.EVENTS.ON_COMMAND_ERROR},b))}catch(c){q.error("---",c)}},onFinish:function(a,b,c){l||this.isDebug()&&q.log("MQTT onFinish "+a+" id "+b.id+" src "+b.src);try{this.delegate.onData(this.connection,m.mixin({cmd:a,event:g.EVENTS.ON_COMMAND_FINISH},b),c)}catch(d){q.error("onFinish-Error:",d)}},addSubscription:function(a,b,c){!this.subscriptions&&(this.subscriptions={});if(a){var d=this,l=""+a;if(!this.subscriptions[l]){b={qos:parseInt(b.qos)||0};this.mqttClient.subscribe(l,b);this.isDebug()&&
q.log("add subscription : "+a+" for ",f.inspect(c,{depth:null,colors:!0}));var e=this.subscriptions[l]={id:c.params.id,src:c.params.src,topic:l};this.mqttClient.on("message",function(a,b){if(a===l){var c=m.getJson(b.toString());if(_.isArray(c))d.onData(m.mixin({payload:c,topic:a},e));else if(_.isObject(c))c.topic||(c.topic=a),d.onData(m.mixin(c,e));else if(_.isString(c)||_.isNumber(c))d.onData(m.mixin({payload:c,topic:a},e));else q.error("-unknown "+a)}})}}else q.error("invalid topic")},unSubscribeTopic:function(a,
b,c){a=m.getJson(a);(a=""+a.topic)&&this.unsubscribe(a)},subscribeTopic:function(a,b,c){a=m.getJson(a);b=m.getJson(b);c=""+a.topic;delete a.topic;this.addSubscription(c,a,b)},publishTopic:function(a,b,c){try{a=m.getJson(a);m.getJson(b);var d=""+a.topic,f=a.qos,e=a.retain;delete a.topic;delete a.qos;delete a.retain;var n=a.payload||a;if(_.isObject(n))try{n=JSON.stringify(n)}catch(g){q.error("error generating payload",g);return}this.mqttClient.publish(d,n,{qos:f,retain:e})}catch(k){l||this.isDebug()&&
q.log("---error ",k)}},send:function(a,b){},unsubscribe:function(a){a&&this.mqttClient&&this.subscriptions&&this.subscriptions[a]&&(this.mqttClient.unsubscribe(a),delete this.subscriptions[a])},close:function(){this.mqttClient&&(_.each(this.subscriptions,this.unsubscribe,this),this.mqttClient.end(),this.mqttClient=null)}})})},"xide/data/_Base":function(){define("dojo/_base/declare dstore/Memory dstore/Tree dstore/QueryResults xide/mixins/EventedMixin xide/encoding/MD5 xdojo/has".split(" "),function(k,
p,m,g,c,e,b){return k("xide/data/_Base",c,{__all:null,allowCache:!0,constructor:function(){var a=this;if(a._getQuerierFactory("filter")||a._getQuerierFactory("sort"))this.queryEngine=function(b,c){c=c||{};var d=a._getQuerierFactory("filter"),l=d?d(b):passthrough,d=a._getQuerierFactory("sort"),f=passthrough;d&&(f=d(arrayUtil.map(c.sort,function(a){return{property:a.attribute,descending:a.descending}})));var h=passthrough;isNaN(c.start)&&isNaN(c.count)||(h=function(a){var b=c.start||0,b=a.slice(b,b+
(c.count||Infinity));b.total=a.length;return b});return function(a){return h(f(l(a)))}};var b=this;a.on("add,update,delete",function(c){var e=c.type,d=c.target;b.notify("add"===e||"update"===e?d:void 0,"delete"===e||"update"===e?"id"in c?c.id:a.getIdentity(d):void 0)})},destroy:function(){this._emit("destroy",this)},notify:function(){},refreshItem:function(a){this.emit("update",{target:a})},_queryCache:null,query:function(a,c,n){a&&e(JSON.stringify(a),1);b("xcf-ui");c=c||{};a=a||{};var q=this.filter(a),
d;if(a=c.sort)if("[object Array]"===Object.prototype.toString.call(a))for(;n=a.pop();)q=q.sort(n.attribute,n.descending);else q=q.sort(a);"start"in c&&(d=c.start||0,d=q[q.fetchRangeSync?"fetchRangeSync":"fetchRange"]({start:d,end:c.count?d+c.count:Infinity}),d.total=d.totalLength);d=d||new g(q[q.fetchSync?"fetchSync":"fetch"]());d.observe=function(a,b){var c=q.on("add",function(b){a(b.target,-1,b.index)}),d=q.on("update",function(c){!b&&c.previousIndex===c.index&&isFinite(c.index)||a(c.target,c.previousIndex,
c.index)}),f=q.on("delete",function(b){a(b.target,b.previousIndex,-1)}),e={remove:function(){c.remove();d.remove();f.remove()}};e.cancel=e.remove;return e};b("xcf-ui");return d}})})},"dstore/Memory":function(){define("dojo/_base/declare dojo/_base/array ./Store ./Promised ./SimpleQuery ./QueryResults".split(" "),function(k,p,m,g,c,e){return k([m,g,c],{constructor:function(){this.storage.version=0},postscript:function(){this.inherited(arguments);this.setData(this.data||[])},data:null,autoEmitEvents:!1,
getSync:function(b){return this.storage.fullData[this.storage.index[b]]},putSync:function(b,a){a=a||{};var c=this.storage,e=c.index,g=c.fullData,d=this.Model;!d||b instanceof d||(b=this._restore(b));var l=this.getIdentity(b);null==l&&(this._setIdentity(b,"id"in a?a.id:Math.random()),l=this.getIdentity(b));c.version++;var c=l in e?"update":"add",d={target:b},r;if("update"===c){if(!1===a.overwrite)throw Error("Object already exists");g.splice(r=e[l],1);l=r}else l=this.defaultNewToStart?0:g.length;var h;
if("beforeId"in a){var t=a.beforeId;null===t?h=g.length:(h=e[t],r<h&&--h);void 0!==h?d.beforeId=t:(console.error("options.beforeId was specified but no corresponding index was found"),h=l)}else h=l;g.splice(h,0,b);r=isFinite(r)?Math.min(r,h):h;for(l=g.length;r<l;++r)e[this.getIdentity(g[r])]=r;this.emit(c,d);return b},addSync:function(b,a){(a=a||{}).overwrite=!1;return this.putSync(b,a)},removeSync:function(b){var a=this.storage,c=a.index,a=a.fullData;if(b in c)return c=a.splice(c[b],1)[0],this._reindex(),
!0!==this._ignoreChangeEvents&&this.emit("delete",{id:b,target:c}),!0},setData:function(b){this.parse&&(b=this.parse(b));b.items&&(this.idProperty=b.identifier||this.idProperty,b=b.items);this.storage.fullData=this.data=b;this._reindex()},_reindex:function(){for(var b=this.storage,a=b.index={},c=b.fullData,e=this.Model,g=Object.prototype,d=0,l=c.length;d<l;d++){var r=c[d];if(e&&!(r instanceof e)){var h=this._restore(r,r.__proto__===g);r!==h&&(c[d]=r=h)}a[this.getIdentity(r)]=d}b.version++},fetchSync:function(){var b=
this.data;if(!b||b._version!==this.storage.version){for(var b=this.storage.fullData,a=this.queryLog,c=0,n=a.length;c<n;c++)b=a[c].querier(b);b._version=this.storage.version;this.data=b}return new e(b)},fetchRangeSync:function(b){var a=this.fetchSync();return new e(a.slice(b.start,b.end),{totalLength:a.length})},_includePropertyInSubCollection:function(b){return"data"!==b&&this.inherited(arguments)}})})},"dstore/Store":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/has dojo/when dojo/Deferred dojo/_base/declare dstore/QueryMethod dstore/Filter dojo/Evented".split(" "),
function(k,p,m,g,c,e,b,a,f,n){function q(a){return function(b,d){var f=this;c(b,function(b){b={target:b};var c=d[1]||{};"beforeId"in c&&(b.beforeId=c.beforeId);f.emit(a,b)});return b}}g.add("object-proto",!!{}.__proto__&&!{}.watch);var d=g("object-proto");return b(n,{constructor:function(a){a&&b.safeMixin(this,a);this.Model&&this.Model.createSubclass&&(this.Model=this.Model.createSubclass([]).extend({_store:this}));this.storage=new n;var d=this;this.autoEmitEvents&&(m.after(this,"add",q("add")),m.after(this,
"put",q("update")),m.after(this,"remove",function(a,b){c(a,function(){d.emit("delete",{id:b[0]})});return a}))},autoEmitEvents:!0,idProperty:"id",queryAccessors:!0,getIdentity:function(a){return a.get?a.get(this.idProperty):a[this.idProperty]},_setIdentity:function(a,b){a.set?a.set(this.idProperty,b):a[this.idProperty]=b},forEach:function(a,b){var d=this;return c(this.fetch(),function(c){for(var f=0,e;void 0!==(e=c[f]);f++)a.call(b,e,f,d);return c})},on:function(a,b){return this.storage.on(a,b)},
emit:function(a,b){b=b||{};b.type=a;try{return this.storage.emit(a,b)}finally{return b.cancelable}},parse:null,stringify:null,Model:null,_restore:function(a,b){var c=this.Model;if(c&&a){var f=c.prototype,e=f._restore;e?a=e.call(a,c,b):d&&b?a.__proto__=f:a=k.delegate(f,a)}return a},create:function(a){return new this.Model(a)},_createSubCollection:function(a){var c=k.delegate(this.constructor.prototype),d;for(d in this)this._includePropertyInSubCollection(d,c)&&(c[d]=this[d]);return b.safeMixin(c,a)},
_includePropertyInSubCollection:function(a,b){return!(a in b)||b[a]!==this[a]},queryLog:[],filter:new a({type:"filter",normalizeArguments:function(a){var b=this.Filter;return a instanceof b?[a]:[new b(a)]}}),Filter:f,sort:new a({type:"sort",normalizeArguments:function(a,b){var c;"function"===typeof a?c=[a]:(c=a instanceof Array?a.slice():"object"===typeof a?[].slice.call(arguments):[{property:a,descending:b}],c=p.map(c,function(a){a=k.mixin({},a);a.descending=!!a.descending;return a}),c=[c]);return c}}),
select:new a({type:"select"}),_getQuerierFactory:function(a){return this["_create"+(a[0].toUpperCase()+a.substr(1))+"Querier"]}})})},"dstore/QueryMethod":function(){define([],function(){return function(k){var p=k.type,m=k.normalizeArguments,g=k.applyQuery,c=k.querierFactory;return function(){var e=Array.prototype.slice.call(arguments),b=m?m.apply(this,e):e,e={type:p,arguments:e,normalizedArguments:b},a=this._getQuerierFactory(p)||c;a&&(e.querier=a.apply(this,b));b=this._createSubCollection({queryLog:this.queryLog.concat(e)});
return g?g.call(this,b,e):b}}})},"dstore/Filter":function(){define(["dojo/_base/declare"],function(k){function p(k){return function(){var g=this.constructor,c=new g;c.type=k;c.args=arguments;return this.type?p("and").call(g.prototype,this,c):c}}k=k(null,{constructor:function(k){var g=typeof k;switch(g){case "object":var g=this,c;for(c in k)var e=k[c],g=e instanceof this.constructor?g[e.type](c,e.args[0]):e&&e.test?g.match(c,e):g.eq(c,e);this.type=g.type;this.args=g.args;break;case "function":case "string":this.type=
g,this.args=[k]}},and:p("and"),or:p("or"),eq:p("eq"),ne:p("ne"),lt:p("lt"),lte:p("lte"),gt:p("gt"),gte:p("gte"),contains:p("contains"),"in":p("in"),match:p("match")});k.filterCreator=p;return k})},"dstore/Promised":function(){define(["dojo/_base/declare","dojo/Deferred","./QueryResults","dojo/when"],function(k,p,m,g){function c(c,b){return function(){var a=new p;try{a.resolve(this[c].apply(this,arguments))}catch(f){a.reject(f)}return b?(a=new m(a.promise),a.totalLength=g(a.totalLength),a):a.promise}}
return k(null,{get:c("getSync"),put:c("putSync"),add:c("addSync"),remove:c("removeSync"),fetch:c("fetchSync",!0),fetchRange:c("fetchRangeSync",!0)})})},"dstore/QueryResults":function(){define(["dojo/_base/lang","dojo/when"],function(k,p){function m(g,c){return p(this,function(e){for(var b=0,a=e.length;b<a;b++)g.call(c,e[b],b,e)})}return function(g,c){var e=c&&"totalLength"in c;if(g.then){g=k.delegate(g);var b=g.then(function(a){var b=e?c.totalLength:a.totalLength||a.length;a.totalLength=b;return!e&&
b});g.totalLength=e?c.totalLength:b;g.response=c&&c.response}else g.totalLength=e?c.totalLength:g.length;g.forEach=m;return g}})},"dstore/SimpleQuery":function(){define(["dojo/_base/declare","dojo/_base/array"],function(k,p){function m(c,e){if(-1<c.indexOf(".")){var b=c.split("."),a=b.length;return function(c){for(var n=0;n<a;n++)c=c&&(e&&c.get?c.get(b[n]):c[b[n]]);return c}}return function(a){return a.get?a.get(c):a[c]}}var g={eq:function(c,e){return c===e},"in":function(c,e){return-1<p.indexOf(e.data||
e,c)},ne:function(c,e){return c!==e},lt:function(c,e){return c<e},lte:function(c,e){return c<=e},gt:function(c,e){return c>e},gte:function(c,e){return c>=e},match:function(c,e,b){return e.test(c,b)},contains:function(c,e,b,a){var f=this;return p.every(e.data||e,function(e){if("object"===typeof e&&e.type){var g=f._getFilterComparator(e.type);return p.some(c,function(c){return g.call(f,c,e.args[1],b,a)})}return-1<p.indexOf(c,e)})}};return k(null,{_createFilterQuerier:function(c){function e(c){var g=
c.type;c=c.args;var d=a._getFilterComparator(g);if(d){var l=c[0],r=m(l,b),h=c[1];h&&h.fetchSync&&(h=h.fetchSync());return function(b){return d.call(a,r(b),h,b,l)}}switch(g){case "and":case "or":for(var t=0,k=c.length;t<k;t++){var u=e(c[t]);f=f?function(a,b){return"and"===g?function(c){return a(c)&&b(c)}:function(c){return a(c)||b(c)}}(f,u):u}return f;case "function":return c[0];case "string":t=a[c[0]];if(!t)throw Error("No filter function "+c[0]+" was found in the collection");return t;case void 0:return function(){return!0};
default:throw Error('Unknown filter operation "'+g+'"');}}var b=this.queryAccessors,a=this,f=e(c);return function(a){return p.filter(a,f)}},_getFilterComparator:function(c){return g[c]||this.inherited(arguments)},_createSelectQuerier:function(c){return function(e){var b=c.length;return p.map(e,c instanceof Array?function(a){for(var f={},e=0;e<b;e++){var g=c[e];f[g]=a[g]}return f}:function(a){return a[c]})}},_createSortQuerier:function(c){var e=this.queryAccessors;return function(b){b=b.slice();b.sort("function"==
typeof c?c:function(a,b){for(var n=0;n<c.length;n++){var g,d=c[n];if("function"==typeof d)g=d(a,b);else{g=d.get||(d.get=m(d.property,e));var d=d.descending,l=g(a);g=g(b);null!=l&&(l=l.valueOf());null!=g&&(g=g.valueOf());g=l===g?0:!!d===(null===l||l>g&&null!==g)?-1:1}if(0!==g)return g}return 0});return b}}})})},"dstore/Tree":function(){define(["dojo/_base/declare"],function(k){return k(null,{constructor:function(){this.root=this},mayHaveChildren:function(k){return"hasChildren"in k?k.hasChildren:!0},
getRootCollection:function(){return this.root.filter({parent:null})},getChildren:function(k){return this.root.filter({parent:this.getIdentity(k)})}})})},"xide/data/TreeMemory":function(){define(["dojo/_base/declare","xide/data/Memory","dstore/Tree","dojo/Deferred","dstore/QueryResults"],function(k,p,m,g,c){return k("xide.data.TreeMemory",[p,m],{_state:{filter:null},parentField:"parentId",reset:function(){this._state.filter=null;this.resetQueryLog()},resetQueryLog:function(){this.queryLog=[]},fetchRange:function(){var e=
this._fetchRange(arguments);return new c(e.then(function(b){return b}),{totalLength:e.then(function(b){return b.length})})},filter:function(c){var b=this.inherited(arguments);this._state.filter=c;return b},_fetchRange:function(c){var b=new g;c=this.fetchRangeSync(c);if(this._state.filter){if(this._state&&this._state.filter&&this._state.filter.parent){var a=this.getSync(this._state.filter.parent);a&&(this.reset(),c={},this.getChildrenSync?c=this.getChildrenSync(a):(c[this.parentField]=a[this.idProperty],
c=this.root.query(c)))}this._state&&this._state.filter&&this._state.filter.group&&(this.getSync(this._state.filter.parent),a&&(this.reset(),c=a.items))}b.resolve(c);return b},children:function(c){for(var b=this.root.data,a=[],f=0;f<b.length;f++){var n=b[f];n[this.parentField]==c[this.idProperty]&&a.push(n)}return b},mayHaveChildren:function(c){return!1===c._mayHaveChildren?!1:!0}})})},"xide/data/Memory":function(){define(["dojo/_base/declare","dstore/Memory","xide/data/_Base"],function(k,p,m){return k("xide.data.Memory",
[p,m],{})})},"xide/data/ObservableStore":function(){define(["dojo/_base/declare","xide/types","xide/mixins/EventedMixin"],function(k,p,m){return k("xide/data/Observable",m,{_ignoreChangeEvents:!0,observedProperties:[],mute:!1,silent:function(g){this._ignoreChangeEvents=g},putSync:function(g,c){this._ignoreChangeEvents=!0;var e=this.inherited(arguments);this._ignoreChangeEvents=!1;!1!==c&&this.emit("added",e);return e},removeSync:function(g){var c=this.getSync(g);c&&c.onRemove&&c.onRemove();return this.inherited(arguments)},
postscript:function(){var g=this;g.inherited(arguments);if(g.on)g.on("add",function(c){c=c.target;g._observe(c);c._store||(c._store=g);c._onCreated&&c._onCreated();c.onAdd&&c.onAdd(c)})},_onItemChanged:function(g,c,e,b){this._ignoreChangeEvents||(c={target:g,property:c,value:e,source:b},this.emit("update",c),g.onItemChanged&&g.onItemChanged(c))},_observe:function(g){var c=this,e=c.observedProperties;g&&g.observed&&(e=e.concat(g.observed));e&&e.forEach(function(b){g.property(b).observe(function(a){c._ignoreChangeEvents||
c._onItemChanged(g,b,a,c)})})},setData:function(g){this.inherited(arguments);this._ignoreChangeEvents=!0;g&&_.each(g,this._observe,this);this._ignoreChangeEvents=!1}})})},"dstore/Trackable":function(){define("dojo/_base/lang dojo/_base/declare dojo/aspect dojo/when dojo/promise/all dojo/_base/array dojo/on".split(" "),function(k,p,m,g,c,e,b){function a(a,b,c){for(var f=a.length-1;0<=f;--f){var h=a[f],e=h.start,h=e+h.count;if(b>h){a.splice(f+1,0,{start:b,count:c-b});return}c>=e&&(b=Math.min(b,e),c=
Math.max(c,h),a.splice(f,1))}a.unshift({start:b,count:c-b})}var f=0,n={track:function(){function c(){return function(){var b=this,c=this.inherited(arguments);g(c,function(c){c=b._results=c.slice();b._partialResults&&(b._partialResults=null);b._ranges=[];a(b._ranges,0,c.length)});return c}}function d(){return function(b){var c=this,d=b.start,h=b.end,l=this.inherited(arguments);this._results||g(l,function(b){return g(b.totalLength,function(l){var f=c._partialResults||(c._partialResults=[]);h=Math.min(h,
d+b.length);f.length=l;l=[d,h-d].concat(b);f.splice.apply(f,l);a(c._ranges,d,h);return b})});return l}}function l(a,b){f++;var c=b.target;b=k.delegate(b,z[a]);g(u._results||u._partialResults,function(d){if(d){var h,l,f,t=u._ranges,g,q="id"in b?b.id:n.getIdentity(c),k=-1,y=-1,m=-1,p=-1;if("delete"===a||"update"===a)for(h=0;-1===k&&h<t.length;++h)for(g=t[h],l=g.start,f=l+g.count;l<f;++l)if(n.getIdentity(d[l])==q){k=b.previousIndex=l;y=h;d.splice(k,1);g.count--;for(l=h+1;l<t.length;++l)t[l].start--;
break}if("add"===a||"update"===a){if(v){if(v([c]).length){var z=0;f=t.length-1;l=-1;for(var N;z<=f&&-1===m;)h=z+Math.round((f-z)/2),g=t[h],y=d.slice(g.start,g.start+g.count),"beforeId"in b&&(l=null===b.beforeId?y.length:C(y,b.beforeId)),-1===l&&(l=k>=Math.max(0,g.start-1)&&k<=g.start+g.count?k:n.defaultNewToStart?0:y.length),y.splice(l,0,c),q=e.indexOf(v(y),c),N=g.start+q,0===q&&0!==g.start?f=h-1:q>=y.length-1&&N<d.length?z=h+1:(m=N,p=h);if(-1===m&&0<z&&z<t.length)var P=!0}}else{l=-1;if("beforeId"in
b)if(null===b.beforeId)m=d.length,l=t.length-1;else for(h=0,f=t.length;-1===p&&h<f;++h)g=t[h],m=C(d,b.beforeId,g.start,g.start+g.count),-1!==m&&(p=h);else"update"===a?(m=k,p=y):n.defaultNewToStart?l=m=0:(m=d.length,l=t.length-1);-1!==l&&-1===p&&(g=t[l])&&g.start<=m&&m<=g.start+g.count&&(p=l)}if(-1<m&&-1<p)for(b.index=m,d.splice(m,0,c),t[p].count++,h=p+1;h<t.length;++h)t[h].start++;else if(P)for(b.beforeIndex=t[z].start,h=z;h<t.length;++h)t[h].start++}b.totalLength=d.length}(d=u["on_tracked"+a])&&
d.call(u,b)})}var n=this.store||this,h=[],t={add:1,update:1,"delete":1},y;for(y in t)h.push(this.on(y,function(a){return function(b){l(a,b)}}(y)));var u=p.safeMixin(k.delegate(this),{_ranges:[],fetch:c(),fetchRange:d(),releaseRange:function(a,b){if(this._partialResults){a:for(var c=this._ranges,d=0,h;h=c[d];++d){var l=h.start,f=l+h.count;if(a<=l)if(b>=f)c.splice(d,1);else{h.start=b;h.count=f-h.start;break a}else if(a<f)if(b>l){c.splice(d,1,{start:l,count:a-l},{start:b,count:f-b});break a}else h.count=
a-h.start}for(c=a;c<b;++c)delete this._partialResults[c]}},on:function(a,c){var d=this,h=this.getInherited(arguments);return b.parse(u,a,c,function(a,b){return b in t?m.after(u,"on_tracked"+b,c,!0):h.call(d,b,c)})},tracking:{remove:function(){for(;0<h.length;)h.pop().remove();this.remove=function(){}}},track:null});this.fetchSync&&(p.safeMixin(u,{fetchSync:c(),fetchRangeSync:d()}),u.fetchSync());var v;e.forEach(this.queryLog,function(a){var b=v,c=a.querier;c&&(v=b?function(a){return c(b(a))}:c)});
var z={add:{index:void 0},update:{previousIndex:void 0,index:void 0},"delete":{previousIndex:void 0}},C=function(a,b,c,d){d=void 0!==d?d:a.length;for(c=void 0!==c?c:0;c<d;++c)if(n.getIdentity(a[c])===b)return c;return-1};return u}};c=p(null,n);c.create=function(a,b){a=p.safeMixin(k.delegate(a),n);p.safeMixin(a,b);return a};return c})},"xide/manager/ContextBase":function(){define("dcl/dcl xide/factory xide/types xide/utils xide/mixins/EventedMixin dojo/_base/kernel dojo/_base/lang".split(" "),function(k,
p,m,g,c,e,b){c=k(c.dcl,{declaredClass:"xide.manager.ContextBase",language:"en",managers:[],mixins:null,getModule:function(a){return b.getObject(g.replaceAll("/",".",a))||b.getObject(a)||(k.getObject?k.getObject(a)||k.getObject(g.replaceAll("/",".",a)):null)},createManager:function(a,b,c){try{this.managers||(this.managers=[]);var q={ctx:this,config:b||this.config};g.mixin(q,c);if(_.isString(a)&&this.namespace){var d=null,d=-1==a.indexOf(".")?this.namespace+a:""+a;a=e.getObject(d)&&k.getObject(d)?d:
this.defaultNamespace+a}else _.isObject(a);var l=p.createInstance(a,q);if(l)return this.managers.push(l),p.publish(m.EVENTS.ON_CREATED_MANAGER,{instance:l,className:a,ctx:this,config:b||this.config}),l}catch(r){console.error("error creating manager "+r,arguments)}},constructManagers:function(){},initManagers:function(){},doMixins:function(a){this.mixins=a||this.mixins;for(var b=0;b<a.length;b++){var c=a[b],q=e.getObject(c.declaredClass)||k.getObject(c.declaredClass);c.declaredClass===this.declaredClass&&
(q=this);q&&g.mixin(q.prototype,c.mixin)}}});k.chainAfter(c,"constructManagers");k.chainAfter(c,"initManagers");return c})},"nxapp/Commons":function(){define("dojo/has dojo/_base/lang nxapp/types/Types xide/factory xide/factory/Events xide/factory/Objects xide/utils/StringUtils xide/utils/CIUtils xide/utils/ObjectUtils xide/utils/StoreUtils nxapp/utils/FileUtils xide/utils nxapp/utils dojo/node!os dojo/node!util nxapp/utils/_console".split(" "),function(k,p,m,g,c,e,b,a,f,n,q,d,l,r,h,t){p="linux";
"win32"===r.platform()?p="windows":"darwin"===r.platform()?p="osx":"linux"===r.platform()&&"arm"==r.arch()&&(p="arm");"arm"===p?k.add("serialport",function(){return!1}):k.add("serialport",function(){return!0});d.mixin(l,d);d.mixin(d,l);d.inspect=function(a){return h.inspect(a,{depth:null,colors:!0})};Array.prototype.remove=function(){for(var a,b=arguments,c=b.length,d;c&&this.length;)for(a=b[--c];-1!=(d=this.indexOf(a));)this.splice(d,1);return this};Array.prototype.contains=function(a){for(var b=
this.length;b--;)if(this[b]==a)return!0;return!1};Array.prototype.indexOfPropertyValue||(Array.prototype.indexOfPropertyValue=function(a,b){for(var c=0;c<this.length;c++)if(this[c][a]&&this[c][a]==b)return c;return-1});"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.substring(0,a.length)===a});"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.substring(this.length-a.length,this.length)===a});return{utils:l,
types:m}})},"xide/factory/Objects":function(){define(["dcl/dcl","xide/utils","xide/factory","xdojo/declare"],function(k,p,m,g){m.createInstance=function(c,e,b){var a={};p.mixin(a,e);e=c;if(_.isString(c)&&(e=dojo.getObject(e)||k.getObject(e),!e))return console.error("no such class : "+c),null;b&&(e=g(b,e.prototype));a.id||(a.id=(e.declaredClass||"no_class_").replace(/\//g,"_")+p.createUUID());(c=new e(a))&&(c.ctrArgs=a);return c};return m})},"xide/utils/CIUtils":function(){define(["xide/utils","xide/types",
"xide/factory","dojo/has","xide/lodash"],function(k,p,m,g,c){k.toOptions=function(c){c=k.flattenCIS(c);for(var b=[],a=0;a<c.length;a++){var f=c[a];b.push({name:k.toString(f.name),value:k.getCIValue(f),type:k.toInt(f.type),enumType:k.toString(f.enumType),visible:k.toBoolean(f.visible),active:k.toBoolean(f.active),changed:k.toBoolean(f.changed),group:k.toString(f.group),user:k.toObject(f.user),dst:k.toString(f.dst),params:k.toString(f.params)})}return b};if(g("xideve")||g("xblox-ui"))k.getEventsAsOptions=
function(c){var b=[{label:"Select Event",value:""}],a;for(a in p.EVENTS)b.push({label:p.EVENTS[a],value:p.EVENTS[a]});b=b.concat([{label:"onclick",value:"onclick"},{label:"ondblclick",value:"dblclick"},{label:"onmousedown",value:"mousedown"},{label:"onmouseup",value:"mouseup"},{label:"onmouseover",value:"mouseover"},{label:"onmousemove",value:"mousemove"},{label:"onmouseout",value:"mouseout"},{label:"onkeypress",value:"keypress"},{label:"onkeydown",value:"keydown"},{label:"onkeyup",value:"keyup"},
{label:"onfocus",value:"focus"},{label:"onblur",value:"blur"},{label:"On Load",value:"Load"}]);for(a=0;a<b.length;a++){var f=b[a];if(f.value===c){f.selected=!0;break}}return b};k.flattenCIS=function(c){for(var b=[],a=[],f=0;f<c.length;f++){var g=c[f],q=k.toInt(g.type);q>p.ECIType.END&&(q=p.resolveType(q))&&(k.mixin(b,q),a.push(g))}0<b.length&&(c=c.concat(b));if(a)for(f in a)c.remove(a[f]);return c};k.arrayContains=function(c,b){for(var a=0;a<c.length;a++)if(c[a]===b)return!0;return!1};k.setStoreCIValueByField=
function(c,b,a){null==c[b]&&(c[b]=[]);c[b][0]=k.getStringValue(a);return c};k.createOption=function(c,b,a){return k.mixin({label:c,value:null!=b?b:c},a)};k.createCI=function(c,b,a,f,g){c={dataRef:null,dataSource:null,name:c,group:-1,id:c,title:c,type:b,uid:-1,value:null!=a?a:-1,visible:!0,enumType:-1,"class":"cmx.types.ConfigurableInformation"};k.mixin(c,f);g&&g.publish&&m.publish(g.publish,{CI:c,owner:g.owner},g.owner);return c};k.createCIAsArray=function(c,b,a,f){return{chainType:[a?a:0],dataRef:[null],
dataSource:[null],params:[],name:[c],group:[-1],id:[c],title:[c],type:[b],uid:[-1],value:[f?f:-1],visible:[!0],enumType:[-1],parentId:[-1],"class":["cmx.types.ConfigurableInformation"]}};k.hasValue=function(c){return c.value&&null!=c.value[0]&&0<c.value[0].length&&"0"!=c.value[0]&&"undefined"!=c.value[0]&&"Unset"!=c.value[0]};k.hasValueAndDataRef=function(c){return c.value&&null!=c.value[0]&&0<c.value[0].length&&"0"!=c.value[0]&&"undefined"!=c.value[0]&&"Unset"!=c.value[0]&&c.dataRef&&null!=c.dataRef[0]&&
0<c.dataRef[0].length&&"0"!=c.dataRef[0]&&"undefined"!=c.dataRef[0]};k.getInputCIByName=function(c,b){if(!c)return null;var a=c.inputs;a||(a=c);if(null!=a)for(var f=0;f<a.length;f++){var g=a[f],q=k.getStringValue(g.name);if(null!=q&&q.toLowerCase()===b.toLowerCase())return g}return null};k.getCIByChainAndName=function(c,b,a){if(!c)return null;(b=0==b?c.inputs:1==b?c.outputs:null)||(b=c);if(null!=b)for(c=0;c<b.length;c++){var f=b[c],g=k.getStringValue(f.name);if(null!=g&&g.toLowerCase()===a.toLowerCase())return f}return null};
k.getCIByUid=function(c,b){if(null!=c)for(var a=0;a<c.length;a++){var f=c[a],g=k.getStringValue(f.uid);if(null!=g&&g===b)return f}return null};k.getCIById=function(c,b,a){c=0==b?c.inputs:1==b?c.outputs:null;if(null!=c)for(b=0;b<c.length;b++){var f=c[b];if(f.id[0]==a[0])return f}return null};k.getCIInputValueByName=function(c,b){var a=k.getCIByChainAndName(c,0,b);return a?a.value:null};k.getCIValue=function(c){return k.getCIValueByField(c,"value")};k.getStringValue=function(c){return k.toString(c)};
k.toString=function(e){return null!=e?c.isArray(e)?e&&1==e.length&&null==e[0]?null:""+(null!=e[0]?e[0]:e):""+e:null};k.setIntegerValue=function(c,b){null!=c&&dojo.isArray(c)&&(c[0]=b)};k.getCIValueByField=function(e,b){return null!=e[b]?c.isArray(e[b])?e[b][0]?e[b][0]:e[b]:e[b]:null};k.setCIValueByField=function(c,b,a){if(!c)return c;null==c[b]&&(c[b]=[]);c[b]=a;return c};k.setCIValue=function(c,b,a){(c=k.getInputCIByName(c,b))&&k.setCIValueByField(c,"value",a);return c};k.getCIInputValueByNameAndField=
function(c,b,a){return(c=k.getCIByChainAndName(c,0,b))?c[""+a]:null};k.getCIInputValueByNameAndFieldStr=function(c,b,a){return(c=k.getCIInputValueByNameAndField(c,b,a))?k.getStringValue(c):null};k.getCIInputValueByNameAndFieldBool=function(c,b,a){return(c=k.getCIInputValueByNameAndField(c,b,a))?k.toBoolean(c):null};k.getCIWidgetByName=function(c,b){for(var a=0;a<c.length;a++){var f=c[a];if(f._widget&&f.name===b)return f._widget}return null};return k})},"xide/utils/StoreUtils":function(){define(["xide/utils",
"xide/data/Memory","dojo/_base/kernel"],function(k,p,m){k.removeFromStore=function(g,c,e,b,a){g.removeSync(c[b]);var f={};f[a]=c[b];if((c=g.query(f))&&c.length)for(f=0;f<c.length;f++)k.removeFromStore(g,c[f],e,b,a)};k.toString=function(g){return null!==g?m.isArray(g)?g&&1==g.length&&null==g[0]?null:""+(null!==g[0]?g[0]:g):""+g:null};k.toBoolean=function(g){var c=!1;null!==g&&(g=g[0]?g[0]:g,null!==g&&(c=!(!0!==g&&"true"!==g&&"1"!==g)));return c};k.toObject=function(g){return null!==g?g[0]?g[0]:g:null};
k.toInt=function(g){if(_.isNumber(g))return g;var c=-1;if(null!=g&&(g=1<g.length?g:g[0]?g[0]:g,null!==g))try{c=parseInt(g,10)}catch(e){}return c};k.getStoreItemById=function(g,c){return k.queryStoreEx(g,{id:c},null,null)};k.getAppDataElementByIdAndType=function(g,c,e){return k.queryStore(g,{uid:c,type:e},null,null)};k.getElementsByType=function(g,c){return k.queryStoreEx(g,{type:c})};k.queryStoreEx=function(g,c,e,b){if(!g)return console.error("utils.queryStoreEx: store \x3d null"),null;if(g instanceof
p)return g=k.queryMemoryStoreEx(g,c),b&&g&&g[0]?g[0]:g;var a=null;g.query&&(a=g.query(c));return!0===e&&a&&0===a.length?null:!0===b&&a&&1==a.length?a[0]:a};k.queryStore=function(g,c,e){return(g=k.queryStoreEx(g,c,null,null))&&1==g.length?g[0]:null!==e&&!0===e&&g&&0===g.length?null:g};k.queryMemoryStoreEx=function(g,c){var e=[];g.query(c).forEach(function(b){e.push(b)});return e};k.queryMemoryStoreSingle=function(g,c){var e=k.queryMemoryStoreEx(g,c);return 1==e.length?e[0]:e};return k})},"nxapp/manager/FileManager":function(){define("dcl/dcl dojo/has nxapp/manager/ManagerBase nxapp/utils/_LogMixin xide/types xide/factory dojo/node!path dojo/node!fs dojo/node!child_process dojo/node!chokidar".split(" "),
function(k,p,m,g,c,e,b,a,f,n){p("windows");p("arm");return k([m,g],{declaredClass:"nxapp.manager.FileManager",watcher:null,resolve:function(c){var d="",l=b.resolve(dojoConfig.libRoot),f=b.resolve(dojoConfig.clientRoot);if(a.existsSync(b.resolve(c)))return c;"/"==c[0]?b.resolve(c):b.resolve(l+"/"+c)?d=b.resolve(l+"/"+c):a.existsSync(b.resolve(c))?d=b.resolve(c):b.resolve(f+"/"+c)&&(d=b.resolve(f+"/"+c));return d},watch:function(b,c){try{console.log("watch directory : "+this.resolve(b)),a.existsSync(b)&&
c&&this.watcher&&this.watcher.add&&this.watcher.add(b)}catch(l){}},initChokidar:function(f){for(var d=0;d<f.watchr.paths.length;d++){var l=f.watchr.paths[d],g=b.resolve(dojoConfig.libRoot),h=b.resolve(dojoConfig.clientRoot);"/"==l[0]?l=b.resolve(l):b.resolve(l)&&a.existsSync(l)?f.watchr.paths[d]=b.resolve(l):a.existsSync(b.resolve(g+"/"+l))?f.watchr.paths[d]=b.resolve(g+"/"+l):a.existsSync(b.resolve(l))?f.watchr.paths[d]=b.resolve(l):b.resolve(h+"/"+l)&&(f.watchr.paths[d]=b.resolve(h+"/"+l))}var t=
this,k=n.watch(f.watchr.paths,{persistent:!0,ignoreInitial:!0,awaitWriteFinish:!0});k.on("addDir",function(a){k.add(a);e.publish(c.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:a.replace(dojoConfig.libRoot,"")},t)});k.on("add",function(a){e.publish(c.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:a.replace(dojoConfig.libRoot,""),type:"added"},t)});k.on("unlinkDir",function(a){k.unwatch(a);e.publish(c.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:a.replace(dojoConfig.libRoot,""),type:"delete"},t)});k.on("change",
function(a){t.publish(c.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:a.replace(dojoConfig.libRoot,""),type:"changed"},t)});k.on("raw",function(a,b,d){if("rename"===a)try{var h=h.statSync(d.watchedPath)}catch(l){-1!==d.watchedPath.indexOf(b)&&e.publish(c.EVENTS.ON_FILE_CHANGED,{path:d.watchedPath,modulePath:d.watchedPath.replace(dojoConfig.libRoot,""),type:"delete"},t)}});this.watcher=k},initWindows_Watchr:function(f){for(var d=0;d<f.watchr.paths.length;d++){var l=f.watchr.paths[d],g=b.resolve(dojoConfig.libRoot),
h=b.resolve(dojoConfig.clientRoot);"/"==l[0]?l=b.resolve(l):b.resolve(g+"/"+l)?f.watchr.paths[d]=b.resolve(g+"/"+l):a.existsSync(b.resolve(l))?f.watchr.paths[d]=b.resolve(l):b.resolve(h+"/"+l)&&(f.watchr.paths[d]=b.resolve(h+"/"+l))}_.each(f.watchr.paths,function(a){});var t=this;watchr.watch({paths:f.watchr.paths,interval:500,listeners:{log:function(a){},error:function(a){console.log("an error occured:",a)},watching:function(a,b,c){},change:function(a,b,d,h){b&&e.publish(c.EVENTS.ON_FILE_CHANGED,
{path:b,modulePath:b.replace(dojoConfig.libRoot,"")},t)}},next:function(a,b){if(a)return console.log("watching everything failed with error",a);console.log("watching everything completed")}})},initWindows:function(c){for(var d=0;d<c.watchr.paths.length;d++){var l=c.watchr.paths[d],e=b.resolve(dojoConfig.libRoot),h=b.resolve(dojoConfig.clientRoot);"/"==l[0]?l=b.resolve(l):b.resolve(e+"/"+l)?c.watchr.paths[d]=b.resolve(e+"/"+l):a.existsSync(b.resolve(l))?c.watchr.paths[d]=b.resolve(l):b.resolve(h+"/"+
l)&&(c.watchr.paths[d]=b.resolve(h+"/"+l))}var t=new function(a,b,c,d){var h=f.spawn;a=h(a,b);var l=this;a.stdout.on("data",function(a){c(l,a)});a.stdout.on("end",d)}(b.resolve(global.cwd+"/inotifywait.exe"),["-r","-m","-q","--format\x3d%w|%e|%f",c.watchr.paths[0]],function(a,c){a.stdout="";for(var d=c.toString().split(/(\r?\n)/g),h=0;h<d.length;h++){var l=d[h];l&&5<l.length&&(l=l.split("|"),3==l.length&&b.resolve(l[0]+"/"+l[2]))}},function(){console.log("end : "+t.stdout)})},init:function(a){return this.initChokidar(a)},
initLinux:function(f,d){for(var l=0;l<f.watchr.paths.length;l++){var g=f.watchr.paths[l],h=b.resolve(dojoConfig.libRoot),t=b.resolve(dojoConfig.clientRoot);"/"==g[0]?g=b.resolve(g):b.resolve(h+"/"+g)?f.watchr.paths[l]=b.resolve(h+"/"+g):a.existsSync(b.resolve(g))?f.watchr.paths[l]=b.resolve(g):b.resolve(t+"/"+g)&&(f.watchr.paths[l]=b.resolve(t+"/"+g))}for(var n=this,k=function(b){var c=[];a.existsSync(b)&&a.readdirSync(b).forEach(function(d){d=b+"/"+d;var h=a.statSync(d);h&&h.isDirectory()&&(c.push(d),
c=c.concat(k(d)))});return c},g=function(){return{all_events:function(a){if(a&&a.name&&a.name.indexOf&&-1==a.name.indexOf(".git")&&-1==a.name.indexOf(".tmp")&&-1==a.name.indexOf("_jb_old_")&&-1==a.name.indexOf("_jb_bak_")&&-1==a.masks.toString().indexOf("access")){a.masks.toString().indexOf("moved_to");var d=b.resolve(a.watch+"/"+a.name),h="changed";-1!==a.masks.toString().replace("all_events,","").indexOf("delete")&&(h="deleted");d&&e.publish(c.EVENTS.ON_FILE_CHANGED,{path:d,modulePath:d.replace(dojoConfig.libRoot,
""),type:h},n)}},close_write:function(a){-1==a.name.indexOf(".git")&&-1==a.name.indexOf(".tmp")&&-1==a.name.indexOf("_jb_old_")&&-1==a.name.indexOf("_jb_bak_")&&-1==a.masks.toString().indexOf("access")&&-1==a.masks.toString().indexOf("moved_to")&&(a=b.resolve(a.watch+"/"+a.name))&&e.publish(c.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:a.replace(dojoConfig.libRoot,"")},n)},access:!0,moved_to:!0,moved_from:!0,"delete":!0}}(),h=d.create(!1),t=0;t<f.watchr.paths.length;t++)if(l=f.watchr.paths[t],a.existsSync(l)){var m=
k(l);h.watch(g,l);for(l=0;l<m.length;l++)h.watch(g,m[l])}}})})},"nxapp/manager/ExportManager":function(){define("dcl/dcl nxapp/manager/ManagerBase nxapp/manager/_Drivers_Devices nxapp/utils/_LogMixin nxapp/utils/_console xide/utils nxapp/utils dojo/node!path dojo/node!fs-jetpack dojo/node!cheerio dojo/node!fs dojo/has".split(" "),function(k,p,m,g,c,e,b,a,f,n,q,d){return k([p,g,m],{declaredClass:"nxapp.manager.ExportManager",options:null,serverTemplates:null,linux32:!0,linux64:!0,osx:!0,arm:!0,windows:!0,
nginxOptions:null,mongoOptions:null,serverOptions:null,init:function(a){this.profile=a},run:function(a){this.delegate=a;this.initWithOptions(this.options)},onProgress:function(a){this.delegate&&this.delegate.onProgress(a);c.log("Progress:  "+a)},onError:function(a){this.delegate&&this.delegate.onError(a)},onFinish:function(a){this.delegate&&this.delegate.onFinish(a);c.log("Finish:  "+a)},initWithOptions:function(d){this.options=d;e.mixin(this,d);this.onProgress("Export Manager: begin export",{progress:0});
if(!this.root)throw this.onError("Export Manager: have no root"),Error("Export Manager: have no root");if(!this.data)throw this.onError("Export Manager: have no data"),Error("Export Manager: have no data");if(this.user){this.client||(this.client=b.resolve(this.root+"/dist/all/Code/client/"));this.serverTemplates||(this.serverTemplates=b.resolve(this.root+"/server-template"));this.dist||(this.dist=b.resolve(this.root+"/dist/all/server/"));c.log("export with \n",e.inspect({"System Data":this.data,"User Data":this.user+
" \x3d "+a.resolve(this.user),Root:a.resolve(this.root),"Server-Templates":this.serverTemplates,Target:a.resolve(this.target),"Node Servers":a.resolve(this.dist),Client:this.client,"Export Windows":this.windows,"Export Linux - 32 ":this.linux32,"Export Linux - 64 ":this.linux64,"Export OSX":this.osx,"Export ARM":this.arm}));d=e.mixin({port:8889,templatePath:b.resolve(this.serverTemplates+"/nginx/all/conf/nginx.app.template.conf")},this.nginxOptions);var f=e.mixin({port:9997,mongo_port:27018,mqtt_port:1884},
this.serverOptions);this.exportNGINX(d);this.exportMongo(this.mongoOptions||{});this.createDirectoryLayout();this.exportServer();this.onProgress("Exported Servers",{progress:.2});this.exportUser();this.onProgress("Exported User",{progress:.3});this.exportSystem();this.onProgress("Exported System Data",{progress:.4});this.exportMisc(f);this.onProgress("Exported Misc Data",{progress:.5});this.exportHTML(f);this.onProgress("Exported User Workspace HTML",{progress:.6});this.exportDevices({serverSide:!0});
this.onProgress("Exported Devices",{progress:.7});this.exportDrivers({});this.onProgress("Exported Drivers",{progress:.8});this.client?this.exportClientEx():this.exportClientDist();this.onProgress("Exported Client Application Assets",{progress:.9});c.log("Export Done! Your application can be found at "+this.target);this.onProgress("Export Done",{progress:1.2});this.onFinish("Export Done! Your application can be found at "+this.target)}else this.onError("Export Manager: have no user")},exportHTML:function(b){function d(a,
c){var f=q.readdirSync(a);f.length&&_.each(f,function(d){if(-1!==d.indexOf(".dhtml")){var f=c.replace(h.path()+"/","");e.exportHTMLFile2(a+"/"+d,f,b)}})}var h=f.dir(this.target+"/www/user/workspace/"),e=this;(function(h){q.existsSync(h)?q.readdirSync(h).forEach(function(f){f=h+"/"+f;var g=q.statSync(f);if(g){var n=f.replace(a+"/","");g.isDirectory()?d(f,n):-1!==f.indexOf(".dhtml")&&(n=n.replace(h+"/",""),e.exportHTMLFile2(f,n,b))}else c.error("cant get stat for "+f)}):c.error("device path "+h+" doesnt exists");
return[]})(h.path())},exportHTMLFile2:function(b,c,d){var t=f.dir(this.root+"/export/"),t=e.readFile(a.resolve(t.path()+"/app.template.html")),g=e.pathinfo(b);c===g.basename&&(c="");c=e.mixin({libRoot:"/Code/client/src/lib",lodashUrl:"/Code/client/src/lib/external/lodash.min.js",requireBaseUrl:"/Code/client/src/lib/xibm/ibm",jQueryUrl:"/Code/client/src/lib/external/jquery-1.9.1.min.js",data:"",user:"/user",css:"./"+e.cleanUrl(g.filename+".css"),theme:"bootstrap",blox_file:"./"+c+"/"+g.filename+".xblox",
scene_file:"./"+c+"/"+g.filename+".dhtml",mount:"workspace",VFS_VARS:JSON.stringify({user_drivers:"./www/user/drivers",system_drivers:"./www/system/drivers"},null,2)},d);t=e.replace(t,null,c,{begin:"%",end:"%"});c=e.readFile(b);c=c.replace("\x3cviewHeaderTemplate/\x3e",t);c=c.replace(/\burl\s*\(\s*["']?([^"'\r\n\)\(]+)["']?\s*\)/gi,function(a,b){var c=b.split("://"),d=c[1];return c[0]&&d?"url('./"+d+"')":b});t=n.load(c);c='\n\x3cscript type\x3d"text/javascript"\x3e\n\tvar test \x3d 0;\n\x3c/script\x3e';
t("HEAD").append(t(c));e.writeFile(b.replace(".dhtml",".html"),t.html())},exportHTMLFile:function(b){var d=f.dir(this.root+"/export/"),h=f.dir(this.target+"/www/user/workspace/"),h=a.resolve(h.path()+"/ascene.dhtml"),d=e.readFile(a.resolve(d.path()+"/app.template.html"));b=e.mixin({libRoot:"/Code/client/src/lib",lodashUrl:"/Code/client/src/lib/external/lodash.min.js",requireBaseUrl:"/Code/client/src/lib/xibm/ibm",jQueryUrl:"/Code/client/src/lib/external/jquery-1.9.1.min.js",data:"",user:"/user",css:"./ascene.css",
theme:"bootstrap",blox_file:"./ascene.xblox",mount:"workspace",VFS_VARS:JSON.stringify({user_drivers:"./www/user/drivers",system_drivers:"./www/system/drivers"},null,2)},b);d=e.replace(d,null,b,{begin:"%",end:"%"});b=e.readFile(h);b=b.replace("\x3cviewHeaderTemplate/\x3e",d);b=b.replace(/\burl\s*\(\s*["']?([^"'\r\n\)\(]+)["']?\s*\)/gi,function(a,b){var d=b.split("://"),h=d[1];return d[0]&&h?(c.error("----"+h),"url('./"+h+"')"):b});b=n.load(b);d='\n\x3cscript type\x3d"text/javascript"\x3e\n\tvar test \x3d 0;\n\x3c/script\x3e';
b("HEAD").append(b(d));e.writeFile(h.replace(".dhtml",".html"),b.html())},exportDevices:function(b){var c=a.resolve(this.target+"/www/user/devices"),d=this.getDevices(c,"user_devices",b);e.writeFile(c+"/user_devices.json",JSON.stringify({items:d},null,2));c=a.resolve(this.target+"/www/system/devices");d=this.getDevices(c,"system_devices",b);e.writeFile(c+"/system_devices.json",JSON.stringify({items:d},null,2))},exportDrivers:function(b){var c=a.resolve(this.target+"/www/user/drivers");b=this.getDrivers(c,
"user_drivers");e.writeFile(c+"/user_drivers.json",JSON.stringify({items:b},null,2));c=a.resolve(this.target+"/www/system/drivers");b=this.getDrivers(c,"system_drivers");e.writeFile(c+"/system_drivers.json",JSON.stringify({items:b},null,2))},exportMisc:function(c){var d=f.dir(this.root+"/export"),h=f.dir(this.target);f.copy(d.path(),h.path(),{matching:["**"],overwrite:!0});var t=b.readFile(a.resolve(d.path()+"/profile_device_server.json")),t=e.replace(t,null,c,{begin:"%",end:"%"});"false"!==this.linux32&&
e.writeFile(h.path()+a.sep+"/server/linux_32/nxappmain/profile_device_server.json",t);"false"!==this.linux64&&e.writeFile(h.path()+a.sep+"/server/linux_64/nxappmain/profile_device_server.json",t);"false"!==this.windows&&"false"!==this.windows&&e.writeFile(h.path()+a.sep+"/server/windows/nxappmain/profile_device_server.json",t);"false"!==this.arm&&e.writeFile(h.path()+a.sep+"/server/arm/nxappmain/profile_device_server.json",t);"false"!==this.osx&&e.writeFile(h.path()+a.sep+"/server/osx/nxappmain/profile_device_server.json",
t);t=b.readFile(a.resolve(d.path()+"/start.js"));t=e.replace(t,null,c,{begin:"%",end:"%"});"false"!==this.linux32&&e.writeFile(h.path()+"/server/linux_32/start.js",t);"false"!==this.linux64&&e.writeFile(h.path()+"/server/linux_64/start.js",t);"false"!==this.windows&&e.writeFile(h.path()+"/server/windows/start.js",t);"false"!==this.arm&&e.writeFile(h.path()+"/server/arm/start.js",t);"false"!==this.osx&&e.writeFile(h.path()+"/server/osx/start.js",t)},exportClientEx:function(){var b=f.dir(a.resolve(this.client)+
""),c=f.dir(this.target+"/www/Code/client");f.copy(b.path(),c.path(),{matching:["**"],overwrite:!0})},exportClient:function(){var a=f.dir(this.root+"/Code/client"),b=f.dir(this.target+"/www/Code/client");f.copy(a.path(),b.path(),{matching:["**"],overwrite:!0})},exportClientDist:function(){var a=f.dir(this.root+"/dist/all/Code/client/"),b=f.dir(this.target+"/www/Code/client");f.copy(a.path(),b.path(),{matching:["**"],overwrite:!0})},exportUser:function(){var a=f.dir(this.user),b=f.dir(this.target+
"/www/user");c.log("export user from "+a.path()+" to "+b.path());try{f.copy(a.path(),b.path(),{matching:["**","!./.git/**/*","!**/**claycenter","!./claycenter","!**claycenter"],overwrite:!0})}catch(d){"EEXIST"===d.code&&c.error("Error copying, file exists!",d),"EACCES"===d.code&&c.error("Error copying, file access perrmissions!",d),c.error("error : ",d)}},exportSystem:function(){var a=f.dir(this.data+"/system"),b=f.dir(this.target+"/www/system");f.copy(a.path(),b.path(),{matching:["**"],overwrite:!0})},
clean:function(){},copyServer:function(a){var b=f.dir(this.target+"/server/"+a),d="",d=this.dist?f.dir(this.dist+"/"+a):f.dir(this.root+"/server/"+a);c.info("export Device-Server "+a+" from : "+d.path());try{f.copy(d.path(),b.path(),{matching:["**"],overwrite:!0})}catch(e){"EEXIST"===e.code&&c.error("Error copying, file exists!",e),"EACCES"===e.code&&c.error("Error copying, file access perrmissions!",e)}},exportServer:function(a){"false"!==this.windows&&this.copyServer("windows");"false"!==this.linux32&&
this.copyServer("linux_32");"false"!==this.linux64&&this.copyServer("linux_64");"false"!==this.arm&&this.copyServer("arm");"false"!==this.osx&&this.copyServer("osx")},createDirectoryLayout:function(){f.dir(this.target+"/data/_MONGO");f.dir(this.target+"/www/");f.dir(this.target+"/nginx/logs")},exportMongo:function(a){a=f.dir(this.serverTemplates+"/mongo");var b=f.dir(this.target+"/mongo");f.copy(a.path(),b.path(),{matching:"mongod-arm mongod-linux_32 mongod-linux_64 mongod-windows.exe mongod-32.exe mongod-osx".split(" "),
overwrite:!0})},exportNGINX:function(d){var g=f.dir(this.serverTemplates+"/nginx"),h=f.dir(this.target+"/nginx");try{f.copy(g.path(),h.path(),{matching:"nginx-arm nginx-linux_32 nginx-linux_64 nginx-windows.exe nginx-osx msvcr110.dll".split(" "),overwrite:!0})}catch(t){"EEXIST"===t.code&&c.error("Error copying, file exists!",t),"EACCES"===t.code&&c.error("Error copying, file access perrmissions!",t),"ETXTBSY"===t.code&&c.error("Error copying, file is busy",t)}g=f.dir(this.serverTemplates+"/nginx/all/conf");
h=f.dir(this.target+"/nginx");f.copy(g.path(),h.path(),{overwrite:!0});g=f.dir(this.serverTemplates+"/nginx/temp");h=f.dir(this.target+"/nginx/temp");f.copy(g.path(),h.path(),{overwrite:!0});h=b.readFile(d.templatePath);d=e.replace(h,null,d,{begin:"%%",end:"%%"});f.dir(this.serverTemplates+"/nginx/all/conf");h=f.dir(this.target+"/nginx/");e.writeFile(h.path()+a.sep+"nginx.conf",d)}})})},"nxapp/manager/_Drivers_Devices":function(){define("dcl/dcl dojo/node!path dojo/node!fs nxapp/utils xide/utils/StringUtils xide/types nxapp/utils/_console".split(" "),
function(k,p,m,g,c,e,b){return k(null,{declaredClass:"nxapp.manager._Drivers_Devices",profile:null,getDevices:function(a,f,n){function k(a,d){var n=m.readdirSync(a);n.length&&_.each(n,function(n){if(-1!=n.indexOf(".meta.json")){var k=c.getJson(g.readFile(a+p.sep+n),!0,!1);if(k){if(r){var q=g.getCIByChainAndName(k,0,e.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);!q||q.value&1<<e.DRIVER_FLAGS.RUNS_ON_SERVER||(q.value|=1<<e.DRIVER_FLAGS.RUNS_ON_SERVER)}k?(n={isDir:!1,path:d+"/"+n,parentId:d,scope:f,user:k,
id:g.getCIInputValueByName(k,e.DEVICE_PROPERTY.CF_DEVICE_ID)},l.push(n)):b.error("device has no meta "+a+p.sep+n)}else b.error("cant get device meta for "+n+" path \x3d "+a+p.sep+n)}})}function d(c){var f=[];m.existsSync(c)?m.readdirSync(c).forEach(function(e){e=c+"/"+e;var g=m.statSync(e);if(g){var n=e.replace(a+"/","");g.isDirectory()&&(l.push({isDir:!0,parent:n,name:n,path:n}),k(e,n),f.push(e.replace(a+"/","")),f=f.concat(d(e)))}else b.error("cant get stat for "+e)}):b.error("device path "+c+" doesnt exists");
return f}require({packages:[{name:f,location:a}]});var l=[];n=n||{};var r=n.serverSide;d(a);return l},getDrivers:function(a,f,n){function k(a,d){var t=m.readdirSync(a);t.length&&_.each(t,function(t){if(-1!=t.indexOf(".meta.json")){var n=c.getJson(g.readFile(a+p.sep+t),!0,!1);if(n){var k=g.getCIInputValueByName(n,e.DRIVER_PROPERTY.CF_DRIVER_ID),q=a+"/"+t.replace(".meta.json",".xblox"),m=c.getJson(g.readFile(q),!0,!1);m||b.warn("invalid blocks file for driver "+d+"/"+t+" blox path \x3d "+q);l.push({isDir:!1,
path:d+"/"+t,parentId:d,scope:f,user:n,id:k,blox:m||{},blockPath:q})}else b.error("cant get driver meta "+a+p.sep+t)}})}function d(c){var h=[];m.existsSync(c)?m.readdirSync(c).forEach(function(b){b=c+"/"+b;var f=m.statSync(b);if(f){var e=b.replace(p+"/","");f.isDirectory()&&(l.push({isDir:!0,parent:e,name:e,path:e}),k(b,e),h.push(b.replace(a+"/","")),h=h.concat(d(b)))}}):b.error("driver path "+c+" doesnt exists");return h}require({packages:[{name:f,location:a}]});var l=[];d(a);return l}})})},"nxapp/client/WebSocket":function(){define(["dojo/_base/declare",
"dojo/_base/lang","nxapp/utils/_LogMixin","nxapp/client/ClientBase","dojo/node!sockjs-client"],function(k,p,m,g,c){return k("nxapp.client.WebSocket",[g,m],{_socket:null,debugConnect:!0,connect:function(e){this.options=p.mixin(this.options,e);e=this.options.host;var b=this.options.port;this.options.debug&&this.initLogger(this.options.debug);this.log("Sock-JS-Client Connecting to "+e+":"+b,"socket_client");var a=c.create(e+":"+b),f=this;a.on("close",function(){console.log("on close!",f.options)});a.on("connection",
function(){f.log("socket client connected","socket_client");a.on("error",function(a){console.error("Socket client error ")});a.on("end",function(){f.log("socket client connection end","socket_client")})});this._socket=a},emit:function(c,b){this.showDebugMsg("socket_client")&&(console.log("Emiting: "+c+" with: "),console.dir(b));this._socket.write(b)},onSignal:function(c,b){this._socket.on("data",b)}})})},"nxapp/client/ClientBase":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/_base/lang"],
function(k,p,m){return k("nxapp.server.ClientBase",[p],{options:null,_defaultOptions:function(){return{}},init:function(g){this.options=m.mixin(this._defaultOptions(),g.options)}})})},"dcl/inherited":function(){(function(k){"undefined"!=typeof define?define(["./mini","./advise"],k):"undefined"!=typeof module?module.exports=k(require("./mini"),require("./advise")):k(dcl,advise)})(function(k,p){function m(c,b,a){var f=3>arguments.length&&c.callee,n=g.call(this,f?f.ctr:c,f?f.nom:b);if(n)return n.apply(this,
f?c||b:a)}function g(e,b){var a=this.constructor._meta,f,g,k,d;if(!+a.weaver[b]){if(a){if(a.chains.hasOwnProperty(b)){if(f=a.chains[b])for(k=f.length-1;0<=k;--k)if(g=f[k],g.ctr===e)return 0<k?f[k-1]:0;return}f=a.bases;for(k=f.length-1;0<=k&&f[k]!==e;--k);if(0<=k)for(++k,d=f.length;k<d;++k)if(a=(g=f[k])._meta){if((a=a.ownProps).hasOwnProperty(b))return a[b]}else return g.prototype[b]}return c[b]}}var c={};p.after(k,"_postprocess",function(c,b){for(var a=b._meta.bases,f=a.length-1,n,q,d;0<=f;--f)if(n=
a[f],q=n._meta)q=q.ownProps,k.allKeys(q).some(function(a){d=q[a];if("function"==typeof d){if(d.nom===a)return 1;d.nom=a;d.ctr=n}});b.prototype.inherited=m;b.prototype.getInherited=g});k.getInherited=m.get=g;return k.inherited=m})},"dcl/advise":function(){(function(k){"undefined"!=typeof define?define([],k):"undefined"!=typeof module?module.exports=k():advise=k()})(function(){function k(c,e){this.next_before=this.prev_before=this.next_after=this.prev_after=this.next_around=this.prev_around=this;this.instance=
c;this.name=e}function p(c){var e=function(){var b,a,f=arguments,e;for(b=c.prev_before;b!==c;b=b.prev_before)b.before.apply(this,f);try{c.prev_around!==c&&(a=c.prev_around.around.apply(this,f))}catch(g){a=g,e=!0}for(b=c.next_after;b!==c;b=b.next_after)b.after.call(this,f,a);if(e)throw a;return a};e.adviceNode=c;return e}function m(c,e,b){var a=c[e],f;a&&a.adviceNode&&a.adviceNode instanceof k?f=a.adviceNode:(f=new k(c,e),a&&a.advices?(a=a.advices,f.add(a.before,a.after,a.around)):f.add(0,0,a),c[e]=
p(f));"function"==typeof b&&(b=b(e,c));return f.add(b.before,b.after,0,b.around)}var g=k.prototype={add:function(c,e,b,a){var f=new k(this.instance,this.name);f.parent=this;f.before=c;this._add("before",f);f.after=e;this._add("after",f);f.around=b;this._add("around",f,a);if(f.original=a)f.around=m._instantiate(a,f.prev_around.around,this);return f},_add:function(c,e,b){if(e[c]||b)b="next_"+c,c="prev_"+c,(e[c]=this[c])[b]=(e[b]=this)[c]=e},remove:function(c){this._remove("before",c);this._remove("after",
c);this._remove("around",c)},_remove:function(c,e){var b="next_"+c,a="prev_"+c;e[b][a]=e[a];e[a][b]=e[b]},destroy:function(){var c=this.prev_around.around,e=this.next_around,b=this.parent;this.remove(this);if(e!==this)for(;e!==b;c=e.around,e=e.next_around)e.original&&(e.around=m._instantiate(e.original,c,this));this.instance=0}};g.unadvise=g.destroy;m.before=function(c,e,b){return m(c,e,{before:b})};m.after=function(c,e,b){return m(c,e,{after:b})};m.around=function(c,e,b){return m(c,e,{around:b})};
m.Node=k;m._instantiate=function(c,e,b){return c(e)};return m})},"nxapp/manager/DeviceServerContext":function(){define("dcl/dcl nxapp/manager/Context nxapp/Commons xcf/types/Types dojo/node!path dojo/node!fs nxapp/utils xide/types nxapp/manager/DriverManager xcf/manager/DeviceManager nxapp/manager/FileManager xcf/manager/Context nxapp/manager/DeviceManager xcf/manager/BlockManager xide/manager/ResourceManager xblox/factory/Blocks dojo/node!tracer nxapp/utils/_console nxapp/manager/_Drivers_Devices dojo/_base/lang dojo/promise/all require dojo/has nxapp/manager/TestManager".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d,l,r,h,t,y,u,v,z,C,B,E,G){var F=k(null,{declaredClass:"DeviceServerClientClass",write:function(a){u.error("device server client write",a)},emit:function(a){u.error("device server client emit",a)}}),x=null,D=k(null,{owner:null,remoteAddress:"fake - address",remotePort:"fake - port",isExternal:function(){return!1},constructor:function(a){b.mixin(this,a)},write:function(c){var d=this.owner.getDeviceManager(),h=b.getJson(c),h=h||{};if(h.data&&h.data.device){var f=d.getDeviceStoreItem(h.data.device);
if(f)if(f=d.toDeviceControlInfo(f)){if(!f.serverSide)return}else u.error("no info")}if(h&&h.data&&h.data.deviceMessage&&h.data.deviceMessage.event===a.EVENTS.ON_COMMAND_FINISH)d.onCommandFinish(h.data.device,h.data.deviceMessage);else if(h.data&&h.data.deviceMessage&&h.data.deviceMessage.event===a.EVENTS.ON_COMMAND_ERROR)d.onCommandError(h.data.device,h.data.deviceMessage);else if(h.event===a.EVENTS.ON_DEVICE_DISCONNECTED)d.publish(a.EVENTS.ON_DEVICE_DISCONNECTED,h.data);else{if(h.event===a.EVENTS.SET_DEVICE_VARIABLES)return d.onSetDeviceServerVariables(h.data);
if(h.event===a.EVENTS.ON_DEVICE_CONNECTED)d.publish(a.EVENTS.ON_DEVICE_CONNECTED,h.data);else if(h.event!==a.EVENTS.ON_SERVER_LOG_MESSAGE)if(h.event===a.EVENTS.ON_MQTT_MESSAGE)d.publish(a.EVENTS.ON_MQTT_MESSAGE,h.data),d.onMQTTMessage(h.data);else if(h.event!==a.EVENTS.ON_FILE_CHANGED)d.onDeviceServerMessage({data:c})}},emit:function(){u.error("device server client emit",arguments)}});return k([p,d,v],{declaredClass:"nxapp.manager.DeviceServerContext",profile:null,testManager:null,getTestManager:function(){return this.testManager},
doTests:function(){return this.getTestManager().doTests()},initManagers:function(b){b&&(this.profile=b);this.testManager&&this.testManager.init(b);this.deviceManager.init();this.driverManager.init();this.blockManager.init();this.fileManager.init(b);this.blockManager.onReady();var c=this;this.subscribe(a.EVENTS.ON_FILE_CHANGED,function(b){c.onXIDEMessage({event:a.EVENTS.ON_FILE_CHANGED,data:b,type:b.type},!1);c.fileChanged(b);c.deviceManager.onFileChanged(b);c.driverManager.onFileChanged(b);c.getDeviceServer().broadCastMessage(a.EVENTS.ON_FILE_CHANGED,
{path:b.path,modulePath:b.modulePath,mask:b.mask,type:b.type})})},getModule:function(a){return z.getObject(b.replaceAll("/",".",a))||z.getObject(a)||(k.getObject?k.getObject(a)||k.getObject(b.replaceAll("/",".",a)):null)},_reloadModule:function(c,d){function h(a){u.log(a.src,a.id);u.error("require error "+c,a);f.remove()}var f=null;if(-1===c.indexOf(".json")){c=c.replace("0/8","0.8");var l=z.getObject(b.replaceAll("/",".",c))||z.getObject(c);if(l&&l.prototype&&l.prototype.reloadModule)l.prototype.reloadModule();
else{var f=B.on("error",h),e=this.getModule(c);if(!e&&(e="undefined"!==typeof c?e:null,!e&&"undefined"!==typeof window))if(e=b.getAt(window,b.replaceAll("/",".",c),null))l=e;else try{e=B(b.replaceAll(".","/",c))}catch(t){}e&&(l=e);B.undef(c);var g=this;d&&setTimeout(function(){B({waitSeconds:5});try{B([c],function(b){u.log("reloaded module : "+c+(null!==e?" have obj":"have no obj"));B({cacheBust:"time\x3d"+(new Date).getTime()});_.isString(b)?u.error("module reloaded failed : "+b+" for module : "+
c):(b.modulePath=c,l&&(g.mergeFunctions(l.prototype,b.prototype),l.prototype&&l.prototype._onReloaded&&l.prototype._onReloaded(b)),g.publish(a.EVENTS.ON_MODULE_RELOADED,{module:c,newModule:b}),b.prototype&&b.prototype.declaredClass&&g.publish(a.EVENTS.ON_MODULE_UPDATED,{moduleClass:b.prototype.declaredClass,moduleProto:b.prototype}))})}catch(b){u.error("error reloading module "+c,b.stack),logError(b,"error reloading module "+c)}},10)}}},fileChanged:function(a){var b=a.path;"changed"===a.type&&this._reloadModule(b,
!0)},onAllDevicesStarted:function(){this.profile.test&&this.doTests()},onReady:function(){var a=this.getDeviceServer();if(a){var b=this.connection;a.clients||(a.clients=[]);b&&(a.clients.push(b),a.onClientConnection(b));this.initDevices();x=this;global.sctx=x}else u.error("have no device server")},getUserDirectory:function(){return this.profile.user},constructManagers:function(){n=k([n,l],{});this.driverManager=this.createManager(f,null);this.fileManager=this.createManager(q,null);this.blockManager=
this.createManager(r,null);G&&(this.testManager=this.createManager(G,null));this.connection=new D({owner:this});this.deviceManager=this.createManager(n,null,{deviceServerClient:new F({}),connection:this.connection});if(this.profile){var a=c.resolve(this.profile.system),a={system_drivers:c.resolve(a+"/system/drivers"),system_devices:c.resolve(a+"/system/devices")};if(this.profile.user){var b=c.resolve(this.profile.user);a.user_drivers=c.resolve(b+"/drivers");a.user_devices=c.resolve(b+"/devices");
this.userDirectory=b}this.resourceManager=this.createManager(h);this.resourceManager.resourceVariables={VFS_CONFIG:a}}},onLoaded:function(){},initDevices:function(){var a=this.profile,b=c.resolve(a.system),d=this.getDeviceManager(),h=this.getDriverManager(),f=a.serverSide;h.createStore({items:this.getDrivers(c.resolve(b+"/system/drivers"),"system_drivers")},"system_drivers",!0);d.initStore({items:this.getDevices(c.resolve(b+"/system/devices"),"system_devices",{serverSide:f})},"system_devices",!0);
a.user&&(h.createStore({items:this.getDrivers(c.resolve(a.user+"/drivers"),"user_drivers")},"user_drivers",!0),d.initStore({items:this.getDevices(c.resolve(a.user+"/devices"),"user_devices",{serverSide:f})},"user_devices",!0));C(d.connectToAllDevices()).then(function(){this.onAllDevicesStarted()}.bind(this))}})})},"nxapp/manager/DriverManager":function(){define("dcl/dcl nxapp/utils/_LogMixin xide/types xcf/manager/DriverManager nxapp/utils/_console dojo/node!path xide/mixins/EventedMixin xide/mixins/ReloadMixin dojo/Deferred xcf/model/Variable nxapp/utils".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q){return k([g,p],{declaredClass:"nxapp.manager.DriverManager",createDriverInstance:function(d){var l=this.ctx,g=l.getDeviceManager(),h=l.getDriverManager(),t=d.driverScope,n=d.deviceScope,u=new f,p=d.system_drivers+"/DriverBase.js",z=d[t]+"/"+d.driver,C=d.driverId,B=d.deviceId||d.id,E=d[t],G=d[n],F=d.hash,x=h.getDriverById(C),D=g.getDeviceById(B,g.stores[n]);if(!x){if(!E)return c.error("invalid drivers path "+E,d),u.reject("invalid drivers path "+E),u;B=l.getDrivers(e.resolve(E),
t);if(!B||!B.length)return u.reject("have no devices at "+E),u;E=this.createStore({items:B},t,!1);x=h.getDriverById(C,E);if(!x)return u.reject("cant find driver "+C),u}if(!D){h=l.getDevices(e.resolve(G),n);if(!h||!h.length)return u.reject("have no devices at "+G),u;D=g.initStore({items:h},n,!1).getSync(d.devicePath);if(!D)return u.reject("cant find device "+d.devicePath),u}D.info=d;var w=this;require(["system_drivers/DriverBase"],function(h){h.prototype.declaredClass=p;require([t+"/"+d.driver.replace(".js",
"")],function(f){f=new (k([h,b.dcl,a.dcl,f],{}));f.declaredClass=z;f.options=d;f.baseClass=h.prototype.declaredClass;f.modulePath=z;f.delegate=g;f.driver=x;f.serverSide=d.serverSide;f.utils=q;f.types=m;f.device=D;f.id=q.createUUID();f.getDevice=function(){return this.device};f.getDeviceInfo=function(){return this.getDevice().info};var e=x.user,t=q.getCIByChainAndName(e,0,m.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);t&&t.params&&(f.sendSettings=q.getJson(t.params));(e=q.getCIByChainAndName(e,0,m.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&
e.params&&(f.responseSettings=q.getJson(e.params));try{f.start(),f.initReload()}catch(n){c.error("crash in driver instance startup! "+D.toString())}w.driverInstance=f;e=C+"_"+F+"_"+D.path;x.blox&&x.blox.blocks||(c.error("Attention : INVALID driver",D.toString()),x.blox={blocks:[]});x.blockPath&&(q.getJson(q.readFile(x.blockPath)),x.blox=q.getJson(q.readFile(x.blockPath)));g.deviceInstances||(g.deviceInstances={});g.deviceInstances[F]=f;e=l.getBlockManager().createScope({id:e,device:D,driver:x,instance:f,
ctx:l,serverSide:d.serverSide,uuid:q.createUUID(),getContext:function(){return this.instance}},dojo.clone(x.blox.blocks));f.blockScope=e;D.blockScope=e;D.driverInstance=f;w.blockScope=e;u.resolve({driverInstance:f,blockScope:e})})});u.then(function(a){a.blockScope.start()});return u}})})},"xcf/manager/DriverManager":function(){define("dcl/dcl dojo/_base/declare dojo/_base/lang dojo/_base/json xide/types xcf/types/Types xide/utils xcf/manager/BeanManager xcf/model/Variable xcf/manager/DriverManager_Server xide/data/TreeMemory xide/data/ObservableStore dstore/Trackable xdojo/has xcf/model/Driver xide/manager/ServerActionBase xide/data/Reference dojo/Deferred xide/mixins/ReloadMixin xide/mixins/EventedMixin xdojo/has!xcf-ui?./DriverManager_UI xdojo/has!xcf-ui?xide/views/_CIDialog".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d,l,r,h,t,y,u,v,z,C,B){m=[t,a,n];r("runDrivers");r("xcf-ui")&&m.push(C);return k(m,{getDriverModule:function(a){var d=new u,h=b.getCIInputValueByName(a.user,c.DRIVER_PROPERTY.CF_DRIVER_CLASS);a=a.scope;h=h?h.replace("./",""):"";a=require.toUrl(a);a=b.removeURLParameter(a,"bust");a=b.removeURLParameter(a,"time");a=a.replace("/main.js","");require.cache||(a=a.replace("/.js","/"));try{require([a+"/"+h],function(a){d.resolve(a)})}catch(f){console.error("error loading driver module from  "+
a+"---"+h,f),logError(f,"error loading driver module"),d.reject(f.message)}return d},loadDriverModule:function(a){var d=this.driverScopes.system_drivers+"DriverBase",h=require.toUrl(this.driverScopes.system_drivers);decodeURIComponent(h);var f=this,l=new u,e=require;e([d],function(d){var h=f.driverScopes[a.scope],t=!require.cache;t?require({config:{urlArgs:null}}):require({cacheBust:null});h=require.toUrl(h);t&&(h=h.replace("/.js","/"));var g=b.getCIInputValueByName(a.user,c.DRIVER_PROPERTY.CF_DRIVER_CLASS),
g=g.replace("./",""),g=g.replace(".js",""),g=a.scope+"/"+g,g=g.replace("","").trim();try{e.undef(g),e([g],function(a){function b(c,d){a.getFields=c.getFields;c.onReloaded=b;d.onReloaded=b}a.declaredClass=g;k([d,z.dcl,v.dcl,a],{}).getFields=a.getFields;a.onReloaded=b;l.resolve(a)})}catch(n){}});return l},getBlock:function(a){a=b.parse_url(a);a=b.urlArgs(a.host);var c=this.getItemById(a.driver.value),d=null;c&&c.blockScope&&(d=c.blockScope.getBlockById(a.block.value));return d},getDriverByUrl:function(a){a=
b.parse_url(a);a=b.urlArgs(a.host);return this.getItemById(a.driver.value)},declaredClass:"xcf.manager.DriverManager",addDeviceInstance:function(a,b){b.directory=!0;var d=b._store,h=b.path,f=this.ctx.getDeviceManager(),l=d.getSync(h+"_instances"),l=l||d.putSync({path:h+"_instances",name:"Instances",isDir:!0,type:"leaf",parentId:h,virtual:!0,isCommand:!1,icon:"fa-folder",children:[]}),h=f.getMetaValue(a,c.DEVICE_PROPERTY.CF_DEVICE_TITLE),d=d.putSync(new y({name:h,isCommand:!1,path:l.path+"_instance_"+
a.path,isDir:!1,type:"driver_instance",parentId:l.path,device:a,driver:b,_mayHaveChildren:!1,icon:a.iconClass,state:a.state}));l.children.push(d);a.addReference(d,{properties:{name:!0,enabled:!0,state:!0,iconClass:!0},onDelete:!1},!0);!b.instances&&(b.instances=[]);if(l=_.find(b.instances,{path:d.path}))console.log("instance already added "),b.instances.remove(l);b.instances.push(d)},beanNamespace:"driver",beanName:"Driver",beanIconClass:"fa-exchange",groupType:c.ITEM_TYPE.DRIVER_GROUP,itemType:c.ITEM_TYPE.DRIVER,
itemMetaTitleField:c.DRIVER_PROPERTY.CF_DRIVER_NAME,defaultScope:"system_drivers",serviceClass:"XCF_Driver_Service",rawData:null,store:null,treeView:null,driverScopes:null,_isLoading:!1,removeDriverInstance:function(a,b){var c=a.driver,d=c._store,h=c.path,f=h+"_instances_instance_"+b.path,l=d.getSync(f);l&&d.removeSync(f);(f=_.find(c.instances,{path:f}))&&c.instances.remove(f);b.removeReference(l);l&&(l.refresh(),d.getSync(h+"_instances").refresh())},onReloaded:function(){},_onReloaded:function(){},
onDeviceMessage:function(a){},_driverQueryCache:null,_getDriverById:function(a,d){var h=b.queryStore(d,{isDir:!1});_.isArray(h)||(h=[h]);for(var f=0;f<h.length;f++){var l=h[f],e=b.getInputCIByName(l.user,c.DRIVER_PROPERTY.CF_DRIVER_ID);if(e&&e.value==a)return d.getSync(l.path)}return null},getDriverById:function(a,b){if(b)return this._getDriverById(a,b);var c=null,d=null;r("xcf-ui");for(var h in this.stores)if(b=this.stores[h],c=this._getDriverById(a,b)){d=c;break}r("xcf-ui");return d},getDriverByPath:function(a){var c=
null,d;for(d in this.stores){a:{c=b.queryStore(this.stores[d],{isDir:!1});_.isArray(c)||(c=[c]);for(var h=0;h<c.length;h++){var f=c[h];if(f.path==a){c=f;break a}}c=null}if(c)return c}return null},getItemById:function(a){return this.getDriverById(a)},onNewDriverScopeCreated:function(a){},onScopeCreated:function(a){},onDeviceDisconnected:function(a){},onDriverCreated:function(a){r("xcf-ui")&&c.registerEnumeration("Driver",this.getDriversAsEnumeration(a))},onDriverRemoved:function(a,b){r("xcf-ui")&&
c.registerEnumeration("Driver",this.getDriversAsEnumeration(a))},onStoreReady:function(a){r("xcf-ui")&&c.registerEnumeration("Driver",this.getDriversAsEnumeration(a))},onStoreCreated:function(a){var b=a.type;a=a.store;var d=a.query({isDir:!1});if(b===c.ITEM_TYPE.DRIVER)for(b=0;b<d.length;b++){var h=d[b];null==h._completed&&"Default"!==h.name&&(h._completed=!0,r("xcf-ui")&&this.completeDriver(a,h,h))}},createStore:function(a,c,f){a=new (p("driverStore",[q,l,d],{}))({data:a.items,Model:h,idProperty:"path",
scope:c,id:b.createUUID(),observedProperties:["name","enabled"]});c&&!1!==f&&this.setStore(c,a);return a},initStore:function(a,b,c){return this.createStore(a,b,c)},getStore:function(a){a=a||"system_drivers";var b=this.stores[a];return b?b:this.ls(a)},ls:function(a,b){function d(f){try{var l=this.createStore(f,a,b);!1!==b&&this.setStore(a,l);this.onStoreReady(l);!1!==b&&this.publish(c.EVENTS.ON_STORE_CREATED,{data:f,owner:this,store:l,type:this.itemType});h.resolve(l)}catch(e){logError(e,"error ls drivers")}}
var h=new u;r("php")?this.runDeferred(null,"ls",[a]).then(d.bind(this)):h.resolve({items:[]});return h},init:function(){var a=this,b=c.EVENTS;this.stores={};this.subscribe([b.ON_SCOPE_CREATED,b.ON_STORE_CREATED]);this.subscribe(b.ON_BLOCK_EXPRESSION_FAILED,function(c){a.publish(b.ON_SERVER_LOG_MESSAGE,{data:{type:"Expression",device:c.deviceInfo},level:"error",message:"Expression Failed: "+c.item.title+" : "+c.item.value})});this.driverScopes={system_drivers:"system_drivers/",user_drivers:"user_drivers/"}}})})},
"xcf/manager/BeanManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/types xide/utils xide/manager/BeanManager dojo/Deferred xdojo/has!xcf-ui?xide/views/ActionDialog xdojo/has!xcf-ui?xide/views/CIActionDialog xdojo/has!xcf-ui?xide/views/CIGroupedSettingsView".split(" "),function(k,p,m,g,c,e,b,a,f,n,q){return k(e,{declaredClass:"xcf.manager.BeanManager",setStore:function(a,b){var c=this.stores[a];c&&(c.destroy(),delete this.stores[a]);return this.stores[a]=b},getFile:function(a){var c=
new b,f=this.ctx.getFileManager().getStore(a.scope);f.initRoot().then(function(){f._loadPath(".",!0).then(function(){f.getItem(a.path,!0).then(function(a){c.resolve(a)})})});return c},toUrl:function(a,b,c,h){return m.replace((h||"")+"deviceScope\x3d{deviceScope}\x26device\x3d{deviceId}\x26driver\x3d{driverId}\x26driverScope\x3d{driverScope}\x26block\x3d{block}",{deviceId:a.id,deviceScope:a.scope,driverId:b.id,driverScope:b.scope,block:c.id})},openItemSettings:function(b,f){var e=b.user;if(!e||!e.inputs)return null;
var h=this.getViewId(b),t=a.byId(h);try{if(t)return t.parentContainer&&t.parentContainer.selectChild(t),null}catch(n){c.destroy(t)}var t=this.ctx.mainView.getDocker(),k=this.getMetaValue(b,this.itemMetaTitleField),m=f?this.ctx.getDeviceManager().toDeviceControlInfo(f):null,t=t.addTab(null,{title:(k||b.name)+""+(f?":"+f.name+":"+m.host+":":""),icon:this.beanIconClass});if(k=c.getCIByChainAndName(e,0,g.DRIVER_PROPERTY.CF_DRIVER_COMMANDS))k.device=f;b.blockScope&&!b.blockScope.serviceObject&&(b.blockScope.serviceObject=
this.serviceObject);return c.addWidget(q,{cis:e.inputs,storeItem:b,iconClass:this.beanIconClass,id:h,delegate:this,storeDelegate:this,blockManager:this.ctx.getBlockManager(),options:{groupOrder:{General:1,Settings:2,Visual:3}}},this,t,!0)},newGroup:function(){var a=this,b=this.getItem(),f=b?!0===b.isDir?b.path:"":"",b=new n({title:"New "+this.groupType,delegate:{onOk:function(b,l){var e=c.getCIInputValueByName(l,"Title"),n=c.getCIInputValueByName(l,"Scope");a.createGroup(n,f+"/"+e,function(b){b=a.createNewGroupItem(e,
n,f);a.store.putSync(b);a.publish(g.EVENTS.ON_STORE_CHANGED,{owner:a,store:a.store,action:g.NEW_DIRECTORY,item:b})})}},cis:[c.createCI("Title",13,""),c.createCI("Scope",3,this.defaultScope,{options:[{label:"System",value:this.defaultScope},{label:"User",value:this.userScope},{label:"App",value:this.appScope}]})]});b.startup();b.show()},onDeleteItem:function(a){var b=!0===c.toBoolean(a.isDir),e=b?"removeGroup":"removeItem",h=this;(new f({title:"Remove "+this.beanName+(b?" Group":"")+' "'+a.name+'"  ',
style:"max-width:400px",titleBarClass:"text-danger",delegate:{isRemoving:!1,onOk:function(b){h[e](c.toString(a.scope),c.toString(a.path),c.toString(a.name),function(){h.onItemDeleted(a);h.publish(g.EVENTS.ON_STORE_CHANGED,{owner:h,store:h.store,action:g.DELETE,item:a})})}}})).show()},hasItemActions:function(){return!0},onItemDeleted:function(a){this.store.removeSync(a.path);a==this.currentItem&&(this.currentItem=null);a&&(a=this.getView(a))&&c.destroy(a)},onItemSelected:function(a){this.currentItem=
a},onCIUpdate:function(a){a.owner===this&&this.updateCI(a.ci,a.newValue,a.oldValue,a.storeItem)},createNewGroupItem:function(a,b,c){return this.createItemStruct(a,b,c,a,!0,this.groupType)},createNewItem:function(a,b,c){return this.createItemStruct(a,b,c,c+"/"+a,!1,this.itemType)},init:function(){this.subscribe(g.EVENTS.ON_CI_UPDATE)},createItem:function(a,b,c,h,f){return this.runDeferred(null,"createItem",[a,b,c,h,f])},ls:function(a){return this.runDeferred(null,"ls",[a]).then(function(a){try{this.rawData=
a,this.initStore(a),this.publish(g.EVENTS.ON_STORE_CREATED,{data:a,owner:this,store:this.store,type:this.itemType})}catch(b){logError(b,"error ls")}}.bind(this))}})})},"xide/manager/BeanManager":function(){define("dcl/dcl dojo/_base/lang xide/utils xide/encoding/MD5 xide/registry xide/data/TreeMemory".split(" "),function(k,p,m,g,c,e){return k(null,{declaredClass:"xide.manager.BeanManager",beanNamespace:"beanNS",beanName:"beanName",createItemStruct:function(b,a,c,e,g,d){return{name:b,isDir:g,parentId:c,
path:e,beanType:d,scope:a}},getMetaValue:function(b,a){return m.getCIInputValueByName(m.getAt(b,this.itemMetaPath||"user"),a)},setCurrentItem:function(b){},getItem:function(){},onItemSelected:function(b){},onItemAdded:function(b){},onItemRemoved:function(b){},reload:function(){},getViewTarget:function(){return this.ctx.getApplication().mainView.getNewAlternateTarget()},getRightTopTarget:function(b,a,c,e){return this.ctx.getApplication().mainView.getRightTopTarget(b,a,c,e)},getLayoutRightMain:function(b,
a){return this.ctx.getApplication().mainView.getLayoutRightMain(b,a)},getRightBottomTarget:function(b,a){return this.ctx.getApplication().mainView.getRightBottomTarget(b,a)},getViewId:function(b,a){return this.beanNamespace+g(m.toString(b.scope)+m.toString(b.path),1)+(null!=a?a:"")},getView:function(b,a){var f=this.getViewId(b,a);return c.byId(f)},getStore:function(){return this.store},isValid:function(){return null!=this.store},initStore:function(b){this.store=new e({data:b.items,idProperty:"path"});
this.onStoreReady(this.store);return this.store},onStoreReady:function(){},createGroup:function(b,a,c){return this.callMethodEx(null,"createGroup",[b,a],c,!0)},removeGroup:function(b,a,c,e){return this.callMethodEx(null,"removeGroup",[b,a,c],e,!0)},removeItem:function(b,a,c,e){return this.callMethodEx(null,"removeItem",[b,a,c],e,!0)},updateCI:function(b,a,c,e){b&&e&&this.updateItemMetaData(m.toString(e.scope),m.toString(e.path),this.itemMetaStorePath||"/inputs",{id:m.toString(b.id)},{value:a})},updateItemMetaData:function(b,
a,c,e,g,d,l){return this.callMethodEx(null,"updateItemMetaData",[b,a,c,e,g],d,!1)},mergeNewModule:function(b){for(var a in b){var c=b[a];c&&_.isFunction(c)&&(this[a]=c)}},_onReloaded:function(b){this.mergeNewModule(b.prototype);b=this.declaredClass;(b=p.getObject(m.replaceAll("/",".",b))||p.getObject(b))&&b.prototype&&b.prototype.solve&&this.mergeNewModule(b.prototype)}})})},"xide/registry":function(){define(["dojo/_base/array","dojo/_base/window","xdojo/has"],function(k,p,m){var g={},c={},e={length:0,
add:function(b){this._hash[b.id]&&(this.remove(b.id),this.add(b));c[b.id]=b;this.length++},remove:function(b){c[b]&&(delete c[b],this.length--)},byId:function(b){return"string"==typeof b?c[b]:b},byNode:function(b){return c[b.getAttribute("widgetId")]},toArray:function(){return _.values(_.mapKeys(c,function(b,a){b.id=a;return b}))},getUniqueId:function(b){var a;do a=b+"_"+(b in g?++g[b]:g[b]=0);while(c[a]);return a},findWidgets:function(b,a){function f(b){for(b=b.firstChild;b;b=b.nextSibling)if(1==
b.nodeType){var d=b.getAttribute("widgetId");d?(d=c[d])&&e.push(d):b!==a&&f(b)}}var e=[];f(b);return e},_destroyAll:function(){_.each(e.findWidgets(p.body()),function(b){b._destroyed||(b.destroyRecursive?b.destroyRecursive():b.destroy&&b.destroy())})},getEnclosingWidget:function(b){for(;b;){var a=1==b.nodeType&&b.getAttribute("widgetId");if(a)return c[a];b=b.parentNode}return null},_hash:c};return e})},"xcf/manager/DriverManager_Server":function(){define(["dcl/dcl","dojo/_base/lang","dojo/_base/declare",
"xide/types","xide/utils"],function(k,p,m,g,c){return k(null,{declaredClass:"xcf.manager.DriverManager_Server",onDriverBlocksChanged:function(e,b){var a=[],f=this.getStore()||this.store;if(!f)return console.error("getDriversAsEnumeration:: have no store!"),a;a=f.query({isDir:!1});for(f=0;f<a.length;f++){var n=a[f],k=n.user;c.getInputCIByName(k,g.DRIVER_PROPERTY.CF_DRIVER_ID);c.getInputCIByName(k,g.DRIVER_PROPERTY.CF_DRIVER_NAME);k&&n.blockPath&&n.blockPath.indexOf(b)}},onFileChanged:function(e){if("changed"===
e.type&&!e._didb){e._didb=!0;var b=c.replaceAll("\\","/",e.path),b=c.replaceAll("//","/",b),b=b.replace(/\\/g,"/"),a;a=b;a=-1!=a.indexOf("system/driver")?a.substr(a.indexOf("system/driver")+14,a.length):null;a&&-1!==a.indexOf(".xblox")&&(console.log("driver blocks changed "+a+" @ "+b,e),this.onDriverBlocksChanged(b,a))}},createDriverInstance:function(e,b){var a=this,f=this.driverScopes.system_drivers+"DriverBase";require([f],function(n){n.prototype.declaredClass=f;var k=a.driverScopes[e.scope],d=
c.getCIInputValueByName(e.user,g.DRIVER_PROPERTY.CF_DRIVER_CLASS);if(d){var l=k+d,l=l.replace(".js",""),l=l.replace("./","");console.log("create driver instance "+l);require([l],function(d){d=new (m([n],d.prototype));d.baseClass=n.prototype.declaredClass;d.modulePath=c.replaceAll("//","/",l);d.delegate=a;e.instance=d;b&&b(d);try{d.start()}catch(h){}return d})}else console.error("cant find driver class in meta")})},onDeviceDisconnected:function(c){},onDeviceMessage:function(e){if(e&&e.device&&e.driverInstance){var b=
e.device,a=e.driverInstance,f=a.options;if(f){var n=[e.deviceMessage];_.isString(e.deviceMessage)&&-1!=e.deviceMessage.indexOf(a.lineBreak)&&(n=e.deviceMessage.split(a.lineBreak));if(0<n.length){e=this.ctx.getBlockManager().getScope(f.id);a=e.getBlocks({group:g.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS});f=e.getVariables({group:g.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES});a&&0!=a.length||console.log("have no response blocks, abort");var k=e.getVariable("value");k||(k=new Variable({id:c.createUUID(),
title:"value",value:"",scope:e,type:13,group:"processVariables",gui:!1,cmd:!1}));for(var d=0;d<n.length;d++)if(0!=n[d].length){k.value=n[d];console.log("update process value "+k.value+" for "+b.host);this.publish(g.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:k,scope:e,owner:this});for(var l=0;l<f.length;l++)"value"!=f[l].title&&e.expressionModel.parseVariable(e,f[l]);for(l=0;l<a.length;l++)e.solveBlock(a[l],{highlight:!0})}console.log("forward messages to scope")}}}},init:function(){this.subscribe(g.EVENTS.ON_DEVICE_MESSAGE,
this.onDeviceMessage);this.subscribe(g.EVENTS.ON_DEVICE_DISCONNECTED,this.onDeviceDisconnected)}})})},"xcf/model/Driver":function(){define(["dojo/_base/declare","xide/data/Model","xide/utils"],function(k,p,m){return k(p,{itemMetaPath:"user.meta",getStore:function(){return this._store},getScope:function(){var g=this.getStore();return g?g.scope:this.scope},getMetaValue:function(g){return m.getCIInputValueByName(this.user,g)},setMetaValue:function(g,c,e){var b=m.getCIByChainAndName(this.user,0,g);if(!b)return null;
var a=this.getMetaValue(g);m.setCIValueByField(b,"value",c);this[g]=c;if(!1!==e)return this.publish(types.EVENTS.ON_CI_UPDATE,{owner:this.owner,ci:b,newValue:c,oldValue:a})},getParent:function(){return this._store.getSync(this.parentId)}})})},"xide/data/Model":function(){define("dcl/dcl dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/when".split(" "),function(k,p,m,g,c,e){function b(a,b){var c=a.schema[b];void 0===c||c instanceof v||(c=new v(c),c._parent=a);c&&(c.name=b);return c}
function a(a,c){var d,h=a.hasOwnProperty("_properties")&&a._properties[c];d=h;h||(h=b(a,c))&&h.validate&&(h=m.delegate(h,{_parent:a,key:c}));return h&&h.validate?e(h.validate(),function(b){b||d||((a.hasOwnProperty("_properties")?a._properties:a._properties=new u)[c]=h);return b}):!0}function f(a){var b,c=1;a(function(a,d,h){a&&a.then?(c++,b||(b=new g),a.then(function(a){d(a,h);c--;c||b.resolve()}).then(null,b.reject)):d(a,h)});if(b)return c--,c||b.resolve(),b.promise}function n(){2>r&&t&&(t(),t=null);
r--}function q(){return q}var d=[].slice,l=p("xide/data/Model",null,{schema:{},additionalProperties:!0,_scenario:"update",constructor:function(a){this.init(a)},refresh:function(a){var b=this._store;b&&b.refreshItem(this,a)},getStore:function(){return this._store},init:function(a){this._scenario="insert";a=this._setValues(a);for(var b in this.schema){var c=this.schema[b];c&&"object"===typeof c&&"default"in c&&!a.hasOwnProperty(b)&&(c=c["default"],a[b]="function"===typeof c?c.call(this):c)}},_setValues:function(a){return m.mixin(this,
a)},_getValues:function(){return this._values||this},save:function(a){var b=this;return e(a&&a.skipValidation?!0:this.validate(),function(a){if(!a)throw b.createValidationError(b.errors);a=b._scenario;b.prepareForSerialization();return b._store&&e(b._store["insert"===a?"add":"put"](b),function(a){b.set(a);b._scenario="update";return b})})},remove:function(){var a=this._store;return a.remove(a.getIdentity(this))},prepareForSerialization:function(){this._scenario=void 0;this._inherited&&(this._inherited.toJSON=
q)},createValidationError:function(a){return Error("Validation error")},property:function(a,c){var h=this.hasOwnProperty("_properties")?this._properties:this._properties=new u,f=h[a];f||(f=b(this,a),f=h[a]=f?m.delegate(f):new v,f.name=a,f._parent=this);return c?f.property.apply(f,d.call(arguments,1)):f},get:function(a){var c,d=this.schema[a];return(d=c||this.schema[a])&&d.valueOf&&(d.valueOf!==z||d.hasCustomGet)?((c=c||this.hasOwnProperty("_properties")&&this._properties[a])||(c=m.delegate(b(this,
a),{name:a,_parent:this})),c.valueOf()):this._getValues()[a]},set:function(b,c){if("object"===typeof b){r++;try{for(var d in b)c=b[d],!b.hasOwnProperty(d)||c&&c.toJSON===q||this.set(d,c)}finally{n()}}else{d=this.schema[b];if(!d&&!this.additionalProperties)return console.warn("Schema does not contain a definition for",b);var h=this.hasOwnProperty("_properties")&&this._properties[b];!h&&(c&&"object"===typeof c||d&&d.put!==C)&&(h=this.property(b));h?h.put(c):(d&&d.coerce&&(c=d.coerce(c)),this._getValues()[b]=
c,d&&!1!==d.validateOnSet&&a(this,b));return c}},observe:function(a,b,c){return this.property(a).observe(b,c)},validate:function(b){var c=this,d=!0,h=[],l;if(b){l={};for(var t=0;t<b.length;t++)l[t]=!0}return e(f(function(b){for(var f in c.schema)l&&!l.hasOwnProperty(f)||b(a(c,f),function(a,b){a||(d=!1,h.push.apply(h,c.property(b).errors))},f)}),function(){c.set("errors",d?void 0:h);return d})},isValid:function(){var a=!0,b;for(b in this.schema){var c=this.hasOwnProperty("_properties")&&this._properties[b];
c&&c.errors&&c.errors.length&&(a=!1)}return a}}),r=0,h,t;(l.nextTurn=function(a){t=a}).atEnd=!0;var y=p([l],{observe:function(a,b){var c;if("string"===typeof a)return this.inherited(arguments);b&&b.onlyFutureUpdates||(c=new y,this._has()&&(c.value=a(this.valueOf())));var d=this._addListener(function(b){b=a(b);c&&c.put(b)});return c?(c.remove=d.remove,c):d},validateOnSet:!1,validators:null,_addListener:function(a){return c.after(this,"onchange",a,!0)},valueOf:function(){return this._get()},_get:function(){return this.value},
_has:function(){return this.hasOwnProperty("value")},setValue:function(a){this.value=a},put:function(a){var b=this._get();a=this.coerce(a);this.errors&&this.set("errors",void 0);var c=this;r++;return e(this.setValue(a,this._parent),function(d){void 0!==d&&(a=d);c.onchange&&c._queueChange(c.onchange,b);var h,f=b&&"object"===typeof b&&!(b instanceof Array),l=a&&"object"===typeof a&&!(a instanceof Array);if(f||l){d={};if(f)for(h in b=b._getValues?b._getValues():b,b)d[h]={old:b[h]};if(l)for(h in a=a._getValues?
a._getValues():a,a)(d[h]=d[h]||{}).value=a[h];c._values=l&&a;for(h in d)f=d[h],(l=c._properties&&c._properties[h])&&l.onchange&&l._queueChange(l.onchange,f.old)}c.validateOnSet&&c.validate();n()})},coerce:function(a){var b=this.type;b&&("string"===b?a=""+a:"number"===b?a=+a:"boolean"===b?a="false"===a||"0"===a||a instanceof Array&&!a.length?!1:!!a:"function"!==typeof b||a instanceof b||(a=new b(a)));return a},addError:function(a){this.set("errors",(this.errors||[]).concat([a]))},checkForErrors:function(a){var b=
[];this.type&&!("function"===typeof this.type?a instanceof this.type:this.type===typeof a)&&b.push(a+" is not a "+this.type);!this.required||null!=a&&""!==a||b.push("required, and it was not present");return b},validate:function(){var a=this,b=this._parent,c=this.validators,d=this.valueOf(),h=[];return e(f(function(f){function l(a){a&&h.push.apply(h,a)}if(c)for(var e=0;e<c.length;e++)f(c[e].checkForErrors(d,a,b),l);f(a.checkForErrors(d,a,b),l)}),function(){if(h.length)return a.set("errors",h),!1;
void 0!==a.get("errors")&&a.set("errors",void 0);return!0})},_queueChange:function(a,b){if(!a._queued){a._queued=!0;var c=this,d=function(){a._queued=!1;a.call(c,c._get(),b)};h&&h.push(d);h||(!l.nextTurn.atEnd||0<r?(h=[d],l.nextTurn(function(){for(var a=0;a<h.length;a++)h[a]();h=null})):d())}},toJSON:function(){return this._values||this}}),u=function(){};u.prototype.toJSON=q;var v=l.Property=p(y,{init:function(a){if("string"===typeof a||"function"===typeof a)a={type:a};a&&p.safeMixin(this,a)},_get:function(){return this._parent._getValues()[this.name]},
_has:function(){return this.name in this._parent._getValues()},setValue:function(a,b){b._getValues()[this.name]=a}}),z=v.prototype.valueOf,C=v.prototype.put;return l})},"xide/manager/ServerActionBase":function(){define("dcl/dcl dojo/_base/declare xdojo/has dojo/Deferred xide/manager/RPCService xide/manager/ManagerBase xide/types xide/utils".split(" "),function(k,p,m,g,c,e,b,a){m={declaredClass:"xide.manager.ServerActionBase",serviceObject:null,serviceUrl:null,singleton:!0,serviceClass:null,defaultOptions:{omit:!0,
checkMessages:!0,checkErrors:!0},base64_encode:function(a){var b,c,d,l,e=0,h=0,t="",t=[];if(!a)return a;do b=a.charCodeAt(e++),c=a.charCodeAt(e++),d=a.charCodeAt(e++),l=b<<16|c<<8|d,b=l>>18&63,c=l>>12&63,d=l>>6&63,l&=63,t[h++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(l);
while(e<a.length);t=t.join("");a=a.length%3;return(a?t.slice(0,a-3):t)+"\x3d\x3d\x3d".slice(a||3)},runDeferred:function(a,c,e,d){var l=new g,k;d=d||this.defaultOptions;this.check();if(!this.checkCall(a,c,d.omit))return l.reject("method doesnt exists: "+c+" for service class:"+this.serviceClass+" in "+this.declaredClass);this.prepareCall();var h=this.getService(),t=this.getServiceClass(a),m=this,u=function(a,b){var c=l;d.returnProm&&(c=k);c._data=a;if(b&&d.onError)return d.onError(b);c.resolve(a)};
k=h[t][c](e);k.then(function(a){a=a||{};var h=a.error||{};if(d.checkMessages&&h&&3==h.code)m.onMessages(h);if(d.checkErrors){if(1==h.code){m.onError(h,t+"::"+c);l.reject(h);return}}else{if(1==h.code&&d.displayError)m.onError(h,t+"::"+c);if(h&&0!=h.code){u(a,h);return}}d.omit&&m.publish(b.EVENTS.STATUS,{message:"Ok!",what:arguments},this);u(a)},function(a){m.onError(a)});return d.returnProm?k:l},getService:function(){return this.serviceObject},getServiceClass:function(a){return a||this.serviceClass},
hasMethod:function(a,b){var c=this.getService(),d=b||this.getServiceClass();return c&&d&&null!=c[d]&&null!=c[d][a]},findServiceUrl:function(a){var b=window.xFileConfig;if(b&&b.mixins)for(var c=0;c<b.mixins.length;c++){var d=b.mixins[c];if(d.declaredClass===a&&d.mixin&&d.mixin.serviceUrl)return decodeURIComponent(d.mixin.serviceUrl)}return null},init:function(){this.check()},_initService:function(){return!1},check:function(){this.serviceObject||this._initService()},onError:function(a,c){if(a)if(1===
a.code){if(a.message&&_.isArray(a.message)){this.publish(b.EVENTS.ERROR,{message:a.message.join("\x3cbr/\x3e")});return}}else 0===a.code&&this.publish(b.EVENTS.STATUS,"Ok");c&&(a.message=c+" -\x3e "+a.message);this.publish(b.EVENTS.ERROR,{error:a},this)},checkCall:function(a,b,c){a=this.getServiceClass(a);return this.getService()?this.hasMethod(b,a)||!0!==c?!0:(this.onError({code:1,message:["Sorry, server doesnt know "+b]}),!1):!1},prepareCall:function(){var b={};this.config&&this.config.RPC_PARAMS&&
(b=a.mixin(b,this.config.RPC_PARAMS.rpcFixedParams),this.serviceObject.extraArgs=b,this.config.RPC_PARAMS.rpcUserField&&(b[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.serviceObject.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.serviceObject.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken))},callMethodEx:function(a,c,e,d,l){(a=a||this.serviceClass)||console.error("have no service class! "+this.declaredClass,this);this.check();if(this.checkCall(a,
c,l)){this.prepareCall();var g=this;if(!this.getServiceClass(a))debugger;var h=this.serviceObject[this.getServiceClass(a)];if(!h||!h[c])debugger;this.serviceObject[this.getServiceClass(a)][c](e).then(function(h){try{d&&d(h)}catch(e){console.error("bad news : callback for method "+c+" caused a crash in service class "+a),logError(e,"server method failed "+e)}h&&h.error&&3==h.error.code&&setTimeout(function(){g.onMessages(h.error)},50);if(h&&h.error&&h.error&&0!=h.error.code)g.onError(h.error);else 1==
l&&g.publish(b.EVENTS.STATUS,{message:"Ok!"},this)},function(a){g.onError(a)})}},callMethodEx2:function(a,b,c,d,l){this.check();if(this.checkCall(a,b,l))return this.prepareCall(),this.serviceObject[this.getServiceClass(a)][b](c)},callMethod:function(c,e,g,d){e=e||[[]];var l=this.serviceClass;try{var k=this;if(null==this.serviceObject[l][c]){if(!0===d)this.onError({code:1,message:["Sorry, server doesnt know "+c]});return null}l={};l=a.mixin(l,this.config.RPC_PARAMS.rpcFixedParams);l[this.config.RPC_PARAMS.rpcUserField]=
this.config.RPC_PARAMS.rpcUserValue;this.serviceObject.extraArgs=l;this.serviceObject.signatureField=this.config.RPC_PARAMS.rpcSignatureField;this.serviceObject.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken;this.serviceObject[this.serviceClass][c](e).then(function(a){try{g&&g(a)}catch(h){console.error("crashed in "+c);console.dir(h);debugger}a&&a.error&&3==a.error.code&&setTimeout(function(){k.onMessages(a.error)},50);if(a&&a.error&&a.error&&1==a.error.code)k.onError(a.error);else!1!==d&&
k.publish(b.EVENTS.STATUS,{message:"Ok!"},this)},function(a){k.onError(a)})}catch(h){console.error("crash! "+h),k.onError(h)}}};k=k(e,m);k.declare=p(null,m);return k})},"xide/manager/RPCService":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang xide/rpc/Service xide/rpc/JsonRPC dojo/has dojo/Deferred xide/utils xide/types xide/mixins/EventedMixin xide/encoding/SHA1".split(" "),function(k,p,m,g,c,e,b,a,f,n,q){return k("xide.manager.RPCService",[g,n],{extraArgs:null,signatureField:"sig",
signatureToken:null,correctTarget:!0,sync:!1,defaultOptions:{omit:!0,checkMessages:!0,checkErrors:!0},onError:function(a){if(a)if(1===a.code){if(a.message&&_.isArray(a.message)){this.publish(f.EVENTS.ERROR,{message:a.message.join("\x3cbr/\x3e")});return}}else 0===a.code&&this.publish(f.EVENTS.STATUS,"Ok");this.publish(f.EVENTS.ERROR,{error:a},this)},prepareCall:function(){var b={};this.config&&this.config.RPC_PARAMS&&(this.extraArgs=b=a.mixin(b,this.config.RPC_PARAMS.rpcFixedParams),this.config.RPC_PARAMS.rpcUserField&&
(b[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken))},runDeferred:function(a,c,e,h){var g=new b;h=h||this.defaultOptions;if(!this.checkCall(a,c,h.omit))return g.reject("method doesnt exists: "+c+" for service class:"+this.serviceClass+" in "+this.declaredClass);this.prepareCall();var n=this;this[this.getServiceClass(a)][c](e).then(function(a){if(h.checkMessages&&
a&&a.error&&3==a.error.code)n.onMessages(a.error);h.checkErrors&&a&&a.error&&a.error&&0!=a.error.code?(n.onError(a.error),g.reject(a.error)):(h.omit&&n.publish(f.EVENTS.STATUS,{message:"Ok!",what:arguments},this),g.resolve(a))},function(a){n.onError(a)});return g},getParameterMap:function(a,b){var c=this._smd.services[a+"."+b];return c&&c.parameters?c.parameters:[]},_getRequest:function(a,b){var c=this._smd,h=g.envelopeRegistry.match(a.envelope||c.envelope||"NONE"),f=(a.parameters||a.params||[]).concat(c.parameters||
[]);if(h.namedParams){if(1==b.length&&m.isObject(b[0]))b=b[0];else{for(var e={},n=a.parameters||a.params,k=0;k<n.length;k++)"undefined"==typeof b[k]&&n[k].optional||(e[n[k].name]=b[k]);b=e}if(a.strictParameters||c.strictParameters)for(k in b){e=!1;for(n=0;n<f.length;n++)f[k].name==k&&(e=!0);e||delete b[k]}for(k=0;k<f.length;k++)if(e=f[k],!e.optional&&e.name&&null!=b&&!b[e.name])if(e["default"])b[e.name]=e["default"];else if(!(e.name in b))throw Error("Required parameter "+e.name+" was omitted");}else f&&
f[0]&&f[0].name&&1==b.length&&p.isObject(b[0])&&(b=!1===h.namedParams?g.toOrdered(f,b):b[0]);m.isObject(this._options)&&(b=p.mixin(b,this._options));f=a._schema||a.returns;k=h.serialize.apply(this,[c,a,b]);k._envDef=h;return p.mixin(k,{sync:this.sync,contentType:a.contentType||c.contentType||k.contentType,headers:a.headers||c.headers||k.headers||{},target:k.target||g.getTarget(c,a),transport:a.transport||c.transport||k.transport,envelope:a.envelope||c.envelope||k.envelope,timeout:a.timeout||c.timeout,
callbackParamName:a.callbackParamName||c.callbackParamName,rpcObjectParamName:a.rpcObjectParamName||c.rpcObjectParamName,schema:f,handleAs:k.handleAs||"auto",preventCache:a.preventCache||c.preventCache,frameDoc:this._options.frameDoc||void 0})},_executeMethod:function(a){var b=[],c;if(2==arguments.length&&m.isArray(arguments[1]))b=arguments[1];else for(c=1;c<arguments.length;c++)b.push(arguments[c]);var h=this._getRequest(a,b);this.correctTarget&&(h.target=this._smd.target);if(this.extraArgs)for(var f in this.extraArgs)h.target+=
-1!=h.target.indexOf("?")?"\x26":"?",h.target+=f+"\x3d"+this.extraArgs[f];this.signatureToken&&(h.target+=-1!=h.target.indexOf("?")?"\x26":"?",b=q._hmac(h.data,this.signatureToken,1),b=q._hmac(h.data,this.signatureToken,1),h.target+=this.signatureField+"\x3d"+b);b=g.transportRegistry.match(h.transport).fire(h);b.addBoth(function(a){return h._envDef.deserialize.call(this,a)});return b},getServiceClass:function(a){return a||this.serviceClass},hasMethod:function(a,b){var c=b||this.getServiceClass();
return this&&c&&null!=this[c]&&null!=this[c][a]},checkCall:function(a,b,c){a=this.getServiceClass(a);return this.hasMethod(b,a)||!0!==c?!0:(this.onError({code:1,message:["Sorry, server doesnt know "+b]}),!1)},base64_encode:function(a){var b,c,h,f,e=0,g=0,n="",n=[];if(!a)return a;do b=a.charCodeAt(e++),c=a.charCodeAt(e++),h=a.charCodeAt(e++),f=b<<16|c<<8|h,b=f>>18&63,c=f>>12&63,h=f>>6&63,f&=63,n[g++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(c)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(f);while(e<a.length);n=n.join("");a=a.length%3;return(a?n.slice(0,a-3):n)+"\x3d\x3d\x3d".slice(a||3)},callMethodEx:function(a,b,c,h,f,e){if(!this[a]||null==this[a][b])return!0===e&&f&&f({code:1,message:["Sorry, server doesnt know "+b+" in class"+a]}),null;e={};this.config&&this.config.RPC_PARAMS&&(e=m.mixin(e,this.config.RPC_PARAMS.rpcFixedParams),
e[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.extraArgs=e,this.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken);this[a][b](c).then(function(c){try{h&&h(c)}catch(e){console.error("bad news : callback for method "+b+" caused a crash in service class "+a)}c&&c.error&&c.error&&0!=c.error.code&&f&&f(c.error)},function(a){f(a)})},callMethod:function(a,b,c,h,f,e){try{var g=this;if(null==this[a][b])return!0===
e&&f&&f({code:1,message:["Sorry, server doesnt know "+b]}),null;e={};e=m.mixin(e,this.config.RPC_PARAMS.rpcFixedParams);this[a][b](c).then(function(a){try{h&&h(a)}catch(c){console.error("crashed in "+b),console.dir(c)}a&&a.error&&a.error&&1==a.error.code&&f&&f(a.error)},function(a){g.onError(a)})}catch(n){console.error("crash! "+n)}}})})},"xide/rpc/Service":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/xhr dojo/_base/declare xide/rpc/AdapterRegistry dojo/_base/url".split(" "),function(k,
p,m,g,c,e){function b(a,b){var c=a._baseUrl;a.target&&(c=new k._Url(c,a.target)+"");b.target&&(c=new k._Url(c,b.target)+"");return c}function a(a,b){if(k.isArray(b))return b;for(var c=[],h=0;h<a.length;h++)c.push(b[a[h].name]);return c}var f=new c(!0),n=new c(!0),q=1;g=g("xide.rpc.Service",null,{constructor:function(a,b){function c(a){a._baseUrl=new k._Url(k.isBrowser?location.href:k.config.baseUrl,h||".")+"";f._smd=a;b&&"methods"===b.services&&(a.services=a.methods,delete a.methods,a.transport="POST",
b.mixin&&p.mixin(a,b.mixin),b=null);for(var d in f._smd.services){a=d.split(".");for(var e=f,g=0;g<a.length-1;g++)e=e[a[g]]||(e[a[g]]={});e[a[a.length-1]]=f._generateService(d,f._smd.services[d])}}var h,f=this;if(a)if(k.isString(a)||a instanceof k._Url){h=a instanceof k._Url?a+"":a;var e=m._getText(h);if(e)c(k.fromJson(e));else throw Error("Unable to load SMD from "+a);}else c(a);this._options=b?b:{};this._requestId=0},_generateService:function(a,b){if(this[b])throw Error("WARNING: "+a+" already exists for service. Unable to generate function");
b.name=a;var c=k.hitch(this,"_executeMethod",b),h=f.match(b.transport||this._smd.transport);h.getExecutor&&(c=h.getExecutor(c,b,this));h=b.returns||(b._schema={});h._service=c;c.servicePath="/"+a+"/";c._schema=h;c.id=q++;return c},_getRequest:function(c,f){var e=this._smd,h=n.match(c.envelope||e.envelope||"NONE"),g=(c.parameters||[]).concat(e.parameters||[]);if(h.namedParams){if(1==f.length&&k.isObject(f[0]))f=f[0];else{for(var m={},q=0;q<c.parameters.length;q++)"undefined"==typeof f[q]&&c.parameters[q].optional||
(m[c.parameters[q].name]=f[q]);f=m}if(c.strictParameters||e.strictParameters)for(q in f){for(var m=!1,p=0;p<g.length;p++)g[p].name==q&&(m=!0);m||delete f[q]}for(q=0;q<g.length;q++)if(m=g[q],!m.optional&&m.name&&!f[m.name])if(m["default"])f[m.name]=m["default"];else if(!(m.name in f))throw Error("Required parameter "+m.name+" was omitted");}else g&&g[0]&&g[0].name&&1==f.length&&k.isObject(f[0])&&(f=!1===h.namedParams?a(g,f):f[0]);k.isObject(this._options)&&(f=k.mixin(f,this._options));delete f.mixin;
g=c._schema||c.returns;q=h.serialize.apply(this,[e,c,f]);q._envDef=h;return k.mixin(q,{sync:!1,contentType:c.contentType||e.contentType||q.contentType,headers:c.headers||e.headers||q.headers||{},target:q.target||b(e,c),transport:c.transport||e.transport||q.transport,envelope:c.envelope||e.envelope||q.envelope,timeout:c.timeout||e.timeout,callbackParamName:c.callbackParamName||e.callbackParamName,rpcObjectParamName:c.rpcObjectParamName||e.rpcObjectParamName,schema:g,handleAs:q.handleAs||"auto",preventCache:c.preventCache||
e.preventCache,frameDoc:this._options.frameDoc||void 0})},_executeMethod:function(a){var b=[],c;for(c=1;c<arguments.length;c++)b.push(arguments[c]);var h=this._getRequest(a,b),b=f.match(h.transport).fire(h);b.addBoth(function(a){return h._envDef.deserialize.call(this,a)});return b}});g.transportRegistry=f;g.envelopeRegistry=n;g._nextId=q;g.getTarget=b;g.toOrdered=a;g._sync=!1;n.register("URL",function(a){return"URL"==a},{serialize:function(a,b,c){return{data:k.objectToQuery(c),transport:"POST"}},
deserialize:function(a){return a},namedParams:!0});n.register("JSON",function(a){return"JSON"==a},{serialize:function(a,b,c){return{data:k.toJson(c),handleAs:"json",contentType:"application/json"}},deserialize:function(a){return a}});n.register("PATH",function(a){return"PATH"==a},{serialize:function(a,c,f){var h;a=b(a,c);if(k.isArray(f))for(h=0;h<f.length;h++)a+="/"+f[h];else for(h in f)a+="/"+h+"/"+f[h];return{data:"",target:a}},deserialize:function(a){return a}});f.register("POST",function(a){return"POST"==
a},{fire:function(a){a.url=a.target;a.postData=a.data;return k.rawXhrPost(a)}});f.register("GET",function(a){return"GET"==a},{fire:function(a){a.url=a.target+(a.data?"?"+(a.rpcObjectParamName?a.rpcObjectParamName+"\x3d":"")+a.data:"");return m.get(a)}});k._contentHandlers&&(k._contentHandlers.auto=function(a){var b=k._contentHandlers,c=a.getResponseHeader("Content-Type");return c?c.match(/\/.*json/)?b.json(a):c.match(/\/javascript/)?b.javascript(a):c.match(/\/xml/)?b.xml(a):b.text(a):b.text(a)});
return g})},"xide/rpc/AdapterRegistry":function(){define(["dojo/_base/kernel","dojo/_base/lang"],function(k,p){var m=k.AdapterRegistry=function(g){this.pairs=[];this.returnWrappers=g||!1};p.extend(m,{register:function(g,c,e,b,a){this.pairs[a?"unshift":"push"]([g,c,e,b])},match:function(){for(var g=0;g<this.pairs.length;g++){var c=this.pairs[g];if(c[1].apply(this,arguments))return c[3]||this.returnWrappers?c[2]:c[2].apply(this,arguments)}throw Error("No match found");},unregister:function(g){for(var c=
0;c<this.pairs.length;c++)if(this.pairs[c][0]==g)return this.pairs.splice(c,1),!0;return!1}});return m})},"xide/rpc/JsonRPC":function(){define(["dojo/_base/lang","dojo/_base/json","./Service","dojo/errors/RequestError"],function(k,p,m,g){function c(c){return{serialize:function(b,a,f,g){b={id:this._requestId++,method:a.name,params:f};c&&(b.jsonrpc=c);return{data:p.toJson(b),handleAs:"json",contentType:"application/json",transport:"POST"}},deserialize:function(b){if("Error"==b.name||b instanceof g)b=
p.fromJson(b.responseText);if(b.error){var a=Error(b.error.message||b.error);a._rpcErrorObject=b.error;return a}return b.result}}}m.envelopeRegistry.register("JSON-RPC-1.0",function(c){return"JSON-RPC-1.0"==c},k.mixin({namedParams:!1},c()));m.envelopeRegistry.register("JSON-RPC-2.0",function(c){return"JSON-RPC-2.0"==c},k.mixin({namedParams:!0},c("2.0")))})},"xide/encoding/SHA1":function(){define(["./_base"],function(k){function p(b,a){b[a>>5]|=128<<24-a%32;b[(a+64>>9<<4)+15]=a;for(var c=Array(80),
e=1732584193,g=-271733879,d=-1732584194,l=271733878,m=-1009589776,h=0;h<b.length;h+=16){for(var t=e,p=g,u=d,v=l,z=m,C=0;80>C;C++){if(16>C)c[C]=b[h+C];else{var B=c[C-3]^c[C-8]^c[C-14]^c[C-16];c[C]=B<<1|B>>>31}B=k.addWords(k.addWords(e<<5|e>>>27,20>C?g&d|~g&l:40>C?g^d^l:60>C?g&d|g&l|d&l:g^d^l),k.addWords(k.addWords(m,c[C]),20>C?1518500249:40>C?1859775393:60>C?-1894007588:-899497514));m=l;l=d;d=g<<30|g>>>2;g=e;e=B}e=k.addWords(e,t);g=k.addWords(g,p);d=k.addWords(d,u);l=k.addWords(l,v);m=k.addWords(m,
z)}return[e,g,d,l,m]}function m(b){for(var a=[],c=0,e=8*b.length;c<e;c+=8)a[c>>5]|=(b.charCodeAt(c/8)&255)<<24-c%32;return a}function g(b){for(var a=[],c=0,e=4*b.length;c<e;c++)a.push("0123456789abcdef".charAt(b[c>>2]>>8*(3-c%4)+4&15),"0123456789abcdef".charAt(b[c>>2]>>8*(3-c%4)&15));return a.join("")}function c(b){for(var a=[],c=0,e=32*b.length;c<e;c+=8)a.push(String.fromCharCode(b[c>>5]>>>24-c%32&255));return a.join("")}function e(b){for(var a=[],c=0,e=4*b.length;c<e;c+=3)for(var g=(b[c>>2]>>8*
(3-c%4)&255)<<16|(b[c+1>>2]>>8*(3-(c+1)%4)&255)<<8|b[c+2>>2]>>8*(3-(c+2)%4)&255,d=0;4>d;d++)8*c+6*d>32*b.length?a.push("\x3d"):a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>6*(3-d)&63));return a.join("")}k.SHA1=function(b,a){var f=a||k.outputTypes.Base64,n=p(m(b),8*b.length);switch(f){case k.outputTypes.Raw:return n;case k.outputTypes.Hex:return g(n);case k.outputTypes.String:return c(n);default:return e(n)}};k.SHA1._hmac=function(b,a,f){f=f||k.outputTypes.Base64;
var n=m(a);16<n.length&&(n=p(n,8*a.length));var q=Array(16);a=Array(16);for(var d=0;16>d;d++)q[d]=n[d]^909522486,a[d]=n[d]^1549556828;b=p(q.concat(m(b)),512+8*b.length);b=p(a.concat(b),672);switch(f){case k.outputTypes.Raw:return b;case k.outputTypes.Hex:return g(b);case k.outputTypes.String:return c(b);default:return e(b)}};return k.SHA1})},"xide/manager/ManagerBase":function(){define("dcl/dcl xide/mixins/EventedMixin xide/model/Base xide/utils dojo/_base/xhr dojo/_base/kernel".split(" "),function(k,
p,m,g,c,e){p=k([m.dcl,p.dcl],{declaredClass:"xide.manager.ManagerBase",ctx:null,init:function(){this.initReload&&this.initReload()},_getText:function(b,a){var f;a=g.mixin({url:b,sync:!0,handleAs:"text",load:function(a){f=a}},a);var e=c.get(a);return a.sync?""+f+"":e},getContext:function(){return this.ctx}});k.chainAfter(p,"init");return p})},"xide/data/Reference":function(){define(["dojo/_base/declare","xide/utils"],function(k,p){var m={_sources:[],removeSource:function(c){},updateSource:function(c){},
onSourceUpdate:function(c){},onSourceRemoved:function(c){},onSourceDelete:function(c){},onItemChanged:function(c){},destroy:function(){this.item.removeReference&&this.item.removeReference(this);this.inherited(arguments)},addSource:function(c,e){this._sources.push({item:c,settings:e});var b=this;if(e&&e.onDelete)c._store.on("delete",function(a){a.target==c&&b._store.removeSync(b[b._store.idProperty])})},updateSources:function(c){for(var e=0;e<this._sources.length;e++){var b=this._sources[e],a=b.item,
b=b.settings;c.property&&b.properties&&b.properties[c.property]&&(a._store._ignoreChangeEvents=!0,a.set(c.property,c.value),a._store._ignoreChangeEvents=!1,a._store.emit("update",{target:a}))}},constructor:function(c){this._sources=[];p.mixin(this,c)}},g=k("xgrid.data.Reference",null,m);g.Implementation=m;return g})},"xcf/manager/DeviceManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/encoding/MD5 xide/types xide/utils xide/factory xcf/manager/BeanManager xide/mixins/ReloadMixin xide/mixins/EventedMixin ./DeviceManager_Server ./DeviceManager_DeviceServer xide/data/TreeMemory dojo/has xide/data/ObservableStore dstore/Trackable xcf/model/Device dojo/Deferred xide/manager/ServerActionBase xide/data/Reference xide/utils/StringUtils xcf/mixins/LogMixin xdojo/has!xcf-ui?./DeviceManager_UI xdojo/has!xexpression?xexpression/Expression dojo/promise/all".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d,l,r,h,t,y,u,v,z,C,B,E,G,F,x,D){b=[v,a,q,d,f.dcl,B];var w=r("xcf-ui"),A=c.DEVICE_PROPERTY;r("runDrivers");var H=c.EVENTS;r("xcf-ui")&&b.push(E);return k(b,{declaredClass:"xcf.manager.DeviceManager",beanNamespace:"device",beanName:"Device",beanIconClass:"fa-sliders",groupType:c.ITEM_TYPE.DEVICE_GROUP,itemType:c.ITEM_TYPE.DEVICE,itemMetaTitleField:A.CF_DEVICE_TITLE,systemScope:"system_devices",userScope:"user_devices",appScope:"app_devices",defaultScope:"system_devices",
serviceClass:"XCF_Device_Service",rawData:null,store:null,treeView:null,deviceServerClient:null,deviceInstances:null,driverScopes:null,autoConnectDevices:!0,consoles:null,lastUpTime:null,reconnectDevice:15E3,reconnectDeviceServer:5E3,onRunClassEvent:function(a){var b=a.args.id;if(this.running&&this.running[b]&&(b=this.running[b].delegate)){if(a.error&&b.onError)b.onError(a.error);if(a.finish&&b.onFinish)b.onFinish(a.finish);if(a.progress&&b.onProgress)b.onProgress(a.progress)}},getInstanceByName:function(a){var b=
this.deviceInstances,c;for(c in b){var h=b[c].device;if(h&&this.getMetaValue(h,A.CF_DEVICE_TITLE)===a)return b[c]}},getFile:function(a){var b=new u,c=this.ctx.getFileManager().getStore(a.scope);c.initRoot().then(function(){c._loadPath(".",!0).then(function(){c.getItem(a.path,!0).then(function(a){b.resolve(a)})})});return b},getSourceHash:function(){return this.ctx.getUserDirectory()||"no_user_directory"},checkDeviceServerConnection:function(){if(!this.ctx.getNodeServiceManager)return!0;if(!this.deviceServerClient&&
this.ctx.getNodeServiceManager){var a=this.ctx.getNodeServiceManager().getStore();if(!a)return console.error("checkDeviceServerConnection : have no service store"),!1;this.createDeviceServerClient(a)}return!0},addDriverFunctions:function(a,b){for(var c in b)"constructor"!==c&&"inherited"!==c&&"getInherited"!=c&&"isInstanceOf"!=c&&"__inherited"!=c&&"onModuleReloaded"!=c&&"start"!=c&&"publish"!=c&&"subscribe"!=c&&"getInherited"!=c&&"getInherited"!=c&&_.isFunction(b[c])&&!a[c]&&(a[c]=b[c])},addLoggingFunctions:function(a,
b){var h=this;b.log=function(a,d,f,e){e=e||{};var l=m.clone(e);e.type=e.type||d||"Driver";b.options&&(e.device=b.options);h.publish(c.EVENTS.ON_SERVER_LOG_MESSAGE,{data:e,level:a||"info",message:f,details:l})}},completeDriverInstance:function(a,b,h){var d=this,f=b.blockScope.blockStore,e=h.path,l=e+"_commands",g=e+"_variables";f.on("delete",function(a){var b=-1!==a.target.declaredClass.indexOf("Variable")?g:l,c=h._store.getSync(b);c&&c.refresh();(a=h._store.getSync(b+"_reference_"+a.target.id))&&
a.refresh()});f.on("added",function(b){var d=b.name,f=b.icon||"fa-exclamation",e=-1!==b.declaredClass.indexOf("Variable"),t=e?g:l;-1!=b.declaredClass.indexOf(e?"Variable":"Command")&&(d=new z({enabled:!0,path:t+"_reference_"+b.id,name:d,id:b.id,parentId:t,_mayHaveChildren:!1,virtual:!0,tooltip:!0,icon:f,ref:{driver:a,item:b,device:h},type:c.ITEM_TYPE.BLOCK}),d=h._store.putSync(d),b.addReference(d,{properties:{name:!0,enabled:!0,value:!0},onDelete:!0},!0),d.refresh())});b.setVariable=function(b,h,
f,e,l){if(b=this.blockScope.getVariable(b))b.value=h,!1===l&&(b.__ignoreChangeMark=!0),b.set("value",h,f,e,l),!1===l&&(b.__ignoreChangeMark=!1),d.publish(c.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:b,scope:this.blockScope,driver:a,owner:d,save:!0===f,publish:e})};b.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a._getArg(a.value,!1):""};b.log=function(a,h,f,e){e=e||{};var l=m.clone(e);e.type=e.type||h||"Driver";b.options&&(e.device=b.options);d.publish(c.EVENTS.ON_SERVER_LOG_MESSAGE,
{data:e,level:a||"info",message:f,details:l})};for(var t in a)"constructor"!==t&&"inherited"!==t&&"getInherited"!=t&&"isInstanceOf"!=t&&"__inherited"!=t&&"onModuleReloaded"!=t&&"start"!=t&&"publish"!=t&&"subscribe"!=t&&"getInherited"!=t&&"getInherited"!=t&&m.isFunction(a[t])&&!b[t]&&(b[t]=a[t])},getDevice:function(a){var b=a;if(_.isString(a)){var c=this.getItemById(a);c?b=c:(a=this.getItemByPath(a))&&(b=a)}return b},stopDevice:function(a){var b=this.getDevice(a)||a;if(b){if(this.checkDeviceServerConnection(),
b._userStopped=!0,(a=this.toDeviceControlInfo(b))&&(a.serverSide||b.isServer())){var h=a.hash;this.deviceInstances[h]&&(this._removeInstance(this.deviceInstances[h],h,b),delete this.deviceInstances[h],this.sendManagerCommand(c.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER,a))}}else console.error("cant find device "+a)},getStores:function(){return this.stores},getStore:function(a){a=a||"system_devices";var b=this.stores[a];if(b)return b;if(a)return this.ls(a)},getDevices:function(a,b){var c=this.getStore();
if(!c)return[];c=e.queryStore(c,{isDir:!1});c._S&&(c=[c]);for(var h=[],d=0;d<c.length;d++){var f=c[d],l=this.getMetaValue(f,A.CF_DEVICE_ENABLED);if(!0===a&&1==l||null==l||!1===a)h.push(f),1==b&&(l=this.getMetaValue(f,A.CF_DEVICE_DRIVER))&&(l=this.ctx.getDriverManager().getItemById(l))&&(f.driver=l)}return h},getStores:function(){var a=[],b;for(b in this.stores){var c=this.stores[b];c&&a.push(c)}return a},getStorePath:function(a){var b=this.getContext().getResourceManager();if("user_devices"===a)return b.getVariable("USER_DIRECTORY")},
connectToAllDevices:function(){function a(b){if(!b)console.error("have no device store");else if(!b.connected){b.connected=!0;b=e.queryStore(b,{isDir:!1});b._S&&(b=[b]);_.isArray(b)||(b=[b]);for(var d=0;d<b.length;d++){var f=b[d],l=c.getMetaValue(f,A.CF_DEVICE_ENABLED);if(1==l||null==l)f=c.startDevice(f),h.push(f)}}}if(this.deviceServerClient){var b=this.getStores(),c=this;if(this.getStores().length){var h=[];_.each(b,a,this);return h}}else this.checkDeviceServerConnection()},debug:function(){console.info("Debug info stores : ");
_.each(this.stores,function(a){console.log("have store "+a.scope)})},_getLogText:function(a){return moment().format("HH:mm:ss:SSS")+" ::   "+a+""},_parse:function(a,b){var h=""+b;if(0<h.indexOf("{{")||0<h.indexOf("}}"))console.time("parse expression"),h=(new G).parse(c.EXPRESSION_PARSER.FILTREX,h,this,{variables:a.getVariablesAsObject(),delimiters:{begin:"{{",end:"}}"}}),console.timeEnd("parse expression");else{var d=a.parseExpression(b);d&&(h=d)}return h},runCommand:function(a,b){},_lastActions:null,
onStoreReloaded:function(a){this.completeDeviceStore()},getInstance:function(a){if(a=a?a._store?this.toDeviceControlInfo(a):a:null)return this.getDriverInstance(a,!1)},getDriverInstance:function(a,b){if(!a)return console.error("getDriverInstance::have no device info"),null;for(var h in this.deviceInstances){var d=this.deviceInstances[h],f=d.options;if(f&&f.port===a.port&&f.host===a.host&&f.protocol===a.protocol&&f.isServer===a.isServer)return b&&d.sendSettings&&r("xcf-ui")&&(b=!1),!1!==b&&d&&!d.sendSettings&&
(h=this.ctx.getDriverManager().getItemById(a.driverId))&&(h=h.user,(f=e.getCIByChainAndName(h,0,c.DRIVER_PROPERTY.CF_DRIVER_COMMANDS))&&f.params&&(d.sendSettings=e.getJson(f.params)),(h=e.getCIByChainAndName(h,0,c.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&h.params&&(d.responseSettings=e.getJson(h.params))),d}return null},_reconnectServerTimer:null,onDeviceServerConnectionLost:function(){if(!this.deviceServerClient||!this.deviceServerClient.pageUnloaded)if(this.deviceServerClient&&(this.deviceServerClient.destroy(),
this.deviceServerClient=null),!this._reconnectServerTimer){var a=this;w&&a.ctx.getNotificationManager().postMessage({message:"Lost connection to device server, try reconnecting in 5 seconds",type:"error",showCloseButton:!0,duration:1E3});this._reconnectServerTimer=setTimeout(function(){a.checkDeviceServerConnection();a._reconnectServerTimer=null},this.reconnectDeviceServer);console.log("lost device server connection");_.each(this.deviceInstances,function(a){if(a&&a.device&&!a.domNode){a=a.device;
var b=a.driverInstance;b&&b.onLostServer&&b.onLostServer();a.setState(c.DEVICE_STATE.LOST_DEVICE_SERVER)}})}},onMQTTMessage:function(a){var b=e.getJson(a.message),h=!1;if(b){var d=b.sourceHost,f=b.sourcePort,l=a.host,g=a.port;d&&f&&d===l&&f==g&&(h=!0)}if(!h&&(h=a.topic.split("/"),4==h.length&&"Variable"==h[2]&&b.device))if(this.getDeviceStoreItem(b.device)){if(a=this.toDeviceControlInfo(b.device))if(a=this.getDriverInstance(a))if(a=a.blockScope.getVariable(h[3]))r("xcf-ui")?(a.set("value",b.value),
a.refresh()):(delete a.value,a.value=b.value),this.publish(c.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:a,scope:a.scope,owner:this,save:!1,publish:!0,source:"mqtt",publishMQTT:!1})}else console.error("cant find device for : "+a.topic)},getBlock:function(a){for(var b in this.deviceInstances){var c=this.deviceInstances[b];if(c&&c.device&&(c=c.blockScope)&&(c=c.resolveBlock(a)))return c}return this.ctx.getDriverManager().getBlock(a)},onNodeServiceStoreReady:function(a){this.deviceServerClient&&this.deviceServerClient.destroy();
this.createDeviceServerClient(a.store)},onDriverUpdated:function(a,b){},onModuleReloaded:function(a){if(0!=this.deviceInstances.length){var b=e.replaceAll("//","/",a.module);a=a.newModule;for(var c in this.deviceInstances){var h=this.deviceInstances[c];if(h.modulePath===b||h.baseClass===b)this.mergeFunctions(h,a.prototype),h.blockScope&&(h.blockScope.expressionModel.expressionCache={}),this.onDriverUpdated(h,b)}}},_removeInstance:function(a,b,c){a.destroy&&a.destroy();a.blockScope&&a.blockScope._destroy();
delete this.deviceInstances[b];this.ctx.getBlockManager().removeScope(a.options.id);this.ctx.getDriverManager().removeDriverInstance(a,c);c.reset()},removeDriverInstance:function(a){if(a=this.getDriverInstance(a))this.ctx.getBlockManager().removeScope(a.options.id),a.blockScope&&a.blockScope.destroy(),a.destroy();for(var b in this.deviceInstances)a==this.deviceInstances[b]&&delete this.deviceInstances[b]},getMetaValue:function(a,b){var c=a.user;return c?e.getCIInputValueByName(c,b):null},getDeviceByHost:function(a,
b){for(var c=e.queryStore(this.getStore(),{isDir:!1}),h=0;h<c.length;h++){var d=c[h],f=this.getMetaValue(d,A.CF_DEVICE_HOST),l=this.getMetaValue(d,A.CF_DEVICE_PORT);if(f==a&&l==b)return d}return null},getDeviceByUrl:function(a){a=e.parse_url(a);a=e.urlArgs(a.host);return this.getDeviceById(a.device.value)},getDeviceById:function(a,b){function c(b){b=e.queryStore(b,{isDir:!1});b._S&&(b=[b]);for(var d=0;d<b.length;d++){var f=b[d];if(h.getMetaValue(f,A.CF_DEVICE_ID)==a)return f}return null}var h=this,
d=_.isString(b)?this.getStore(b):null;if(d)return c(d);for(var f in this.stores)if(d=c(this.stores[f]))return d;return null},getDeviceByName:function(a,b){function c(b){b=e.queryStore(b,{isDir:!1});b._S&&(b=[b]);for(var d=0;d<b.length;d++){var f=b[d];if(h.getMetaValue(f,A.CF_DEVICE_TITLE)==a)return f}return null}var h=this,d=_.isString(b)?this.getStore(b):null;if(d)return c(d);for(var f in this.stores)if(d=c(this.stores[f]))return d;return null},getDevicesByDriverId:function(a){var b=e.queryStore(this.getStore(),
{isDir:!1});b._S&&(b=[b]);for(var c=0;c<b.length;c++){var h=b[c];if(this.getMetaValue(h,A.CF_DEVICE_ID)==a)return h}return null},_cachedItems:null,getDeviceStoreItem:function(a){if(a){if(!w&&a.hash&&this._cachedItems){var b=this._cachedItems[a.hash];if(b)return b}var c=this.getStore(a.deviceScope);if(c){var h=e.queryStore(c,{isDir:!1});if(!h)return null;h&&!_.isArray(h)&&(h=[h]);for(var d=0;d<h.length;d++){var b=h[d],f=b.user,l=e.getCIInputValueByName(f,A.CF_DEVICE_HOST),g=e.getCIInputValueByName(f,
A.CF_DEVICE_PORT),t=e.getCIInputValueByName(f,A.CF_DEVICE_ID),f=e.getCIInputValueByName(f,A.CF_DEVICE_PROTOCOL);if(g===a.port&&l===a.host&&f===a.protocol&&b.isServer()===a.isServer&&t===a.id)return(c=c.getSync(b.path))&&(b=c),!w&&a.hash&&(this._cachedItems||(this._cachedItems={}),this._cachedItems[a.hash]=b),b}}}},onDriverSettingsChanged:function(a,b){for(var h in this.deviceInstances){var d=this.deviceInstances[h];if(d&&d.driver==b){h=b.user;var f=e.getCIByChainAndName(h,0,c.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);
f&&f.params&&f==a&&(d.sendSettings=e.getJson(f.params));(h=e.getCIByChainAndName(h,0,c.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&h.params&&(d.responseSettings=e.getJson(h.params));break}}},onDeviceStateChanged:function(a,b){!0!==a._userStopped&&!0!==b&&a.info&&a.state&&a.state==c.DEVICE_STATE.DISCONNECTED&&this.ctx.getNotificationManager().postMessage({message:"Lost connection to "+a.info.host+", ...reconnecting",type:"error",showCloseButton:!1,duration:1500});!0!==b&&a.info&&a.state&&a.state==c.DEVICE_STATE.CONNECTED&&
this.ctx.getNotificationManager().postMessage({message:"Connected to "+a.info.host+"",type:"success",showCloseButton:!1,duration:2E3})},connectDevice:function(a){this.checkDeviceServerConnection();var b=this.toDeviceControlInfo(a);if(b){var h=b.hash;if(this.deviceInstances[h])return a.setState(c.DEVICE_STATE.CONNECTED),this.deviceInstances[h];a.setState(c.DEVICE_STATE.CONNECTING);this.publish(c.EVENTS.ON_STATUS_MESSAGE,{text:"Trying to connect to "+b.toString(),type:"info"});this.sendManagerCommand(c.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,
b)}else console.error("couldnt start device, invalid control info")},onAppReady:function(a){a=a.context;a.deviceManager=this;a.driverManager=this;a.blockManager&&e.mixin(a.blockManager.scopes,this.ctx.getBlockManager().scopes)},onHaveNoDeviceServer:function(){if(this.ctx.getNotificationManager())var a=this,b=this.ctx.getNotificationManager().postMessage({message:"Have no device server connection",type:"error",showCloseButton:!0,duration:1500,actions:{reconnect:{label:"Reconnect",action:function(){a.checkDeviceServerConnection();
return b.update({message:"Reconnecting...",type:"success",actions:!1,duration:1500})}}}})},setDriverScriptContent:function(a,b,c,h,d){return this.callMethodEx(null,"setDriverContent",[a,b,c],h,!0)},getDriverScriptContent:function(a,b,c,h){return this.callMethodEx(null,"getDriverContent",[a,b],c,!0)},createStore:function(a,b,c){a=new (p("deviceStore",[l,t,h],{}))({data:a.items,idProperty:"path",Model:y,id:e.createUUID(),scope:b,observedProperties:["name","state","iconClass","enabled"]});b&&!1!==c&&
this.setStore(b,a);return a},initStore:function(a,b,c){return this.createStore(a,b,c)},fixDeviceCI:function(a){var b=a.user,c=e.getCIByChainAndName(b,0,A.CF_DEVICE_DRIVER_OPTIONS);c?(c.data=[{value:2,label:"Runs Server Side"},{value:4,label:"Show Debug Messages"},{value:8,label:"Allow Multiple Device Connections"},{value:16,label:"Server"}],c.group="Common"):b.inputs.push({chainType:0,"class":"cmx.types.ConfigurableInformation",dataRef:"",dataSource:"",description:null,enabled:!0,enumType:"-1",flags:-1,
group:"Common",id:A.CF_DEVICE_DRIVER_OPTIONS,name:A.CF_DEVICE_DRIVER_OPTIONS,order:1,params:null,platform:null,title:"Driver Options",type:5,uid:"-1",value:0,data:[{value:2,label:"Runs Server Side"},{value:4,label:"Show Debug Messages"},{value:8,label:"Allow Multiple Device Connections"},{value:16,label:"Server"}],visible:!0,device:a});(c=e.getCIByChainAndName(b,0,A.CF_DEVICE_LOGGING_FLAGS))?c.group="Logging":b.inputs.push({chainType:0,"class":"cmx.types.ConfigurableInformation",dataRef:"",dataSource:"",
description:null,enabled:!0,enumType:"-1",flags:-1,group:"Logging",id:A.CF_DEVICE_LOGGING_FLAGS,name:A.CF_DEVICE_LOGGING_FLAGS,order:1,params:null,platform:null,title:"Logging Flags",type:A.CF_DEVICE_LOGGING_FLAGS,uid:"-1",value:0,data:[{value:2,label:"On Connected"},{value:4,label:"On Disconnected"},{value:8,label:"On Error"},{value:16,label:"Commands"},{value:32,label:"Responses"}],visible:!0,device:a});if(a=e.getCIByChainAndName(b,0,A.CF_DEVICE_PROTOCOL))a.type=3,a.options=[{label:"TCP",value:"tcp"},
{label:"UDP",value:"udp"},{label:"Driver",value:"driver"},{label:"SSH",value:"ssh"},{label:"Serial",value:"serial"},{label:"MQTT",value:"mqtt"}]},_deviceInfoCache:null,toDeviceControlInfo:function(a){if(!a)return null;r("xcf-ui");if(!a._store&&a.id){var b=this.getItemById(a.id);b&&(a=b)}if(!a||!a.path)if(b=this.getDeviceStoreItem(a),!b)return null;var h=a.user,b=e.getCIInputValueByName(h,A.CF_DEVICE_HOST),d=e.getCIInputValueByName(h,A.CF_DEVICE_PORT),f=e.getCIInputValueByName(h,A.CF_DEVICE_TITLE),
l=e.getCIInputValueByName(h,A.CF_DEVICE_PROTOCOL),t=e.getCIInputValueByName(h,A.CF_DEVICE_DRIVER),n=e.getCIInputValueByName(h,A.CF_DEVICE_OPTIONS),k=e.getCIInputValueByName(h,A.CF_DEVICE_LOGGING_FLAGS),h=e.getCIInputValueByName(h,A.CF_DEVICE_DRIVER_OPTIONS),m=a.isServerSide(),q=a.isServer(),p=null;this.fixDeviceCI(a);var u=this.ctx.getDriverManager().getDriverById(t);if(u){var y=u.user,p=e.getCIInputValueByName(y,c.DRIVER_PROPERTY.CF_DRIVER_CLASS),y=e.getCIByChainAndName(y,0,c.DRIVER_PROPERTY.CF_DRIVER_RESPONSES),
v={},u=u.scope;y&&y.params&&(v=e.getJson(y.params));p={host:b,port:d,protocol:l,driver:p?p.replace("./",""):"",driverId:t,driverScope:u,id:a.id,devicePath:a.path,deviceScope:a.getScope(),title:f,options:n,driverOptions:h,serverSide:m,isServer:q,responseSettings:v,source:w?"ide":"server",user_devices:this.ctx.getMount(a.getScope()),system_devices:this.ctx.getMount("system_devices"),system_drivers:this.ctx.getMount("system_drivers"),user_drivers:this.ctx.getMount("user_drivers"),loggingFlags:k,toString:function(){return a.getScope()+
"://"+this.host+":"+this.port+"@"+this.protocol}};p.hash=g(JSON.stringify({host:b,port:d,protocol:l,driverId:t,driverScope:u,id:a.id,devicePath:a.path,deviceScope:a.getScope(),source:w?"ide":"server",user_devices:this.ctx.getMount(a.getScope()),system_devices:this.ctx.getMount("system_devices"),system_drivers:this.ctx.getMount("system_drivers"),user_drivers:this.ctx.getMount("user_drivers")}),1);if(b=this.ctx.getUserDirectory())p.userDirectory=b}a.info=p;r("xcf-ui");return p},getItemById:function(a){for(var b in this.stores){var c;
c=this.stores[b];var h=_.find(c.data,{id:a});c=h?c.getSync(h.path):null;if(c)return c}},getItemByPath:function(a){for(var b in this.stores){var c=this.stores[b].getSync(a);if(c)return c}},onStoreCreated:function(a){var b=this,h=b.ctx,d=a.type,f=a.store,l=f?e.queryStore(f,{isDir:!1}):[],g=this.ctx.getDriverManager();l&&!_.isArray(l)&&(l=[l]);if(d===c.ITEM_TYPE.DEVICE){for(d=0;d<l.length;d++){var t=f.getSync(l[d].path);if(!t)console.error("cant find "+l[d].path);else if(null==t._completed){t._completed=
!0;var n=this.getMetaValue(t,A.CF_DEVICE_DRIVER);n?(n=g.getItemById(n),_.each(t.user.inputs,function(a){a.device=t;a.actionTarget=w?h.mainView.getToolbar():null;a.ctx=h}),!_.isEmpty(n)&&w&&(this.completeDevice(f,t,n),t.iconClass=t.getStateIcon())):console.error("device has no driver id!")}}F(this.connectToAllDevices()).then(function(){b.publish("DevicesConnected",a)})}},onClientMessage:function(a){this.checkDeviceServerConnection();this.deviceServerClient&&this.sendManagerCommand(c.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE,
a)},onClientLogMessage:function(a){},onVariableChanged:function(a){var b=a.item,h=a.scope,d=b.name,f=!1!==a.publish;"value"!==d&&!1!==f&&b&&(b=b.value,(h=h.device)&&h.info&&(h=h.info,d=h.host+"/"+h.port+"/Variable/"+d,!1!==a.publishMQTT&&this.sendManagerCommand(c.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH,{topic:d,data:{value:b,device:h}})))},init:function(){var a=this;this.initUI&&this.initUI();this.stores={};this._deviceInfoCache={};this.subscribe(c.EVENTS.ON_DRIVER_VARIABLE_CHANGED,this.onVariableChanged);
this.subscribe(c.EVENTS.ON_DEVICE_SERVER_CONNECTED,function(){a.autoConnectDevices&&F(a.connectToAllDevices()).then(function(){a.publish("DevicesConnected")})});this.subscribe([H.ON_NODE_SERVICE_STORE_READY,H.ON_MODULE_RELOADED,H.ON_DEVICE_DISCONNECTED,H.ON_DEVICE_CONNECTED,H.ON_CLIENT_LOG_MESSAGE,H.ON_STORE_CREATED]);this.deviceInstances=this.consoles={};this.driverScopes={system_drivers:"system_drivers/",user_drivers:"user_drivers/"};this.lastUpTime=(new Date).getTime();setInterval(function(){var b=
(new Date).getTime();3E4<b-a.lastUpTime&&(a.lastUpTime=(new Date).getTime());a.lastUpTime=b},1E3);this.initReload()},onDeviceServerConnected:function(){var a=this;this.deviceInstances&&_.each(this.deviceInstances,function(b){b&&b.device&&!b.domNode?a.startDevice(b.device):console.log("invalid instance")})},addDeviceInstance:function(a,b){},ls:function(a,b,h){function d(h){try{var e=this.createStore(h,a,!0===b?!1:!0);!1!==b&&this.setStore(a,e);this.onStoreReady(e);!1!==b&&this.publish(c.EVENTS.ON_STORE_CREATED,
{data:h,owner:this,store:e,type:this.itemType});f.resolve(e)}catch(l){logError(l,"error ls drivers")}}var f=new u;r("php")?this.runDeferred(null,"ls",[a]).then(d.bind(this)):f.resolve({items:[]});return f},hasStore:function(a){return this.stores[a]}})})},"xcf/manager/DeviceManager_Server":function(){define(["dcl/dcl"],function(k){return k(null,{})})},"xcf/manager/DeviceManager_DeviceServer":function(){define("dcl/dcl xide/encoding/MD5 xide/types xide/utils xide/factory xdojo/has dojo/Deferred xide/mixins/ReloadMixin xide/mixins/EventedMixin require xcf/model/Variable xdojo/has!host-node?nxapp/utils/_console".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d){var l="undefined"!==typeof window?window.console:"undefined"!==typeof global?global.console:d;d&&(l=d);var r=e("xcf-ui");String.prototype.setBytes||(String.prototype.setBytes=function(a){this.bytes=a});String.prototype.getString||(String.prototype.getString=function(){return this.string});String.prototype.setString||(String.prototype.setString=function(a){this.string=a});String.prototype.getBytes||(String.prototype.getBytes=function(){return this.bytes?this.bytes:
g.stringToBuffer(this)});String.prototype.hexString||(String.prototype.hexString=function(){var a=this.getBytes();return g.bufferToHexString(a)});Array.prototype.shuffle||(Array.prototype.shuffle=function(){for(var a=this.length,b,c;0<a;)c=Math.random()*a--|0,b=this[a],this[a]=this[c],this[c]=b});var h=!1;if("undefined"!==typeof sctx&&sctx)g.createUUID(),sctx.getResourceManager(),sctx.getApplication();else return k(null,{declaredClass:"xcf.manager.DeviceManager_DeviceServer",running:null,onDeviceStarted:function(a,
b,c){if(a&&b&&c){var h=this.toDeviceControlInfo(b),d=h.serverSide,f=h.isServer,e=a.blockScope;(d||f||!d&&!f)&&e.start();a.__didStartBlocks=!0;this.publish(m.EVENTS.ON_DEVICE_DRIVER_INSTANCE_READY,{device:b,instance:a,driver:c,blockScope:e});this.publish(m.EVENTS.ON_DEVICE_CONNECTED,{device:h,instance:a,driver:c,blockScope:e});this.ctx.getDriverManager().addDeviceInstance(b,c)}},runClass:function(a,b,c){this.checkDeviceServerConnection();if(this.deviceServerClient){var h=g.createUUID();b.id=h;var d=
{"class":a,args:b,manager_command:m.SOCKET_SERVER_COMMANDS.RUN_CLASS};!this.running&&(this.running={});this.running[h]={"class":a,args:b,delegate:c};this.deviceServerClient.emit(null,d,m.SOCKET_SERVER_COMMANDS.RUN_CLASS)}else this.onHaveNoDeviceServer()},startDevice:function(a,c,d){var f=this;if(!a)return l.error("start device invalid item"),null;this.checkDeviceServerConnection();a.check();h=!0;var e=new b;a._startDfd&&!a._startDfd.isResolved()||a.driverInstance||a.reset();!0===c&&a.setMetaValue(m.DEVICE_PROPERTY.CF_DEVICE_ENABLED,
!0,!1);a.getMetaValue(m.DEVICE_PROPERTY.CF_DEVICE_ENABLED);var k=this.toDeviceControlInfo(a);if(!k)return l.error("invalid client info, assuming no driver found"),e.reject("invalid client info, assuming no driver found"),e;if(!k)return l.error("couldnt start device, invalid control info "+k.toString()),e.reject(),e;var q=k.hash;c=a.state===m.DEVICE_STATE.LOST_DEVICE_SERVER;if(this.deviceInstances[q]&&!0!==c)return h&&l.warn("device already started : "+k.toString()),e.resolve(this.deviceInstances[q]),
e;if(c&&this.deviceInstances[q])return f.publish(m.EVENTS.ON_STATUS_MESSAGE,{text:"Trying to re-connect to "+k.toString(),type:"info"}),f.sendManagerCommand(m.SOCKET_SERVER_COMMANDS.CREATE_CONNECTION,k),a.setState(m.DEVICE_STATE.CONNECTING),e.resolve(this.deviceInstances[q]),e;a.setState(m.DEVICE_STATE.CONNECTING);a._userStopped=null;a._startDfd=e;c=this.driverScopes.system_drivers;var p=c+"DriverBase";try{n([p],function(b){b.prototype.declaredClass=p;f.createDriverInstance(k,b,a).then(function(b){b.id||
(b.id=g.createUUID());b||l.warn("buildMQTTParams:have no driver instance");k.mqtt={driverScopeId:b&&b.blockScope?b.blockScope.id:"have no driver instance",driverId:b?b.driver.id:"have no driver id",deviceId:a.path};f.publish(m.EVENTS.ON_STATUS_MESSAGE,{text:"Trying to connect to "+k.toString(),type:"info"});a._startDfd&&!a._startDfd.isResolved()?f.sendManagerCommand(m.SOCKET_SERVER_COMMANDS.CREATE_CONNECTION,k):f.sendManagerCommand(m.SOCKET_SERVER_COMMANDS.START_DEVICE,k);e.resolve(f.deviceInstances[q]);
delete k.mqtt}).then(function(){},function(a){e.resolve(null)})},function(a){l.error(a)})}catch(r){logError(r,"DeviceManager::startDevice: requiring base driver at "+p+" failed! Base Driver - Prefix : "+c)}return e},createDriverInstance:function(c,h,d){var e=c.hash,q=this.driverScopes[c.driverScope],p=!n.cache,r=n.toUrl(q),r=g.removeURLParameter(r,"bust");p&&(r=r.replace("/.js","/"));var E=decodeURIComponent(r)+c.driver,E=E.replace("","").trim(),G=this,r=G.ctx,p=g.getCIInputValueByName(d.user,m.DEVICE_PROPERTY.CF_DEVICE_DRIVER),
r=r.getDriverManager(),F=r.getDriverById(p),x=new b;d.getMetaValue(m.DEVICE_PROPERTY.CF_DEVICE_ENABLED);d.isEnabled();if(!(d.isServerSide()||d.isServer()||c.isServer||c.serverSide))return x.reject("DeviceManager_DeviceServer: wont create driver instance! I am server and device isnt server side : "+c.title),x;try{r.getDriverModule(F).then(function(b){var n=new (k([h,f.dcl,a.dcl,b],{}));n.declaredClass=E;n.options=c;n.baseClass=h.prototype.declaredClass;n.modulePath=g.replaceAll("//","/",q+c.driver).replace(".js",
"");n.delegate=G;n.driver=F;n.serverSide=c.serverSide;n.utils=g;n.types=m;n.device=d;n.Module=b;n.id=g.createUUID();n.getDevice=function(){return this.device};n.getDeviceInfo=function(){return this.getDevice().info};b=F.user;var p=g.getCIByChainAndName(b,0,m.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);p&&p.params&&(n.sendSettings=g.getJson(p.params));(b=g.getCIByChainAndName(b,0,m.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&b.params&&(n.responseSettings=g.getJson(b.params));try{n.start(),n.initReload()}catch(r){l.error("crash in driver instance startup! "+
d.toString()),logError(r,"crash in driver instance startup!")}G.deviceInstances[e]=n;F.blox&&F.blox.blocks||(F.blox={blocks:[]});d.driverInstance=n;G.getDriverInstance(c,!0);n._id=g.createUUID();x.resolve(n);return n})}catch(D){l.error("DeviceManager::createDriverInstance:: requiring base driver at "+E+" failed "+D.message,g.inspect(c))}return x},createDriverInstance_bak:function(c,h,d){var e=c.hash,q=this.driverScopes[c.driverScope],p=!n.cache,r=n.toUrl(q),r=g.removeURLParameter(r,"bust");p&&(r=
r.replace("/.js","/"));var E=decodeURIComponent(r)+c.driver,E=E.replace("","").trim(),G=this,p=G.ctx,r=g.getCIInputValueByName(d.user,m.DEVICE_PROPERTY.CF_DEVICE_DRIVER),F=p.getDriverManager().getDriverById(r),x=new b;d.getMetaValue(m.DEVICE_PROPERTY.CF_DEVICE_ENABLED);if(!1===d.isEnabled())return setTimeout(function(){x.reject()}),x;if(!d.isServerSide())return x.reject("DeviceManager_DeviceServer: wont create driver instance! I am server and device isnt server side : "+c.title),x;try{n([E],function(b){var n=
new (k([h,f.dcl,a.dcl,b],{}));n.declaredClass=E;n.options=c;n.baseClass=h.prototype.declaredClass;n.modulePath=g.replaceAll("//","/",q+c.driver).replace(".js","");n.delegate=G;n.driver=F;n.serverSide=c.serverSide;n.utils=g;n.types=m;n.device=d;n.Module=b;n.getDevice=function(){return this.device};n.getDeviceInfo=function(){return this.getDevice().info};b=F.user;var p=g.getCIByChainAndName(b,0,m.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);p&&p.params&&(n.sendSettings=g.getJson(p.params));(b=g.getCIByChainAndName(b,
0,m.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&b.params&&(n.responseSettings=g.getJson(b.params));try{n.start(),n.initReload()}catch(r){l.error("crash in driver instance startup! "+d.toString()),logError(r,"crash in driver instance startup!")}G.deviceInstances[e]=n;F.blox&&F.blox.blocks||(F.blox={blocks:[]});d.driverInstance=n;G.getDriverInstance(c,!0);n._id=g.createUUID();x.resolve(n);return n})}catch(D){l.error("DeviceManager::createDriverInstance:: requiring base driver at "+E+" failed "+D.message,
g.inspect(c))}return x},onSetDeviceServerVariables:function(a){var b=this.getDriverInstance(a.device,!0),c=this.getDeviceStoreItem(a.device);if(c){if(!b.blockScope){var d=c.info,f=d.hash,e=b.driver,n=d.driverId,k=this.getContext(),d=d.serverSide,q=n+"_"+f+"_"+c.path;e.blox&&e.blox.blocks||(e.blox={blocks:[]});e.blockPath&&(g.getJson(g.readFile(e.blockPath)),e.blox=g.getJson(g.readFile(e.blockPath)));f=k.getBlockManager().createScope({id:q,device:c,driver:e,instance:b,serviceObject:this.serviceObject,
ctx:k,serverSide:d,getContext:function(){return this.instance}},g.clone(e.blox.blocks),function(a){a&&l.error(a+" : in "+e.name+" Resave Driver! in scope id "+q)});b.blockScope=f;c.blockScope=f;r&&this.completeDriverInstance(e,b,c)}if(b){var f=a.variables,p=b.blockScope;c.serverVariables=a.variables;_.each(f,function(a){var b=p.getVariable(a.name);b&&(b.value=a.value)})}this.onDeviceConnected(a,!1);c.setState(m.DEVICE_STATE.SYNCHRONIZING);c.setState(m.DEVICE_STATE.READY);c._startDfd&&c._startDfd.resolve(c.driverInstance);
delete c._userStopped;delete c.lastError;delete c._startDfd;c._startDfd=null}else h&&l.log("did set device server variables failed, have no device",a)},getDeviceServerVariables:function(a,b){var c=b.driver;c.blox&&c.blox.blocks||(c.blox={blocks:[]});var h=[];_.each(c.blox.blocks,function(a){a.group===m.BLOCK_GROUPS.CF_DRIVER_BASIC_VARIABLES&&h.push(a)});for(var c=[],d=0;d<h.length;d++)c.push({name:h[d].name,value:h[d].value,initial:h[d].value});a.setState(m.DEVICE_STATE.SYNCHRONIZING);this.sendManagerCommand(m.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES,
{device:this.toDeviceControlInfo(a),variables:c})},onDeviceConnected:function(a,b){var c=this.getDeviceStoreItem(a.device);if(a.isReplay&&c&&c.state===m.DEVICE_STATE.READY)c.setState(m.DEVICE_STATE.READY);else{var d=this.getDriverInstance(a.device,!0)||a.instance;if(d)if(c){var f=this.toDeviceControlInfo(c);if(f)if(!f.serverSide&&h&&l.error("onDeviceConnected:: device info is not server side, abort"),d&&!c.serverVariables)c.setState(m.DEVICE_STATE.CONNECTED),this.getDeviceServerVariables(c,d);else if(f){var e=
f.hash;if(this.deviceInstances[e]){if(!d.__didStartBlocks)this.onDeviceStarted(d,c,d.driver);c.setState(m.DEVICE_STATE.READY);this.publish(m.EVENTS.ON_STATUS_MESSAGE,{text:'Device is Ready \x3cspan class\x3d"text-success"\x3e'+f.host+":"+f.port+"\x3c/span\x3e",type:"success"});return this.deviceInstances[e]}var g=this,k=this.driverScopes.system_drivers+"DriverBase";try{n([k],function(a){a.prototype.declaredClass=k;g.createDriverInstance(f,a,c)})}catch(q){l.error("requiring base driver at "+k+" failed",
q)}}else l.error("couldnt start device, invalid control info");else h&&l.error("onDeviceConnected:: device info  is null")}else h&&l.error("onDeviceConnected:: deviceStoreItem is null");else c&&c.setState(m.DEVICE_STATE.DISCONNECTED)}},onDeviceDisconnected:function(a){if(a&&a.device){var b=a.error,c=b&&b.code?b.code:b||"",d=this.getDeviceStoreItem(a.device);if(d)if(!0===a.stopped)this.stopDevice(d);else{this.publish(m.EVENTS.ON_STATUS_MESSAGE,{text:'Device has been disconnected \x3cspan class\x3d"text-warning"\x3e'+
a.device.host+":"+a.device.port+'\x3c/span\x3e :  \x3cspan class\x3d"text-danger"\x3e'+c+"\x3c/span\x3e",type:"info"});var f=this.toDeviceControlInfo(d);if(!f||f.serverSide)if(this.getDriverInstance(a.device,!0)&&this.removeDriverInstance(a.device),d.reset(),d.state===m.DEVICE_STATE.DISABLED)d.setState(m.DEVICE_STATE.DISCONNECTED);else if(d.setState(m.DEVICE_STATE.DISCONNECTED),d.lastError=b,d.refresh(),f.serverSide&&d){var e=this;d.reconnectTimer||(d.isReconnecting=!0,d.lastReconnectTime?3600<d.lastReconnectTime&&
(d.lastReconnectTime=3600):d.lastReconnectTime=e.reconnectDevice,d.reconnectRetry||(d.reconnectRetry=0),d.reconnectTimer=setTimeout(function(){d.reconnectTimer=null;d.lastReconnectTime*=2;d.reconnectRetry+=1;d.shouldReconnect()&&(f&&d.setState(m.DEVICE_STATE.CONNECTING),e.startDevice(d))},d.lastReconnectTime))}}else h&&r&&l.error("deviceStoreItem is null")}},onCommandFinish:function(a,b){var c=this.getDriverInstance(a,!0);if(c){var h=b.params||{};if(h.src&&h.id&&(c=c.blockScope.getBlockById(h.src))&&
c.onCommandFinish)c.onCommandFinish(b)}},onCommandProgress:function(a,b){var c=this.getDriverInstance(a,!0);if(c){var h=b.params||{};if(h.src&&h.id&&(c=c.blockScope)&&(h=c.getBlockById(h.src))&&h.onCommandProgress)h.onCommandProgress(b)}},onCommandPaused:function(a,b){var c=this.getDriverInstance(a,!0);if(c){var h=b.params||{};if(h.src&&h.id&&(c=c.blockScope.getBlockById(h.src))&&c.onCommandPaused)c.onCommandPaused(b)}},onCommandStopped:function(a,b){var c=this.getDriverInstance(a,!0);if(c){var h=
b.params||{};if(h.src&&h.id&&(c=c.blockScope.getBlockById(h.src))&&c.onCommandStopped)c.onCommandStopped(b)}},onCommandError:function(a,b){var c=this.getDriverInstance(a,!0);if(c){var h=b.params||{};if(h.src&&h.id&&(c=c.blockScope.getBlockById(h.src))&&c.onCommandError)c.onCommandError(b)}},onDeviceServerMessage:function(a){function b(a){delete a.resposeSettings;delete a.driver;delete a.lastResponse;delete a.scope;delete a.driverId;delete a.device;delete a.sourceHost;delete a.sourcePort}var c=a.data,
h=null;if(_.isString(c)&&-1!=c.indexOf("{"))try{h=dojo.fromJson(c)}catch(d){l.error("error parsing device message",a);return}else _.isObject(c)&&c.data&&(h=c);if(h&&h.data&&h.data.device){var f=h.data.device;if(f&&f.serverSide){var n=this.getDriverInstance(h.data.device,!0);if(n){var k=this.getDeviceStoreItem(f);if(k){(f=k.info)||l.error("invalid device : "+k.toString());var p=k.get("state");a=f.serverSide;var r=h.data.deviceMessage,c=[];_.isString(r)?c=n.split(r):_.isObject(r)&&(b(r),c=[r]);var x=
n.onMessageRaw({device:h.data.device,message:r,bytes:h.data.bytes});x&&!x.length&&(x=null);for(var D=[],w=0;w<c.length;w++)D.push(g.stringToBuffer(c[w]));if(x&&x.length)for(c=[],D=[],w=0;w<x.length;w++){var A=x[w];c.push(A.string);D.push(A.bytes)}if(c&&c.length)for(w=0;w<c.length;w++)A=c[w],n.onMessage({device:h.data.device,message:A,raw:r,bytes:D[w]}),n.onBroadcastMessage({device:h.data.device,message:A,raw:r,bytes:D[w]});p!==m.DEVICE_STATE.READY&&k.set("state",m.DEVICE_STATE.READY);w=k.isDebug();
h.event&&(h.data.driverInstance=n,this.publish(h.event,h.data));if(e("xcf-ui")){var H=[],p=this.consoles[f.hash+"-Console"];if(w){w=h.data.deviceMessage;if(_.isObject(w)){b(w);try{w=JSON.stringify(w)}catch(K){logError(K,"error serialize message")}}this.publish(m.EVENTS.ON_STATUS_MESSAGE,{text:"Device Message from "+n.options.host+' : \x3cspan class\x3d"text-info"\x3e'+w+"\x3c/span\x3e"})}if(p)for(var I=0;I<p.length;I++){var J=p[I];if(J){var L=!0,O=!1;J.console&&(w=J.console.getTextEditor(),L=w.getAction("Console/Settings/Split").value,
O=w.getAction("Console/Settings/HEX").value);if(!L&&O)w=g.bufferToHexString(h.data.bytes),J.log(w,L,!1,m.LOG_OUTPUT.RESPONSE);else for(H=[],_.isString(r)?H=L?x&&x.length?x:n.split(r):[r]:_.isObject(r)&&(b(r),H=[r]),w=0;w<H.length;w++)A=H[w],_.isString(A.string)&&0===A.string.length||(O&&(A=g.stringToHex(A.string)),J.log(A,L,!0,m.LOG_OUTPUT.RESPONSE))}}c&&c.length&&this.publish(m.EVENTS.ON_DEVICE_MESSAGE_EXT,{device:k,deviceInfo:f,raw:r,messages:c,bytes:h.data.bytes})}if(0<c.length&&n.blockScope)for(h=
n.blockScope,f=h.getBlocks({group:m.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS}),n=h.getVariables({group:m.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES}),k=h.getVariable("value"),k||(k=new q({id:g.createUUID(),name:"value",value:"",scope:h,type:13,group:"processVariables",gui:!1,cmd:!1}),h.blockStore.putSync(k)),r=0;r<c.length;r++)if(0!==c[r].length){k.value=new String(c[r]);k.value.setBytes(D[r]);k.value.setString(c[r]);this.publish(m.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:k,scope:h,owner:this,save:!1,
source:m.MESSAGE_SOURCE.DEVICE,publishMQTT:!1});for(x=0;x<n.length;x++){var M=n[x];"value"!=n[x].title&&(p=null,p=k.value,"number"!=typeof p&&(p=""+p,p="'"+p+"'"),M.target&&"None"!=M.target&&null!==p&&"null"!=p&&"'null'"!=p&&(w=h.getVariable(M.target)))&&(w.value=p,this.publish(m.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:w,scope:h,owner:this,save:!1,source:m.MESSAGE_SOURCE.BLOX}))}if(a){for(p=0;p<c.length;p++)if(w=c[p],_.isObject(w)&&w.src&&(x=h.getBlockById(w.src))&&x.onData)x.onData(w);for(p=0;p<
f.length;p++)if(x=f[p],!1!==x.enabled){x.override={args:M?[M.value]:null};try{h.solveBlock(f[p],{highlight:!1})}catch(N){logError(N,"----solving response block crashed ")}}}}}else l.error("cant find device : ",f.toString())}else w&&l.error(" onDeviceMessage : failed! Have no device instance for "+h.data.device.host,h)}}},sendManagerCommand:function(a,b){this.checkDeviceServerConnection();var c={manager_command:a};g.mixin(c,b);if(this.deviceServerClient)return this.deviceServerClient.emit(null,c,a);
l.error("Send Manager Command "+a+" failed, have no  device Server client");this.onHaveNoDeviceServer()},sendDeviceCommand:function(a,b,c,h,d,f,n,k){this.checkDeviceServerConnection();var q=a.getDeviceInfo();g.mixin({src:c},q);var r={command:b,device_command:"Device_Send",options:q};g.mixin(r.options,{params:{src:c,id:h,wait:f,stop:n,pause:k}});h=this.getDevice(q.id);h&&_.isObject(h)?h._userStopped||h&&(h.state===m.DEVICE_STATE.DISABLED||h.state===m.DEVICE_STATE.DISCONNECTED||h.state===m.DEVICE_STATE.CONNECTING)||
(f=g.stringFromDecString(r.command),h.isDebug()&&this.publish(m.EVENTS.ON_STATUS_MESSAGE,{text:'Did send message : \x3cspan class\x3d"text-warnin"\x3e'+f.substr(0,30)+'\x3c/span\x3e to \x3cspan class\x3d"text-info"\x3e'+q.host+":"+q.port+"@"+q.protocol+"\x3c/span\x3e"}),q=p(JSON.stringify(a.options),1)+"-Console",this.deviceServerClient?(this.deviceServerClient.emit(null,r,"Device_Send"),e("xcf-ui")&&!1!==d&&_.each(this.consoles[q],function(a){a.printCommand('\x3cspan class\x3d"text-info"\x3e\x3cb\x3e'+
r.command+"\x3c/span\x3e","")})):(this.onHaveNoDeviceServer(),l.error("this.deviceServerClient is null"),l.error(" Send Device Command "+b+"failed, have no  device Server client")),a.blockScope&&(a=a.blockScope.getBlockById(c),this.publish(m.EVENTS.ON_DEVICE_COMMAND,{device:h,command:g.stringFromDecString(b),deviceInfo:this.toDeviceControlInfo(h),name:a?a.name:""}))):l.error("invalid device")},loadDevices:function(a){this.sendManagerCommand(m.SOCKET_SERVER_COMMANDS.INIT_DEVICES,{path:a})},callMethod:function(a,
b,c,h,d){this.checkDeviceServerConnection();a={method:b,args:c,device_command:m.SOCKET_SERVER_COMMANDS.CALL_METHOD,params:{id:d,src:h},options:a.options};if(this.deviceServerClient)this.deviceServerClient.emit(null,a,m.SOCKET_SERVER_COMMANDS.CALL_METHOD);else this.onHaveNoDeviceServer()},runShell:function(a,b,c,h,d){a=a.getDeviceInfo();this.sendManagerCommand(m.SOCKET_SERVER_COMMANDS.RUN_SHELL,{cmd:b,args:c,options:g.mixin(a,{params:{id:d,src:h}})})},watchDirectory:function(a,b){this.checkDeviceServerConnection();
var c={path:a,watch:b,manager_command:m.SOCKET_SERVER_COMMANDS.WATCH};if(this.deviceServerClient)this.deviceServerClient.emit(null,c,m.SOCKET_SERVER_COMMANDS.WATCH);else this.onHaveNoDeviceServer()},createDeviceServerClient:function(a){var h=this,d=new b;this.deviceServerClient=null;if(this.deviceServerClient=c.createClientWithStore(a,"Device Control Server",{delegate:{onConnected:function(){h.onDeviceServerConnected();d.resolve();h.publish(m.EVENTS.ON_DEVICE_SERVER_CONNECTED);r&&h.ctx.getNotificationManager().postMessage({message:"Connected to Device Server",
type:"success",duration:3E3})},onLostConnection:function(){h.onDeviceServerConnectionLost()},onServerResponse:function(a){var b=a.data,c=null;if(_.isString(b)){try{c=JSON.parse(b)}catch(d){c=b}if((c=c||{},c.data)&&c.data.deviceMessage&&c.data.deviceMessage.event===m.EVENTS.ON_COMMAND_FINISH){h.onCommandFinish(c.data.device,c.data.deviceMessage);return}if(c&&c.data&&c.data.deviceMessage&&c.data.deviceMessage.event===m.EVENTS.ON_COMMAND_PROGRESS){h.onCommandProgress(c.data.device,c.data.deviceMessage);
return}if(c&&c.data&&c.data.deviceMessage&&c.data.deviceMessage.event===m.EVENTS.ON_COMMAND_PAUSED){h.onCommandPaused(c.data.device,c.data.deviceMessage);return}if(c&&c.data&&c.data.deviceMessage&&c.data.deviceMessage.event===m.EVENTS.ON_COMMAND_STOPPED){h.onCommandStopped(c.data.device,c.data.deviceMessage);return}if(c.data&&c.data.deviceMessage&&c.data.deviceMessage.event===m.EVENTS.ON_COMMAND_ERROR){h.onCommandError(c.data.device,c.data.deviceMessage);return}if(c.event===m.EVENTS.ON_DEVICE_DISCONNECTED){h.publish(m.EVENTS.ON_DEVICE_DISCONNECTED,
c.data);return}if(c.event===m.EVENTS.SET_DEVICE_VARIABLES)return h.onSetDeviceServerVariables(c.data);if(c.event===m.EVENTS.ON_RUN_CLASS_EVENT)return h.onRunClassEvent(c.data);if(c.event===m.EVENTS.ON_DEVICE_CONNECTED){h.publish(m.EVENTS.ON_DEVICE_CONNECTED,c.data);return}if(c.event===m.EVENTS.ON_SERVER_LOG_MESSAGE){h.publish(m.EVENTS.ON_SERVER_LOG_MESSAGE,c.data);return}if(c.event===m.EVENTS.ON_MQTT_MESSAGE){h.publish(m.EVENTS.ON_MQTT_MESSAGE,c.data);h.onMQTTMessage(c.data);return}if(c.event===m.EVENTS.ON_FILE_CHANGED)return h.ctx.onXIDEMessage(dojo.fromJson(a.data))}h.onDeviceServerMessage(a)}}}))return this.deviceServerClient.dfd=
d,this.deviceServerClient}})})},"xcf/model/Device":function(){define("xdojo/declare xide/data/Model xide/data/Source xide/types xide/utils xide/mixins/EventedMixin xcf/types/Types".split(" "),function(k,p,m,g,c,e){return k("xcf.model.Device",[p,m,e],{_userStopped:!1,state:g.DEVICE_STATE.DISCONNECTED,driverInstance:null,blockScope:null,getParent:function(){return this.getStore().getSync(this.parentId)},isServerSide:function(){var b=this.getMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);return 1<<
g.DRIVER_FLAGS.RUNS_ON_SERVER&b?!0:!1},isServer:function(){var b=this.getMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);return 1<<g.DRIVER_FLAGS.SERVER&b?!0:!1},setServer:function(b){b=this.getMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);b.value|=1<<g.DRIVER_FLAGS.SERVER;this.setMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS,b.value)},setServerSide:function(b){b=this.getMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);b|=1<<g.DRIVER_FLAGS.RUNS_ON_SERVER;this.setMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS,
b)},isDebug:function(){var b=this.getMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);return 1<<g.DRIVER_FLAGS.DEBUG&b?!0:!1},check:function(){this._startDfd&&!0===this._userStopped&&this.reset()},getStore:function(){return this._store},getScope:function(){var b=this.getStore();return b?b.scope:this.scope},isEnabled:function(){return!0===this.getMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_ENABLED)},setEnabled:function(b){return this.setMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_ENABLED,b)},shouldReconnect:function(){return this._userStopped?
!1:this.isEnabled()},reset:function(){delete this._startDfd;this._startDfd=null;delete this.blockScope;this.blockScope=null;delete this.serverVariables;this.serverVariables=null;delete this.driverInstance;this.driverInstance=null;clearTimeout(this.reconnectTimer);delete this.lastReconnectTime;delete this.reconnectRetry;delete this.isReconnecting;this.setState(g.DEVICE_STATE.DISCONNECTED)},constructor:function(){},getBlockScope:function(){return this.blockScope},getDriverInstance:function(){return this.driverInstance},
getDriver:function(){var b=this.getBlockScope();return b?b.driver:null},getMetaValue:function(b){return c.getCIInputValueByName(this.user,b)},setMetaValue:function(b,a,f){var e=c.getCIByChainAndName(this.user,0,b);if(!e)return null;var k=this.getMetaValue(b);c.setCIValueByField(e,"value",a);this[b]=a;if(!1!==f)return this.publish(g.EVENTS.ON_CI_UPDATE,{owner:this.owner,ci:e,newValue:a,oldValue:k})},getStateIcon:function(b){b=b||this.state;switch(b){case g.DEVICE_STATE.READY:case g.DEVICE_STATE.CONNECTED:return"fa-link iconStatusOn";
case g.DEVICE_STATE.SYNCHRONIZING:case g.DEVICE_STATE.CONNECTING:return"fa-spinner fa-spin";case g.DEVICE_STATE.LOST_DEVICE_SERVER:return"fa-spinner fa-spin"}return"fa-unlink iconStatusOff"},setState:function(b,a){if(b!==this.state){var c=this.state,e=this.getStateIcon(b);this.state=b;this.set("iconClass",e);this.set("state",b);this._emit(g.EVENTS.ON_DEVICE_STATE_CHANGED,{old:c,state:b,icon:e,"public":!0});this.refresh()}}})})},"xide/data/Source":function(){define(["dcl/dcl","dojo/_base/declare",
"xide/utils"],function(k,p,m){var g={_references:null,_originReference:null,onReferenceUpdate:function(){},onReferenceRemoved:function(){},onReferenceDelete:function(){},updateReference:function(){},getReferences:function(){return this._references?m.pluck(this._references,"item"):[]},addReference:function(c,e,b){this._references||(this._references=[]);this._references.push({item:c,settings:e});var a=this;if(e&&e.onDelete&&c._store)c._store.on("delete",function(b){b.target==c&&a._store.removeSync(a[a._store.idProperty])});
b&&c.addSource&&c.addSource(this,e)},removeReference:function(c){this._references&&_.each(this._references,function(e){e&&e.item==c&&this._references&&this._references.remove(e)},this)},updateReferences:function(c){var e=c.property,b=c.value;this._references||(this._references=[]);for(var a=0;a<this._references.length;a++){var f=this._references[a],g=f.item,f=f.settings,k=g._store;if(this._originReference!=g&&c.property&&f.properties&&f.properties[c.property]){k&&(k._ignoreChangeEvents=!0);try{if(g.onSourceChanged)g.onSourceChanged(e,
b);else g.set(e,b)}catch(d){}k&&(k._ignoreChangeEvents=!1,k.emit("update",{target:g}))}}},constructor:function(c){this._references=[];m.mixin(this,c)},onItemChanged:function(c){this.updateReferences(c)}};p=p("xgrid.data.Source",null,g);p.dcl=k(null,g);p.Implementation=g;return p})},"xcf/mixins/LogMixin":function(){define(["dcl/dcl","xcf/types/Types","xide/utils"],function(k,p,m){var g=p.DEFAULT_DEVICE_LOGGING_FLAGS;k=k(null,{hasFlagEx:function(c,e,b){c=c.loggingFlags;c=_.isString(c)?m.fromJson(c):
c||{};b=c[b]?c[b]:g[b];return null!=b&&b&e?!0:!1}});k.DEFAULT_LOGGING_FLAGS=g;return k})},"xcf/manager/Context":function(){define("dcl/dcl dojo/_base/declare dojo/_base/array dojo/_base/lang xide/manager/Context xide/factory xide/types xcf/manager/DriverManager xcf/manager/DeviceManager xcf/manager/ProtocolManager xcf/manager/Application xcf/manager/LogManager xide/manager/ResourceManager xide/manager/PluginManager xdojo/has xdojo/has!xideve?xcf/manager/WidgetManager".split(" "),function(k,p,m,g,
c,e,b,a,f,n,q,d,l,r,h,t){return k([c],{declaredClass:"xcf.manager.Context",getUserDirectory:function(){var a=this.getResourceManager();if(a)return a.getVariable("USER_DIRECTORY")},namespace:"xcf.manager.",driverManager:null,deviceManager:null,protocolManager:null,debugManager:null,nodeServiceManager:null,blockManager:null,getBlockManager:function(){return this.blockManager},getProtocolManager:function(){return this.protocolManager},getDriverManager:function(){return this.driverManager},getDeviceManager:function(){return this.deviceManager},
getNodeServiceManager:function(){return this.nodeServiceManager},getDebugManager:function(){return this.debugManager},constructManagers:function(a){this.isEditor()},initManagers:function(){this.isEditor()||(this.driverManager.init(),this.deviceManager.init(),h("protocols")&&this.protocolManager.init(),h("log")&&this.logManager.init());this.resourceManager&&this.resourceManager.init()}})})},"xide/manager/Context":function(){define("dcl/dcl dojo/_base/lang dojo/_base/json dojo/Deferred dojo/has xide/manager/ContextBase xide/factory xide/types xide/utils require dojo/promise/all xdojo/has!host-browser?xide/manager/Context_UI".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d){p=k([e],{declaredClass:"xide.manager.Context",application:null,contextManager:null,fileManager:null,resourceManager:null,notificationManager:null,serviceObject:null,pluginManager:null,windowManager:null,logManager:null,mountManager:null,config:null,managers:null,namespace:"xide.manager.",defaultNamespace:"xide.manager.",vfsMounts:null,xideServiceClient:null,fileUpdateTimes:{},onXIDEMessage:function(b,c){if(b&&b.event&&b.event===a.EVENTS.ON_FILE_CHANGED)if(b.data&&
b.data.mask&&-1!==b.data.mask.indexOf("delete"))this.publish(a.EVENTS.ON_FILE_DELETED,b);else if(b.data&&"delete"==b.data.type)this.publish(a.EVENTS.ON_FILE_DELETED,b);else{var h=b.data.path,d=(new Date).getTime();if(this.fileUpdateTimes[h]&&1E3>d-this.fileUpdateTimes[h])this.fileUpdateTimes[h]=d;else if(!1!==c&&this.publish(b.event,b),this.fileUpdateTimes[h]=d,h=f.replaceAll("\\","/",b.data.path),h=f.replaceAll("//","/",b.data.path),h=h.replace(/\\/g,"/"),-1===h.indexOf("/build/")&&null!=h&&null!=
h.indexOf){if(h.match(/\.css$/))this.onCSSChanged({path:h});if(h.match(/\.js$/)&&(d=b.data.modulePath)){d=d.replace(".js","");try{n(d)}catch(e){}var g="data/system/drivers";-1!=h.indexOf(g)&&(d=h.substr(h.indexOf(g)+(g.length+1),h.length),d=d.replace(".js",""),d="system_drivers/"+d);g="user/drivers";-1!=h.indexOf(g)&&(d=h.substr(h.indexOf(g)+(g.length+1),h.length),d=d.replace(".js",""),d="user_drivers/"+d);(g=(g=this.getResourceManager())?g.getVariable("VFS_CONFIG")||{}:null)&&g.user_drivers&&-1!==
h.indexOf(g.user_drivers)&&(g=g.user_drivers,g=g.replace(/\/+$/,""),d=h.substr(h.indexOf(g)+(g.length+1),h.length),d=d.replace(".js",""),d="user_drivers/"+d);d=f.replaceAll(".","/",d);d.indexOf("/build/")}}}},onNodeServiceStoreReady:function(a){this.xideServiceClient&&this.xideServiceClient.destroy()},mergeFunctions:function(a,b,c,d){for(var f in b)_.isFunction(b[f])&&b[f]&&a&&(a[f]=b[f])},reloadModules:function(a,b){var c=new g,d=[],f=[],e=this;n({cacheBust:"time\x3d"+(new Date).getTime()});_.each(a,
function(a){var c=null,h=new g;!1!==b&&(c=n(a));n.undef(a);n([a],function(a){c&&e.mergeFunctions(c.prototype,a.prototype);f.push(a);h.resolve()});d.push(h)});q(d).then(function(){c.resolve(f);n({cacheBust:null})});return c},_reloadModule:function(b,c){var h=null,d=new g;b=b.replace("0/8","0.8");var e=this.getModule(b);if(e&&e.prototype&&e.prototype.reloadModule)return e.prototype.reloadModule();var h=n.on("error",function(a){console.log(a.src,a.id);console.error("require error "+b,a);h.remove();d.reject(a)}),
k=this.getModule(b);if(!k&&(k="undefined"!==typeof b?k:null,!k&&"undefined"!==typeof window))if(k=f.getAt(window,f.replaceAll("/",".",b),null))e=k;else try{k=n(f.replaceAll(".","/",b))}catch(q){console.log("couldnt require old module",b)}k&&(e=k);n.undef(b);var m=this;c?setTimeout(function(){n({cacheBust:"time\x3d"+(new Date).getTime(),waitSeconds:5});try{n([b],function(c){n({cacheBust:null});if(_.isString(c))console.error("module reloaded failed : "+c+" for module : "+b);else{c.modulePath=b;e&&(m.mergeFunctions(e.prototype,
c.prototype,e,c),e.prototype&&e.prototype._onReloaded&&e.prototype._onReloaded(c));if(k&&k.onReloaded)k.onReloaded(c,k);m.publish(a.EVENTS.ON_MODULE_RELOADED,{module:b,newModule:c});c.prototype&&c.prototype.declaredClass&&m.publish(a.EVENTS.ON_MODULE_UPDATED,{moduleClass:c.prototype.declaredClass,moduleProto:c.prototype});d.resolve(c)}})}catch(c){console.error("error reloading module",c),logError(c,"error reloading module"),d.reject(c)}},100):d.resolve();return d},onCSSChanged:function(a){},onDidChangeFileContent:function(a){if(!a.didProcess&&
(a.didProcess=!0,this.vfsMounts&&a.path)){var b=a.path;if(-1==b.indexOf(".css")&&-1==b.indexOf("resources")&&-1==b.indexOf("meta")&&-1!=b.indexOf(".js")){var b=a.mount.replace("/",""),c=null;if(this.vfsMounts[b]){var c=""+a.path,c=c.replace("./",""),c=c.replace("/","."),c=c.replace(".js",""),c=f.replaceAll(".","/",c),d=this;setTimeout(function(){try{d._reloadModule(c,!0)}catch(a){console.error("error reloading module",a)}},100)}}}},getMount:function(a){var b=this.getResourceManager();return(b=b?b.getVariable("VFS_CONFIG")||
{}:null)&&b[a]?b[a]:null},toVFSShort:function(a,b){var c=this.getResourceManager();return(c=c?c.getVariable("VFS_CONFIG")||{}:null)&&c[b]&&(c=c[b],c=f.replaceAll("//","/",c),c=c.replace(/\/+$/,""),-1!==a.indexOf(c))?(c=c.replace(/\/+$/,""),a.substr(a.indexOf(c)+(c.length+1),a.length)):null},findVFSMount:function(a){var b=this.getResourceManager();if(b=b?b.getVariable("VFS_CONFIG")||{}:null)for(var c in b){var d=b[c],d=f.replaceAll("//","/",d),d=d.replace(/\/+$/,"");if(-1!==a.indexOf(d))return c}return null},
getBlockManager:function(){return this.blockManager},getPluginManager:function(){return this.pluginManager},getService:function(){return this.serviceObject},getFileManager:function(){return this.fileManager},getResourceManager:function(){return this.resourceManager},getMountManager:function(){return this.mountManager},getContextManager:function(){return this.contextManager},getLogManager:function(){return this.logManager},getApplication:function(){return this.application},constructor:function(b){this.managers=
[];this.config=b;this.language="en";this.subscribe(a.EVENTS.ON_CHANGED_CONTENT,this.onDidChangeFileContent);c("xnode")&&this.subscribe(a.EVENTS.ON_NODE_SERVICE_STORE_READY,this.onNodeServiceStoreReady)},prepare:function(){this.config&&this.initWithConfig(this.config)},initWithConfig:function(a){a&&a.mixins&&this.doMixins(a.mixins)},isEditor:function(){return this.args&&this.args.file}});k.chainAfter(p,"constructManagers");k.chainAfter(p,"initManagers");return p})},"xcf/manager/ProtocolManager":function(){define("dcl/dcl dojo/_base/declare xide/manager/ServerActionBase xide/types xide/utils xide/factory xaction/Action xcf/manager/BeanManager".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d,l,r){return k([m,a],{declaredClass:"xcf.manager.ProtocolManager",beanNamespace:"protocol",beanName:"Protocol",beanIconClass:"fa-code",groupType:g.ITEM_TYPE.PROTOCOL_GROUP,itemType:g.ITEM_TYPE.PROTOCOL,itemMetaPath:"user.meta",itemMetaStorePath:"/meta/inputs",itemMetaTitleField:g.PROTOCOL_PROPERTY.CF_PROTOCOL_TITLE,systemScope:"system_protocols",userScope:"user_protocols",appScope:"app_protocols",defaultScope:"system_protocols",serviceClass:"XCF_Protocol_Service",rawData:null,
store:null,treeView:null,protocolScopes:null,getItemActions:function(){var a=[],b=this,d=this.getItem(),f=d?!0===c.toBoolean(d.isDir):!1;a.push({title:"New Group",icon:"el-icon-folder",place:"last",emit:!1,style:"",handler:function(a,c,h){b.newGroup()}});a.push({title:"Reload",icon:"fa-refresh",disabled:!1,command:"Reload",place:"last",emit:!1,style:"",handler:function(){b.reload()}});null!=this.getItem()&&(a.push({title:"Delete",icon:"el-icon-remove-circle",disabled:!1,command:"Delete",place:"last",
emit:!1,style:"",handler:function(){b.onDeleteItem(d)}}),f?a.push({title:"New Protocol",icon:"el-icon-file-new",disabled:!1,command:"NewItem",place:"last",emit:!1,style:"",handler:function(){b.newItem(d)}}):a.push({title:"Connect",icon:"el-icon-play-circle",disabled:!1,command:"Start",place:"last",emit:!1,style:"",handler:function(){b.startDevice(d)}}));return a},onItemRemoved:function(a){a==this.currentItem&&(this.currentItem=null);a&&(a=this.getView(a))&&c.destroy(a)},_onDeleteItem:function(a){var b=
!0===c.toBoolean(a.isDir),d=c.toString(a.name),e=b?"removeGroup":"removeItem",g=this;(new f({title:"Remove Protocol"+(b?" Group":"")+" '"+d+"'",style:"max-width:400px",titleBarClass:"text-danger",delegate:{isRemoving:!1,onOk:function(b){g[e](c.toString(a.scope),c.toString(a.path),function(){g.onItemRemoved(a)})}},inserts:[{query:".dijitDialogPaneContent",insert:'\x3cdiv\x3e\x3cspan class\x3d"fileManagerDialogText"\x3eDo you really want to remove  this item?\x3c/span\x3e\x3c/div\x3e',place:"first"}]})).show()},
newItem:function(){var a=this.getItem();a||(a={path:""});var b=[c.createCI("In Group",13,c.toString(a.path),{widget:{disabled:!0},group:"Common"}),c.createCI("Title",13,"",{group:"Common"})],a=new q({title:"New Device",resizable:!0,delegate:{onOk:function(a,h){var d=c.createCI("Id",13,c.createUUID(),{visible:!1,group:"Common"});h.push(d);c.toOptions(h);c.getInputCIByName(b,"Title");c.getInputCIByName(b,"Scope");c.getInputCIByName(b,"In Group")}},cis:b});a.show();a.resize()},reload:function(){},onFileChanged:function(a){if(!a._pp2){a._pp2=
!0;var b=a.data;this.fileUpdateTimes||(this.fileUpdateTimes={});if(b.event===g.EVENTS.ON_FILE_CHANGED){if(b.data&&b.mask&&-1!==b.mask.indexOf("delete")){console.error("deleted");return}(new Date).getTime()}var d=c.replaceAll("\\","/",b.path),d=c.replaceAll("//","/",b.path),d=d.replace(/\\/g,"/");-1!=d.indexOf("protocols")&&(d.match(/\.json$/)&&(-1!=d.indexOf("data/system/protocols")&&console.log("protocol changed"+d),this.ls("system_protocols")),this.onFileChanged2&&this.onFileChanged2(a))}},init:function(){this.subscribe(g.EVENTS.ON_FILE_CHANGED,
this.onFileChanged)},_resetItem:function(a){a.commandsItem&&c.removeFromStore(this.getStore(),a.commandsItem,!0,"path","parentId");a.variablesItem&&c.removeFromStore(this.getStore(),a.variablesItem,!0,"path","parentId")},_completeProtocolItem:function(a){if(a&&a.user){var b=c.getInputCIByName(a.user.meta,"content"),d=this,f=this.getStore();if(!b&&(a.mount=""+a.scope,a.getPath=function(){return a.path},a.virtual=!1,a.isDir=!0,a.children=[],b=c.createCI("Content",g.ECIType.FILE_EDITOR,"no value",{group:"Content",
editor:"JSON Editor",editorArgs:{subscribers:[{event:"onSave",handler:function(b){(b=c.getJson(b.value))&&b.meta&&(a.user=b,a._completed=!1,d._resetItem(a),d._completeProtocolItem(a),d.publish(g.EVENTS.ON_PROTOCOL_CHANGED,{item:a}))},owner:d}],leftEditorArgs:{subscribers:[{event:"addAction",handler:function(a){console.log("add action",arguments)},owner:d}],hiddenFields:{},readOnlyNodes:{commands:!0,variables:!0,meta:!0},insertTemplates:[{label:"New Command",path:"commands",value:'{title:"No Title",send:""}',
newNodeTemplate:"[]",collapse:!0,select:!0},{label:"New Variable",path:"variables",value:'{title:"No Title",value:""}',newNodeTemplate:"[]",collapse:!0,select:!0}],renderTemplates:[{nodeValuePath:"field.innerHTML",match:[/^variables[\s]?\.(\d+)$/,/^commands[\s]?\.(\d+)$/],replaceWith:"{nodeValue} - {title}",variables:null,nodeValueTransform:function(a){return c.capitalize(a)},insertIfMatch:{}}]},rightEditorArgs:{subscribers:[{event:"addAction",handler:function(a){console.log("add action",arguments)},
owner:d}]}},editorItem:a,editorOverrides:{},isOwnTab:!0}),a.user.meta.inputs.push(b),!a._completed)){a._completed=!0;var e={path:c.createUUID(),name:"Commands",isDir:!0,type:"leaf",parentId:a.path,virtual:!0,children:[]};a.commandsItem=e;a.children.push(e);f.putSync(e);for(var l=a.user.commands,b=0;b<l.length;b++){var n=l[b];e.children.push(f.putSync({path:c.createUUID(),name:n.name,id:c.createUUID(),parentId:e.path,_mayHaveChildren:!1,virtual:!0,user:{},isDir:!1,value:n.value,ref:{protocol:a,item:n},
type:"protocolCommand"}))}e={path:c.createUUID(),name:"Variables",isDir:!0,type:"leaf",parentId:a.path,virtual:!0,items:[],children:[]};f.putSync(e);a.children.push(e);a.variablesItem=e;l=a.user.variables;for(b=0;b<l.length;b++)n=l[b],e.children.push(f.putSync({isDir:!1,path:c.createUUID(),name:n.name,id:c.createUUID(),parentId:e.path,_mayHaveChildren:!1,value:n.value,virtual:!0,user:{},ref:{protocol:a,item:n},type:"protocolVariable"}))}}},onStoreReady:function(a){a=a?c.queryStore(a,{isDir:!1}):[];
var b=this;_.each(a,function(a,c,d){b._completeProtocolItem(a)})},onMainViewReady:function(){var a=this,c=b.createDefault("New Protocol","fa-exchange","File/New/Protocol","__anewAction",null,{permanent:!0,handler:function(){a.newItem()}}).setVisibility(g.ACTION_VISIBILITY.ACTION_TOOLBAR,null).setVisibility(g.ACTION_VISIBILITY.MAIN_MENU,{}).setVisibility(g.ACTION_VISIBILITY.CONTEXT_MENU,null);a.publish(g.EVENTS.REGISTER_ACTION,{owner:a,action:c});n.prototype.ctx=this.ctx},openItemSettings:function(a){var b=
a.user;if(!b||!b.meta)return null;var f=this.getViewId(a),e=l.byId(f);try{if(e)return e.parentContainer&&e.parentContainer.selectChild(e),null}catch(g){c.destroy(e)}var e=this.getViewTarget(),n=this.getMetaValue(a,this.itemMetaTitleField);a.beanContextName=this.ctx.mainView.beanContextName;return c.addWidget(d,{title:n||c.toString(a.name),cis:b.meta.inputs,beanContextName:this.ctx.mainView.beanContextName,storeItem:a,iconClass:this.beanIconClass,id:f,delegate:this,storeDelegate:this,closable:!0,showAllTab:!1,
blockManager:this.ctx.getBlockManager()},this,e,!0)}})})},"xaction/Action":function(){define("xdojo/declare xide/model/Base xide/types xide/utils/ObjectUtils xide/utils xide/mixins/EventedMixin".split(" "),function(k,p,m,g,c,e){c.mixin(m,{ACTION_VISIBILITY:{MAIN_MENU:"MAIN_MENU",CONTEXT_MENU:"CONTEXT_MENU",QUICK_LAUNCH:"QUICK_LAUNCH",ACTION_TOOLBAR:"ACTION_TOOLBAR",PROPERTY_VIEW:"PROPERTY_VIEW",RIBBON:"RIBBON",widgetArgs:null,factory:function(){var a=arguments[1]||c.clone(m.ACTION_VISIBILITY),b=arguments;
if(0<b[0].length&&_.isNumber(b[0][0])){var e=b[0],g=0;_.each(a,function(b,c){"function"!==typeof a[c]&&g<e.length&&(a[c+"_val"]=e[g]);g++})}if(_.isString(b[0][0])){if(!0===b[0][2])c.mixin(a[b[0][0]+"_val"],b[0][2]);else return a[b[0][0]+"_val"]=b[0][1],a;return b[1]}return a}}});m.ACTION_VISIBILITY_ALL="ACTION_VISIBILITY_ALL";var b=k("xaction/Action",[p,e],{disabled:!1,enabled:!0,object:null,show:!0,group:"",types:"",command:null,icon:"fa-play",event:null,handler:null,tab:null,visibility_:null,value:null,
setVisibility:function(){if(2==arguments.length&&_.isString(arguments[0])&&arguments[0]==m.ACTION_VISIBILITY_ALL){var a=arguments[1],b=m.ACTION_VISIBILITY,e=this;[b.MAIN_MENU,b.ACTION_TOOLBAR,b.CONTEXT_MENU,b.RIBBON].forEach(function(b){e.setVisibility(b,c.cloneKeys(a,!1))});return this}b=_.isArray(arguments[0])?arguments[0]:arguments;this.visibility_=m.ACTION_VISIBILITY.factory(b,this.visibility_);return this},getVisibility:function(a){this.visibility_||this.setVisibility(m.ACTION_VISIBILITY_ALL,
{});return this.visibility_?(null==this.visibility_[a+"_val"]&&(this.visibility_[a+"_val"]={vis:a}),this.visibility_[a+"_val"]):{}},shouldDestroyWidget:function(a,b,c){a=null!=this.getVisibility?this.getVisibility(a):null;var e=!0;a&&a.permanent&&(e=!(_.isFunction(a.permanent)?a.permanent(this,b,c):a.permanent));return e}});b.create=function(a,f,e,g,d,l,k,h,t,m,p){a=new b({permanent:g,command:e,icon:f,label:a,owner:this,types:l,operation:d,group:k,handler:m,title:a});c.mixin(a,p);return a};b.createDefault=
function(a,c,e,g,d,l){return b.create(a,c,e,!1,null,null,g||"nogroup",null,!1,d,l)};return b})},"xcf/manager/Application":function(){define("dcl/dcl require xdojo/declare xide/manager/Application xide/utils xide/types xdojo/declare xdojo/has xdojo/has!xcf-ui?xcf/manager/Application_UI xdojo/has!xexpression?xexpression/Expression".split(" "),function(k,p,m,g,c,e,b,a,f,n,q){return k(g,{declaredClass:"xcf.manager.Application",vfsItems:null,onReloaded:function(){},onMountDataReady:function(a){},onPluginLoaded:function(a){this.publish(e.EVENTS.ON_PLUGIN_READY,
{name:a.name,mainView:this.rootView,config:this.config,ctx:this.ctx,panelManager:this,fileManager:this.ctx.getFileManager(),store:this.store,serviceObject:this.ctx.getService()},this)},_onXBlocksReady:function(){p("xfile/manager/BlockManager");var a=this.ctx;if(a.blockManager)a.blockManager.onReady();p(["xcf/manager/BlockManager"],function(b){a.blockManager=new b;a.blockManager.ctx=a;a.blockManager.updatePalette=!1;a.blockManager.init();a.blockManager.onReady();a.blockManager.serviceObject=a.fileManager.serviceObject});
var b=p("xblox/views/BlocksFileEditor");a.registerEditorExtension("xBlocks","xblox","fa-play-circle-o",this,!0,null,b,{ctx:this.ctx,mainView:this.mainView,blockManagerClass:"xfile.manager.BlockManager",registerView:!0})},onComponentReady:function(a){}})})},"xide/manager/Application":function(){define("dcl/dcl xdojo/has xide/manager/ManagerBase xide/types xide/utils dojo/Deferred dojo/promise/all dojo/has!host-browser?xide/manager/Application_UI".split(" "),function(k,p,m,g,c,e,b,a){return k([m],{declaredClass:"xide.manager.Application",
container:null,ctx:null,_debug:!0,_loadedComponents:{},_loadingComponents:null,getComponents:function(){return this._loadedComponents},doComponents:function(){function a(b,d){if(p(b)&&c[b].dfd){var h=new e;l.push(h);c[b].dfd.then(function(){d(h)})}}var c=this.loadComponents(),k=require,d=this,l=[],m=new e;if(!c||!c.dfd)return console.error("componentsToLoad is null or has no head dfd"),c;var h=g.COMPONENT_NAMES;a(h.XFILE,function(a){d.initXFile().then(function(){a.resolve()})});a(h.XIDEVE,function(a){d.initXIDEVE().then(function(){a.resolve()})});
a(h.XNODE,function(a){d.initXNODE().then(function(){a.resolve()})});a(h.XBLOX,function(a){k(["xblox/embedded_ui","xfile/manager/BlockManager","xblox/views/BlocksFileEditor"],function(){d.onXBlocksReady().then(function(){a.resolve()})})});c.dfd.then(function(){b(l).then(function(){m.resolve()})});m.then(function(){d.registerEditorExtensions()});return m},loadComponents:function(a){if(this._loadingComponents)return this._loadingComponents;var b=this,k,d;b._loadedComponents={};a=a||c.getJson(this.ctx.getResourceManager().getVariable("COMPONENTS"));
_.each(a,function(b,c){!1===p(c)&&delete a[c]});if(!a)return null;k=function(){var c=_.find(a,{status:0});c?d(c.name,c):(a.dfd.resolve(a),b.publish(g.EVENTS.ON_ALL_COMPONENTS_LOADED,a),a.dfd.resolve())};d=function(a,c){var d=c.settings;!1===p(a)&&console.error("loading component "+a+"which is disabled by has!");b.ctx.getPluginManager().loadComponent(a,null,!0===d?null:d).then(function(d){b._loadedComponents[a]=d;d={component:d,name:a};c.dfd.resolve(d);b.publish(g.EVENTS.ON_COMPONENT_READY,d);c.status=
1;k()})};for(var l in a){var m=""+l,h=a[m];a[m]=h?{settings:h,status:0,name:m,dfd:new e}:{status:1}}a.dfd=new e;k();return this._loadingComponents=a},hasComponent:function(a){var b=c.getJson(this.ctx.getResourceManager().getVariable("COMPONENTS"));return!(!b||!b[a])}})})},"xcf/manager/LogManager":function(){define(["dcl/dcl","xide/utils","xlog/manager/LogManager","xdojo/has!xcf-ui?xcf/views/LogView"],function(k,p,m,g){return k(m,{declaredClass:"xcf.manager.LogManager",createLoggingView:function(c,
e){var b=this.getViewTarget();try{return p.addWidget(g,{delegate:this,store:c,title:"Log",closable:!0},this,b,!0)}catch(a){console.error(a)}},ls:function(c,e){var b=this;return this.callMethodEx(null,"ls",["unset"],function(a){b.rawData=a;b.initStore(a);c&&c(a)},!0)}})})},"xlog/manager/LogManager":function(){define("dcl/dcl xdojo/declare xide/manager/ServerActionBase xide/manager/BeanManager xide/encoding/MD5 xide/types xide/utils dojo/cookie dojo/json dojo/Deferred xide/data/Memory dstore/Trackable xide/mixins/EventedMixin".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d,l){var r=p([l],{bytesLoaded:null,percentValue:null,item:null,delegate:null,_onEnd:null,_onHandle:null,serviceClass:"XIDE_Log_Service",constructor:function(a){this.item=a;this.subscribe(a.progressMessage,this._onProgress);this.subscribe(a.progressFailedMessage,this._onProgressFailed)},_onProgressFailed:function(a){this.item.level="error";this.item.message=this.item.oriMessage+" : Failed";this.item._isTerminated=!0;a&&a.item&&a.item.error&&this.item.details&&(this.item.details.error=
a.item.error)},_onFinish:function(){this._onHandle&&this._onHandle.remove()},destroy:function(){this._destroyHandles()},_onProgress:function(a){try{var b=a.progress;a=null;null==a&&(a=Math.round(100*b.loaded/b.total),this.bytesLoaded=b.loaded);if(this.percentValue!=a){var c=""+this.item.oriMessage;this.item.message=""+(c+(" : "+a+"%"))}this.percentValue=a;this._emit("progress");100<=this.percentValue&&(this.item.message=this.item.oriMessage+" : Done",this._emit("finish"),this._onFinish(),this.destroy())}catch(d){console.error("crash in log progress "+
d)}}});return k([m,g],{declaredClass:"xcf.manager.LogManager",serviceClass:"XIDE_Log_Service",cookiePrefix:"logging",singleton:!0,serviceView:null,clients:null,beanNamespace:"logging",views:null,stores:{},removeStore:function(a){var b=this.stores[a];b&&(b.destroy&&b.destroy(),delete this.stores[a])},getViewId:function(a){return this.beanNamespace+c(JSON.stringify({info:a.info}),1)},loadPreferences:function(){var b=a(this.cookiePrefix+"_debug_settings");return b=b?f.parse(b):{}},savePreferences:function(b){a(this.cookiePrefix+
"_debug_settings",f.stringify(b))},empty:function(a){this.clear(a);a=this.getStore(a);a.then&&a.then(function(a){a.setData([])})},clear:function(a){return this.runDeferred(null,"clearAbs",[a||""]).then(function(a){})},getViewTarget:function(){return this.ctx.getApplication().mainView.getNewAlternateTarget()},getStore:function(a){if(!a)return this.store;var c=new n;if(this.stores[a])return c.resolve(this.stores[a]),c;var d=this;this.runDeferred(null,"lsAbs",[a||""]).then(function(f){_.isString(f)&&
(f=b.getJson(f));f=d.initStore(f);d.stores[a]=f;c.resolve(f)});return c},isValid:function(){return null!=this.store},_buildLoggingMessage:function(a){var c={id:b.createUUID(),level:a.level,message:a.message,host:"",data:a.data||{},time:a.time||(new Date).getTime(),type:"",show:!0,showDevice:!0};a.type&&(c.type=a.type);a.device&&a.device.host&&(c.host=a.device.host+":"+a.device.port);a.deviceMessage&&(c.message=c.message+":"+a.deviceMessage);c.ori=a;return c},initStore:function(a){var c={identifier:"time",
label:"level",items:[],sort:"time"},d=null;0==a.length&&(a=[]);for(var f=0;f<a.length;f++)c.items.push(this._buildLoggingMessage(a[f]));try{d=new (p("LogStore",[q],{}))({idProperty:"time",data:c,id:b.createUUID()})}catch(e){console.error("log creation failed: ",e)}return d},createLoggingView:function(a,c,d){c=c||this.getViewTarget();try{return b.addWidget(!1,{delegate:this,store:a,title:"Log",closable:!0,style:"padding:0px",silent:d},this,c,!0)}catch(f){console.error(f)}},updateViews:function(a,b){for(var c=
0;c<this.views.length;c++)this.views[c].update(a,b)},refreshViews:function(a,b){for(var c=0;c<this.views.length;c++)this.views[c].grid.refresh()},addLogView:function(a){this.views.push(a)},openLogView:function(a,b){this.isValid()||this.initStore([]);var c=this.createLoggingView(this.store,a,b);this.views.push(c);return c},_createPendingEvent:function(a,b,c,d){function f(a){!b._isTerminated&&e&&(b.message=b.oriMessage+" : Done",a&&!0===a.failed&&(b.level="error",b.message=b.oriMessage+" : Failed"),
b._isTerminated=!0,e.remove(),e=null,g.refreshViews(),b.progressHandler&&b.progressHandler.destroy())}var e=null,g=this;b._isInProgress=!0;e=g.subscribe(c,f,g)[0];b.showProgress&&b.progressMessage&&!b.progressHandler&&(a=new r(b,this),a._onEnd=f,a._onEndHandle=e,b.progressHandler=a)},addLoggingMessage:function(a){if(a&&a.data){var c=a.data.logId;!c&&a.data&&a.data.device&&(c=a.data.device,c=c.host+"_"+c.port+"_"+c.protocol)}var d={id:b.createUUID(),level:a.level,message:a.message,host:a.host||"",
data:a.data||{},time:a.time||(new Date).getTime(),type:a.type||"",show:!0,showDevice:!0,terminatorItem:a.item,terminatorMessage:a.terminatorMessage,showProgress:a.showProgress,progressMessage:a.progressMessage,progressFailedMessage:a.progressFailedMessage,details:a.details};a.data&&(a.data.type&&(d.type=a.data.type),a.data.device&&a.data.device.host&&(d.host=a.data.device.host+":"+a.data.device.port),a.data.deviceMessage&&(d.message=d.message+":"+a.data.deviceMessage));this.isValid();try{null==d.terminatorMessage||
d._isTerminated||(null==d.oriMessage&&(d.oriMessage=""+d.message),this._createPendingEvent(d.oriMessage,d,d.terminatorMessage,d.time));var f=this.getStore(c);f&&(f.then?f.then(function(a){f=a;d=a.putSync(d);a._emit("added",{item:d,store:f})}):(d=f.putSync(d),f._emit("added",{item:d,store:f})))}catch(e){console.error("adding log message to store failed "+e)}},onServerLogMessage:function(a){a.data&&a.data.time&&(a.time=a.data.time);this.addLoggingMessage(a);1==a.write&&this.publish(e.EVENTS.ON_CLIENT_LOG_MESSAGE,
{message:a.message,data:a.data,details:a.details,level:a.level,type:a.type,time:a.data.time||a.time})},init:function(){this.subscribe([e.EVENTS.ON_SERVER_LOG_MESSAGE]);this.views=[];this.stores={}},onStoreReloaded:function(a){for(a=0;a<this.views.length;a++){var b=this.views[a];b.reload(this.store);b.update()}},reload:function(){var a=this;this.currentItem=null;this.ls(function(b){a.onStoreReloaded(b)})},ls:function(a,c,d){var f=this;return this.callMethodEx(null,"lsAbs",[c||""],d||function(c){f.rawData=
c;_.isString(c)&&(c=b.getJson(c));f.store=f.initStore(c);a&&a(c)},!0)}})})},"xide/manager/ResourceManager":function(){define(["dcl/dcl","xide/manager/ServerActionBase","xide/utils","xide/mixins/VariableMixin"],function(k,p,m,g){return k([p,g.dcl],{declaredClass:"xide.manager.ResourceManager",serviceClass:"XApp_Resource_Service",resourceData:null,resourceVariables:null,getResourceVariables:function(){return this.resourceVariables},setVariable:function(c,e){return this.resourceVariables[c]=e},getVariable:function(c){return this.resourceVariables[c]},
init:function(){this.resourceVariables||(this.resourceVariables={})},replaceVariables:function(c,e){return m.multipleReplace(""+c,e||this.resourceVariables)}})})},"xide/mixins/VariableMixin":function(){define(["dcl/dcl","xdojo/declare","xide/utils"],function(k,p,m){var g={resolve:function(c,e,b){e=e||this.resourceVariables||this.ctx.getResourceManager().getResourceVariables()||null;b=b||this.variableDelimiters||null;return m.replace(c,null,e,b)}};p=p("xide/mixins/VariableMixin",null,g);p.dcl=k(null,
g);return p})},"xide/manager/PluginManager":function(){define("dcl/dcl dojo/has xide/manager/ManagerBase xide/utils xide/types xide/factory dojo/Deferred dojo/promise/all".split(" "),function(k,p,m,g,c,e,b,a){return k(m,{declaredClass:"xide.manager.PluginManager",_defaultPackageLocationPrefix:"../../",_defaultPackageLocationSuffix:"/component",_defaultComponentFlags:{LOAD:1,RUN:2},defaultComponentMixin:function(a){return{owner:this,ctx:this.ctx,flags:a}},componentBaseClasses:null,ctx:null,pluginResources:null,
pluginInstances:null,_componentReady:function(a,b,c){if(b.RUN)try{a.run(this.ctx)}catch(d){}return c.resolve(a)},_componentLoaded:function(a,b,c,d){try{g.mixin(c,this.defaultComponentMixin(b));var l=e.createInstance(a,c,this.componentBaseClasses),k=function(a,b,c){this._componentReady(a,b,c)}.bind(this);b.LOAD?l.load().then(function(){k(l,b,d)}):k(l,b,d)}catch(h){d.reject(arguments),logError(h)}},loadComponent:function(a,c,e,d,l){e="true"===e?{}:e;a=-1==a.indexOf("/")?this._defaultPackageLocationPrefix+
a+this._defaultPackageLocationSuffix:a;c=null!=c?c:this._defaultComponentFlags;var k=new b,h=this;(d=g.getObject(a))?_.isFunction(d.then)?d.then(function(a){h._componentLoaded(a,c,e,k)},function(b){console.error("error in loading component at path "+a,b)}):this._componentLoaded(d,c,e,k):console.error("cant get object at "+a);return k},loadComponentResources:function(a,b){},reloadComponent:function(a){},loadPlugins:function(f){if(p("plugins")){var e=new b,g=[],d=this;this.pluginResources=f;this.pluginInstances=
[];if(this.pluginResources)for(var l=0;l<this.pluginResources.length;l++){var k=this.pluginResources[l];k.type&&"JS-PLUGIN"==k.type&&k.path&&g.push(this.loadComponent(k.path,null,k).then(function(a){a.pluginResources=k;d.pluginInstances.push(a)}))}a(g).then(function(){e.resolve(g);d.publish(c.EVENTS.ALL_PLUGINS_READY,{instances:d.pluginInstances,resources:f})});return e}}})})},"nxapp/manager/DeviceManager":function(){define("dcl/dcl dojo/node!fs xcf/manager/DeviceManager xide/utils xide/types nxapp/utils/_console nxapp/utils dojo/node!child_process".split(" "),
function(k,p,m,g,c,e,b,a){function f(a,b,c,f,e,g,k){q.exec(c,d,function(a,b,c){if(b&&127===parseInt(b,10)&&(n.error("--have error "+c),k&&k.onCommandError))k.onCommandError();b&&0===parseInt(b,10)&&n.error("--terminate with "+b);b&&1===parseInt(b,10)&&n.error("--terminate with 1 "+b);n.error("response ",arguments)}.bind(this))}var n=e;k(null,{emit:function(){n.error("device server client emit",arguments)}});var q=a,d={stdout:!0,stderr:!0,stdin:!0,failOnError:!0,stdinRawMode:!1,killSignal:"SIGTERM"};
return k(m,{declaredClass:"nxapp.manager.DeviceManager",connection:null,runShell:function(a,b,h){var f=this.getContext().getConnectionManager();q.exec(a,d,function(b,d,e){d&&127===parseInt(d,10)&&n.error("--have error "+e);b&&n.log("err",b);d&&n.log("stdout",d);e&&n.log("stderr",e);d&&0===parseInt(d,10)&&n.info("--terminate with 0"+d);if(d&&1===parseInt(d,10)){n.info("--terminate with 1 "+d);try{f.onData(f.getConnection2(h),g.mixin({cmd:a,event:c.EVENTS.ON_COMMAND_FINISH,result:d},h),new Buffer(d))}catch(k){n.error("onFinish-Error:",
k)}}}.bind(this))},runShell2:function(a,b,c,e,g,n){g=a.options;f(a,{host:g.host,port:g.port,protocol:g.protocol},b,c,e,d,n)},onDeviceMetaChanged:function(a,c){var d=this.store;d&&_.each(d.data,function(d){if(-1!==d.path.indexOf(c)&&p.existsSync(a)){var h=g.getJson(b.readFile(a));h&&(d.user=h)}})},onFileChanged:function(a){if("changed"===a.type&&!a._did){a._did=!0;a=g.replaceAll("\\","/",a.path);a=g.replaceAll("//","/",a);a=a.replace(/\\/g,"/");var b;b=a;b=-1!=b.indexOf("system/devices")?b.substr(b.indexOf("system/devices")+
15,b.length):null;if(b&&-1!==b.indexOf(".meta.json"))this.onDeviceMetaChanged(a,b)}},checkDeviceServerConnection:function(){},sendManagerCommand:function(a,b){try{var c=this.ctx.getDeviceServer(),d={manager_command:a};g.mixin(d,b);c.handleManagerCommand(d,this.connection)}catch(f){n.error("error "+f.message,f.stack)}},sendDeviceCommand:function(a,b,c,d){a=a.options;g.mixin({src:c},a);b={command:b,device_command:"Device_Send",options:a};g.mixin(b.options,{params:{src:c,id:d}});this.ctx.getDeviceServer().handleDeviceCommand(b,
this.connection)}})})},"xcf/manager/BlockManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/types xide/utils xide/factory xide/manager/ManagerBase xblox/manager/BlockManager".split(" "),function(k,p,m,g,c,e,b,a){return k([b,a],{declaredClass:"xcf.manager.BlockManager",onReady:function(){},addDriverFunctions:function(a,b){for(var c in b)"constructor"!==c&&"inherited"!==c&&m.isFunction(b[c])&&(a[c]=b[c])},setScriptFunctions:function(a,b,c){var d=c;b.context||(b.context=a);a.blockScope||
(a.blockScope=b);this.ctx.getDeviceManager();b.context?b.context.instance&&(b.device=b.context.instance):console.error("scope has no context!");a.callCommand||(a.callCommand=function(a){var b=this.blockScope.getBlockByName(a);b?b.solve(this.blockScope):console.log("no such variable : "+a)});a.setVariable||(a.setVariable=function(c,e,h,k,m){var p=this.blockScope.getVariable(c);p?(p.value=e,p.set("value",e),console.log("setting variable "+c+" to "+e),!1!==k&&d.publish(g.EVENTS.ON_DRIVER_VARIABLE_CHANGED,
{item:p,scope:b,driver:a,owner:d,save:!0===h,source:m||g.MESSAGE_SOURCE.BLOX})):console.log("no such variable : "+c)});a.getVariable||(a.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""});this.inherited(arguments)},onReloaded:function(){this.init()},getDeviceVariablesAsEventOptions:function(a){a=[];var b=function(a,b,c,d,h){d="";if(0<c)for(var f=0;f<c;f++)d+="\x26nbsp;",d+="\x26nbsp;",d+="\x26nbsp;";return{label:d+("\x3cspan style\x3d''\x3e"+a+"\x3c/span\x3e"),label2:h,
value:b}};this.ctx.getDriverManager();for(var c=this.ctx.getDeviceManager(),d=c.getDevices(!1,!0),e=0;e<d.length;e++){var k=d[e],h=k.driver;if(h){k=c.getMetaValue(k,g.DEVICE_PROPERTY.CF_DEVICE_TITLE);a.push(b(k,h.id+"/"+h.id,0,!1));for(var t=h.blockScope.getVariables(),m=0;m<t.length;m++){var p=t[m],v=h.id+"/"+p.id;a.push(b(p.title,v,1,ci.value===v,k+"/"+p.title))}}}},onCreateVariableCI:function(a){console.log("onCreateVariableCI12",a);var b=a.CI,c=a.owner;a=null!=c.scope.device;console.log("ci value "+
b.value);if(a){a=[];var d=function(a,b,c,d,h){d="";if(0<c)for(var f=0;f<c;f++)d+="\x26nbsp;",d+="\x26nbsp;",d+="\x26nbsp;";return{label:d+("\x3cspan style\x3d''\x3e"+a+"\x3c/span\x3e"),label2:h,value:b}};this.ctx.getDriverManager();for(var e=this.ctx.getDeviceManager(),k=e.getDevices(!1,!0),h=0;h<k.length;h++){var c=k[h],t=c.driver;if(t){var m=e.getMetaValue(c,g.DEVICE_PROPERTY.CF_DEVICE_TITLE);a.push(d(m,t.id+"/"+t.id,0,!1));for(var p=t.blockScope.getVariables(),v=0;v<p.length;v++){var c=p[v],z=
t.id+"/"+c.id;a.push(d(c.name,z,1,b.value===z,m+"/"+c.title))}}}b.options=a;b.widget={"class":"xide.form.FilterSelect"}}}})})},"xblox/manager/BlockManager":function(){define("dcl/dcl dojo/_base/lang dojo/has dojo/Deferred dojo/promise/all xide/types xide/utils xide/factory xblox/model/ModelBase xblox/model/Scope xblox/model/BlockModel xide/mixins/ReloadMixin xide/manager/ManagerBase xblox/data/Store xdojo/has!xblox-ui?xblox/manager/BlockManagerUI".split(" "),function(k,p,m,g,c,e,b,a,f,n,q,d,l,r,h){return k([l,
d.dcl],{declaredClass:"xblox/manager/BlockManager",serviceObject:null,loaded:{},scope:null,scopes:null,_createBlock:null,_registerActions:function(){},toScope:function(a){try{a=b.getJson(a)}catch(c){return console.error("BlockManager::toScope: failed,err\x3d"+c),null}a||(console.error("correct data"),a={blocks:[],variables:[]});var d=b.createUUID(),h=a;!p.isArray(a)&&p.isObject(a)&&(d=a.scopeId||d,h=a.blocks||[]);a=this.getScope(d,{owner:this},!0);h=a.blocksFromJson(h);for(d=0;d<h.length;d++)h[d]._lastRunSettings=
{force:!1,highlight:!0};a.serviceObject=this.serviceObject;return a},loadFiles:function(a){for(var b=[],d=new g,h=0;h<a.length;h++){var f=a[h];b.push(this.load(f.mount,f.path,f.force))}c(b).then(function(a){d.resolve(a)});return d.promise},load:function(a,c,d){var h=new g,f=this,e=b.replaceAll("/","",a),l=b.replaceAll("./","",c),k=e+l,k=k.trim();this.loaded[k]&&!0===d&&(this.removeScope(this.loaded[k].id),this.loaded[k]=null);if(!0!==d&&this.loaded[k])return h.resolve(this.loaded[k]),h.promise;this.ctx.getFileManager().getContent(e,
l,function(b){if(b=f.toScope(b))f.loaded[k]=b,b.mount=a,b.path=c;h.resolve(b)},!1);return h.promise},onBlocksReady:function(a){for(var b=a.allBlocks(),c=0;c<b.length;c++)this.setScriptFunctions(b[c],a,this);if((a=a.getBlocks({group:"On Load"}))&&0<a.length)for(c=0;c<a.length;c++)if(b=a[c],b.onLoad)b.onLoad()},getBlock:function(){},setScriptFunctions:function(a,b,c){a.blockScope||(a.blockScope=b);b.serviceObject=this.serviceObject;a.setVariable||(a.setVariable=function(d,h,f,g,l){if(d=this.blockScope.getVariable(d))d.value=
h,!1!==g&&c.publish(e.EVENTS.ON_VARIABLE_CHANGED,{item:d,scope:b,driver:a,owner:c,save:!0===f,source:l||e.MESSAGE_SOURCE.BLOX})});a.getVariable||(a.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""})},hasScope:function(a){this.scopes||(this.scopes={});return this.scopes[a]?this.scopes[a]:null},getScope:function(b,c,d){this.scopes||(this.scopes={});if(!this.scopes[b]&&(this.scopes[b]=this.createScope({id:b,ctx:this.ctx}),this.scopes[b].userData=c,!1!==d))try{a.publish(e.EVENTS.ON_SCOPE_CREATED,
this.scopes[b])}catch(h){console.error("bad, scope creation failed "+h,h)}return this.scopes[b]},removeScope:function(a){this.scopes||(this.scopes={});for(var b in this.loaded)this.loaded[b].id==a&&delete this.loaded[b];try{this.scopes[a]&&(this.scopes[a]._destroy(),delete this.scopes[a])}catch(c){debugger}return null},createScope:function(a,c,d){c=c||[];var h=new r({data:[],Model:q,id:b.createUUID(),__events:{},observedProperties:["name","enabled","value"],getLabel:function(a){return a.name},labelAttr:"name"});
h.reset();h.setData([]);h={owner:this,blockStore:h,serviceObject:this.serviceObject,config:this.config};b.mixin(h,a);try{var f=new n(h);c&&f.initWithData(c,d);f.init()}catch(e){logError(e,"error creating scope, data:",a)}return f},onReloaded:function(){},init:function(){this.scope={variables:[],blocks:[]};f.prototype.types=e;f.prototype.factory=a;if(this.onReady)this.onReady()}})})},"xblox/model/Scope":function(){define("dcl/dcl ./ModelBase ./Expression xide/factory xide/utils xide/types xide/mixins/EventedMixin dojo/_base/lang dojo/has xide/encoding/MD5 xcf/model/Variable".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d,l){var r=f("xcf-ui");p=k([p,b.dcl],{declaredClass:"xblox.model.Scope",variableStore:null,serviceObject:null,context:null,blockStore:null,expressionModel:null,start:function(){if(!0===this.__didStartBlocks)console.error("already started blocks");else{this.__didStartBlocks=!0;var a=this.getVariable("value");a||(a=new q({id:c.createUUID(),name:"value",value:"",scope:this,type:13,group:"processVariables",gui:!1,cmd:!1}),this.blockStore.putSync(a));var a=[],b=this.getBlocks({group:e.COMMAND_TYPES.INIT_COMMAND});
try{_.each(b,function(a){!1!==a.enabled&&!0!==a.__started&&(a.solve(scope),a.__started=!0)})}catch(d){console.error("starting init blocks failed",d)}a=a.concat(this.getBlocks({group:e.COMMAND_TYPES.BASIC_COMMAND}));for(b=0;b<a.length;b++){var f=a[b];f.enabled&&f.start&&f.startup&&!0!==f.__started&&(f.start(),f.__started=!0)}}},getExpressionModel:function(){this.expressionModel||(this.expressionModel=new m);return this.expressionModel},toFriendlyName:function(a,b){if(!b||!a)return null;var d=this,
f=this.ctx,e=this.driver,e=f.getDeviceManager(),g=f.getDriverManager();if(-1==b.indexOf("://"))return(d=d.getBlockById(b))?d.name:b;var f=c.parse_url(b),f=c.urlArgs(f.host),l=e.getItemById(f.device.value);if(l){var k=e.toDeviceControlInfo(l),e=g.getDriverById(k.driverId);if((l=l.driverInstance)||e)if(d=e.blockScope?e.blockScope:l?l.blockScope:d,(a=d.getStore().getSync(f.block.value))||l&&l.blockScope&&(a=l.blockScope.getBlock(f.block.value)))return k.title+"/"+a.name}return b},getContext:function(){return this.instance},
toString:function(){var a={blocks:null,variables:null},b=this.blocksToJson();try{dojo.fromJson(JSON.stringify(b))}catch(c){return}a.blocks=b;return JSON.stringify(a,null,2)},initWithData:function(a,b){a&&this.blocksFromJson(a,null,b);this.clearCache()},getService:function(){return this.serviceObject},getStore:function(){return this.blockStore},reset:function(){this.getExpressionModel().reset()},empty:function(){this.clearCache();var a=this.blockStore,b=this.getBlocks();a.silent(!0);_.each(b,function(b){b&&
a.removeSync(b.id)});a.setData([]);a.silent(!1)},fromScope:function(a){var b=this.blockStore;b.silent(!0);this.empty();a=a.blocksToJson();this.blocksFromJson(a);b.silent(!1)},clearCache:function(){this.getExpressionModel().reset()},getVariableStore:function(){return this.blockStore},getBlockStore:function(){return this.blockStore},getVariables:function(a){if(!this.blockStore)return[];var b=this.blockStore.data,c=[];if(a&&"processVariables"===a.group){for(a=0;a<b.length;a++)"processVariables"===b[a].group&&
c.push(b[a]);return c}if(!a){for(a=0;a<b.length;a++){var d=b[a],f=d.declaredClass;"xblox.model.variables.Variable"!=f&&"xcf.model.Variable"!=f||c.push(d)}return c}return this.blockStore.query(a)},loopBlock:function(a,b){1==a._destroyed&&console.error("block destroyed");var c=a.getInterval?a.getInterval():0;if(a&&0<c&&a.enabled&&!0!==a._destroyed){var d=this;a._loop&&clearInterval(a._loop);a._loop=setInterval(function(){!a.enabled||a._destroyed?(clearInterval(a._loop),a._loop=null):a.solve(d,b||a._lastSettings)},
c)}},getEventsAsOptions:function(a){var b=[],c;for(c in e.EVENTS)b.push({label:e.EVENTS[c],value:e.EVENTS[c]});b=b.concat([{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},
{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}]);for(c=0;c<b.length;c++){var d=b[c];if(d.value===a){d.selected=!0;break}}return b},getVariablesAsObject:function(){for(var a=this.getVariables(),b={},c=0;c<a.length;c++)b[a[c].title]=a[c].value;return b},getVariablesAsOptions:function(){var a=this.getVariables(),b=[];if(a)for(var c=0;c<a.length;c++)b.push({label:a[c].label,value:a[c].variable});return b},getCommandsAsOptions:function(a){var b=this.getBlocks({declaredClass:"xcf.model.Command"}),
c=[];if(b)for(var d=0;d<b.length;d++){var f={};f[a||"label"]=b[d].name;f.value=b[d].name;c.push(f)}return c},_cached:null,getBlocks:function(a,b){if(!r&&!1!==b&&(this._cached||(this._cached={}),a)){var c=n(JSON.stringify(a),1);if(c=this._cached[c])return c}if(!this.blockStore)return[];a=a||{id:/\S+/};var d=this.blockStore.query(a,null,b);r||!1===b||(c=n(JSON.stringify(a),1),this._cached[c]=d);return d},registerVariable:function(a){this.variables[a.title]=a;this.blockStore&&this.blockStore.putSync(a)},
getVariable:function(a){for(var b=this.getVariables(),c=0;c<b.length;c++){var d=b[c];if(d.name===a)return d}return null},getVariableById:function(a){if(!a)return null;var b=a.split("/"),c=this;2==b.length&&((a=c.owner)&&a.hasScope&&(a.hasScope(b[0])?c=a.getScope(b[0]):console.error("have scope id but cant resolve it",this)),a=b[1]);return(b=c.blockStore.getSync(a))?b:null},registerBlock:function(a,b){var c=this.blockStore;if(c){var d=c.getSync(a.id);if(d)return d;d=null;return d=a.addToStore?a.addToStore(c):
c.putSync(a,b)}},allBlocks:function(a,b){return this.getBlocks({},b)},hasGroup:function(a){for(var b=this.allGroups({},!1),c=0;c<b.length;c++)if(b[c]===a)return!0;return!1},allGroups:function(){for(var a=[],b=this.allBlocks({},!1),c=function(b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1},d=0;d<b.length;d++){var f=b[d];f.parentId||(f.group?c(f.group)||a.push(f.group):c("No Group")||a.push("No Group"))}return a},variablesToJson:function(){var a=[],b=this.variableStore?this.getVariables():
this.variables,c;for(c in b){var d=b[c];if(!1!==d.serializeMe&&null!=d.keys){var f={},e;for(e in d)if(this.isString(d[e])||this.isNumber(d[e])||this.isBoolean(d[e]))f[e]=d[e];a.push(f)}}return a},isScript:function(a){return this.isString(a)&&(-1!=a.indexOf("return")||-1!=a.indexOf(";")||-1!=a.indexOf("[")||-1!=a.indexOf("{")||-1!=a.indexOf("}"))},variablesToJavascriptEx:function(a,b){for(var c=[],d=this.variableStore?this.getVariables():this.variables,f=0;f<d.length;f++){var e=d[f];if(e!=a){var g=
""+e.value;a&&a.value&&-1==a.value.indexOf(e.title)||b&&-1==b.indexOf(e.title)||0==g.length||(this.isScript(g)||-1!=g.indexOf("'")?this.isScript(g)&&(g=this.expressionModel.parseVariable(this,e)):g="'"+g+"'","''"===g&&(g="'0'"),c.push(g))}}return c},variablesToJavascript:function(a,b){for(var c="",d=this.variableStore?this.getVariables():this.variables||[],f=0;f<d.length;f++){var e=d[f];if(e!=a){var g=""+e.value;a&&a.value&&-1==a.value.indexOf(e.title)||b&&-1==b.indexOf(e.title)||0==g.length||(this.isScript(g)||
-1!=g.indexOf("'")?this.isScript(g)&&(g=this.expressionModel.parseVariable(this,e)):g="'"+g+"'","''"===g&&(g="'0'"),c+="var "+e.title+" \x3d "+g+";",c+="\n")}}return c},variablesFromJson:function(a){for(var b=[],d=0;d<a.length;d++){var f=a[d];f.scope=this;if(f.declaredClass){var e=c.replaceAll(".","/",f.declaredClass),g=require(e);g?b.push(new g(f)):console.log("couldnt resolve "+e)}else console.log("   variable has no class ")}return b},regenerateIDs:function(a){for(var b=this,d=function(a){var f=
c.createUUID(),e=b.getBlocks({parentId:a.id});if(e&&0<e.length)for(var h=0;h<e.length;h++){var g=e[h];g.parentId=f;d(g)}a.id=f},f=0;f<a.length;f++)d(a[f])},cloneBlocks2:function(a,b){var d=this.blocksToJson(a),f=this.owner.getScope(c.createUUID(),null,!1),d=f.blocksFromJson(d,!1),e=this.blockStore,d=f.allBlocks();f.regenerateIDs(d);d=f.blocksToJson(d);if(b)for(f=0;f<d.length;f++){var g=d[f];null==g.parentId&&(g.group=b)}var l=[],d=this.blocksFromJson(d);_.each(d,function(a){l.push(e.getSync(a.id))});
return l},cloneBlocks:function(a){a=this.blocksToJson(a);var b=this.owner.getScope(c.createUUID(),null,!1);a=b.blocksFromJson(a,!1);a=b.allBlocks();for(b=0;b<a.length;b++){var d=a[b];d.id=c.createUUID();d.parentId=null}this.blocksToJson(a);this.blocksFromJson(a);return a},blockToJson:function(a){var b={_containsChildrenIds:[]},c;for(c in a)if("ctrArgs"!=c&&("function"===typeof a[c]||a.serializeField(c))){if(this.isString(a[c])||this.isNumber(a[c])||this.isBoolean(a[c]))b[c]=a[c];if("parent"!=c)if(this.isBlock(a[c]))b[c]=
a[c].id,b._containsChildrenIds.push(c);else if(this.areBlocks(a[c])){b[c]=[];for(var d=0;d<a[c].length;d++)b[c].push(a[c][d].id);b._containsChildrenIds.push(c)}}return b},blocksToJson:function(a){try{var b=[];a=a&&a.length?a:this.blockStore?this.getBlocks():this.blocks;for(var c in a){var d=a[c];if(null!=d.keys&&!1!==d.serializeMe){var f={_containsChildrenIds:[]},e;for(e in d)if("ctrArgs"!=e&&("function"===typeof d[e]||d.serializeField(e))){if(this.isString(d[e])||this.isNumber(d[e])||this.isBoolean(d[e]))f[e]=
d[e];_.isObject(d[e])&&d.serializeObject&&!0===d.serializeObject(e)&&(f[e]=JSON.stringify(d[e],null,2));if("parent"!=e)if(this.isBlock(d[e]))f[e]=d[e].id,f._containsChildrenIds.push(e);else if(this.areBlocks(d[e])){f[e]=[];for(var g=0;g<d[e].length;g++)f[e].push(d[e][g].id);f._containsChildrenIds.push(e)}}b.push(f)}}}catch(l){console.error("from json failed : "+l)}return b},_createBlockStore:function(){},blockFromJson:function(a){a.scope=this;null==a._containsChildrenIds&&(a._containsChildrenIds=
[]);for(var b={},d=0;d<a._containsChildrenIds.length;d++){var f=a._containsChildrenIds[d];b[f]=a[f];a[f]=null}delete a._containsChildrenIds;if(!a.declaredClass)return console.log("   not a class "),null;f=d=null;try{f=c.replaceAll(".","/",a.declaredClass),d=require(f)}catch(e){try{f=c.replaceAll("/",".",a.declaredClass),d=require(f)}catch(l){}}d||(d=k.getObject(a.declaredClass));if(!d)return null;f=null;try{f=g.createBlock(d,a)}catch(n){return logError(n),null}f._children=b;return f},blocksFromJson:function(a,
b,d){for(var f=[],e={},l=0;l<a.length;l++){var n=a[l];n.scope=this;null==n._containsChildrenIds&&(n._containsChildrenIds=[]);for(var m={},p=0;p<n._containsChildrenIds.length;p++){var q=n._containsChildrenIds[p];m[q]=n[q];n[q]=null}delete n._containsChildrenIds;if(n.declaredClass){var r=p=null;try{r=c.replaceAll(".","/",n.declaredClass),p=require(r)}catch(x){console.error("couldnt resolve class "+r)}p||(p=k.getObject(n.declaredClass));if(p){r=null;try{r=g.createBlock(p,n,null,!1)}catch(D){console.error("error in block creation ",
D+" "+n.declaredClass);logError(D);continue}r._children=m;e[r.id]=m;f.push(r)}else console.log("couldnt resolve "+r)}else console.log("   not a class ")}a=this.allBlocks(null,!1);for(l=0;l<a.length;l++){n=a[l];n._children=e[n.id];if(n._children){for(q in n._children)if("string"==typeof n._children[q])(m=this.getBlockById(n._children[q]))?(n[q]=m,m.parent=n,m.postCreate&&m.postCreate()):(this.blockStore.removeSync(n._children[q]),d&&d("   couldnt resolve child: "+n._children[q]+"@"+n.name+":"+n.declaredClass),
console.log("   couldnt resolve child: "+n._children[q]+"@"+n.name+":"+n.declaredClass));else if("object"==typeof n._children[q])for(n[q]=[],p=0;p<n._children[q].length;p++)(m=this.getBlockById(n._children[q][p]))?(n[q].push(m),(r=this.getBlockById(m.parentId))?m.parent=r:console.error("child has no parent")):(d&&d("   couldnt resolve child: "+n._children[q]+"@"+n.name+":"+n.declaredClass),console.log("   couldnt resolve child: "+n._children[q][p]+"@"+n.name+":"+n.declaredClass));delete n._children}!1!==
b&&null!=n.parentId&&null==this.getBlockById(n.parentId)&&(n.parentId=null);n.postCreate()}this.allBlocks();return f},resolveBlock:function(a){var b=this,d=this.ctx,b=this.driver,b=d.getDeviceManager(),d=d.getDriverManager();if(-1==a.indexOf("://"))return(b=this.getBlockById(a))?b:a;a=c.parse_url(a);a=c.urlArgs(a.host);var f=b.getItemById(a.device.value);if(!f){var e=b.getInstanceByName(a.device.value);e&&(f=e.device)}if(f&&(b=b.toDeviceControlInfo(f),b=d.getDriverById(b.driverId),(d=f.driverInstance)||
b)&&(a=(b=d?d.blockScope:b.blockScope)?b.getStore().getSync(a.block.value):null))return a},getBlock:function(a){return this.getBlockById(a)},getBlockByName:function(a){if(-1!==a.indexOf("://")){var b=this.resolveBlock(a);if(b)return b}for(var c=this.getBlocks(),d=0;d<c.length;d++)if(b=c[d],b.name===a)return b;return(a=this.blockStore.query({name:a}))&&0<a.length?a[0]:null},getBlockById:function(a){return this.blockStore.getSync(a)},_flatten:function(a){var b=[],c;for(c in a){var d=a[c];if(null!=d.keys){b.push(d);
for(var f in d)if("ctrArgs"!=f&&"parent"!==f)if(this.isBlock(d[f]))b.push(d[f]);else if(this.areBlocks(d[f]))for(var e=0;e<d[f].length;e++)b.push(d[f][e])}}return b},flatten:function(a){var b=[],c;for(c in a){var d=a[c];if(null!=d.keys){var f=_.find(b,{id:d.id});f||b.push(d);for(var e in d)if("ctrArgs"!=e&&"parent"!==e){var g=d[e];if(this.isBlock(g))(f=_.find(b,{id:g.id}))||b.push(g);else if(this.areBlocks(g))for(var l=0;l<g.length;l++){var n=g[l];(f=_.find(b,{id:n.id}))||b.push(n);b=b.concat(this.flatten([n]))}}}}return b=
_.uniq(b,!1,function(a){return a.id})},_getSolve:function(a){return a.prototype?a.prototype.solve:a.__proto__.solve},solveBlock:function(b,d,f,e){d=d||{highlight:!1};var g=null;this.isString(b)?(g=this.getBlockByName(b))||(g=this.getBlockById(b)):this.isObject(b)&&(g=b);b=null;if(g){if(!0!==d.force&&0==g.enabled)return null;!0===d.force&&(d.force=!1);var l=g.declaredClass;(l=a.getObject(c.replaceAll("/",".",l))||a.getObject(l))?l.prototype&&l.prototype.solve&&(b=l.prototype.solve.apply(g,[this,d])):
(b=g.solve(g.getScope(),d,f,e),delete g.override,g.override={})}return b},solve:function(a,b){for(var c="",d=0;d<this.items.length;d++)c+=this.items[d].solve(a,b);return c},parseExpression:function(a,b,c,d,f,e,g,l){return this.getExpressionModel().parse(this,a,b,d,f,e,c,g,l)},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isBoolean:function(a){return"boolean"==typeof a},isObject:function(a){return"object"===typeof a},isBlock:function(a){var b=!1;"object"==
typeof a&&null!=a&&void 0==a.length&&a.serializeMe&&(b=!0);return b},areBlocks:function(a){var b=!1;"object"==typeof a&&null!=a&&0<a.length&&this.isBlock(a[0])&&(b=!0);return b},_onVariableChanged:function(a){a.item&&this.getExpressionModel().variableFuncCache[a.item.title]&&delete this.expressionModel.variableFuncCache[a.item.title]},init:function(){this.getExpressionModel();this.subscribe(e.EVENTS.ON_DRIVER_VARIABLE_CHANGED,this._onVariableChanged);var a=this;this.subscribe(e.EVENTS.ON_MODULE_RELOADED,
function(b){var d=b.module,f=b.newModule;(b=a.getBlocks().filter(function(a){return a.declaredClass==d||a.declaredClass==c.replaceAll("/",".",d)?a:null}))&&_.each(b,function(a){var b=f.prototype,c;for(c in b){var d=b[c];d&&_.isFunction(d)&&(a[c]=d)}})})},_destroy:function(){for(var a=this.allBlocks(),b=0;b<a.length;b++){var c=a[b];if(c)try{c&&c.stop&&c.stop(!0),c&&c.reset&&c.reset(),c&&c._destroy&&c._destroy(),c&&c.destroy&&c.destroy(),c._emit&&c._emit(e.EVENTS.ON_ITEM_REMOVED,{item:c})}catch(d){}}},
destroy:function(){this._destroy();this.reset();this._destroyed=!0;delete this.expressionModel},moveTo:function(a,b,c,d){if(d){if(b.canAdd&&b.canAdd()){var f=this.getBlockById(a.parentId);f&&f.removeBlock(a,!1);b.add(a,null,null);return}console.error("cant reparent");return!1}if(b.parentId||0!=d)if(!a.parentId&&b.parentId&&0==d)a.group=b.group;else if(a.parentId||b.parentId||!d){if(a.parentId&&b.parentId&&0==d&&a.parentId===b.parentId){var e=this.getBlockById(a.parentId);if(!e)return!1;var g=e[e._getContainer(a)],
f=a.indexOf(g,a);b=a.indexOf(g,b);g=f>b?-1:1;c=Math.abs(f-(b+(1==c?-1:1)));for(b=0;b<c-1;b++)e.move(a,g);return!0}if(a.parentId&&b.parentId&&0==d&&a.parentId!==b.parentId){console.log("same parent!");f=this.getBlockById(a.parentId);if(f&&(e=this.getBlockById(b.parentId))&&f&&f.removeBlock&&e.canAdd&&e.canAdd())f.removeBlock(a,!1),e.add(a,null,null);else return!1;g=e[e._getContainer(a)];null==g&&console.error("weird : target parent has no item container");f=e.indexOf(g,a);b=e.indexOf(g,b);if(!f||!b){console.error(" weird : invalid drop processing state, have no valid item indicies");
return}g=f>b?-1:1;c=Math.abs(f-(b+(1==c?-1:1)));for(b=0;b<c-1;b++)e.move(a,g);return!0}}else return b.canAdd&&b.canAdd()&&(a.group=null,b.add(a,null,null)),!0;else{(f=this.getBlockById(a.parentId))&&f.removeBlock&&(f.removeBlock(a,!1),a.parentId=null,a.group=b.group);var e=[],g=this.getBlocks({group:b.group}),l=[],f=this.getBlockStore(),n=f.storage.index[b.id];for(b=0;b<g.length;b++)if(d=g[b],null==g[b].parentId&&g[b]!=a&&(d=f.storage.index[d.id],d=c?d>=n:d<=n))e.push(g[b]),l.push(f.storage.index[g[b].id]);
for(b=0;b<e.length;b++)f.remove(e[b].id);this.getBlockStore().remove(a.id);c&&this.getBlockStore().putSync(a);for(b=0;b<e.length;b++)f.put(e[b]);c||this.getBlockStore().putSync(a);return!0}return!1}});k.chainAfter(p,"destroy");return p})},"xblox/model/Expression":function(){define(["xdojo/declare","xdojo/has","xide/utils","xide/types","xblox/model/ModelBase"],function(k,p,m,g,c,e,b){var a="undefined"!==typeof window?window.console:global.console;e&&a&&a.error&&(a=b);return k("xblox.model.Expression",
[c],{id:null,context:null,variableDelimiters:{begin:"[",end:"]"},blockCallDelimiters:{begin:"{",end:"}"},expressionCache:null,variableFuncCache:null,constructor:function(){this.reset()},reset:function(){this.expressionCache={};this.variableFuncCache={}},replaceVariables:function(b,c,e,d,l,k,h,m){h=h||this.variableDelimiters;m=m||g.CIFLAG.NONE;m&g.CIFLAG.DONT_ESCAPE&&(d=!1);m&g.CIFLAG.DONT_PARSE&&(e=!1);var p=this._findOcurrences(c,h);if(p)for(var u=0;u<p.length;u++){var v=p[u],v=v.replace(h.begin,
""),v=v.replace(h.end,"");(v=this._getVar(b,v))&&v.flags&g.CIFLAG.DONT_PARSE&&(e=!1);var z=null;if(v){if(k){c=c.replace(p[u],"this.getVariable('"+v.name+"')");continue}z=this.getValue(v.value);l&&v.name in l&&(z=l[v.name]);if(this.isScript(z)&&!1!==e)try{var C=b.variablesToJavascript(v,!0);C&&(z=C+z);var B=(new Function("{\n"+z+"\n}")).call(b.context||{});"undefined"===B||"undefined"===typeof B?z=""+v.value:(z=B,m&g.CIFLAG.DONT_ESCAPE||(z="'"+z+"'"))}catch(E){a.log(" parsed variable expression failed \n"+
z,E)}else this.isNumber(z)||!1!==d&&(z="'"+z+"'")}else z=p[u];c=c.replace(p[u],z)}return c},parse:function(b,c,e,d,g,k,h,m,p){c=this.replaceAll("''","'",c);e=k||b.context||b.getContext()||{};c=this.replaceVariables(b,c,null,null,h,null!=e.getVariable,null,p);h=this.isScript(c);if(!h&&(this.isString(c)||this.isNumber(c)))return d&&d("Expression "+c+" evaluates to "+c),c;-1==c.indexOf("return")&&h&&(c="return "+c);b=this;try{c=this.replaceAll("''","'",c);var u=this.expressionCache[c];u||(u=new Function("{"+
c+"; }"),this.expressionCache[c]=u);b=u.apply(e,m)}catch(v){return a.error("     invalid expression : \n"+c,v),g&&g("invalid expression : \n"+c+": "+v,v),b=""+c}d&&d("Expression "+c+" evaluates to "+b);return b},parseVariableO:function(b,c){var e=""+c.value;if("None"===c.title)return"";try{var d=b.variablesToJavascript(c,!1);d&&(e=d+e);var g=(new Function("{"+e+"}")).call(this.context||{});"undefined"===g||"undefined"===typeof g?e=""+c.value:this.isNumber(g)?e=g:(e=""+g,e="'"+e+"'")}catch(k){a.error("parse variable failed : "+
c.title+"\n"+e)}return e},parseVariable:function(a,b,c,d,e,g,h){var k=""+b.value;c=c||"";!1!==e?(e=this.variableFuncCache[a.id+"|"+b.title],e||(e=new Function("{"+c+k+"}"),this.variableFuncCache[a.id+"|"+b.title]=e)):e=new Function("{"+c+k+"}");a=e.apply(g||a.context||{},h||[]);return k="undefined"===a||"undefined"===typeof a?""+b.value:this.isNumber(a)||!1===d?a:"'"+a+"'"},replaceBlockCalls:function(a,b){var c=this._findOcurrences(b,this.blockCallDelimiters);if(c)for(var d=0;d<c.length;d++){var e=
this._removeDelimiters(c[d],this.blockCallDelimiters),e=a.solveBlock(e).join("\n");b=b.replace(c[d],e)}return b},_getVar:function(a,b){return a.getVariable(this._getVarName(b))},_getVarName:function(a){return this._removeDelimiters(a,this.variableDelimiters)},_removeDelimiters:function(a,b){return a.replace(b.begin,"").replace(b.end,"")},_escapeRegExp:function(a){for(var b="[](){}*+.".split(""),c=0;c<b.length;c++)a=a.replace(b[c],"\\"+b[c]);return a},_findOcurrences:function(a,b){var c=this._escapeRegExp(b.begin),
d=this._escapeRegExp(b.end);return a.match(new RegExp(c+"("+("[^"+d+"]*")+")"+d,"g"))}})})},"xblox/model/BlockModel":function(){define(["dcl/dcl","xdojo/declare","xide/data/Model","xide/data/Source"],function(k,p,m,g){return p("xblox.model.BlockModel",[m,g],{declaredClass:"xblox.model.BlockModel",icon:"fa-play",mayHaveChildren:function(c){return null!=this.items&&0<this.items.length},getChildren:function(c){return this.items},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e'}})})},
"xblox/data/Store":function(){define("dojo/_base/declare xide/data/TreeMemory xide/data/ObservableStore xide/data/Model dstore/Trackable dojo/Deferred".split(" "),function(k,p,m,g,c,e){return k("xblox.data.Store",[p,c,m],{idProperty:"id",parentField:"parentId",filter:function(b){var a=this.inherited(arguments);this._state.filter=b;return a},getChildren:function(b){return this.root.filter({parentId:this.getIdentity(b)})},__getChildren:function(b){return this.inherited(arguments)},_fetchRange:function(b){var a=
new e;b=this.fetchRangeSync(b);if(this._state.filter){if(this._state&&this._state.filter&&this._state.filter.parentId){var c=this.getSync(this._state.filter.parentId);c&&(this.reset(),b=c.items,c.getChildren&&(b=c.getChildren()),a.resolve(b))}this._state&&this._state.filter&&this._state.filter.group&&(this.getSync(this._state.filter.parent),c&&(this.reset(),b=c.items))}a.resolve(b);return a},mayHaveChildren:function(b){return b.mayHaveChildren?b.mayHaveChildren(b):null!=b.items&&0<b.items.length}})})},
"xblox/factory/Blocks":function(){define("xide/factory xide/utils xide/types xide/mixins/ReloadMixin xide/mixins/EventedMixin xblox/model/logic/CaseBlock xblox/model/Block xblox/model/functions/CallBlock xblox/model/functions/StopBlock xblox/model/functions/PauseBlock xblox/model/functions/SetProperties xblox/model/code/CallMethod xblox/model/code/RunScript xblox/model/loops/ForBlock xblox/model/loops/WhileBlock xblox/model/variables/VariableAssignmentBlock xblox/model/logic/IfBlock xblox/model/logic/ElseIfBlock xblox/model/logic/SwitchBlock xblox/model/variables/VariableSwitch xblox/model/logging/Log xblox/model/server/RunServerMethod xblox/model/server/Shell xblox/model/code/RunBlock xblox/model/events/OnEvent xblox/model/events/OnKey xblox/model/mqtt/Subscribe xblox/model/mqtt/Publish xblox/model/File/ReadJSON xcf/factory/Blocks".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d,l,r,h,t,y,u,v,z,C,B,E,G,F,x,D,w,A){k.prepareBlockContructorArgs=function(a){a||(a={});a.id||(a.id=p.createUUID());a.items||(a.items=[])};k.createBlock=function(a,b,c,d){k.prepareBlockContructorArgs(b);a=k.createInstance(a,b,c);a.ctrArgs=null;var e;try{a&&a.init&&a.init();a.scope&&(e=a.scope.registerBlock(a,d));try{a.initReload&&a.initReload()}catch(f){debugger}}catch(h){logError(h,"create block")}return e||a};var H=null;k.clearVariables=function(){};k.getAllBlocks=
function(a,b,c,d,e){if(!1!==e&&null!=H){for(a=0;a<H.length;a++)if(b=H[a],"Set Variable"===b.name){H.remove(b);break}return H}0==e&&(H=null);e=k._getFlowBlocks(a,b,c,d);e=e.concat(k._getLoopBlocks(a,b,c,d));e=e.concat(k._getCommandBlocks(a,b,c,d));e=e.concat(k._getCodeBlocks(a,b,c,d));e=e.concat(k._getEventBlocks(a,b,c,d));e=e.concat(k._getLoggingBlocks(a,b,c,d));e=e.concat(k._getServerBlocks(a,b,c,d));e=e.concat(k._getMQTTBlocks(a,b,c,d));return H=e=e.concat(k._getFileBlocks(a,b,c,d))};k._getMQTTBlocks=
function(a,b,c,d){var e=[];e.push({name:"MQTT",iconClass:"fa-cloud",items:[{name:"Subscribe",owner:b,iconClass:"fa-bell",proto:D,target:c,ctrArgs:{scope:a,group:d}},{name:"Publish",owner:b,iconClass:"fa-send",proto:w,target:c,ctrArgs:{scope:a,group:d}}]});k.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"MQTT"});return e};k._getFileBlocks=function(a,b,c,d){var e=[];e.push({name:"File",iconClass:"fa-file",items:[{name:"%%Read JSON",owner:b,iconClass:"fa-file",proto:A,target:c,ctrArgs:{scope:a,
group:d}}]});k.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"File"});return e};k._getServerBlocks=function(a,b,c,d){var e=[];e.push({name:"Server",iconClass:"el-icon-repeat",items:[{name:"Run Server Method",owner:b,iconClass:"fa-plug",proto:B,target:c,ctrArgs:{scope:a,group:d}},{name:"Shell",owner:b,iconClass:"fa-code",proto:E,target:c,ctrArgs:{scope:a,group:d}}]});k.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Server"});return e};k._getVariableBlocks=function(a,b,c,d){var e=
[];e.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:y,target:c,ctrArgs:{scope:a,group:d,condition:"[value]\x3d\x3d'PW'"}}]});return e};k._getEventBlocks=function(a,b,c,d){var e=[];e.push({name:"Events",iconClass:"fa-bell",items:[{name:"On Event",owner:b,iconClass:"fa-bell",proto:F,target:c,ctrArgs:{scope:a,group:d}},{name:"On Key",owner:b,iconClass:"fa-keyboard-o",proto:x,target:c,ctrArgs:{scope:a,group:d}}]});k.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,
{items:e,group:"Events"});return e};k._getLoggingBlocks=function(a,b,c,d){var e=[];e.push({name:"Logging",iconClass:"fa-bug",items:[{name:"Log",owner:b,iconClass:"fa-bug",proto:C,target:c,ctrArgs:{scope:a,group:d}}]});k.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Logging"});return e};k._getCodeBlocks=function(a,b,c,e){var f=[];f.push({name:"Code",iconClass:"fa-code",items:[{name:"Call Method",owner:b,iconClass:"el-icon-video",proto:d,target:c,ctrArgs:{scope:a,group:e}},{name:"Run Script",
owner:b,iconClass:"fa-code",proto:l,target:c,ctrArgs:{scope:a,group:e}},{name:"Run Block",owner:b,iconClass:"fa-code",proto:G,target:c,ctrArgs:{scope:a,group:e}},{name:"Set Properties",owner:b,iconClass:"fa-code",proto:q,target:c,ctrArgs:{scope:a,group:e}}]});k.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:f,group:"Code"});return f};k._getFlowBlocks=function(a,b,c,d){var e=[];e.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:y,target:c,
ctrArgs:{scope:a,group:d,condition:"[value]\x3d\x3d'PW'"}},{name:"Switch",owner:b,iconClass:"el-icon-fork",proto:v,target:c,ctrArgs:{scope:a,group:d}},{name:"Variable Switch",owner:b,iconClass:"el-icon-fork",proto:z,target:c,ctrArgs:{scope:a,group:d}}]});k.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Flow"});return e};k._getLoopBlocks=function(a,b,c,d){var e=[];e.push({name:"Loops",iconClass:"el-icon-repeat",items:[{name:"While",owner:b,iconClass:"el-icon-repeat",proto:h,target:c,ctrArgs:{scope:a,
group:d,condition:"[Volume]\x3c\x3d100"}},{name:"For",owner:b,iconClass:"el-icon-repeat",proto:r,target:c,ctrArgs:{scope:a,group:d,initial:"1",comparator:"\x3c\x3d","final":"5",modifier:"+1",counterName:"value"}}]});k.publish(m.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Loops"});return e};k._getMathBlocks=function(a,b,c,d){b=[];b.push({name:"Math",owner:this,iconClass:"el-icon-qrcode",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-compass",proto:y,item:c,ctrArgs:{scope:a,group:d}}]});
return b};k._getTimeBlocks=function(a,b,c,d){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-qrcode",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-time",proto:y,item:c,ctrArgs:{scope:a,group:d}}]});return b};k._getTransformBlocks=function(a,b,c,d){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-magic",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-time",proto:y,item:c,ctrArgs:{scope:a,group:d}}]});return b};return k})},"xblox/model/logic/CaseBlock":function(){define("dcl/dcl xide/utils xide/types xblox/model/Block dojo/Deferred xblox/model/logic/BreakBlock".split(" "),
function(k,p,m,g,c,e){return k(g,{declaredClass:"xblox.model.logic.CaseBlock",comparator:null,expression:null,items:null,name:"Case",icon:"",hasInlineEdits:!0,toText:function(){return'\x3cspan style\x3d"text-indent: 1em;"\x3e\x26nbsp;\x26nbsp;\x26nbsp;'+this.getBlockIcon("I")+this.name+" "+this.makeEditable("comparator","right","text","Enter a comparison","inline")+(null!=this.expression?" "+this.makeEditable("expression","right","text","Enter a value to compare"):"")+"\x3c/span\x3e"},canAdd:function(){return[]},
_solve:function(b,a,c){a=a||{highlight:!1};for(var e=[],g=0;g<this.items.length;g++){var d=this.items[g];-1!==d.declaredClass.indexOf("BreakBlock")&&c.stop();this.addToEnd(e,d.solve(b,a))}return e},solve:function(b,a,c){try{var e=b.getVariableById(a.variable);!e&&c.args&&c.args[0]&&(e={value:c.args[0]});var g="";if(e)g=this._getArg(e.value,!0);else return this.onFailed(this,c),!1;if(!0===b.parseExpression(""+g+""+this.comparator+this._getArg(this.expression,!0)))return this.onSuccess(this,c),this._solve(b,
c,a),!0;this.onFailed(this,c);return!1}catch(d){console.error("case block crashed! ",d.stack),console.trace()}},getChildren:function(b){return this.items},getFields:function(){function b(a,b){return{label:b||a,value:a}}var a=this.inherited(arguments)||this.getDefaultFields();a.push(p.createCI("Expression",13,this.expression,{group:"General",title:"Expression",dst:"expression"}));a.push(p.createCI("Comparator",3,this.comparator,{group:"General",title:"Comparator",dst:"comparator",widget:{options:[b("\x3d\x3d"),
b("\x3c\x3d"),b("\x3d\x3e"),b("!\x3d"),b("\x3c"),b("\x3e")],editable:!0}}));return a},runAction:function(b){if("New/Break"===b.command){b=new c;var a=this.add(e,{group:null});b.resolve({select:[a],focus:!0,append:!1});a.refresh();return b}},getActions:function(){return[this.createAction({label:"Break",command:"New/Break",tab:"Home",icon:"fa-stop",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}})]}})})},"xblox/model/logic/BreakBlock":function(){define(["dcl/dcl","xide/utils","xide/types",
"xblox/model/Block"],function(k,p,m,g){return k(g,{declaredClass:"xblox.model.logic.BreakBlock",name:"Break",icon:"fa-stop",hasInlineEdits:!1,canAdd:!1,toText:function(){return'\x26nbsp;\x3cspan class\x3d"fa-stop text-warning"\x3e\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan\x3e'+this.name+"\x3c/span\x3e"},solve:function(c,e){this.onSuccess(this,e)},getFields:function(){return this.inherited(arguments)||this.getDefaultFields()}})})},"xblox/model/functions/CallBlock":function(){define("dcl/dcl xide/utils xide/types dojo/Deferred xblox/model/Block xcf/model/Command".split(" "),
function(k,p,m,g,c,e){return k(e,{declaredClass:"xblox.model.functions.CallBlock",command:"Select command please",icon:"",args:null,_timeout:100,isCommand:!0,_commandHandles:null,onCommandProgress:function(b){this.getScope().getContext();var a=b.params;a&&a.id&&(this._emit("cmd:"+b.cmd+"_"+a.id,{msg:b}),b.lastResponse&&this.storeResult(b.lastResponse),this._emit("progress",{msg:b,id:a.id}));this._lastResult=null;this._lastResult=b?b.result:null;b=this.getItems(m.BLOCK_OUTLET.PROGRESS);this._lastSettings||
(this._lastSettings={});this._lastSettings.override={};b.length&&this.runFrom(b,0,this._lastSettings)},stop:function(){this._lastCommand&&this._lastCommand.stop()},pause:function(){this._lastCommand&&this._lastCommand.pause()},destroy:function(){_.invoke(this._commandHandles,"remove");delete this._commandHandles;delete this._lastCommand},solve:function(b,a){this._commandHandles&&_.invoke(this._commandHandles,"remove");this._commandHandles=[];var c=this._timeout||50;_.isString(c)&&(c=parseInt(c));
var e=new g,k=this._commandHandles;a=a||{};setTimeout(function(){if(this.command){var c=null;if(this.args){a.override=a.override||{};var f=b.expressionModel.replaceVariables(b,this.args,!1,!1,null,null,{begin:"%%",end:"%%"});try{c=p.fromJson(f)}catch(g){c=f}a.override.args=_.isArray(c)?c:[f];a.override.mixin=c}if(this._lastCommand=b.resolveBlock(this.command))k.push(this._lastCommand._on("paused",this.onCommandPaused,this)),k.push(this._lastCommand._on("finished",this.onCommandFinish,this)),k.push(this._lastCommand._on("stopped",
this.onCommandStopped,this)),k.push(this._lastCommand._on("error",this.onCommandError,this)),k.push(this._lastCommand._on("progress",this.onCommandProgress,this));if(c=b.solveBlock(this.command,a))this.onSuccess(this,a);else this.onFailed(this,a);e.resolve(c);return c}}.bind(this),c);return e},hasInlineEdits:!0,makeEditable:function(b,a,c,e,g,d,l){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+a+"' display-mode\x3d'"+(g||"popup")+"' display-type\x3d'"+(c||"text")+"' data-prop\x3d'"+b+"' data-title\x3d'"+
e+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[b]+"\x3c/a\x3e"},getFieldOptions:function(b){if("command"===b)return this.scope.getCommandsAsOptions("text")},toText:function(){var b="Unknown",a=this.scope.getBlock(this.command);a&&(b=a.name);-1!==this.command.indexOf("://")&&(b='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Call Command : "+b},getFields:function(){var b=this.getDefaultFields();this.command.indexOf("://")&&
this.scope.toFriendlyName(this,this.command);b.push(p.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));b.push(p.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));b.push(p.createCI("timeout",13,this._timeout,{group:"General",title:"Delay",dst:"_timeout"}));return b}})})},"xcf/model/Command":function(){define("dcl/dcl xblox/model/Block xblox/model/Contains xide/utils xide/types dojo/Deferred xblox/types/Types".split(" "),
function(k,p,m,g,c,e,b){return k([p,m],{declaredClass:"xcf.model.Command",startup:!1,auto:null,send:"",name:"No Title",observed:["send"],interval:0,flags:2048,_runningDfd:null,__started:!1,isCommand:!0,getItems:function(a){return this.getItemsByType(a)},onCommandFinish:function(a){this.getScope();var b=null;if(a.params&&a.params.id){var e=a.params.id,b=this.getDeferred(e);delete this._solving[e];a.lastResponse&&this.storeResult(a.lastResponse);this._emit("finished",{msg:a,result:this._lastResult})}a=
this.getItems(c.BLOCK_OUTLET.FINISH);a.length&&this.runFrom(a,0,this._lastSettings);this.resolve({});this.onSuccess(this,this._lastSettings);b&&b.resolve(this._lastResult)},onCommandPaused:function(a){var b=a.params;b&&b.id&&(a.lastResponse&&this.storeResult(a.lastResponse),this._emit("paused",{msg:a,result:this._lastResult,id:b.id}));a=this.getItems(c.BLOCK_OUTLET.PAUSED);a.length&&this.runFrom(a,0,this._lastSettings)},onCommandStopped:function(a){this.getScope();var b=a.params;b&&b.id&&(a.lastResponse&&
this.storeResult(a.lastResponse),this._emit("stopped",{msg:a,result:this._lastResult,id:b.id}));a=this.getItems(c.BLOCK_OUTLET.STOPPED);a.length&&this.runFrom(a,0,this._lastSettings)},onCommandProgress:function(a){var b=a.params;b&&b.id&&(a.lastResponse&&this.storeResult(a.lastResponse),this._emit("progress",{msg:a,result:this._lastResult,id:b.id}));a=this.getItems(c.BLOCK_OUTLET.PROGRESS);a.length&&this.runFrom(a,0,this._lastSettings)},storeResult:function(a){var b=g.getJson(a);a=null;if(b&&b.result&&
_.isString(b.result)){var c=b.result,e=-1!==c.indexOf("{")||-1!==c.indexOf("["),b=c;e&&(c=g.getJson(c,!0,!1))&&(b=c);this._lastResult=null!==b?a=b:null}return a},resolve:function(a){a=a||this._lastResult;this._runningDfd&&this._runningDfd.resolve(a)},onCommandError:function(a){this.getScope();var b=a.params;b.id&&(a.lastResponse&&this.storeResult(a.lastResponse),this._emit("cmd:"+a.cmd+"_"+b.id,a),this._emit("error",{msg:a,result:this._lastResult,id:b.id}));this.onFailed(this,this._settings);a=this.getItems(c.BLOCK_OUTLET.ERROR);
a.length&&this.runFrom(a,0,this._lastSettings)},sendToDevice:function(a,b,e,k,d){if(!this._destroyed){a=this.replaceAll("'","",a);d=d||g.createUUID();var l=this,m=this.flags&c.CIFLAG.WAIT?!0:!1;this.lastCommand=""+a;if(this.scope.instance)m&&this._on("cmd:"+a+"_"+d,function(a){if(a.error)l.onFailed(l,b);else l.onSuccess(l,b)}),this.scope.instance.sendMessage(a,null,this.id,d,m,e,k);else return this.publish(c.EVENTS.ON_STATUS_MESSAGE,{text:"Command "+this.name+" : have no device",type:"error",delay:1E3}),
!1;return d}},reset:function(){this._lastSettings={};this._loop&&(clearTimeout(this._loop),this._loop=null);delete this._runningDfd},_solving:null,addDeferred:function(a){this._solving||(this._solving={});this._solving[a]=new e;return this._solving[a]},getDeferred:function(a){this._solving||(this._solving={});return this._solving[a]},_resolve:function(a,b,e){if(_.isNumber(a)||_.isBoolean(a))return a;var k=this.scope;a=a||this._get("send");b=b||{};var d=b.flags||this.flags,l=!(d&c.CIFLAG.DONT_PARSE),
m=d&c.CIFLAG.EXPRESSION;d&c.CIFLAG.TO_HEX&&(a=g.to_hex(a));!1!==l&&(a=g.convertAllEscapes(a,"none"));b=b||this._lastSettings||{};if(d=(b=b.override||this.override||{},b.variables)?b.variables:null)for(var h in d)_.isNumber(d[h])&&(d[h]=Math.round(d[h]));h="";var p=this.getDriverModule();p&&p.resolveBefore&&!1!==e&&(a=p.resolveBefore(this,a)||a);h=m&&!1!==l?k.parseExpression(a,null,d,null,null,null,b.args):""+a;p&&p.resolveAfter&&!1!==e&&(h=p.resolveAfter(this,h)||h);return h},solve:function(a,b,e,
k){var d=null;a=a||this.scope;(b=this._lastSettings=b||this._lastSettings||{},b.override)&&b.override.mixin&&g.mixin(this.override,b.override.mixin);var l=k||this._get("send")||this.send,m=!(this.flags&c.CIFLAG.DONT_PARSE);k=this.flags&c.CIFLAG.WAIT?!0:!1;var h=g.createUUID();this.flags&c.CIFLAG.TO_HEX&&(l=g.to_hex(l));!1!==m&&(l=g.convertAllEscapes(l,"none"));if(this.enabled||!0===e){!0===e&&this._loop&&this.reset();if(!0!==k)this.onRun(this,b);else this.onRun(this,b,{timeout:!1}),d=this.addDeferred(h);
if(this.items&&0<this.items.length){if(l&&0<l.length&&(l=this._resolve(this.send,b))&&0<l.length)if(this.sendToDevice(l,b))this.onSuccess(this,b);else this.onFailed(this,b);if(k)return d;e=[];for(d=0;d<this.items.length;d++)k=this.items[d],k.enabled&&e.push(k.solve(a,b));return e}if(0<l.length){if((l=this._resolve(this.send,b))&&0<l.length&&!this.sendToDevice(l,b,null,null,h))this.onFailed(this,b);if(!0!==k)this.onSuccess(this,b);else this._settings=b;e&&this.auto&&0<this.getInterval()&&this.scope.loopBlock(this,
b);return k?d:[l]}return!1}this.reset()},canAdd:function(){return[]},mayHaveChildren:function(a){return null!=this.items&&0<this.items.length},getChildren:function(a){return this.items},hasInlineEdits:!0,toText:function(a,b,c,e){var d="";!1!==a&&(d+="\x3cspan class\x3d'text-primary inline-icon'\x3e"+this.getBlockIcon()+"\x3c/span\x3e");!1!==b&&(d+=""+this.makeEditable("name","bottom","text","Enter a unique name","inline")+"");!0===e&&(d+="\x3cbr/\x3e");!1!==c&&(d+="\x3cspan class\x3d'text-muted small'\x3e Send:\x3ckbd class\x3d'text-warning'\x3e"+
this.makeEditable("send","bottom","text","Enter the string to send","inline")+"\x3c/kbd\x3e\x3c/span\x3e");!1!==a&&(this.startup&&(d+=this.getIcon("fa-bell inline-icon text-warning","text-align:right;float:right;","")),this.auto&&0<this.getInterval()&&(d+=this.getIcon("fa-clock-o inline-icon text-warning","text-align:right;float:right","")));return d=this.getDriverToText(d)||d},getInterval:function(){return parseInt(this.interval,10)},start:function(){this.startup&&!this.auto?this.solve(this.scope):
this.auto&&0<this.getInterval()&&this.scope.loopBlock(this)},getDriverModule:function(){var a=null,b=this.getInstance();b?a=b.Module:(b=this.getScope().driver)&&b.Module&&(a=b.Module);return a},getDriverToText:function(a){var b=this.getDriverModule();if(b&&b.toText)return b.toText(this,a)},getDriverFields:function(a){var b=this.getDriverModule(),c=[];b&&b.getFields&&(c=b.getFields(this,a)||[]);return c},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),b=this;a.push(this.utils.createCI("name",
13,this.name,{group:"General",title:"Name",dst:"name",order:200}));a.push(this.utils.createCI("startup",0,this.startup,{group:"General",title:"Send on Startup",dst:"startup",order:199}));a.push(this.utils.createCI("auto",0,this.auto,{group:"General",title:"Auto Send",dst:"auto",order:198}));a.push(this.utils.createCI("interval",13,this.interval,{group:"General",title:"Interval",dst:"interval",order:197}));a.push(this.utils.createCI("send",c.ECIType.EXPRESSION_EDITOR,this.send,{group:"Send",title:"Send",
dst:"send",widget:{instantChanges:!1,allowACECache:!0,showBrowser:!1,showSaveButton:!0,style:"height:inherit;",editorOptions:{showGutter:!1,autoFocus:!1},aceOptions:{hasEmmet:!1,hasLinking:!1,hasMultiDocs:!1},item:this},delegate:{runExpression:function(a,c,d){return b.scope.expressionModel.parse(b.scope,a,!1,c,d)}}}));a.push(this.utils.createCI("flags",5,this.flags,{group:"General",title:"Flags",dst:"flags",data:[{value:4096,label:"Dont parse",title:"Do not parse the string and use it as is"},{value:2048,
label:"Expression",title:"Parse it as Javascript"},{value:32768,label:"Wait",title:"Wait for response"}],widget:{hex:!0}}));return a=a.concat(this.getDriverFields(a))},icon:"fa-exclamation",getIconClass:function(){return"el-icon-play-circle"},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e '},canEdit:function(){return!0},onChangeField:function(a,b,c){var e=this.getInterval();"auto"==a&&(!0===b?0<e&&this.scope.loopBlock(this):this._loop&&this.reset());"enabled"==a&&
(!1===b?this.reset():e&&this.scope.loopBlock(this));"interval"==a&&(0<e&&this.auto?this.scope.loopBlock(this):this.reset());this.inherited(arguments)},destroy:function(){this.reset()},pause:function(){var a=this.lastCommand||this._resolve(this.send,this._lastSettings);null!==a&&this.sendToDevice(a,this._lastSettings,!1,!0)},stop:function(a){!0!==a&&(this.onSuccess(this,{highlight:!0}),this.resolve(""),a=this.lastCommand||this._resolve(this.send,this._lastSettings),_.isEmpty(a)||this.sendToDevice(a,
this._lastSettings,!0,!1),delete this._runningDfd)}})})},"xblox/model/Contains":function(){define(["dcl/dcl","dojo/promise/all","xide/types"],function(k,p,m){return k(null,{declaredClass:"xblox.model.Contains",runByType:function(g,c){var e=this.getItemsByType(g);e.length&&this.runFrom(e,0,c)},getItemsByType:function(g){var c=this.items;if(!g)return c;var e=[];_.each(c,function(b){b.outlet&g&&e.push(b)});return e},getContainer:function(){return this[this._getContainer()]},mayHaveChildren:function(g){g=
this[this._getContainer()];return null!=g&&0<g.length},getChildren:function(g){return this[this._getContainer()]},canAdd:function(){return[]},runFrom:function(g,c,e){var b=this,a=g||this.items;g=[];var f=function(c){c._deferredObject.then(function(f){console.log("----def block finish");c._lastResult=c._lastResult||f;b._currentIndex++;b.runFrom(a,b._currentIndex,e)})};if(a.length)for(;c<a.length;c++){var k=a[c];if(!0===k.deferred&&k.enabled){k._deferredObject=new Deferred;this._currentIndex=c;f(k);
var m=k.solve(this.scope,e);g.push(m);break}else k.enabled&&(m=k.solve(this.scope,e),g.push(m),k.onDidRun())}else this.onSuccess(this,e);this._lastSettings&&delete this._lastSettings.override;return g},_solve:function(g,c,e,b){!this._lastRunSettings&&c&&(this._lastRunSettings=c);c=this._lastRunSettings||c;this._currentIndex=0;this._return=[];g=this[this._getContainer()];if(g.length)return g=this.runFrom(g,0,c),this.onSuccess(this,c),g;this.onSuccess(this,c);return[]},onDidRunItem:function(g,c,e){this._emit(m.EVENTS.ON_RUN_BLOCK_SUCCESS,
this);g.resolve(c)},onDidRunItemError:function(g,c,e){g.reject(c)},onRunThis:function(g){this._emit(m.EVENTS.ON_RUN_BLOCK,this)},onDidRunThis:function(g,c,e,b){var a=this;if(e&&e.length)e=a.runFrom(e,0,b),p(e).then(function(e){a.onDidRunItem(g,c,b)},function(c){console.error("error in chain",c);a.onDidRunItem(g,c,b)});else a.onDidRunItem(g,c,b)},___solve:function(g,c,e,b){}})})},"xblox/types/Types":function(){define(["xide/types/Types","xide/utils"],function(k,p){k.BLOCK_MODE={NORMAL:0,UPDATE_WIDGET_PROPERTY:1};
k.BLOCK_OUTLET={NONE:0,PROGRESS:1,ERROR:2,PAUSED:4,FINISH:8,STOPPED:16};p.mixin(k.EVENTS,{ON_RUN_BLOCK:"onRunBlock",ON_RUN_BLOCK_FAILED:"onRunBlockFailed",ON_RUN_BLOCK_SUCCESS:"onRunBlockSuccess",ON_BLOCK_SELECTED:"onItemSelected",ON_BLOCK_UNSELECTED:"onBlockUnSelected",ON_BLOCK_EXPRESSION_FAILED:"onExpressionFailed",ON_BUILD_BLOCK_INFO_LIST:"onBuildBlockInfoList",ON_BUILD_BLOCK_INFO_LIST_END:"onBuildBlockInfoListEnd",ON_BLOCK_PROPERTY_CHANGED:"onBlockPropertyChanged",ON_SCOPE_CREATED:"onScopeCreated",
ON_VARIABLE_CHANGED:"onVariableChanged",ON_CREATE_VARIABLE_CI:"onCreateVariableCI"});k.BlockType={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",
ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",
SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"};return k})},"xblox/model/functions/StopBlock":function(){define(["dcl/dcl","xide/utils","xide/types","dojo/Deferred","xblox/model/Block"],
function(k,p,m,g,c){return k(c,{declaredClass:"xblox.model.functions.StopBlock",command:"Select command please",icon:"",args:null,_timeout:100,solve:function(c,b){if(this.command){var a=c.resolveBlock(this.command);if(a&&a.stop){var f=a.stop();this.onSuccess(this,b)}else this.onFailed(this,b);return f}},hasInlineEdits:!0,makeEditable:function(c,b,a,f,g,k,d){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+b+"' display-mode\x3d'"+(g||"popup")+"' display-type\x3d'"+(a||"text")+"' data-prop\x3d'"+c+"' data-title\x3d'"+
f+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[c]+"\x3c/a\x3e"},getFieldOptions:function(c){if("command"===c)return this.scope.getCommandsAsOptions("text")},toText:function(){var c="Unknown",b=this.scope.getBlock(this.command);b&&(c=b.name);-1!==this.command.indexOf("://")&&(c='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Stop Command : "+c},onChangeField:function(c,b){},getFields:function(){var c=this.inherited(arguments)||
this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);c.push(p.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));return c}})})},"xblox/model/functions/PauseBlock":function(){define(["dcl/dcl","xide/utils","xide/types","dojo/Deferred","xblox/model/Block"],function(k,p,m,g,c){return k(c,{declaredClass:"xblox.model.functions.PauseBlock",
command:"Select command please",icon:"",args:null,_timeout:100,solve:function(c,b){if(this.command){var a=c.resolveBlock(this.command);if(a&&a.pause){var f=a.pause();this.onSuccess(this,b)}else this.onFailed(this,b);return f}},hasInlineEdits:!0,makeEditable:function(c,b,a,f,g,k,d){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+b+"' display-mode\x3d'"+(g||"popup")+"' display-type\x3d'"+(a||"text")+"' data-prop\x3d'"+c+"' data-title\x3d'"+f+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[c]+
"\x3c/a\x3e"},getFieldOptions:function(c){if("command"===c)return this.scope.getCommandsAsOptions("text")},toText:function(){var c="Unknown",b=this.scope.getBlock(this.command);b&&(c=b.name);-1!==this.command.indexOf("://")&&(c='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Pause Command : "+c},onChangeField:function(c,b){},getFields:function(){var c=this.inherited(arguments)||this.getDefaultFields();this.command.indexOf("://")&&
this.scope.toFriendlyName(this,this.command);c.push(p.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));return c}})})},"xblox/model/functions/SetProperties":function(){define(["dcl/dcl","xide/utils","xide/types","dojo/Deferred","xblox/model/Block"],function(k,p,m,g,c){return k(c,{declaredClass:"xblox.model.functions.SetProperties",command:"Select block",
icon:"",args:null,_timeout:100,solve:function(c,b){var a=new g;if(this.command){var f=c.resolveBlock(this.command);if(f&&this.props){for(var k in this.props)f.set(k,this.props[k]),f[k]=this.props[k],f.onChangeField&&f.onChangeField(k,this.props[k]);this.onSuccess(this,b)}else this.onFailed(this,b);a.resolve([])}return a},hasInlineEdits:!1,makeEditable:function(c,b,a,f,g,k,d){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+b+"' display-mode\x3d'"+(g||"popup")+"' display-type\x3d'"+(a||"text")+"' data-prop\x3d'"+
c+"' data-title\x3d'"+f+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[c]+"\x3c/a\x3e"},getFieldOptions:function(c){if("command"===c)return this.scope.getCommandsAsOptions("text")},toText:function(){var c="Unknown",b=this.scope.getBlock(this.command);b&&(c=b.name);-1!==this.command.indexOf("://")&&(c='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Set Properties : "+c},serializeObject:function(c){return"props"===
c?!0:!1},onChangeField:function(c,b,a){"command"===c&&(delete this.props,this.props={})},init:function(){this.props&&_.isString(this.props)&&(this.props=p.fromJson(this.props))},getFields:function(){var c=this.inherited(arguments)||this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);c.push(p.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",
value:this.command}));var b=this.scope.resolveBlock(this.command);if(b&&b.getFields){this.props||(this.props={});var b=b.getFields(),a=_.find(b,{dst:"description"});b.remove(a);_.each(b,function(a){a.group="Properties";a.value=p.getAt(this.props,a.dst,a.value);a.dst="props."+a.dst},this);c=c.concat(b)}return c}})})},"xblox/model/code/CallMethod":function(){define(["dcl/dcl","xblox/model/Block","xide/utils"],function(k,p,m){return k(p,{declaredClass:"xblox.model.code.CallMethod",name:"Call Method",
method:"",args:"",sharable:!0,solve:function(g,c){var e=this.getContext();if(e&&null!=e[this.method]){var b=[],a=e[this.method];try{var f=this.getArgs(c);console.log("args",f);b=a.apply(e,f||[]);this.onSuccess(this,c);return b}catch(k){console.error("call method "+this.method+" failed: "+k),logError(k),this.onFailed(this,c)}}else this.onFailed(this,c);return[]},toText:function(){var g=this.getBlockIcon()+" "+this.name+" ";this.method&&(g+=this.makeEditable("method","bottom","text","Enter a driver method",
"inline"));return g},getFields:function(){var g=this.getDefaultFields();this.getContext();g.push(m.createCI("value",13,this.method,{group:"General",title:"Method",dst:"method"}));g.push(m.createCI("value",27,this.args,{group:"Arguments",dst:"args",widget:{title:""}}));return g},getBlockIcon:function(){return'\x3cspan class\x3d"fa-caret-square-o-right"\x3e\x3c/span\x3e'}})})},"xblox/model/code/RunScript":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains dojo/promise/all xide/types module".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d,l){var r="undefined"!==typeof window?window.console:global.console;n&&r&&r.error&&(r=q);return k([g,e],{declaredClass:"xblox.model.code.RunScript",name:"Run Script",method:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-code",observed:["method"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve2:function(a,b,c,d){this._currentIndex=0;this._return=[];var e=""+this._get("method"),f=this,g=this.getContext();
if(e&&e.length){var l=function(){var a=new Function("{"+e+"}"),h=f.getArgs()||[];try{var l=a.apply(g,h||{});f._lastResult=l;c&&c("Expression "+e+" evaluates to "+l);if("false"!==l&&!1!==l)f.onSuccess(f,b,{result:l});else return f.onFailed(f,b),[]}catch(k){return d&&d("invalid expression : \n"+e+": "+k),f.onFailed(f,b),[]}};if(a.global)(function(){window=a.global;var l=f.getArgs()||[];try{var k=null,k=g.runExpression?g.runExpression(e,null,l):(new Function("{"+e+"}")).bind(this).apply(g,l||{});f._lastResult=
k;c&&c("Expression "+e+" evaluates to "+k);if("false"!==k&&!1!==k)f.onSuccess(f,b);else return f.onFailed(f,b),[]}catch(n){return f._lastResult=null,d&&d("invalid expression : \n"+e+": "+n),f.onFailed(f,b),[]}}).call(a.global);else return l()}else r.error("have no script");l=this[this._getContainer()];if(l.length)this.runFrom(l,0,b);else this.onSuccess(this,b);this.onDidRun();return[]},solve:function(a,b,c,d,e,f){this._currentIndex=0;this._return=[];b=b||{};c=d||(this._get("method")?this._get("method"):
this.method);var g=this;d=this.getContext();var l=this[this._getContainer()],k=new m,n=g.deferred;this.onRunThis(b);var p=a.expressionModel.replaceVariables(a,c,null,null),q=a.expressionModel.expressionCache[p];q||(q=a.expressionModel.expressionCache[p]=new Function("{"+p+"}"));a=g.getArgs(b)||[];try{n&&(d.resolve=function(a){g._deferredObject&&g._deferredObject.resolve();g.onDidRunThis(k,a,l,b)});var r=q.apply(d,a||{});g._lastResult=r;e&&e("Expression "+c+" evaluates to "+r);if(!n)g.onDidRunThis(k,
r,l,b);if("false"!==r&&!1!==r)g.onSuccess(g,b);else g.onFailed(g,b)}catch(w){w=w||{},g.onDidRunItemError(k,w,b),g.onFailed(g,b),f&&f("invalid expression : \n"+c+": "+w)}return k},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.name+" :: \x3c/span\x3e";this.method&&(a+=this.method.substr(0,50));return a},canAdd:function(){return[]},getFields:function(){"No Description"===this.description&&(this.description=d);var b=this.inherited(arguments)||this.getDefaultFields(),
e=this;b.push(c.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));b.push(c.createCI("deferred",0,this.deferred,{group:"General",title:"Deferred",dst:"deferred"}));b.push(c.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));b.push(c.createCI("value",a.ECIType.EXPRESSION_EDITOR,this.method,{group:"Script",title:"Script",dst:"method",select:!0,widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!0,autoFocus:!1},
item:this},delegate:{runExpression:function(a,b,c){e.method=a;e.solve(e.scope,null,b,c)}}}));return b}})})},"xblox/model/loops/ForBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/variables/Variable xblox/model/Contains dojo/promise/all dojo/Deferred".split(" "),function(k,p,m,g,c,e){return k([p,g],{declaredClass:"xblox.model.loops.ForBlock",initial:null,"final":null,comparator:null,modifier:null,items:null,counterName:null,_counter:null,name:"For",sharable:!0,icon:"",ignoreErrors:!1,
deferred:!0,_forState:!1,_currentForIndex:0,runFrom:function(b,a,c){var g=this,k=b||this.items;b=[];var d=function(a){a._deferredObject.then(function(b){console.log("----def block finish");a._lastResult=a._lastResult||b;g._currentIndex++;g.runFrom(k,g._currentIndex,c)})};if(k.length)for(;a<k.length;a++){var l=k[a];if(!1!==l.enabled)if(!0===l.deferred){l._deferredObject=new e;this._currentIndex=a;d(l);l=l.solve(this.scope,c);b.push(l);break}else l=l.solve(this.scope,c),b.push(l)}else this.onSuccess(this,
c);return b},runFromDirect:function(b,a,c){var g=this,k=b||this.items;b=[];var d=function(a){a._deferredObject.then(function(b){a._lastResult=a._lastResult||b;g._currentIndex++;g.runFrom(k,g._currentIndex,c)})};if(k.length)for(;a<k.length;a++){var l=k[a];if(!1!==l.enabled)if(!0===l.deferred){l._deferredObject=new e;this._currentIndex=a;d(l);l=l.solve(this.scope,c);b.push(l);break}else l=l.solve(this.scope,c),b.push(l)}else this.onSuccess(this,c);return b},solveSubs:function(b,a,e,g){var k=this;g.override=
g.override||{};g.override.args=[this._currentForIndex];if(e.length)return a=k.runFrom(e,0,g),c(a).then(function(a){},function(a){console.error("error in chain",a);k.onDidRunItem(b,a,g)}),a;k.onDidRunItem(b,a,g)},solveSubsDirect:function(b,a,c,e){e.override=e.override||{};e.override.args=[this._currentForIndex];if(c.length)return this.runFromDirect(c,0,e)},_solve:function(b,a){var f=new e,g=this,k=this.solveSubs(f,null,this.items,a);k?c(k).then(function(a){a=a.indexOf(!1);!0!==g.ignoreErrors&&-1!==
a?f.resolve(!1):f.resolve(!0)}):f.resolve(!0);return f},step:function(b,a){var c=this._checkCondition(b,a),g=new e;c&&this._solve(b,a).then(function(a){1==a?g.resolve(!0):g.resolve(!1)});return g},loop:function(b,a){var c=this;this.step(b,a).then(function(e){c._updateCounter(b);c._currentForIndex=c._counter.value;if(1==e)c.loop(b,a);else c.onFailed(c,a)})},_solveDirect:function(b,a){return this.solveSubsDirect(null,null,this.items,a)},stepDirect:function(b,a){return this._solveDirect(b,a)},loopDirect:function(b,
a){this.stepDirect(b,a);for(var c=parseInt(this.initial);c<parseInt(this["final"]);c++)this.stepDirect(b,a)},solve:function(b,a){this._counter=new m({title:this.counterName,value:this.initial,scope:b,register:!1});this._forState=!0;this._currentForIndex=this.initial;this.deferred?this.loop(b,a):this.loopDirect(b,a);return[]},_checkCondition:function(b,a){var c=b.parseExpression(""+this._counter.value+this.comparator+this["final"]);if(0!=c)this.onSuccess(this,a);return this._forState=c},_updateCounter:function(b){var a=
this._counter.value,a=b.parseExpression(""+a+this.modifier);if(a==this._counter.value)return!1;this._counter.value=a;return!0},mayHaveChildren:function(b){return null!=this.items&&0<this.items.length},getChildren:function(b){b=[];this.items&&(b=b.concat(this.items));return b},canAdd:function(){return[]},toText:function(){return this.getBlockIcon("F")+this.name+" "+this.initial+" "+this.comparator+" "+this["final"]+" with "+this.modifier},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();
return b=b.concat([this.utils.createCI("initial",13,this.initial,{group:"General",title:"Initial",dst:"initial"}),this.utils.createCI("Final",13,this["final"],{group:"General",title:"Final",dst:"final"}),this.utils.createCI("comparator",13,this.comparator,{group:"General",title:"Comparision",dst:"comparator"}),this.utils.createCI("modifier",13,this.modifier,{group:"General",title:"Modifier",dst:"modifier"}),this.utils.createCI("Abort on Error",0,this.ignoreErrors,{group:"General",title:"Ignore Errors",
dst:"ignoreErrors"}),this.utils.createCI("Deferred",0,this.deferred,{group:"General",title:"Use Deferred",dst:"deferred"})])}})})},"xblox/model/loops/WhileBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/variables/Variable"],function(k,p,m){return k(p,{declaredClass:"xblox.model.loops.WhileBlock",condition:null,items:null,loopLimit:1500,name:"While",wait:0,_currentIndex:0,sharable:!0,icon:"",_timer:null,canAdd:function(){return[]},_solve:function(g,c){for(var e=0;e<this.items.length;e++)this.items[e].solve(g,
c);return[]},doStep:function(g){if(this._currentIndex<this.loopLimit){var c=[];this._checkCondition(this.scope)?(this.onSuccess(this,g),this.addToEnd(c,this._solve(this.scope,g)),this._currentIndex++):(this._timer&&clearInterval(this._timer),this.onFailed(this,g))}else console.error("--while block : reached loop limit"),this.reset()},reset:function(){this._timer&&(clearTimeout(this._timer),this._timer=null);this._currentIndex=0},solve:function(g,c){this.loopLimit=1500;c=c||{};var e=0,b=this,a=this._getArg(this.wait);
this.reset();if(0<a)return this._timer=setInterval(function(){b.doStep(c)},a),[];for(;this._checkCondition(g)&&e<this.loopLimit;)this._solve(g,c),e++;this.reset();return[]},toText:function(){return this.getBlockIcon("G")+this.name+" "+this.condition},_checkCondition:function(g){return g.parseExpression(this.condition)},mayHaveChildren:function(g){return null!=this.items&&0<this.items.length},getChildren:function(g){g=[];this.items&&(g=g.concat(this.items));return g},getFields:function(){var g=this,
c=this.inherited(arguments)||this.getDefaultFields();c.push(this.utils.createCI("condition",25,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(c,b,a){return g.scope.expressionModel.parse(g.scope,c,!1,b,a)}}}));c.push(this.utils.createCI("wait",13,this.wait,{group:"General",title:"Wait",dst:"wait"}));return c}})})},"xblox/model/variables/VariableAssignmentBlock":function(){define("dcl/dcl xblox/model/Block xide/utils xide/types dstore/legacy/DstoreAdapter xide/factory xdojo/has".split(" "),
function(k,p,m,g,c,e,b){return k(p,{declaredClass:"xblox.model.variables.VariableAssignmentBlock",variable:null,value:null,name:"Set Variable",icon:"",hasInlineEdits:!0,flags:4,toText:function(){var a=this.scope.getVariableById(this.variable),a=a?a.name:"";this.variable&&-1!==this.variable.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.variable)+"\x3c/span\x3e");return this.getBlockIcon("C")+this.name+" "+a+"\x3cspan class\x3d'text-muted small'\x3e to \x3ckbd class\x3d'text-warning'\x3e"+
this.makeEditable("value","bottom","text","Enter the string to send","inline")+"\x3c/kbd\x3e\x3c/span\x3e"},_getPreviousResult:function(){var a=null;return(a=(a=this.getPreviousBlock())&&a._lastResult&&a.enabled?a:this.getParent())&&null!=a._lastResult?(this.isArray(a._lastResult),a._lastResult):null},solve:function(a,b){var c=this.value,k=!1;if(!c){var d=this.getArgs();0<d.length&&(c=d[0])}if(this.variable&&null!==c){this.onRun(this,b);var l=-1!==this.variable.indexOf("://")?this.scope.resolveBlock(this.variable):
a.getVariableById(this.variable),d=this._getArg(c),m=this.getArgs(b)||[];if(!l)return[];var h=null;this.isScript(d)?(h=this.override||{},h=a.parseExpression(c,null,null,null,null,null,m||h.args),h=this.replaceAll("'","",h),l.value!==h&&(k=!0)):(m&&1==m.length&&(d=m[0]),l.value!==d&&(k=!0),h=l.value=d);l.set("value",h);c=!1;(m=this.getContext())&&(m=m.device)&&m.info&&m.info.serverSide&&(c=this.flags&g.VARIABLE_FLAGS.PUBLISH_IF_SERVER?!0:!1);this.flags&g.VARIABLE_FLAGS.PUBLISH&&k&&(c=!0);k&&e.publish(g.EVENTS.ON_DRIVER_VARIABLE_CHANGED,
{item:l,scope:this.scope,save:!1,block:this,name:l.name,value:d,publish:c,result:h});this.onSuccess(this,b);return[]}},canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(!1),b=this;a.push(this.utils.createCI("value",29,this.value,{group:"General",title:"Value",dst:"value",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!1,autoSelect:!1,autoFocus:!1,hasConsole:!1,hasItemActions:function(){return!1}},item:this},
delegate:{runExpression:function(a,c,d){return b.scope.expressionModel.parse(b.scope,a,!1,c,d)}}}));a.push(m.createCI("value","xcf.widgets.CommandPicker",this.variable,{group:"Variable",title:"Variable",dst:"variable",block:this,pickerType:"variable",value:this.variable,widget:{store:this.scope.blockStore,labelField:"name",valueField:"id",value:this.variable,query:[{group:"basicVariables"},{group:"processVariables"}]}}));a.push(this.utils.createCI("flags",5,this.flags,{group:"Variable",title:"Flags",
dst:"flags",data:[{value:2,label:"Publish to network",title:"Publish to network in order to make a network variable"},{value:4,label:"Publish if server",title:"Publish only on network if this is running server side"}],widget:{hex:!0}}));return a}})})},"dstore/legacy/DstoreAdapter":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/store/util/QueryResults"],function(k,p,m){function g(c){return c}var c={store:null,constructor:function(c){this.store=c;if(c._getQuerierFactory("filter")||
c._getQuerierFactory("sort"))this.queryEngine=function(a,b){b=b||{};var k=c._getQuerierFactory("filter"),m=k?k(a):g,k=c._getQuerierFactory("sort"),d=g;k&&(d=k(p.map(b.sort,function(a){return{property:a.attribute,descending:a.descending}})));var l=g;isNaN(b.start)&&isNaN(b.count)||(l=function(a){var c=b.start||0,c=a.slice(c,c+(b.count||Infinity));c.total=a.length;return c});return function(a){return l(d(m(a)))}};var b=this;c.on("add,update,delete",function(a){var f=a.type,g=a.target;b.notify("add"===
f||"update"===f?g:void 0,"delete"===f||"update"===f?"id"in a?a.id:c.getIdentity(g):void 0)})},labelAttr:"title",getLabel:function(c){return this.store.getLabel(c)},query:function(c,b){b=b||{};var a=this.store.filter(c),f,g,k;if(k=b.sort)if("[object Array]"===Object.prototype.toString.call(k))for(var d;d=k.pop();)a=a.sort(d.attribute,d.descending);else a=a.sort(k);a.track&&!a.tracking&&(a=a.track(),g=!0);"start"in b&&(f=b.start||0,f=a[a.fetchRangeSync?"fetchRangeSync":"fetchRange"]({start:f,end:b.count?
f+b.count:Infinity}));f=f||a[a.fetchSync?"fetchSync":"fetch"]();k=f.totalLength;f=new m(f);f.total=k;f.observe=function(b,c){function d(a){return void 0===a&&g?-1:a}var e=a.on("add",function(a){b(a.target,-1,d(a.index))}),f=a.on("update",function(a){!c&&a.previousIndex===a.index&&isFinite(a.index)||b(a.target,d(a.previousIndex),d(a.index))}),k=a.on("delete",function(a){b(a.target,d(a.previousIndex),-1)}),m={remove:function(){e.remove();f.remove();k.remove()}};m.cancel=m.remove;return m};return f},
notify:function(){}};p.forEach(["get","put","add","remove","getIdentity"],function(e){c[e]=function(){var b=this.store;return(b[e+"Sync"]||b[e]).apply(b,arguments)}});return k(null,c)})},"xblox/model/logic/IfBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/Statement xblox/model/logic/ElseIfBlock dojo/Deferred xide/utils".split(" "),function(k,p,m,g,c,e){return k(p,{declaredClass:"xblox.model.logic.IfBlock",condition:"Invalid Expression",consequent:null,elseIfBlocks:null,alternate:null,
canAdd:function(){return[]},autoCreateElse:!0,name:"if",icon:"",add:function(b,a,c){null==c&&(c="consequent");return this._add(b,a,c,!1)},__addToStore:function(b){b.put(this)},mayHaveChildren:function(b){return null!==this.items&&this.items.length||null!==this.elseIfBlocks&&this.elseIfBlocks.length||null!=this.consequent&&this.consequent.length||null!=this.alternate&&this.alternate.length},getChildren:function(b){b=[];this.consequent&&(b=b.concat(this.consequent));this.elseIfBlocks&&(b=b.concat(this.elseIfBlocks));
this.alternate&&(b=b.concat(this.alternate));return b},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon("E")+this.name+" \x3c/span\x3e\x3cspan class\x3d'text-warning small'\x3e"+this.condition+"\x3cspan\x3e"},_checkCondition:function(b){return b.parseExpression(this.condition,null,null)},solve:function(b,a){var c=this._checkCondition(b),e=this.getElseIfBlocks(),k=this.childrenByNotClass(g),d=null,k=k.filter(function(a){return!a.isInstanceOf(m)});if(1==c||0<c){this.onSuccess(this,
a);if(k&&k.length)for(e=0;e<k.length;e++)d=k[e].solve(b,a);return d}d=!1;this.onFailed(this,a);if(e)for(k=0;k<e.length&&!d;k++){c=e[k];if(c._checkCondition(b))return c.onSuccess(c,a),d=!0,c.solve(b,a);c.onFailed(c,a)}k=this.childrenByClass(m);if(0<k.length&&!d){d=null;for(e=0;e<k.length;e++)d=k[e].solve(b,a);return d}return[]},empty:function(b){this._empty(this.alternate);this._empty(this.consequent);this._empty(this.elseIfBlocks)},removeBlock:function(b){b&&(b&&b.empty&&b.empty(),delete b.items,
b.parent=null,this.alternate.remove(b),this.consequent.remove(b),this.elseIfBlocks.remove(b))},_getContainer:function(b){return-1!=this.consequent.indexOf(b)?"consequent":-1!=this.alternate.indexOf(b)?"alternate":-1!=this.elseIfBlocks.indexOf(b)?"elseIfBlocks":"_"},init:function(){this.alternate=this.alternate||[];this.consequent=this.consequent||[];this.elseIfBlocks=this.elseIfBlocks||[];for(var b=0;b<this.alternate.length;b++)this.alternate[b].parentId=this.id,this.alternate[b].parent=this;for(b=
0;b<this.elseIfBlocks.length;b++)this.elseIfBlocks[b].parentId=this.id,this.elseIfBlocks[b].parent=this;for(b=0;b<this.consequent.length;b++)this.consequent[b].parentId=this.id,this.consequent[b].parent=this},getFields:function(){var b=this,a=this.inherited(arguments)||this.getDefaultFields();a.push(this.utils.createCI("condition",this.types.ECIType.EXPRESSION_EDITOR,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(a,c,e){return b.scope.expressionModel.parse(b.scope,
a,!1,c,e)}}}));return a},postCreate:function(){this._postCreated||(this._postCreated=!0)},toCode:function(b,a){},getElseIfBlocks:function(){return this.childrenByClass(g)},runAction:function(b){var a=this.scope.blockStore;b=b.command;if("New/Else"===b||"New/Else If"===b){b="New/Else If"===b?g:m;var f=e.mixin({name:"else",items:[],dstField:"alternate",parentId:this.id,parent:this,scope:this.scope,canAdd:function(){return[]},canEdit:function(){return!1}},b==g?{name:"else if",dstField:"elseIfBlocks"}:
{name:"else",dstField:"alternate"});b=this.add(b,f,b==m?"alternate":"elseIfBlocks");var f={select:[b],focus:!0,append:!1,expand:!0,delay:10},k=new c;a._emit("added",{target:b});k.resolve(f);b.refresh();return k}},getActions:function(){var b=[];0==this.alternate.length&&b.push(this.createAction({label:"Else",command:"New/Else",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0}}));b.push(this.createAction({label:"Else If",command:"New/Else If",icon:this.getBlockIcon("I"),
tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0}}));return b}})})},"xblox/model/Statement":function(){define(["dcl/dcl","xblox/model/Block"],function(k,p){return k(p,{declaredClass:"xblox.model.Statement",toText:function(){return this.name},getChildren:function(){return this.items}})})},"xblox/model/logic/ElseIfBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/Contains"],function(k,p,m){return k([p,m],{declaredClass:"xblox.model.logic.ElseIfBlock",condition:"",consequent:null,
name:"else if",icon:"",solve:function(g,c){return this._checkCondition(g)?this._solve(g,c):!1},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon("E")+this.name+" \x3c/span\x3e\x3cspan class\x3d'text-warning small'\x3e"+(this.condition||"")+"\x3cspan\x3e"},_checkCondition:function(g){return null!==this.condition?g.parseExpression(this.condition):!1},getFields:function(){var g=this,c=this.inherited(arguments)||this.getDefaultFields();c.push(this.utils.createCI("condition",
this.types.ECIType.EXPRESSION_EDITOR,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(c,b,a){return g.scope.expressionModel.parse(g.scope,c,!1,b,a)}}}));return c}})})},"xblox/model/logic/SwitchBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/logic/CaseBlock","xblox/model/logic/DefaultBlock","dojo/Deferred"],function(k,p,m,g,c){return k(p,{declaredClass:"xblox.model.logic.SwitchBlock",items:null,name:"Switch",icon:null,toText:function(){return this.getBlockIcon("H")+
this.name+" "},canAdd:function(){return[]},getFields:function(){return this.getDefaultFields(!1,!1)},solve:function(c,b){var a=this._stopped=!1,f=[];this.onSuccess(this,b);for(var g=0;g<this.items.length;g++){var k=this.items[g];if("xblox.model.logic.CaseBlock"===k.declaredClass&&(k=k.solve(c,this,b),0!=k)){a=!0;this.addToEnd(f,k);break}if(this._stopped)break}if(!a)for(g=0;g<this.items.length;g++)k=this.items[g],"xblox.model.logic.CaseBlock"!=k.declaredClass&&this.addToEnd(f,k.solve(c,b));return f},
init:function(){},getChildren:function(c){return this.items},stop:function(){this._stopped=!0},runAction:function(e){var b=e.command;if("New/Case"===b||"New/Default"===e.command){e=this.scope.blockStore;var a=new c,f=null;switch(b){case "New/Case":f=this.add(m,{comparator:"\x3d\x3d",expression:"on",group:null});break;case "New/Default":f=this.add(g,{group:null})}a.resolve({select:[f],focus:!0,append:!1});f.refresh();e._emit("added",{target:f})}},getActions:function(c,b){var a=[this.createAction({label:"New Case",
command:"New/Case",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}})];_.find(this.items,{declaredClass:"xblox.model.logic.DefaultBlock"})||a.push(this.createAction({label:"Default",command:"New/Default",icon:"fa-eject",tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}}));return a}})})},"xblox/model/logic/DefaultBlock":function(){define(["dcl/dcl","xide/utils","xide/types","xblox/model/Block"],function(k,p,m,g){return k(g,{declaredClass:"xblox.model.logic.DefaultBlock",
name:"Default",icon:"",hasInlineEdits:!1,toText:function(){return'\x26nbsp;\x3cspan class\x3d"fa-eject text-info"\x3e\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan\x3e'+this.name+"\x3c/span\x3e"},solve:function(c,e){this.onSuccess(this,e);return this._solve(c,e)},getFields:function(){return this.inherited(arguments)||this.getDefaultFields()}})})},"xblox/model/variables/VariableSwitch":function(){define("dcl/dcl xblox/model/logic/SwitchBlock xide/types xblox/model/logic/CaseBlock xblox/model/logic/DefaultBlock dojo/Deferred".split(" "),
function(k,p,m,g,c,e){return k(p,{declaredClass:"xblox.model.variables.VariableSwitch",name:"Switch on Variable",icon:"",variable:"PowerState",toText:function(){var b=this.scope.getVariableById(this.variable),b=b?b.name:"";return this.getBlockIcon("H")+this.name+" "+b},getFields:function(){var b=this.getDefaultFields(!1,!1);return b=b.concat([this.utils.createCI("Variable",3,this.variable,{group:"General",widget:{store:this.scope.blockStore,labelField:"name",valueField:"id",query:[{group:"basicVariables"},
{group:"processVariables"}]},dst:"variable"})])}})})},"xblox/model/logging/Log":function(){define("dcl/dcl dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin".split(" "),function(k,p,m,g,c,e){return k([m,e.dcl],{declaredClass:"xblox.model.logging.Log",name:"Log Message",level:"info",message:'return "Message: " + arguments[0];',_type:"XBlox",host:"this host",sharable:!0,toText:function(){var b="text-primary";switch(this.level){case "info":b="text-info";break;case "warn":b=
"text-warning";break;case "error":b="text-danger"}b=this.getBlockIcon()+" "+this.name+" : \x3cspan class\x3d'"+b+" small'\x3e  :: ";this.message&&(b+=this.message);return b+"\x3c/span\x3e"},_solveExpression:function(b,a,c,e,k){if((b=""+b)&&b.length){b=g.convertAllEscapes(b,"none");var d=this.getArgs();try{var l=a.parseExpression(b,null,null,null,null,this,d);e&&e("Expression "+b+" evaluates to "+l);return l}catch(m){k&&k("invalid expression : \n"+b+": "+m),this.onFailed(this,c)}}else console.error("have no script");
return b},solve:function(b,a,e,g){console.log("-log");var k=new p,d=b.device;b=this._solveExpression(this.message,b,a,e,g);d={message:b,level:this.level,type:this._type,details:this.getArgs(),time:(new Date).getTime(),data:{device:d?d.info:null},write:!0};this.onSuccess(this,a);k.resolve(b);try{this.publish(c.EVENTS.ON_SERVER_LOG_MESSAGE,d)}catch(l){this.onFailed(this,a)}return k},canAdd:function(){return null},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields(),a=this;b.push(g.createCI("Level",
3,this.level,{group:"General",options:[{value:"info",label:"Info"},{value:"warn",label:"Warning"},{value:"error",label:"Error"},{value:"debug",label:"Debug"},{value:"help",label:"Help"},{value:"verbose",label:"verbose"},{value:"silly",label:"Silly"}],dst:"level"}));b.push(g.createCI("message",25,this.message,{group:"General",title:"Message",dst:"message",delegate:{runExpression:function(b,c,e){a._solveExpression(b,a.scope,null,c,e)}}}));b.push(g.createCI("message",13,this._type,{group:"General",title:"Type",
dst:"_type"}));return b},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bug"\x3e\x3c/span\x3e'}})})},"xblox/model/server/RunServerMethod":function(){define(["dcl/dcl","xblox/model/server/ServerBlock","xide/utils"],function(k,p,m){return k(p,{declaredClass:"xblox.model.server.RunServerMethod",description:"Runs a JSON-RPC-2.0 method on the server",name:"Run Server Method",method:"XShell::run",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onMethodChanged:function(g,
c){this.method=g;if(!m.isValidString(this.args)){var e=this.getServerParams();e&&this._updateArgs(e,c)}},_getArgs:function(){var g=m.getJson(this.args||"[]"),c=[];if(g){var e=!1;g&&g[0]&&null!=g[0].optional&&(e=!0);if(e)for(e=0;e<g.length;e++){var b=g[e],a=b.value;-1!=b.name.indexOf("Base64")&&(a=this.getService().base64_encode(a));"notset"!==b.value?-1!=b.value.indexOf("[")&&-1!=b.value.indexOf("]")?(a=this.scope.expressionModel.replaceVariables(this.scope,b.value,!1,!1),-1!=b.name.indexOf("Base64")&&
(a=this.getService().base64_encode(a)),c.push(a)):c.push(a||b["default"]):c.push(b["default"]||a)}}else return[this.args];return c},_updateArgs:function(g,c){var e=this.utils.getCIWidgetByName(c,"args");if(e){var b=JSON.stringify(g);e.editBox.set("value",b);this.args=b}},getServerParams:function(){var g=this.getService().getParameterMap(this.getServiceClass(),this.getServiceMethod());if(g)for(var c=0;c<g.length;c++)g[c].value="notset";return g},onReloaded:function(g){console.log("sdfsd");this._solve()},
_solve:function(g,c,e,b){console.log("solve223")},solve:function(g,c,e,b){this._return=[];this._lastResult=null;g=[];if(!this.isInValidState())return this.onFailed(this,c),g;g=this._getArgs();this.onRun(this,c);this.getService();c=this.scope.serviceObject;console.error("run deferred");(c=c.runDeferred(this.getServiceClass(),this.getServiceMethod(),g))&&c.then(function(a){console.error("returned ",a)});return c},toText:function(){var g=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(g+=this.method.substr(0,
50));return g},canAdd:function(){return[]},getFields:function(){var g=this.inherited(arguments)||this.getDefaultFields(),c=this;g.push(m.createCI("value",25,this.method,{group:"General",title:"Method",dst:"method",description:"This should be in the format : MyServerClass::myMethod",delegate:{runExpression:function(e,b,a){c.method=e;c.solve(c.scope,null,b,a)}}}));return g=g.concat(this.getServerDefaultFields())},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(g){return null!=
this.items&&0<this.items.length},getChildren:function(g){return this.items},onChangeField:function(g,c,e){if("method"===g)this.onMethodChanged(c,e)},isInValidState:function(){return null!=this.getService()},getService:function(){var g=this.scope.getService();g||console.error("have no service object");return g},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(g){return this.isInValidState()&&
null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(g){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/server/ServerBlock":function(){define(["dcl/dcl","xblox/model/Block","xide/utils"],
function(k,p,m){return k(p,{declaredClass:"xblox.model.server.ServerBlock",name:"Run Server Block",method:"XShell::run",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onReloaded:function(){console.log("1")},solve:function(g,c,e,b){this._currentIndex=0;this._return=[];if((g=""+this.method)&&g.length){var a=new Function("{"+g+"}"),f=this.getArgs();try{var k=a.apply(this,f||{});this._lastResult=k;e&&e("Expression "+g+" evaluates to "+k);if("false"!==k&&!1!==k)this.onSuccess(this,
c);else return this.onFailed(this,c),[]}catch(m){return b&&b("invalid expression : \n"+g+": "+m),this.onFailed(this,c),[]}}else console.error("have no script");e=this[this._getContainer()];if(e.length)this.runFrom(e,0,c);else this.onSuccess(this,c);return[]},toText:function(){var g=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(g+=this.method.substr(0,50));return g},canAdd:function(){return[]},getServerDefaultFields:function(g){g=g||[];g.push(m.createCI("args",27,this.args,{group:"General",
title:"Arguments",dst:"args"}));return g},getFields:function(){return this.inherited(arguments)||this.getDefaultFields()},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(g){return null!=this.items&&0<this.items.length},getChildren:function(g){return this.items},isInValidState:function(){return null!=this.getService()},getService:function(){return this.scope.getService()},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},
getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(g){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(g){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:
null}})})},"xblox/model/server/Shell":function(){define(["dcl/dcl","xblox/model/server/ServerBlock","xide/utils","xcf/model/Command"],function(k,p,m,g){return k([g,p],{declaredClass:"xblox.model.server.Shell",description:"Runs a JSON-RPC-2.0 method on the server",name:"Run Shell",method:"",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onMethodChanged:function(c,e){this.method=c;if(!m.isValidString(this.args)){var b=this.getServerParams();b&&this._updateArgs(b,
e)}},_getArgs:function(){var c=m.getJson(this.args||"[]"),e=[];if(c){var b=!1;c&&c[0]&&null!=c[0].optional&&(b=!0);if(b)for(b=0;b<c.length;b++){var a=c[b],f=a.value;-1!=a.name.indexOf("Base64")&&(f=this.getService().base64_encode(f));"notset"!==a.value?-1!=a.value.indexOf("[")&&-1!=a.value.indexOf("]")?(f=this.scope.expressionModel.replaceVariables(this.scope,a.value,!1,!1),-1!=a.name.indexOf("Base64")&&(f=this.getService().base64_encode(f)),e.push(f)):e.push(f||a["default"]):e.push(a["default"]||
f)}}else return[this.args];return e},_updateArgs:function(c,e){var b=this.utils.getCIWidgetByName(e,"args");if(b){var a=JSON.stringify(c);b.editBox.set("value",a);this.args=a}},getServerParams:function(){var c=this.getService().getParameterMap(this.getServiceClass(),this.getServiceMethod());if(c)for(var e=0;e<c.length;e++)c[e].value="notset";return c},onReloaded:function(c){console.log("sdfsd");this._solve()},_solve:function(c,e,b,a){console.log("solve223")},solve:function(c,e,b,a,f,g){this._return=
[];this._lastResult=null;this._lastSettings=e||this._lastSettings;e=this.getInstance();console.log("run");c=c.expressionModel.replaceVariables(c,this.method,!1,!1);e.runShell(c,m.mixin({},{}),this.id,this.id,this)},toText:function(){var c=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(c+=this.method.substr(0,50));return c},canAdd:function(){return[]},getFields:function(){var c=this.inherited(arguments)||this.getDefaultFields(),e=this;c.push(m.createCI("value",25,this.method,{group:"General",
title:"Cmd",dst:"method",delegate:{runExpression:function(b,a,c){e.method=b;e.solve(e.scope,null,a,c)}}}));return c},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(c){return null!=this.items&&0<this.items.length},getChildren:function(c){return this.items},onChangeField:function(c,e,b){if("method"===c)this.onMethodChanged(e,b)},isInValidState:function(){return null!=this.getService()},getService:function(){var c=this.scope.getService();c||console.error("have no service object");
return c},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(c){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(c){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&
this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/code/RunBlock":function(){define(["dcl/dcl","xblox/model/Block","xide/types","xide/utils"],function(k,p,m,g){return k(p,{declaredClass:"xblox.model.code.RunBlock",name:"Run Block",file:"",method:"",args:"",sharable:!0,block:"",description:"Runs another Block",solve:function(c,e){var b=this.getContext();if(b&&null!=b[this.method]){var a=[],f=b[this.method];try{var g=
this._getArgs(),a=f.apply(b,g||[]);this.onSuccess(this,e);return a}catch(k){console.error("call method failed"),this.onFailed(this,e)}}else this.onFailed(this,e);return[]},toText:function(){var c=this.getBlockIcon()+" "+this.name+" ";this.method&&(c+=this.method.substr(0,20));return c},getFields:function(){var c=this.getDefaultFields();c.push(g.createCI("Block",m.ECIType.BLOCK_REFERENCE,this.block,{toolTip:"Enter  block, you can use also the block's share title",group:"General",dst:"block",value:this.block,
title:"Block",scope:this.scope}));c.push(g.createCI("File",m.ECIType.FILE,this.file,{toolTip:"Leave empty to auto-select this file",group:"General",dst:"file",value:this.file,intermediateChanges:!1,acceptFolders:!1,acceptFiles:!0,encodeFilePath:!1,buildFullPath:!0,filePickerOptions:{dialogTitle:"Select Block File",filePickerMixin:{beanContextName:this.id,persistent:!1,globalPanelMixin:{allowLayoutCookies:!1}},configMixin:{beanContextName:this.id,LAYOUT_PRESET:m.LAYOUT_PRESET.SINGLE,PANEL_OPTIONS:{ALLOW_MAIN_MENU:!1,
ALLOW_NEW_TABS:!0,ALLOW_MULTI_TAB:!1,ALLOW_INFO_VIEW:!0,ALLOW_LOG_VIEW:!1,ALLOW_CONTEXT_MENU:!0,ALLOW_LAYOUT_SELECTOR:!0,ALLOW_SOURCE_SELECTOR:!0,ALLOW_COLUMN_RESIZE:!0,ALLOW_COLUMN_REORDER:!0,ALLOW_COLUMN_HIDE:!0,ALLOW_ACTION_TOOLBAR:!0,ALLOW_BREADCRUMBS:!1}},defaultStoreOptions:{fields:1663,includeList:"xblox",excludeList:"*"},startPath:this.file}}));return c},getBlockIcon:function(){return'\x3cspan class\x3d"el-icon-share-alt"\x3e\x3c/span\x3e'}})})},"xblox/model/events/OnEvent":function(){define("dcl/dcl dojo/_base/lang dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xide/registry dojo/on xwire/_Base".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q){return k([g,b.dcl,a.dcl,q],{declaredClass:"xblox.model.events.OnEvent",name:"On Event",event:"",reference:"",references:null,sharable:!0,_didSubscribe:!1,filterPath:"item.name",filterValue:"",valuePath:"item.value",_nativeEvents:"onclick ondblclick onmousedown onmouseup onmouseover onmousemove onmouseout onkeypress onkeydown onkeyup onfocus onblur onchange".split(" "),stop:function(){this._destroy()},solve:function(a,b,c,e){c&&this._destroy();b=this._lastSettings=b||
this._lastSettings;if(!this._didSubscribe)return this._registerEvent(this.event),this.onSuccess(this,b),!1;this.onSuccess(this,b);this._currentIndex=0;this._return=[];a=this[this._getContainer()];if(a.length)return a=this.runFrom(a,0,b),this.onSuccess(this,b),a;this.onSuccess(this,b);return[]},toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();
this.deserialize(this.reference);var b=null;if(-1<c.contains(this._nativeEvents,this.event))for(var b=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",
value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],f=0;f<b.length;f++){var g=b[f];if(g.value===this.event){g.selected=!0;break}}else b=this.scope.getEventsAsOptions(this.event);a.push(c.createCI("Event",e.ECIType.ENUMERATION,this.event,{group:"General",options:b,dst:"event",widget:{search:!0}}));a.push(c.createCI("Filter Path",13,this.filterPath,{group:"General",dst:"filterPath"}));a.push(c.createCI("Filter Value",13,this.filterValue,{group:"General",dst:"filterValue"}));
a.push(c.createCI("Value Path",13,this.valuePath,{group:"General",dst:"valuePath"}));a.push(c.createCI("Object/Widget",e.ECIType.WIDGET_REFERENCE,this.reference,{group:"Widget",dst:"reference",value:this.reference}));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bell"\x3e\x3c/span\x3e'},onEvent:function(a){this._lastResult=a;if(this.filterPath&&this.filterValue){var b=this.getValue(a,this.filterPath);if(b&&this.filterValue!==b)return}b=null;this.valuePath&&(this._lastSettings||(this._lastSettings=
{}),b=this.getValue(a,this.valuePath),null!==b&&(!this._lastSettings.override&&(this._lastSettings.override={}),this._lastSettings.override.args=[b]));this.solve(this.scope,this._lastSettings)},_subscribe:function(a,b,e){if(a)if(-1==c.contains(this._nativeEvents,a))this.__events&&this.__events[a]&&(e=this.__events[a],_.each(e,function(a){this.unsubscribe(a.type,a.handler);a.remove()},this),_.each(e,function(b){this.__events[a].remove(b)},this)),this.subscribe(a,this.onEvent);else if(e){b=a.replace("on",
"");var f=this;e=n(e,b,function(a){f.onEvent(a)});console.log("wire native event : "+b);this._events.push(e)}},_registerEvent:function(a){try{if(!a||!a.length)return;console.log("register event : "+a+" for "+this.reference);var b=this.resolveReference(this.deserialize(this.reference)),c=this;if(b&&b.length){for(var e=0;e<b.length;e++){var g=b[e];if(g&&g.id){var k=f.byId(g.id);if(k&&k.on){var n=this.event.replace("on","");console.log("found widget : "+g.id+" will register event "+n);var m=k.on(n,p.hitch(this,
function(a){console.log("event triggered : "+c.event);c.onEvent(a)}));this._events.push(m)}else this._subscribe(a,this.onEvent,g)}else this._subscribe(a,this.onEvent,g)}console.log("objects found : ",b)}else this._subscribe(a,this.onEvent)}catch(q){logError(q,"registering event failed")}this._didSubscribe=a},onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},updateEventSelector:function(a,b){var c=[];if(a&&a.length)for(var c=[{label:"onclick",
value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],f=0;f<c.length;f++){var g=
c[f];if(g.value===this.event){g.selected=!0;break}}else c=this.scope.getEventsAsOptions(this.event);for(f=0;f<b.length;f++)if(g=b[f],g.widget&&"Event"===g.widget.title){f=g._widget;f.nativeWidget.set("options",c);f.nativeWidget.reset();f.nativeWidget.set("value",this.event);this.publish(e.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this._destroy();this.reference=a;var c=this.resolveReference(this.deserialize(a));this.updateEventSelector(c,b);this._registerEvent(this.event)},onChangeField:function(a,
b,c){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=b,this._registerEvent(b)));if("reference"==a)this.onReferenceChanged(b,c);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){this._events||(this._events=[]);_.each(this._events,dojo.unsubscribe);this.unsubscribe(this.event,this.onEvent);this._lastResult=null;this._didSubscribe=!1}})})},"xblox/model/Referenced":function(){define(["dcl/dcl",
"dojo/_base/declare","xide/mixins/ReferenceMixin"],function(k,p,m){var g={reference:null,deserialize:function(c){if(!c||0==c.length)return{};try{return dojo.fromJson(c)}catch(e){return{}}}};p=p("xblox.model.Referenced",[m],g);p.dcl=k(m.dcl,g);return p})},"xide/mixins/ReferenceMixin":function(){define(["dcl/dcl","dojo/_base/declare","xide/types","xide/utils","xide/registry"],function(k,p,m,g,c){function e(a,b){var c=a.document.getElementById(b);return c?c:null}g.find=function(a,b,c){return(a=$(b).find(a))&&
0<a.length?!1===c?a:a[0]:null};var b={_targetReference:null,getTarget:function(){return this._targetReference||this.inherited(arguments)},skipWidgetCSSClasses:"dijitButtonHover dijitHover dijit dijitInline dijitReset dijitCheckBoxChecked dijitChecked dijitLeft".split(" "),_cssClassesToQuery:function(a){var b="";if(a){a=a.split(" ");for(var c=0;c<a.length;c++)-1<g.contains(this.skipWidgetCSSClasses,a[c])||-1<a[c].toLowerCase().indexOf("hover")||(b+=""+a[c])}return b.trim()},resolveReference:function(a,
b){var n=null;try{n=this.getTarget()}catch(p){return logError(p),null}var d=this.scope,l=a.reference;if(!(a&&l&&l.length)&&n)return[n];switch(a.mode){case m.WIDGET_REFERENCE_MODE.BY_ID:if(this.scope&&this.scope.document){n=[];if(-1!==l.indexOf(" "))for(var l=l.split(" "),r=0;r<l.length;r++){var h=e(d,l[r]);h&&n.push(h)}else return[e(d,l)];return n}d=c.byId(l);n="undefined"!==typeof document?document.getElementById(l):null;if(d||n)return d?[d]:[n];break;case m.WIDGET_REFERENCE_MODE.BY_CLASS:if(d=dojo.getObject(l)||
k.getObject(l))return[d];break;case m.WIDGET_REFERENCE_MODE.BY_CSS:d=this._cssClassesToQuery(l);this._parseString&&(d=this._parseString(d,b,null,b&&b.flags?b.flags:m.CIFLAG.EXPRESSION)||d);n=null;this.scope&&this.scope.global&&this.scope.global.$?n=this.scope.global.$:"undefined"!==typeof $&&(n=$);if(n&&(n=n(d)))return n;if(d=g.find(d,null,!1))return d}return null}};p=p("xblox.model.ReferenceMixin",null,b);p.dcl=k(null,b);return p})},"xwire/_Base":function(){define(["dcl/dcl","xide/mixins/EventedMixin"],
function(k,p){function m(c,e){for(var b=g(e),a=0,f=b.length;a<f;++a){var k=b[a];c=null==c?c:c[k]}return c}function g(c,e){return""===c?[]:"function"!==typeof c.splice?c.split("."):e?c.slice():c}return k([p.dcl],{declaredClass:"xwire._Base",constructor:function(c){for(var e in c)c.hasOwnProperty(e)&&(this[e]=c[e])},getValue:function(c,e){return m(c,e)},setValue:function(c,e,b){var a=g(e,!0),f=a.pop();c=0<a.length?m(c,a):c;return Object(c)===c&&e?"function"===typeof c.set?c.set(f,b):c[f]=b:void 0}})})},
"xblox/model/events/OnKey":function(){define("dcl/dcl dojo/_base/lang dojo/_base/array dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xblox/model/Contains xblox/model/events/OnEvent xide/registry dojo/on".split(" "),function(k,p,m,g,c,e,b,a,f,n,q,d,l){return k([c,a.dcl,f.dcl,n],{declaredClass:"xblox.model.events.OnKey",name:"On Key",event:"",reference:"",references:null,description:"Triggers when a keyboard sequence "+this.event+" has been entered",
listeners:null,sharable:!0,toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();a.push(e.createCI("Keyboard Sequence",b.ECIType.STRING,this.event,{group:"General",dst:"event",value:this.event,intermediateChanges:!1}));a.push(e.createCI("Object/Widget",b.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",value:this.reference}));
return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-keyboard-o"\x3e\x3c/span\x3e'},onEvent:function(a){this._lastResult=a;this.solve(this.scope,this._lastRunSettings)},_addListerner:function(a,b,c){null==this.listeners&&(this.listeners=[]);var d=null,d=new window.keypress.Listener(c,{is_unordered:!0,prevent_repeat:!1,prevent_default:!1,on_keyup:function(a){console.log("up")},on_keydown:function(a){console.log("down")},on_release:function(a){console.log("release")}});d.simple_combo(a,function(a){b&&
b(arguments)});this.listeners.push(d)},_subscribe:function(a,b,c){a&&(c&&c.domNode&&(c=c.domNode),this._addListerner(a,b,c))},_registerEvent:function(a){if(a&&a.length){var b=this.resolveReference(this.deserialize(this.reference)),c=this;if(b&&b.length)for(var e=0;e<b.length;e++){var f=b[e];if(f&&f.id){var g=d.byId(f.id);g=null,this._subscribe(a,function(){c.onEvent(arguments)},f)}else this._subscribe(a,function(){c.onEvent(arguments)},f)}else this._subscribe(a,function(){c.onEvent(arguments)})}},
onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},destroy:function(){this.inherited(arguments)},updateEventSelector:function(a,c){var d=[];if(a&&a.length)for(var d=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},
{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],e=0;e<d.length;e++){var f=d[e];if(f.value===this.event){f.selected=!0;break}}else d=this.scope.getEventsAsOptions(this.event);for(e=0;e<c.length;e++)if(f=c[e],f.widget&&"Event"===f.widget.title){e=f._widget;e.nativeWidget.set("options",d);e.nativeWidget.reset();e.nativeWidget.set("value",
this.event);this.publish(b.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this._destroy();this.reference=a;this.resolveReference(this.deserialize(a));this._registerEvent(this.event)},onChangeField:function(a,b,c){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=b,this._registerEvent(b)));if("reference"==a)this.onReferenceChanged(b,c);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){if(this.listeners)for(var a=
0;a<this.listeners.length;a++){var b=this.listeners[a];b.stop_listening();var c=b.get_registered_combos();c&&b.unregister_many(c);b.reset();console.log("did destroy listener")}this.listeners=[]},onFieldsRendered:function(a,b){}})})},"xblox/model/mqtt/Subscribe":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains xide/types".split(" "),function(k,p,m,g,c,e,b,a,f){p="undefined"!==typeof window?window.console:global.console;a&&p&&p.error&&(p=f);return k([g,
e],{declaredClass:"xblox.model.mqtt.Subscribe",name:"Subscribe",topic:"Topic",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-bell",path:"",qos:0,stop:function(){var a=this.getInstance();a&&a.callMethod("unSubscribeTopic",c.mixin({topic:this.topic},c.getJson(this.args)),this.id,this.id)},onData:function(a){if(a&&a.topic&&a.topic==this.topic){delete a.src;delete a.id;this.getContext();var b=this[this._getContainer()],d=this._lastSettings,e=[];if(0<b.length){var b=a,f=this.path&&this.path.length?
this.path:null!==a.payload?"payload":null;f&&_.isObject(a)&&(b=c.getAt(a,f,a));for(a=0;a<this.items.length;a++)f=this.items[a],f.enabled&&(f.override={args:[b]},e.push(f.solve(this.scope,d)))}this.onSuccess(this,this._lastSettings);return e}},observed:["topic"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve:function(a,b,d,e,f,g){this._currentIndex=0;this._return=[];this._lastSettings=b;(a=this.getInstance())&&a.callMethod("subscribeTopic",c.mixin({topic:this.topic,
qos:this.qos},c.getJson(this.args||"{}")),this.id,this.id);b=b||{};this.onRunThis(b)},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+""+this.makeEditable("topic","bottom","text","Enter a topic","inline")+" :: \x3c/span\x3e";this.topic&&(a+=this.topic.substr(0,30));return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();a.push(c.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));a.push(c.createCI("arguments",
27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(c.createCI("topic",b.ECIType.STRING,this.topic,{group:"General",title:"Topic",dst:"topic",select:!0}));a.push(c.createCI("name",b.ECIType.ENUMERATION,this.qos,{group:"General",title:"QOS",dst:"qos",widget:{options:[{label:"0 - at most once",value:0},{label:"1 - at least once",value:1},{label:"2 - exactly once",value:2}]}}));a.push(c.createCI("path",b.ECIType.STRING,this.path,{group:"General",title:"Value Path",dst:"path"}));return a}})})},
"xblox/model/mqtt/Publish":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains xide/types xcf/model/Command".split(" "),function(k,p,m,g,c,e,b,a,f,n){p="undefined"!==typeof window?window.console:global.console;f&&p&&p.error&&(p=n);return k(a,{declaredClass:"xblox.model.mqtt.Publish",name:"Publish",topic:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-send",isCommand:!0,qos:0,retain:!1,path:null,onData:function(a){if(a&&a.topic&&a.topic==this.topic){this.getContext();
var b=this[this._getContainer()],e=this._lastSettings,f=[];if(0<b.length)for(b=a,(this.path="value",_.isObject(a))&&(b=c.getAt(a,this.path,a)),a=0;a<this.items.length;a++){var g=this.items[a];g.enabled&&(g.override={args:[b]},f.push(g.solve(this.scope,e)))}this.onSuccess(this,this._lastSettings);return f}},observed:["topic"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve:function(a,b,e,f,g,k){this._currentIndex=0;this._return=[];b=this._lastSettings=
b||this._lastSettings;f=this.getInstance();1==e&&this._loop&&this.reset();e=this.args;g=this.getArgs(b);g[0]&&(e=g[0]);f&&(e=c.getJson(e,!0,!1),null!==e&&0!==e&&!0!==e&&!1!==e&&_.isObject(e)||(e={payload:this.args}),a=a.expressionModel.replaceVariables(a,this.topic,!1,!1),f.callMethod("publishTopic",c.mixin({topic:a,qos:this.qos,retain:this.retain},e),this.id,this.id));b=b||{};this.onDidRun();this.onSuccess(this,b);return!0},toText:function(a,b,c,e){a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+
" "+this.makeEditable("name","top","text","Enter a name","inline")+" :: \x3c/span\x3e";this.topic&&(a+=this.makeEditable("topic","bottom","text","Enter a topic","inline"),this.startup&&(a+=this.getIcon("fa-bell inline-icon text-warning","text-align:right;float:right;","")),0<this.interval&&(a+=this.getIcon("fa-clock-o inline-icon text-warning","text-align:right;float:right","")));return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();a.push(c.createCI("qos",
b.ECIType.ENUMERATION,this.qos,{group:"General",title:"QOS",dst:"qos",widget:{options:[{label:"0 - at most once",value:0},{label:"1 - at least once",value:1},{label:"2 - exactly once",value:2}]}}));a.push(c.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(c.createCI("topic",b.ECIType.STRING,this.topic,{group:"General",title:"Topic",dst:"topic",select:!0}));a.push(c.createCI("retain",b.ECIType.BOOL,this.retain,{group:"General",title:"Retain",dst:"retain"}));
a.remove(_.find(a,{name:"send"}));a.remove(_.find(a,{name:"waitForResponse"}));return a}})})},"xblox/model/File/ReadJSON":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains dojo/promise/all xide/types module xdojo/has!xblox-ui?xfile/data/DriverStore xdojo/has!xblox-ui?xfile/views/FileGridLight".split(" "),function(k,p,m,g,c,e,b,a,f,n,q){p("electronx");p("xcf-ui");p("php");return k([g,e],{declaredClass:"xblox.model.File.ReadJSON",name:"Read JSON",deferred:!1,
sharable:!1,context:null,icon:"fa-file",observed:["path"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},getFileContent:function(a){new m;var b=this.getScope().ctx;b.getFileManager();(b=b.getDeviceManager().getInstanceByName("File-Server"))||console.error("ReadJSON : have no file server driver");return b.callCommand("GetProg",{override:{args:[a]}})},processJSON:function(b,e){var f=this.jsonPath;this._lastResult=f?c.getAt(b,f):b;this.onSuccess(this,
e);this.runByType(a.BLOCK_OUTLET.FINISH,e)},solve:function(a,b,e,f,g){this._currentIndex=0;this._return=[];b=this._lastSettings=b||this._lastSettings||{};e=""+this._get("path");this.getContext();this._getContainer();var k=new m,n=this;this.onRunThis(b);a=a.expressionModel.replaceVariables(a,e,null,null);console.log("path "+a);this.getFileContent(a).then(function(a){(a=a.content)&&(a=c.getJson(a,!0))&&n.processJSON(a,b)});this.getArgs(b);try{f&&f("Expression "+e+" evaluates to "+a)}catch(p){p=p||{},
this.onDidRunItemError(k,p,b),this.onFailed(this,b),g&&g("invalid expression : \n"+e+": "+p)}return k},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.name+" :: \x3c/span\x3e";this.path&&(a+=this.path.substr(0,50));return a},canAdd:function(){return[]},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields(),e=this.getScope().ctx,f=e.getDeviceManager().getInstanceByName("File-Server"),g=c.clone(a.DEFAULT_FILE_GRID_PERMISSIONS),e={ctx:e,owner:this,
selection:"/",resizeToParent:!0,Module:q,permissions:g};if(f&&n){var g=function(a){return new n({data:[],config:k,mount:"none",options:m,driver:f,micromatch:"(*.json)|!(*.*)",glob:a})},k={},m={fields:a.FIELDS.SHOW_ISDIR|a.FIELDS.SHOW_OWNER|a.FIELDS.SHOW_SIZE|a.FIELDS.SHOW_FOLDER_SIZE|a.FIELDS.SHOW_MIME|a.FIELDS.SHOW_PERMISSIONS|a.FIELDS.SHOW_TIME|a.FIELDS.SHOW_MEDIA_INFO};e.leftStore=g("/*");e.rightStore=g("/*")}b.push(c.createCI("path",4,this.path,{group:"General",title:"Path",dst:"path",filePickerOptions:e,
widget:{item:this}}));b.push(c.createCI("jsonPath",13,this.jsonPath,{group:"General",title:"Select",dst:"jsonPath"}));return b}})})},"xcf/factory/Blocks":function(){define("xblox/factory/Blocks xcf/model/Command xblox/model/functions/CallBlock xblox/model/functions/StopBlock xblox/model/functions/PauseBlock xide/factory".split(" "),function(k,p,m,g,c,e){return k?(k._getCommandBlocks=function(b,a,e,k){var q=[];q.push({name:"Commands",iconClass:"el-icon-random",items:[{name:"Call Command",owner:a,iconClass:"el-icon-video",
proto:m,target:e,ctrArgs:{scope:b,group:k,condition:""}},{name:"Stop Command",owner:a,iconClass:"el-icon-video",proto:g,target:e,ctrArgs:{scope:b,group:k,condition:""}},{name:"Pause Command",owner:a,iconClass:"el-icon-video",proto:c,target:e,ctrArgs:{scope:b,group:k,condition:""}},{name:"New Command",owner:a,iconClass:"el-icon-video",proto:p,target:e,ctrArgs:{scope:b,group:k,condition:"",name:"No-Title"}}]});return q},k):e})},"nxapp/manager/TestManager":function(){define("dcl/dcl dojo/node!fs xcf/manager/DeviceManager xide/utils xide/types nxapp/utils/_console nxapp/utils dojo/node!child_process nxapp/manager/ManagerBase require xide/mixins/ReloadMixin dojo/node!path xdojo/has".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d,l){function r(){h.clear();n(["intern/lib/executors/PreExecutorEmbedded","intern/lib/reporters/Console"],function(a,b){var c=new a({executorId:"client",config:g.mixin(t,{suites:["tests/devices/all"]}),defaultLoaderOptions:dojoConfig});try{h.error("run tests"),c.run(function(a){h.error("did tests ",a)}),n.undef("tests/devices/all")}catch(d){h.error("error running tests ",d)}})}var h=e,t={proxyPort:9E3,proxyUrl:"http://localhost:9000/",tunnel:"NullTunnel",capabilities:{name:"dojo-loader",
project:"Dojo 2",fixSessionCapabilities:!1},environments:[{browserName:"internet explorer",version:["9.0","10.0","11.0"],platform:"Windows 7"},{browserName:"firefox",platform:"Windows 10"},{browserName:"chrome",platform:"Windows 10"},{browserName:"safari",version:"9",platform:"OS X 10.11"},{browserName:"android",platform:"Linux",version:"4.4",deviceName:"Google Nexus 7 HD Emulator"}],maxConcurrency:2,loaderOptions:{packages:[{name:"dojo",location:"./node_modules/dojo"},{name:"dijit",location:"dijit"},
{name:"dgrid",location:"dgrid"},{name:"dstore",location:"dstore"},{name:"xide",location:"xide"},{name:"xfile",location:"xfile"},{name:"dojox",location:"dojox"},{name:"xdojo",location:"xdojo"},{name:"xgrid",location:"xgrid"},{name:"xblox",location:"xblox"},{name:"xdocker",location:"xdocker"},{name:"wcDocker",location:"wcDocker/src"},{name:"dcl",location:"./node_modules/dcl"},{name:"tests",location:"tests"}]},excludeInstrumentation:/(?:node_modules|bower_components|tests)[\/\\]/,suites:["tests/all"],
functionalSuites:[],reporters:[{id:"tests/ConsoleEmbedded",delegate:{onStart:function(a){h.error("on start "+a.name)},onFail:function(a){h.error("on fail "+a.name)},onEnd:function(a){h.error("on start "+a.name)}}},{id:"JUnit",filename:"report.xml"}]};(p=global.sctx)&&p.getTestManager();return k([f,q.dcl],{declaredClass:"nxapp.manager.TestManager",connection:null,test1:function(){return"   ha"},loadFixtures:function(){d.resolve("./tests/")},onReloaded:function(){h.error("on reloaded")},doTests:function(){},
init:function(){this.subscribe(c.EVENTS.ON_MODULE_RELOADED,function(a){-1!==a.module.indexOf("tests/devices")&&a.module.indexOf(".js")&&(n.undef("tests/devices/Minimal"),r())})}})})},"nxappmain/main_export":function(){require("dojo/node!path dojo/node!fs dojo/node!util dojo/node!vm nxapp/Commons nxapp/Logger nxapp/utils/_console xide/utils nxappmain/nxAppExport nxapp/manager/ExportManager nxapp/model/ExportOptions xide/types require".split(" "),function(k,p,m,g,c,e,b,a,f,n,q,d,l){k=new f({commander:null});
k.init();k=k.profile;b.log("export "+k.user+" and system data:  "+k.system);new q(k);(new n).initWithOptions(k)})},"nxapp/Logger":function(){define(["dcl/dcl","xide/types","xide/factory","dojo/node!winston","nxapp/utils/_console"],function(k,p,m,g,c){return k(null,{declaredClass:"nxapp.Logger",fileLogger:null,loggly:null,delegate:null,publishLog:!1,loggers:{},constructor:function(c){for(var b in arguments)arguments.hasOwnProperty(b)&&(this[b]=c[b])},createLogger:function(c){var b=new g.Logger({transports:[new g.transports.File(c)]});
if(this.publishLog)b.on("logging",function(a,b,g,k){k.logId=c.filename;a={level:b,message:g,data:k,time:(new Date).getTime()};m.publish(p.EVENTS.ON_SERVER_LOG_MESSAGE,a)});return b},log:function(){return this.logger.log.apply(this.logger,arguments)},verbose:function(){return this.logger.verbose.apply(this.logger,arguments)},info:function(){return this.logger.info.apply(this.logger,arguments)},start:function(c){this.loggers={};this.options=c;this.logger=new g.Logger({transports:[new g.transports.Console({level:"debug"})]});
this.logger.transports.console.level="debug";this.logger.on("logging",function(b,a,c,e){})}})})},"nxappmain/nxAppExport":function(){define("dcl/dcl nxapp/utils/FileUtils dojo/node!commander dojo/node!fs dojo/node!os dojo/node!path xide/factory/Events dojo/has xide/model/Base xide/utils nxappmain/nxAppBase".split(" "),function(k,p,m,g,c,e,b,a,f,n,q){a.add("windows",function(){return"win32"===c.platform()});a.add("osx",function(){return"darwin"===c.platform()});a.add("linux",function(){return"linux"===
c.platform()});a.add("arm",function(){return"arm"===c.arch()});return k(q,{declaredClass:"nxappmain.nxAppExport",profilePath:"/nxappmain/profile_device_server.json",init:function(){this.commander||(m.version("0.0.1").option("-f, --file \x3cpath\x3e","run a file").option("-r, --root \x3cpath\x3e","root path to Control-Freak").option("-u, --user \x3cpath\x3e","user directory").option("-t, --target \x3cpath\x3e","target directory").option("-s, --system \x3cname\x3e","path to system scope location").option("-d, --dist \x3cpath\x3e",
"path to the pre-compiled NodeJS servers").option("--windows \x3cboolean\x3e","true/false to export windows NodeJS server").option("--osx \x3cboolean\x3e","true/false to export OSX NodeJS server").option("--linux32 \x3cboolean\x3e","true/false to export Linux-32 Bit NodeJS server").option("--linux64 \x3cboolean\x3e","true/false to export Linux-64 NodeJS server").option("--arm \x3cboolean\x3e","true/false to export ARM-v7 NodeJS server").option("--client \x3cstring\x3e","path to client root"),this.commander=
m,this.commander.allowUnknownOption(!0),this.commander.parse(process.argv));if(m.jhelp){var a=[];m.options.map(function(b){a.push(b)});console.log(JSON.stringify(a));process.exit()}this.profile=this.getProfile(this.profilePath);m.root||(this.profile.root=p.resolve("../.."));m.target||(this.profile.target=p.resolve("../../myapp"));n.mixin(this.profile,this.commander);var b=e.resolve(this.profile.system);g.existsSync(b)?this.profile.system=b:(b=process.cwd()+"/data/system",this.profile.system=b,m.system=
b)}})})},"nxapp/model/ExportOptions":function(){define(["dcl/dcl","xide/model/Base","xide/mixins/EventedMixin","xide/encoding/MD5","xide/utils"],function(k,p,m,g,c){return k([p.dcl,m.dcl],{connected:!1,__registered:!1,declaredClass:"nxapp/model/ExportOptions",toString:function(){var c=this.options;return c.deviceScope+"://"+c.host+":"+c.port+"@"+c.protocol},constructor:function(c){this.options=c}})})},"nxappmain/main_server":function(){require("dojo/node!readline nxapp/Commons xide/types nxapp/utils/TCPUtils nxappmain/nxAppBase nxapp/manager/DeviceServerContext nxapp/client/WebSocket xlog/Server dojo/node!winston dojo/node!path dojo/node!fs dojo/node!util dojo/node!vm nxapp/manager/MQTTManager nxapp/Commons nxapp/utils/FileUtils nxapp/Logger nxapp/utils/_console require dojo/node!tcp-port-used".split(" "),
function(k,p,m,g,c,e,b,a,f,n,q,d,l,r,h,t,y,u,v,z){global.dojoRequire=v;p={filename:"all.log",dirname:dojoConfig.logRoot,json:!0};var C=new a({});C.start({fileLogger:p,console:null});var B=new c({commander:null}),E,G,F;B.init();var x=B.profile;c=B.commander;if(c.diagnose){console.error("run diagnose");console.log("loaded modules: ",null!==global.nRequire.cache);for(var D in global.nRequire.cache)console.log(D)}else{if(c.modules){l=["/nxappmain/server","/nxappmain/dojoConfig","/dojo/dojo","/dojo/_base/configNode"];
t="";z=0;for(D in global.nRequire.cache)e=D.replace(process.cwd(),"").replace(n.sep+"node_modules"+n.sep,"").replace(".js",""),-1===l.indexOf(e)&&(t+="var a_"+z+' \x3d require("'+e+'");\n',z++);console.log(t);return t}if(c.file){n=n.resolve(c.file);if(q.existsSync(n)){D=new l.createContext({require:v.nodeRequire,commander:c,console:console,process:process,setTimeout:setTimeout,global:global});n=t.readFile(n);(new l.Script(n)).runInContext(D);return}console.error("file specified but doesnt exists "+
c.file)}c.port&&(x.socket_server.port=c.port);c.host&&(x.socket_server.host=c.host);if(B.commander.info)console.log(JSON.stringify({host:"http://"+B.profile.socket_server.host,port:B.profile.socket_server.port})),process.exit();else{var w=new e;w.profile=x;w.constructManagers();w.initManagers(x);w.logManager=C;n=new r({ctx:w,profile:x});n.init(x);w.connectionManager.mqttManager=n;w.mqttManager=n;var A=null,H=function(){var a=new b;a.init({options:{host:"http://"+B.profile.socket_server.host,port:B.profile.socket_server.port,
debug:B.profile.debug}});a.connect();a.onSignal(m.SIGNAL_RESPONSE,function(a){x.common.stdout&&process.stdout.write(a+"\n");B.commander.oneshot&&B.commander.command&&process.exit()});return a},K=function(){B.commander.host&&(E=B.commander.host);B.commander.port&&(G=parseInt(B.commander.port));B.commander.protocol&&(F=B.commander.protocol);if(B.commander.driver){console.error("run in driver mode");var a=H(),b={driver:"xcf/driver/SubTest",host:"192.168.1.20",port:23,protocol:"tcp"},c=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER;
b.manager_command=m.SOCKET_SERVER_COMMANDS.START_DRIVER;c=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER;a.emit(c,b)}else if(B.commander.send){console.error("sending command");console.error("  create web socket client to control server : http://"+B.profile.socket_server.host+":"+B.profile.socket_server.port);var a=H(),d=function(b){if(null!==a&&null!=b){var c={command:b,host:E,port:G,protocol:F},d=m.SOCKET_SERVER_COMMANDS.SIGNAL_DEVICE;"startDriver"==b?(c.manager_command=m.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,
d=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):"status"==b?(c.manager_command=m.SOCKET_SERVER_COMMANDS.MANAGER_STATUS,d=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):"closeall"==b?(c.manager_command=m.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL,d=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):c.device_command=m.SOCKET_SERVER_COMMANDS.DEVICE_SEND;a.emit(d,c)}},b=function(b){if(null!==a&&null!=b)if(b.indexOf&&-1!=b.indexOf(";")){b=b.split(";");for(var c=0;c<b.length;c++)d(b[c])}else d(b)};k.createInterface({input:process.stdin,
output:process.stdout}).on("line",function(a){null!=a&&0<a.length&&(console.log("sending stdin : "+a),d(a))});"string"==typeof B.commander.command&&b(B.commander.command);console.error("Send command. ^C to close connection and quit")}};if(x.common.createSocketServer){var I=function(){A=g.createDeviceServer(x,w);w.deviceServer=A;w.logger=f;w.deviceServer.logger=f;w.logManager=C};z.check(x.socket_server.port,x.socket_server.host).then(function(a){a?(console.log("device server already started"),H()):
(I(),K())},function(a){I();K()})}else try{K()}catch(J){console.error("app crash!")}}}})},"nxapp/manager/MQTTManager":function(){define("dcl/dcl nxapp/manager/ManagerBase nxapp/utils/_LogMixin nxapp/types/Types dojo/node!mosca dojo/node!mqtt dojo/node!node-notifier dojo/node!colors xide/utils nxapp/utils/_console dojo/node!tcp-port-used".split(" "),function(k,p,m,g,c,e,b,a,f,n,q){return k([p,m],{declaredClass:"nxapp.manager.MQTTManager",options:null,profile:null,lastUpTime:null,mqttClients:null,publishTopic:function(a,
b){var c={topic:a,payload:JSON.stringify(b),qos:1};this.server.publish(c,function(){})},createMQTTClient2:function(a,b,c){var f=a+":"+b,k=e.connect("mqtt://localhost",{clean:!1,clientId:f}),m=this.ctx;n.log("create mqtt - client for "+f);k.on("connect",function(){n.log("on connected local mqtt client for "+f)});k.on("message",function(e,f){m.getDeviceServer().broadCastMessage(g.EVENTS.ON_MQTT_MESSAGE,{host:a,port:b,topic:e,message:f.toString(),mqtt:c})});return k},createMQTTClient:function(a,b,c){a=
a+":"+b;if(this.mqttClients[a])return this.mqttClients[a];if(!this.mqttClients[a])return b=e.connect("mqtt://localhost",{clean:!1,clientId:a}),b.on("connect",function(){}),this.mqttClients[a]=b},onConnectedToDevice:function(a,b,c){},onWakeup:function(){this.lastUpTime=(new Date).getTime();for(var a=0;a<this.pool.length;a++){var b=this.pool[a];b.socket&&b.socket.close&&b.socket.close();b.socket&&b.socket._socket&&b.socket._socket.close&&b.socket._socket.close()}this.pool=[]},init:function(d){function e(){if(!g.__started){g.__started=
!0;try{b.notify({title:"Control-Freak",message:"All servers up and running, you can start now Control-Freak IDE",sound:!0,wait:!0,open:"file:///"},function(a,b){})}catch(c){}n.log(a.green("\n\r\t Device server up and running\n\r \t ***********   You can start Control Freak now  **************\n\r"));g.ctx.onReady()}}this.profile=d;this.lastUpTime=(new Date).getTime();var g=this;this.mqttClients={};var h={type:"mongo",url:"mongodb://localhost:27017/mqtt",pubsubCollection:"xcf",mongo:{}};f.mixin(h,
this.profile.ascoltatore);var k={port:1883,backend:h,persistence:{factory:c.persistence.Mongo,url:"mongodb://localhost:27017/mqtt"}};this.profile.mosca.port&&(this.profile.mosca.port=parseInt(this.profile.mosca.port));f.mixin(k,this.profile.mosca);if("false"===this.profile.mqtt)n.warn("MQTT is disabled, proceed without"),this.server={},e();else try{var m=function(){var a=new c.Server(k);a.on("error",function(a){n.error("Unable to connect to Mongo:"+a.message);e()});a.on("ready",e);a.on("clientConnected",
function(){});a.on("clientDisconnected",function(){});g.server=a};q.check(d.socket_server.port,d.socket_server.host).then(function(a){a||m()},function(){m()})}catch(p){n.error("error starting mosca ",p)}},onTimeout:function(a){},onClose:function(a){this.removeConnection(a)},onDrain:function(a){},onError:function(a,b){},onData:function(a,b){throw Error();},onConnect:function(a,b,c,e){n.log("Connected to "+a+":"+b+" via "+c,"protocol_messages");a={device:{host:a,port:b,protocol:c,deviceScope:e}};this.ctx.getDeviceServer().broadCastMessage(g.EVENTS.ON_DEVICE_CONNECTED,
a)},onHandle:function(a,b){this.showDebugMsg("protocol_messages")}})})}}});define("nxappmain/serverbuild",[],1);
//# sourceMappingURL=serverbuild.js.map