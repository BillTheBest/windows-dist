//>>built
require({cache:{"xide/types":function(){define(["dcl/dcl"],function(h){return new h(null,{declaredClass:"xide/types"})})},"dcl/dcl":function(){(function(h){"undefined"!=typeof define?define(["./mini"],h):"undefined"!=typeof module?module.exports=h(require("./mini")):dcl=h(dcl)})(function(h){function p(){}function n(c,a,b){var r=c||p,f=a||p,m=b||p,k=function(){var a,b;r.apply(this,arguments);try{a=m.apply(this,arguments)}catch(l){a=l,b=!0}f.call(this,arguments,a);if(b)throw a;return a};k.advices={before:c,
after:a,around:b};return k}function g(c){return function(a,b){var r=a._meta,f;r&&((f=+r.weaver[b]||0)&&f!=c&&h._error("set chaining",b,a,c,f),r.weaver[b]=c)}}var d=h(h.Super,{constructor:function(){this.before=this.around.before;this.after=this.around.after;this.around=this.around.around}});h.mix(h,{Advice:d,advise:function(c){return h._makeSuper(c,d)},before:function(c){return h.advise({before:c})},after:function(c){return h.advise({after:c})},around:h.superCall,chainBefore:g(1),chainAfter:g(2),
isInstanceOf:function(c,a){if(c instanceof a)return!0;var b=c.constructor._meta,r;if(b)for(b=b.bases,r=b.length-1;0<=r;--r)if(b[r]===a)return!0;return!1},_stub:function(c,a,b,r){r=r[b]=h._extractChain(a,b,"around");var f=h._extractChain(a,b,"before").reverse();a=h._extractChain(a,b,"after");r=c?h._stubChainSuper(r,1==c?function(a){return h._stubChain(a.reverse())}:h._stubChain,b):h._stubSuper(r,b);return f.length||a.length?n(h._stubChain(f),h._stubChain(a),r):r||function(){}}});return h})},"dcl/mini":function(){(function(h){"undefined"!=
typeof define?define([],h):"undefined"!=typeof module?module.exports=h():dcl=h()})(function(){function h(b,r){var f=[0],c,k,e,q,l,d,v,t,y=0,w;if(b)if(b instanceof Array){l={};v=b.slice(0).reverse();for(t=v.length-1;0<=t;--t)if(k=v[t],k._uniqueId=k._uniqueId||g++,c=k._meta){d=c.bases;for(y=d.length-1;0<y;--y)w=d[y]._uniqueId,l[w]=(l[w]||0)+1;v[t]=d.slice(0)}else v[t]=[k];c={};a:for(;v.length;){for(t=0;t<v.length;++t)if(d=v[t],k=d[0],w=k._uniqueId,!l[w]){c[w]||(f.push(k),c[w]=1);d.shift();d.length?
--l[d[0]._uniqueId]:v.splice(t,1);continue a}h._error("cycle",r,v)}b=b[0];y=f.length-((q=b._meta)&&b===f[f.length-(y=q.bases.length)]?y:1)-1}else b._uniqueId=b._uniqueId||g++,f=f.concat((q=b._meta)?q.bases:b);c=b?h.delegate(b.prototype):{};for(d=b&&(q=b._meta)?h.delegate(q.weaver):{constructor:2};0<y;--y)if(k=f[y],q=k._meta,h.mix(c,q&&q.ownProps||k.prototype),q)for(w in v=q.weaver)d[w]=(+d[w]||0)|v[w];for(w in r)n(q=r[w])?d[w]=+d[w]||0:c[w]=q;q={bases:f,ownProps:r,weaver:d,chains:{}};f[0]={_meta:q,
prototype:c};k=c;l=q.weaver;d=q.bases;v=q.chains;for(e in l)k[e]=h._stub(l[e],d,e,v);e=c.constructor;e._meta=q;e.prototype=c;f[0]=e;f=h._postprocess(e);r.declaredClass&&!a[r.declaredClass]&&(a[r.declaredClass]=f);return f}function p(a){this.around=a}function n(a){return a&&a.spr instanceof p}var g=0,d={},c,a={};(c=function(a,c){for(var f in c)a[f]=c[f]})(h,{mix:c,delegate:function(a){return Object.create(a)},allKeys:function(a){var c=[],f;for(f in a)c.push(f);return c},Super:p,superCall:function(a){return h._makeSuper(a)},
_makeSuper:function(a,c){var f=function(){};f.spr=new (c||p)(a);return f},_postprocess:function(a){return a},_error:function(a){throw Error("dcl: "+a);},_instantiate:function(a,c,f){c=a.spr.around(c);c.ctr=a.ctr;return c},_extractChain:function(a,c,f){for(var m=a.length-1,k=[],e,q,l="around"==f;e=a[m];--m)if((q=e._meta)?(q=q.ownProps).hasOwnProperty(c)&&(n(q=q[c])?l?q.spr.around:q=q.spr[f]:l):l&&(q="constructor"==c?e:e.prototype[c])&&q!==d[c])"function"==typeof q?(q.ctr=e,k.push(q)):h._error("wrong super",
e,c);return k},_stubChain:function(a){var c=a.length,f;return c?1==c?(f=a[0],function(){f.apply(this,arguments)}):function(){for(var f=0;f<c;++f)a[f].apply(this,arguments)}:0},_stubSuper:function(a,c){for(var f=0,m,k=d[c];m=a[f];++f)k=n(m)?a[f]=h._instantiate(m,k,c):m;return"constructor"!=c?k:function(){k.apply(this,arguments)}},_stubChainSuper:function(a,c,f){for(var m=0,k,e,q=0;k=a[m];++m)n(k)&&(e=m-q,a[m]=h._instantiate(k,e?1==e?a[q]:c(a.slice(q,m)):0,f),q=m);return(e=m-q)?1==e&&"constructor"!=
f?a[q]:c(q?a.slice(q):a):0},_stub:function(a,c,f,m){c=m[f]=h._extractChain(c,f,"around");return(a?h._stubChainSuper(c,h._stubChain,f):h._stubSuper(c,f))||function(){}}});h.getObject=function(b){return a[b]};return h})},"xide/types/Types":function(){define(["dojo/_base/lang","xide/types","dojo/_base/json","dojo/_base/kernel"],function(h,p,n,g){null==p.customTypes&&(p.customTypes={});null==p.customEnumerations&&(p.customEnumerations={});null==p.widgetMappings&&(p.widgetMappings={});null==p.customMimeIcons&&
(p.customMimeIcons={});p.resolveType=function(d){return p.customTypes[d]?p.customTypes[d]:null};p.registerType=function(d,c){p.customTypes[d]=c};p.registerWidgetMapping=function(d,c){p.widgetMappings[d]=c};p.registerEnumeration=function(d,c){p.customEnumerations[d]=c};p.resolveEnumeration=function(d){return p.customEnumerations[d]?p.customEnumerations[d]:null};p.resolveWidgetMapping=function(d){return p.widgetMappings[d]?p.widgetMappings[d]:null};p.GRID_FEATURE={KEYBOARD_NAVIGATION:"KEYBOARD_NAVIGATION",
KEYBOARD_SELECT:"KEYBOARD_SELECT",SELECTION:"SELECTION",ACTIONS:"ACTIONS",CONTEXT_MENU:"CONTEXT_MENU"};p.VIEW_FEATURE={KEYBOARD_NAVIGATION:"KEYBOARD_NAVIGATION",KEYBOARD_SELECT:"KEYBOARD_SELECT",SELECTION:"SELECTION",ACTIONS:"ACTIONS",CONTEXT_MENU:"CONTEXT_MENU"};p.KEYBOARD_PROFILE={DEFAULT:{prevent_default:!0,prevent_repeat:!1},PASS_THROUGH:{prevent_default:!1,prevent_repeat:!1},SEQUENCE:{prevent_default:!0,is_sequence:!0,prevent_repeat:!0}};p.CI_STATE={NONE:0,PENDING:1,PROCESSING:2,FAILED:4,SUCCESSED:8,
PROCESSED:16,DEQUEUED:32,SOLVED:64,END:128};p.CIFLAG={NONE:0,BASE_64:1,USE_FUNCTION:2,REPLACE_VARIABLES:4,REPLACE_VARIABLES_EVALUATED:8,ESCAPE:16,REPLACE_BLOCK_CALLS:32,REMOVE_DELIMTTERS:64,ESCAPE_SPECIAL_CHARS:128,USE_REGEX:256,USE_FILTREX:512,CASCADE:1024,EXPRESSION:2048,DONT_PARSE:4096,TO_HEX:8192,REPLACE_HEX:16384,WAIT:32768,DONT_ESCAPE:65536,END:131072};p.CI_CORDER={};p.ECIType={BOOL:0,BOX:1,COLOUR:2,ENUMERATION:3,FILE:4,FLAGS:5,FLOAT:6,INTEGER:7,MATRIX:8,OBJECT:9,REFERENCE:10,QUATERNION:11,
RECTANGLE:12,STRING:13,VECTOR:14,VECTOR2D:15,VECTOR4D:16,ICON:17,IMAGE:18,BANNER:19,LOGO:20,STRUCTURE:21,BANNER2:22,ICON_SET:23,SCRIPT:24,EXPRESSION:25,RICHTEXT:26,ARGUMENT:27,JSON_DATA:28,EXPRESSION_EDITOR:29,WIDGET_REFERENCE:30,DOM_PROPERTIES:31,BLOCK_REFERENCE:32,BLOCK_SETTINGS:33,FILE_EDITOR:34,END:35,UNKNOWN:-1};p.ITEM_TYPE={FILE:"BTFILE",WIDGET:"WIDGET",BLOCK:"BLOCK",TEXT:"TEXT",EXPRESSION:"EXPRESSION"};p.EXPRESSION_PARSER||(p.EXPRESSION_PARSER={});p.COMPONENT_NAMES={XIDEVE:"xideve",XNODE:"xnode",
XBLOX:"xblox",XFILE:"xfile",XACE:"xace",XEXPRESSION:"xexpression",XCONSOLE:"xconsole"};p.WIDGET_REFERENCE_MODE={BY_ID:"byid",BY_CLASS:"byclass",BY_CSS:"bycss",BY_EXPRESSION:"expression"};p.VIEW_SPLIT_MODE={DESIGN:1,SOURCE:2,SPLIT_VERTICAL:6,SPLIT_HORIZONTAL:7};p.RESOURCE_VARIABLES={ACE:"ACE",APP_URL:"APP_URL",SITE_URL:"SITE_URL"};p.EVENTS={ERROR:"onError",STATUS:"onStatus",ON_CREATED_MANAGER:"onCreatedManager",ON_ITEM_SELECTED:"onItemSelected",ON_ITEM_REMOVED:"onItemRemoved",ON_ITEM_CLOSED:"onItemClosed",
ON_ITEM_ADDED:"onItemAdded",ON_ITEM_MODIFIED:"onItemModified",ON_NODE_SERVICE_STORE_READY:"onNodeServiceStoreReady",ON_FILE_STORE_READY:"onFileStoreReady",ON_CONTEXT_MENU_OPEN:"onContextMenuOpen",ON_CI_UPDATE:"onCIUpdate",ON_WIDGET_READY:"onWidgetReady",ON_CREATED_WIDGET:"onWidgetCreated",RESIZE:"onResize",ON_MODULE_RELOADED:"onModuleReloaded",ON_MODULE_UPDATED:"onModuleUpdated",ON_DID_OPEN_ITEM:"onDidOpenItem",ON_DID_RENDER_COLLECTION:"onDidRenderCollection",ON_PLUGIN_LOADED:"onPluginLoaded",ON_PLUGIN_READY:"onPluginReady",
ALL_PLUGINS_READY:"onAllPluginsReady",ON_CREATE_EDITOR_BEGIN:"onCreateEditorBegin",ON_CREATE_EDITOR_END:"onCreateEditorEnd",REGISTER_EDITOR:"registerEditor",ON_EXPRESSION_EDITOR_ADD_FUNCTIONS:"onExpressionEditorAddFunctions",ON_ACE_READY:"onACEReady",ON_UNSAVED_CONTENT:"onUnSavedContent",ON_FILE_CHANGED:"fileChanged",ON_FILE_DELETED:"fileDeleted",IMAGE_LOADED:"imageLoaded",IMAGE_ERROR:"imageError",UPLOAD_BEGIN:"uploadBegin",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_FINISH:"uploadFinish",UPLOAD_FAILED:"uploadFailed",
ON_FILE_CONTENT_CHANGED:"onFileContentChanged",ON_COPY_BEGIN:"onCopyBegin",ON_COPY_END:"onCopyEnd",ON_DELETE_BEGIN:"onDeleteBegin",ON_DELETE_END:"onDeleteEnd",ON_MOVE_BEGIN:"onMoveBegin",ON_MOVE_END:"onMoveEnd",ON_CHANGED_CONTENT:"onChangedContent",ON_COMPRESS_BEGIN:"onCompressBegin",ON_COMPRESS_END:"onCompressEnd",ON_COMPONENT_READY:"onComponentReady",ON_ALL_COMPONENTS_LOADED:"onAllComponentsLoaded",ON_APP_READY:"onAppReady",ON_CREATE_STORE:"onCreateStore",ON_STORE_CREATED:"onStoreCreated",ON_STORE_CHANGED:"onStoreChanged",
ON_STATUS_MESSAGE:"onStatusMessage",SAVE_LAYOUT:"layoutSave",RESTORE_LAYOUT:"layoutRestore",ON_SHOW_PANEL:"onShowPanel",ON_PANEL_CLOSED:"onPanelClosed",ON_PANEL_CREATED:"onPanelCreated",ON_MAIN_VIEW_READY:"onMainViewReady",ON_MAIN_MENU_READY:"onMainMenuReady",ON_MAIN_MENU_OPEN:"onMainMenuOpen",ON_VIEW_REMOVED:"onViewRemoved",ON_VIEW_SHOW:"onViewShow",ON_VIEW_HIDE:"onViewHide",ON_VIEW_ADDED:"onViewAdded",ON_OPEN_VIEW:"onOpenView",ON_VIEW_MAXIMIZE_START:"onViewMaximizeStart",ON_VIEW_MAXIMIZE_END:"onViewMaximizeEnd",
ON_CONTAINER_ADDED:"onContainerAdded",ON_CONTAINER_REMOVED:"onContainerRemoved",ON_REMOVE_CONTAINER:"onRemoveContainer",ON_CONTAINER_REPLACED:"onContainerReplaced",ON_CONTAINER_SPLIT:"onContainerSplit"};p.DIALOG_SIZE={SIZE_NORMAL:"size-normal",SIZE_SMALL:"size-small",SIZE_WIDE:"size-wide",SIZE_LARGE:"size-large"};p.DIALOG_TYPE={DEFAULT:"type-default",INFO:"type-info",PRIMARY:"type-primary",SUCCESS:"type-success",WARNING:"type-warning",DANGER:"type-danger"};h.mixin(p,{LAYOUT_RIGHT_CENTER_BOTTOM:"LAYOUT_RIGHT_CENTER_BOTTOM",
LAYOUT_CENTER_BOTTOM:"LAYOUT_CENTER_BOTTOM",LAYOUT_CENTER_RIGHT:"LAYOUT_CENTER_RIGHT",LAYOUT_LEFT_CENTER_RIGHT:"LAYOUT_LEFT_CENTER_RIGHT",LAYOUT_LEFT_CENTER_RIGHT_BOTTOM:"LAYOUT_LEFT_CENTER_RIGHT_BOTTOM"});g.fromJson=function(d,c){var a=null,b=!1;c=!0;try{a=eval("("+d+")")}catch(r){b=!0}if(b){b=d.substring(d.indexOf("{"),d.lastIndexOf("}")+1);try{b&&(a=eval("("+b+")"))}catch(f){!1!==c&&console.error("error in json parsing! "+d);if(-1!==d.indexOf("error"))return{jsonrpc:"2.0",result:{error:{code:1,
message:d,data:null}},id:0};throw Error(d);}}return a};return p})},"xide/utils/ObjectUtils":function(){define(["xide/utils","require","dojo/Deferred","xide/lodash"],function(h,p,n,g){function d(a){var b=parseInt(a,10);return b.toString()===a?b:a}function c(a,b,k,e){g.isNumber(b)&&(b=[b]);if(g.isEmpty(b))return a;if(g.isString(b))return c(a,b.split(".").map(d),k,e);var q=b[0];if(1===b.length)return b=a[q],void 0!==b&&e||(a[q]=k),b;void 0===a[q]&&(g.isNumber(b[1])?a[q]=[]:a[q]={});return c(a[q],b.slice(1),
k,e)}function a(b,c){g.isNumber(c)&&(c=[c]);if(!g.isEmpty(b)){if(g.isEmpty(c))return b;if(g.isString(c))return a(b,c.split("."));var k=d(c[0]),e=b[k];if(1===c.length)void 0!==e&&(g.isArray(b)?b.splice(k,1):delete b[k]);else if(void 0!==b[k])return a(b[k],c.slice(1));return b}}"use strict";h.debounce=function(a,b,c,e,q,l,r){var d=a[b+"_debounced"];d||(d=a[b+"_debounced"]=g.debounce(c,e,q));!0!==l||a[b+"_debouncedFirst"]||(a[b+"_debouncedFirst"]=!0,c.apply(a,r));return d()};h.pluck=function(a,b){return g.map(a,
b)};h.download=function(a,b){var c=document.createElement("a");b=g.isString(b)?b:JSON.stringify(b,null,2);c.setAttribute("href","data:text/plain;charset\x3dutf-8,"+encodeURIComponent(b));c.setAttribute("download",a);c.style.display="none";document.body.appendChild(c);c.click();document.body.removeChild(c)};h.hasObject=function(a){var b=null;try{b=p(a)}catch(c){console.error("error in utils.hasObject ",c)}return b};h.getObject=function(a,b){var c=null;if(h.isString(a)){try{c=p(a)}catch(e){}try{if(!c){var q=
new n,c=p([a],function(a){q.resolve(a)});return q.promise}}catch(l){}return c}return h.isObject(a)?a:null!==c?c:b};h.toArray=function(a){var b=[],c;for(c in a)b.push({name:c,value:a[c]});return b};h.toObject=function(a,b){if(!a)return{};if(!1!==b)return b.object(b.map(a,b.values));if(h.isObject(a)&&a[0])return a[0];for(var c={},e=0;e<a.length;++e)c[e]=a[e];return c};h.byString=function(a,b,c){b=b.replace(/\[(\w+)\]/g,".$1");b=b.replace(/^\./,"");for(b=b.split(".");b.length;)if(c=b.shift(),c in a)a=
a[c];else return;return a};var b=Object.prototype.hasOwnProperty,r={has:function(a,c){if(g.isEmpty(a))return!1;g.isNumber(c)?c=[c]:g.isString(c)&&(c=c.split("."));if(g.isEmpty(c)||0===c.length)return!1;for(var k=0;k<c.length;k++){var e=c[k];if((g.isObject(a)||g.isArray(a))&&b.call(a,e))a=a[e];else return!1}return!0},ensureExists:function(a,b,k){return c(a,b,k,!0)},set:function(a,b,k,e){return c(a,b,k,e)},insert:function(a,b,c,e){var q=r.get(a,b);e=~~e;g.isArray(q)||(q=[],r.set(a,b,q));q.splice(e,
0,c)},empty:function(a,c){if(g.isEmpty(c))return a;if(!g.isEmpty(a)){var k,e;if(!(k=r.get(a,c)))return a;if(g.isString(k))return r.set(a,c,"");if(g.isBoolean(k))return r.set(a,c,!1);if(g.isNumber(k))return r.set(a,c,0);if(g.isArray(k))k.length=0;else if(g.isObject(k))for(e in k)b.call(k,e)&&delete k[e];else return r.set(a,c,null)}},push:function(a,b){var c=r.get(a,b);g.isArray(c)||(c=[],r.set(a,b,c));c.push.apply(c,Array.prototype.slice.call(arguments,2))},coalesce:function(a,b,c){for(var e,q=0,l=
b.length;q<l;q++)if(void 0!==(e=r.get(a,b[q])))return e;return c},get:function(a,b,c){g.isNumber(b)&&(b=[b]);if(g.isEmpty(b))return a;if(g.isEmpty(a)&&a&&null===a.innerHTML)return c;if(g.isString(b))return r.get(a,b.split("."),c);var e=d(b[0]);if(1===b.length){if(a&&void 0===a[e])return c;if(a)return a[e]}return a?r.get(a[e],b.slice(1),c):c},del:function(b,c){return a(b,c)}};h.getAt=function(a,b,c){return r.get(a,b,c)};h.setAt=function(a,b,c){return r.set(a,b,c)};h.hasAt=function(a,b){return r.has(a,
b)};h.ensureAt=function(a,b,c){return r.ensureExists(a,b,c)};h.deleteAt=function(a,b){return r.del(a,b)};h.merge=function(a,b){for(var c in b)"object"!=typeof a[c]?a[c]=b[c]:"object"==typeof b[c]&&(a[c]=h.merge(a[c],b[c]));return a};h.clone=function(a){if(!a||"object"!=typeof a||h.isFunction(a))return a;if(a.nodeType&&"cloneNode"in a)return a.cloneNode(!0);if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return new RegExp(a);var b,c,e;if(h.isArray(a))for(b=[],c=0,e=a.length;c<
e;++c)c in a&&b.push(h.clone(a[c]));else b=a.constructor?new a.constructor:{};return h._mixin(b,a,h.clone)};h._mixin=function(a,b,c){var e,q,l={};for(e in b)q=b[e],e in a&&(a[e]===q||e in l&&l[e]===q)||(a[e]=c?c(q):q);return a};h.mixin=function(a,b){if(b){a||(a={});for(var c=arguments.length,e=1;e<c;e++)h._mixin(a,arguments[e])}return a};h.cloneKeys=function(a,b){var c={},e;for(e in a)if(!0!==b||e in a)c[e]=a[e];return c};h.isArray=function(a){return g.isArray(a)};h.isObject=function(a){return g.isObject(a)};
h.isString=function(a){return g.isString(a)};h.isNumber=function(a){return g.isNumber(a)};h.isFunction=function(a){return g.isFunction(a)};return h})},"xide/utils":function(){define(["dcl/dcl"],function(h){return h(null,{declaredClass:"xide.utils"})})},"xide/lodash":function(){define([],function(){if("undefined"!==typeof _)return _})},"xlog/Server":function(){define(["dcl/dcl","xide/types","xide/factory","dojo/node!winston"],function(h,p,n,g){return h(null,{declaredClass:"xlog.Server",fileLogger:null,
loggly:null,delegate:null,publishLog:!0,loggers:{},constructor:function(d){for(var c in arguments)arguments.hasOwnProperty(c)&&(this[c]=d[c])},createLogger:function(d){var c=new g.Logger({transports:[new g.transports.File(d)]});if(this.publishLog)c.on("logging",function(a,b,c,f){f.logId=d.filename;a={level:b,message:c,data:f,time:(new Date).getTime()};n.publish(p.EVENTS.ON_SERVER_LOG_MESSAGE,a)});return c},start:function(d){this.loggers={};this.options=d;if(d.fileLogger&&(this.fileLogger=g.add(g.transports.File,
d.fileLogger),this.publishLog))this.fileLogger.on("logging",function(c,a,b,r){c={level:a,message:b,data:r,time:(new Date).getTime()};n.publish(p.EVENTS.ON_SERVER_LOG_MESSAGE,c)});d.loggly&&(this.loggly=g.add(g.transports.Loggly,d.loggly));null===d.console&&g.remove(g.transports.Console)}})})},"xide/factory":function(){define(["dcl/dcl"],function(h){return new h(null,{declaredClass:"xide/factory"})})},"nxapp/types":function(){define(["dojo/_base/declare"],function(h){return h("nxapp.types",null,{})})},
"nxapp/utils/FileUtils":function(){define("dojo/_base/json dojo/node!path dojo/node!fs dojo/node!util nxapp/utils xdojo/has!host-node?dojo/node!glob-fs xdojo/has!host-node?dojo/node!glob-base xdojo/has!host-node?dojo/node!glob".split(" "),function(h,p,n,g,d,c,a,b){d.list=function(b){try{var f={},d=a(b);d.base&&(f.cwd=d.base,d.isGlob&&(b=d.glob));var k=(new c).readdirSync(b,f),e=[];_.each(k,function(a){e.push((f.cwd?f.cwd+p.sep:"")+a)})}catch(q){return null}return e};d.__toObject=function(a){try{var b=
n.statSync(a,function(a){}),c=b.isDirectory();return{path:a,sizeBytes:b.size,size:c?"Folder":"",owner:b.uid,group:b.gid,mode:b.mode,isDir:c,directory:c,name:p.win32.basename(a),fileType:c?"folder":"file",modified:b.mtime.getTime()/1E3}}catch(k){return{path:a,sizeBytes:0,size:0,owner:0,group:0,mode:0,directory:!1,mime:"unknown",name:p.win32.basename(a),fileType:"file",modified:0}}};d.ls=function(a){function c(b,q){return b?b=!k||q&&"/"!==q?a.join(q,b):""+b:""}var m={},k="win32"===process.platform;
if("/*"===a&&k){var e=[];flop.read("/",function(a,b){_.each(b.files,function(a){e.push({path:"/"+a.name+":",sizeBytes:0,size:0,owner:0,group:0,mode:0,directory:!0,mime:"unknown",name:a.name,fileType:"folder",modified:0,drive:!0})})})}else{var q="";if(k)if(5===a.length){var l=a.split(":/");2==l.length&&(q=l[0][1]+":/",m={root:q},a="/*")}else l=a.split(":/"),2==l.length&&(q=l[0][1]+":/",m={root:q},a=""+l[1]);m=b.sync(a,m);_.isArray(m)||(m=[m]);e=[];_.each(m,function(a){a=d.__toObject(a);k&&a&&a.path&&
(a.path=p.resolve(c(a.path)));a.realPath=p.resolve(a.path);a&&e.push(a)});return e}};d.resolve=function(a){var b=p.resolve(a);try{if(n.statSync(b))return b}catch(c){return b}try{if(n.statSync(a))return a;var k=process.cwd()+p.sep+a;if(n.statSync(k))return k}catch(e){}return null};d.isDirectory=function(a){return(a=d.resolve(a))&&(a=n.statSync(a))&&a.isDirectory()?!0:!1};d.getExtension=function(a){a=p.extname(a||"").split(".");return a[a.length-1]};d.readFile=function(a){var b=n.statSync(a).size,c=
new Buffer(b);a=n.openSync(a,"r");if(!b)return"";n.readSync(a,c,0,b,0);n.closeSync(a);return c.toString()};d.writeFile=function(a,b){n.writeFile(a,b,function(a){a&&console.log(a)})};d.writeJSONFile=function(a,b){var c=JSON.stringify(b,null,4);n.writeFile(a,c,function(a){a&&console.log(a)})};return d})},"nxapp/utils":function(){define(["dojo/_base/declare"],function(h){return h("nxapp.utils",null,{})})},"xdojo/has":function(){define(["dojo/has"],function(h){return h})},"nxapp/utils/TCPUtils":function(){define(["dojo/node!net",
"nxapp/utils","nxapp/server/WebSocket","nxapp/server/DeviceServer","nxapp/server/FileServer"],function(h,p,n,g,d){p.checkPort=function(c,a,b){var r=new h.Socket,d=null;r.on("connect",function(){d="open";r.end()});r.setTimeout(1500);r.on("timeout",function(){d="closed";r.destroy()});r.on("error",function(a){d="closed"});r.on("close",function(r){b(null,d,a,c)});r.connect(c,a)};p.createSocketServer=function(c,a){var b=new n;b.init({options:{port:c.socket_server.port,context:a,host:c.socket_server.host}});
b.ctx=a;b.start(null,c);return n};p.createDeviceServer=function(c,a){var b=new g;b.init({options:{port:c.socket_server.port,context:a,host:c.socket_server.host}});b.ctx=a;b.start(null,c);return b};p.createFileServer=function(c,a){var b=new d;b.init({options:{port:c.socket_server.port,context:a,host:c.socket_server.host}});b.ctx=a;console.error("create file server "+c.socket_server.host);b.start(null,c);return n};p.connect=function(c,a){};return p})},"nxapp/server/WebSocket":function(){define("dcl/dcl dojo/_base/lang xide/types xide/factory nxapp/server/ServerBase nxapp/utils/_LogMixin nxapp/server/_CommandsParserMixin dojo/node!http dojo/node!sockjs dojo/node!colors xide/utils".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m){var k=!1;return h([d,c,a],{declaredClass:"nxapp.server.WebSocket",_io_socket:null,clients:null,handleManagerCommand:function(a,b){switch(a.manager_command){case n.SOCKET_SERVER_COMMANDS.MANAGER_TEST:console.dir("Test Manager command");break;case n.SOCKET_SERVER_COMMANDS.WATCH:var c=this.ctx.getFileManager();c&&c.watch(a.path,a.watch);break;case n.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH:return this.sendMQTTMessage(a,b);case n.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER:return this.startDriver(a,
b);case n.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES:return this.getVariables(a,b);case n.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE:this.logClientMessage(a);break;case n.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER:this.stopDriver(a);break;case n.SOCKET_SERVER_COMMANDS.MANAGER_STATUS:a={message:"returning status",deviceConnections:this.options.context.getConnectionManager().getNumberOfConnections()};this.emit(n.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,JSON.stringify(a));break;case n.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL:this.options.context.getConnectionManager().closeAll()}},
handleDeviceCommand:function(a,b){var c=a.device_command,r=this.options.context,d=this;k=!1;this.showDebugMsg("socket_server")&&k&&console.log("Handle device command: "+c+" | "+n.SOCKET_SERVER_COMMANDS.CALL_METHOD);console.error("handle device command",a);var f=r.getConnectionManager().connect(a.host,a.protocol,a.port,null,null,b);b||k&&console.error("---have no client connect");try{r.getConnectionManager().registerFeedBack(f,function(b,c){d.profile.debug.debugDevices&&k&&console.log("Data received from "+
b.host);if(_.isString(c))a.lastResponse=""+c;else if(_.isObject(c))try{a.lastResponse=JSON.stringify(c)}catch(q){k&&console.error("error serializing data")}d.onDeviceMessage(b,c)})}catch(m){console.error("-register feed back function failed",m),console.trace()}try{switch(c){case n.SOCKET_SERVER_COMMANDS.CALL_METHOD:this.options.context.getConnectionManager().callMethod(f,a,b);break;case n.SOCKET_SERVER_COMMANDS.DEVICE_SEND:this.options.context.getConnectionManager().send(f,a.command,a.options)}}catch(g){console.error("error command parser "+
c,g)}},broadCastMessage:function(a,b){for(var c=this.clients.length;c--;)if(void 0!==this.clients[c]){var r={event:a,data:b};3===this.clients[c].readyState?(this.clients[c].close(),this.clients.remove(this.clients[c])):(k&&console.log(f.green("writing broadcast message "+r.event+" have "+this.clients.length+" clients  readystate : "+this.clients[c].readyState)),r=JSON.stringify(r),this.clients[c].write(r))}},onFileChanged:function(a){this.broadCastMessage(n.EVENTS.ON_FILE_CHANGED,{path:a.path,type:a.type})},
start:function(a,c){this.profile=c;this.options=p.mixin(this.options,a);this.clients=[];var l=this;console.error("######",c);var d=this.options.port,f=this.options.host;if(d){this.initLogger(c.debug);this.log("Socket server running in "+d,"socket_server");var m={};this.showDebugMsg("socket_server")||(m.log=function(){});var m=r.createServer(m),h=b.createServer(this._handler);m.installHandlers(h);h.listen(d,f);this._handleSocketEmits(m);g.publish(n.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:d,
socket_handler:m}},this);m.on("connection",function(a){var b=l.clients.push(a);a.on("close",function(){k&&console.error("close connection :  "+b);delete l.clients[b]})});return!0}console.error("Port must be provided into options");return!1},emit:function(a,b){console.log("emit + "+this.id+"#"+a,b);this.showDebugMsg("socket_server")&&!_.isString(b)&&_.isObject(b)&&(b=JSON.stringify(b));this.socket?this.socket.write(b):k&&console.error("-------- WebSocket::emit failed. Have no socket! "+a+" id "+this.id)},
_handleSocketEmits:function(a){var b=this.options.port,c=this;a.on("connection",function(a){c.socket=a;k&&console.log("client connected");g.publish(n.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:b,socket_handler:a}},this);a.on("data",function(b){p.isString(b)&&(b=dojo.fromJson(b));b.manager_command?c.handleManagerCommand(b,a):c.handleDeviceCommand(b,a)});a.on("close",function(){console.error("closed!")})})},constructor:function(){this.id=m.createUUID()}})})},"nxapp/server/ServerBase":function(){define(["dcl/dcl",
"xide/model/Base","xide/utils","xide/mixins/EventedMixin"],function(h,p,n,g){return h([p.dcl,g.dcl],{options:null,delegate:null,ctx:null,declaredClass:"nxapp.server.ServerBase",_defaultOptions:function(){return{delegate:this}},init:function(d){this.options=n.mixin(this._defaultOptions(),d.options)}})})},"xide/model/Base":function(){define(["dcl/dcl","dojo/_base/declare","xide/utils"],function(h,p,n){var g={declaredClass:"xide/model/Base",constructor:function(d){n.mixin(this,d)},getLabel:function(){return null},
getID:function(){return null}};p=p("xide/model/Base",null,g);p.dcl=h(null,g);return p})},"xide/mixins/EventedMixin":function(){define("dojo/_base/array dcl/dcl xdojo/declare xdojo/has xide/types xide/factory".split(" "),function(h,p,n,g,d,c){g={_didRegisterSubscribers:!1,subscribers:null,subscribes:{},emits:{},__events:null,addPublishFilter:function(a,b){a&&(null!=b?this.emits[a]=b:a in this.emits&&delete this.emits[a])},filterSubscribe:function(a){return this.subscribes?!1!==this.subscribes[a]:!0},
filterPublish:function(a){return this.emits?!1!==this.emits[a]:!0},subscribe:function(a,b,r){this.__events||(this.__events={});a=c.subscribe(a,b,r||this,this.filterSubscribe.bind(this));b=this.__events;r=0;for(var d=a.length;r<d;r++){var m=a[r].type;b[m]||(b[m]=[]);b[m].push(a[r])}return a},publish:function(a,b,r,d){var m=this;0<d?setTimeout(function(){c.publish(a,b,r||m,m.filterPublish.bind(m))}.bind(m),d):c.publish(a,b,r||m,m.filterPublish.bind(m))},_destroyHandle:function(a){},_destroyHandles:function(){if(this.__events){for(var a in this.__events)h.forEach(this.__events[a],
function(a){a&&a.remove&&a.remove()});delete this.__events}},destroy:function(){this._emit("destroy");this.inherited&&this.inherited(arguments);this._destroyHandles()},once:function(a,b){function c(){d.unsubscribe(a,b);return b.apply(d,arguments)}var d=this;c.listener=b;d._on(a,c);return this},_emit:function(a){if(this.__events){if(!this._didRegisterSubscribers&&this.subscribers){for(var b=0;b<this.subscribers.length;b++){var c=this.subscribers[b];this._on(c.event,c.handler,c.owner)}this._didRegisterSubscribers=
!0}if(!0===arguments[2])throw Error("Please use emit.sticky() instead of passing sticky\x3dtrue for event: "+a);b=this.__events[a];c=1<arguments.length?arguments[2]:null;if(b){var d;if("function"==typeof b)switch(arguments.length){case 1:return b.call(this);case 2:return b.call(this,arguments[1]);case 3:return b.call(this,arguments[1],arguments[2]);default:var m=Array.prototype.slice.call(arguments,1);d=b.apply(this,m)}else if(_.isArray(b))for(var m=Array.prototype.slice.call(arguments,1),k=b.slice(),
e,q=null,l=null,b=0,u=k.length;b<u;b++)q=k[b],l=q.owner||this,m&&m[0]&&(m[0].owner=m[0]?m[0].owner||l:null),q.handler&&(e=q.handler.apply(l,m)),void 0!==e&&(d=e);c&&!0===c["public"]&&this.publish(a,m);return d}}},unsubscribe:function(a,b){if(!this.__events||!this.__events[a])return this;if("function"!==typeof b||!b)return h.forEach(this.__events[a],dojo.unsubscribe),delete this.__events[a],this.__events[a]=[],this;var c=this.__events[a];if(_.isArray(c)){var d=[];_.each(c,function(a,c,e){(a.handler==
b?a.handler:a.handler.listener==b&&a.handler.listener)&&d.push(a)});_.each(d,function(a){a.remove()});0===c.length&&delete this.__events[a]}else(this.__events[a].listener||this.__events[a])===b&&delete this.__events[a];return this},listeners:function(a){this.__events||(this.__events={});this.__events[a]||(this.__events[a]=[]);isArray(this.__events[a])||(this.__events[a]=[this.__events[a]]);return this.__events[a]},addHandle:function(a,b){this.__events||(this.__events={});this.__events[a]||(this.__events[a]=
[]);b.type=a;this.__events[a].push(b);return b},__on:function(a,b,c,d){var m=d;"function"!=typeof c||d||(d=c,c=null);a=a.jquery?a:$(a);a.on(b,c,d);this.__events||(this.__events={});this.__events[b]||(this.__events[b]=[]);var k=this.__events[b];a={handler:m,owner:this,type:b,element:a,selector:c,remove:function(){k.remove(this);this.element.off(this.type,this.selector,this.handler)}};k.push(a);return a},_on:function(a,b,c){try{this.__events||(this.__events={});this.__events[a]||(this.__events[a]=[]);
var d=this.__events[a];if(!d)this.__events[a]=b;else if(_.isArray(d)){if(-1!=d.indexOf(b))return console.warn("adding same listener twice",a);b={handler:b,owner:c||this,type:a,remove:function(){d.remove(this);c&&c.__events&&c.__events[a]&&c.__events[a].remove(this);this.handler=this.owner=null;delete this.type}};d.push(b);return b}}catch(m){logError(m)}return this}};n=n(null,g);n.Impl=g;n.dcl=p(null,g);p.chainAfter(n.dcl,"destroy");return n})},"xdojo/declare":function(){define(["dojo/_base/declare"],
function(h){return h})},"nxapp/utils/_LogMixin":function(){define(["dcl/dcl"],function(h){return h(null,{declaredClass:"nxapp.utils._LogMixin",debug_conf:null,logger:null,initLogger:function(h){this.debug_conf=h},log:function(h,n,g,d){n||(n=this._debugContext().main);n&&!this.showDebugMsg(n)||!this.logger||(g=g||"info",d.time=(new Date).getTime(),this.logger.log(g,h,d))},logEx:function(h,n,g,d){this.logger?(n=n||"info",d=d||{},d.type=g||"Unknown",d.time=d.time||(new Date).getTime(),this.logger.log(n,
h,d)):console.error("have no logger!")},showDebugMsg:function(h){if(null!=this.debug_conf)return this.debug_conf.all?!0:this.debug_conf[h]?!0:!1;this.debug_conf={all:!0};return!0}})})},"nxapp/server/_CommandsParserMixin":function(){define(["dcl/dcl","nxapp/types/Types","nxapp/utils/_console"],function(h,p,n){var g=!1;return h(null,{declaredClass:"nxapp.server._CommandsParserMixin",handleManagerCommand:function(d,c){switch(d.manager_command){case p.SOCKET_SERVER_COMMANDS.MANAGER_TEST:console.dir("Test Manager command");
break;case p.SOCKET_SERVER_COMMANDS.WATCH:var a=this.ctx.getFileManager();a&&a.watch(d.path,d.watch);break;case p.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH:return this.sendMQTTMessage(d,c);case p.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER:return this.startDriver(d,c);case p.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES:return this.getVariables(d,c);case p.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE:this.logClientMessage(d);break;case p.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER:this.stopDriver(d);break;case p.SOCKET_SERVER_COMMANDS.MANAGER_STATUS:d=
{message:"returning status",deviceConnections:this.options.context.getConnectionManager().getNumberOfConnections()};this.emit(p.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,JSON.stringify(d));break;case p.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL:this.options.context.getConnectionManager().closeAll()}},handleDeviceCommand:function(d,c){var a=d.device_command,b=this.options.context,r=this;g=!1;this.showDebugMsg("socket_server")&&g&&console.log("Handle device command: "+a+" | "+p.SOCKET_SERVER_COMMANDS.CALL_METHOD);
console.error("handle device command",d);var f=b.getConnectionManager().connect(d.host,d.protocol,d.port,null,null,c);c||g&&console.error("---have no client connect");try{b.getConnectionManager().registerFeedBack(f,function(a,b){r.profile.debug.debugDevices&&g&&console.log("Data received from "+a.host);if(_.isString(b))d.lastResponse=""+b;else if(_.isObject(b))try{d.lastResponse=JSON.stringify(b)}catch(c){g&&console.error("error serializing data")}r.onDeviceMessage(a,b)})}catch(m){console.error("-register feed back function failed",
m),console.trace()}try{switch(a){case p.SOCKET_SERVER_COMMANDS.CALL_METHOD:this.options.context.getConnectionManager().callMethod(f,d,c);break;case p.SOCKET_SERVER_COMMANDS.DEVICE_SEND:this.options.context.getConnectionManager().send(f,d.command,d.options)}}catch(k){console.error("error command parser "+a,k)}}})})},"nxapp/types/Types":function(){define(["dojo/_base/lang","xide/types/Types","xcf/types/Types"],function(h,p){h.mixin(p.EVENTS,{ON_FILE_CHANGED:"fileChanged",ON_CONNECTION_CREATED:"connectionCreated",
ON_CONNECTION_ERROR:"connectionError",ON_WEBSOCKET_START:"webSocketStart",ON_WEBSOCKET_CONNECTION:"webSocketConnection",ON_MQTT_MESSAGE:"onMQTTMessage",ON_DEVICE_MESSAGE:"onDeviceMessage",ON_COMMAND_FINISH:"onCommandFinish",ON_COMMAND_ERROR:"onCommandError",ON_DEVICE_DISCONNECTED:"onDeviceDisconnected",ON_DEVICE_CONNECTED:"onDeviceConnected",STORE_CHANGED:"storeChange",BEFORE_STORE_CHANGE:"beforeStoreChange",STORE_REFRESHED:"storeRefreshed",ON_DID_OPEN_ITEM:"onDidOpenItem",ON_SHOW_PANEL:"onShowPanel",
ITEM_SELECTED:"itemSelected",ERROR:"fileOperationError",STATUS:"fileOperationStatus",IMAGE_LOADED:"imageLoaded",IMAGE_ERROR:"imageError",RESIZE:"resize",UPLOAD_BEGIN:"uploadBegin",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_FINISH:"uploadFinish",ON_CLIPBOARD_COPY:"onClipboardCopy",ON_CLIPBOARD_PASTE:"onClipboardPaste",ON_CLIPBOARD_CUT:"onClipboardCut",ON_CONTEXT_MENU_OPEN:"onContextMenuOpen",ON_PLUGIN_LOADED:"onPluginLoaded",ON_PLUGIN_READY:"onPluginReady",ON_MAIN_VIEW_READY:"onMainViewReady2",REGISTER_EDITOR:"registerEditor",
REGISTER_ACTION:"registerAction",ON_FILE_CONTENT_CHANGED:"onFileContentChanged",ON_PANEL_CLOSED:"onPanelClosed",ON_PANEL_CREATED:"onPanelCreated",SET_DEVICE_VARIABLES:"setDeviceVariables"});p.LOG_CONTEXT={DEVICE:"Device"};p.test=2;return p})},"xcf/types/Types":function(){define("xaction/types xide/types/Types xide/types xide/utils/ObjectUtils xide/utils xide/utils/HexUtils".split(" "),function(h,p,n,g,d,c){String.prototype.setBytes||(String.prototype.setBytes=function(a){this.bytes=a});String.prototype.getBytes||
(String.prototype.getBytes=function(){return this.bytes?this.bytes:c.stringToBuffer(this)});String.prototype.getString||(String.prototype.getString=function(){return this.string});String.prototype.setString||(String.prototype.setString=function(a){this.string=a});String.prototype.hexString||(String.prototype.hexString=function(){var a=this.getBytes();return c.bufferToHexString(a)});n.VARIABLE_FLAGS={PUBLISH:2,PUBLISH_IF_SERVER:4};n.LOGGING_FLAGS={NONE:0,GLOBAL_CONSOLE:1,STATUS_BAR:2,POPUP:4,FILE:8,
DEV_CONSOLE:16,DEVICE_CONSOLE:32};d.mixin(n.ITEM_TYPE,{DEVICE:"Device",DEVICE_GROUP:"Device Group",DRIVER:"Driver",DRIVER_GROUP:"Driver Group",PROTOCOL:"Protocol",PROTOCOL_GROUP:"Protocol Group"});n.SERVICE_STATUS={OFFLINE:"offline",ONLINE:"online",TIMEOUT:"timeout"};n.PROTOCOL={TCP:"tcp",UDP:"udp",SERIAL:"serial",DRIVER:"driver",SSH:"ssh",MQTT:"mqtt"};d.mixin(n.EVENTS,{ON_DEBUGGER_READY:"onDebuggerReady",ON_DEVICE_SELECTED:"onDeviceSelected",ON_DEVICE_GROUP_SELECTED:"onDeviceGroupSelected",ON_PROTOCOL_SELECTED:"onProtocolSelected",
ON_PROTOCOL_GROUP_SELECTED:"onProtocolGroupSelected",ON_PROTOCOL_CHANGED:"onProtocolChanged",ON_MQTT_MESSAGE:"onMQTTMessage",ON_DEVICE_MESSAGE:"onDeviceMessage",ON_DEVICE_MESSAGE_EXT:"onDeviceMessageExt",ON_COMMAND_FINISH:"onCommandFinish",ON_COMMAND_PROGRESS:"onCommandProgress",ON_COMMAND_PAUSED:"onCommandPaused",ON_COMMAND_STOPPED:"onCommandStopped",ON_COMMAND_ERROR:"onCommandError",ON_DEVICE_DISCONNECTED:"onDeviceDisconnected",ON_DEVICE_CONNECTED:"onDeviceConnected",ON_DEVICE_COMMAND:"onDeviceCommand",
ON_DEVICE_STATE_CHANGED:"onDeviceStateChanged",ON_DEVICE_DRIVER_INSTANCE_READY:"onDeviceDriveInstanceReady",ON_DRIVER_SELECTED:"onDriverSelected",ON_DRIVER_GROUP_SELECTED:"onDriverGroupSelected",ON_DRIVER_VARIABLE_ADDED:"onDriverVariableAdded",ON_DRIVER_VARIABLE_REMOVED:"onDriverVariableRemoved",ON_DRIVER_VARIABLE_CHANGED:"onDriverVariableChanged",ON_DRIVER_COMMAND_ADDED:"onDriverCommandAdded",ON_DRIVER_COMMAND_REMOVED:"onDriverCommandRemoved",ON_DRIVER_COMMAND_CHANGE:"onDriverVariableChanged",ON_SCOPE_CREATED:"onScopeCreated",
ON_DRIVER_MODIFIED:"onDriverModified",SET_DEVICE_VARIABLES:"setDeviceVariables",ON_SERVER_LOG_MESSAGE:"onServerLogMessage",ON_CLIENT_LOG_MESSAGE:"onClientLogMessage",ON_DEVICE_SERVER_CONNECTED:"onDeviceServerConnected",ON_RUN_CLASS_EVENT:"onRunClassEvent"});n.MESSAGE_SOURCE={DEVICE:"DEVICE",GUI:"GUI",BLOX:"BLOX",CODE:"CODE"};n.DEVICE_STATE={CONNECTING:"DeviceIsConnecting",CONNECTED:"DeviceIsConnected",SYNCHRONIZING:"DeviceIsSynchronizing",READY:"DeviceIsReady",DISCONNECTED:"DeviceIsDisconnected",
DISABLED:"DeviceIsDisabled",LOST_DEVICE_SERVER:"LostDeviceServerConnection"};n.DRIVER_PROPERTY={CF_DRIVER_NAME:"CF_DRIVER_NAME",CF_DRIVER_ICON:"CF_DRIVER_ICON",CF_DRIVER_CLASS:"CF_DRIVER_CLASS",CF_DRIVER_ID:"CF_DRIVER_ID",CF_DRIVER_COMMANDS:"CF_DRIVER_COMMANDS",CF_DRIVER_VARIABLES:"CF_DRIVER_VARIABLES",CF_DRIVER_RESPONSES:"CF_DRIVER_RESPONSES"};n.PROTOCOL_PROPERTY={CF_PROTOCOL_TITLE:"Title",CF_PROTOCOL_ICON:"CF_PROTOCOL_ICON",CF_PROTOCOL_CLASS:"CF_PROTOCOL_CLASS",CF_PROTOCOL_ID:"CF_PROTOCOL_ID",CF_PROTOCOL_COMMANDS:"CF_PROTOCOL_COMMANDS",
CF_PROTOCOL_VARIABLES:"CF_PROTOCOL_VARIABLES",CF_PROTOCOL_RESPONSES:"CF_PROTOCOL_RESPONSES"};n.DEVICE_PROPERTY={CF_DEVICE_DRIVER:"Driver",CF_DEVICE_HOST:"Host",CF_DEVICE_PORT:"Port",CF_DEVICE_PROTOCOL:"Protocol",CF_DEVICE_TITLE:"Title",CF_DEVICE_ID:"Id",CF_DEVICE_ENABLED:"Enabled",CF_DEVICE_OPTIONS:"Options",CF_DEVICE_DRIVER_OPTIONS:"DriverOptions",CF_DEVICE_LOGGING_FLAGS:"Logging Flags"};n.LOG_OUTPUT={DEVICE_CONNECTED:"Device Connected",DEVICE_DISCONNECTED:"Device Disonnected",RESPONSE:"Response",
SEND_COMMAND:"Send Command",DEVICE_ERROR:"Device Error"};n.DEFAULT_DEVICE_LOGGING_FLAGS={};h=n.LOGGING_FLAGS;n.DEFAULT_DEVICE_LOGGING_FLAGS[n.LOG_OUTPUT.DEVICE_CONNECTED]=h.GLOBAL_CONSOLE|h.POPUP|h.STATUS_BAR|h.DEVICE_CONSOLE;n.DEFAULT_DEVICE_LOGGING_FLAGS[n.LOG_OUTPUT.DEVICE_DISCONNECTED]=h.GLOBAL_CONSOLE|h.POPUP|h.STATUS_BAR|h.DEVICE_CONSOLE;n.DEFAULT_DEVICE_LOGGING_FLAGS[n.LOG_OUTPUT.RESPONSE]=h.DEVICE_CONSOLE|h.GLOBAL_CONSOLE;n.DEFAULT_DEVICE_LOGGING_FLAGS[n.LOG_OUTPUT.SEND_COMMAND]=h.DEVICE_CONSOLE|
h.GLOBAL_CONSOLE;n.DEFAULT_DEVICE_LOGGING_FLAGS[n.LOG_OUTPUT.DEVICE_ERROR]=h.GLOBAL_CONSOLE|h.POPUP|h.STATUS_BAR|h.DEV_CONSOLE|h.DEVICE_CONSOLE;n.DRIVER_FLAGS={RUNS_ON_SERVER:2,DEBUG:4,SERVER:16};d.mixin(n.ITEM_TYPE,{CF_DRIVER_VARIABLE:"DriverVariable",CF_DRIVER_BASIC_COMMAND:"DriverBasicCommand",CF_DRIVER_CONDITIONAL_COMMAND:"DriverConditionalCommand",CF_DRIVER_RESPONSE_VARIABLE:"DriverResponseVariable"});n.BLOCK_GROUPS={CF_DRIVER_VARIABLE:"DriverVariable",CF_DRIVER_BASIC_COMMAND:"DriverBasicCommand",
CF_DRIVER_CONDITIONAL_COMMAND:"DriverConditionalCommand",CF_DRIVER_RESPONSE_VARIABLE:"DriverResponseVariable",CF_DRIVER_RESPONSE_BLOCKS:"conditionalProcess",CF_DRIVER_RESPONSE_VARIABLES:"processVariables",CF_DRIVER_BASIC_VARIABLES:"basicVariables"};n.COMMAND_TYPES={BASIC_COMMAND:"basic",CONDITIONAL_COMMAND:"conditional",INIT_COMMAND:"init"};d.mixin(n.ECIType,{DEVICE_NETWORK_SETTINGS:n.ECIType.END+1,DRIVER_COMMAND_SETTINGS:"CommandSettings"});n.VFS_ROOTS={SYSTEM_DRIVERS:"system_drivers",USER_DRIVERS:"user_drivers"};
n.SOCKET_SERVER_COMMANDS={SIGNAL_MANAGER:"Manager_command",RUN_FILE:"Run_File",RUN_CLASS:"Run_Class",SIGNAL_DEVICE:"Device_command",SIGNAL_RESPONSE:"WebSocket_response",MANAGER_TEST:"Manager_Test",MANAGER_CLOSE_ALL:"Close_All_Connections",MANAGER_STATUS:"status",MANAGER_START_DRIVER:"startDriver",START_DEVICE:"startDevice",STOP_DEVICE:"stopDevice",CREATE_CONNECTION:"createConnection",MANAGER_STOP_DRIVER:"stopDriver",DEVICE_SEND:"Device_Send",CALL_METHOD:"Call_Method",RUN_SHELL:"Run_Shell",WATCH:"Watch_Directory",
MQTT_PUBLISH:"MQTT_PUBLISH",MQTT_SUBSCRIBE:"MQTT_SUBSCRIBE",GET_DEVICE_VARIABLES:"getVariables",WRITE_LOG_MESSAGE:"Write_Log_Message",INIT_DEVICES:"INIT_DEVICES"};return n})},"xaction/types":function(){define(["xide/types","dojo/_base/lang"],function(h,p){p.mixin(h.EVENTS,{ON_ACTION_CHANGE_CONTEXT:"onChangeActionContext",ON_ACTION_CONTEXT_CHANGED:"onActionContextChanged",REGISTER_ACTION:"registerAction",SET_ITEM_ACTIONS:"onSetItemsActions",ON_CLIPBOARD_COPY:"onClipboardCopy",ON_CLIPBOARD_PASTE:"onClipboardPaste",
ON_CLIPBOARD_CUT:"onClipboardCut",ON_RENDER_ACTIONS:"onRenderActions",ON_DID_ACTION:"onDidAction",ON_AFTER_ACTION:"onAfterAction"});h.ACTION={LAYOUT:"View/Layout",COLUMNS:"View/Columns",SELECTION:"File/Select",CLIPBOARD:"Edit/Clipboard",UNDO:"Edit/Undo",REDO:"Edit/Redo",CLIPBOARD_COPY:"Edit/Clipboard/Copy",CLIPBOARD_PASTE:"Edit/Clipboard/Paste",CLIPBOARD_CUT:"Edit/Clipboard/Cut",COPY:"File/Copy",MOVE:"File/Move",RENAME:"File/Rename",DELETE:"File/Delete",OPEN:"File/Open",EDIT:"File/Edit",SAVE:"File/Save",
SEARCH:"File/Search",TOOLBAR:"View/Show/Toolbar",STATUSBAR:"View/Show/Statusbar",BREADCRUMB:"View/Show/Breadcrumb",HEADER:"View/Show/Header",DOWNLOAD:"File/Download",DOWNLOAD_TO:"File/downloadTo",INFO:"File/Info",COMPRESS:"File/Compress",RELOAD:"File/Reload",UPLOAD:"File/Upload",PREVIEW:"File/Preview",OPEN_IN:"File/Open In",INSERT_IMAGE:"insertImage",COPY_PASTE:"copypaste",DND:"dnd",OPTIONS:"options",NEW_FILE:"File/New/New File",NEW_DIRECTORY:"File/New/New Folder",GET_CONTENT:"get",SET_CONTENT:"set",
FIND:"File/Find",CUSTOM:"custom",PERMA_LINK:"permaLink",ADD_MOUNT:"ADD_MOUNT",REMOVE_MOUNT:"REMOVE_MOUNT",EDIT_MOUNT:"EDIT_MOUNT",PERSPECTIVE:"PERSPECTIVE",RUN:"File/Run",GO_UP:"Navigation/Go Up",STOP:"File/Stop",CLOSE:"View/Close",FULLSCREEN:"View/Fullscreen",OPEN_IN_TAB:"File/OpenInNewTab",SOURCE:"Navigation/Source",RIBBON:"View/Show/Ribbon",MAIN_MENU:"View/Show/MainMenu",NAVIGATION:"View/Show/Navigation",BASH_CONSOLE:"File/Console/Bash",JS_CONSOLE:"File/Console/JS",PHP_CONSOLE:"File/Console/PHP",
CONSOLE:"File/Console/PHP",SIZE_STATS:"View/Show/SizeStats",WELCOME:"Window/Welcome",CONTEXT_MENU:"File/ContextMenu"};h.ACTION_TYPE={MULTI_TOGGLE:"multiToggle",SINGLE_TOGGLE:"singleToggle"};h.ACTION_ICON={CLIPBOARD_COPY:"fa-copy",CLIPBOARD_PASTE:"fa-paste",UPLOAD:"fa-upload",RENAME:"el-icon-edit",DELETE:"text-danger fa-remove",RELOAD:"fa-refresh",EDIT:"fa-pencil",SAVE:"fa-floppy-o",SEARCH:"fa-search",NEW_DIRECTORY:"fa-magic",NEW_FILE:"fa-magic",RUN:"text-success el-icon-play",COMPRESS:"fa-file-archive-o",
EXTRACT:"fa-folder-open",DOWNLOAD:"fa-download",GO_UP:"fa-level-up",TOOLBAR:"fa-bars",STATUSBAR:"fa-terminal",PREVIEW:"fa-eye",MAXIMIZE:"fa-arrows-alt",UNDO:"fa-undo",REDO:"fa-repeat"};return h})},"xide/utils/HexUtils":function(){define(["xide/utils","xide/types","dojo/json","xide/lodash"],function(h,p,n,g){function d(b){var c="";b=parseInt(b,16);65535>=b?c+=String.fromCharCode(b):1114111>=b?(b-=65536,c+=String.fromCharCode(55296|b>>10)+String.fromCharCode(56320|b&1023)):c+="hex2Char error: Code point out of range: "+
a(b);return c}function c(b){var c="";65535>=b?c+=String.fromCharCode(b):1114111>=b?(b-=65536,c+=String.fromCharCode(55296|b>>10)+String.fromCharCode(56320|b&1023)):c+="dec2char error: Code point out of range: "+a(b);return c}function a(a){return(a+0).toString(16).toUpperCase()}function b(a){return A[a>>4&15]+A[a&15]}function r(a){return a=a.replace(/0x([A-Fa-f0-9]{1,4})(\s)?/g,function(a,b){d(b);return d(b)})}function f(a){a=a.replace(/[Uu]\+10([A-Fa-f0-9]{4})/g,function(a,b){return d("10"+b)});return a=
a.replace(/[Uu]\+([A-Fa-f0-9]{1,5})/g,function(a,b){return d(b)})}function m(a){return a=a.replace(/&#x([A-Fa-f0-9]{1,6});/g,function(a,b){return d(b)})}function k(a){return a=a.replace(/&#([0-9]{1,7});/g,function(a,b){return c(b)})}function e(a){return a=a.replace(/0x([A-Fa-f0-9]{1,6})/g,function(a,b){return d(b)})}function q(a,b){b?(a=a.replace(/\\([A-Fa-f0-9]{1,6})(\s)?/g,function(a,b){return d(b)}),a=a.replace(/\\/g,"")):a=a.replace(/\\([A-Fa-f0-9]{2,6})(\s)?/g,function(a,b){return d(b)});return a}
function l(a,b){a=a.replace(/\\u\{([A-Fa-f0-9]{1,})\}/g,function(a,b){return d(b)});a=a.replace(/\\U([A-Fa-f0-9]{8})/g,function(a,b){return d(b)});a=a.replace(/\\u([A-Fa-f0-9]{4})/g,function(a,b){return d(b)});b&&(a=a.replace(/\\b/g,"\b"),a=a.replace(/\\t/g,"\t"),a=a.replace(/\\n/g,"\n"),a=a.replace(/\\v/g,"\v"),a=a.replace(/\\f/g,"\f"),a=a.replace(/\\r/g,"\r"),a=a.replace(/\\\'/g,"'"),a=a.replace(/\\\"/g,'"'),a=a.replace(/\\\\/g,"\\"));return a}function u(b){return b=b.replace(/((%[A-Fa-f0-9]{2})+)/g,
function(b,q){for(var e="",l=0,k=0,d=q.split("%"),r=1;r<d.length;r++){var f=parseInt(d[r],16);switch(l){case 0:0<=f&&127>=f?e+=c(f):192<=f&&223>=f?(l=1,k=f&31):224<=f&&239>=f?(l=2,k=f&15):240<=f&&247>=f?(l=3,k=f&7):e+="convertpEsc2Char: error "+a(f)+"! ";break;case 1:if(128>f||191<f)e+="convertpEsc2Char: error "+a(f)+"! ";l--;e+=c(k<<6|f-128);k=0;break;case 2:case 3:if(128>f||191<f)e+="convertpEsc2Char: error "+a(f)+"! ";k=k<<6|f-128;l--}}return e})}function v(a){var b={};return a=a.replace(/&([A-Za-z0-9]+);/g,
function(a,c){return c in b?b[c]:a})}function t(a,b){"hex"==b?a=a.replace(/(\b[A-Fa-f0-9]{2,6}\b)/g,function(a,b){return d(b)}):"dec"==b?a=a.replace(/(\b[0-9]+\b)/g,function(a,b){return c(b)}):"utf8"==b?a=a.replace(/(( [A-Fa-f0-9]{2})+)/g,function(a,b){return y(b)}):"utf16"==b&&(a=a.replace(/(( [A-Fa-f0-9]{1,6})+)/g,function(a,b){return w(b)}));return a}function y(b){var q="",e=0,l=0;b=b.replace(/^\s+/,"");b=b.replace(/\s+$/,"");if(0==b.length)return"";b=b.replace(/\s+/g," ");b=b.split(" ");for(var k=
0;k<b.length;k++){var d=parseInt(b[k],16);switch(e){case 0:0<=d&&127>=d?q+=c(d):192<=d&&223>=d?(e=1,l=d&31):224<=d&&239>=d?(e=2,l=d&15):240<=d&&247>=d?(e=3,l=d&7):q+="convertUTF82Char: error1 "+a(d)+"! ";break;case 1:if(128>d||191<d)q+="convertUTF82Char: error2 "+a(d)+"! ";e--;q+=c(l<<6|d-128);l=0;break;case 2:case 3:if(128>d||191<d)q+="convertUTF82Char: error3 "+a(d)+"! ";l=l<<6|d-128;e--}}return q.replace(/ $/,"")}function w(b){var q=0,e="";b=b.replace(/^\s+/,"");b=b.replace(/\s+$/,"");if(0==b.length)return null;
b=b.replace(/\s+/g," ");b=b.split(" ");for(var l=0;l<b.length;l++){var k=parseInt(b[l],16);if(0>k||65535<k)e+="!Error in convertUTF162Char: unexpected value, b\x3d"+a(k)+"!";if(0!=q)if(56320<=k&&57343>=k){e+=c(65536+(q-55296<<10)+(k-56320));q=0;continue}else e+="Error in convertUTF162Char: low surrogate expected, b\x3d"+a(k)+"!",q=0;55296<=k&&56319>=k?q=k:e+=c(k)}return e}var A="0123456789ABCDEF".split("");h.dec2hex4=function(a){return A[a>>12&15]+A[a>>8&15]+A[a>>4&15]+A[a&15]};h.dec2hex=a;h.dec2char=
c;h.dec2hex2=b;h.convertUTF82Char=y;h.convertUTF162Char=w;h.convertUnicode2Char=f;h.convertCharStr2pEsc=function(c){var q="",e;e=0;for(var l="",k=0;k<c.length;k++){var d=c.charCodeAt(k);if(0>d||65535<d)l+="Error in convertChar2CP: byte out of range "+a(d)+"!";if(0!=e)if(56320<=d&&57343>=d){l+=a(65536+(e-55296<<10)+(d-56320))+" ";e=0;continue}else l+="Error in convertChar2CP: surrogate out of range "+a(e)+"!",e=0;55296<=d&&56319>=d?e=d:l+=a(d)+" "}e=l.substring(0,l.length-1);if(0==c.length)return"";
c=e.split(" ");for(e=0;e<c.length;e++)l=parseInt(c[e],16),q=32==l?q+"%20":65<=l&&90>=l?q+String.fromCharCode(l):97<=l&&122>=l?q+String.fromCharCode(l):48<=l&&57>=l?q+String.fromCharCode(l):45==l||46==l||95==l||126==l?q+String.fromCharCode(l):127>=l?q+("%"+b(l)):2047>=l?q+("%"+b(192|l>>6&31)+"%"+b(128|l&63)):65535>=l?q+("%"+b(224|l>>12&15)+"%"+b(128|l>>6&63)+"%"+b(128|l&63)):1114111>=l?q+("%"+b(240|l>>18&7)+"%"+b(128|l>>12&63)+"%"+b(128|l>>6&63)+"%"+b(128|l&63)):q+("!Error "+a(l)+"!");return q};h.convertAllEscapes=
function(a,b){a=f(a);a=r(a);a=e(a);a=m(a);a=k(a);a=l(a,!1);a=q(a,!1);a=u(a);a=v(a);return a=t(a,b)};var z="0123456789abcdef".split("");h.to_hex=function(a){for(var b="",c=!0,q=32;0<q;){var q=q-4,e=a>>q&15;c&&0==e||(c=!1,b+=z[e])}return"0x"+(""==b?"0":b)};h.replaceHex=function(a){return g.isString(a)?a.replace(/x([0-9A-Fa-f]{2})/gmi,function(a,b){return String.fromCharCode(parseInt(b,16))}):a};var G=function(a,b){for(a=a.toString(16).toUpperCase();a.length<b;)a="0"+a;return a};h.stringToHex=function(a){for(var b=
"",c=0,q=a.length,e;c<q;c+=1)e=a.charCodeAt(c),b+=G(e.toString(16),2)+" ";return b};h.stringToBufferStr=function(a){for(var b=0,c=a.length,q,e=[];b<c;b+=1)q=a.charCodeAt(b),e.push(q);return e.join(",")};h.stringToBuffer=function(a){for(var b=0,c=a.length,q,e=[];b<c;b+=1)q=a.charCodeAt(b),e.push(q);return e};h.bufferToHexString=function(a){a=-1!==a.indexOf(",")?a.split(","):[a];for(var b=[],c=0;c<a.length;c++)b.push(h.dec2hex2(a[c]));return b.join(" ")};h.bufferFromDecString=function(a){a=-1!==a.indexOf(",")?
a.split(","):[a];for(var b=0;b<a.length;b++)a[b]=parseInt(a[b],10);return a};h.stringFromDecString=function(a){a=h.bufferFromDecString(a);for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c],16);return b};h.stringToHex2=function(a){for(var b="",c=0,q=a.length,e;c<q;c+=1)e=a.charCodeAt(c),b+=G(e.toString(16),2)+" ";return b};h.hexToString=function(a){a=a.split(" ");for(var b="",c=0,q=a.length,e;c<q;c+=1)e=String.fromCharCode(parseInt(a[c],16)),b+=e;return b};h.prettyHex=function(a){var b=Math.ceil(a.length/
16),c=a.length%16||16,q=a.length.toString(16).length;6>q&&(q=6);for(var e="Offset";e.length<q;)e+=" ";var e="\u001b[36m"+e+"  ",l;for(l=0;16>l;l++)e+=" "+G(l,2);e+="\u001b[0m\n";a.length&&(e+="\n");var k=0,d,r;for(l=0;l<b;l++){e+="\u001b[36m"+G(k,q)+"\u001b[0m  ";d=l===b-1?c:16;r=16-d;var f;for(f=0;f<d;f++)e+=" "+G(a[k],2),k++;for(f=0;f<r;f++)e+="   ";k-=d;e+="   ";for(f=0;f<d;f++)r=a[k],e+=31<r&&127>r||159<r?String.fromCharCode(r):".",k++;e+="\n"}return e};h.hexEncode=function(a,b){var c,q,e="";
for(q=0;q<a.length;q++)c=a.charCodeAt(q).toString(16),e+=((null!==b?b:"000")+c).slice(-4);return e};h.markHex=function(a,b,c,q){b=b||"";c=c||"";var e=""+a;a=/[^\x20-\x7E]/gim;a.exec(e);e.match(a);e.replace(a,function(a,q){var l=h.hexEncode(a,"$");2==l.length&&(l=l.replace("$","$0"));l=l.toUpperCase();e=e.replace(a,b+l+c)});return e};return h})},"nxapp/utils/_console":function(){define(["dojo/has!host-node?dojo/node!tracer","dojo/has!host-node?dojo/node!util","nxapp/utils"],function(h,p,n){var g=g;
h&&(g=h.colorConsole({format:"\x3c{{title}}\x3e {{message}} (in {{file}}:{{line}})",dateformat:"HH:MM:ss.L"}));"undefined"==typeof logError&&(global.logError=function(d,c){g.error("Error "+c,d)});n.stack=function(){g.log(Error().stack)};g.clear=function(){p.print("\u001b[2J\u001b[0;0H")};return g})},"nxapp/server/DeviceServer":function(){define("dcl/dcl dojo/_base/lang xide/types xide/factory nxapp/server/WebSocket dojo/node!http dojo/node!sockjs dojo/node!path dojo/node!fs-jetpack nxapp/utils/_console xide/utils nxapp/model/Connection".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m,k){var e=!1;return h([d],{mqttManager:null,declaredClass:"nxapp.server.DeviceServer",handleManagerCommand:function(a,b){switch(a.manager_command){case n.SOCKET_SERVER_COMMANDS.MANAGER_TEST:f.dir("Test Manager command");break;case n.SOCKET_SERVER_COMMANDS.RUN_SHELL:return this.ctx.getDeviceManager().runShell(a.cmd,a.args,a.options);case n.SOCKET_SERVER_COMMANDS.RUN_FILE:return this.ctx.runFile(a);case n.SOCKET_SERVER_COMMANDS.INIT_DEVICES:return this.ctx.loadDevices(a);
case n.SOCKET_SERVER_COMMANDS.RUN_CLASS:return this.ctx.runClass(a);case n.SOCKET_SERVER_COMMANDS.WATCH:var c=this.ctx.getFileManager();c&&c.watch(a.path,a.watch);break;case n.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH:return this.sendMQTTMessage(a,b);case n.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER:return this.startDriver(a,b);case n.SOCKET_SERVER_COMMANDS.CREATE_CONNECTION:return this.createConnection(a,b);case n.SOCKET_SERVER_COMMANDS.START_DEVICE:return this.startDevice(a,b);case n.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES:return this.getVariables(a,
b);case n.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE:this.logClientMessage(a);break;case n.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER:this.stopDriver(a);break;case n.SOCKET_SERVER_COMMANDS.MANAGER_STATUS:a={message:"returning status",deviceConnections:this.options.context.getConnectionManager().getNumberOfConnections()};this.emit(n.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,JSON.stringify(a));break;case n.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL:this.options.context.getConnectionManager().closeAll()}},
handleDeviceCommand:function(a,b){var c=a.device_command,k=this.options.context,d=this;e=!1;var r=a.options,g=null;b||e&&f.error("---have no client ");r.host&&r.protocol?g=k.getConnectionManager().connect(r.host,r.protocol,r.port||"",null,r,b):f.error("handle device command: invalid args. data.options is not xide/types/DeviceInfo",m.inspect(a));try{g&&(g.options=r,k.getConnectionManager().registerFeedBack2(g,function(b,c){if(_.isString(c))a.lastResponse=""+c;else if(_.isObject(c))try{a.lastResponse=
JSON.stringify(c)}catch(l){e&&f.error("error serializing data")}d.onDeviceMessage(b,c)}))}catch(h){f.error("-register feed back function failed",h),f.trace(h)}try{switch(c){case n.SOCKET_SERVER_COMMANDS.CALL_METHOD:this.options.context.getConnectionManager().callMethod(g,a,b);break;case n.SOCKET_SERVER_COMMANDS.DEVICE_SEND:this.options.context.getConnectionManager().send(g,a.command,a.options)}}catch(z){f.error("error command parser "+c,z.stack)}},sendMQTTMessage:function(a,b){var c=a.data.device;
a.data.sourceHost=b.remoteAddress;a.data.sourcePort=b.remotePort;if(c){if((c=this.ctx.getConnectionManager().getConnection2(c))&&c.variables){var e=a.topic.split("/");if(4==e.length&&"Variable"==e[2]){e=e[3];if(!e)return;for(var k=0;k<c.variables.length;k++){var d=c.variables[k];d.name===e&&(d.value=a.data.value)}}}}else f.error("cant find device");this.mqttManager&&this.mqttManager.publishTopic(a.topic,a.data)},updateDeviceState:function(a,b){this.mqttManager&&this.mqttManager.publishTopic(a,b)},
sendClientMessage:function(a,b,c,e){b={data:m.mixin({device:b},e),event:c};a.write(JSON.stringify(b))},getVariables:function(a,b){var c=a.device,e=this.ctx.getConnectionManager().getConnection2(c),k=[];if(e){e.options=c;var d=e.variables;d?(k=d,this.sendClientMessage(b,c,n.EVENTS.SET_DEVICE_VARIABLES,{variables:d})):(k=e.variables=a.variables,_.each(k,function(a){a.value=a.initial}),this.sendClientMessage(b,c,n.EVENTS.SET_DEVICE_VARIABLES,{variables:a.variables}))}else f.error("cant find device connection");
if((e=b.mqtt)&&!e.didSubscribe)for(d=0;d<k.length;d++)e.subscribe(c.host+"/"+c.port+"/Variable/"+k[d].name)},logClientMessage:function(a){var b=a.data.device;a.data.device?this.logEx(a.message,a.level,a.type,{device:b,deviceMessage:"",time:a.time}):f.error("wrong log parameters, host missing",a)},getLogger:function(a){var c=this.ctx.getLogManager(),e=c.options,k=m.replaceAll("/","_",a.host)+"_"+a.port+"_"+a.protocol+".json",d=c.loggers[k],e=(a=a[a.deviceScope])?r.dir(a+b.sep+"logs").path():e.fileLogger.dirname;
d||(d=c.createLogger({filename:k,dirname:e,json:!0,console:null}),c.loggers[k]=d);return d},logEx:function(a,b,c,e){var k=this.getLogger(e.device);b=b||"info";e=e||{};e.type=c||"Unknown";e.time=e.time||(new Date).getTime();k.log(b,a,e)},stopDriver:function(a){var b=this.ctx.getConnectionManager(),c=this.ctx.getDeviceManager(),d=b.getConnection2(a);d&&(d.options=a,d.client.close());b.removeConnection(d,null,!0);!d&&e&&f.log("have no such connection "+k.generateId(a));c.stopDevice(a.id)},sendClientEvent:function(a){},
startDriver:function(a,b){var c=this.ctx.getConnectionManager(),d=this.ctx.getDeviceManager(),r=c.getConnection2(a),m=a.driverOptions&1<<n.DRIVER_FLAGS.RUNS_ON_SERVER,g=a.driverOptions&1<<n.DRIVER_FLAGS.SERVER;e&&f.log("start driver "+a.host+" : "+a.port+"@"+a.protocol+" server side \x3d "+m+" device Scope "+a.deviceScope+" is server \x3d "+g+" found connection:"+(r?"true":"false")+" external client "+b.isExternal());if(m&&m&&!r)if(d&&d.startDevice||f.error("!deviceManager || !startDevice"),m=d.getItemById(a.id)){if(g=
d.toDeviceControlInfo(m))return d.startDevice(m,!0),!0;g&&e&&f.log("driver runs server side, start device! "+g.toString())}else{f.warn("DeviceServer::startDriver : cant find device");return}if(!r)return e&&f.log("start driver: connection doesnt exists "+a.host+" : "+a.port+"@"+a.protocol+" : "+a.deviceScope+" id : "+k.generateId(a)),a[a.driverScope]?c.connect(a.host,a.protocol,a.port,a.mqtt,a,b):(f.error("have no driver scope"),null);r.options=a;c.onConnect2(r,!0,!0);if(!a.deviceScope)throw f.error("has no device scope",
a),Error("has no device scope",a);return"xxxx"},startDevice:function(a,b){var c=this.ctx.getDeviceManager(),k=this.ctx.getConnectionManager(),d=a.driverOptions&1<<n.DRIVER_FLAGS.RUNS_ON_SERVER,r=a.driverOptions&1<<n.DRIVER_FLAGS.SERVER;e&&f.log("start device "+a.host+" : "+a.port+"@"+a.protocol+" server side \x3d "+d+" device Scope "+a.deviceScope+" is server \x3d "+r+" external client "+b.isExternal());if(d=c.getItemById(a.id)){if(r=c.toDeviceControlInfo(d))return c.startDevice(d,null,b).then(function(){var b=
k.getConnection2(a);if(b)k.onConnect2(b,!0,!0);else f.error("DeviceServer::startDevice : cant find connection")}),!0;r&&e&&f.log("driver runs server side, start device! "+r.toString())}else f.warn("Cant find device")},createConnection:function(a,b){var c=this.ctx.getConnectionManager(),d=c.getConnection2(a),r=a.driverOptions&1<<n.DRIVER_FLAGS.RUNS_ON_SERVER,m=a.driverOptions&1<<n.DRIVER_FLAGS.SERVER;e&&f.log("createConnection "+a.host+" : "+a.port+"@"+a.protocol+" server side \x3d "+r+" device Scope "+
a.deviceScope+" is server \x3d "+m+" found connection:"+(d?"true":"false")+" | is external client:"+b.isExternal());if(!d)return e&&f.log("createConnection: connection doesnt exists "+a.host+" : "+a.port+"@"+a.protocol+" : "+a.deviceScope+" id : "+k.generateId(a)),a[a.driverScope]?c.connect(a.host,a.protocol,a.port,a.mqtt,a,b):(f.error("have no driver scope"),null);d.options=a;c.onConnect2(d,!0,!0);if(!a.deviceScope)throw f.error("has no device scope",a),Error("has no device scope",a);return d},onFileChanged:function(a){this.broadCastMessage(n.EVENTS.ON_FILE_CHANGED,
{path:a.path,event:a.event})},onDeviceMessage:function(a,b,c){if(a)if(null===b)e&&f.error("---onDeviceMessage:have no data "+a.options.id+" server id \x3d "+k.generateId(a.options));else{c={device:a.options,deviceMessage:b,bytes:c&&c.join?c.join(","):""};var d=b.event||n.EVENTS.ON_DEVICE_MESSAGE;if(a&&a.isRunAsServer()&&d===n.EVENTS.ON_DEVICE_MESSAGE)this.ctx.getDeviceManager().onDeviceServerMessage({event:n.EVENTS.ON_DEVICE_MESSAGE,data:{data:c}});else this.broadCastMessage(b.event||n.EVENTS.ON_DEVICE_MESSAGE,
c)}else f.error("---onDeviceMessage:have no connection object")},onLogMessage:function(a){this.broadCastMessage(n.EVENTS.ON_SERVER_LOG_MESSAGE,a)},onClientDisconnect:function(a){a.mqtt&&(a.mqtt.end(),delete a.mqtt)},onClientConnection:function(a){if(this.mqttManager){var b=this;if(!a)e&&f.error("DeviceServer::onClientConnection connection null");else if(!a.mqtt){var c=this.mqttManager.createMQTTClient(a.remoteAddress,a.remotePort);c.client=a;a.mqtt=c;c.on("message",function(c,e){e.sourceHost!==a.remoteAddress&&
e.sourcePort!==a.remotePort&&b.sendClientMessage(a,{},n.EVENTS.ON_MQTT_MESSAGE,{topic:c,message:e.toString(),host:a.remoteAddress,port:a.remotePort})})}}},start:function(b,l){this.profile=l;this.options=p.mixin(this.options,b);this.clients=[];var k=this,d=this.options.port,r=this.options.host;this.subscribe(n.EVENTS.ON_SERVER_LOG_MESSAGE,this.onLogMessage,this);if(d){this.initLogger(l.debug);this.log("Socket server running in "+d,"socket_server");var m={heartbeat_delay:1E3};e||(m.log=function(){});
var m=a.createServer(m),g=c.createServer(this._handler);m.installHandlers(g);g.listen(d,r);this._handleSocketEmits(m);this.publish(n.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:d,socket_handler:m}},this);m.on("connection",function(a){var b=k.clients.push(a);e&&f.log("on device server client connection "+b);k.onClientConnection(a);a.isExternal=function(){return!0};a.on("close",function(){e&&f.info("close client connection "+b);k.onClientDisconnect(a);k.clients.remove(a)})});return!0}f.error("Port must be provided into options");
return!1},_handleSocketEmits:function(a){var b=this.options.port,c=this;a.on("connection",function(a){c.socket=a;g.publish(n.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:b,socket_handler:a}},this);a.on("data",function(b){_.isString(b)&&(b=m.fromJson(b));b.manager_command?c.handleManagerCommand(b,a):c.handleDeviceCommand(b,a)})})}})})},"nxapp/model/Connection":function(){define("dcl/dcl xide/model/Base xide/mixins/EventedMixin xide/encoding/MD5 xide/utils xide/types".split(" "),function(h,p,n,
g,d,c){function a(a,r){var f=a[a.deviceScope],m=a[a.driverScope];if(!f&&r){var k=r.ctx.getDeviceManager();if(k){var e=k.getDeviceById(a.id);e&&(m=k.toDeviceControlInfo(e),f=m[m.deviceScope],m=m[m.driverScope])}}f=d.replaceAll("/","",f+m);f=d.replaceAll("\\","",f);return g(JSON.stringify({protocol:a.protocol,port:a.port,host:a.host,hash:f,isServer:a.driverOptions&1<<c.DRIVER_FLAGS.SERVER,runAsServer:a.driverOptions&1<<c.DRIVER_FLAGS.RUNS_ON_SERVER}),1)}h=h([n.dcl],{connected:!1,__registered:!1,declaredClass:"nxapp/model/Connection",
client:null,options:null,socket:null,id:null,toString:function(){var a=this.options;return a.deviceScope+"://"+a.host+":"+a.port+"@"+a.protocol+"@"+(this.isServer()?"server":"")},constructor:function(b,c){this.client=b;this.options=c;d.mixin(this,{protocol:c.protocol,port:c.port,host:c.host});this.id=a(c);b.connection=this},isServer:function(){return this.options.driverOptions&1<<c.DRIVER_FLAGS.SERVER},isRunAsServer:function(){return this.options.driverOptions&1<<c.DRIVER_FLAGS.RUNS_ON_SERVER}});
h.generateId=a;h.generateHash=function(a){var r=d.replaceAll("/","",a[a.deviceScope]+a[a.driverScope]),r=d.replaceAll("\\","",r);return{protocol:a.protocol,port:a.port,host:a.host,hash:r,isServer:a.driverOptions&1<<c.DRIVER_FLAGS.SERVER,runAsServer:a.driverOptions&1<<c.DRIVER_FLAGS.RUNS_ON_SERVER}};return h})},"xide/encoding/MD5":function(){define(["./_base"],function(h){function p(a,c){return a<<c|a>>>32-c}function n(a,c,d,m,k,e){return h.addWords(p(h.addWords(h.addWords(c,a),h.addWords(m,e)),k),
d)}function g(a,c,d,m,k,e,q){return n(c&d|~c&m,a,c,k,e,q)}function d(a,c,d,m,k,e,q){return n(c&m|d&~m,a,c,k,e,q)}function c(a,c,d,m,k,e,q){return n(d^(c|~m),a,c,k,e,q)}function a(a,r){a[r>>5]|=128<<r%32;a[(r+64>>>9<<4)+14]=r;for(var f=1732584193,m=-271733879,k=-1732584194,e=271733878,q=0;q<a.length;q+=16)var l=f,u=m,v=k,t=e,f=g(f,m,k,e,a[q+0],7,-680876936),e=g(e,f,m,k,a[q+1],12,-389564586),k=g(k,e,f,m,a[q+2],17,606105819),m=g(m,k,e,f,a[q+3],22,-1044525330),f=g(f,m,k,e,a[q+4],7,-176418897),e=g(e,f,
m,k,a[q+5],12,1200080426),k=g(k,e,f,m,a[q+6],17,-1473231341),m=g(m,k,e,f,a[q+7],22,-45705983),f=g(f,m,k,e,a[q+8],7,1770035416),e=g(e,f,m,k,a[q+9],12,-1958414417),k=g(k,e,f,m,a[q+10],17,-42063),m=g(m,k,e,f,a[q+11],22,-1990404162),f=g(f,m,k,e,a[q+12],7,1804603682),e=g(e,f,m,k,a[q+13],12,-40341101),k=g(k,e,f,m,a[q+14],17,-1502002290),m=g(m,k,e,f,a[q+15],22,1236535329),f=d(f,m,k,e,a[q+1],5,-165796510),e=d(e,f,m,k,a[q+6],9,-1069501632),k=d(k,e,f,m,a[q+11],14,643717713),m=d(m,k,e,f,a[q+0],20,-373897302),
f=d(f,m,k,e,a[q+5],5,-701558691),e=d(e,f,m,k,a[q+10],9,38016083),k=d(k,e,f,m,a[q+15],14,-660478335),m=d(m,k,e,f,a[q+4],20,-405537848),f=d(f,m,k,e,a[q+9],5,568446438),e=d(e,f,m,k,a[q+14],9,-1019803690),k=d(k,e,f,m,a[q+3],14,-187363961),m=d(m,k,e,f,a[q+8],20,1163531501),f=d(f,m,k,e,a[q+13],5,-1444681467),e=d(e,f,m,k,a[q+2],9,-51403784),k=d(k,e,f,m,a[q+7],14,1735328473),m=d(m,k,e,f,a[q+12],20,-1926607734),f=n(m^k^e,f,m,a[q+5],4,-378558),e=n(f^m^k,e,f,a[q+8],11,-2022574463),k=n(e^f^m,k,e,a[q+11],16,1839030562),
m=n(k^e^f,m,k,a[q+14],23,-35309556),f=n(m^k^e,f,m,a[q+1],4,-1530992060),e=n(f^m^k,e,f,a[q+4],11,1272893353),k=n(e^f^m,k,e,a[q+7],16,-155497632),m=n(k^e^f,m,k,a[q+10],23,-1094730640),f=n(m^k^e,f,m,a[q+13],4,681279174),e=n(f^m^k,e,f,a[q+0],11,-358537222),k=n(e^f^m,k,e,a[q+3],16,-722521979),m=n(k^e^f,m,k,a[q+6],23,76029189),f=n(m^k^e,f,m,a[q+9],4,-640364487),e=n(f^m^k,e,f,a[q+12],11,-421815835),k=n(e^f^m,k,e,a[q+15],16,530742520),m=n(k^e^f,m,k,a[q+2],23,-995338651),f=c(f,m,k,e,a[q+0],6,-198630844),e=
c(e,f,m,k,a[q+7],10,1126891415),k=c(k,e,f,m,a[q+14],15,-1416354905),m=c(m,k,e,f,a[q+5],21,-57434055),f=c(f,m,k,e,a[q+12],6,1700485571),e=c(e,f,m,k,a[q+3],10,-1894986606),k=c(k,e,f,m,a[q+10],15,-1051523),m=c(m,k,e,f,a[q+1],21,-2054922799),f=c(f,m,k,e,a[q+8],6,1873313359),e=c(e,f,m,k,a[q+15],10,-30611744),k=c(k,e,f,m,a[q+6],15,-1560198380),m=c(m,k,e,f,a[q+13],21,1309151649),f=c(f,m,k,e,a[q+4],6,-145523070),e=c(e,f,m,k,a[q+11],10,-1120210379),k=c(k,e,f,m,a[q+2],15,718787259),m=c(m,k,e,f,a[q+9],21,-343485551),
f=h.addWords(f,l),m=h.addWords(m,u),k=h.addWords(k,v),e=h.addWords(e,t);return[f,m,k,e]}h.MD5=function(b,c){var d=c||h.outputTypes.Base64,m=a(h.stringToWord(b),8*b.length);switch(d){case h.outputTypes.Raw:return m;case h.outputTypes.Hex:return h.wordToHex(m);case h.outputTypes.String:return h.wordToString(m);default:return h.wordToBase64(m)}};h.MD5._hmac=function(b,c,d){d=d||h.outputTypes.Base64;var m=h.stringToWord(c);16<m.length&&(m=a(m,8*c.length));var k=[];c=[];for(var e=0;16>e;e++)k[e]=m[e]^
909522486,c[e]=m[e]^1549556828;b=a(k.concat(h.stringToWord(b)),512+8*b.length);b=a(c.concat(b),640);switch(d){case h.outputTypes.Raw:return b;case h.outputTypes.Hex:return h.wordToHex(b);case h.outputTypes.String:return h.wordToString(b);default:return h.wordToBase64(b)}};return h.MD5})},"xide/encoding/_base":function(){define(["dojo/_base/lang"],function(h){return{outputTypes:{Base64:0,Hex:1,String:2,Raw:3},addWords:function(h,n){var g=(h&65535)+(n&65535);return(h>>16)+(n>>16)+(g>>16)<<16|g&65535},
stringToWord:function(h){for(var n=[],g=0,d=8*h.length;g<d;g+=8)n[g>>5]|=(h.charCodeAt(g/8)&255)<<g%32;return n},wordToString:function(h){for(var n=[],g=0,d=32*h.length;g<d;g+=8)n.push(String.fromCharCode(h[g>>5]>>>g%32&255));return n.join("")},wordToHex:function(h){for(var n=[],g=0,d=4*h.length;g<d;g++)n.push("0123456789abcdef".charAt(h[g>>2]>>g%4*8+4&15)+"0123456789abcdef".charAt(h[g>>2]>>g%4*8&15));return n.join("")},wordToBase64:function(h){for(var n=[],g=0,d=4*h.length;g<d;g+=3)for(var c=(h[g>>
2]>>g%4*8&255)<<16|(h[g+1>>2]>>(g+1)%4*8&255)<<8|h[g+2>>2]>>(g+2)%4*8&255,a=0;4>a;a++)8*g+6*a>32*h.length?n.push("\x3d"):n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>6*(3-a)&63));return n.join("")},stringToUtf8:function(h){for(var n="",g=-1,d,c;++g<h.length;)d=h.charCodeAt(g),c=g+1<h.length?h.charCodeAt(g+1):0,55296<=d&&56319>=d&&56320<=c&&57343>=c&&(d=65536+((d&1023)<<10)+(c&1023),g++),127>=d?n+=String.fromCharCode(d):2047>=d?n+=String.fromCharCode(192|d>>>
6&31,128|d&63):65535>=d?n+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|d&63):2097151>=d&&(n+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63));return n}}})},"nxapp/server/FileServer":function(){define("dojo/_base/declare dojo/_base/lang xide/types xide/factory nxapp/server/WebSocket nxapp/utils/_LogMixin dojo/node!http dojo/node!sockjs".split(" "),function(h,p,n,g,d,c,a,b){return h("nxapp.server.WebSocket",[d,c],{onFileChanged:function(a){this.broadCastMessage(n.EVENTS.ON_FILE_CHANGED,
{path:a.path,modulePath:a.modulePath,mask:a.mask,type:a.type})},start:function(c,d){this.profile=d;this.options=p.mixin(this.options,c);this.clients=[];var m=this;g.subscribe(n.EVENTS.ON_FILE_CHANGED,this.onFileChanged,this);var k=this.options.port,e=this.options.host;if(k){this.initLogger(d.debug);this.log("File Socket server running in "+k,"socket_server");var q={};this.showDebugMsg("socket_server")||(q.log=function(){});var q=b.createServer(q),l=a.createServer(this._handler);q.installHandlers(l);
l.listen(k,e);this._handleSocketEmits(q);g.publish(n.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:k,socket_handler:q}},this);q.on("connection",function(a){var b=m.clients.push(a);a.on("close",function(){delete m.clients[b]})});return!0}console.error("Port must be provided into options");return!1},_handleSocketEmits:function(a){var b=this.options.port,c=this;a.on("connection",function(a){c.socket=a;g.publish(n.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:b,socket_handler:a}},this);a.on("close",
function(){})})}})})},"nxappmain/nxAppBase":function(){define("dcl/dcl nxapp/utils/FileUtils dojo/node!commander dojo/node!fs dojo/node!os dojo/node!path dojo/node!util xide/factory/Events dojo/has xide/model/Base xide/utils".split(" "),function(h,p,n,g,d,c,a,b,r,f,m){r.add("windows",function(){return"win32"===d.platform()});r.add("osx",function(){return"darwin"===d.platform()});r.add("linux",function(){return"linux"===d.platform()});r.add("arm",function(){return"arm"===d.arch()});return h(f.dcl,
{declaredClass:"nxappmain.nxAppBase",profile:null,commander:null,profilePath:"/nxappmain/profile_device_server.json",getDefaultProfilePath:function(){return process.cwd()+this.profilePath},getProfile:function(a){var b={};a||(a=this.commander.profile&&0<this.commander.profile.length?this.commander.profile:this.getDefaultProfilePath());g.existsSync(a)||(a=process.cwd()+this.profilePath);var c=p.readFile(a);c?b=dojo.fromJson(c):console.error("have no profile at : "+a);if(c=(c=this.commander.system)?
p.resolve(c):null)b.data=c,b.watchr.paths=[c+a.sep+"system",c+a.sep+"workspace"];return b},init:function(){this.commander||(n.version("0.0.1").option("-i, --info","return service profile").option("-f, --file \x3cpath\x3e","run a file").option("-u, --user \x3cpath\x3e","user directory").option("--diagnose \x3cboolean\x3e","do some diagnose").option("--modules","list all modules").option("--start \x3cboolean\x3e","start devices").option("--serverSide \x3cboolean\x3e","make devices server side").option("-s, --system \x3cname\x3e",
"path to system scope").option("-j, --jhelp","output options as json").option("-t, --test","enable test mode").option("--mqtt \x3cboolean\x3e","enable or disable MQTT functionality"),this.commander=n,this.commander.allowUnknownOption(!0),this.commander.parse(process.argv));if(n.jhelp){var a=[];n.options.map(function(b){a.push(b)});console.log(JSON.stringify(a));process.exit()}this.profile=this.getProfile(this.profilePath);m.mixin(this.profile,this.commander);var b=c.resolve(this.profile.system);g.existsSync(b)||
(b=process.cwd()+"/data/system",this.profile.system=b,n.system=b);this.profile.user&&(b=c.resolve(this.profile.user),g.existsSync(b)&&(this.profile.user=b));this.commander.start&&(this.profile.start="true"===this.commander.start);this.commander.serverSide&&(this.profile.serverSide="true"===this.commander.serverSide)}})})},"xide/factory/Events":function(){define(["xide/factory","dojo/_base/connect","dojo/_base/lang","dojo/on","dojo/has"],function(h,p,n,g,d){var c={click:null,dblclick:null,mousedown:null,
mouseup:null,mouseover:null,mousemove:null,mouseout:null,keypress:null,keydown:null,keyup:null,focus:null,blur:null,change:null};h.publish=function(a,b,c,d){b=b?_.isString(b)?{message:b}:b:{};c=a;var m=p.publish,k=[];_.isArray(a)||(c=[a]);a=0;for(var e=c.length;a<e;a++){var q=c[a];if(!d||d(q))k=m(q,b)}return k};h.subscribe=function(a,b,d,f){var m=a,k=p.subscribe,e=[];_.isArray(a)||(m=[a]);a=0;for(var q=m.length;a<q;a++)if(m[a]&&(!f||f(v))){var l=m[a],u=_.isString(l),v=u?l:l.key,l=u?b:l.handler,u=
v in c;null!=d?(l=null!=l?l:d[v],u=u?g(d,v,n.hitch(d,l)):k(v,n.hitch(d,l)),u.handler=n.hitch(d,l)):(u=p.subscribe(v,l),u.handler=l);u.type=v;e.push(u)}return e};return h})},"nxapp/manager/Context":function(){define("dcl/dcl ./ConnectionManager xide/manager/ContextBase require nxapp/utils/_console xide/types xide/utils dojo/node!path".split(" "),function(h,p,n,g,d,c,a,b){return h(n,{declaredClass:"nxapp.manager.Context",connectionManager:null,blockManager:null,deviceServer:null,logManager:null,loadDevices:function(a){d.log("load devices",
a);var c=this.getDeviceManager(),m=this.getDriverManager();c.debug();var k=c.getStores()[a.scope],e=a.path;k?k.connected?d.warn("store "+k.scope+" is already connected"):d.info("connecting store "+k.scope):(d.info("connecting store "+a.scope),m.createStore({items:this.getDrivers(b.resolve(e+"/drivers"),"user_drivers")},"user_drivers",!0),c.initStore({items:this.getDevices(b.resolve(e+"/devices"),"user_devices")},"user_devices",!0))},runFile:function(a){d.log("run file",a)},broadCastMessage:function(b,
d){this.getDeviceServer().broadCastMessage(c.EVENTS.ON_RUN_CLASS_EVENT,a.mixin({event:c.EVENTS.ON_RUN_CLASS_EVENT},d))},runClass:function(a){var b=a["class"],c=this;try{g([b],function(e){e=new e(a.args);try{e.run({data:a,clear:function(){this.data.progress=null;this.data.finish=null;this.data.error=null;this.data.data=null},onProgress:function(a,b){this.clear();this.data.progress=a;this.data.data=b;c.broadCastMessage(null,this.data)},onFinish:function(a,b){this.clear();this.data.finish=a;this.data.data=
b;c.broadCastMessage(null,this.data)},onError:function(a,b){this.clear();this.data.error=a;this.data.data=b;c.broadCastMessage(null,this.data)}})}catch(q){d.error("error running class "+b,q),a.error=q.message,c.broadCastMessage(null,a)}})}catch(k){d.error("error loading class "+b,k)}},getDeviceServer:function(){return this.deviceServer},getConnectionManager:function(){return this.connectionManager},initManagers:function(a){this.connectionManager.init(a)},constructManagers:function(){this.connectionManager=
new p({ctx:this})},getLogManager:function(){return this.logManager}})})},"nxapp/manager/ConnectionManager":function(){define("dcl/dcl nxapp/manager/ManagerBase nxapp/utils/_LogMixin nxapp/protocols/Tcp nxapp/protocols/Udp nxapp/protocols/Driver nxapp/protocols/SSH nxapp/protocols/Serial nxapp/protocols/MQTT nxapp/protocols/ProtocolBase nxapp/types/Types xide/factory xide/utils nxapp/utils/_console xide/data/_Base nxapp/model/Connection xide/data/TreeMemory xide/data/ObservableStore dstore/Trackable dojo/_base/declare".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m,k,e,q,l,u,v,t,y,w){return h([p,n],{declaredClass:"nxapp.manager.ConnectionManager",options:null,profile:null,lastUpTime:null,mqttManager:null,pool:[],poolNotFound:-1,store:null,onWakeup:function(){this.lastUpTime=(new Date).getTime();for(var a=0;a<this.pool.length;a++){var b=this.pool[a];b.socket&&b.socket.close&&b.socket.close();b.socket&&b.socket._socket&&b.socket._socket.close&&b.socket._socket.close()}this.pool=[]},init:function(a){this.profile=a;this.initLogger(a.debug);
this.lastUpTime=(new Date).getTime();this.store=new (w("nxapp.data.Store",[v,y,t],{}))({idProperty:"id",Model:u});var b=this;setInterval(function(){var a=(new Date).getTime();if(3E3<a-b.lastUpTime)b.onWakeup();b.lastUpTime=a},1E3)},connect:function(e,l,f,v,h,t){if(!e)return q.error("ConnectionManager::connect : have no host"),null;if(!l)return q.error("ConnectionManager::connect : have no protocol"),null;if(!h)return q.error("ConnectionManager::connect : have no options"),null;t=u.generateId(h,this);
if(t=this.store.getSync(t)){if(!t.isServer()&&!t.isRunAsServer())this.onConnect2(t,!0,!0);return t}var y=t=null;switch(l){case m.PROTOCOL.TCP:t=new g({owner:this,options:h,delegate:this});break;case m.PROTOCOL.UDP:t=new d({owner:this,options:h,delegate:this});break;case m.PROTOCOL.DRIVER:t=new c({owner:this,options:h,delegate:this});break;case m.PROTOCOL.SSH:t=new a({owner:this,options:h,delegate:this});break;case m.PROTOCOL.SERIAL:t=new b({owner:this,options:h,delegate:this});break;case m.PROTOCOL.MQTT:t=
new r({owner:this,options:h,delegate:this})}if(t){e=this.addConnection2(t,h);t.init();t.connection=e;y=t.connect();e.socket=y;k.publish(m.EVENTS.ON_CONNECTION_CREATED,{connection:e},this);if(this.mqttManager)this.mqttManager.onConnectedToDevice(h,t,v);return e}k.publish(m.EVENTS.ON_CONNECTION_ERROR,{connection:{port:f,host:e,protocol:l}},this);return!1},send:function(a,b,c){if(a){var e=a.client;if(e){var l=e._socket;a.client||q.error("connection has no client");if(l){if(!l.writable)return q.error("socket not writable, closing connection"+
a.lastError),this.close(a,!0),!1}else return q.error("have no socket"),!1;a&&a.options&&this.logEx(m.LOG_OUTPUT.SEND_COMMAND+" : "+b,"info","server",m.LOG_OUTPUT.SEND_COMMAND,a);return e.send(b,c)}q.error("send "+b+" have no client")}else q.error("send "+b+" have no connection")},callMethod:function(a,b){b=e.getJson(b);var c=b.method,l=b.args;if(a)if(a.client){if(a.client[c])return a.client[c].apply(a.client,[l,b]);q.error("no such method "+c)}else q.error("call method : connection has no client object");
else q.error("call method : invalid connection")},close:function(a){if(a){a._destroyed=!0;var b=a.client._socket;a.client=null;b&&b._socket&&b._socket.close&&b._socket.close()}},closeAll:function(){var a=this;this.forEachPool(function(b,c){a.close(c)});this.clearPool()},onTimeout:function(a){},onClose:function(a,b){a&&a.options&&(this.logEx(m.LOG_OUTPUT.DEVICE_DISCONNECTED,"info","server",m.LOG_OUTPUT.DEVICE_DISCONNECTED,a),this.publish(m.EVENTS.ON_DEVICE_DISCONNECTED,{device:a.options,connection:a}));
a._destroyed=!0;this.removeConnection(a,b)},onDrain:function(a){},onError:function(a,b,c){c&&q.log(" Error: "+c.host+":"+c.port+"@"+c.protocol,b);a&&(a.lastError=b);this.removeConnection(a,c)},onFinish:function(a,b,c){b=this.connectionExists(a.host,a.port,a.protocol);b!=this.poolNotFound?this.callFeedBack(b,data):q.error("ConnectionManager::onData : cant find pool - reference:"+b+":"+a.host+":"+a.port+":"+a.protocol)},onData:function(a,b,c){try{this.callFeedBack2(a,b,c)}catch(e){q.error("call feedback error : "+
e.message),q.log(e.stack)}a&&a.options&&this.logEx(m.LOG_OUTPUT.RESPONSE+":"+b,"info","server",m.LOG_OUTPUT.RESPONSE,a)},hasFlag:function(a,b){var c=m.LOGGING_FLAGS,l=a.loggingFlags,l=_.isString(l)?e.fromJson(l):l||{},l=l[b];return null!=l&&l&c.FILE?!0:!1},onConnect2:function(a,b,c){if(a.connected){b={device:a.options,isReplay:c};var e=this.ctx.getDeviceServer();this.getConnection2(a.options);e.broadCastMessage(m.EVENTS.ON_DEVICE_CONNECTED,b);this.publish(m.EVENTS.ON_DEVICE_CONNECTED,{device:a.options,
isReplay:c,connection:a});a&&!a.__registered&&(this.registerFeedBack2(a,function(a,b,c){b&&(b.lastResponse=_.isString(b)?b:JSON.stringify(b,null,2));e.onDeviceMessage(a,b,c)}),a.__registered=!0);a&&a.options&&!c&&this.logEx(m.LOG_OUTPUT.ON_DEVICE_CONNECTED,"info","server",m.LOG_OUTPUT.ON_DEVICE_CONNECTED,a);if(a.client&&a.client.onConnect)a.client.onConnect();return a}},logEx:function(a,b,c,e,l){var q=this.ctx.getDeviceServer();if(l&&l.options){var d=l.options;this.hasFlag(d,e)&&q.logEx(a+" "+l.toString(),
b||"info",c||"server",{device:d})}},_onConnect:function(a,b,c,e){q.log("Connected to "+e.declaredClass+":"+a+":"+b+" via "+c+" : ",e.options);if(!e.options)throw q.error("have no options: ",e),Error("Asdf");a={device:{host:a,port:b,protocol:c,options:e?e.options:null}};this.ctx.getDeviceServer().broadCastMessage(m.EVENTS.ON_DEVICE_CONNECTED,a);var l=this.ctx.getDeviceServer();e&&(e.__registered?q.error("already registered"):(this.registerFeedBack2(connection,function(a,b,c){b.lastResponse=""+b;l.onDeviceMessage(a,
b)}),e.__registered=!0))},onHandle:function(a,b){},getNumberOfConnections:function(){return this.pool.length},getDeviceConnection:function(){if(this.getNumberOfConnections())for(var a=0;a<this.pool.length;a++);},addConnection:function(a,b,c,e,l,d,q,k){q=new u(q,a,k);this.store.putSync(q);this.pool.push({socket:a,host:b,port:c,protocol:e,user:l,customFields:d,feedbackTo:[]});return q},addConnection2:function(a,b){var c=new u(a,b);return this.store.putSync(c)},removeConnection:function(a,b,c){var e=
this;a&&(a=this.getConnection2(a.options));a&&(a=this.getConnection2(a.options),this.ctx.getDeviceServer()&&setTimeout(function(){var b={device:a.options,error:a.lastError,stopped:c};e.ctx.getDeviceServer().broadCastMessage(m.EVENTS.ON_DEVICE_DISCONNECTED,b)},1E3),this.store.removeSync(a.id),a._destroyed=!0)},clearPool:function(){this.pool=[]},getConnection:function(a){if(3==arguments.length){for(var b=arguments[0],c=arguments[1],e=arguments[2],l=0;l<this.pool.length;l++){var q=this.pool[l];if(q.host==
b&&q.port==e&&q.protocol==c)return q}return null}return this.pool[a]},getConnection2:function(a){return this.store.getSync(u.generateId(a,this))},getConnectionById:function(a){return this.store.getSync(a)},registerFeedBack2:function(a,b){a&&(a.feedbackTo||(a.feedbackTo=[]),a&&0<a.feedbackTo.length||a.feedbackTo.push(b))},_registerFeedBack:function(a,b){var c=this.getConnection(a);null==c?q.error("cant find connection for pool ref:"+a):c&&0<c.feedbackTo.length||c.feedbackTo.push(b)},callFeedBack:function(a,
b){throw Error();},callFeedBack2:function(a,b,c){if(a)if(a.feedbackTo&&0!=a.feedbackTo.length)for(var e=0;e<a.feedbackTo.length;e++)a.feedbackTo[e](a,b,c);else q.error("-- call feed back: have no feedback targets",a.options.host);else q.error("-- call feed back: have no connection")},connectionExists:function(a,b,c){var e=this.poolNotFound;_.each(this.pool,function(l,q){l&&l.host===a&&l.port===b&&l.protocol===c&&(e=q)});return e},forEachPool:function(a){_.each(this.pool,function(b,c){a(b,c)})}})})},
"nxapp/manager/ManagerBase":function(){define(["dcl/dcl","xide/model/Base","xide/mixins/EventedMixin"],function(h,p,n){p=h([p.dcl,n.dcl],{declaredClass:"nxapp.manager.ManagerBase",ctx:null,profile:null,init:function(g){this.profile=g}});h.chainAfter(p,"init");return p})},"nxapp/protocols/Tcp":function(){define("dcl/dcl nxapp/utils nxapp/protocols/ProtocolBase dojo/node!net dojo/node!child_process dojo/node!util dojo/node!path xide/mixins/EventedMixin xide/mixins/ReloadMixin xide/types dojo/Deferred xcf/model/Variable".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m,k){h=h(n,{declaredClass:"nxapp.protocols.Tcp",_socket:null,protocolName:"tcp",delegate:null,driverInstance:null,_handleSocketEmits:function(a){var b=this;b.clients=[];var c=this.blockScope,d=c.getVariable("value"),k=c.getVariables({group:f.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES}),r=c.getBlocks({group:f.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS});a.on("connection",function(a){b.socket=a;b.clients.push(a);a.on("data",function(a){a=[{string:a.toString(),bytes:a.join(",")}];
for(var b=0;b<a.length;b++)if(0!==a[b].length){d.value=new String(a[b].string);d.value.setBytes(a[b].bytes);for(var e=0;e<k.length;e++){var q=k[e];if("value"!=k[e].title){var m=null,m=d.value;"number"!=typeof m&&(m=""+m,m="'"+m+"'");q.target&&"None"!=q.target&&null!==m&&"null"!=m&&"'null'"!=m&&(q=c.getVariable(q.target))&&(q.value=m,this.publish(f.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:q,scope:c,owner:this,save:!1,source:f.MESSAGE_SOURCE.BLOX}))}}for(q=0;q<a.length;q++)if(m=a[q],_.isObject(m)&&m.src&&
(e=c.getBlockById(m.src))&&e.onData)e.onData(m);for(q=0;q<r.length;q++)if(e=r[q],!1!==e.enabled){e.override={args:[d.value]};try{c.solveBlock(r[q],{highlight:!1})}catch(g){console.log("----solving response block crashed ",g),console.trace()}}}});a.on("close",function(){})})},_creatingServer:!1,makeServer:function(){if(!this._creatingServer){this._creatingServer=!0;try{var a=this.options,b=a.port,c=a.host,d=this;this.owner.ctx.getDriverManager().createDriverInstance(a).then(function(a){d.blockScope=
a.blockScope;d.driverInstance=a.driverInstance});var k=new g.Server;k.listen(b,c);d._socket=k;k.writable=!0;d._handleSocketEmits(k);d.connection.connected=!0;d.delegate.onConnect2(d.connection);this.subscribe(f.EVENTS.ON_DEVICE_CONNECTED,this.onDeviceConnected);this.subscribe(f.EVENTS.ON_DEVICE_DISCONNECTED,this.onDeviceDisconnected)}catch(r){console.error("error creating server",r)}return this}},connections:null,onDeviceConnected:function(a){if(a=a.connection){var b=a.options,c=this.options;this.connections||
(this.connections=[]);a.id!==this.connection.id&&this.delegate.getConnectionById(a.id)&&c.host===b.host&&c.port===b.port&&c.protocol===b.protocol&&!a.isServer()&&-1===this.connections.indexOf(a)&&this.connections.push(a)}},onDeviceDisconnected:function(a){if(a=a.connection)this.connections||(this.connections=[]),-1!==this.connections.indexOf(a)&&this.connections.remove(a)},connect:function(){if(this.isServer())return this.makeServer();var a=this.options,b=this.options.port,c=this.options.host;this.clients=
[];this._socket=new g.Socket(p.mixin({allowHalfOpen:!0,writable:!0,readable:!0},a.options));var d=this;this.isDebug()&&console.log("TCP-Client-\x3eConnect to "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this._socket.connect(b,c,function(){d.connection.connected=!0;d.delegate.onConnect2(d.connection)});this._socket.setNoDelay(!0);this._socket.setKeepAlive(!0,0);this._socket.owner=this;this._setupEventListeners(this._socket,this.delegate);return this},broadCastMessage:function(a,
b){var c=this;this.connections&&_.each(this.connections,function(a){a&&a._destroyed&&c.connections.remove(a);if(a)if(a.client)a.client.delegate.onData(a,b.toString(),b);else console.error("not at a real connection",a);else console.error("invalid connection",a)})},send:function(a){null==a?console.error("TCP : invalid command"):(a=p.bufferFromDecString(a),a=new Buffer(a),this.isServer()?this.broadCastMessage(f.EVENTS.ON_DEVICE_MESSAGE,a):this._socket.write(a))},destroy:function(){this.blockScope&&this.blockScope.destroy();
this.driverInstance&&this.driverInstance.destroy();delete this.blockScope;delete this.driverInstance;delete this.connections;delete this.clients;delete this._socket;this._destroyed=!0},close:function(){this.isServer()?(this._socket.close(),this.destroy()):this._socket.end()}});h.net=g;return h})},"nxapp/protocols/ProtocolBase":function(){define("dcl/dcl xide/model/Base xide/types xide/utils nxapp/utils/_LogMixin xide/mixins/ReloadMixin".split(" "),function(h,p,n,g,d,c){p=h([p.dcl,d,c.dcl],{onReloaded:function(){console.error("on reloaded")},
options:null,declaredClass:"nxapp.protocols.ProtocolBase",protocolName:"undefined",debug_connection:"protocol_connection",debug_messages:"protocol_messages",delegate:null,connection:null,_setupEventListeners:function(a,b){var c=this,d=c.connection;a.handle=function(a){b.onHandle(d,a)};a.on("data",function(a){b.onData(d,a.toString(),a);for(var c=0;c<a.length;c++);});b||(console.error("have no handler"),g.stack());d||(console.error("have no connection"),g.stack());a.on("error",function(a){c.isDebug()&&
console.error("socket error : ",a);b.onError(d,a)});a.on("drain",function(){b.onDrain(d)});a.on("timeout",function(){b.onTimeout(d)});a.on("close",function(a){b.onClose(d,a)})},isDebug:function(){var a=this.connection;return a&&(a=a.options)&&(a=a.driverOptions)&&a&1<<n.DRIVER_FLAGS.DEBUG?!0:!1},isServer:function(){var a=this.connection;return a&&(a=a.options)&&(a=a.driverOptions)&&a&1<<n.DRIVER_FLAGS.SERVER?!0:!1},runAsServer:function(){var a=this.connection;return a&&(a=a.options)&&(a=a.driverOptions)&&
a&1<<n.DRIVER_FLAGS.RUNS_ON_SERVER?!0:!1},_defaultOptions:function(){return{port:23,text_encoding:"utf8",end_of_command:"\r"}},toString:function(a,b){var c=g.bufferFromDecString(a);return(new Buffer(c)).toString(b)},init:function(){this.initLogger(this.options.debug);this.initReload();var a=this;this.subscribe(n.EVENTS.ON_MODULE_RELOADED,function(b){a.modulePath&&b.module&&a.modulePath===b.module&&(a.mergeFunctions(a,b.newModule.prototype),a.onReloaded())})},mergeFunctions:function(a,b){for(var c in b)"constructor"!==
c&&"inherited"!==c&&_.isFunction(b[c])&&(a[c]=null,a[c]=b[c],console.log("update : "+c))},logConnection:function(a){this.log(a,this.debug_connection)},logMessages:function(a){this.log(a,this.debug_messages)},send:function(a){},onConnect:function(){},destroy:function(){}});h.chainAfter(p,"onConnect");h.chainAfter(p,"init");h.chainAfter(p,"close");h.chainAfter(p,"destroy");return p})},"xide/mixins/ReloadMixin":function(){define(["xdojo/declare","dcl/dcl","xide/types","xide/utils","xide/mixins/EventedMixin"],
function(h,p,n,g,d){var c={_mergeFunctions:!0,_mergeMissingVariables:!0,isInstanceOf_:function(a){try{if(!!this instanceof a||this.isInstanceOf&&this.isInstanceOf(a))return!0;var b=g.getAt(this,"constructor._meta.bases",[]),c=a.prototype.declaredClass;return _.findWhere(b,function(b){return b==a||g.getAt(b,"superclass.declaredClass")===c||g.getAt(b,"prototype.declaredClass")===c})}catch(d){console.log("ReloadMixin :: this.isInstanceOf_ crashed "+d)}return!1},mergeFunctions:function(a,b){for(var c in b)"constructor"!==
c&&"inherited"!==c&&(_.isFunction(b[c])&&(a[c]=null,a[c]=b[c]),_.isArray(b[c])&&null==a[c]&&(a[c]=b[c]))},onModuleReloaded:function(a){var b=a.newModule;if(b&&b.prototype&&!a._processed){var c=b.prototype,d=c.declaredClass,m=!1,k=this.declaredClass;d&&(d&&k&&(m=g.replaceAll("/",".",k)===g.replaceAll("/",".",d)),m?(this.mergeFunctions(this,c),this.onReloaded&&(a._processed=!0,this.onReloaded(b))):a.module&&g.replaceAll("//","/",a.module)===k&&this.mergeFunctions(this,c))}},initReload:function(){this.subscribe(n.EVENTS.ON_MODULE_RELOADED)}};
h=h(null,c);h.Impl=c;h.dcl=p(d.dcl,c);return h})},"xcf/model/Variable":function(){define(["dcl/dcl","xide/types","xblox/model/variables/Variable"],function(h,p,n){return h(n,{declaredClass:"xcf.model.Variable",hasInlineEdits:!0,gui:"off",cmd:"off",save:!1,target:"None",name:"No Title",value:-1,observed:["value","initial","name"],solve:function(){var g="";if("processVariables"==this.group){var d=this.scope.getVariable("value");d&&(d=d.value,this.isNumber(d)||(d="'"+d+"'"),g="var value \x3d "+d+";\n")}return this.scope.parseExpression(g+
this.getValue(),!0)},canEdit:function(){return!0},canDisable:function(){return!1},getFields:function(){var g=this.getDefaultFields();g.push(this.utils.createCI("title",13,this.name,{group:"General",title:"Name",dst:"name"}));var d=this;g.push(this.utils.createCI("value",this.types.ECIType.EXPRESSION,this.value,{group:"General",title:"Value",dst:"value",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!1,autoFocus:!1,hasConsole:!1},aceOptions:{hasEmmet:!1,hasLinking:!1,
hasMultiDocs:!1},item:this},delegate:{runExpression:function(c,a,b){if("processVariables"==d.group){var r=d.scope.getVariable("value"),f="";r&&(r=r.value,d.isNumber(r)||(r="'"+r+"'"),f="var value \x3d "+r+";\n")}return d.scope.expressionModel.parse(d.scope,f+c,!1,a,b)}}}));g.push(this.utils.createCI("flags",5,this.flags,{group:"General",title:"Flags",dst:"flags",data:[{value:4096,label:"Dont parse",title:"Do not parse the string and use it as is"},{value:2048,label:"Expression",title:"Parse it as Javascript"}],
widget:{hex:!0}}));return g},onChangeField:function(g,d,c){"value"===g&&this.publish(p.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:this,scope:this.scope,save:!1,source:p.MESSAGE_SOURCE.GUI})}})})},"xblox/model/variables/Variable":function(){define(["dcl/dcl","xide/types","xblox/model/Block"],function(h,p,n){return h(n,{declaredClass:"xblox.model.variables.Variable",name:null,value:null,register:!0,readOnly:!1,initial:null,isVariable:!0,flags:4096,getValue:function(){return this.value},canDisable:function(){return!1},
canMove:function(){return!1},getIconClass:function(){return"el-icon-quotes-alt"},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e '},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon()+this.makeEditable("name","right","text","Enter a unique name","inline")+"\x3c/span\x3e"},solve:function(){this.scope.parseExpression(this.getValue(),!0);return[]},getFields:function(){var g=this.getDefaultFields(),d=this;g.push(this.utils.createCI("title",
p.ECIType.STRING,this.name,{group:"General",title:"Name",dst:"name"}));g.push(this.utils.createCI("value",p.ECIType.EXPRESSION,this.value,{group:"General",title:"Value",dst:"value",delegate:{runExpression:function(c,a,b){return d.scope.expressionModel.parse(d.scope,c,!1,a,b)}}}));return g}})})},"xblox/model/Block":function(){define("dcl/dcl dojo/Deferred dojo/_base/lang dojo/has xblox/model/ModelBase xide/factory xide/utils xide/types xide/utils/ObjectUtils xdojo/has!xblox-ui?xblox/model/Block_UI".split(" "),
function(h,p,n,g,d,c,a,b,r,f){function m(a,b){for(var c=0;c<b.length;c++)if(a.id===b[c].id)return c}d=[d];d.push(h(null,{getStatusIcon:function(){},getStatusClass:function(){},setStatusClass:function(){},onActivity:function(){},onRun:function(){},onFailed:function(){},onSuccess:function(){},getIconClass:function(){}}));a.mixin(b,{BLOCK_FLAGS:{NONE:0,ACTIVE:1,SCRIPT:2,RESERVED1:4,USEFUNCTION:8,RESERVED2:16,SINGLE:32,WAITSFORMESSAGE:64,VARIABLEINPUTS:128,VARIABLEOUTPUTS:256,VARIABLEPARAMETERINPUTS:512,
VARIABLEPARAMETEROUTPUTS:1024,TOPMOST:16384,BUILDINGBLOCK:32768,MESSAGESENDER:65536,MESSAGERECEIVER:131072,TARGETABLE:262144,CUSTOMEDITDIALOG:524288,RESERVED0:1048576,EXECUTEDLASTFRAME:2097152,DEACTIVATENEXTFRAME:4194304,RESETNEXTFRAME:8388608,INTERNALLYCREATEDINPUTS:16777216,INTERNALLYCREATEDOUTPUTS:33554432,INTERNALLYCREATEDINPUTPARAMS:67108864,INTERNALLYCREATEDOUTPUTPARAMS:134217728,INTERNALLYCREATEDLOCALPARAMS:1073741824,ACTIVATENEXTFRAME:268435456,LOCKED:536870912,LAUNCHEDONCE:2147483648},BLOCK_CALLBACKMASK:{PRESAVE:1,
DELETE:2,ATTACH:4,DETACH:8,PAUSE:16,RESUME:32,CREATE:64,RESET:4096,POSTSAVE:256,LOAD:512,EDITED:1024,SETTINGSEDITED:2048,READSTATE:4096,NEWSCENE:8192,ACTIVATESCRIPT:16384,DEACTIVATESCRIPT:32768,RESETINBREAKPOINT:65536,RENAME:131072,BASE:14,SAVELOAD:769,PPR:304,EDITIONS:3072,ALL:4294967295}});d=h(d,{declaredClass:"xblox.model.Block",scopeId:null,isCommand:!1,outlet:0,_destroyed:!1,enabled:!0,serializeMe:!0,name:null,shareTitle:"",sharable:!1,items:null,parent:null,_return:null,_lastResult:null,_deferredObject:null,
_currentIndex:0,_lastRunSettings:null,_onLoaded:!1,beanType:"BLOCK",override:{},ignoreSerialize:"_didSubscribe _currentIndex _deferredObject _destroyed _return parent __started ignoreSerialize _lastRunSettings _onLoaded beanType sharable override virtual _scenario _didRegisterSubscribers additionalProperties renderBlockIcon serializeMe _statusIcon _statusClass hasInlineEdits _loop help owner _lastCommand allowActionOverride canDelete isCommand lastCommand autoCreateElse _postCreated _counter".split(" "),
_parseString:function(c,e,d,l){try{e=e||this._lastSettings||{};l=l||e.flags||b.CIFLAG.EXPRESSION;var r=this.scope,m=!(l&b.CIFLAG.DONT_PARSE),f=l&b.CIFLAG.EXPRESSION;l&b.CIFLAG.TO_HEX&&(c=a.to_hex(c));!1!==m&&(c=a.convertAllEscapes(c,"none"));var g=e.override||this.override||{},h=g&&g.variables?g.variables:null,n="",n=f&&!1!==m?r.parseExpression(c,null,h,null,null,null,g.args,l):""+c}catch(p){console.error(p)}return n},postCreate:function(){},childrenByClass:function(a){for(var b=this.getChildren(),
c=[],l=0;l<b.length;l++){var d=b[l];d.isInstanceOf(a)&&c.push(d)}return c},childrenByNotClass:function(a){for(var b=this.getChildren(),c=[],l=0;l<b.length;l++){var d=b[l];d.isInstanceOf(a)||c.push(d)}return c},getInstance:function(){var a=this.scope.instance;return a?a:null},pause:function(){},mergeNewModule:function(a){for(var b in a){var c=a[b];c&&_.isFunction(c)&&(this[b]=c)}},__onReloaded:function(b){this.mergeNewModule(b.prototype);b=this.declaredClass;(b=n.getObject(a.replaceAll("/",".",b))||
n.getObject(b))&&b.prototype&&b.prototype.solve&&this.mergeNewModule(b.prototype)},reparent:function(){if(!this)return!1;if(!this.getParent()){var a=this.next(null,1)||this.next(null,-1);a&&(this.group=null,a._add(this))}},unparent:function(a,b){if(!this)return!1;var c=this.getParent();c&&c.removeBlock&&c.removeBlock(this,!1);this.group=a;this.parent=this.parentId=null;!1!==b&&(this._place(null,-1,null),this._place(null,-1,null))},move:function(a){if(!this)return!1;var b=this.getParent(),c=null;if(b){c=
b[b._getContainer(this)];if(!c||2>c.length||!this.containsItem(c,this))return!1;b=this.indexOf(c,this);if(0>b+a)return!1;var l=c[b+a];if(!l)return!1;c[b+a]=this;c[b]=l}else this._place(null,a);return!0},_place:function(a,b,c){var l=this._store,d=this;(a=a||d.next(null,b))?(a=_.isString(a)?l.getSync(a):a,d=_.isString(d)?l.getSync(d):d,c=c||l.storage.fullData,b=-1==b?0:1,c.remove(d),-1==b&&(b=0),c.splice(Math.max(m(a,c)+b,0),0,d),l._reindex()):console.error("have no next",this)},index:function(){var a=
this.getParent(),b=null,c=this.group,b=this._store;if(a)return b=a[a._getContainer(this)]||[],b=b.filter(function(a){return a.group===c}),!b||2>b.length||!this.containsItem(b,this)?!1:this.indexOf(b,this);b=b.storage.fullData;b=b.filter(function(a){return a.group===c});return this.indexOf(b,this)},numberOfParents:function(){var a=0,b=this.getParent();b&&(a++,a+=b.numberOfParents());return a},getTopRoot:function(){var a=this.getParent();if(a){var b=a.getParent();b&&(a=b)}return a},next:function(a,
b){function c(a,b,e){var d=a.indexOf(b,a);if(d=b[d+e*l]){if(!d.parentId&&d.group&&d.group===a.group)return d;l++;return c(a,b,e)}return null}var l=1;a=a||this._store.storage.fullData;return c(this,a,b)},getParent:function(){return this.parentId?this.scope.getBlockById(this.parentId):null},getScope:function(){var a=this.scope;if(this.scopeId&&0<this.scopeId.length){var b=a.owner;b&&b.hasScope&&(b.hasScope(this.scopeId)?a=b.getScope(this.scopeId):console.error("have scope id but cant resolve it",this))}return a},
canAdd:function(){return null},getTarget:function(){var a=this._targetReference;if(a)return a;var b=this.getParent();b&&b.getTarget&&(a=b.getTarget());return a},addToEnd:function(a,b){b&&null!=a.length&&null!=b.length&&a.push.apply(a,b);return a},removeBlock:function(a,b){a&&(!1!==b&&a.empty&&a.empty(),!1!==b&&delete a.items,a.parent=null,this.items&&this.items.remove(a))},_getContainer:function(a){return"items"},empty:function(a){try{this._empty(a)}catch(b){debugger}},_empty:function(a){if(a=a||
this.items)for(var b=0;b<a.length;b++){var c=a[b];c&&c.empty&&c.empty();c&&this.scope&&this.scope.blockStore&&this.scope.blockStore.remove(c.id)}},containsItem:function(a,b){for(var c=a.length;c--;)if(a[c].id===b.id)return!0;return!1},indexOf:function(a,b){for(var c=a.length;c--;)if(a[c].id===b.id)return c;return-1},_getBlock:function(a){try{if(!this||!this.parentId)return!1;var b=this.scope.getBlockById(this.parentId);if(!b)return null;var c=b[b._getContainer(this)];if(!c||2>c.length||!this.containsItem(c,
this))return null;var l=this.indexOf(c,this);if(0>l+a)return!1;var d=c[l+a];if(d)return d}catch(r){debugger}return null},getPreviousBlock:function(){return this._getBlock(-1)},getNextBlock:function(){return this._getBlock(1)},_getPreviousResult:function(){var a=this.getPreviousBlock()||this.getParent();return a&&null!=a._lastResult?this.isArray(a._lastResult)?a._lastResult:[a._lastResult]:null},getPreviousResult:function(){var a=null;if((a=(a=this.getPreviousBlock())&&a._lastResult&&a.enabled?a:this.getParent())&&
!a._lastResult){var b=a.getParent();b&&(a=b)}return a&&null!=a._lastResult?(this.isArray(a._lastResult),a._lastResult):null},_getArg:function(a,b){var c=parseFloat(a);return isNaN(c)?"true"===a||"false"===a?"true"===a?!0:!1:a&&b&&_.isString(a)?"'"+a+"'":a:c},getArgs:function(b){var c=[];b=b||{};var d=b.args||this._get("args");b.override&&b.override.args&&(d=b.override.args);d&&(c=a.getJson(d,null,!1));if(c&&0==c.length&&d&&d.length&&_.isString(d)){if(-1!==d.indexOf(",")){d=d.split(",");for(b=0;b<
d.length;b++){var l=parseFloat(d[b]);isNaN(l)?"true"===d[b]||"false"===d[b]?c.push(a.toBoolean(d[b])):c.push(d[b]):c.push(l)}return c}c=[this._getArg(d)]}!_.isArray(c)&&(c=[]);b=this.getPreviousResult();null!=b&&(_.isArray(b)&&1==b.length?c.push(b[0]):c.push(b));return c||[d]},remove:function(a){this._destroyed=!0;null!=this.parentId&&null==this.parent&&(this.parent=this.scope.getBlockById(this.parentId));if(this.parent&&this.parent.removeBlock)this.parent.removeBlock(this);else if(a=a||this)a.empty&&
a.empty(),delete a.items,a.parent=null,this.items&&this.items.remove(a)},prepareBlockContructorArgs:function(a){a||(a={});a.id||(a.id=this.createUUID());a.items||(a.items=[])},_add:function(a,b,d,l){var r=null;try{b?(this.prepareBlockContructorArgs(b),r=c.createBlock(a,b,null,l)):null==b&&(r=a);(r.scope=this.scope)&&(r=this.scope.registerBlock(r,l));if(r.id===this.id){console.error("adding new block to our self");debugger}r.parent=this;r.parentId=this.id;var m=d||this._getContainer();if(m)if(this[m]||
(this[m]=[]),-1!=this.indexOf(this[m],r))console.error(" have already "+r.id+" in "+m);else{if(this.id==r.id){console.error("tried to add our self to "+m);return}this[m].push(r)}return r}catch(f){logError(f,"_add")}return null},getStore:function(){return this.getScope().getStore()},add:function(a,b,c){a=this._add(a,b,c);return a.getStore().getSync(a.id)},getContext:function(){return this.scope.instance&&this.scope.instance?this.scope.instance:null},resolved:function(){this._deferredObject&&(this._deferredObject.resolve(),
delete this._deferredObject)},_solve:function(a,b){b=b||{highlight:!1};for(var c=[],d=0;d<this.items.length;d++)this.addToEnd(c,this.items[d].solve(a,b));return c},solve:function(a,b){b=b||{highlight:!1};for(var c=[],d=0;d<this.items.length;d++)this.addToEnd(c,this.items[d].solve(a,b));return c},solveMany:function(a,b){!this._lastRunSettings&&b&&(this._lastRunSettings=b);b=this._lastRunSettings||b;this._currentIndex=0;this._return=[];var c=this[this._getContainer()];if(c.length)return c=this.runFrom(c,
0,b),this.onSuccess(this,b),c;this.onSuccess(this,b);return[]},runFrom:function(a,b,c){var d=this;a=a||this.items;var r=function(b){b._deferredObject.then(function(e){b._lastResult=b._lastResult||e;d._currentIndex++;d.runFrom(a,d._currentIndex,c)})};if(a.length)for(;b<a.length;b++){var m=a[b];if(!0===m.deferred){m._deferredObject=new p;this._currentIndex=b;r(m);this.addToEnd(this._return,m.solve(this.scope,c));break}else this.addToEnd(this._return,m.solve(this.scope,c))}else this.onSuccess(this,c);
return this._return},serializeField:function(a){return-1==this.ignoreSerialize.indexOf(a)},onLoad:function(){},activate:function(){},deactivate:function(){},_get:function(a){if(this.override)return a in this.override?this.override[a]:this[a]},onDidRun:function(){this.override&&(this.override.args&&delete this.override.args,delete this.override)},destroy:function(){this.stop(!0);this.reset();this._destroyed=!0},reset:function(){this._lastSettings={};this._loop&&(clearTimeout(this._loop),this._loop=
null);delete this.override;this.override={}},stop:function(){this.reset()}});d.FLAGS=b.BLOCK_FLAGS;d.EMITS=b.BLOCK_CALLBACKMASK;g("xblox-ui")&&n.mixin(d.prototype,f.prototype);d.prototype.onSuccess||(d.prototype.onSuccess=function(){},d.prototype.onRun=function(){},d.prototype.onFailed=function(){});h.chainAfter(d,"stop");h.chainAfter(d,"destroy");h.chainAfter(d,"onDidRun");return d})},"xblox/model/ModelBase":function(){define(["dcl/dcl","xide/utils","xide/types","xide/mixins/EventedMixin"],function(h,
p,n,g){g=h(g.dcl,{declaredClass:"xblox.model.ModelBase",id:null,description:"",parent:null,parentId:null,group:null,order:0,_store:null,outputs:function(){return[]},takes:function(){return[]},needs:function(){return[]},constructor:function(d){for(var c in d)d.hasOwnProperty(c)&&(this[c]=d[c]);this.id||(this.id=this.createUUID());this.utils=p;this.types=n},keys:function(d){var c=[],a;for(a in d)c.push(a);return c},values:function(d){var c=[],a;for(a in d)c.push(d[a]);return c},toArray:function(){return this.map()},
size:function(){return this.toArray().length},createUUID:function(){var d=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d()},canEdit:function(){return!0},getFields:function(){return null},isString:function(d){return"string"==typeof d},isNumber:function(d){return"number"==typeof d},isBoolean:function(d){return"boolean"==typeof d},isObject:function(d){return"object"===typeof d},isArray:function(d){return Array.isArray?Array.isArray(d):
!1},getValue:function(d){var c=parseFloat(d);return isNaN(c)?"true"===d||!0===d?!0:"false"===d||!1===d?!1:d:c},isScript:function(d){return this.isString(d)&&(-1!=d.indexOf("return")||-1!=d.indexOf(";")||-1!=d.indexOf("(")||-1!=d.indexOf("+")||-1!=d.indexOf("-")||-1!=d.indexOf("\x3c")||-1!=d.indexOf("*")||-1!=d.indexOf("/")||-1!=d.indexOf("%")||-1!=d.indexOf("\x3d")||-1!=d.indexOf("\x3d\x3d")||-1!=d.indexOf("\x3e")||-1!=d.indexOf("[")||-1!=d.indexOf("{")||-1!=d.indexOf("}"))},replaceAll:function(d,
c,a){return this.isString(a)?a.split(d).join(c):a},isInValidState:function(){return!0},destroy:function(){}});h.chainAfter(g,"destroy");return g})},"nxapp/protocols/Udp":function(){define(["dcl/dcl","nxapp/protocols/ProtocolBase","dojo/node!dgram","xide/utils"],function(h,p,n,g){return h(p,{declaredClass:"nxapp.protocols.Udp",_socket:null,protocolName:"udp",port:null,host:null,onData:function(d){var c=this.delegate;this.isDebug()&&console.log("UDP: got data : "+this.connection.toString(),d);c.onData(this.connection,
d)},makeServer:function(d,c){var a=this;d.bind(c.port,c.ip);a.isDebug()&&console.log("UDP: Make server, bind socket to "+c.ip+" :: "+c.port);d.on("listening",function(){var b=d.address();a.isDebug()&&console.log("\t UDP Server listening on "+b.address+":"+b.port)});d.on("message",function(b,c){a.isDebug()&&console.log("UDP: on server message "+a.connection.toString()+" - "+c.address+":"+c.port+" - "+b);a.onData(b.toString())})},connect:function(){var d=this.options;this.port=this.options.port;this.host=
this.options.host;this.protocol=this.protocolName;this._socket=n.createSocket("udp4");d=g.getJson(d.options);this._setupEventListeners(this._socket,this.delegate);this._socket.writable=!0;this.connection.connected=!0;this.delegate.onConnect2(this.connection);d&&!0===d.server&&this.makeServer(this._socket,d);return this},send:function(d,c){try{var a=this,b=g.bufferFromDecString(d),r=new Buffer(b),f=r.toString();console.log("UDP - "+a.connection.toString()+" Sending command: "+d+" \x3d "+f+" l\x3d "+
f.length);this._socket.send(r,0,r.length,this.port,this.host,function(b,c){if(b)a.delegate.onError(b)})}catch(m){console.error("crash !")}},close:function(){try{this._socket.close()}catch(d){console.error("Error closing udp connection : ",d)}}})})},"nxapp/protocols/Driver":function(){define("dcl/dcl nxapp/utils nxapp/protocols/ProtocolBase dojo/node!path require xide/types nxapp/utils/_console".split(" "),function(h,p,n,g,d,c,a){n=h(n,{declaredClass:"nxapp.protocols.Driver",_socket:null,protocolName:"driver",
instance:null,constructor:function(a){p.mixin(this,a)},onError:function(b,d,f){this.isDebug()&&a.info("Driver-\x3eonError "+b+" id "+d.params.id+" src "+d.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:b,event:c.EVENTS.ON_COMMAND_ERROR,result:f.toString()},d),f)}catch(m){a.error("onFinish-Error:",m)}},onConnected:function(){this.isDebug()&&a.log("# driver onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.connection.connected=!0;this.delegate.onConnect2(this.connection)},
onConnect:function(){this._socket.onConnect&&this._socket.onConnect()},onFinish:function(b,d,f){this.isDebug()&&a.info("Driver-\x3eonFinish "+b+" id "+d.params.id+" src "+d.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:b,event:c.EVENTS.ON_COMMAND_FINISH,result:f.toString()},d),f)}catch(m){a.error("onFinish-Error:",m)}},onProgress:function(b,d,f){this.isDebug()&&a.info("Driver-\x3eonProgress "+b+" id "+d.params.id+" src "+d.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:b,
event:c.EVENTS.ON_COMMAND_PROGRESS,result:f.toString()},d),f)}catch(m){a.error("onFinish-Progress:",m)}},onPaused:function(b,d,f){this.isDebug()&&a.info("Driver-\x3eonPaused "+b+" id "+d.params.id+" src "+d.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:b,event:c.EVENTS.ON_COMMAND_PAUSED,result:f.toString()},d),f)}catch(m){a.error("onFinish-Paused:",m)}},onStopped:function(b,d,f){this.isDebug()&&a.info("Driver-\x3eonStopped "+b+" id "+d.params.id+" src "+d.params.src);try{this.delegate.onData(this.connection,
p.mixin({cmd:b,event:c.EVENTS.ON_COMMAND_STOPPED,result:f.toString()},d),f)}catch(m){a.error("onFinish-Stopped:",m)}},_connect:function(b,c,d){b=new b(c);b.owner=this;b.options=this.options;b.delegate=this.delegate;b.connection=this.connection;this.modulePath=b.modulePath=d;b.connect||a.error("have no connect");this._socket=b;this._socket.writable=!0;b.connect()},onDeviceDisconnected:function(a){this.delegate.onClose(this.connection,this.options)},onData:function(b,c){this.isDebug()&&a.log("Driver on data : ");
c=c||new Buffer(b);this.delegate.onData(this.connection,b,c);this._socket&&this._socket.onData&&this._socket.onData(this.connection,b,c)},connect:function(){var b=this.options;this.isDebug()&&a.log("connect custom driver");if(!b||!b.driver)return a.error("no driver in options",b),this;try{var c=b[b.driverScope],f=c+"/"+b.driver,f=p.replaceAll("/",g.sep,f);this.isDebug()&&a.log("load driver : "+f+" drivers root : "+c+" from "+g.dirname(f));var m=this;try{d.undef(f),d([f],function(c){if("function"!==
typeof c)m.close(),m.onDeviceDisconnected();else try{m._connect?m._connect(c,b,f):a.error("have no _connect")}catch(d){a.error("error calling connect on "+f+" | Error "+d.message,d)}})}catch(k){a.error("-----error loading driver module at drivers root "+c+" and module "+b.driver+" :: "+k.message,k.stack)}}catch(e){a.error("Error connecting driver "+e.message)}return this},send:function(b,c){b?(this.isDebug()&&a.log("send : ",b),this._socket.write(b,c)):a.error("TCP : invalid command")},close:function(){this._socket&&
this._socket.destroy&&this._socket.destroy()}});h.chainAfter(n,"close");h.chainAfter(n,"destroy");return n})},"nxapp/protocols/SSH":function(){define("dcl/dcl xide/utils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!fs dojo/node!path dojo/node!ssh2 dojo/node!strip-ansi dojo/node!child_process dojo/node!util dojo/node!deferred dojo/node!ansi-to-html dojo/node!ansi_up nxapp/utils/_console xide/encoding/MD5".split(" "),function(h,p,n,g,d,c,a,b,r,f,m,k,e,q,l,u){var v=!1;return h(g,
{declaredClass:"nxapp.protocols.SSH",_socket:null,protocolName:"ssh",instance:null,sshOptions:null,running:null,getOptions:function(b,d,e){var q=null;if(e.privateKeyPath){var m=a.resolve(e.privateKeyPath);m?q=c.readFileSync(m).toString():v||this.isDebug()&&l.warn("Sorry, cant resolve file "+e.privateKeyPath)}b={config:!1,host:b,username:e.username,password:e.password,agent:"",agentForward:!1,port:d,proxy:{port:d},ignoreErrors:!1,minimatch:{},debug:v||this.isDebug()?function(a){l.log("SSH _ DEBUG : "+
a)}:null,suppressRemoteErrors:!1,callback:function(){}};q&&(b.privateKey=q);return p.mixin(b,e)},onConnected:function(){v||this.isDebug()&&l.log("# "+this.protocolName+" - Protocol:: onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.connection.connected=!0;this.delegate.onConnect2(this.connection)},onError:function(a,b){this.delegate.onError(this.connection,p.mixin({code:a},b),this.options)},onClose:function(){this.delegate.onClose(this.connection,this.options)},
connect:function(){var a=this.options,c=this;if(!a||!a.driver)return v||c.isDebug()&&l.error("no driver in options",a),this;var d=a.host,e=a.port,a=p.getJson(a.options);!0===a.debug&&(v=!0);var q=this.getOptions(d,e,a),a=function(a){var b={host:a.host,port:a.port,username:a.username,readyTimeout:a.readyTimeout,agentForward:a.agentForward};a.privateKey?(b.privateKey=a.privateKey.trim(),a.passphrase&&(b.passphrase=a.passphrase.trim())):a.password?(b.password=a.password,a.agent&&(b.agent=a.agent)):b.agent=
a.agent;return b}(q);this.sshOptions=q;this.host=d;this.port=e;this.protocol=this.protocolName;v||c.isDebug()&&l.log("SSH-\x3econnecting SSH with");var m=new b;m.on("keyboard-interactive",function(a,b,c,d,e){d.forEach(function(a){-1!==a.prompt.toLowerCase().indexOf("password")&&e([q.password])})});m.on("connect",function(){v||c.isDebug()&&l.log("SSH-\x3eConnection :: connect")});m.on("ready",function(){v||c.isDebug()&&l.log("SSH-\x3eConnection :: ready");var a,b,d;m.once("session",function(e,q){e().once("pty",
function(c,e,q){a=q.rows;b=q.cols;d=q.term;c&&c();v&&l.log("SSH-\x3e pty "+a+" "+b+" "+d)}).once("shell",function(a,b){v||c.isDebug()&&l.log("SSH-\x3eshell")})});c.onConnected()});m.on("error",function(a){v||c.isDebug()&&l.warn("SSH-\x3eConnection - Error :: "+a);a=a.level+":"+a.message;c.onError(a);c.lastError=a});m.on("debug",function(a){v||c.isDebug()&&l.log("SSH-\x3eConnection :: debug :: "+a)});m.on("end",function(){v||c.isDebug()&&l.log("SSH-\x3eConnection :: end");c.onClose()});m.on("close",
function(a){if(a)v||c.isDebug()&&l.log("SSH - Connection :: Close, had Error ");else c.onClose()});m.connect(a);this._socket=m;this._socket.writable=!0;return this},onData:function(a,b){this.isDebug()&&l.log("SSH-\x3eonData",a);this.delegate.onData(this.connection,a||"",b)},onProgress:function(a,b,c){this.isDebug()&&l.info("SSH-\x3eonProgress "+a+" id "+b.params.id+" src "+b.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:n.EVENTS.ON_COMMAND_PROGRESS,result:c.toString()},
b),c)}catch(d){l.error("onFinish-Progress:",d)}},onCommandError:function(a,b,c){v||this.isDebug()&&l.log("SSH-\x3eonCommandError "+a+" id "+b.params.id+" src "+b.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:n.EVENTS.ON_COMMAND_ERROR},b),c)}catch(d){l.error("---",d)}},onFinish:function(a,b,c){v||this.isDebug()&&l.info("SSH-\x3eonFinish "+a+" id "+b.params.id+" src "+b.params.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:n.EVENTS.ON_COMMAND_FINISH},
b),c)}catch(d){l.error("onFinish-Error:",d)}},_addCommand:function(a){u(JSON.stringify(a.join(",")),1)},execCommand:function(a,b){var c=this._socket,d=this,m=d.sshOptions,r=k(),f=b.params,u=f.id,g=f.wait,h=new e(m.ansiOptions||{}),n=1==m.waitForEOF,p="";if(0===a.length)d.isDebug()&&l.log("SSH-\x3eno more SSH commands, call Defered::resolve");else{var E=a.shift();d.isDebug()&&l.log("SSH-\x3eExecuting :: "+E,b.params);c.exec(E,m,function(c,e){if(c)v||d.isDebug()&&l.log("---error in SSH ",c);else{var k;
e.on("data",function(a,c){k=String(a);!0!==m.ansiUp&&1==m.html?k=h.toHtml(k):1==m.ansiUp&&1==m.html&&(k=q.ansi_to_html(k));d.isDebug()&&l.log("SSH DATA : signal \x3d "+c+" : "+k);if("stderr"!==c)if(n)p+=k,e.lastData=p;else{if(g)d.onProgress(E,b,a);else d.onData(k,a);e.lastData=k}});e.on("end",function(a){v||d.isDebug()&&l.log("SSH-\x3eStream :: EOF, had Error "+(1==e.hadError));k&&"function"===typeof m.callback&&m.callback(k.trim());!0!==e.hadError?(n&&(v||d.isDebug()&&l.error("--------------release data on EOF"),
d.onData(e.lastData)),r.resolve(u)):r.reject({id:u,error:e.lastData})});e.on("exit",function(){v||d.isDebug()&&l.log("SSH-\x3eStream :: exit")});e.on("close",function(c,q){v||d.isDebug()&&l.log("SSH-\x3eStream :: close :: code: "+c+", signal: "+q);127==c&&(e.hadError=!0,r.reject({id:u,error:e.lastData}));m.ignoreErrors||0===c?d.execCommand(a,b):(v||d.isDebug()&&l.error("SSH-\x3eError executing task "+E+" _ code "+c),d.onCommandError(E,b))})}})}return r.promise},send:function(a,b){v||this.isDebug()&&
l.log("send : "+a,b.params);if(null==a)l.error("SSH: invalid command");else{b=b||{id:p.createUUID()};a=this.toString(a);v||this.isDebug()&&l.log("SSH-\x3esend : "+a);var c=this.execCommand([a],b),d=this;c.then(function(c){d.onFinish(a,b)},function(c){b.error=c.error;d.onCommandError(a,b)});return c}},close:function(){this._socket&&this._socket.end()},init:function(){this.running={}}})})},"nxapp/protocols/Serial":function(){define("dcl/dcl xide/utils xide/utils/StringUtils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!path dojo/node!child_process dojo/node!util dojo/node!deferred nxapp/utils/_console xdojo/has dojo/has!serialport?dojo/node!serialport".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m,k,e){var q=!1;return h(d,{declaredClass:"nxapp.protocols.Serial",_socket:null,protocolName:"serial",instance:null,client:null,sshOptions:null,getOptions:function(a,b,c,d){return p.mixin({baudrate:9600,parity:"none",rtscts:!1,xon:!1,xoff:!1,xany:!1,hupcl:!0,cts:!1,dtr:!0,dts:!1,brk:!1,rts:!1,databits:8,stopbits:1,bufferSize:65536,parser:e.parsers.raw},c)},onConnected:function(){this.connection.connected=!0;this.delegate.onConnect2(this.connection)},onError:function(a,
b){this.delegate.onError(this.connection,p.mixin({code:a},b),this.options)},onClose:function(){this.delegate.onClose(this.connection,this.options)},connect:function(){try{var a=this.options;if(!k("serialport"))return this.onError("have serial port");if(!a||!a.driver)return this;var b=this,c=a.host,d=a.port,r=p.getJson(a.options||{});!0===r.debug&&(q=!0);var f=this.getOptions(c,d,r,(a.responseSettings||{}).delimiter);this.serialOptions=f;this.protocol=this.protocolName;var g=new e(c,f);this.client=
g;g.on("error",function(a){b.onError(a.toString(),a)});try{g.on("open",function(a){if(a){var d=a.level+":"+a.message;b.onError(d);b.lastError=d;b.isDebug()&&m.warn("Serial-\x3eConnection - Error :: "+c+":"+a)}else b.onConnected(),g.on("data",function(a){b.isDebug()&&m.log("Serial-\x3eonData "+a.toString());b.onData(a.toString(),a)})})}catch(h){this.isDebug()&&m.error("Serial-\x3econnect error :: code: ",h)}g.on("close",function(a){try{b.isDebug()&&m.log("Serial-\x3eclose :: code: ",a),b.onClose(),
g.close()}catch(c){b.isDebug()&&m.error("Serial-\x3eclose :: code: ",c)}});this._socket={};this._socket.writable=!0;return this}catch(n){return this.isDebug()&&m.error("error connection serial ",n),b.onError(n.message),m.trace(),this}},onData:function(a,b){this.delegate.onData(this.connection,a,b)},onCommandError:function(a,b){q||this.isDebug()&&m.log("SERIAL-\x3eCommandError "+a+" id "+b.id+" src "+b.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:g.EVENTS.ON_COMMAND_ERROR},b))}catch(c){m.error("---",
c)}},onFinish:function(a,b){q||this.isDebug()&&m.log("SERIAL-\x3eonFinish "+a+" id "+b.id+" src "+b.src);try{this.delegate.onData(this.connection,p.mixin({cmd:a,event:g.EVENTS.ON_COMMAND_FINISH},b))}catch(c){m.error("onFinish-Error:",c)}},send:function(a,b){if(null==a)m.error("SERIAL invalid command");else{b||p.createUUID();var c=p.bufferFromDecString(a),c=new Buffer(c),d=c.toString();this.isDebug()&&m.log("Serial - Sending command: "+a+" \x3d "+d+" l\x3d "+d.length);this.client.write(c)}},close:function(){this.client&&
this.client.close()}})})},"xide/utils/StringUtils":function(){define(["xide/utils","xide/types","dojo/json","xide/lodash"],function(h,p,n,g){function d(c,a){var b=[],d=[];null==a&&(a=function(a,c){return b[0]===c?"[Circular ~]":"[Circular ~."+d.slice(0,b.indexOf(c)).join(".")+"]"});return function(f,m){if(0<b.length){var k=b.indexOf(this);~k?b.splice(k+1):b.push(this);~k?d.splice(k,Infinity,f):d.push(f);~b.indexOf(m)&&(m=a.call(this,f,m))}else b.push(m);return null==c?m:c.call(this,f,m)}}h.stringify=
function(c){return JSON.stringify(c,d(),2)};h.round=function(c,a,b){if("number"!==typeof c||isNaN(c)||Infinity===c||-Infinity===c)return"";a="undefined"===typeof a?3:parseInt(a,10)||0;var d=Math.pow(10,a);c=(Math.round(c*d)/d).toFixed(a);b||(c=""+ +c);return c};h.humanFileSize=function(c,a){var b=a?1E3:1024;if(Math.abs(c)<b)return c+" B";var d=a?"kB MB GB TB PB EB ZB YB".split(" "):"KiB MiB GiB TiB PiB EiB ZiB YiB".split(" "),f=-1;do c/=b,++f;while(Math.abs(c)>=b&&f<d.length-1);return c.toFixed(1)+
" "+d[f]};"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(c){return 0===this.indexOf(c)});"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(c){return this.substring(this.length-c.length,this.length)===c});h.isNativeEvent=function(c){var a={onclick:null,ondblclick:null,onmousedown:null,onmouseup:null,onmouseover:null,onmousemove:null,onmouseout:null,onkeypress:null,onkeydown:null,onkeyup:null,onfocus:null,onblur:null,onchange:null};
if(c in a)return!0;a={click:null,dblclick:null,mousedown:null,mouseup:null,mouseover:null,mousemove:null,mouseout:null,keypress:null,keydown:null,keyup:null,focus:null,blur:null,change:null};return c in a};h.isSystemEvent=function(c){for(var a in p.EVENTS)if(p.EVENTS[a]===c)return!0;return!1};h.contains=function(c,a){for(var b=0;b<c.length;b++)if(c[b]===a)return b;return-1};h.getObjectKeyByValue=function(c,a){if(c&&a)for(var b in c)if(c.hasOwnProperty(b)&&c[b]===a)return b;return null};h.removeURLParameter=
function(c,a){var b=c.split("?");if(2<=b.length){for(var d=encodeURIComponent(a)+"\x3d",f=b[1].split(/[&;]/g),m=f.length;0<m--;)-1!==f[m].lastIndexOf(d,0)&&f.splice(m,1);c=b[0]+"?"+f.join("\x26")}return c};h.replaceUrlParam=function(c,a,b){if(-1==c.indexOf(a))return c+=(0<c.indexOf("?")?"\x26":"?")+a+"\x3d"+b;var d=c.replace(new RegExp("("+a+"\x3d).*?(\x26|$)"),"$1"+b+"$2");d==c&&(d=d+(0<d.indexOf("?")?"\x26":"?")+a+"\x3d"+b);return d};h.buildPath=function(c,a,b){var d=""+c,d=h.replaceAll("/","",
c);c=(""+a).replace("./","/").replace(/^\/|\/$/g,"");d=d+"://"+c;return!0===b?encodeURIComponent(d):d};h.isImage=function(c){return null!=c.toLowerCase().match(/\.(jpeg|jpg|gif|png)$/)};h.hasFlag3=function(c,a){return 1<<a&c?!0:!1};h.hasFlag=function(c,a){return 1<<a&c?!0:!1};h.disableFlag=function(c,a){return c&~(1<<a)};h.cleanUrl=function(c){c&&(c=c.replace("//","/"),c=c.replace("./","/"),c=c.replace("http:/","http://"),c=c.replace("./","/"),c=c.replace("////","/"),c=c.replace("///","/"));return c};
h.getJson=function(c,a,b){try{return g.isString(c)?n.parse(c,!1):!0===a?null:c}catch(d){!1!==b&&console.error("error parsing json data "+c+" error \x3d "+d)}return null};h.fromJson=function(c){if(!g.isString(c))return c;var a=null,b=!1;try{a=eval("("+c+")",{})}catch(d){b=!0}if(b){c=c.substring(c.indexOf("{"),c.lastIndexOf("}")+1);try{a=eval("("+c+")",{})}catch(f){throw Error(c);}}return a};h.replaceAll=function(c,a,b){return b?b.split(c).join(a):""};h.isValidString=function(c){return null!=c&&null!=
c.length&&0<c.length&&"undefined"!=c};h.substituteString=function(c,a){return c.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(b,c){return a[c]})};h.findOcurrences=function(c,a){var b=h.escapeRegExp(a.begin),d=h.escapeRegExp(a.end);return c.match(new RegExp(b+"([^"+d+"]*)"+d,"g"))};h.escapeRegExp=function(c){for(var a="[ ] ( ) { } * + . | ||".split(" "),b=0;b<a.length;b++)c=c.replace(a[b],"\\"+a[b]);return c};h.multipleReplace=function(c,a){var b=[],d;for(d in a)b[b.length]=d;return c.replace(new RegExp(b.join("\\b|\\b"),
"g"),function(b){return a[b]||a["\\"+b]})};h.replace=function(c,a,b,d){if(!c)return"";if(b&&g.isObject(b)||g.isArray(b)){if(d){a=h.findOcurrences(c,d);var f=h.replaceAll;if(a)for(var m=0,k=a.length;m<k;m++){var e=a[m],q=f(d.begin,"",e),q=f(d.end,"",q);c=f(e,b[q],c)}}else return h.multipleReplace(c,b);return c}return h.replaceAll(a,b,c)};h.capitalize=function(c){return c.substring(0,1).toUpperCase()+c.substring(1)};h.vsprintf=function(c,a){return h.sprintf.apply(this,[c].concat(a))};h.sprintf=function(){var c=
arguments,a=0,b=function(a,b,c,d){c||(c=" ");b=a.length>=b?"":Array(1+b-a.length>>>0).join(c);return d?a+b:b+a},d=function(a,c,d,q,l,f){var r=q-a.length;0<r&&(a=d||!l?b(a,q,f,d):a.slice(0,c.length)+b("",r,"0",!0)+a.slice(c.length));return a},f=function(a,c,e,q,l,f,g){a>>>=0;e=e&&a&&{2:"0b",8:"0",16:"0x"}[c]||"";a=e+b(a.toString(c),f||0,"0",!1);return d(a,e,q,l,g)};return c[a++].replace(/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,function(m,k,e,q,l,g,h){var t,
n;if("%%"===m)return"%";var w=!1;n="";var p=l=!1;t=" ";for(var z=e.length,G=0;e&&G<z;G++)switch(e.charAt(G)){case " ":n=" ";break;case "+":n="+";break;case "-":w=!0;break;case "'":t=e.charAt(G+1);break;case "0":l=!0;break;case "#":p=!0}q=q?"*"===q?+c[a++]:"*"==q.charAt(0)?+c[q.slice(1,-1)]:+q:0;0>q&&(q=-q,w=!0);if(!isFinite(q))throw Error("sprintf: (minimum-)width must be finite");g=g?"*"===g?+c[a++]:"*"==g.charAt(0)?+c[g.slice(1,-1)]:+g:-1<"fFeE".indexOf(h)?6:"d"===h?0:void 0;k=k?c[k.slice(0,-1)]:
c[a++];switch(h){case "s":return h=String(k),null!=g&&(h=h.slice(0,g)),d(h,"",w,q,l,t);case "c":return h=String.fromCharCode(+k),null!=g&&(h=h.slice(0,g)),d(h,"",w,q,l,void 0);case "b":return f(k,2,p,w,q,g,l);case "o":return f(k,8,p,w,q,g,l);case "x":return f(k,16,p,w,q,g,l);case "X":return f(k,16,p,w,q,g,l).toUpperCase();case "u":return f(k,10,p,w,q,g,l);case "i":case "d":return t=+k||0,t=Math.round(t-t%1),m=0>t?"-":n,k=m+b(String(Math.abs(t)),g,"0",!1),d(k,m,w,q,l);case "e":case "E":case "f":case "F":case "g":case "G":return t=
+k,m=0>t?"-":n,n=["toExponential","toFixed","toPrecision"]["efg".indexOf(h.toLowerCase())],h=["toString","toUpperCase"]["eEfFgG".indexOf(h)%2],k=m+Math.abs(t)[n](g),d(k,m,w,q,l)[h]();default:return m}})};h.cleanString=function(c){return c?c=c.replace(/[\r]/g,"").replace(/[\b]/g,"").replace(/[\f]/g,"").replace(/[\n]/g,"").replace(/\\/g,""):null};h.normalizePath=function(c){if(!c)return null;c=h.cleanString(c);c=c.replace("./","");c=c.replace("/.","");return c=c.replace(/([^:]\/)\/+/g,"$1")};p.PATH_PARTS=
{DIRNAME:1,BASENAME:2,EXTENSION:4,FILENAME:8,PATHINFO_ALL:0};h.basename=function(c,a){var b=c,d=b.charAt(b.length-1);if("/"===d||"\\"===d)b=b.slice(0,-1);b=b.replace(/^.*[\/\\]/g,"");"string"===typeof a&&b.substr(b.length-a.length)==a&&(b=b.substr(0,b.length-a.length));return b};h.pathinfo=function(c,a){var b="",d="",f="",m=0,k={},e=0,q=0,l=e=!1,g=!1;if(!c)return!1;a||(a="PATHINFO_ALL");var v={PATHINFO_DIRNAME:1,PATHINFO_BASENAME:2,PATHINFO_EXTENSION:4,PATHINFO_FILENAME:8,PATHINFO_ALL:0};for(f in v)v.hasOwnProperty(f)&&
(v.PATHINFO_ALL|=v[f]);if("number"!==typeof a){a=[].concat(a);for(q=0;q<a.length;q++)v[a[q]]&&(m|=v[a[q]]);a=m}f=function(a){a+="";var b=a.lastIndexOf(".")+1;return b?b!==a.length?a.substr(b):"":!1};a&v.PATHINFO_DIRNAME&&(m=c.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,""),k.dirname=m===c?".":m);a&v.PATHINFO_BASENAME&&(!1===e&&(e=h.basename(c)),k.basename=e);a&v.PATHINFO_EXTENSION&&(!1===e&&(e=h.basename(c)),!1===l&&(l=f(e)),!1!==l&&(k.extension=l));a&v.PATHINFO_FILENAME&&(!1===e&&(e=h.basename(c)),
!1===l&&(l=f(e)),!1===g&&(g=e.slice(0,e.length-(l?l.length+1:!1===l?0:1))),k.filename=g);e=0;for(b in k)k.hasOwnProperty(b)&&(e++,d=b);return 1===e?k[d]:k};h.parse_url=function(c,a){var b;b="source scheme authority userInfo user pass host port relative path directory file query fragment".split(" ");for(var d=this.php_js&&this.php_js.ini||{},f=d["phpjs.parse_url.mode"]&&d["phpjs.parse_url.mode"].local_value||"php",m={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,
strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},m=m[f].exec(c),k={},e=14;e--;)m[e]&&(k[b[e]]=m[e]);if(a)return k[a.replace("PHP_URL_","").toLowerCase()];if("php"!==f){var q=d["phpjs.parse_url.queryKey"]&&d["phpjs.parse_url.queryKey"].local_value||
"queryKey",m=/(?:^|&)([^&=]*)=?([^&]*)/g;k[q]={};b=k[b[12]]||"";b.replace(m,function(a,b,c){b&&(k[q][b]=c)})}delete k.source;return k};h.getMimeTable=function(){return{}};h.getMimeTable2=function(){return{mid:"fa-file-audio-o",txt:"fa-file-text-o",sql:"fa-cube",js:"fa-cube",gif:"fa-file-picture-o",jpg:"fa-file-picture-o",html:"fa-cube",htm:"fa-cube",rar:"fa-file-zip-o",gz:"fa-file-zip-o",tgz:"fa-file-zip-o",z:"fa-file-zip-o",ra:"fa-file-movie-o",ram:"fa-file-movie-o",rm:"fa-file-movie-o",pl:"source_pl.png",
zip:"fa-file-zip-o",wav:"fa-file-audio-o",php:"fa-cube",php3:"fa-cube",phtml:"fa-cube",exe:"fa-file-o",bmp:"fa-file-picture-o",png:"fa-file-picture-o",css:"fa-cube",mp3:"fa-file-audio-o",m4a:"fa-file-audio-o",aac:"fa-file-audio-o",xls:"fa-file-excel-o",xlsx:"fa-file-excel-o",ods:"fa-file-excel-o",sxc:"fa-file-excel-o",csv:"fa-file-excel-o",tsv:"fa-file-excel-o",doc:"fa-file-word-o",docx:"fa-file-word-o",odt:"fa-file-word-o",swx:"fa-file-word-o",rtf:"fa-file-word-o",md:"fa-file-word-o",ppt:"fa-file-powerpoint-o",
pps:"fa-file-powerpoint-o",odp:"fa-file-powerpoint-o",sxi:"fa-file-powerpoint-o",pdf:"fa-file-pdf-o",mov:"fa-file-movie-o",avi:"fa-file-movie-o",mpg:"fa-file-movie-o",mpeg:"fa-file-movie-o",mp4:"fa-file-movie-o",m4v:"fa-file-movie-o",ogv:"fa-file-movie-o",webm:"fa-file-movie-o",wmv:"fa-file-movie-o",swf:"fa-file-movie-o",flv:"fa-file-movie-o",tiff:"fa-file-picture-o",tif:"fa-file-picture-o",svg:"fa-file-picture-o",psd:"fa-file-picture-o",ers:"horo.png"}};h.getIconTable=function(){return{}};h.urlDecode=
function(c,a){if(!c||!c.length)return{};for(var b={},d=c.split("\x26"),f,m,k=0,e=d.length;k<e;k++)f=d[k].split("\x3d"),m=decodeURIComponent(f[0]),f=decodeURIComponent(f[1]),null!=f&&"true"===f?f=!0:"false"===f&&(f=!1),!0!==a?"undefined"==typeof b[m]?b[m]=f:("string"==typeof b[m]&&(b[m]=[b[m]]),b[m].push(f)):b[m]=f;return b};h.getUrlArgs=function(c){var a={};if(c&&(-1!=c.indexOf("?")||-1!=c.indexOf("\x26"))){c=(c.substr(c.indexOf("?")+1)||location.search.substring(1)).split("\x26");for(var b=0;b<c.length;b++){var d=
c[b].indexOf("\x3d"),f=c[b].substring(0,d),d=c[b].substring(d+1),d=decodeURIComponent(d);a[f]=d}}return a};h.urlArgs=function(c){c=h.getUrlArgs(c);var a={},b;for(b in c){var d=c[b],f=h.findOcurrences(d,{begin:"|",end:"|"}),m=null;if(f&&f.length)for(var d=d.replace(f[0],""),f=f[0].substr(1,f[0].length-2).split(","),m={},k=0;k<f.length;k++){var e=f[k].split(":");m[e[0]]=e[1]}d&&d.length&&(a[b]={value:d,options:m})}return a};h.getIcon=function(c){if(!c)return"txt2.png";if(c=h.getFileExtension(c)){var a=
h.getMimeTable();if(null!=a[c])return a[c]}return"txt2.png"};h.getIconClass=function(c){if(!c)return"fa-file-o";c=h.getFileExtension(c);if(p.customMimeIcons[c])return p.customMimeIcons[c];if(c){var a=h.getMimeTable2();if(null!=a[c])return a[c]}return"fa-file-o"};h.getFileExtension=function(c){if(!c||""==c)return"";c=h.getBaseName(c).split(".");return 1<c.length?c[c.length-1].toLowerCase():""};h.createUUID=function(){var c=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return c()+
c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()};h.getBaseName=function(c){if(null==c)return null;var a="/";-1!==c.indexOf("\\")&&(a="\\");return c.substr(c.lastIndexOf(a)+1,c.length)};h.basename=function(c,a){var b=c,d=b.charAt(b.length-1);if("/"===d||"\\"===d)b=b.slice(0,-1);b=b.replace(/^.*[\/\\]/g,"");"string"===typeof a&&b.substr(b.length-a.length)===a&&(b=b.substr(0,b.length-a.length));return b};h.pathinfo=function(c,a){var b=h.basename,d="",f="",m="",k=0,e={},q=0,l=0,g=q=!1,v=!1;if(!c)return!1;
a||(a="PATHINFO_ALL");var t={PATHINFO_DIRNAME:1,PATHINFO_BASENAME:2,PATHINFO_EXTENSION:4,PATHINFO_FILENAME:8,PATHINFO_ALL:0};for(m in t)t.hasOwnProperty(m)&&(t.PATHINFO_ALL|=t[m]);if("number"!==typeof a){a=[].concat(a);for(l=0;l<a.length;l++)t[a[l]]&&(k|=t[a[l]]);a=k}m=function(a){a+="";var b=a.lastIndexOf(".")+1;return b?b!==a.length?a.substr(b):"":!1};a&t.PATHINFO_DIRNAME&&(k=c.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,""),e.dirname=k===c?".":k);a&t.PATHINFO_BASENAME&&(!1===q&&(q=b(c)),e.basename=
q);a&t.PATHINFO_EXTENSION&&(!1===q&&(q=b(c)),!1===g&&(g=m(q)),!1!==g&&(e.extension=g));a&t.PATHINFO_FILENAME&&(!1===q&&(q=b(c)),!1===g&&(g=m(q)),!1===v&&(v=q.slice(0,q.length-(g?g.length+1:!1===g?0:1))),e.filename=v);q=0;for(d in e)e.hasOwnProperty(d)&&(q++,f=d);return 1===q?e[f]:e};h.strip_tags=function(c,a){a=(((a||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return c.replace(/\x3c!--[\s\S]*?--\x3e|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(b,
c){return-1<a.indexOf("\x3c"+c.toLowerCase()+"\x3e")?b:""})};return h})},"nxapp/protocols/MQTT":function(){define("dcl/dcl xdojo/declare xide/utils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!path dojo/node!child_process dojo/node!util dojo/node!deferred nxapp/utils/_console dojo/node!mqtt".split(" "),function(h,p,n,g,d,c,a,b,r,f,m,k){var e=!0;return h(d,{declaredClass:"nxapp.protocols.MQTT",_socket:null,protocolName:"mqtt",instance:null,subscriptions:null,mqttClient:null,
getOptions:function(a,b,c){return n.mixin({clean:!1,clientId:c.clientId||a+":"+b,port:b},c)},onConnected:function(){e&&m.log("# "+this.protocolName+" - Protocol:: onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.connection.connected=!0;this.delegate.onConnect2(this.connection)},onError:function(a,b){this.delegate.onError(this.connection,n.mixin({code:a},b),this.options)},onClose:function(a){this.delegate.onClose(this.connection,a)},connect:function(){var a=this.options;
if(!a||!a.driver)return e||this.isDebug()&&m.error("no driver in options",a),this;var b=this,c=a.host,d=a.port,a=n.getJson(a.options||{});!0===a.debug&&(e=!0);a=this.getOptions(c,d,a);this.host=c;this.port=d;this.protocol=this.protocolName;e||this.isDebug()&&m.log("MQTT-\x3econnecting to "+c+" with",a);var f=k.connect(c,a);this.mqttClient=f;try{f.on("connect",function(a){b.onConnected()})}catch(r){e||this.isDebug()&&m.error("MQTT-\x3econnect error :: code: ",r)}f.on("close",function(a){e||b.isDebug()&&
m.log("MQTT-\x3eclose :: code: ",a);b.onClose();f.end()});this._socket={};this._socket.writable=!0;return this},onData:function(a,b){this.delegate.onData(this.connection,a,b)},onCommandError:function(a,b){e||this.isDebug()&&m.log("MQTT-\x3eCommandError "+a+" id "+b.id+" src "+b.src);try{this.delegate.onData(this.connection,n.mixin({cmd:a,event:g.EVENTS.ON_COMMAND_ERROR},b))}catch(c){m.error("---",c)}},onFinish:function(a,b,c){e||this.isDebug()&&m.log("MQTT onFinish "+a+" id "+b.id+" src "+b.src);
try{this.delegate.onData(this.connection,n.mixin({cmd:a,event:g.EVENTS.ON_COMMAND_FINISH},b),c)}catch(d){m.error("onFinish-Error:",d)}},addSubscription:function(a,b,c){!this.subscriptions&&(this.subscriptions={});if(a){var d=this,e=""+a;if(!this.subscriptions[e]){b={qos:parseInt(b.qos)||0};this.mqttClient.subscribe(e,b);this.isDebug()&&m.log("add subscription : "+a+" for ",r.inspect(c,{depth:null,colors:!0}));var f=this.subscriptions[e]={id:c.params.id,src:c.params.src,topic:e};this.mqttClient.on("message",
function(a,b){if(a===e){var c=n.getJson(b.toString());if(_.isArray(c))d.onData(n.mixin({payload:c,topic:a},f));else if(_.isObject(c))c.topic||(c.topic=a),d.onData(n.mixin(c,f));else if(_.isString(c)||_.isNumber(c))d.onData(n.mixin({payload:c,topic:a},f));else m.error("-unknown "+a)}})}}else m.error("invalid topic")},unSubscribeTopic:function(a,b,c){a=n.getJson(a);(a=""+a.topic)&&this.unsubscribe(a)},subscribeTopic:function(a,b,c){a=n.getJson(a);b=n.getJson(b);c=""+a.topic;delete a.topic;this.addSubscription(c,
a,b)},publishTopic:function(a,b,c){try{a=n.getJson(a);n.getJson(b);var d=""+a.topic,f=a.qos,k=a.retain;delete a.topic;delete a.qos;delete a.retain;var r=a.payload||a;if(_.isObject(r))try{r=JSON.stringify(r)}catch(g){m.error("error generating payload",g);return}this.mqttClient.publish(d,r,{qos:f,retain:k})}catch(h){e||this.isDebug()&&m.log("---error ",h)}},send:function(a,b){},unsubscribe:function(a){a&&this.mqttClient&&this.subscriptions&&this.subscriptions[a]&&(this.mqttClient.unsubscribe(a),delete this.subscriptions[a])},
close:function(){this.mqttClient&&(_.each(this.subscriptions,this.unsubscribe,this),this.mqttClient.end(),this.mqttClient=null)}})})},"xide/data/_Base":function(){define("dojo/_base/declare dstore/Memory dstore/Tree dstore/QueryResults xide/mixins/EventedMixin xide/encoding/MD5 xdojo/has xide/lodash dojo/when dojo/Deferred".split(" "),function(h,p,n,g,d,c,a,b,r,f){return h("xide/data/_Base",d,{__all:null,allowCache:!0,_find:function(a){a=b.filter(this.data,a);return b.isArray(a)?a:b.isObject(a)?[a]:
[]},_query:function(a){var b=new f;a=this.filter(a);r(a.fetch(),function(a){b.resolve(a)});return b},constructor:function(){var a=this;if(a._getQuerierFactory("filter")||a._getQuerierFactory("sort"))this.queryEngine=function(b,c){c=c||{};var d=a._getQuerierFactory("filter"),f=d?d(b):passthrough,d=a._getQuerierFactory("sort"),k=passthrough;d&&(k=d(arrayUtil.map(c.sort,function(a){return{property:a.attribute,descending:a.descending}})));var r=passthrough;isNaN(c.start)&&isNaN(c.count)||(r=function(a){var b=
c.start||0,b=a.slice(b,b+(c.count||Infinity));b.total=a.length;return b});return function(a){return r(k(f(a)))}};var b=this;a.on("add,update,delete",function(c){var d=c.type,l=c.target;b.notify("add"===d||"update"===d?l:void 0,"delete"===d||"update"===d?"id"in c?c.id:a.getIdentity(l):void 0)})},destroy:function(){this._emit("destroy",this);delete this._queryCache;this._queryCache=null},notify:function(){},refreshItem:function(a){this.emit("update",{target:a})},_queryCache:null,query:function(d,f,
e){if(b.isEmpty(d))return this.data;_.some(d,function(a){return null==a});d&&c(JSON.stringify(d),1);a("xcf-ui");f=f||{};d=d||{};var q=this.filter(d),l;if(d=f.sort)if("[object Array]"===Object.prototype.toString.call(d))for(;e=d.pop();)q=q.sort(e.attribute,e.descending);else q=q.sort(d);"start"in f&&(l=f.start||0,l=q[q.fetchRangeSync?"fetchRangeSync":"fetchRange"]({start:l,end:f.count?l+f.count:Infinity}),l.total=l.totalLength);l=l||new g(q[q.fetchSync?"fetchSync":"fetch"]());l.observe=function(a,
b){var c=q.on("add",function(b){a(b.target,-1,b.index)}),d=q.on("update",function(c){!b&&c.previousIndex===c.index&&isFinite(c.index)||a(c.target,c.previousIndex,c.index)}),e=q.on("delete",function(b){a(b.target,b.previousIndex,-1)}),l={remove:function(){c.remove();d.remove();e.remove()}};l.cancel=l.remove;return l};a("xcf-ui");return l}})})},"dstore/Memory":function(){define("dojo/_base/declare dojo/_base/array ./Store ./Promised ./SimpleQuery ./QueryResults".split(" "),function(h,p,n,g,d,c){return h([n,
g,d],{constructor:function(){this.storage.version=0},postscript:function(){this.inherited(arguments);this.setData(this.data||[])},data:null,autoEmitEvents:!1,getSync:function(a){return this.storage.fullData[this.storage.index[a]]},putSync:function(a,b){b=b||{};var c=this.storage,d=c.index,m=c.fullData,k=this.Model;!k||a instanceof k||(a=this._restore(a));var e=this.getIdentity(a);null==e&&(this._setIdentity(a,"id"in b?b.id:Math.random()),e=this.getIdentity(a));c.version++;var c=e in d?"update":"add",
k={target:a},q;if("update"===c){if(!1===b.overwrite)throw Error("Object already exists");m.splice(q=d[e],1);e=q}else e=this.defaultNewToStart?0:m.length;var l;if("beforeId"in b){var g=b.beforeId;null===g?l=m.length:(l=d[g],q<l&&--l);void 0!==l?k.beforeId=g:(console.error("options.beforeId was specified but no corresponding index was found"),l=e)}else l=e;m.splice(l,0,a);q=isFinite(q)?Math.min(q,l):l;for(e=m.length;q<e;++q)d[this.getIdentity(m[q])]=q;this.emit(c,k);return a},addSync:function(a,b){(b=
b||{}).overwrite=!1;return this.putSync(a,b)},removeSync:function(a){var b=this.storage,c=b.index,b=b.fullData;if(a in c)return c=b.splice(c[a],1)[0],this._reindex(),!0!==this._ignoreChangeEvents&&this.emit("delete",{id:a,target:c}),!0},setData:function(a){this.parse&&(a=this.parse(a));a.items&&(this.idProperty=a.identifier||this.idProperty,a=a.items);this.storage.fullData=this.data=a;this._reindex()},_reindex:function(){for(var a=this.storage,b=a.index={},c=a.fullData,d=this.Model,m=Object.prototype,
k=0,e=c.length;k<e;k++){var q=c[k];if(d&&!(q instanceof d)){var l=this._restore(q,q.__proto__===m);q!==l&&(c[k]=q=l)}b[this.getIdentity(q)]=k}a.version++},fetchSync:function(){var a=this.data;if(!a||a._version!==this.storage.version){for(var a=this.storage.fullData,b=this.queryLog,d=0,f=b.length;d<f;d++)a=b[d].querier(a);a._version=this.storage.version;this.data=a}return new c(a)},fetchRangeSync:function(a){var b=this.fetchSync();return new c(b.slice(a.start,a.end),{totalLength:b.length})},_includePropertyInSubCollection:function(a){return"data"!==
a&&this.inherited(arguments)}})})},"dstore/Store":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/has dojo/when dojo/Deferred dojo/_base/declare dstore/QueryMethod dstore/Filter dojo/Evented".split(" "),function(h,p,n,g,d,c,a,b,r,f){function m(a){return function(b,c){var f=this;d(b,function(b){b={target:b};var d=c[1]||{};"beforeId"in d&&(b.beforeId=d.beforeId);f.emit(a,b)});return b}}g.add("object-proto",!!{}.__proto__&&!{}.watch);var k=g("object-proto");return a(f,{constructor:function(b){b&&
a.safeMixin(this,b);this.Model&&this.Model.createSubclass&&(this.Model=this.Model.createSubclass([]).extend({_store:this}));this.storage=new f;var c=this;this.autoEmitEvents&&(n.after(this,"add",m("add")),n.after(this,"put",m("update")),n.after(this,"remove",function(a,b){d(a,function(){c.emit("delete",{id:b[0]})});return a}))},autoEmitEvents:!0,idProperty:"id",queryAccessors:!0,getIdentity:function(a){return a.get?a.get(this.idProperty):a[this.idProperty]},_setIdentity:function(a,b){a.set?a.set(this.idProperty,
b):a[this.idProperty]=b},forEach:function(a,b){var c=this;return d(this.fetch(),function(d){for(var f=0,k;void 0!==(k=d[f]);f++)a.call(b,k,f,c);return d})},on:function(a,b){return this.storage.on(a,b)},emit:function(a,b){b=b||{};b.type=a;try{return this.storage.emit(a,b)}finally{return b.cancelable}},parse:null,stringify:null,Model:null,_restore:function(a,b){var c=this.Model;if(c&&a){var d=c.prototype,f=d._restore;f?a=f.call(a,c,b):k&&b?a.__proto__=d:a=h.delegate(d,a)}return a},create:function(a){return new this.Model(a)},
_createSubCollection:function(b){var c=h.delegate(this.constructor.prototype),d;for(d in this)this._includePropertyInSubCollection(d,c)&&(c[d]=this[d]);return a.safeMixin(c,b)},_includePropertyInSubCollection:function(a,b){return!(a in b)||b[a]!==this[a]},queryLog:[],filter:new b({type:"filter",normalizeArguments:function(a){var b=this.Filter;return a instanceof b?[a]:[new b(a)]}}),Filter:r,sort:new b({type:"sort",normalizeArguments:function(a,b){var c;"function"===typeof a?c=[a]:(c=a instanceof Array?
a.slice():"object"===typeof a?[].slice.call(arguments):[{property:a,descending:b}],c=p.map(c,function(a){a=h.mixin({},a);a.descending=!!a.descending;return a}),c=[c]);return c}}),select:new b({type:"select"}),_getQuerierFactory:function(a){return this["_create"+(a[0].toUpperCase()+a.substr(1))+"Querier"]}})})},"dstore/QueryMethod":function(){define([],function(){return function(h){var p=h.type,n=h.normalizeArguments,g=h.applyQuery,d=h.querierFactory;return function(){var c=Array.prototype.slice.call(arguments),
a=n?n.apply(this,c):c,c={type:p,arguments:c,normalizedArguments:a},b=this._getQuerierFactory(p)||d;b&&(c.querier=b.apply(this,a));a=this._createSubCollection({queryLog:this.queryLog.concat(c)});return g?g.call(this,a,c):a}}})},"dstore/Filter":function(){define(["dojo/_base/declare"],function(h){function p(h){return function(){var g=this.constructor,d=new g;d.type=h;d.args=arguments;return this.type?p("and").call(g.prototype,this,d):d}}h=h(null,{constructor:function(h){var g=typeof h;switch(g){case "object":var g=
this,d;for(d in h)var c=h[d],g=c instanceof this.constructor?g[c.type](d,c.args[0]):c&&c.test?g.match(d,c):g.eq(d,c);this.type=g.type;this.args=g.args;break;case "function":case "string":this.type=g,this.args=[h]}},and:p("and"),or:p("or"),eq:p("eq"),ne:p("ne"),lt:p("lt"),lte:p("lte"),gt:p("gt"),gte:p("gte"),contains:p("contains"),"in":p("in"),match:p("match")});h.filterCreator=p;return h})},"dstore/Promised":function(){define(["dojo/_base/declare","dojo/Deferred","./QueryResults","dojo/when"],function(h,
p,n,g){function d(c,a){return function(){var b=new p;try{b.resolve(this[c].apply(this,arguments))}catch(d){b.reject(d)}return a?(b=new n(b.promise),b.totalLength=g(b.totalLength),b):b.promise}}return h(null,{get:d("getSync"),put:d("putSync"),add:d("addSync"),remove:d("removeSync"),fetch:d("fetchSync",!0),fetchRange:d("fetchRangeSync",!0)})})},"dstore/QueryResults":function(){define(["dojo/_base/lang","dojo/when"],function(h,p){function n(g,d){return p(this,function(c){for(var a=0,b=c.length;a<b;a++)g.call(d,
c[a],a,c)})}return function(g,d){var c=d&&"totalLength"in d;if(g.then){g=h.delegate(g);var a=g.then(function(a){var r=c?d.totalLength:a.totalLength||a.length;a.totalLength=r;return!c&&r});g.totalLength=c?d.totalLength:a;g.response=d&&d.response}else g.totalLength=c?d.totalLength:g.length;g.forEach=n;return g}})},"dstore/SimpleQuery":function(){define(["dojo/_base/declare","dojo/_base/array"],function(h,p){function n(d,c){if(-1<d.indexOf(".")){var a=d.split("."),b=a.length;return function(d){for(var f=
0;f<b;f++)d=d&&(c&&d.get?d.get(a[f]):d[a[f]]);return d}}return function(a){return a.get?a.get(d):a[d]}}var g={eq:function(d,c){return d===c},"in":function(d,c){return-1<p.indexOf(c.data||c,d)},ne:function(d,c){return d!==c},lt:function(d,c){return d<c},lte:function(d,c){return d<=c},gt:function(d,c){return d>c},gte:function(d,c){return d>=c},match:function(d,c,a){return c.test(d,a)},contains:function(d,c,a,b){var r=this;return p.every(c.data||c,function(c){if("object"===typeof c&&c.type){var m=r._getFilterComparator(c.type);
return p.some(d,function(d){return m.call(r,d,c.args[1],a,b)})}return-1<p.indexOf(d,c)})}};return h(null,{_createFilterQuerier:function(d){function c(d){var m=d.type;d=d.args;var k=b._getFilterComparator(m);if(k){var e=d[0],q=n(e,a),l=d[1];l&&l.fetchSync&&(l=l.fetchSync());return function(a){return k.call(b,q(a),l,a,e)}}switch(m){case "and":case "or":for(var g=0,h=d.length;g<h;g++){var t=c(d[g]);r=r?function(a,b){return"and"===m?function(c){return a(c)&&b(c)}:function(c){return a(c)||b(c)}}(r,t):
t}return r;case "function":return d[0];case "string":g=b[d[0]];if(!g)throw Error("No filter function "+d[0]+" was found in the collection");return g;case void 0:return function(){return!0};default:throw Error('Unknown filter operation "'+m+'"');}}var a=this.queryAccessors,b=this,r=c(d);return function(a){return p.filter(a,r)}},_getFilterComparator:function(d){return g[d]||this.inherited(arguments)},_createSelectQuerier:function(d){return function(c){var a=d.length;return p.map(c,d instanceof Array?
function(b){for(var c={},f=0;f<a;f++){var m=d[f];c[m]=b[m]}return c}:function(a){return a[d]})}},_createSortQuerier:function(d){var c=this.queryAccessors;return function(a){a=a.slice();a.sort("function"==typeof d?d:function(a,r){for(var f=0;f<d.length;f++){var m,k=d[f];if("function"==typeof k)m=k(a,r);else{m=k.get||(k.get=n(k.property,c));var k=k.descending,e=m(a);m=m(r);null!=e&&(e=e.valueOf());null!=m&&(m=m.valueOf());m=e===m?0:!!k===(null===e||e>m&&null!==m)?-1:1}if(0!==m)return m}return 0});return a}}})})},
"dstore/Tree":function(){define(["dojo/_base/declare"],function(h){return h(null,{constructor:function(){this.root=this},mayHaveChildren:function(h){return"hasChildren"in h?h.hasChildren:!0},getRootCollection:function(){return this.root.filter({parent:null})},getChildren:function(h){return this.root.filter({parent:this.getIdentity(h)})}})})},"xide/data/TreeMemory":function(){define(["dojo/_base/declare","xide/data/Memory","dstore/Tree","dojo/Deferred","dstore/QueryResults"],function(h,p,n,g,d){return h("xide.data.TreeMemory",
[p,n],{_state:{filter:null},parentField:"parentId",reset:function(){this._state.filter=null;this.resetQueryLog()},resetQueryLog:function(){this.queryLog=[]},fetchRange:function(){var c=this._fetchRange(arguments);return new d(c.then(function(a){return a}),{totalLength:c.then(function(a){return a.length})})},filter:function(c){var a=this.inherited(arguments);this._state.filter=c;return a},_fetchRange:function(c){var a=new g;c=this.fetchRangeSync(c);if(this._state.filter){if(this._state&&this._state.filter&&
this._state.filter.parent){var b=this.getSync(this._state.filter.parent);b&&(this.reset(),c={},this.getChildrenSync?c=this.getChildrenSync(b):(c[this.parentField]=b[this.idProperty],c=this.root.query(c)))}this._state&&this._state.filter&&this._state.filter.group&&(this.getSync(this._state.filter.parent),b&&(this.reset(),c=b.items))}a.resolve(c);return a},children:function(c){for(var a=this.root.data,b=[],d=0;d<a.length;d++){var f=a[d];f[this.parentField]==c[this.idProperty]&&b.push(f)}return a},mayHaveChildren:function(c){return!1===
c._mayHaveChildren?!1:!0}})})},"xide/data/Memory":function(){define(["dojo/_base/declare","dstore/Memory","xide/data/_Base"],function(h,p,n){return h("xide.data.Memory",[p,n],{})})},"xide/data/ObservableStore":function(){define(["dojo/_base/declare","xide/types","xide/mixins/EventedMixin"],function(h,p,n){return h("xide/data/Observable",n,{_ignoreChangeEvents:!0,observedProperties:[],mute:!1,silent:function(g){this._ignoreChangeEvents=g},putSync:function(g,d){this._ignoreChangeEvents=!0;var c=this.inherited(arguments);
this._ignoreChangeEvents=!1;!1!==d&&this.emit("added",c);return c},removeSync:function(g){var d=this.getSync(g);d&&d.onRemove&&d.onRemove();return this.inherited(arguments)},postscript:function(){var g=this;g.inherited(arguments);if(g.on)g.on("add",function(d){d=d.target;g._observe(d);d._store||(d._store=g);d._onCreated&&d._onCreated();d.onAdd&&d.onAdd(d)})},_onItemChanged:function(g,d,c,a){this._ignoreChangeEvents||(d={target:g,property:d,value:c,source:a},this.emit("update",d),g.onItemChanged&&
g.onItemChanged(d))},_observe:function(g){var d=this,c=d.observedProperties;g&&g.observed&&(c=c.concat(g.observed));c&&c.forEach(function(a){g.property(a).observe(function(b){d._ignoreChangeEvents||d._onItemChanged(g,a,b,d)})})},setData:function(g){this.inherited(arguments);this._ignoreChangeEvents=!0;g&&_.each(g,this._observe,this);this._ignoreChangeEvents=!1}})})},"dstore/Trackable":function(){define("dojo/_base/lang dojo/_base/declare dojo/aspect dojo/when dojo/promise/all dojo/_base/array dojo/on".split(" "),
function(h,p,n,g,d,c,a){function b(a,b,c){for(var d=a.length-1;0<=d;--d){var l=a[d],f=l.start,l=f+l.count;if(b>l){a.splice(d+1,0,{start:b,count:c-b});return}c>=f&&(b=Math.min(b,f),c=Math.max(c,l),a.splice(d,1))}a.unshift({start:b,count:c-b})}var r=0,f={track:function(){function d(){return function(){var a=this,c=this.inherited(arguments);g(c,function(c){c=a._results=c.slice();a._partialResults&&(a._partialResults=null);a._ranges=[];b(a._ranges,0,c.length)});return c}}function f(){return function(a){var c=
this,d=a.start,e=a.end,l=this.inherited(arguments);this._results||g(l,function(a){return g(a.totalLength,function(l){var q=c._partialResults||(c._partialResults=[]);e=Math.min(e,d+a.length);q.length=l;l=[d,e-d].concat(a);q.splice.apply(q,l);b(c._ranges,d,e);return a})});return l}}function e(a,b){r++;var d=b.target;b=h.delegate(b,w[a]);g(t._results||t._partialResults,function(e){if(e){var l,f,k,m=t._ranges,r,g="id"in b?b.id:q.getIdentity(d),h=-1,u=-1,v=-1,n=-1;if("delete"===a||"update"===a)for(l=0;-1===
h&&l<m.length;++l)for(r=m[l],f=r.start,k=f+r.count;f<k;++f)if(q.getIdentity(e[f])==g){h=b.previousIndex=f;u=l;e.splice(h,1);r.count--;for(f=l+1;f<m.length;++f)m[f].start--;break}if("add"===a||"update"===a){if(y){if(y([d]).length){var w=0;k=m.length-1;f=-1;for(var p;w<=k&&-1===v;)l=w+Math.round((k-w)/2),r=m[l],u=e.slice(r.start,r.start+r.count),"beforeId"in b&&(f=null===b.beforeId?u.length:A(u,b.beforeId)),-1===f&&(f=h>=Math.max(0,r.start-1)&&h<=r.start+r.count?h:q.defaultNewToStart?0:u.length),u.splice(f,
0,d),g=c.indexOf(y(u),d),p=r.start+g,0===g&&0!==r.start?k=l-1:g>=u.length-1&&p<e.length?w=l+1:(v=p,n=l);if(-1===v&&0<w&&w<m.length)var P=!0}}else{f=-1;if("beforeId"in b)if(null===b.beforeId)v=e.length,f=m.length-1;else for(l=0,k=m.length;-1===n&&l<k;++l)r=m[l],v=A(e,b.beforeId,r.start,r.start+r.count),-1!==v&&(n=l);else"update"===a?(v=h,n=u):q.defaultNewToStart?f=v=0:(v=e.length,f=m.length-1);-1!==f&&-1===n&&(r=m[f])&&r.start<=v&&v<=r.start+r.count&&(n=f)}if(-1<v&&-1<n)for(b.index=v,e.splice(v,0,
d),m[n].count++,l=n+1;l<m.length;++l)m[l].start++;else if(P)for(b.beforeIndex=m[w].start,l=w;l<m.length;++l)m[l].start++}b.totalLength=e.length}(e=t["on_tracked"+a])&&e.call(t,b)})}var q=this.store||this,l=[],u={add:1,update:1,"delete":1},v;for(v in u)l.push(this.on(v,function(a){return function(b){e(a,b)}}(v)));var t=p.safeMixin(h.delegate(this),{_ranges:[],fetch:d(),fetchRange:f(),releaseRange:function(a,b){if(this._partialResults){a:for(var c=this._ranges,d=0,e;e=c[d];++d){var l=e.start,f=l+e.count;
if(a<=l)if(b>=f)c.splice(d,1);else{e.start=b;e.count=f-e.start;break a}else if(a<f)if(b>l){c.splice(d,1,{start:l,count:a-l},{start:b,count:f-b});break a}else e.count=a-e.start}for(c=a;c<b;++c)delete this._partialResults[c]}},on:function(b,c){var d=this,e=this.getInherited(arguments);return a.parse(t,b,c,function(a,b){return b in u?n.after(t,"on_tracked"+b,c,!0):e.call(d,b,c)})},tracking:{remove:function(){for(;0<l.length;)l.pop().remove();this.remove=function(){}}},track:null});this.fetchSync&&(p.safeMixin(t,
{fetchSync:d(),fetchRangeSync:f()}),t.fetchSync());var y;c.forEach(this.queryLog,function(a){var b=y,c=a.querier;c&&(y=b?function(a){return c(b(a))}:c)});var w={add:{index:void 0},update:{previousIndex:void 0,index:void 0},"delete":{previousIndex:void 0}},A=function(a,b,c,d){d=void 0!==d?d:a.length;for(c=void 0!==c?c:0;c<d;++c)if(q.getIdentity(a[c])===b)return c;return-1};return t}};d=p(null,f);d.create=function(a,b){a=p.safeMixin(h.delegate(a),f);p.safeMixin(a,b);return a};return d})},"xide/manager/ContextBase":function(){define("dcl/dcl xide/factory xide/types xide/utils xide/mixins/EventedMixin dojo/_base/kernel dojo/_base/lang".split(" "),
function(h,p,n,g,d,c,a){d=h(d.dcl,{declaredClass:"xide.manager.ContextBase",language:"en",managers:[],mixins:null,getModule:function(b){return a.getObject(g.replaceAll("/",".",b))||a.getObject(b)||(h.getObject?h.getObject(b)||h.getObject(g.replaceAll("/",".",b)):null)},createManager:function(a,d,f){try{this.managers||(this.managers=[]);var m={ctx:this,config:d||this.config};g.mixin(m,f);if(_.isString(a)&&this.namespace){var k=null,k=-1==a.indexOf(".")?this.namespace+a:""+a;a=c.getObject(k)&&h.getObject(k)?
k:this.defaultNamespace+a}else _.isObject(a);var e=p.createInstance(a,m);if(e)return this.managers.push(e),p.publish(n.EVENTS.ON_CREATED_MANAGER,{instance:e,className:a,ctx:this,config:d||this.config}),e}catch(q){console.error("error creating manager "+q,arguments)}},constructManagers:function(){},initManagers:function(){},doMixins:function(a){this.mixins=a||this.mixins;for(var d=0;d<a.length;d++){var f=a[d],m=c.getObject(f.declaredClass)||h.getObject(f.declaredClass);f.declaredClass===this.declaredClass&&
(m=this);m&&g.mixin(m.prototype,f.mixin)}}});h.chainAfter(d,"constructManagers");h.chainAfter(d,"initManagers");return d})},"nxapp/Commons":function(){define("dojo/has dojo/_base/lang nxapp/types/Types xide/factory xide/factory/Events xide/factory/Objects xide/utils/StringUtils xide/utils/HexUtils xide/utils/CIUtils xide/utils/ObjectUtils xide/utils/StoreUtils nxapp/utils/FileUtils xide/utils nxapp/utils dojo/node!os dojo/node!util nxapp/utils/_console".split(" "),function(h,p,n,g,d,c,a,b,r,f,m,k,
e,q,l,u,v){p="linux";"win32"===l.platform()?p="windows":"darwin"===l.platform()?p="osx":"linux"===l.platform()&&"arm"==l.arch()&&(p="arm");"arm"===p?h.add("serialport",function(){return!1}):h.add("serialport",function(){return!0});e.mixin(q,e);e.mixin(e,q);e.inspect=function(a){return u.inspect(a,{depth:null,colors:!0})};Array.prototype.remove=function(){for(var a,b=arguments,c=b.length,d;c&&this.length;)for(a=b[--c];-1!=(d=this.indexOf(a));)this.splice(d,1);return this};Array.prototype.contains=
function(a){for(var b=this.length;b--;)if(this[b]==a)return!0;return!1};Array.prototype.indexOfPropertyValue||(Array.prototype.indexOfPropertyValue=function(a,b){for(var c=0;c<this.length;c++)if(this[c][a]&&this[c][a]==b)return c;return-1});"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.substring(0,a.length)===a});"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.substring(this.length-a.length,this.length)===
a});return{utils:q,types:n}})},"xide/factory/Objects":function(){define(["dcl/dcl","xide/utils","xide/factory","xdojo/declare"],function(h,p,n,g){n.createInstance=function(d,c,a){var b={};p.mixin(b,c);c=d;if(_.isString(d)&&(c=dojo.getObject(c)||h.getObject(c),!c))return console.error("no such class : "+d),null;a&&(c=g(a,c.prototype));b.id||(b.id=(c.declaredClass||"no_class_").replace(/\//g,"_")+p.createUUID());(d=new c(b))&&(d.ctrArgs=b);return d};return n})},"xide/utils/CIUtils":function(){define(["xide/utils",
"xide/types","xide/factory","dojo/has","xide/lodash"],function(h,p,n,g,d){h.toOptions=function(c){c=h.flattenCIS(c);for(var a=[],b=0;b<c.length;b++){var d=c[b];a.push({name:h.toString(d.name),value:h.getCIValue(d),type:h.toInt(d.type),enumType:h.toString(d.enumType),visible:h.toBoolean(d.visible),active:h.toBoolean(d.active),changed:h.toBoolean(d.changed),group:h.toString(d.group),user:h.toObject(d.user),dst:h.toString(d.dst),params:h.toString(d.params)})}return a};if(g("xideve")||g("xblox-ui"))h.getEventsAsOptions=
function(c){var a=[{label:"Select Event",value:""}],b;for(b in p.EVENTS)a.push({label:p.EVENTS[b],value:p.EVENTS[b]});a=a.concat([{label:"onclick",value:"onclick"},{label:"ondblclick",value:"dblclick"},{label:"onmousedown",value:"mousedown"},{label:"onmouseup",value:"mouseup"},{label:"onmouseover",value:"mouseover"},{label:"onmousemove",value:"mousemove"},{label:"onmouseout",value:"mouseout"},{label:"onkeypress",value:"keypress"},{label:"onkeydown",value:"keydown"},{label:"onkeyup",value:"keyup"},
{label:"onfocus",value:"focus"},{label:"onblur",value:"blur"},{label:"On Load",value:"Load"}]);for(b=0;b<a.length;b++){var d=a[b];if(d.value===c){d.selected=!0;break}}return a};h.flattenCIS=function(c){for(var a=[],b=[],d=0;d<c.length;d++){var f=c[d],m=h.toInt(f.type);m>p.ECIType.END&&(m=p.resolveType(m))&&(h.mixin(a,m),b.push(f))}0<a.length&&(c=c.concat(a));if(b)for(d in b)c.remove(b[d]);return c};h.arrayContains=function(c,a){for(var b=0;b<c.length;b++)if(c[b]===a)return!0;return!1};h.setStoreCIValueByField=
function(c,a,b){null==c[a]&&(c[a]=[]);c[a][0]=h.getStringValue(b);return c};h.createOption=function(c,a,b){return h.mixin({label:c,value:null!=a?a:c},b)};h.createCI=function(c,a,b,d,f){c={dataRef:null,dataSource:null,name:c,group:-1,id:c,title:c,type:a,uid:-1,value:null!=b?b:-1,visible:!0,enumType:-1,"class":"cmx.types.ConfigurableInformation"};h.mixin(c,d);f&&f.publish&&n.publish(f.publish,{CI:c,owner:f.owner},f.owner);return c};h.createCIAsArray=function(c,a,b,d){return{chainType:[b?b:0],dataRef:[null],
dataSource:[null],params:[],name:[c],group:[-1],id:[c],title:[c],type:[a],uid:[-1],value:[d?d:-1],visible:[!0],enumType:[-1],parentId:[-1],"class":["cmx.types.ConfigurableInformation"]}};h.hasValue=function(c){return c.value&&null!=c.value[0]&&0<c.value[0].length&&"0"!=c.value[0]&&"undefined"!=c.value[0]&&"Unset"!=c.value[0]};h.hasValueAndDataRef=function(c){return c.value&&null!=c.value[0]&&0<c.value[0].length&&"0"!=c.value[0]&&"undefined"!=c.value[0]&&"Unset"!=c.value[0]&&c.dataRef&&null!=c.dataRef[0]&&
0<c.dataRef[0].length&&"0"!=c.dataRef[0]&&"undefined"!=c.dataRef[0]};h.getInputCIByName=function(c,a){if(!c)return null;var b=c.inputs;b||(b=c);if(null!=b)for(var d=0;d<b.length;d++){var f=b[d],m=h.getStringValue(f.name);if(null!=m&&m.toLowerCase()===a.toLowerCase())return f}return null};h.getCIByChainAndName=function(c,a,b){if(!c)return null;(a=0==a?c.inputs:1==a?c.outputs:null)||(a=c);if(null!=a)for(c=0;c<a.length;c++){var d=a[c],f=h.getStringValue(d.name);if(null!=f&&f.toLowerCase()===b.toLowerCase())return d}return null};
h.getCIByUid=function(c,a){if(null!=c)for(var b=0;b<c.length;b++){var d=c[b],f=h.getStringValue(d.uid);if(null!=f&&f===a)return d}return null};h.getCIById=function(c,a,b){c=0==a?c.inputs:1==a?c.outputs:null;if(null!=c)for(a=0;a<c.length;a++){var d=c[a];if(d.id[0]==b[0])return d}return null};h.getCIInputValueByName=function(c,a){var b=h.getCIByChainAndName(c,0,a);return b?b.value:null};h.getCIValue=function(c){return h.getCIValueByField(c,"value")};h.getStringValue=function(c){return h.toString(c)};
h.toString=function(c){return null!=c?d.isArray(c)?c&&1==c.length&&null==c[0]?null:""+(null!=c[0]?c[0]:c):""+c:null};h.setIntegerValue=function(c,a){null!=c&&dojo.isArray(c)&&(c[0]=a)};h.getCIValueByField=function(c,a){return null!=c[a]?d.isArray(c[a])?c[a][0]?c[a][0]:c[a]:c[a]:null};h.setCIValueByField=function(c,a,b){if(!c)return c;null==c[a]&&(c[a]=[]);c[a]=b;return c};h.setCIValue=function(c,a,b){(c=h.getInputCIByName(c,a))&&h.setCIValueByField(c,"value",b);return c};h.getCIInputValueByNameAndField=
function(c,a,b){return(c=h.getCIByChainAndName(c,0,a))?c[""+b]:null};h.getCIInputValueByNameAndFieldStr=function(c,a,b){return(c=h.getCIInputValueByNameAndField(c,a,b))?h.getStringValue(c):null};h.getCIInputValueByNameAndFieldBool=function(c,a,b){return(c=h.getCIInputValueByNameAndField(c,a,b))?h.toBoolean(c):null};h.getCIWidgetByName=function(c,a){for(var b=0;b<c.length;b++){var d=c[b];if(d._widget&&d.name===a)return d._widget}return null};return h})},"xide/utils/StoreUtils":function(){define(["xide/utils",
"xide/data/Memory","dojo/_base/kernel"],function(h,p,n){h.removeFromStore=function(g,d,c,a,b){g.removeSync(d[a]);var r={};r[b]=d[a];if((d=g.query(r))&&d.length)for(r=0;r<d.length;r++)h.removeFromStore(g,d[r],c,a,b)};h.toString=function(g){return null!==g?n.isArray(g)?g&&1==g.length&&null==g[0]?null:""+(null!==g[0]?g[0]:g):""+g:null};h.toBoolean=function(g){var d=!1;null!==g&&(g=g[0]?g[0]:g,null!==g&&(d=!(!0!==g&&"true"!==g&&"1"!==g)));return d};h.toObject=function(g){return null!==g?g[0]?g[0]:g:null};
h.toInt=function(g){if(_.isNumber(g))return g;var d=-1;if(null!=g&&(g=1<g.length?g:g[0]?g[0]:g,null!==g))try{d=parseInt(g,10)}catch(c){}return d};h.getStoreItemById=function(g,d){return h.queryStoreEx(g,{id:d},null,null)};h.getAppDataElementByIdAndType=function(g,d,c){return h.queryStore(g,{uid:d,type:c},null,null)};h.getElementsByType=function(g,d){return h.queryStoreEx(g,{type:d})};h.queryStoreEx=function(g,d,c,a){if(!g)return console.error("utils.queryStoreEx: store \x3d null"),null;if(g instanceof
p)return g=h.queryMemoryStoreEx(g,d),a&&g&&g[0]?g[0]:g;var b=null;g.query&&(b=g.query(d));return!0===c&&b&&0===b.length?null:!0===a&&b&&1==b.length?b[0]:b};h.queryStore=function(g,d,c){return(g=h.queryStoreEx(g,d,null,null))&&1==g.length?g[0]:null!==c&&!0===c&&g&&0===g.length?null:g};h.queryMemoryStoreEx=function(g,d){var c=[];g.query(d).forEach(function(a){c.push(a)});return c};h.queryMemoryStoreSingle=function(g,d){var c=h.queryMemoryStoreEx(g,d);return 1==c.length?c[0]:c};return h})},"nxapp/manager/FileManager":function(){define("dcl/dcl dojo/has nxapp/manager/ManagerBase nxapp/utils/_LogMixin xide/types xide/factory dojo/node!path dojo/node!fs dojo/node!child_process dojo/node!chokidar".split(" "),
function(h,p,n,g,d,c,a,b,r,f){p("windows");p("arm");return h([n,g],{declaredClass:"nxapp.manager.FileManager",watcher:null,resolve:function(c){var d="",e=a.resolve(dojoConfig.libRoot),f=a.resolve(dojoConfig.clientRoot);if(b.existsSync(a.resolve(c)))return c;"/"==c[0]?a.resolve(c):a.resolve(e+"/"+c)?d=a.resolve(e+"/"+c):b.existsSync(a.resolve(c))?d=a.resolve(c):a.resolve(f+"/"+c)&&(d=a.resolve(f+"/"+c));return d},watch:function(a,c){try{console.log("watch directory : "+this.resolve(a)),b.existsSync(a)&&
c&&this.watcher&&this.watcher.add&&this.watcher.add(a)}catch(d){}},initChokidar:function(m){for(var k=0;k<m.watchr.paths.length;k++){var e=m.watchr.paths[k],q=a.resolve(dojoConfig.libRoot),l=a.resolve(dojoConfig.clientRoot);"/"==e[0]?e=a.resolve(e):a.resolve(e)&&b.existsSync(e)?m.watchr.paths[k]=a.resolve(e):b.existsSync(a.resolve(q+"/"+e))?m.watchr.paths[k]=a.resolve(q+"/"+e):b.existsSync(a.resolve(e))?m.watchr.paths[k]=a.resolve(e):a.resolve(l+"/"+e)&&(m.watchr.paths[k]=a.resolve(l+"/"+e))}var r=
this,g=f.watch(m.watchr.paths,{persistent:!0,ignoreInitial:!0,awaitWriteFinish:!0});g.on("addDir",function(a){g.add(a);c.publish(d.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:a.replace(dojoConfig.libRoot,"")},r)});g.on("add",function(a){c.publish(d.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:a.replace(dojoConfig.libRoot,""),type:"added"},r)});g.on("unlinkDir",function(a){g.unwatch(a);c.publish(d.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:a.replace(dojoConfig.libRoot,""),type:"delete"},r)});g.on("change",
function(a){r.publish(d.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:a.replace(dojoConfig.libRoot,""),type:"changed"},r)});g.on("raw",function(a,b,e){if("rename"===a)try{var l=l.statSync(e.watchedPath)}catch(f){-1!==e.watchedPath.indexOf(b)&&c.publish(d.EVENTS.ON_FILE_CHANGED,{path:e.watchedPath,modulePath:e.watchedPath.replace(dojoConfig.libRoot,""),type:"delete"},r)}});this.watcher=g},initWindows_Watchr:function(f){for(var k=0;k<f.watchr.paths.length;k++){var e=f.watchr.paths[k],q=a.resolve(dojoConfig.libRoot),
l=a.resolve(dojoConfig.clientRoot);"/"==e[0]?e=a.resolve(e):a.resolve(q+"/"+e)?f.watchr.paths[k]=a.resolve(q+"/"+e):b.existsSync(a.resolve(e))?f.watchr.paths[k]=a.resolve(e):a.resolve(l+"/"+e)&&(f.watchr.paths[k]=a.resolve(l+"/"+e))}_.each(f.watchr.paths,function(a){});var r=this;watchr.watch({paths:f.watchr.paths,interval:500,listeners:{log:function(a){},error:function(a){console.log("an error occured:",a)},watching:function(a,b,c){},change:function(a,b,e,l){b&&c.publish(d.EVENTS.ON_FILE_CHANGED,
{path:b,modulePath:b.replace(dojoConfig.libRoot,"")},r)}},next:function(a,b){if(a)return console.log("watching everything failed with error",a);console.log("watching everything completed")}})},initWindows:function(c){for(var d=0;d<c.watchr.paths.length;d++){var e=c.watchr.paths[d],f=a.resolve(dojoConfig.libRoot),l=a.resolve(dojoConfig.clientRoot);"/"==e[0]?e=a.resolve(e):a.resolve(f+"/"+e)?c.watchr.paths[d]=a.resolve(f+"/"+e):b.existsSync(a.resolve(e))?c.watchr.paths[d]=a.resolve(e):a.resolve(l+"/"+
e)&&(c.watchr.paths[d]=a.resolve(l+"/"+e))}var g=new function(a,b,c,d){var e=r.spawn;a=e(a,b);var l=this;a.stdout.on("data",function(a){c(l,a)});a.stdout.on("end",d)}(a.resolve(global.cwd+"/inotifywait.exe"),["-r","-m","-q","--format\x3d%w|%e|%f",c.watchr.paths[0]],function(b,c){b.stdout="";for(var d=c.toString().split(/(\r?\n)/g),e=0;e<d.length;e++){var l=d[e];l&&5<l.length&&(l=l.split("|"),3==l.length&&a.resolve(l[0]+"/"+l[2]))}},function(){console.log("end : "+g.stdout)})},init:function(a){return this.initChokidar(a)},
initLinux:function(f,k){for(var e=0;e<f.watchr.paths.length;e++){var q=f.watchr.paths[e],l=a.resolve(dojoConfig.libRoot),r=a.resolve(dojoConfig.clientRoot);"/"==q[0]?q=a.resolve(q):a.resolve(l+"/"+q)?f.watchr.paths[e]=a.resolve(l+"/"+q):b.existsSync(a.resolve(q))?f.watchr.paths[e]=a.resolve(q):a.resolve(r+"/"+q)&&(f.watchr.paths[e]=a.resolve(r+"/"+q))}for(var g=this,h=function(a){var c=[];b.existsSync(a)&&b.readdirSync(a).forEach(function(d){d=a+"/"+d;var e=b.statSync(d);e&&e.isDirectory()&&(c.push(d),
c=c.concat(h(d)))});return c},q=function(){return{all_events:function(b){if(b&&b.name&&b.name.indexOf&&-1==b.name.indexOf(".git")&&-1==b.name.indexOf(".tmp")&&-1==b.name.indexOf("_jb_old_")&&-1==b.name.indexOf("_jb_bak_")&&-1==b.masks.toString().indexOf("access")){b.masks.toString().indexOf("moved_to");var e=a.resolve(b.watch+"/"+b.name),l="changed";-1!==b.masks.toString().replace("all_events,","").indexOf("delete")&&(l="deleted");e&&c.publish(d.EVENTS.ON_FILE_CHANGED,{path:e,modulePath:e.replace(dojoConfig.libRoot,
""),type:l},g)}},close_write:function(b){-1==b.name.indexOf(".git")&&-1==b.name.indexOf(".tmp")&&-1==b.name.indexOf("_jb_old_")&&-1==b.name.indexOf("_jb_bak_")&&-1==b.masks.toString().indexOf("access")&&-1==b.masks.toString().indexOf("moved_to")&&(b=a.resolve(b.watch+"/"+b.name))&&c.publish(d.EVENTS.ON_FILE_CHANGED,{path:b,modulePath:b.replace(dojoConfig.libRoot,"")},g)},access:!0,moved_to:!0,moved_from:!0,"delete":!0}}(),l=k.create(!1),r=0;r<f.watchr.paths.length;r++)if(e=f.watchr.paths[r],b.existsSync(e)){var n=
h(e);l.watch(q,e);for(e=0;e<n.length;e++)l.watch(q,n[e])}}})})},"nxapp/manager/ExportManager":function(){define("dcl/dcl nxapp/manager/ManagerBase nxapp/manager/_Drivers_Devices nxapp/utils/_LogMixin nxapp/utils/_console xide/utils nxapp/utils dojo/node!path dojo/node!fs-jetpack dojo/node!cheerio dojo/node!fs dojo/has".split(" "),function(h,p,n,g,d,c,a,b,r,f,m,k){return h([p,g,n],{declaredClass:"nxapp.manager.ExportManager",options:null,serverTemplates:null,linux32:!0,linux64:!0,osx:!0,arm:!0,windows:!0,
nginxOptions:null,mongoOptions:null,serverOptions:null,init:function(a){this.profile=a},run:function(a){this.delegate=a;this.initWithOptions(this.options)},onProgress:function(a){this.delegate&&this.delegate.onProgress(a);d.log("Progress:  "+a)},onError:function(a){this.delegate&&this.delegate.onError(a)},onFinish:function(a){this.delegate&&this.delegate.onFinish(a);d.log("Finish:  "+a)},initWithOptions:function(e){this.options=e;c.mixin(this,e);this.onProgress("Export Manager: begin export",{progress:0});
if(!this.root)throw this.onError("Export Manager: have no root"),Error("Export Manager: have no root");if(!this.data)throw this.onError("Export Manager: have no data"),Error("Export Manager: have no data");if(this.user){this.client||(this.client=a.resolve(this.root+"/dist/all/Code/client/"));this.serverTemplates||(this.serverTemplates=a.resolve(this.root+"/server-template"));this.dist||(this.dist=a.resolve(this.root+"/dist/all/server/"));d.log("export with \n",c.inspect({"System Data":this.data,"User Data":this.user+
" \x3d "+b.resolve(this.user),Root:b.resolve(this.root),"Server-Templates":this.serverTemplates,Target:b.resolve(this.target),"Node Servers":b.resolve(this.dist),Client:this.client,"Export Windows":this.windows,"Export Linux - 32 ":this.linux32,"Export Linux - 64 ":this.linux64,"Export OSX":this.osx,"Export ARM":this.arm}));e=c.mixin({port:8889,templatePath:a.resolve(this.serverTemplates+"/nginx/all/conf/nginx.app.template.conf")},this.nginxOptions);var f=c.mixin({port:9997,mongo_port:27018,mqtt_port:1884},
this.serverOptions);this.exportNGINX(e);this.exportMongo(this.mongoOptions||{});this.createDirectoryLayout();this.exportServer();this.onProgress("Exported Servers",{progress:.2});this.exportUser();this.onProgress("Exported User",{progress:.3});this.exportSystem();this.onProgress("Exported System Data",{progress:.4});this.exportMisc(f);this.onProgress("Exported Misc Data",{progress:.5});this.exportHTML(f);this.onProgress("Exported User Workspace HTML",{progress:.6});this.exportDevices({serverSide:!0});
this.onProgress("Exported Devices",{progress:.7});this.exportDrivers({});this.onProgress("Exported Drivers",{progress:.8});this.client?this.exportClientEx():this.exportClientDist();this.onProgress("Exported Client Application Assets",{progress:.9});d.log("Export Done! Your application can be found at "+this.target);this.onProgress("Export Done",{progress:1.2});this.onFinish("Export Done! Your application can be found at "+this.target)}else this.onError("Export Manager: have no user")},exportHTML:function(a){function c(b,
d){var q=m.readdirSync(b);q.length&&_.each(q,function(c){if(-1!==c.indexOf(".dhtml")){var q=d.replace(l.path()+"/","");f.exportHTMLFile2(b+"/"+c,q,a)}})}var l=r.dir(this.target+"/www/user/workspace/"),f=this;(function(l){m.existsSync(l)?m.readdirSync(l).forEach(function(k){k=l+"/"+k;var r=m.statSync(k);if(r){var g=k.replace(b+"/","");r.isDirectory()?c(k,g):-1!==k.indexOf(".dhtml")&&(g=g.replace(l+"/",""),f.exportHTMLFile2(k,g,a))}else d.error("cant get stat for "+k)}):d.error("device path "+l+" doesnt exists");
return[]})(l.path())},exportHTMLFile2:function(a,d,l){var k=r.dir(this.root+"/export/"),k=c.readFile(b.resolve(k.path()+"/app.template.html")),m=c.pathinfo(a);d===m.basename&&(d="");d=c.mixin({libRoot:"/Code/client/src/lib",lodashUrl:"/Code/client/src/lib/external/lodash.min.js",requireBaseUrl:"/Code/client/src/lib/xibm/ibm",jQueryUrl:"/Code/client/src/lib/external/jquery-1.9.1.min.js",data:"",user:"/user",css:"./"+c.cleanUrl(m.filename+".css"),theme:"bootstrap",blox_file:"./"+d+"/"+m.filename+".xblox",
scene_file:"./"+d+"/"+m.filename+".dhtml",mount:"workspace",VFS_VARS:JSON.stringify({user_drivers:"./www/user/drivers",system_drivers:"./www/system/drivers"},null,2)},l);k=c.replace(k,null,d,{begin:"%",end:"%"});d=c.readFile(a);d=d.replace("\x3cviewHeaderTemplate/\x3e",k);d=d.replace(/\burl\s*\(\s*["']?([^"'\r\n\)\(]+)["']?\s*\)/gi,function(a,b){var c=b.split("://"),d=c[1];return c[0]&&d?"url('./"+d+"')":b});k=f.load(d);d='\n\x3cscript type\x3d"text/javascript"\x3e\n\tvar test \x3d 0;\n\x3c/script\x3e';
k("HEAD").append(k(d));c.writeFile(a.replace(".dhtml",".html"),k.html())},exportHTMLFile:function(a){var q=r.dir(this.root+"/export/"),l=r.dir(this.target+"/www/user/workspace/"),l=b.resolve(l.path()+"/ascene.dhtml"),q=c.readFile(b.resolve(q.path()+"/app.template.html"));a=c.mixin({libRoot:"/Code/client/src/lib",lodashUrl:"/Code/client/src/lib/external/lodash.min.js",requireBaseUrl:"/Code/client/src/lib/xibm/ibm",jQueryUrl:"/Code/client/src/lib/external/jquery-1.9.1.min.js",data:"",user:"/user",css:"./ascene.css",
theme:"bootstrap",blox_file:"./ascene.xblox",mount:"workspace",VFS_VARS:JSON.stringify({user_drivers:"./www/user/drivers",system_drivers:"./www/system/drivers"},null,2)},a);q=c.replace(q,null,a,{begin:"%",end:"%"});a=c.readFile(l);a=a.replace("\x3cviewHeaderTemplate/\x3e",q);a=a.replace(/\burl\s*\(\s*["']?([^"'\r\n\)\(]+)["']?\s*\)/gi,function(a,b){var c=b.split("://"),e=c[1];return c[0]&&e?(d.error("----"+e),"url('./"+e+"')"):b});a=f.load(a);q='\n\x3cscript type\x3d"text/javascript"\x3e\n\tvar test \x3d 0;\n\x3c/script\x3e';
a("HEAD").append(a(q));c.writeFile(l.replace(".dhtml",".html"),a.html())},exportDevices:function(a){var d=b.resolve(this.target+"/www/user/devices"),l=this.getDevices(d,"user_devices",a);c.writeFile(d+"/user_devices.json",JSON.stringify({items:l},null,2));d=b.resolve(this.target+"/www/system/devices");l=this.getDevices(d,"system_devices",a);c.writeFile(d+"/system_devices.json",JSON.stringify({items:l},null,2))},exportDrivers:function(a){var d=b.resolve(this.target+"/www/user/drivers");a=this.getDrivers(d,
"user_drivers");c.writeFile(d+"/user_drivers.json",JSON.stringify({items:a},null,2));d=b.resolve(this.target+"/www/system/drivers");a=this.getDrivers(d,"system_drivers");c.writeFile(d+"/system_drivers.json",JSON.stringify({items:a},null,2))},exportMisc:function(d){var f=r.dir(this.root+"/export"),l=r.dir(this.target);r.copy(f.path(),l.path(),{matching:["**"],overwrite:!0});var k=a.readFile(b.resolve(f.path()+"/profile_device_server.json")),k=c.replace(k,null,d,{begin:"%",end:"%"});"false"!==this.linux32&&
c.writeFile(l.path()+b.sep+"/server/linux_32/nxappmain/profile_device_server.json",k);"false"!==this.linux64&&c.writeFile(l.path()+b.sep+"/server/linux_64/nxappmain/profile_device_server.json",k);"false"!==this.windows&&"false"!==this.windows&&c.writeFile(l.path()+b.sep+"/server/windows/nxappmain/profile_device_server.json",k);"false"!==this.arm&&c.writeFile(l.path()+b.sep+"/server/arm/nxappmain/profile_device_server.json",k);"false"!==this.osx&&c.writeFile(l.path()+b.sep+"/server/osx/nxappmain/profile_device_server.json",
k);k=a.readFile(b.resolve(f.path()+"/start.js"));k=c.replace(k,null,d,{begin:"%",end:"%"});"false"!==this.linux32&&c.writeFile(l.path()+"/server/linux_32/start.js",k);"false"!==this.linux64&&c.writeFile(l.path()+"/server/linux_64/start.js",k);"false"!==this.windows&&c.writeFile(l.path()+"/server/windows/start.js",k);"false"!==this.arm&&c.writeFile(l.path()+"/server/arm/start.js",k);"false"!==this.osx&&c.writeFile(l.path()+"/server/osx/start.js",k)},exportClientEx:function(){var a=r.dir(b.resolve(this.client)+
""),c=r.dir(this.target+"/www/Code/client");r.copy(a.path(),c.path(),{matching:["**"],overwrite:!0})},exportClient:function(){var a=r.dir(this.root+"/Code/client"),b=r.dir(this.target+"/www/Code/client");r.copy(a.path(),b.path(),{matching:["**"],overwrite:!0})},exportClientDist:function(){var a=r.dir(this.root+"/dist/all/Code/client/"),b=r.dir(this.target+"/www/Code/client");r.copy(a.path(),b.path(),{matching:["**"],overwrite:!0})},exportUser:function(){var a=r.dir(this.user),b=r.dir(this.target+
"/www/user");d.log("export user from "+a.path()+" to "+b.path());try{r.copy(a.path(),b.path(),{matching:["**","!./.git/**/*","!**/**claycenter","!./claycenter","!**claycenter"],overwrite:!0})}catch(c){"EEXIST"===c.code&&d.error("Error copying, file exists!",c),"EACCES"===c.code&&d.error("Error copying, file access perrmissions!",c),d.error("error : ",c)}},exportSystem:function(){var a=r.dir(this.data+"/system"),b=r.dir(this.target+"/www/system");r.copy(a.path(),b.path(),{matching:["**"],overwrite:!0})},
clean:function(){},copyServer:function(a){var b=r.dir(this.target+"/server/"+a),c="",c=this.dist?r.dir(this.dist+"/"+a):r.dir(this.root+"/server/"+a);d.info("export Device-Server "+a+" from : "+c.path());try{r.copy(c.path(),b.path(),{matching:["**"],overwrite:!0})}catch(f){"EEXIST"===f.code&&d.error("Error copying, file exists!",f),"EACCES"===f.code&&d.error("Error copying, file access perrmissions!",f)}},exportServer:function(a){"false"!==this.windows&&this.copyServer("windows");"false"!==this.linux32&&
this.copyServer("linux_32");"false"!==this.linux64&&this.copyServer("linux_64");"false"!==this.arm&&this.copyServer("arm");"false"!==this.osx&&this.copyServer("osx")},createDirectoryLayout:function(){r.dir(this.target+"/data/_MONGO");r.dir(this.target+"/www/");r.dir(this.target+"/nginx/logs")},exportMongo:function(a){a=r.dir(this.serverTemplates+"/mongo");var b=r.dir(this.target+"/mongo");r.copy(a.path(),b.path(),{matching:"mongod-arm mongod-linux_32 mongod-linux_64 mongod-windows.exe mongod-32.exe mongod-osx".split(" "),
overwrite:!0})},exportNGINX:function(e){var f=r.dir(this.serverTemplates+"/nginx"),l=r.dir(this.target+"/nginx");try{r.copy(f.path(),l.path(),{matching:"nginx-arm nginx-linux_32 nginx-linux_64 nginx-windows.exe nginx-osx msvcr110.dll".split(" "),overwrite:!0})}catch(k){"EEXIST"===k.code&&d.error("Error copying, file exists!",k),"EACCES"===k.code&&d.error("Error copying, file access perrmissions!",k),"ETXTBSY"===k.code&&d.error("Error copying, file is busy",k)}f=r.dir(this.serverTemplates+"/nginx/all/conf");
l=r.dir(this.target+"/nginx");r.copy(f.path(),l.path(),{overwrite:!0});f=r.dir(this.serverTemplates+"/nginx/temp");l=r.dir(this.target+"/nginx/temp");r.copy(f.path(),l.path(),{overwrite:!0});l=a.readFile(e.templatePath);e=c.replace(l,null,e,{begin:"%%",end:"%%"});r.dir(this.serverTemplates+"/nginx/all/conf");l=r.dir(this.target+"/nginx/");c.writeFile(l.path()+b.sep+"nginx.conf",e)}})})},"nxapp/manager/_Drivers_Devices":function(){define("dcl/dcl dojo/node!path dojo/node!fs nxapp/utils xide/utils/StringUtils xide/types nxapp/utils/_console".split(" "),
function(h,p,n,g,d,c,a){return h(null,{declaredClass:"nxapp.manager._Drivers_Devices",profile:null,getDevices:function(b,r,f){function m(b,f){var k=n.readdirSync(b);k.length&&_.each(k,function(k){if(-1!=k.indexOf(".meta.json")){var m=d.getJson(g.readFile(b+p.sep+k),!0,!1);if(m){if(q){var h=g.getCIByChainAndName(m,0,c.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);!h||h.value&1<<c.DRIVER_FLAGS.RUNS_ON_SERVER||(h.value|=1<<c.DRIVER_FLAGS.RUNS_ON_SERVER)}m?(k={isDir:!1,path:f+"/"+k,parentId:f,scope:r,user:m,
id:g.getCIInputValueByName(m,c.DEVICE_PROPERTY.CF_DEVICE_ID)},e.push(k)):a.error("device has no meta "+b+p.sep+k)}else a.error("cant get device meta for "+k+" path \x3d "+b+p.sep+k)}})}function k(c){var d=[];n.existsSync(c)?n.readdirSync(c).forEach(function(f){f=c+"/"+f;var q=n.statSync(f);if(q){var r=f.replace(b+"/","");q.isDirectory()&&(e.push({isDir:!0,parent:r,name:r,path:r}),m(f,r),d.push(f.replace(b+"/","")),d=d.concat(k(f)))}else a.error("cant get stat for "+f)}):a.error("device path "+c+" doesnt exists");
return d}require({packages:[{name:r,location:b}]});var e=[];f=f||{};var q=f.serverSide;k(b);return e},getDrivers:function(b,r,f){function m(b,l){var f=n.readdirSync(b);f.length&&_.each(f,function(f){if(-1!=f.indexOf(".meta.json")){var k=d.getJson(g.readFile(b+p.sep+f),!0,!1);if(k){var m=g.getCIInputValueByName(k,c.DRIVER_PROPERTY.CF_DRIVER_ID),h=b+"/"+f.replace(".meta.json",".xblox"),u=d.getJson(g.readFile(h),!0,!1);u||a.warn("invalid blocks file for driver "+l+"/"+f+" blox path \x3d "+h);e.push({isDir:!1,
path:l+"/"+f,parentId:l,scope:r,user:k,id:m,blox:u||{},blockPath:h})}else a.error("cant get driver meta "+b+p.sep+f)}})}function k(c){var d=[];n.existsSync(c)?n.readdirSync(c).forEach(function(a){a=c+"/"+a;var f=n.statSync(a);if(f){var r=a.replace(p+"/","");f.isDirectory()&&(e.push({isDir:!0,parent:r,name:r,path:r}),m(a,r),d.push(a.replace(b+"/","")),d=d.concat(k(a)))}}):a.error("driver path "+c+" doesnt exists");return d}require({packages:[{name:r,location:b}]});var e=[];k(b);return e}})})},"nxapp/client/WebSocket":function(){define(["dojo/_base/declare",
"dojo/_base/lang","nxapp/utils/_LogMixin","nxapp/client/ClientBase","dojo/node!sockjs-client"],function(h,p,n,g,d){return h("nxapp.client.WebSocket",[g,n],{_socket:null,debugConnect:!0,connect:function(c){this.options=p.mixin(this.options,c);c=this.options.host;var a=this.options.port;this.options.debug&&this.initLogger(this.options.debug);this.log("Sock-JS-Client Connecting to "+c+":"+a,"socket_client");var b=d.create(c+":"+a),r=this;b.on("close",function(){console.log("on close!",r.options)});b.on("connection",
function(){r.log("socket client connected","socket_client");b.on("error",function(a){console.error("Socket client error ")});b.on("end",function(){r.log("socket client connection end","socket_client")})});this._socket=b},emit:function(c,a){this.showDebugMsg("socket_client")&&(console.log("Emiting: "+c+" with: "),console.dir(a));this._socket.write(a)},onSignal:function(c,a){this._socket.on("data",a)}})})},"nxapp/client/ClientBase":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/_base/lang"],
function(h,p,n){return h("nxapp.server.ClientBase",[p],{options:null,_defaultOptions:function(){return{}},init:function(g){this.options=n.mixin(this._defaultOptions(),g.options)}})})},"dcl/inherited":function(){(function(h){"undefined"!=typeof define?define(["./mini","./advise"],h):"undefined"!=typeof module?module.exports=h(require("./mini"),require("./advise")):h(dcl,advise)})(function(h,p){function n(c,a,b){var d=3>arguments.length&&c.callee,f=g.call(this,d?d.ctr:c,d?d.nom:a);if(f)return f.apply(this,
d?c||a:b)}function g(c,a){var b=this.constructor._meta,r,f,m,k;if(!+b.weaver[a]){if(b){if(b.chains.hasOwnProperty(a)){if(r=b.chains[a])for(m=r.length-1;0<=m;--m)if(f=r[m],f.ctr===c)return 0<m?r[m-1]:0;return}r=b.bases;for(m=r.length-1;0<=m&&r[m]!==c;--m);if(0<=m)for(++m,k=r.length;m<k;++m)if(b=(f=r[m])._meta){if((b=b.ownProps).hasOwnProperty(a))return b[a]}else return f.prototype[a]}return d[a]}}var d={};p.after(h,"_postprocess",function(c,a){for(var b=a._meta.bases,d=b.length-1,f,m,k;0<=d;--d)if(f=
b[d],m=f._meta)m=m.ownProps,h.allKeys(m).some(function(a){k=m[a];if("function"==typeof k){if(k.nom===a)return 1;k.nom=a;k.ctr=f}});a.prototype.inherited=n;a.prototype.getInherited=g});h.getInherited=n.get=g;return h.inherited=n})},"dcl/advise":function(){(function(h){"undefined"!=typeof define?define([],h):"undefined"!=typeof module?module.exports=h():advise=h()})(function(){function h(d,c){this.next_before=this.prev_before=this.next_after=this.prev_after=this.next_around=this.prev_around=this;this.instance=
d;this.name=c}function p(d){var c=function(){var a,b,c=arguments,f;for(a=d.prev_before;a!==d;a=a.prev_before)a.before.apply(this,c);try{d.prev_around!==d&&(b=d.prev_around.around.apply(this,c))}catch(m){b=m,f=!0}for(a=d.next_after;a!==d;a=a.next_after)a.after.call(this,c,b);if(f)throw b;return b};c.adviceNode=d;return c}function n(d,c,a){var b=d[c],r;b&&b.adviceNode&&b.adviceNode instanceof h?r=b.adviceNode:(r=new h(d,c),b&&b.advices?(b=b.advices,r.add(b.before,b.after,b.around)):r.add(0,0,b),d[c]=
p(r));"function"==typeof a&&(a=a(c,d));return r.add(a.before,a.after,0,a.around)}var g=h.prototype={add:function(d,c,a,b){var r=new h(this.instance,this.name);r.parent=this;r.before=d;this._add("before",r);r.after=c;this._add("after",r);r.around=a;this._add("around",r,b);if(r.original=b)r.around=n._instantiate(b,r.prev_around.around,this);return r},_add:function(d,c,a){if(c[d]||a)a="next_"+d,d="prev_"+d,(c[d]=this[d])[a]=(c[a]=this)[d]=c},remove:function(d){this._remove("before",d);this._remove("after",
d);this._remove("around",d)},_remove:function(d,c){var a="next_"+d,b="prev_"+d;c[a][b]=c[b];c[b][a]=c[a]},destroy:function(){var d=this.prev_around.around,c=this.next_around,a=this.parent;this.remove(this);if(c!==this)for(;c!==a;d=c.around,c=c.next_around)c.original&&(c.around=n._instantiate(c.original,d,this));this.instance=0}};g.unadvise=g.destroy;n.before=function(d,c,a){return n(d,c,{before:a})};n.after=function(d,c,a){return n(d,c,{after:a})};n.around=function(d,c,a){return n(d,c,{around:a})};
n.Node=h;n._instantiate=function(d,c,a){return d(c)};return n})},"nxapp/manager/DeviceServerContext":function(){define("dcl/dcl nxapp/manager/Context nxapp/Commons xcf/types/Types dojo/node!path dojo/node!fs nxapp/utils xide/types nxapp/manager/DriverManager xcf/manager/DeviceManager nxapp/manager/FileManager xcf/manager/Context nxapp/manager/DeviceManager xcf/manager/BlockManager xide/manager/ResourceManager xblox/factory/Blocks dojo/node!tracer nxapp/utils/_console nxapp/manager/_Drivers_Devices dojo/_base/lang dojo/promise/all require dojo/has nxapp/manager/TestManager".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m,k,e,q,l,u,v,t,y,w,A,z,G,H){var F=h(null,{declaredClass:"DeviceServerClientClass",write:function(a){t.error("device server client write",a)},emit:function(a){t.error("device server client emit",a)}}),B=null,D=h(null,{owner:null,remoteAddress:"fake - address",remotePort:"fake - port",isExternal:function(){return!1},constructor:function(b){a.mixin(this,b)},write:function(c){var d=this.owner.getDeviceManager(),e=a.getJson(c),e=e||{};if(e.data&&e.data.device){var l=d.getDeviceStoreItem(e.data.device);
if(l)if(l=d.toDeviceControlInfo(l)){if(!l.serverSide)return}else t.error("no info")}if(e&&e.data&&e.data.deviceMessage&&e.data.deviceMessage.event===b.EVENTS.ON_COMMAND_FINISH)d.onCommandFinish(e.data.device,e.data.deviceMessage);else if(e.data&&e.data.deviceMessage&&e.data.deviceMessage.event===b.EVENTS.ON_COMMAND_ERROR)d.onCommandError(e.data.device,e.data.deviceMessage);else if(e.event===b.EVENTS.ON_DEVICE_DISCONNECTED)d.publish(b.EVENTS.ON_DEVICE_DISCONNECTED,e.data);else{if(e.event===b.EVENTS.SET_DEVICE_VARIABLES)return d.onSetDeviceServerVariables(e.data);
if(e.event===b.EVENTS.ON_DEVICE_CONNECTED)d.publish(b.EVENTS.ON_DEVICE_CONNECTED,e.data);else if(e.event!==b.EVENTS.ON_SERVER_LOG_MESSAGE)if(e.event===b.EVENTS.ON_MQTT_MESSAGE)d.publish(b.EVENTS.ON_MQTT_MESSAGE,e.data),d.onMQTTMessage(e.data);else if(e.event!==b.EVENTS.ON_FILE_CHANGED)d.onDeviceServerMessage({data:c})}},emit:function(){t.error("device server client emit",arguments)}});return h([p,k,y],{declaredClass:"nxapp.manager.DeviceServerContext",profile:null,testManager:null,getTestManager:function(){return this.testManager},
doTests:function(){return this.getTestManager().doTests()},initManagers:function(a){a&&(this.profile=a);this.testManager&&this.testManager.init(a);this.deviceManager.init();this.driverManager.init();this.blockManager.init();this.fileManager.init(a);this.blockManager.onReady();var c=this;this.subscribe(b.EVENTS.ON_FILE_CHANGED,function(a){c.onXIDEMessage({event:b.EVENTS.ON_FILE_CHANGED,data:a,type:a.type},!1);c.fileChanged(a);c.deviceManager.onFileChanged(a);c.driverManager.onFileChanged(a);c.getDeviceServer().broadCastMessage(b.EVENTS.ON_FILE_CHANGED,
{path:a.path,modulePath:a.modulePath,mask:a.mask,type:a.type})})},getModule:function(b){return w.getObject(a.replaceAll("/",".",b))||w.getObject(b)||(h.getObject?h.getObject(b)||h.getObject(a.replaceAll("/",".",b)):null)},_reloadModule:function(c,d){function e(a){t.log(a.src,a.id);t.error("require error "+c,a);l.remove()}var l=null;if(-1===c.indexOf(".json")){c=c.replace("0/8","0.8");var f=w.getObject(a.replaceAll("/",".",c))||w.getObject(c);if(f&&f.prototype&&f.prototype.reloadModule)f.prototype.reloadModule();
else{var l=z.on("error",e),k=this.getModule(c);if(!k&&(k="undefined"!==typeof c?k:null,!k&&"undefined"!==typeof window))if(k=a.getAt(window,a.replaceAll("/",".",c),null))f=k;else try{k=z(a.replaceAll(".","/",c))}catch(m){}k&&(f=k);z.undef(c);var q=this;d&&setTimeout(function(){z({waitSeconds:5});try{z([c],function(a){t.log("reloaded module : "+c+(null!==k?" have obj":"have no obj"));z({cacheBust:"time\x3d"+(new Date).getTime()});_.isString(a)?t.error("module reloaded failed : "+a+" for module : "+
c):(a.modulePath=c,f&&(q.mergeFunctions(f.prototype,a.prototype),f.prototype&&f.prototype._onReloaded&&f.prototype._onReloaded(a)),q.publish(b.EVENTS.ON_MODULE_RELOADED,{module:c,newModule:a}),a.prototype&&a.prototype.declaredClass&&q.publish(b.EVENTS.ON_MODULE_UPDATED,{moduleClass:a.prototype.declaredClass,moduleProto:a.prototype}))})}catch(a){t.error("error reloading module "+c,a.stack),logError(a,"error reloading module "+c)}},10)}}},fileChanged:function(a){var b=a.path;"changed"===a.type&&this._reloadModule(b,
!0)},onAllDevicesStarted:function(){this.profile.test&&this.doTests()},onReady:function(){var a=this.getDeviceServer();if(a){var b=this.connection;a.clients||(a.clients=[]);b&&(a.clients.push(b),a.onClientConnection(b));this.initDevices();B=this;global.sctx=B}else t.error("have no device server")},getUserDirectory:function(){return this.profile.user},constructManagers:function(){f=h([f,e],{});this.driverManager=this.createManager(r,null);this.fileManager=this.createManager(m,null);this.blockManager=
this.createManager(q,null);H&&(this.testManager=this.createManager(H,null));this.connection=new D({owner:this});this.deviceManager=this.createManager(f,null,{deviceServerClient:new F({}),connection:this.connection});if(this.profile){var a=d.resolve(this.profile.system),a={system_drivers:d.resolve(a+"/system/drivers"),system_devices:d.resolve(a+"/system/devices")};if(this.profile.user){var b=d.resolve(this.profile.user);a.user_drivers=d.resolve(b+"/drivers");a.user_devices=d.resolve(b+"/devices");
this.userDirectory=b}this.resourceManager=this.createManager(l);this.resourceManager.resourceVariables={VFS_CONFIG:a}}},onLoaded:function(){},initDevices:function(){var a=this.profile,b=d.resolve(a.system),c=this.getDeviceManager(),e=this.getDriverManager(),l=a.serverSide;e.createStore({items:this.getDrivers(d.resolve(b+"/system/drivers"),"system_drivers")},"system_drivers",!0);c.initStore({items:this.getDevices(d.resolve(b+"/system/devices"),"system_devices",{serverSide:l})},"system_devices",!0);
a.user&&(e.createStore({items:this.getDrivers(d.resolve(a.user+"/drivers"),"user_drivers")},"user_drivers",!0),c.initStore({items:this.getDevices(d.resolve(a.user+"/devices"),"user_devices",{serverSide:l})},"user_devices",!0));A(c.connectToAllDevices()).then(function(){this.onAllDevicesStarted()}.bind(this))}})})},"nxapp/manager/DriverManager":function(){define("dcl/dcl nxapp/utils/_LogMixin xide/types xcf/manager/DriverManager nxapp/utils/_console dojo/node!path xide/mixins/EventedMixin xide/mixins/ReloadMixin dojo/Deferred xcf/model/Variable nxapp/utils".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m){return h([g,p],{declaredClass:"nxapp.manager.DriverManager",createDriverInstance:function(f){var e=this.ctx,q=e.getDeviceManager(),l=e.getDriverManager(),g=f.driverScope,v=f.deviceScope,t=new r,y=f.system_drivers+"/DriverBase.js",p=f[g]+"/"+f.driver,A=f.driverId,z=f.deviceId||f.id,G=f[g],H=f[v],F=f.hash,B=l.getDriverById(A),D=q.getDeviceById(z,q.stores[v]);if(!B){if(!G)return d.error("invalid drivers path "+G,f),t.reject("invalid drivers path "+G),t;z=e.getDrivers(c.resolve(G),
g);if(!z||!z.length)return t.reject("have no devices at "+G),t;G=this.createStore({items:z},g,!1);B=l.getDriverById(A,G);if(!B)return t.reject("cant find driver "+A),t}if(!D){l=e.getDevices(c.resolve(H),v);if(!l||!l.length)return t.reject("have no devices at "+H),t;D=q.initStore({items:l},v,!1).getSync(f.devicePath);if(!D)return t.reject("cant find device "+f.devicePath),t}D.info=f;var C=this;require(["system_drivers/DriverBase"],function(c){c.prototype.declaredClass=y;require([g+"/"+f.driver.replace(".js",
"")],function(l){l=new (h([c,a.dcl,b.dcl,l],{}));l.declaredClass=p;l.options=f;l.baseClass=c.prototype.declaredClass;l.modulePath=p;l.delegate=q;l.driver=B;l.serverSide=f.serverSide;l.utils=m;l.types=n;l.device=D;l.id=m.createUUID();l.getDevice=function(){return this.device};l.getDeviceInfo=function(){return this.getDevice().info};var r=B.user,g=m.getCIByChainAndName(r,0,n.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);g&&g.params&&(l.sendSettings=m.getJson(g.params));(r=m.getCIByChainAndName(r,0,n.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&
r.params&&(l.responseSettings=m.getJson(r.params));try{l.start(),l.initReload()}catch(u){d.error("crash in driver instance startup! "+D.toString())}C.driverInstance=l;r=A+"_"+F+"_"+D.path;B.blox&&B.blox.blocks||(d.error("Attention : INVALID driver",D.toString()),B.blox={blocks:[]});B.blockPath&&(m.getJson(m.readFile(B.blockPath)),B.blox=m.getJson(m.readFile(B.blockPath)));q.deviceInstances||(q.deviceInstances={});q.deviceInstances[F]=l;r=e.getBlockManager().createScope({id:r,device:D,driver:B,instance:l,
ctx:e,serverSide:f.serverSide,uuid:m.createUUID(),getContext:function(){return this.instance}},dojo.clone(B.blox.blocks));l.blockScope=r;D.blockScope=r;D.driverInstance=l;C.blockScope=r;t.resolve({driverInstance:l,blockScope:r})})});t.then(function(a){a.blockScope.start()});return t}})})},"xcf/manager/DriverManager":function(){define("dcl/dcl dojo/_base/declare dojo/_base/lang dojo/_base/json xide/types xcf/types/Types xide/utils xcf/manager/BeanManager xcf/model/Variable xcf/manager/DriverManager_Server xide/data/TreeMemory xide/data/ObservableStore dstore/Trackable xdojo/has xcf/model/Driver xide/manager/ServerActionBase xide/data/Reference dojo/Deferred xide/mixins/ReloadMixin xide/mixins/EventedMixin xdojo/has!xcf-ui?./DriverManager_UI xdojo/has!xcf-ui?xide/views/_CIDialog".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m,k,e,q,l,u,v,t,y,w,A,z){n=[u,b,f];q("runDrivers");q("xcf-ui")&&n.push(A);return h(n,{declaredClass:"xcf.manager.DriverManager",beanNamespace:"driver",beanName:"Driver",beanIconClass:"fa-exchange",groupType:d.ITEM_TYPE.DRIVER_GROUP,itemType:d.ITEM_TYPE.DRIVER,itemMetaTitleField:d.DRIVER_PROPERTY.CF_DRIVER_NAME,defaultScope:"system_drivers",serviceClass:"XCF_Driver_Service",rawData:null,store:null,treeView:null,driverScopes:null,_isLoading:!1,getDriverModule:function(b){var c=
new t,e=a.getCIInputValueByName(b.user,d.DRIVER_PROPERTY.CF_DRIVER_CLASS);b=b.scope;e=e?e.replace("./",""):"";b=require.toUrl(b);b=a.removeURLParameter(b,"bust");b=a.removeURLParameter(b,"time");b=b.replace("/main.js","");require.cache||(b=b.replace("/.js","/"));try{require([b+"/"+e],function(a){c.resolve(a)})}catch(l){console.error("error loading driver module from  "+b+"---"+e,l),logError(l,"error loading driver module"),c.reject(l.message)}return c},loadDriverModule:function(b){var c=this.driverScopes.system_drivers+
"DriverBase";require.toUrl(this.driverScopes.system_drivers);var e=this,l=new t,f=require;f([c],function(c){var k=e.driverScopes[b.scope],m=!require.cache;m?require({config:{urlArgs:null}}):require({cacheBust:null});k=require.toUrl(k);m&&(k=k.replace("/.js","/"));var q=a.getCIInputValueByName(b.user,d.DRIVER_PROPERTY.CF_DRIVER_CLASS),q=q.replace("./",""),q=q.replace(".js",""),q=b.scope+"/"+q,q=q.replace("","").trim();try{f.undef(q),f([q],function(a){function b(c,d){a.getFields=c.getFields;c.onReloaded=
b;d.onReloaded=b}a.declaredClass=q;h([c,w.dcl,y.dcl,a],{}).getFields=a.getFields;a.onReloaded=b;l.resolve(a)})}catch(r){}});return l},getBlock:function(b){b=a.parse_url(b);b=a.urlArgs(b.host);var c=this.getItemById(b.driver.value),d=null;c&&c.blockScope&&(d=c.blockScope.getBlockById(b.block.value));return d},getDriverByUrl:function(b){b=a.parse_url(b);b=a.urlArgs(b.host);return this.getItemById(b.driver.value)},addDeviceInstance:function(a,b){b.directory=!0;var c=b._store,e=b.path,l=this.ctx.getDeviceManager(),
f=c.getSync(e+"_instances"),f=f||c.putSync({path:e+"_instances",name:"Instances",isDir:!0,type:"leaf",parentId:e,virtual:!0,isCommand:!1,icon:"fa-folder",children:[]}),e=l.getMetaValue(a,d.DEVICE_PROPERTY.CF_DEVICE_TITLE),c=c.putSync(new v({name:e,isCommand:!1,path:f.path+"_instance_"+a.path,isDir:!1,type:"driver_instance",parentId:f.path,device:a,driver:b,_mayHaveChildren:!1,icon:a.iconClass,state:a.state}));f.children.push(c);a.addReference(c,{properties:{name:!0,enabled:!0,state:!0,iconClass:!0},
onDelete:!1},!0);!b.instances&&(b.instances=[]);if(f=_.find(b.instances,{path:c.path}))console.log("instance already added "),b.instances.remove(f);b.instances.push(c)},removeDriverInstance:function(a,b){var c=a.driver,d=c._store,e=c.path,l=e+"_instances_instance_"+b.path,f=d.getSync(l);f&&d.removeSync(l);(l=_.find(c.instances,{path:l}))&&c.instances.remove(l);b.removeReference(f);f&&(f.refresh(),d.getSync(e+"_instances").refresh())},_driverQueryCache:null,_getDriverById:function(b,c){var e=a.queryStore(c,
{isDir:!1});_.isArray(e)||(e=[e]);for(var l=0;l<e.length;l++){var f=e[l],k=a.getInputCIByName(f.user,d.DRIVER_PROPERTY.CF_DRIVER_ID);if(k&&k.value==b)return c.getSync(f.path)}return null},getDriverById:function(a,b){if(b)return this._getDriverById(a,b);var c=null,d=null;q("xcf-ui");for(var e in this.stores)if(b=this.stores[e],c=this._getDriverById(a,b)){d=c;break}q("xcf-ui");return d},getDriverByPath:function(b){var c=null,d;for(d in this.stores){a:{c=a.queryStore(this.stores[d],{isDir:!1});_.isArray(c)||
(c=[c]);for(var e=0;e<c.length;e++){var l=c[e];if(l.path==b){c=l;break a}}c=null}if(c)return c}return null},getItemById:function(a){return this.getDriverById(a)},onNewDriverScopeCreated:function(a){},onScopeCreated:function(a){},onDeviceDisconnected:function(a){},onDriverCreated:function(a){q("xcf-ui")&&d.registerEnumeration("Driver",this.getDriversAsEnumeration(a))},onDriverRemoved:function(a,b){q("xcf-ui")&&d.registerEnumeration("Driver",this.getDriversAsEnumeration(a))},onStoreReady:function(a){q("xcf-ui")&&
d.registerEnumeration("Driver",this.getDriversAsEnumeration(a))},onStoreCreated:function(a){var b=a.type;a=a.store;var c=a.query({isDir:!1});if(b===d.ITEM_TYPE.DRIVER)for(b=0;b<c.length;b++){var e=c[b];null==e._completed&&"Default"!==e.name&&(e._completed=!0,q("xcf-ui")&&this.completeDriver(a,e,e))}},createStore:function(b,c,d){b=new (p("driverStore",[m,e,k],{}))({data:b.items,Model:l,idProperty:"path",scope:c,id:a.createUUID(),observedProperties:["name","enabled"]});c&&!1!==d&&this.setStore(c,b);
return b},initStore:function(a,b,c){return this.createStore(a,b,c)},getStore:function(a){a=a||"system_drivers";var b=this.stores[a];return b?b:this.ls(a)},ls:function(a,b){function c(l){try{var f=this.createStore(l,a,b);!1!==b&&this.setStore(a,f);this.onStoreReady(f);!1!==b&&this.publish(d.EVENTS.ON_STORE_CREATED,{data:l,owner:this,store:f,type:this.itemType});e.resolve(f)}catch(k){logError(k,"error ls drivers")}}var e=new t;q("php")?this.runDeferred(null,"ls",[a]).then(c.bind(this)):e.resolve({items:[]});
return e},init:function(){var a=this,b=d.EVENTS;this.stores={};this.subscribe([b.ON_SCOPE_CREATED,b.ON_STORE_CREATED]);this.subscribe(b.ON_BLOCK_EXPRESSION_FAILED,function(c){a.publish(b.ON_SERVER_LOG_MESSAGE,{data:{type:"Expression",device:c.deviceInfo},level:"error",message:"Expression Failed: "+c.item.title+" : "+c.item.value})});this.driverScopes={system_drivers:"system_drivers/",user_drivers:"user_drivers/"}}})})},"xcf/manager/BeanManager":function(){define("dcl/dcl dojo/_base/lang xide/types xide/utils xide/manager/BeanManager dojo/Deferred xdojo/has!xcf-ui?xide/views/ActionDialog xdojo/has!xcf-ui?xide/views/CIActionDialog xdojo/has!xcf-ui?xide/views/CIGroupedSettingsView".split(" "),
function(h,p,n,g,d,c,a,b,r,f){return h(d,{declaredClass:"xcf.manager.BeanManager",setStore:function(a,b){var c=this.stores[a];c&&(c.destroy(),delete this.stores[a]);return this.stores[a]=b},getFile:function(a){var b=new c,d=this.ctx.getFileManager().getStore(a.scope);d.initRoot().then(function(){d._loadPath(".",!0).then(function(){d.getItem(a.path,!0).then(function(a){b.resolve(a)})})});return b},toUrl:function(a,b,c,d){return p.replace((d||"")+"deviceScope\x3d{deviceScope}\x26device\x3d{deviceId}\x26driver\x3d{driverId}\x26driverScope\x3d{driverScope}\x26block\x3d{block}",
{deviceId:a.id,deviceScope:a.scope,driverId:b.id,driverScope:b.scope,block:c.id})},openItemSettings:function(b,c){var d=b.user;if(!d||!d.inputs)return null;var q=this.getViewId(b),l=a.byId(q);try{if(l)return l.parentContainer&&l.parentContainer.selectChild(l),null}catch(r){g.destroy(l)}var l=this.ctx.mainView.getDocker(),h=this.getMetaValue(b,this.itemMetaTitleField),t=c?this.ctx.getDeviceManager().toDeviceControlInfo(c):null,l=l.addTab(null,{title:(h||b.name)+""+(c?":"+c.name+":"+t.host+":":""),
icon:this.beanIconClass});if(h=g.getCIByChainAndName(d,0,n.DRIVER_PROPERTY.CF_DRIVER_COMMANDS))h.device=c;b.blockScope&&!b.blockScope.serviceObject&&(b.blockScope.serviceObject=this.serviceObject);return g.addWidget(f,{cis:d.inputs,storeItem:b,iconClass:this.beanIconClass,id:q,delegate:this,storeDelegate:this,blockManager:this.ctx.getBlockManager(),options:{groupOrder:{General:1,Settings:2,Visual:3}}},this,l,!0)},newGroup:function(){var a=this,b=this.getItem(),c=b?!0===b.isDir?b.path:"":"",b=new r({title:"New "+
this.groupType,delegate:{onOk:function(b,d){var f=g.getCIInputValueByName(d,"Title"),k=g.getCIInputValueByName(d,"Scope");a.createGroup(k,c+"/"+f,function(){var b=a.createNewGroupItem(f,k,c);a.store.putSync(b);a.publish(n.EVENTS.ON_STORE_CHANGED,{owner:a,store:a.store,action:n.NEW_DIRECTORY,item:b})})}},cis:[g.createCI("Title",13,""),g.createCI("Scope",3,this.defaultScope,{options:[{label:"System",value:this.defaultScope},{label:"User",value:this.userScope},{label:"App",value:this.appScope}]})]});
b.startup();b.show()},onDeleteItem:function(a){var c=!0===g.toBoolean(a.isDir),d=c?"removeGroup":"removeItem",f=this;(new b({title:"Remove "+this.beanName+(c?" Group":"")+' "'+a.name+'"  ',style:"max-width:400px",titleBarClass:"text-danger",delegate:{isRemoving:!1,onOk:function(){f[d](g.toString(a.scope),g.toString(a.path),g.toString(a.name),function(){f.onItemDeleted(a);f.publish(n.EVENTS.ON_STORE_CHANGED,{owner:f,store:f.store,action:n.DELETE,item:a})})}}})).show()},hasItemActions:function(){return!0},
onItemDeleted:function(a){this.store.removeSync(a.path);a==this.currentItem&&(this.currentItem=null);a&&(a=this.getView(a))&&g.destroy(a)},onItemSelected:function(a){this.currentItem=a},onCIUpdate:function(a){a.owner===this&&this.updateCI(a.ci,a.newValue,a.oldValue,a.storeItem)},createNewGroupItem:function(a,b,c){return this.createItemStruct(a,b,c,a,!0,this.groupType)},createNewItem:function(a,b,c){return this.createItemStruct(a,b,c,c+"/"+a,!1,this.itemType)},init:function(){this.subscribe(n.EVENTS.ON_CI_UPDATE)},
createItem:function(a,b,c,d,l){return this.runDeferred(null,"createItem",[a,b,c,d,l])},ls:function(a){return this.runDeferred(null,"ls",[a]).then(function(a){try{this.rawData=a,this.initStore(a),this.publish(n.EVENTS.ON_STORE_CREATED,{data:a,owner:this,store:this.store,type:this.itemType})}catch(b){logError(b,"error ls")}}.bind(this))}})})},"xide/manager/BeanManager":function(){define("dcl/dcl dojo/_base/lang xide/utils xide/encoding/MD5 xide/registry xide/data/TreeMemory".split(" "),function(h,p,
n,g,d,c){return h(null,{declaredClass:"xide.manager.BeanManager",beanNamespace:"beanNS",beanName:"beanName",createItemStruct:function(a,b,c,d,m,k){return{name:a,isDir:m,parentId:c,path:d,beanType:k,scope:b}},getMetaValue:function(a,b){return n.getCIInputValueByName(n.getAt(a,this.itemMetaPath||"user"),b)},setCurrentItem:function(a){},getItem:function(){},onItemSelected:function(a){},onItemAdded:function(a){},onItemRemoved:function(a){},reload:function(){},getViewTarget:function(){return this.ctx.getApplication().mainView.getNewAlternateTarget()},
getRightTopTarget:function(a,b,c,d){return this.ctx.getApplication().mainView.getRightTopTarget(a,b,c,d)},getLayoutRightMain:function(a,b){return this.ctx.getApplication().mainView.getLayoutRightMain(a,b)},getRightBottomTarget:function(a,b){return this.ctx.getApplication().mainView.getRightBottomTarget(a,b)},getViewId:function(a,b){return this.beanNamespace+g(n.toString(a.scope)+n.toString(a.path),1)+(null!=b?b:"")},getView:function(a,b){var c=this.getViewId(a,b);return d.byId(c)},getStore:function(){return this.store},
isValid:function(){return null!=this.store},initStore:function(a){this.store=new c({data:a.items,idProperty:"path"});this.onStoreReady(this.store);return this.store},onStoreReady:function(){},createGroup:function(a,b,c){return this.callMethodEx(null,"createGroup",[a,b],c,!0)},removeGroup:function(a,b,c,d){return this.callMethodEx(null,"removeGroup",[a,b,c],d,!0)},removeItem:function(a,b,c,d){return this.callMethodEx(null,"removeItem",[a,b,c],d,!0)},updateCI:function(a,b,c,d){a&&d&&this.updateItemMetaData(n.toString(d.scope),
n.toString(d.path),this.itemMetaStorePath||"/inputs",{id:n.toString(a.id)},{value:b})},updateItemMetaData:function(a,b,c,d,m,k,e){return this.callMethodEx(null,"updateItemMetaData",[a,b,c,d,m],k,!1)},mergeNewModule:function(a){for(var b in a){var c=a[b];c&&_.isFunction(c)&&(this[b]=c)}},_onReloaded:function(a){this.mergeNewModule(a.prototype);a=this.declaredClass;(a=p.getObject(n.replaceAll("/",".",a))||p.getObject(a))&&a.prototype&&a.prototype.solve&&this.mergeNewModule(a.prototype)}})})},"xide/registry":function(){define(["dojo/_base/array",
"dojo/_base/window","xdojo/has"],function(h,p,n){var g={},d={},c={length:0,add:function(a){this._hash[a.id]&&(this.remove(a.id),this.add(a));d[a.id]=a;this.length++},remove:function(a){d[a]&&(delete d[a],this.length--)},byId:function(a){return"string"==typeof a?d[a]:a},byNode:function(a){return d[a.getAttribute("widgetId")]},toArray:function(){return _.values(_.mapKeys(d,function(a,b){a.id=b;return a}))},getUniqueId:function(a){var b;do b=a+"_"+(a in g?++g[a]:g[a]=0);while(d[b]);return b},findWidgets:function(a,
b){function c(a){for(a=a.firstChild;a;a=a.nextSibling)if(1==a.nodeType){var k=a.getAttribute("widgetId");k?(k=d[k])&&f.push(k):a!==b&&c(a)}}var f=[];c(a);return f},_destroyAll:function(){_.each(c.findWidgets(p.body()),function(a){a._destroyed||(a.destroyRecursive?a.destroyRecursive():a.destroy&&a.destroy())})},getEnclosingWidget:function(a){for(;a;){var b=1==a.nodeType&&a.getAttribute("widgetId");if(b)return d[b];a=a.parentNode}return null},_hash:d};return c})},"xcf/manager/DriverManager_Server":function(){define(["dcl/dcl",
"dojo/_base/declare","xide/types","xide/utils"],function(h,p,n,g){return h(null,{declaredClass:"xcf.manager.DriverManager_Server",onDriverBlocksChanged:function(d,c){},onFileChanged:function(d){if("changed"===d.type&&!d._didb){d._didb=!0;var c=g.replaceAll("\\","/",d.path),c=g.replaceAll("//","/",c),c=c.replace(/\\/g,"/"),a;a=c;a=-1!=a.indexOf("system/driver")?a.substr(a.indexOf("system/driver")+14,a.length):null;a&&-1!==a.indexOf(".xblox")&&(console.log("driver blocks changed "+a+" @ "+c,d),this.onDriverBlocksChanged(c,
a))}},createDriverInstance:function(d,c){var a=this,b=this.driverScopes.system_drivers+"DriverBase";require([b],function(r){r.prototype.declaredClass=b;var f=a.driverScopes[d.scope],m=g.getCIInputValueByName(d.user,n.DRIVER_PROPERTY.CF_DRIVER_CLASS);if(m){var k=f+m,k=k.replace(".js",""),k=k.replace("./","");require([k],function(b){b=new (p([r],b.prototype));b.baseClass=r.prototype.declaredClass;b.modulePath=g.replaceAll("//","/",k);b.delegate=a;d.instance=b;c&&c(b);try{b.start()}catch(f){}return b})}else console.error("cant find driver class in meta")})}})})},
"xcf/model/Driver":function(){define(["dojo/_base/declare","xide/data/Model","xide/utils"],function(h,p,n){return h(p,{itemMetaPath:"user.meta",getStore:function(){return this._store},getScope:function(){var g=this.getStore();return g?g.scope:this.scope},getMetaValue:function(g){return n.getCIInputValueByName(this.user,g)},setMetaValue:function(g,d,c){var a=n.getCIByChainAndName(this.user,0,g);if(!a)return null;var b=this.getMetaValue(g);n.setCIValueByField(a,"value",d);this[g]=d;if(!1!==c)return this.publish(types.EVENTS.ON_CI_UPDATE,
{owner:this.owner,ci:a,newValue:d,oldValue:b})},getParent:function(){return this._store.getSync(this.parentId)}})})},"xide/data/Model":function(){define("dcl/dcl dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/when".split(" "),function(h,p,n,g,d,c){function a(a,b){var c=a.schema[b];void 0===c||c instanceof y||(c=new y(c),c._parent=a);c&&(c.name=b);return c}function b(b,d){var l,e=b.hasOwnProperty("_properties")&&b._properties[d];l=e;e||(e=a(b,d))&&e.validate&&(e=n.delegate(e,{_parent:b,
key:d}));return e&&e.validate?c(e.validate(),function(a){a||l||((b.hasOwnProperty("_properties")?b._properties:b._properties=new t)[d]=e);return a}):!0}function r(a){var b,c=1;a(function(a,d,e){a&&a.then?(c++,b||(b=new g),a.then(function(a){d(a,e);c--;c||b.resolve()}).then(null,b.reject)):d(a,e)});if(b)return c--,c||b.resolve(),b.promise}function f(){2>q&&u&&(u(),u=null);q--}function m(){return m}var k=[].slice,e=p("xide/data/Model",null,{schema:{},additionalProperties:!0,_scenario:"update",constructor:function(a){this.init(a)},
refresh:function(a){var b=this._store;b&&b.refreshItem(this,a)},getStore:function(){return this._store},init:function(a){this._scenario="insert";a=this._setValues(a);for(var b in this.schema){var c=this.schema[b];c&&"object"===typeof c&&"default"in c&&!a.hasOwnProperty(b)&&(c=c["default"],a[b]="function"===typeof c?c.call(this):c)}},_setValues:function(a){return n.mixin(this,a)},_getValues:function(){return this._values||this},save:function(a){var b=this;return c(a&&a.skipValidation?!0:this.validate(),
function(a){if(!a)throw b.createValidationError(b.errors);a=b._scenario;b.prepareForSerialization();return b._store&&c(b._store["insert"===a?"add":"put"](b),function(a){b.set(a);b._scenario="update";return b})})},remove:function(){var a=this._store;return a.remove(a.getIdentity(this))},prepareForSerialization:function(){this._scenario=void 0;this._inherited&&(this._inherited.toJSON=m)},createValidationError:function(a){return Error("Validation error")},property:function(b,c){var d=this.hasOwnProperty("_properties")?
this._properties:this._properties=new t,e=d[b];e||(e=a(this,b),e=d[b]=e?n.delegate(e):new y,e.name=b,e._parent=this);return c?e.property.apply(e,k.call(arguments,1)):e},get:function(b){var c,d=this.schema[b];return(d=c||this.schema[b])&&d.valueOf&&(d.valueOf!==w||d.hasCustomGet)?((c=c||this.hasOwnProperty("_properties")&&this._properties[b])||(c=n.delegate(a(this,b),{name:b,_parent:this})),c.valueOf()):this._getValues()[b]},set:function(a,c){if("object"===typeof a){q++;try{for(var d in a)c=a[d],!a.hasOwnProperty(d)||
c&&c.toJSON===m||this.set(d,c)}finally{f()}}else{d=this.schema[a];if(!d&&!this.additionalProperties)return console.warn("Schema does not contain a definition for",a);var e=this.hasOwnProperty("_properties")&&this._properties[a];!e&&(c&&"object"===typeof c||d&&d.put!==A)&&(e=this.property(a));e?e.put(c):(d&&d.coerce&&(c=d.coerce(c)),this._getValues()[a]=c,d&&!1!==d.validateOnSet&&b(this,a));return c}},observe:function(a,b,c){return this.property(a).observe(b,c)},validate:function(a){var d=this,e=!0,
l=[],f;if(a){f={};for(var k=0;k<a.length;k++)f[k]=!0}return c(r(function(a){for(var c in d.schema)f&&!f.hasOwnProperty(c)||a(b(d,c),function(a,b){a||(e=!1,l.push.apply(l,d.property(b).errors))},c)}),function(){d.set("errors",e?void 0:l);return e})},isValid:function(){var a=!0,b;for(b in this.schema){var c=this.hasOwnProperty("_properties")&&this._properties[b];c&&c.errors&&c.errors.length&&(a=!1)}return a}}),q=0,l,u;(e.nextTurn=function(a){u=a}).atEnd=!0;var v=p([e],{observe:function(a,b){var c;if("string"===
typeof a)return this.inherited(arguments);b&&b.onlyFutureUpdates||(c=new v,this._has()&&(c.value=a(this.valueOf())));var d=this._addListener(function(b){b=a(b);c&&c.put(b)});return c?(c.remove=d.remove,c):d},validateOnSet:!1,validators:null,_addListener:function(a){return d.after(this,"onchange",a,!0)},valueOf:function(){return this._get()},_get:function(){return this.value},_has:function(){return this.hasOwnProperty("value")},setValue:function(a){this.value=a},put:function(a){var b=this._get();a=
this.coerce(a);this.errors&&this.set("errors",void 0);var d=this;q++;return c(this.setValue(a,this._parent),function(c){void 0!==c&&(a=c);d.onchange&&d._queueChange(d.onchange,b);var e,l=b&&"object"===typeof b&&!(b instanceof Array),k=a&&"object"===typeof a&&!(a instanceof Array);if(l||k){c={};if(l)for(e in b=b._getValues?b._getValues():b,b)c[e]={old:b[e]};if(k)for(e in a=a._getValues?a._getValues():a,a)(c[e]=c[e]||{}).value=a[e];d._values=k&&a;for(e in c)l=c[e],(k=d._properties&&d._properties[e])&&
k.onchange&&k._queueChange(k.onchange,l.old)}d.validateOnSet&&d.validate();f()})},coerce:function(a){var b=this.type;b&&("string"===b?a=""+a:"number"===b?a=+a:"boolean"===b?a="false"===a||"0"===a||a instanceof Array&&!a.length?!1:!!a:"function"!==typeof b||a instanceof b||(a=new b(a)));return a},addError:function(a){this.set("errors",(this.errors||[]).concat([a]))},checkForErrors:function(a){var b=[];this.type&&!("function"===typeof this.type?a instanceof this.type:this.type===typeof a)&&b.push(a+
" is not a "+this.type);!this.required||null!=a&&""!==a||b.push("required, and it was not present");return b},validate:function(){var a=this,b=this._parent,d=this.validators,e=this.valueOf(),l=[];return c(r(function(c){function f(a){a&&l.push.apply(l,a)}if(d)for(var k=0;k<d.length;k++)c(d[k].checkForErrors(e,a,b),f);c(a.checkForErrors(e,a,b),f)}),function(){if(l.length)return a.set("errors",l),!1;void 0!==a.get("errors")&&a.set("errors",void 0);return!0})},_queueChange:function(a,b){if(!a._queued){a._queued=
!0;var c=this,d=function(){a._queued=!1;a.call(c,c._get(),b)};l&&l.push(d);l||(!e.nextTurn.atEnd||0<q?(l=[d],e.nextTurn(function(){for(var a=0;a<l.length;a++)l[a]();l=null})):d())}},toJSON:function(){return this._values||this}}),t=function(){};t.prototype.toJSON=m;var y=e.Property=p(v,{init:function(a){if("string"===typeof a||"function"===typeof a)a={type:a};a&&p.safeMixin(this,a)},_get:function(){return this._parent._getValues()[this.name]},_has:function(){return this.name in this._parent._getValues()},
setValue:function(a,b){b._getValues()[this.name]=a}}),w=y.prototype.valueOf,A=y.prototype.put;return e})},"xide/manager/ServerActionBase":function(){define("dcl/dcl dojo/_base/declare xdojo/has dojo/Deferred xide/manager/RPCService xide/manager/ManagerBase xide/types xide/utils".split(" "),function(h,p,n,g,d,c,a,b){n={declaredClass:"xide.manager.ServerActionBase",serviceObject:null,serviceUrl:null,singleton:!0,serviceClass:null,defaultOptions:{omit:!0,checkMessages:!0,checkErrors:!0},base64_encode:function(a){var b,
c,d,e,q=0,l=0,g="",g=[];if(!a)return a;do b=a.charCodeAt(q++),c=a.charCodeAt(q++),d=a.charCodeAt(q++),e=b<<16|c<<8|d,b=e>>18&63,c=e>>12&63,d=e>>6&63,e&=63,g[l++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(e);while(q<a.length);
g=g.join("");a=a.length%3;return(a?g.slice(0,a-3):g)+"\x3d\x3d\x3d".slice(a||3)},runDeferred:function(b,c,d,k){var e=new g,q;k=k||this.defaultOptions;this.check();if(!this.checkCall(b,c,k.omit))return e.reject("method doesnt exists: "+c+" for service class:"+this.serviceClass+" in "+this.declaredClass);this.prepareCall();var l=this.getService(),h=this.getServiceClass(b),v=this,n=function(a,b){var c=e;k.returnProm&&(c=q);c._data=a;if(b&&k.onError)return k.onError(b);c.resolve(a)};q=l[h][c](d);q.then(function(b){b=
b||{};var d=b.error||{};if(k.checkMessages&&d&&3==d.code)v.onMessages(d);if(k.checkErrors){if(1==d.code){v.onError(d,h+"::"+c);e.reject(d);return}}else{if(1==d.code&&k.displayError)v.onError(d,h+"::"+c);if(d&&0!=d.code){n(b,d);return}}k.omit&&v.publish(a.EVENTS.STATUS,{message:"Ok!",what:arguments},this);n(b)},function(a){v.onError(a)});return k.returnProm?q:e},getService:function(){return this.serviceObject},getServiceClass:function(a){return a||this.serviceClass},hasMethod:function(a,b){var c=this.getService(),
d=b||this.getServiceClass();return c&&d&&null!=c[d]&&null!=c[d][a]},findServiceUrl:function(a){var b=window.xFileConfig;if(b&&b.mixins)for(var c=0;c<b.mixins.length;c++){var d=b.mixins[c];if(d.declaredClass===a&&d.mixin&&d.mixin.serviceUrl)return decodeURIComponent(d.mixin.serviceUrl)}return null},init:function(){this.check()},_initService:function(){return!1},check:function(){this.serviceObject||this._initService()},onError:function(b,c){if(b)if(1===b.code){if(b.message&&_.isArray(b.message)){this.publish(a.EVENTS.ERROR,
{message:b.message.join("\x3cbr/\x3e")});return}}else 0===b.code&&this.publish(a.EVENTS.STATUS,"Ok");c&&(b.message=c+" -\x3e "+b.message);this.publish(a.EVENTS.ERROR,{error:b},this)},checkCall:function(a,b,c){a=this.getServiceClass(a);return this.getService()?this.hasMethod(b,a)||!0!==c?!0:(this.onError({code:1,message:["Sorry, server doesnt know "+b]}),!1):!1},prepareCall:function(){var a={};this.config&&this.config.RPC_PARAMS&&(a=b.mixin(a,this.config.RPC_PARAMS.rpcFixedParams),this.serviceObject.extraArgs=
a,this.config.RPC_PARAMS.rpcUserField&&(a[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.serviceObject.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.serviceObject.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken))},callMethodEx:function(b,c,d,k,e){(b=b||this.serviceClass)||console.error("have no service class! "+this.declaredClass,this);this.check();if(this.checkCall(b,c,e)){this.prepareCall();var q=this;return this.serviceObject[this.getServiceClass(b)][c](d).then(function(d){try{k&&
k(d)}catch(m){console.error("bad news : callback for method "+c+" caused a crash in service class "+b),logError(m,"server method failed "+m)}if(d&&d.error&&3==d.error.code)q.onMessages(d.error);if(d&&d.error&&d.error&&0!=d.error.code)q.onError(d.error);else 1==e&&q.publish(a.EVENTS.STATUS,{message:"Ok!"},this)},function(a){q.onError(a)})}},callMethodEx2:function(a,b,c,d,e){this.check();if(this.checkCall(a,b,e))return this.prepareCall(),this.serviceObject[this.getServiceClass(a)][b](c)},callMethod:function(c,
d,m,k){d=d||[[]];var e=this.serviceClass;try{var q=this;if(null==this.serviceObject[e][c]){if(!0===k)this.onError({code:1,message:["Sorry, server doesnt know "+c]});return null}e={};e=b.mixin(e,this.config.RPC_PARAMS.rpcFixedParams);e[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue;this.serviceObject.extraArgs=e;this.serviceObject.signatureField=this.config.RPC_PARAMS.rpcSignatureField;this.serviceObject.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken;this.serviceObject[this.serviceClass][c](d).then(function(b){try{m&&
m(b)}catch(c){logError(c,"Error calling RPC method")}if(b&&b.error&&3==b.error.code)this.onMessages(b.error);if(b&&b.error&&b.error&&1==b.error.code)this.onError(b.error);else!1!==k&&this.publish(a.EVENTS.STATUS,{message:"Ok!"},this)}.bind(this),function(a){this.onError(a)}.bind(this))}catch(l){q.onError(l),logError(l,"Error calling RPC method")}}};h=h(c,n);h.declare=p(null,n);return h})},"xide/manager/RPCService":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang xide/rpc/Service xide/rpc/JsonRPC dojo/has dojo/Deferred xide/utils xide/types xide/mixins/EventedMixin xide/encoding/SHA1".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m){return h("xide.manager.RPCService",[g,f],{extraArgs:null,signatureField:"sig",signatureToken:null,correctTarget:!0,sync:!1,defaultOptions:{omit:!0,checkMessages:!0,checkErrors:!0},onError:function(a){if(a)if(1===a.code){if(a.message&&_.isArray(a.message)){this.publish(r.EVENTS.ERROR,{message:a.message.join("\x3cbr/\x3e")});return}}else 0===a.code&&this.publish(r.EVENTS.STATUS,"Ok");this.publish(r.EVENTS.ERROR,{error:a},this)},prepareCall:function(){var a={};this.config&&
this.config.RPC_PARAMS&&(this.extraArgs=a=b.mixin(a,this.config.RPC_PARAMS.rpcFixedParams),this.config.RPC_PARAMS.rpcUserField&&(a[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken))},runDeferred:function(b,c,d,l){var f=new a;l=l||this.defaultOptions;if(!this.checkCall(b,c,l.omit))return f.reject("method doesnt exists: "+c+" for service class:"+this.serviceClass+
" in "+this.declaredClass);this.prepareCall();var m=this;this[this.getServiceClass(b)][c](d).then(function(a){if(l.checkMessages&&a&&a.error&&3==a.error.code)m.onMessages(a.error);l.checkErrors&&a&&a.error&&a.error&&0!=a.error.code?(m.onError(a.error),f.reject(a.error)):(l.omit&&m.publish(r.EVENTS.STATUS,{message:"Ok!",what:arguments},this),f.resolve(a))},function(a){m.onError(a)});return f},getParameterMap:function(a,b){var c=this._smd.services[a+"."+b];return c&&c.parameters?c.parameters:[]},_getRequest:function(a,
b){var c=this._smd,d=g.envelopeRegistry.match(a.envelope||c.envelope||"NONE"),f=(a.parameters||a.params||[]).concat(c.parameters||[]);if(d.namedParams){if(1==b.length&&n.isObject(b[0]))b=b[0];else{for(var m={},r=a.parameters||a.params,h=0;h<r.length;h++)"undefined"==typeof b[h]&&r[h].optional||(m[r[h].name]=b[h]);b=m}if(a.strictParameters||c.strictParameters)for(h in b){m=!1;for(r=0;r<f.length;r++)f[h].name==h&&(m=!0);m||delete b[h]}for(h=0;h<f.length;h++)if(m=f[h],!m.optional&&m.name&&null!=b&&!b[m.name])if(m["default"])b[m.name]=
m["default"];else if(!(m.name in b))throw Error("Required parameter "+m.name+" was omitted");}else f&&f[0]&&f[0].name&&1==b.length&&p.isObject(b[0])&&(b=!1===d.namedParams?g.toOrdered(f,b):b[0]);n.isObject(this._options)&&(b=p.mixin(b,this._options));f=a._schema||a.returns;h=d.serialize.apply(this,[c,a,b]);h._envDef=d;return p.mixin(h,{sync:this.sync,contentType:a.contentType||c.contentType||h.contentType,headers:a.headers||c.headers||h.headers||{},target:h.target||g.getTarget(c,a),transport:a.transport||
c.transport||h.transport,envelope:a.envelope||c.envelope||h.envelope,timeout:a.timeout||c.timeout,callbackParamName:a.callbackParamName||c.callbackParamName,rpcObjectParamName:a.rpcObjectParamName||c.rpcObjectParamName,schema:f,handleAs:h.handleAs||"auto",preventCache:a.preventCache||c.preventCache,frameDoc:this._options.frameDoc||void 0})},_executeMethod:function(a){var b=[],c;if(2==arguments.length&&n.isArray(arguments[1]))b=arguments[1];else for(c=1;c<arguments.length;c++)b.push(arguments[c]);
var d=this._getRequest(a,b);this.correctTarget&&(d.target=this._smd.target);if(this.extraArgs)for(var f in this.extraArgs)d.target+=-1!=d.target.indexOf("?")?"\x26":"?",d.target+=f+"\x3d"+this.extraArgs[f];this.signatureToken&&(d.target+=-1!=d.target.indexOf("?")?"\x26":"?",b=m._hmac(d.data,this.signatureToken,1),b=m._hmac(d.data,this.signatureToken,1),d.target+=this.signatureField+"\x3d"+b);b=g.transportRegistry.match(d.transport).fire(d);b.addBoth(function(a){return d._envDef.deserialize.call(this,
a)});return b},getServiceClass:function(a){return a||this.serviceClass},hasMethod:function(a,b){var c=b||this.getServiceClass();return this&&c&&null!=this[c]&&null!=this[c][a]},checkCall:function(a,b,c){a=this.getServiceClass(a);return this.hasMethod(b,a)||!0!==c?!0:(this.onError({code:1,message:["Sorry, server doesnt know "+b]}),!1)},base64_encode:function(a){var b,c,d,f,m=0,g=0,r="",r=[];if(!a)return a;do b=a.charCodeAt(m++),c=a.charCodeAt(m++),d=a.charCodeAt(m++),f=b<<16|c<<8|d,b=f>>18&63,c=f>>
12&63,d=f>>6&63,f&=63,r[g++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(f);while(m<a.length);r=r.join("");a=a.length%3;return(a?r.slice(0,a-3):r)+"\x3d\x3d\x3d".slice(a||3)},callMethodEx:function(a,b,c,d,f,m){if(!this[a]||null==
this[a][b])return!0===m&&f&&f({code:1,message:["Sorry, server doesnt know "+b+" in class"+a]}),null;m={};this.config&&this.config.RPC_PARAMS&&(m=n.mixin(m,this.config.RPC_PARAMS.rpcFixedParams),m[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.extraArgs=m,this.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken);this[a][b](c).then(function(c){try{d&&d(c)}catch(q){console.error("bad news : callback for method "+
b+" caused a crash in service class "+a)}c&&c.error&&c.error&&0!=c.error.code&&f&&f(c.error)},function(a){f(a)})},callMethod:function(a,b,c,d,f,m){try{var g=this;if(null==this[a][b])return!0===m&&f&&f({code:1,message:["Sorry, server doesnt know "+b]}),null;m={};m=n.mixin(m,this.config.RPC_PARAMS.rpcFixedParams);this[a][b](c).then(function(a){try{d&&d(a)}catch(c){console.error("crashed in "+b),console.dir(c)}a&&a.error&&a.error&&1==a.error.code&&f&&f(a.error)},function(a){g.onError(a)})}catch(r){console.error("crash! "+
r)}}})})},"xide/rpc/Service":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/xhr dojo/_base/declare xide/rpc/AdapterRegistry dojo/_base/url xide/utils".split(" "),function(h,p,n,g,d,c,a){function b(a,b){var c=a._baseUrl;a.target&&(c=new h._Url(c,a.target)+"");b.target&&(c=new h._Url(c,b.target)+"");return c}function r(a,b){if(h.isArray(b))return b;for(var c=[],d=0;d<a.length;d++)c.push(b[a[d].name]);return c}var f=new d(!0),m=new d(!0),k=1;g=g("xide.rpc.Service",null,{constructor:function(b,
c){function d(a){a._baseUrl=new h._Url(h.isBrowser?location.href:h.config.baseUrl,f||".")+"";k._smd=a;c&&"methods"===c.services&&(a.services=a.methods,delete a.methods,a.transport="POST",c.mixin&&p.mixin(a,c.mixin),c=null);for(var b in k._smd.services){a=b.split(".");for(var e=k,l=0;l<a.length-1;l++)e=e[a[l]]||(e[a[l]]={});e[a[a.length-1]]=k._generateService(b,k._smd.services[b])}}var f,k=this;if(b)if(h.isString(b)||b instanceof h._Url){f=b instanceof h._Url?b+"":b;var m=n._getText(f);if(m)d(a.fromJson(m));
else throw Error("Unable to load SMD from "+b);}else d(b);this._options=c?c:{};this._requestId=0},_generateService:function(a,b){if(this[b])throw Error("WARNING: "+a+" already exists for service. Unable to generate function");b.name=a;var c=h.hitch(this,"_executeMethod",b),d=f.match(b.transport||this._smd.transport);d.getExecutor&&(c=d.getExecutor(c,b,this));d=b.returns||(b._schema={});d._service=c;c.servicePath="/"+a+"/";c._schema=d;c.id=k++;return c},_getRequest:function(a,c){var d=this._smd,f=
m.match(a.envelope||d.envelope||"NONE"),k=(a.parameters||[]).concat(d.parameters||[]);if(f.namedParams){if(1==c.length&&h.isObject(c[0]))c=c[0];else{for(var g={},n=0;n<a.parameters.length;n++)"undefined"==typeof c[n]&&a.parameters[n].optional||(g[a.parameters[n].name]=c[n]);c=g}if(a.strictParameters||d.strictParameters)for(n in c){for(var g=!1,p=0;p<k.length;p++)k[p].name==n&&(g=!0);g||delete c[n]}for(n=0;n<k.length;n++)if(g=k[n],!g.optional&&g.name&&!c[g.name])if(g["default"])c[g.name]=g["default"];
else if(!(g.name in c))throw Error("Required parameter "+g.name+" was omitted");}else k&&k[0]&&k[0].name&&1==c.length&&h.isObject(c[0])&&(c=!1===f.namedParams?r(k,c):c[0]);h.isObject(this._options)&&(c=h.mixin(c,this._options));delete c.mixin;k=a._schema||a.returns;n=f.serialize.apply(this,[d,a,c]);n._envDef=f;return h.mixin(n,{sync:!1,contentType:a.contentType||d.contentType||n.contentType,headers:a.headers||d.headers||n.headers||{},target:n.target||b(d,a),transport:a.transport||d.transport||n.transport,
envelope:a.envelope||d.envelope||n.envelope,timeout:a.timeout||d.timeout,callbackParamName:a.callbackParamName||d.callbackParamName,rpcObjectParamName:a.rpcObjectParamName||d.rpcObjectParamName,schema:k,handleAs:n.handleAs||"auto",preventCache:a.preventCache||d.preventCache,frameDoc:this._options.frameDoc||void 0})},_executeMethod:function(a){var b=[],c;for(c=1;c<arguments.length;c++)b.push(arguments[c]);var d=this._getRequest(a,b),b=f.match(d.transport).fire(d);b.addBoth(function(a){return d._envDef.deserialize.call(this,
a)});return b}});g.transportRegistry=f;g.envelopeRegistry=m;g._nextId=k;g.getTarget=b;g.toOrdered=r;g._sync=!1;m.register("URL",function(a){return"URL"==a},{serialize:function(a,b,c){return{data:h.objectToQuery(c),transport:"POST"}},deserialize:function(a){return a},namedParams:!0});m.register("JSON",function(a){return"JSON"==a},{serialize:function(a,b,c){return{data:h.toJson(c),handleAs:"json",contentType:"application/json"}},deserialize:function(a){return a}});m.register("PATH",function(a){return"PATH"==
a},{serialize:function(a,c,d){var f;a=b(a,c);if(h.isArray(d))for(f=0;f<d.length;f++)a+="/"+d[f];else for(f in d)a+="/"+f+"/"+d[f];return{data:"",target:a}},deserialize:function(a){return a}});f.register("POST",function(a){return"POST"==a},{fire:function(a){a.url=a.target;a.postData=a.data;return h.rawXhrPost(a)}});f.register("GET",function(a){return"GET"==a},{fire:function(a){a.url=a.target+(a.data?"?"+(a.rpcObjectParamName?a.rpcObjectParamName+"\x3d":"")+a.data:"");return n.get(a)}});h._contentHandlers&&
(h._contentHandlers.auto=function(a){var b=h._contentHandlers,c=a.getResponseHeader("Content-Type");return c?c.match(/\/.*json/)?b.json(a):c.match(/\/javascript/)?b.javascript(a):c.match(/\/xml/)?b.xml(a):b.text(a):b.text(a)});return g})},"xide/rpc/AdapterRegistry":function(){define(["dojo/_base/kernel","dojo/_base/lang"],function(h,p){var n=h.AdapterRegistry=function(g){this.pairs=[];this.returnWrappers=g||!1};p.extend(n,{register:function(g,d,c,a,b){this.pairs[b?"unshift":"push"]([g,d,c,a])},match:function(){for(var g=
0;g<this.pairs.length;g++){var d=this.pairs[g];if(d[1].apply(this,arguments))return d[3]||this.returnWrappers?d[2]:d[2].apply(this,arguments)}throw Error("No match found");},unregister:function(g){for(var d=0;d<this.pairs.length;d++)if(this.pairs[d][0]==g)return this.pairs.splice(d,1),!0;return!1}});return n})},"xide/rpc/JsonRPC":function(){define(["./Service","dojo/errors/RequestError","xide/utils/StringUtils"],function(h,p,n){function g(d){return{serialize:function(c,a,b,g){c={id:this._requestId++,
method:a.name,params:b};d&&(c.jsonrpc=d);return{data:JSON.stringify(c),handleAs:"json",contentType:"application/json",transport:"POST"}},deserialize:function(c){if("Error"==c.name||c instanceof p)c=n.fromJson(c.responseText);if(c.error){var a=Error(c.error.message||c.error);a._rpcErrorObject=c.error;return a}return c.result}}}h.envelopeRegistry.register("JSON-RPC-1.0",function(d){return"JSON-RPC-1.0"==d},n.mixin({namedParams:!1},g()));h.envelopeRegistry.register("JSON-RPC-2.0",function(d){return"JSON-RPC-2.0"==
d},n.mixin({namedParams:!0},g("2.0")))})},"xide/encoding/SHA1":function(){define(["./_base"],function(h){function p(a,b){a[b>>5]|=128<<24-b%32;a[(b+64>>9<<4)+15]=b;for(var c=Array(80),d=1732584193,m=-271733879,k=-1732584194,e=271733878,g=-1009589776,l=0;l<a.length;l+=16){for(var n=d,v=m,t=k,p=e,w=g,A=0;80>A;A++){if(16>A)c[A]=a[l+A];else{var z=c[A-3]^c[A-8]^c[A-14]^c[A-16];c[A]=z<<1|z>>>31}z=h.addWords(h.addWords(d<<5|d>>>27,20>A?m&k|~m&e:40>A?m^k^e:60>A?m&k|m&e|k&e:m^k^e),h.addWords(h.addWords(g,
c[A]),20>A?1518500249:40>A?1859775393:60>A?-1894007588:-899497514));g=e;e=k;k=m<<30|m>>>2;m=d;d=z}d=h.addWords(d,n);m=h.addWords(m,v);k=h.addWords(k,t);e=h.addWords(e,p);g=h.addWords(g,w)}return[d,m,k,e,g]}function n(a){for(var b=[],c=0,d=8*a.length;c<d;c+=8)b[c>>5]|=(a.charCodeAt(c/8)&255)<<24-c%32;return b}function g(a){for(var b=[],c=0,d=4*a.length;c<d;c++)b.push("0123456789abcdef".charAt(a[c>>2]>>8*(3-c%4)+4&15),"0123456789abcdef".charAt(a[c>>2]>>8*(3-c%4)&15));return b.join("")}function d(a){for(var b=
[],c=0,d=32*a.length;c<d;c+=8)b.push(String.fromCharCode(a[c>>5]>>>24-c%32&255));return b.join("")}function c(a){for(var b=[],c=0,d=4*a.length;c<d;c+=3)for(var m=(a[c>>2]>>8*(3-c%4)&255)<<16|(a[c+1>>2]>>8*(3-(c+1)%4)&255)<<8|a[c+2>>2]>>8*(3-(c+2)%4)&255,k=0;4>k;k++)8*c+6*k>32*a.length?b.push("\x3d"):b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(m>>6*(3-k)&63));return b.join("")}h.SHA1=function(a,b){var r=b||h.outputTypes.Base64,f=p(n(a),8*a.length);switch(r){case h.outputTypes.Raw:return f;
case h.outputTypes.Hex:return g(f);case h.outputTypes.String:return d(f);default:return c(f)}};h.SHA1._hmac=function(a,b,r){r=r||h.outputTypes.Base64;var f=n(b);16<f.length&&(f=p(f,8*b.length));var m=Array(16);b=Array(16);for(var k=0;16>k;k++)m[k]=f[k]^909522486,b[k]=f[k]^1549556828;a=p(m.concat(n(a)),512+8*a.length);a=p(b.concat(a),672);switch(r){case h.outputTypes.Raw:return a;case h.outputTypes.Hex:return g(a);case h.outputTypes.String:return d(a);default:return c(a)}};return h.SHA1})},"xide/manager/ManagerBase":function(){define("dcl/dcl xide/mixins/EventedMixin xide/model/Base xide/utils dojo/_base/xhr dojo/_base/kernel".split(" "),
function(h,p,n,g,d,c){p=h([n.dcl,p.dcl],{declaredClass:"xide.manager.ManagerBase",ctx:null,init:function(){this.initReload&&this.initReload()},_getText:function(a,b){var c;b=g.mixin({url:a,sync:!0,handleAs:"text",load:function(a){c=a}},b);var f=d.get(b);return b.sync?""+c+"":f},getContext:function(){return this.ctx}});h.chainAfter(p,"init");return p})},"xide/data/Reference":function(){define(["dojo/_base/declare","xide/utils"],function(h,p){var n={_sources:[],removeSource:function(d){},updateSource:function(d){},
onSourceUpdate:function(d){},onSourceRemoved:function(d){},onSourceDelete:function(d){},onItemChanged:function(d){},destroy:function(){this.item.removeReference&&this.item.removeReference(this);this.inherited(arguments)},addSource:function(d,c){this._sources.push({item:d,settings:c});var a=this;if(c&&c.onDelete)d._store.on("delete",function(b){b.target==d&&a._store.removeSync(a[a._store.idProperty])})},updateSources:function(d){for(var c=0;c<this._sources.length;c++){var a=this._sources[c],b=a.item,
a=a.settings;d.property&&a.properties&&a.properties[d.property]&&(b._store._ignoreChangeEvents=!0,b.set(d.property,d.value),b._store._ignoreChangeEvents=!1,b._store.emit("update",{target:b}))}},constructor:function(d){this._sources=[];p.mixin(this,d)}},g=h("xgrid.data.Reference",null,n);g.Implementation=n;return g})},"xcf/manager/DeviceManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/encoding/MD5 xide/types xide/utils xide/factory xcf/manager/BeanManager xide/mixins/ReloadMixin xide/mixins/EventedMixin ./DeviceManager_Server ./DeviceManager_DeviceServer xide/data/TreeMemory dojo/has xide/data/ObservableStore dstore/Trackable xcf/model/Device dojo/Deferred xide/manager/ServerActionBase xide/data/Reference xide/utils/StringUtils xcf/mixins/LogMixin xdojo/has!xcf-ui?./DeviceManager_UI xdojo/has!xexpression?xexpression/Expression dojo/promise/all".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m,k,e,q,l,u,v,t,y,w,A,z,G,H,F,B,D){a=[y,b,m,k,r.dcl,z];var C=q("xcf-ui"),x=d.DEVICE_PROPERTY;q("runDrivers");var E=d.EVENTS;q("xcf-ui")&&a.push(G);return h(a,{declaredClass:"xcf.manager.DeviceManager",beanNamespace:"device",beanName:"Device",beanIconClass:"fa-sliders",groupType:d.ITEM_TYPE.DEVICE_GROUP,itemType:d.ITEM_TYPE.DEVICE,itemMetaTitleField:x.CF_DEVICE_TITLE,systemScope:"system_devices",userScope:"user_devices",appScope:"app_devices",defaultScope:"system_devices",
serviceClass:"XCF_Device_Service",rawData:null,store:null,treeView:null,deviceServerClient:null,deviceInstances:null,driverScopes:null,autoConnectDevices:!0,consoles:null,lastUpTime:null,reconnectDevice:15E3,reconnectDeviceServer:5E3,onRunClassEvent:function(a){var b=a.args.id;if(this.running&&this.running[b]&&(b=this.running[b].delegate)){if(a.error&&b.onError)b.onError(a.error);if(a.finish&&b.onFinish)b.onFinish(a.finish);if(a.progress&&b.onProgress)b.onProgress(a.progress)}},getInstanceByName:function(a){var b=
this.deviceInstances,c;for(c in b){var d=b[c].device;if(d&&this.getMetaValue(d,x.CF_DEVICE_TITLE)===a)return b[c]}},getFile:function(a){var b=new t,c=this.ctx.getFileManager().getStore(a.scope);c.initRoot().then(function(){c._loadPath(".",!0).then(function(){c.getItem(a.path,!0).then(function(a){b.resolve(a)})})});return b},getSourceHash:function(){return this.ctx.getUserDirectory()||"no_user_directory"},checkDeviceServerConnection:function(){if(!this.ctx.getNodeServiceManager)return!0;if(!this.deviceServerClient&&
this.ctx.getNodeServiceManager){var a=this.ctx.getNodeServiceManager().getStore();if(!a)return console.error("checkDeviceServerConnection : have no service store"),!1;this.createDeviceServerClient(a)}return!0},addDriverFunctions:function(a,b){for(var c in b)"constructor"!==c&&"inherited"!==c&&"getInherited"!=c&&"isInstanceOf"!=c&&"__inherited"!=c&&"onModuleReloaded"!=c&&"start"!=c&&"publish"!=c&&"subscribe"!=c&&"getInherited"!=c&&"getInherited"!=c&&_.isFunction(b[c])&&!a[c]&&(a[c]=b[c])},addLoggingFunctions:function(a,
b){var c=this;b.log=function(a,l,f,e){e=e||{};var k=n.clone(e);e.type=e.type||l||"Driver";b.options&&(e.device=b.options);c.publish(d.EVENTS.ON_SERVER_LOG_MESSAGE,{data:e,level:a||"info",message:f,details:k})}},completeDriverInstance:function(a,b,c){var l=this,e=b.blockScope.blockStore,f=c.path,k=f+"_commands",m=f+"_variables";e.on("delete",function(a){var b=-1!==a.target.declaredClass.indexOf("Variable")?m:k,d=c._store.getSync(b);d&&d.refresh();(a=c._store.getSync(b+"_reference_"+a.target.id))&&
a.refresh()});e.on("added",function(b){var l=b.name,e=b.icon||"fa-exclamation",f=-1!==b.declaredClass.indexOf("Variable"),g=f?m:k;-1!=b.declaredClass.indexOf(f?"Variable":"Command")&&(l=new w({enabled:!0,path:g+"_reference_"+b.id,name:l,id:b.id,parentId:g,_mayHaveChildren:!1,virtual:!0,tooltip:!0,icon:e,ref:{driver:a,item:b,device:c},type:d.ITEM_TYPE.BLOCK}),l=c._store.putSync(l),b.addReference(l,{properties:{name:!0,enabled:!0,value:!0},onDelete:!0},!0),l.refresh())});b.setVariable=function(b,c,
e,f,k){if(b=this.blockScope.getVariable(b))b.value=c,!1===k&&(b.__ignoreChangeMark=!0),b.set("value",c,e,f,k),!1===k&&(b.__ignoreChangeMark=!1),l.publish(d.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:b,scope:this.blockScope,driver:a,owner:l,save:!0===e,publish:f})};b.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a._getArg(a.value,!1):""};b.log=function(a,c,e,f){f=f||{};var k=n.clone(f);f.type=f.type||c||"Driver";b.options&&(f.device=b.options);l.publish(d.EVENTS.ON_SERVER_LOG_MESSAGE,
{data:f,level:a||"info",message:e,details:k})};for(var g in a)"constructor"!==g&&"inherited"!==g&&"getInherited"!=g&&"isInstanceOf"!=g&&"__inherited"!=g&&"onModuleReloaded"!=g&&"start"!=g&&"publish"!=g&&"subscribe"!=g&&"getInherited"!=g&&"getInherited"!=g&&n.isFunction(a[g])&&!b[g]&&(b[g]=a[g])},getDevice:function(a){var b=a;if(_.isString(a)){var c=this.getItemById(a);c?b=c:(a=this.getItemByPath(a))&&(b=a)}return b},stopDevice:function(a){var b=this.getDevice(a)||a;if(b){if(this.checkDeviceServerConnection(),
b._userStopped=!0,(a=this.toDeviceControlInfo(b))&&(a.serverSide||b.isServer())){var c=a.hash;this.deviceInstances[c]&&(this._removeInstance(this.deviceInstances[c],c,b),delete this.deviceInstances[c],this.sendManagerCommand(d.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER,a))}}else console.error("cant find device "+a)},getStore:function(a){a=a||"system_devices";var b=this.stores[a];if(b)return b;if(a)return this.ls(a)},getDevices:function(a,b){var d=this.getStore();if(!d)return[];d=c.queryStore(d,{isDir:!1});
d._S&&(d=[d]);for(var l=[],f=0;f<d.length;f++){var e=d[f],k=this.getMetaValue(e,x.CF_DEVICE_ENABLED);if(!0===a&&1==k||null==k||!1===a)l.push(e),1==b&&(k=this.getMetaValue(e,x.CF_DEVICE_DRIVER))&&(k=this.ctx.getDriverManager().getItemById(k))&&(e.driver=k)}return l},getStores:function(){var a=[],b;for(b in this.stores){var c=this.stores[b];c&&a.push(c)}return a},getStorePath:function(a){var b=this.getContext().getResourceManager();if("user_devices"===a)return b.getVariable("USER_DIRECTORY")},connectToAllDevices:function(){function a(b){if(!b)console.error("have no device store");
else if(!b.connected){b.connected=!0;b=c.queryStore(b,{isDir:!1});b._S&&(b=[b]);_.isArray(b)||(b=[b]);for(var f=0;f<b.length;f++){var e=b[f],k=d.getMetaValue(e,x.CF_DEVICE_ENABLED);if(1==k||null==k)e=d.startDevice(e),l.push(e)}}}if(this.deviceServerClient){var b=this.getStores(),d=this;if(this.getStores().length){var l=[];_.each(b,a,this);return l}}else this.checkDeviceServerConnection()},debug:function(){console.info("Debug info stores : ");_.each(this.stores,function(a){console.log("have store "+
a.scope)})},_getLogText:function(a){return moment().format("HH:mm:ss:SSS")+" ::   "+a+""},_parse:function(a,b){var c=""+b;if(0<c.indexOf("{{")||0<c.indexOf("}}"))console.time("parse expression"),c=(new H).parse(d.EXPRESSION_PARSER.FILTREX,c,this,{variables:a.getVariablesAsObject(),delimiters:{begin:"{{",end:"}}"}}),console.timeEnd("parse expression");else{var l=a.parseExpression(b);l&&(c=l)}return c},runCommand:function(a,b){},_lastActions:null,onStoreReloaded:function(a){this.completeDeviceStore()},
getInstance:function(a){if(a=a?a._store?this.toDeviceControlInfo(a):a:null)return this.getDriverInstance(a,!1)},getDriverInstance:function(a,b){if(!a)return console.error("getDriverInstance::have no device info"),null;for(var l in this.deviceInstances){var f=this.deviceInstances[l],e=f.options;if(e&&e.port===a.port&&e.host===a.host&&e.protocol===a.protocol&&e.isServer===a.isServer)return b&&f.sendSettings&&q("xcf-ui")&&(b=!1),!1!==b&&f&&!f.sendSettings&&(l=this.ctx.getDriverManager().getItemById(a.driverId))&&
(l=l.user,(e=c.getCIByChainAndName(l,0,d.DRIVER_PROPERTY.CF_DRIVER_COMMANDS))&&e.params&&(f.sendSettings=c.getJson(e.params)),(l=c.getCIByChainAndName(l,0,d.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&l.params&&(f.responseSettings=c.getJson(l.params))),f}return null},_reconnectServerTimer:null,onDeviceServerConnectionLost:function(){if(!this.deviceServerClient||!this.deviceServerClient.pageUnloaded)if(this.deviceServerClient&&(this.deviceServerClient.destroy(),this.deviceServerClient=null),!this._reconnectServerTimer){var a=
this;C&&a.ctx.getNotificationManager().postMessage({message:"Lost connection to device server, try reconnecting in 5 seconds",type:"error",showCloseButton:!0,duration:1E3});this._reconnectServerTimer=setTimeout(function(){a.checkDeviceServerConnection();a._reconnectServerTimer=null},this.reconnectDeviceServer);console.log("lost device server connection");_.each(this.deviceInstances,function(a){if(a&&a.device&&!a.domNode){a=a.device;var b=a.driverInstance;b&&b.onLostServer&&b.onLostServer();a.setState(d.DEVICE_STATE.LOST_DEVICE_SERVER)}})}},
onMQTTMessage:function(a){var b=c.getJson(a.message),l=!1;if(b){var f=b.sourceHost,e=b.sourcePort,k=a.host,g=a.port;f&&e&&f===k&&e==g&&(l=!0)}if(!l&&(l=a.topic.split("/"),4==l.length&&"Variable"==l[2]&&b.device))if(this.getDeviceStoreItem(b.device)){if(a=this.toDeviceControlInfo(b.device))if(a=this.getDriverInstance(a))if(a=a.blockScope.getVariable(l[3]))q("xcf-ui")?(a.set("value",b.value),a.refresh()):(delete a.value,a.value=b.value),this.publish(d.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:a,scope:a.scope,
owner:this,save:!1,publish:!0,source:"mqtt",publishMQTT:!1})}else console.error("cant find device for : "+a.topic)},getBlock:function(a){for(var b in this.deviceInstances){var c=this.deviceInstances[b];if(c&&c.device&&(c=c.blockScope)&&(c=c.resolveBlock(a)))return c}return this.ctx.getDriverManager().getBlock(a)},onNodeServiceStoreReady:function(a){this.deviceServerClient&&this.deviceServerClient.destroy();this.createDeviceServerClient(a.store)},onDriverUpdated:function(a,b){},onModuleReloaded:function(a){if(0!=
this.deviceInstances.length){var b=c.replaceAll("//","/",a.module);a=a.newModule;for(var d in this.deviceInstances){var l=this.deviceInstances[d];if(l.modulePath===b||l.baseClass===b)this.mergeFunctions(l,a.prototype),l.blockScope&&(l.blockScope.expressionModel.expressionCache={}),this.onDriverUpdated(l,b)}}},_removeInstance:function(a,b,c){a.destroy&&a.destroy();a.blockScope&&a.blockScope._destroy();delete this.deviceInstances[b];this.ctx.getBlockManager().removeScope(a.options.id);this.ctx.getDriverManager().removeDriverInstance(a,
c);c.reset()},removeDriverInstance:function(a){if(a=this.getDriverInstance(a))this.ctx.getBlockManager().removeScope(a.options.id),a.blockScope&&a.blockScope.destroy(),a.destroy();for(var b in this.deviceInstances)a==this.deviceInstances[b]&&delete this.deviceInstances[b]},getMetaValue:function(a,b){var d=a.user;return d?c.getCIInputValueByName(d,b):null},getDeviceByHost:function(a,b){for(var d=c.queryStore(this.getStore(),{isDir:!1}),l=0;l<d.length;l++){var f=d[l],e=this.getMetaValue(f,x.CF_DEVICE_HOST),
k=this.getMetaValue(f,x.CF_DEVICE_PORT);if(e==a&&k==b)return f}return null},getDeviceByUrl:function(a){a=c.parse_url(a);a=c.urlArgs(a.host);return this.getDeviceById(a.device.value)},getDeviceById:function(a,b){function d(b){b=c.queryStore(b,{isDir:!1});b._S&&(b=[b]);for(var f=0;f<b.length;f++){var e=b[f];if(l.getMetaValue(e,x.CF_DEVICE_ID)==a)return e}return null}var l=this,f=_.isString(b)?this.getStore(b):null;if(f)return d(f);for(var e in this.stores)if(f=d(this.stores[e]))return f;return null},
getDeviceByName:function(a,b){function d(b){b=c.queryStore(b,{isDir:!1});b._S&&(b=[b]);for(var f=0;f<b.length;f++){var e=b[f];if(l.getMetaValue(e,x.CF_DEVICE_TITLE)==a)return e}return null}var l=this,f=_.isString(b)?this.getStore(b):null;if(f)return d(f);for(var e in this.stores)if(f=d(this.stores[e]))return f;return null},getDevicesByDriverId:function(a){var b=c.queryStore(this.getStore(),{isDir:!1});b._S&&(b=[b]);for(var d=0;d<b.length;d++){var l=b[d];if(this.getMetaValue(l,x.CF_DEVICE_ID)==a)return l}return null},
_cachedItems:null,getDeviceStoreItem:function(a){if(a){if(a.hash&&this._cachedItems){var b=this._cachedItems[a.hash];if(b)return b}var d=this.getStore(a.deviceScope);if(d){var l=c.queryStore(d,{isDir:!1});if(!l)return null;l&&!_.isArray(l)&&(l=[l]);for(var f=0;f<l.length;f++){var b=l[f],e=b.user,k=c.getCIInputValueByName(e,x.CF_DEVICE_HOST),g=c.getCIInputValueByName(e,x.CF_DEVICE_PORT),m=c.getCIInputValueByName(e,x.CF_DEVICE_ID),e=c.getCIInputValueByName(e,x.CF_DEVICE_PROTOCOL);if(g===a.port&&k===
a.host&&e===a.protocol&&b.isServer()===a.isServer&&m===a.id)return(d=d.getSync(b.path))&&(b=d),a.hash&&(this._cachedItems||(this._cachedItems={}),this._cachedItems[a.hash]=b),b}}}},onDriverSettingsChanged:function(a,b){for(var l in this.deviceInstances){var f=this.deviceInstances[l];if(f&&f.driver==b){l=b.user;var e=c.getCIByChainAndName(l,0,d.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);e&&e.params&&e==a&&(f.sendSettings=c.getJson(e.params));(l=c.getCIByChainAndName(l,0,d.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&
l.params&&(f.responseSettings=c.getJson(l.params));break}}},onDeviceStateChanged:function(a,b){!0!==a._userStopped&&!0!==b&&a.info&&a.state&&a.state==d.DEVICE_STATE.DISCONNECTED&&this.ctx.getNotificationManager().postMessage({message:"Lost connection to "+a.info.host+", ...reconnecting",type:"error",showCloseButton:!1,duration:1500});!0!==b&&a.info&&a.state&&a.state==d.DEVICE_STATE.CONNECTED&&this.ctx.getNotificationManager().postMessage({message:"Connected to "+a.info.host+"",type:"success",showCloseButton:!1,
duration:2E3})},connectDevice:function(a){this.checkDeviceServerConnection();var b=this.toDeviceControlInfo(a);if(b){var c=b.hash;if(this.deviceInstances[c])return a.setState(d.DEVICE_STATE.CONNECTED),this.deviceInstances[c];a.setState(d.DEVICE_STATE.CONNECTING);this.publish(d.EVENTS.ON_STATUS_MESSAGE,{text:"Trying to connect to "+b.toString(),type:"info"});this.sendManagerCommand(d.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,b)}else console.error("couldnt start device, invalid control info")},onAppReady:function(a){a=
a.context;a.deviceManager=this;a.driverManager=this;a.blockManager&&c.mixin(a.blockManager.scopes,this.ctx.getBlockManager().scopes)},onHaveNoDeviceServer:function(){if(this.ctx.getNotificationManager())var a=this,b=this.ctx.getNotificationManager().postMessage({message:"Have no device server connection",type:"error",showCloseButton:!0,duration:1500,actions:{reconnect:{label:"Reconnect",action:function(){a.checkDeviceServerConnection();return b.update({message:"Reconnecting...",type:"success",actions:!1,
duration:1500})}}}})},setDriverScriptContent:function(a,b,c,d,l){return this.callMethodEx(null,"setDriverContent",[a,b,c],d,!0)},getDriverScriptContent:function(a,b,c,d){return this.callMethodEx(null,"getDriverContent",[a,b],c,!0)},createStore:function(a,b,d){a=new (p("deviceStore",[e,u,l],{}))({data:a.items,idProperty:"path",Model:v,id:c.createUUID(),scope:b,observedProperties:["name","state","iconClass","enabled"]});b&&!1!==d&&this.setStore(b,a);return a},initStore:function(a,b,c){return this.createStore(a,
b,c)},fixDeviceCI:function(a){var b=a.user,d=c.getCIByChainAndName(b,0,x.CF_DEVICE_DRIVER_OPTIONS);d?(d.data=[{value:2,label:"Runs Server Side"},{value:4,label:"Show Debug Messages"},{value:8,label:"Allow Multiple Device Connections"},{value:16,label:"Server"}],d.group="Common"):b.inputs.push({chainType:0,"class":"cmx.types.ConfigurableInformation",dataRef:"",dataSource:"",description:null,enabled:!0,enumType:"-1",flags:-1,group:"Common",id:x.CF_DEVICE_DRIVER_OPTIONS,name:x.CF_DEVICE_DRIVER_OPTIONS,
order:1,params:null,platform:null,title:"Driver Options",type:5,uid:"-1",value:0,data:[{value:2,label:"Runs Server Side"},{value:4,label:"Show Debug Messages"},{value:8,label:"Allow Multiple Device Connections"},{value:16,label:"Server"}],visible:!0,device:a});(d=c.getCIByChainAndName(b,0,x.CF_DEVICE_LOGGING_FLAGS))?d.group="Logging":b.inputs.push({chainType:0,"class":"cmx.types.ConfigurableInformation",dataRef:"",dataSource:"",description:null,enabled:!0,enumType:"-1",flags:-1,group:"Logging",id:x.CF_DEVICE_LOGGING_FLAGS,
name:x.CF_DEVICE_LOGGING_FLAGS,order:1,params:null,platform:null,title:"Logging Flags",type:x.CF_DEVICE_LOGGING_FLAGS,uid:"-1",value:0,data:[{value:2,label:"On Connected"},{value:4,label:"On Disconnected"},{value:8,label:"On Error"},{value:16,label:"Commands"},{value:32,label:"Responses"}],visible:!0,device:a});if(a=c.getCIByChainAndName(b,0,x.CF_DEVICE_PROTOCOL))a.type=3,a.options=[{label:"TCP",value:"tcp"},{label:"UDP",value:"udp"},{label:"Driver",value:"driver"},{label:"SSH",value:"ssh"},{label:"Serial",
value:"serial"},{label:"MQTT",value:"mqtt"}]},_deviceInfoCache:null,toDeviceControlInfo:function(a){if(!a)return null;q("xcf-ui");if(!a._store&&a.id){var b=this.getItemById(a.id);b&&(a=b)}if(!a||!a.path)if(b=this.getDeviceStoreItem(a),!b)return null;var l=a.user,b=c.getCIInputValueByName(l,x.CF_DEVICE_HOST),f=c.getCIInputValueByName(l,x.CF_DEVICE_PORT),e=c.getCIInputValueByName(l,x.CF_DEVICE_TITLE),k=c.getCIInputValueByName(l,x.CF_DEVICE_PROTOCOL),m=c.getCIInputValueByName(l,x.CF_DEVICE_DRIVER),h=
c.getCIInputValueByName(l,x.CF_DEVICE_OPTIONS),r=c.getCIInputValueByName(l,x.CF_DEVICE_LOGGING_FLAGS),l=c.getCIInputValueByName(l,x.CF_DEVICE_DRIVER_OPTIONS),n=a.isServerSide(),v=a.isServer(),u=null;this.fixDeviceCI(a);var t=this.ctx.getDriverManager().getDriverById(m);if(t){var p=t.user,u=c.getCIInputValueByName(p,d.DRIVER_PROPERTY.CF_DRIVER_CLASS),p=c.getCIByChainAndName(p,0,d.DRIVER_PROPERTY.CF_DRIVER_RESPONSES),y={},t=t.scope;p&&p.params&&(y=c.getJson(p.params));u={host:b,port:f,protocol:k,driver:u?
u.replace("./",""):"",driverId:m,driverScope:t,id:a.id,devicePath:a.path,deviceScope:a.getScope(),title:e,options:h,driverOptions:l,serverSide:n,isServer:v,responseSettings:y,source:C?"ide":"server",user_devices:this.ctx.getMount(a.getScope()),system_devices:this.ctx.getMount("system_devices"),system_drivers:this.ctx.getMount("system_drivers"),user_drivers:this.ctx.getMount("user_drivers"),loggingFlags:r,toString:function(){return a.getScope()+"://"+this.host+":"+this.port+"@"+this.protocol}};u.hash=
g(JSON.stringify({host:b,port:f,protocol:k,driverId:m,driverScope:t,id:a.id,devicePath:a.path,deviceScope:a.getScope(),source:C?"ide":"server",user_devices:this.ctx.getMount(a.getScope()),system_devices:this.ctx.getMount("system_devices"),system_drivers:this.ctx.getMount("system_drivers"),user_drivers:this.ctx.getMount("user_drivers")}),1);if(b=this.ctx.getUserDirectory())u.userDirectory=b}a.info=u;q("xcf-ui");return u},getItemById:function(a){for(var b in this.stores){var c;c=this.stores[b];var d=
_.find(c.data,{id:a});c=d?c.getSync(d.path):null;if(c)return c}},getItemByPath:function(a){for(var b in this.stores){var c=this.stores[b].getSync(a);if(c)return c}},onStoreCreated:function(a){var b=this,l=b.ctx,f=a.type,e=a.store,k=e?c.queryStore(e,{isDir:!1}):[],m=this.ctx.getDriverManager();k&&!_.isArray(k)&&(k=[k]);if(f===d.ITEM_TYPE.DEVICE){for(f=0;f<k.length;f++){var g=e.getSync(k[f].path);if(!g)console.error("cant find "+k[f].path);else if(null==g._completed){g._completed=!0;var q=this.getMetaValue(g,
x.CF_DEVICE_DRIVER);q?(q=m.getItemById(q),_.each(g.user.inputs,function(a){a.device=g;a.actionTarget=C?l.mainView.getToolbar():null;a.ctx=l}),!_.isEmpty(q)&&C&&(this.completeDevice(e,g,q),g.iconClass=g.getStateIcon())):console.error("device has no driver id!")}}F(this.connectToAllDevices()).then(function(){b.publish("DevicesConnected",a)})}},onClientMessage:function(a){this.checkDeviceServerConnection();this.deviceServerClient&&this.sendManagerCommand(d.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE,a)},
onClientLogMessage:function(a){},onVariableChanged:function(a){var b=a.item,c=a.scope,l=b.name,f=!1!==a.publish;"value"!==l&&!1!==f&&b&&(b=b.value,(c=c.device)&&c.info&&(c=c.info,l=c.host+"/"+c.port+"/Variable/"+l,!1!==a.publishMQTT&&this.sendManagerCommand(d.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH,{topic:l,data:{value:b,device:c}})))},init:function(){var a=this;this.initUI&&this.initUI();this.stores={};this._deviceInfoCache={};this.subscribe(d.EVENTS.ON_DRIVER_VARIABLE_CHANGED,this.onVariableChanged);
this.subscribe(d.EVENTS.ON_DEVICE_SERVER_CONNECTED,function(){a.autoConnectDevices&&F(a.connectToAllDevices()).then(function(){a.publish("DevicesConnected")})});this.subscribe([E.ON_NODE_SERVICE_STORE_READY,E.ON_MODULE_RELOADED,E.ON_DEVICE_DISCONNECTED,E.ON_DEVICE_CONNECTED,E.ON_CLIENT_LOG_MESSAGE,E.ON_STORE_CREATED]);this.deviceInstances=this.consoles={};this.driverScopes={system_drivers:"system_drivers/",user_drivers:"user_drivers/"};this.lastUpTime=(new Date).getTime();setInterval(function(){var b=
(new Date).getTime();3E4<b-a.lastUpTime&&(a.lastUpTime=(new Date).getTime());a.lastUpTime=b},1E3);this.initReload()},onDeviceServerConnected:function(){var a=this;this.deviceInstances&&_.each(this.deviceInstances,function(b){b&&b.device&&!b.domNode&&a.startDevice(b.device)})},addDeviceInstance:function(a,b){},ls:function(a,b,c){function l(c){try{var e=this.createStore(c,a,!0===b?!1:!0);!1!==b&&this.setStore(a,e);this.onStoreReady(e);!1!==b&&this.publish(d.EVENTS.ON_STORE_CREATED,{data:c,owner:this,
store:e,type:this.itemType});f.resolve(e)}catch(k){logError(k,"error ls drivers")}}var f=new t;q("php")?this.runDeferred(null,"ls",[a]).then(l.bind(this)):f.resolve({items:[]});return f},hasStore:function(a){return this.stores[a]}})})},"xcf/manager/DeviceManager_Server":function(){define(["dcl/dcl"],function(h){return h(null,{})})},"xcf/manager/DeviceManager_DeviceServer":function(){define("dcl/dcl xide/encoding/MD5 xide/types xide/utils xide/factory xdojo/has dojo/Deferred xide/mixins/ReloadMixin xide/mixins/EventedMixin require xcf/model/Variable xide/utils/HexUtils xdojo/has!host-node?nxapp/utils/_console".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m,k,e){var q="undefined"!==typeof window?window.console:"undefined"!==typeof global?global.console:e;e&&(q=e);var l=c("xcf-ui"),u=!1;if("undefined"!==typeof sctx&&sctx)g.createUUID(),sctx.getResourceManager(),sctx.getApplication();else return h(null,{declaredClass:"xcf.manager.DeviceManager_DeviceServer",running:null,onDeviceStarted:function(a,b,c){if(a&&b&&c){var d=this.toDeviceControlInfo(b),l=d.serverSide,f=d.isServer,e=a.blockScope;(l||f||!l&&!f)&&e.start();a.__didStartBlocks=
!0;this.publish(n.EVENTS.ON_DEVICE_DRIVER_INSTANCE_READY,{device:b,instance:a,driver:c,blockScope:e});this.publish(n.EVENTS.ON_DEVICE_CONNECTED,{device:d,instance:a,driver:c,blockScope:e});this.ctx.getDriverManager().addDeviceInstance(b,c)}},runClass:function(a,b,c){this.checkDeviceServerConnection();if(this.deviceServerClient){var d=g.createUUID();b.id=d;var l={"class":a,args:b,manager_command:n.SOCKET_SERVER_COMMANDS.RUN_CLASS};!this.running&&(this.running={});this.running[d]={"class":a,args:b,
delegate:c};this.deviceServerClient.emit(null,l,n.SOCKET_SERVER_COMMANDS.RUN_CLASS)}else this.onHaveNoDeviceServer()},startDevice:function(b,c,d){var l=this;if(!b)return q.error("start device invalid item"),null;this.checkDeviceServerConnection();b.check();u=!0;var e=new a;b._startDfd&&!b._startDfd.isResolved()||b.driverInstance||b.reset();!0===c&&b.setMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_ENABLED,!0,!1);b.getMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_ENABLED);var k=this.toDeviceControlInfo(b);if(!k)return q.error("invalid client info, assuming no driver found"),
e.reject("invalid client info, assuming no driver found"),e;if(!k)return q.error("couldnt start device, invalid control info "+k.toString()),e.reject(),e;var m=k.hash;c=b.state===n.DEVICE_STATE.LOST_DEVICE_SERVER;if(this.deviceInstances[m]&&!0!==c)return u&&q.warn("device already started : "+k.toString()),e.resolve(this.deviceInstances[m]),e;if(c&&this.deviceInstances[m])return l.publish(n.EVENTS.ON_STATUS_MESSAGE,{text:"Trying to re-connect to "+k.toString(),type:"info"}),l.sendManagerCommand(n.SOCKET_SERVER_COMMANDS.CREATE_CONNECTION,
k),b.setState(n.DEVICE_STATE.CONNECTING),e.resolve(this.deviceInstances[m]),e;b.setState(n.DEVICE_STATE.CONNECTING);b._userStopped=null;b._startDfd=e;c=this.driverScopes.system_drivers;var h=c+"DriverBase";try{f([h],function(a){a.prototype.declaredClass=h;l.createDriverInstance(k,a,b).then(function(a){a.id||(a.id=g.createUUID());a||q.warn("buildMQTTParams:have no driver instance");k.mqtt={driverScopeId:a&&a.blockScope?a.blockScope.id:"have no driver instance",driverId:a?a.driver.id:"have no driver id",
deviceId:b.path};l.publish(n.EVENTS.ON_STATUS_MESSAGE,{text:"Trying to connect to "+k.toString(),type:"info"});b._startDfd&&!b._startDfd.isResolved()?l.sendManagerCommand(n.SOCKET_SERVER_COMMANDS.CREATE_CONNECTION,k):l.sendManagerCommand(n.SOCKET_SERVER_COMMANDS.START_DEVICE,k);e.resolve(l.deviceInstances[m]);delete k.mqtt}).then(function(){},function(a){e.resolve(null)})},function(a){q.error(a)})}catch(r){logError(r,"DeviceManager::startDevice: requiring base driver at "+h+" failed! Base Driver - Prefix : "+
c)}return e},createDriverInstance:function(c,d,l){var e=c.hash,k=this.driverScopes[c.driverScope],m=!f.cache,u=f.toUrl(k),u=g.removeURLParameter(u,"bust");m&&(u=u.replace("/.js","/"));var p=decodeURIComponent(u)+c.driver,p=p.replace("","").trim(),F=this,u=F.ctx,m=g.getCIInputValueByName(l.user,n.DEVICE_PROPERTY.CF_DEVICE_DRIVER),u=u.getDriverManager(),B=u.getDriverById(m),D=new a;l.getMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_ENABLED);l.isEnabled();if(!(l.isServerSide()||l.isServer()||c.isServer||c.serverSide))return D.reject("DeviceManager_DeviceServer: wont create driver instance! I am server and device isnt server side : "+
c.title),D;try{u.getDriverModule(B).then(function(a){var f=new (h([d,r.dcl,b.dcl,a],{}));f.declaredClass=p;f.options=c;f.baseClass=d.prototype.declaredClass;f.modulePath=g.replaceAll("//","/",k+c.driver).replace(".js","");f.delegate=F;f.driver=B;f.serverSide=c.serverSide;f.utils=g;f.types=n;f.device=l;f.Module=a;f.id=g.createUUID();f.getDevice=function(){return this.device};f.getDeviceInfo=function(){return this.getDevice().info};a=B.user;var m=g.getCIByChainAndName(a,0,n.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);
m&&m.params&&(f.sendSettings=g.getJson(m.params));(a=g.getCIByChainAndName(a,0,n.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&a.params&&(f.responseSettings=g.getJson(a.params));try{f.start(),f.initReload()}catch(u){q.error("crash in driver instance startup! "+l.toString()),logError(u,"crash in driver instance startup!")}F.deviceInstances[e]=f;B.blox&&B.blox.blocks||(B.blox={blocks:[]});l.driverInstance=f;F.getDriverInstance(c,!0);f._id=g.createUUID();D.resolve(f);return f})}catch(C){q.error("DeviceManager::createDriverInstance:: requiring base driver at "+
p+" failed "+C.message,g.inspect(c))}return D},createDriverInstance_bak:function(c,d,l){var e=c.hash,k=this.driverScopes[c.driverScope],m=!f.cache,u=f.toUrl(k),u=g.removeURLParameter(u,"bust");m&&(u=u.replace("/.js","/"));var p=decodeURIComponent(u)+c.driver,p=p.replace("","").trim(),F=this,m=F.ctx,u=g.getCIInputValueByName(l.user,n.DEVICE_PROPERTY.CF_DEVICE_DRIVER),B=m.getDriverManager().getDriverById(u),D=new a;l.getMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_ENABLED);if(!1===l.isEnabled())return setTimeout(function(){D.reject()}),
D;if(!l.isServerSide())return D.reject("DeviceManager_DeviceServer: wont create driver instance! I am server and device isnt server side : "+c.title),D;try{f([p],function(a){var f=new (h([d,r.dcl,b.dcl,a],{}));f.declaredClass=p;f.options=c;f.baseClass=d.prototype.declaredClass;f.modulePath=g.replaceAll("//","/",k+c.driver).replace(".js","");f.delegate=F;f.driver=B;f.serverSide=c.serverSide;f.utils=g;f.types=n;f.device=l;f.Module=a;f.getDevice=function(){return this.device};f.getDeviceInfo=function(){return this.getDevice().info};
a=B.user;var m=g.getCIByChainAndName(a,0,n.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);m&&m.params&&(f.sendSettings=g.getJson(m.params));(a=g.getCIByChainAndName(a,0,n.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&a.params&&(f.responseSettings=g.getJson(a.params));try{f.start(),f.initReload()}catch(u){q.error("crash in driver instance startup! "+l.toString()),logError(u,"crash in driver instance startup!")}F.deviceInstances[e]=f;B.blox&&B.blox.blocks||(B.blox={blocks:[]});l.driverInstance=f;F.getDriverInstance(c,
!0);f._id=g.createUUID();D.resolve(f);return f})}catch(C){q.error("DeviceManager::createDriverInstance:: requiring base driver at "+p+" failed "+C.message,g.inspect(c))}return D},onSetDeviceServerVariables:function(a){var b=this.getDriverInstance(a.device,!0),c=this.getDeviceStoreItem(a.device);if(c){if(!b.blockScope){var d=c.info,f=d.hash,e=b.driver,k=d.driverId,m=this.getContext(),d=d.serverSide,h=k+"_"+f+"_"+c.path;e.blox&&e.blox.blocks||(e.blox={blocks:[]});e.blockPath&&(g.getJson(g.readFile(e.blockPath)),
e.blox=g.getJson(g.readFile(e.blockPath)));f=m.getBlockManager().createScope({id:h,device:c,driver:e,instance:b,serviceObject:this.serviceObject,ctx:m,serverSide:d,getContext:function(){return this.instance}},g.clone(e.blox.blocks),function(a){a&&q.error(a+" : in "+e.name+" Resave Driver! in scope id "+h)});b.blockScope=f;c.blockScope=f;l&&this.completeDriverInstance(e,b,c)}if(b){var f=a.variables,r=b.blockScope;c.serverVariables=a.variables;_.each(f,function(a){var b=r.getVariable(a.name);b&&(b.value=
a.value)})}this.onDeviceConnected(a,!1);c.setState(n.DEVICE_STATE.SYNCHRONIZING);c.setState(n.DEVICE_STATE.READY);c._startDfd&&c._startDfd.resolve(c.driverInstance);delete c._userStopped;delete c.lastError;delete c._startDfd;c._startDfd=null}else u&&q.log("did set device server variables failed, have no device",a)},getDeviceServerVariables:function(a,b){var c=b.driver;c.blox&&c.blox.blocks||(c.blox={blocks:[]});var d=[];_.each(c.blox.blocks,function(a){a.group===n.BLOCK_GROUPS.CF_DRIVER_BASIC_VARIABLES&&
d.push(a)});for(var c=[],l=0;l<d.length;l++)c.push({name:d[l].name,value:d[l].value,initial:d[l].value});a.setState(n.DEVICE_STATE.SYNCHRONIZING);this.sendManagerCommand(n.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES,{device:this.toDeviceControlInfo(a),variables:c})},onDeviceConnected:function(a,b){var c=this.getDeviceStoreItem(a.device);if(a.isReplay&&c&&c.state===n.DEVICE_STATE.READY)c.setState(n.DEVICE_STATE.READY);else{var d=this.getDriverInstance(a.device,!0)||a.instance;if(d)if(c){var l=this.toDeviceControlInfo(c);
if(l)if(!l.serverSide&&u&&q.error("onDeviceConnected:: device info is not server side, abort"),d&&!c.serverVariables)c.setState(n.DEVICE_STATE.CONNECTED),this.getDeviceServerVariables(c,d);else if(l){var e=l.hash;if(this.deviceInstances[e]){if(!d.__didStartBlocks)this.onDeviceStarted(d,c,d.driver);c.setState(n.DEVICE_STATE.READY);this.publish(n.EVENTS.ON_STATUS_MESSAGE,{text:'Device is Ready \x3cspan class\x3d"text-success"\x3e'+l.host+":"+l.port+"\x3c/span\x3e",type:"success"});return this.deviceInstances[e]}var k=
this,m=this.driverScopes.system_drivers+"DriverBase";try{f([m],function(a){a.prototype.declaredClass=m;k.createDriverInstance(l,a,c)})}catch(g){q.error("requiring base driver at "+m+" failed",g)}}else q.error("couldnt start device, invalid control info");else u&&q.error("onDeviceConnected:: device info  is null")}else u&&q.error("onDeviceConnected:: deviceStoreItem is null");else c&&c.setState(n.DEVICE_STATE.DISCONNECTED)}},onDeviceDisconnected:function(a){if(a&&a.device){var b=a.error,c=b&&b.code?
b.code:b||"",d=this.getDeviceStoreItem(a.device);if(d)if(!0===a.stopped)this.stopDevice(d);else{this.publish(n.EVENTS.ON_STATUS_MESSAGE,{text:'Device has been disconnected \x3cspan class\x3d"text-warning"\x3e'+a.device.host+":"+a.device.port+'\x3c/span\x3e :  \x3cspan class\x3d"text-danger"\x3e'+c+"\x3c/span\x3e",type:"info"});var f=this.toDeviceControlInfo(d);if(!f||f.serverSide)if(this.getDriverInstance(a.device,!0)&&this.removeDriverInstance(a.device),d.reset(),d.state===n.DEVICE_STATE.DISABLED)d.setState(n.DEVICE_STATE.DISCONNECTED);
else if(d.setState(n.DEVICE_STATE.DISCONNECTED),d.lastError=b,d.refresh(),f.serverSide&&d){var e=this;d.reconnectTimer||(d.isReconnecting=!0,d.lastReconnectTime?3600<d.lastReconnectTime&&(d.lastReconnectTime=3600):d.lastReconnectTime=e.reconnectDevice,d.reconnectRetry||(d.reconnectRetry=0),d.reconnectTimer=setTimeout(function(){d.reconnectTimer=null;d.lastReconnectTime*=2;d.reconnectRetry+=1;d.shouldReconnect()&&(f&&d.setState(n.DEVICE_STATE.CONNECTING),e.startDevice(d))},d.lastReconnectTime))}}else u&&
l&&q.error("deviceStoreItem is null")}},onCommandFinish:function(a,b){var c=this.getDriverInstance(a,!0);if(c){var d=b.params||{};if(d.src&&d.id&&(c=c.blockScope.getBlockById(d.src))&&c.onCommandFinish)c.onCommandFinish(b)}},onCommandProgress:function(a,b){var c=this.getDriverInstance(a,!0);if(c){var d=b.params||{};if(d.src&&d.id&&(c=c.blockScope)&&(d=c.getBlockById(d.src))&&d.onCommandProgress)d.onCommandProgress(b)}},onCommandPaused:function(a,b){var c=this.getDriverInstance(a,!0);if(c){var d=b.params||
{};if(d.src&&d.id&&(c=c.blockScope.getBlockById(d.src))&&c.onCommandPaused)c.onCommandPaused(b)}},onCommandStopped:function(a,b){var c=this.getDriverInstance(a,!0);if(c){var d=b.params||{};if(d.src&&d.id&&(c=c.blockScope.getBlockById(d.src))&&c.onCommandStopped)c.onCommandStopped(b)}},onCommandError:function(a,b){var c=this.getDriverInstance(a,!0);if(c){var d=b.params||{};if(d.src&&d.id&&(c=c.blockScope.getBlockById(d.src))&&c.onCommandError)c.onCommandError(b)}},onDeviceServerMessage:function(a){function b(a){delete a.resposeSettings;
delete a.driver;delete a.lastResponse;delete a.scope;delete a.driverId;delete a.device;delete a.sourceHost;delete a.sourcePort}var d=a.data,l=null;if(_.isString(d)&&-1!=d.indexOf("{"))try{l=g.fromJson(d)}catch(f){q.error("error parsing device message",a);return}else _.isObject(d)&&d.data&&(l=d);if(l&&l.data&&l.data.device){var e=l.data.device;if(e&&e.serverSide){var k=this.getDriverInstance(l.data.device,!0);if(k){var h=this.getDeviceStoreItem(e);if(h){(e=h.info)||q.error("invalid device : "+h.toString());
var r=h.get("state");a=e.serverSide;var u=l.data.deviceMessage;if(null==u)q.warn("onDeviceServerMessage: abort, no message data");else{d=[];_.isString(u)?d=k.split(u):_.isObject(u)&&(b(u),d=[u]);var p=k.onMessageRaw({device:l.data.device,message:u,bytes:l.data.bytes});p&&!p.length&&(p=null);for(var C=[],x=0;x<d.length;x++)C.push(g.stringToBuffer(d[x]));if(p&&p.length)for(d=[],C=[],x=0;x<p.length;x++){var E=p[x];d.push(E.string);C.push(E.bytes)}if(d&&d.length)for(x=0;x<d.length;x++)E=d[x],k.onMessage({device:l.data.device,
message:E,raw:u,bytes:C[x]}),k.onBroadcastMessage({device:l.data.device,message:E,raw:u,bytes:C[x]});r!==n.DEVICE_STATE.READY&&h.set("state",n.DEVICE_STATE.READY);x=h.isDebug();l.event&&(l.data.driverInstance=k,this.publish(l.event,l.data));if(c("xcf-ui")){var I=[],r=this.consoles[e.hash+"-Console"];if(x){x=l.data.deviceMessage;if(_.isObject(x)){b(x);try{x=JSON.stringify(x)}catch(M){logError(M,"error serialize message")}}this.publish(n.EVENTS.ON_STATUS_MESSAGE,{text:"Device Message from "+k.options.host+
' : \x3cspan class\x3d"text-info"\x3e'+x+"\x3c/span\x3e"})}if(r)for(var N=0;N<r.length;N++){var J=r[N];if(J){var K=!0,O=!1;J.console&&(x=J.console.getTextEditor(),K=x.getAction("Console/Settings/Split").value,O=x.getAction("Console/Settings/HEX").value);if(!K&&O)x=g.bufferToHexString(l.data.bytes),J.log(x,K,!1,n.LOG_OUTPUT.RESPONSE);else for(I=[],_.isString(u)?I=K?p&&p.length?p:k.split(u):[u]:_.isObject(u)&&(b(u),I=[u]),x=0;x<I.length;x++)E=I[x],_.isString(E.string)&&0===E.string.length||(O&&(E=g.stringToHex(E.string)),
J.log(E,K,!0,n.LOG_OUTPUT.RESPONSE))}}d&&d.length&&this.publish(n.EVENTS.ON_DEVICE_MESSAGE_EXT,{device:h,deviceInfo:e,raw:u,messages:d,bytes:l.data.bytes})}if(0<d.length&&k.blockScope)for(l=k.blockScope,e=l.blockStore._find({group:n.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS}),k=l.blockStore._find({group:n.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES}),h=l.getVariable("value"),h||(h=new m({id:g.createUUID(),name:"value",value:"",scope:l,type:13,group:"processVariables",gui:!1,cmd:!1}),l.blockStore.putSync(h)),
u=0;u<d.length;u++)if(0!==d[u].length){h.value=new String(d[u]);h.value.setBytes(C[u]);h.value.setString(d[u]);this.publish(n.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:h,scope:l,owner:this,save:!1,source:n.MESSAGE_SOURCE.DEVICE,publishMQTT:!1});for(p=0;p<k.length;p++){var L=k[p];"value"!=k[p].title&&(r=null,r=h.value,"number"!=typeof r&&(r=""+r,r="'"+r+"'"),L.target&&"None"!=L.target&&null!==r&&"null"!=r&&"'null'"!=r&&(x=l.getVariable(L.target)))&&(x.value=r,this.publish(n.EVENTS.ON_DRIVER_VARIABLE_CHANGED,
{item:x,scope:l,owner:this,save:!1,source:n.MESSAGE_SOURCE.BLOX}))}if(a){for(r=0;r<d.length;r++)if(x=d[r],_.isObject(x)&&x.src&&(p=l.getBlockById(x.src))&&p.onData)p.onData(x);for(r=0;r<e.length;r++)if(p=e[r],!1!==p.enabled){p.override={args:L?[L.value]:null};try{l.solveBlock(e[r],{highlight:!1})}catch(P){logError(P,"----solving response block crashed ")}}}}}}else q.error("cant find device : ",e.toString())}else x&&q.error(" onDeviceMessage : failed! Have no device instance for "+l.data.device.host,
l)}}},sendManagerCommand:function(a,b){this.checkDeviceServerConnection();var c={manager_command:a};g.mixin(c,b);if(this.deviceServerClient)return this.deviceServerClient.emit(null,c,a);q.error("Send Manager Command "+a+" failed, have no  device Server client");this.onHaveNoDeviceServer()},sendDeviceCommand:function(a,b,d,l,f,e,k,m,h){this.checkDeviceServerConnection();var r=a.getDeviceInfo();g.mixin({src:d},r);var u={command:b,device_command:h||n.SOCKET_SERVER_COMMANDS.DEVICE_SEND,options:r};g.mixin(u.options,
{params:{src:d,id:l,wait:e,stop:k,pause:m}});l=this.getDevice(r.id);l&&_.isObject(l)?l._userStopped||l&&(l.state===n.DEVICE_STATE.DISABLED||l.state===n.DEVICE_STATE.DISCONNECTED||l.state===n.DEVICE_STATE.CONNECTING)||(h=g.stringFromDecString(u.command),l.isDebug()&&this.publish(n.EVENTS.ON_STATUS_MESSAGE,{text:'Did send message : \x3cspan class\x3d"text-warnin"\x3e'+h.substr(0,30)+'\x3c/span\x3e to \x3cspan class\x3d"text-info"\x3e'+r.host+":"+r.port+"@"+r.protocol+"\x3c/span\x3e"}),r=p(JSON.stringify(a.options),
1)+"-Console",this.deviceServerClient?(this.deviceServerClient.emit(null,u,"Device_Send"),c("xcf-ui")&&!1!==f&&_.each(this.consoles[r],function(a){a.printCommand('\x3cspan class\x3d"text-info"\x3e\x3cb\x3e'+u.command+"\x3c/span\x3e","")})):(this.onHaveNoDeviceServer(),q.error("this.deviceServerClient is null"),q.error(" Send Device Command "+b+"failed, have no  device Server client")),a.blockScope&&(h=a.blockScope.getBlockById(d),this.publish(n.EVENTS.ON_DEVICE_COMMAND,{device:l,command:g.stringFromDecString(b),
deviceInfo:this.toDeviceControlInfo(l),name:h?h.name:""}))):q.error("invalid device")},loadDevices:function(a){this.sendManagerCommand(n.SOCKET_SERVER_COMMANDS.INIT_DEVICES,{path:a})},callMethod:function(a,b,c,d,l){this.checkDeviceServerConnection();a={method:b,args:c,device_command:n.SOCKET_SERVER_COMMANDS.CALL_METHOD,params:{id:l,src:d},options:a.options};if(this.deviceServerClient)this.deviceServerClient.emit(null,a,n.SOCKET_SERVER_COMMANDS.CALL_METHOD);else this.onHaveNoDeviceServer()},runShell:function(a,
b,c,d,l){a=a.getDeviceInfo();this.sendManagerCommand(n.SOCKET_SERVER_COMMANDS.RUN_SHELL,{cmd:b,args:c,options:g.mixin(a,{params:{id:l,src:d}})})},watchDirectory:function(a,b){this.checkDeviceServerConnection();var c={path:a,watch:b,manager_command:n.SOCKET_SERVER_COMMANDS.WATCH};if(this.deviceServerClient)this.deviceServerClient.emit(null,c,n.SOCKET_SERVER_COMMANDS.WATCH);else this.onHaveNoDeviceServer()},handle:function(a){var b=this.ctx.getUserDirectory();a=a.data;return b&&a&&a.device&&a.device.userDirectory&&
a.device.userDirectory!==b?!1:!0},createDeviceServerClient:function(b){var c=this,f=new a;this.deviceServerClient=null;if(this.deviceServerClient=d.createClientWithStore(b,"Device Control Server",{delegate:{onConnected:function(){c.onDeviceServerConnected();f.resolve();c.publish(n.EVENTS.ON_DEVICE_SERVER_CONNECTED);l&&c.ctx.getNotificationManager().postMessage({message:"Connected to Device Server",type:"success",duration:3E3})},onLostConnection:function(){c.onDeviceServerConnectionLost()},onServerResponse:function(a){var b=
a.data,d=null;if(_.isString(b)){try{d=JSON.parse(b)}catch(l){d=b}d=d||{};if(!c.handle(d))return;if(d&&d.data&&d.data.deviceMessage&&d.data.deviceMessage.event===n.EVENTS.ON_COMMAND_FINISH){c.onCommandFinish(d.data.device,d.data.deviceMessage);return}if(d&&d.data&&d.data.deviceMessage&&d.data.deviceMessage.event===n.EVENTS.ON_COMMAND_PROGRESS){c.onCommandProgress(d.data.device,d.data.deviceMessage);return}if(d&&d.data&&d.data.deviceMessage&&d.data.deviceMessage.event===n.EVENTS.ON_COMMAND_PAUSED){c.onCommandPaused(d.data.device,
d.data.deviceMessage);return}if(d&&d.data&&d.data.deviceMessage&&d.data.deviceMessage.event===n.EVENTS.ON_COMMAND_STOPPED){c.onCommandStopped(d.data.device,d.data.deviceMessage);return}if(d.data&&d.data.deviceMessage&&d.data.deviceMessage.event===n.EVENTS.ON_COMMAND_ERROR){c.onCommandError(d.data.device,d.data.deviceMessage);return}if(d.event===n.EVENTS.ON_DEVICE_DISCONNECTED){c.publish(n.EVENTS.ON_DEVICE_DISCONNECTED,d.data);return}if(d.event===n.EVENTS.SET_DEVICE_VARIABLES)return c.onSetDeviceServerVariables(d.data);
if(d.event===n.EVENTS.ON_RUN_CLASS_EVENT)return c.onRunClassEvent(d.data);if(d.event===n.EVENTS.ON_DEVICE_CONNECTED){c.publish(n.EVENTS.ON_DEVICE_CONNECTED,d.data);return}if(d.event===n.EVENTS.ON_SERVER_LOG_MESSAGE){c.publish(n.EVENTS.ON_SERVER_LOG_MESSAGE,d.data);return}if(d.event===n.EVENTS.ON_MQTT_MESSAGE){c.publish(n.EVENTS.ON_MQTT_MESSAGE,d.data);c.onMQTTMessage(d.data);return}if(d.event===n.EVENTS.ON_FILE_CHANGED)return c.ctx.onXIDEMessage(g.fromJson(a.data))}c.onDeviceServerMessage(a)}}}))return this.deviceServerClient.dfd=
f,this.deviceServerClient}})})},"xcf/model/Device":function(){define("xdojo/declare xide/data/Model xide/data/Source xide/types xide/utils xide/mixins/EventedMixin xcf/types/Types".split(" "),function(h,p,n,g,d,c){return h("xcf.model.Device",[p,n,c],{_userStopped:!1,state:g.DEVICE_STATE.DISCONNECTED,driverInstance:null,blockScope:null,getParent:function(){return this.getStore().getSync(this.parentId)},isServerSide:function(){var a=this.getMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);return 1<<
g.DRIVER_FLAGS.RUNS_ON_SERVER&a?!0:!1},isServer:function(){var a=this.getMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);return 1<<g.DRIVER_FLAGS.SERVER&a?!0:!1},setServer:function(a){a=this.getMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);a.value|=1<<g.DRIVER_FLAGS.SERVER;this.setMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS,a.value)},setServerSide:function(a){a=this.getMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);a|=1<<g.DRIVER_FLAGS.RUNS_ON_SERVER;this.setMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS,
a)},isDebug:function(){var a=this.getMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);return 1<<g.DRIVER_FLAGS.DEBUG&a?!0:!1},check:function(){this._startDfd&&!0===this._userStopped&&this.reset()},getStore:function(){return this._store},getScope:function(){var a=this.getStore();return a?a.scope:this.scope},isEnabled:function(){return!0===this.getMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_ENABLED)},setEnabled:function(a){return this.setMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_ENABLED,a)},shouldReconnect:function(){return this._userStopped?
!1:this.isEnabled()},reset:function(){delete this._startDfd;this._startDfd=null;delete this.blockScope;this.blockScope=null;delete this.serverVariables;this.serverVariables=null;delete this.driverInstance;this.driverInstance=null;clearTimeout(this.reconnectTimer);delete this.lastReconnectTime;delete this.reconnectRetry;delete this.isReconnecting;this.setState(g.DEVICE_STATE.DISCONNECTED)},constructor:function(){},getBlockScope:function(){return this.blockScope},getDriverInstance:function(){return this.driverInstance},
getDriver:function(){var a=this.getBlockScope();return a?a.driver:null},getMetaValue:function(a){return d.getCIInputValueByName(this.user,a)},setMetaValue:function(a,b,c){var f=d.getCIByChainAndName(this.user,0,a);if(!f)return null;var m=this.getMetaValue(a);d.setCIValueByField(f,"value",b);this[a]=b;if(!1!==c)return this.publish(g.EVENTS.ON_CI_UPDATE,{owner:this.owner,ci:f,newValue:b,oldValue:m})},getStateIcon:function(a){a=a||this.state;switch(a){case g.DEVICE_STATE.READY:case g.DEVICE_STATE.CONNECTED:return"fa-link iconStatusOn";
case g.DEVICE_STATE.SYNCHRONIZING:case g.DEVICE_STATE.CONNECTING:return"fa-spinner fa-spin";case g.DEVICE_STATE.LOST_DEVICE_SERVER:return"fa-spinner fa-spin"}return"fa-unlink iconStatusOff"},setState:function(a,b){if(a!==this.state){var c=this.state,d=this.getStateIcon(a);this.state=a;this.set("iconClass",d);this.set("state",a);this._emit(g.EVENTS.ON_DEVICE_STATE_CHANGED,{old:c,state:a,icon:d,"public":!0});this.refresh()}}})})},"xide/data/Source":function(){define(["dcl/dcl","dojo/_base/declare",
"xide/utils"],function(h,p,n){var g={_references:null,_originReference:null,onReferenceUpdate:function(){},onReferenceRemoved:function(){},onReferenceDelete:function(){},updateReference:function(){},getReferences:function(){return this._references?n.pluck(this._references,"item"):[]},addReference:function(d,c,a){this._references||(this._references=[]);this._references.push({item:d,settings:c});var b=this;if(c&&c.onDelete&&d._store)d._store.on("delete",function(a){a.target==d&&b._store.removeSync(b[b._store.idProperty])});
a&&d.addSource&&d.addSource(this,c)},removeReference:function(d){this._references&&_.each(this._references,function(c){c&&c.item==d&&this._references&&this._references.remove(c)},this)},updateReferences:function(d){var c=d.property,a=d.value;this._references||(this._references=[]);for(var b=0;b<this._references.length;b++){var g=this._references[b],f=g.item,g=g.settings,m=f._store;if(this._originReference!=f&&d.property&&g.properties&&g.properties[d.property]){m&&(m._ignoreChangeEvents=!0);try{if(f.onSourceChanged)f.onSourceChanged(c,
a);else f.set(c,a)}catch(k){}m&&(m._ignoreChangeEvents=!1,m.emit("update",{target:f}))}}},constructor:function(d){this._references=[];n.mixin(this,d)},onItemChanged:function(d){this.updateReferences(d)}};p=p("xgrid.data.Source",null,g);p.dcl=h(null,g);p.Implementation=g;return p})},"xcf/mixins/LogMixin":function(){define(["dcl/dcl","xcf/types/Types","xide/utils"],function(h,p,n){var g=p.DEFAULT_DEVICE_LOGGING_FLAGS;h=h(null,{hasFlagEx:function(d,c,a){d=d.loggingFlags;d=_.isString(d)?n.fromJson(d):
d||{};a=d[a]?d[a]:g[a];return null!=a&&a&c?!0:!1}});h.DEFAULT_LOGGING_FLAGS=g;return h})},"xcf/manager/Context":function(){define("dcl/dcl xide/manager/Context xcf/manager/DriverManager xcf/manager/DeviceManager xcf/manager/ProtocolManager xcf/manager/Application xcf/manager/LogManager xide/manager/ResourceManager xide/manager/PluginManager xdojo/has".split(" "),function(h,p,n,g,d,c,a,b,r,f){return h([p],{declaredClass:"xcf.manager.Context",namespace:"xcf.manager.",driverManager:null,deviceManager:null,
protocolManager:null,debugManager:null,nodeServiceManager:null,blockManager:null,getBlockManager:function(){return this.blockManager},getProtocolManager:function(){return this.protocolManager},getDriverManager:function(){return this.driverManager},getDeviceManager:function(){return this.deviceManager},getNodeServiceManager:function(){return this.nodeServiceManager},getDebugManager:function(){return this.debugManager},constructManagers:function(a){this.isEditor()},initManagers:function(){this.isEditor()||
(this.driverManager.init(),this.deviceManager.init(),f("protocols")&&this.protocolManager.init(),f("log")&&this.logManager.init());this.resourceManager&&this.resourceManager.init()},getUserDirectory:function(){var a=this.getResourceManager();if(a)return a.getVariable("USER_DIRECTORY")}})})},"xide/manager/Context":function(){define("dcl/dcl dojo/Deferred dojo/has xide/manager/ContextBase xide/types xide/utils require dojo/promise/all xdojo/has!host-browser?xide/manager/Context_UI".split(" "),function(h,
p,n,g,d,c,a,b,r){n=h([g],{declaredClass:"xide.manager.Context",application:null,contextManager:null,fileManager:null,resourceManager:null,notificationManager:null,serviceObject:null,pluginManager:null,windowManager:null,logManager:null,mountManager:null,config:null,managers:null,namespace:"xide.manager.",defaultNamespace:"xide.manager.",vfsMounts:null,xideServiceClient:null,fileUpdateTimes:{},onXIDEMessage:function(b,m){if(b&&b.event&&b.event===d.EVENTS.ON_FILE_CHANGED)if(b.data&&b.data.mask&&-1!==
b.data.mask.indexOf("delete"))this.publish(d.EVENTS.ON_FILE_DELETED,b);else if(b.data&&"delete"==b.data.type)this.publish(d.EVENTS.ON_FILE_DELETED,b);else{var k=b.data.path,e=(new Date).getTime();if(this.fileUpdateTimes[k]&&1E3>e-this.fileUpdateTimes[k])this.fileUpdateTimes[k]=e;else if(!1!==m&&this.publish(b.event,b),this.fileUpdateTimes[k]=e,k=c.replaceAll("\\","/",b.data.path),k=c.replaceAll("//","/",b.data.path),k=k.replace(/\\/g,"/"),-1===k.indexOf("/build/")&&null!=k&&null!=k.indexOf){if(k.match(/\.css$/))this.onCSSChanged({path:k});
if(k.match(/\.js$/)&&(e=b.data.modulePath)){e=e.replace(".js","");try{a(e)}catch(g){}var l="data/system/drivers";-1!=k.indexOf(l)&&(e=k.substr(k.indexOf(l)+(l.length+1),k.length),e=e.replace(".js",""),e="system_drivers/"+e);l="user/drivers";-1!=k.indexOf(l)&&(e=k.substr(k.indexOf(l)+(l.length+1),k.length),e=e.replace(".js",""),e="user_drivers/"+e);(l=(l=this.getResourceManager())?l.getVariable("VFS_CONFIG")||{}:null)&&l.user_drivers&&-1!==k.indexOf(l.user_drivers)&&(l=l.user_drivers,l=l.replace(/\/+$/,
""),e=k.substr(k.indexOf(l)+(l.length+1),k.length),e=e.replace(".js",""),e="user_drivers/"+e);e=c.replaceAll(".","/",e);e.indexOf("/build/")}}}},onNodeServiceStoreReady:function(a){},mergeFunctions:function(a,b,c,d){for(var g in b)_.isFunction(b[g])&&b[g]&&a&&(a[g]=b[g])},reloadModules:function(c,d){var k=new p,e=[],g=[],l=this;a({cacheBust:"time\x3d"+(new Date).getTime()});_.each(c,function(b){var c=null,f=new p;!1!==d&&(c=a(b));a.undef(b);a([b],function(a){c&&l.mergeFunctions(c.prototype,a.prototype);
g.push(a);f.resolve()});e.push(f)});b(e).then(function(){k.resolve(g);a({cacheBust:null})});return k},_reloadModule:function(b,g){var k=null,e=new p;b=b.replace("0/8","0.8");var h=this.getModule(b);if(h&&h.prototype&&h.prototype.reloadModule)return h.prototype.reloadModule();var k=a.on("error",function(a){console.log(a.src,a.id);console.error("require error "+b,a);k.remove();e.reject(a)}),l=this.getModule(b);if(!l&&(l="undefined"!==typeof b?l:null,!l&&"undefined"!==typeof window))if(l=c.getAt(window,
c.replaceAll("/",".",b),null))h=l;else try{l=a(c.replaceAll(".","/",b))}catch(r){console.log("couldnt require old module",b)}l&&(h=l);a.undef(b);var n=this;g?setTimeout(function(){a({cacheBust:"time\x3d"+(new Date).getTime(),waitSeconds:5});try{a([b],function(c){a({cacheBust:null});if(_.isString(c))console.error("module reloaded failed : "+c+" for module : "+b);else{c.modulePath=b;h&&(n.mergeFunctions(h.prototype,c.prototype,h,c),h.prototype&&h.prototype._onReloaded&&h.prototype._onReloaded(c));if(l&&
l.onReloaded)l.onReloaded(c,l);n.publish(d.EVENTS.ON_MODULE_RELOADED,{module:b,newModule:c});c.prototype&&c.prototype.declaredClass&&n.publish(d.EVENTS.ON_MODULE_UPDATED,{moduleClass:c.prototype.declaredClass,moduleProto:c.prototype});e.resolve(c)}})}catch(c){console.error("error reloading module",c),logError(c,"error reloading module"),e.reject(c)}},100):e.resolve();return e},onCSSChanged:function(a){},onDidChangeFileContent:function(a){if(!a.didProcess&&(a.didProcess=!0,this.vfsMounts&&a.path)){var b=
a.path;if(-1==b.indexOf(".css")&&-1==b.indexOf("resources")&&-1==b.indexOf("meta")&&-1!=b.indexOf(".js")){var b=a.mount.replace("/",""),d=null;if(this.vfsMounts[b]){var d=""+a.path,d=d.replace("./",""),d=d.replace("/","."),d=d.replace(".js",""),d=c.replaceAll(".","/",d),e=this;setTimeout(function(){try{e._reloadModule(d,!0)}catch(a){console.error("error reloading module",a)}},100)}}}},getMount:function(a){var b=this.getResourceManager();return(b=b?b.getVariable("VFS_CONFIG")||{}:null)&&b[a]?b[a]:
null},toVFSShort:function(a,b){var d=this.getResourceManager();return(d=d?d.getVariable("VFS_CONFIG")||{}:null)&&d[b]&&(d=d[b],d=c.replaceAll("//","/",d),d=d.replace(/\/+$/,""),-1!==a.indexOf(d))?(d=d.replace(/\/+$/,""),a.substr(a.indexOf(d)+(d.length+1),a.length)):null},findVFSMount:function(a){var b=this.getResourceManager();if(b=b?b.getVariable("VFS_CONFIG")||{}:null)for(var d in b){var e=b[d],e=c.replaceAll("//","/",e),e=e.replace(/\/+$/,"");if(-1!==a.indexOf(e))return d}return null},getBlockManager:function(){return this.blockManager},
getPluginManager:function(){return this.pluginManager},getService:function(){return this.serviceObject},getFileManager:function(){return this.fileManager},getResourceManager:function(){return this.resourceManager},getMountManager:function(){return this.mountManager},getContextManager:function(){return this.contextManager},getLogManager:function(){return this.logManager},getApplication:function(){return this.application},constructor:function(a){this.managers=[];this.config=a;this.language="en";this.subscribe(d.EVENTS.ON_CHANGED_CONTENT,
this.onDidChangeFileContent)},prepare:function(){this.config&&this.initWithConfig(this.config)},initWithConfig:function(a){a&&a.mixins&&this.doMixins(a.mixins)},isEditor:function(){return this.args&&this.args.file}});h.chainAfter(n,"constructManagers");h.chainAfter(n,"initManagers");return n})},"xcf/manager/ProtocolManager":function(){define("dcl/dcl dojo/_base/declare xide/manager/ServerActionBase xide/types xide/utils xide/factory xaction/Action xcf/manager/BeanManager".split(" "),function(h,p,
n,g,d,c,a,b,r,f,m,k,e,q){return h([n,b],{declaredClass:"xcf.manager.ProtocolManager",beanNamespace:"protocol",beanName:"Protocol",beanIconClass:"fa-code",groupType:g.ITEM_TYPE.PROTOCOL_GROUP,itemType:g.ITEM_TYPE.PROTOCOL,itemMetaPath:"user.meta",itemMetaStorePath:"/meta/inputs",itemMetaTitleField:g.PROTOCOL_PROPERTY.CF_PROTOCOL_TITLE,systemScope:"system_protocols",userScope:"user_protocols",appScope:"app_protocols",defaultScope:"system_protocols",serviceClass:"XCF_Protocol_Service",rawData:null,store:null,
treeView:null,protocolScopes:null,getItemActions:function(){var a=[],b=this,c=this.getItem(),e=c?!0===d.toBoolean(c.isDir):!1;a.push({title:"New Group",icon:"el-icon-folder",place:"last",emit:!1,style:"",handler:function(a,c,d){b.newGroup()}});a.push({title:"Reload",icon:"fa-refresh",disabled:!1,command:"Reload",place:"last",emit:!1,style:"",handler:function(){b.reload()}});null!=this.getItem()&&(a.push({title:"Delete",icon:"el-icon-remove-circle",disabled:!1,command:"Delete",place:"last",emit:!1,
style:"",handler:function(){b.onDeleteItem(c)}}),e?a.push({title:"New Protocol",icon:"el-icon-file-new",disabled:!1,command:"NewItem",place:"last",emit:!1,style:"",handler:function(){b.newItem(c)}}):a.push({title:"Connect",icon:"el-icon-play-circle",disabled:!1,command:"Start",place:"last",emit:!1,style:"",handler:function(){b.startDevice(c)}}));return a},onItemRemoved:function(a){a==this.currentItem&&(this.currentItem=null);a&&(a=this.getView(a))&&d.destroy(a)},_onDeleteItem:function(a){var b=!0===
d.toBoolean(a.isDir),c=d.toString(a.name),e=b?"removeGroup":"removeItem",f=this;(new r({title:"Remove Protocol"+(b?" Group":"")+" '"+c+"'",style:"max-width:400px",titleBarClass:"text-danger",delegate:{isRemoving:!1,onOk:function(b){f[e](d.toString(a.scope),d.toString(a.path),function(){f.onItemRemoved(a)})}},inserts:[{query:".dijitDialogPaneContent",insert:'\x3cdiv\x3e\x3cspan class\x3d"fileManagerDialogText"\x3eDo you really want to remove  this item?\x3c/span\x3e\x3c/div\x3e',place:"first"}]})).show()},
newItem:function(){var a=this.getItem();a||(a={path:""});var b=[d.createCI("In Group",13,d.toString(a.path),{widget:{disabled:!0},group:"Common"}),d.createCI("Title",13,"",{group:"Common"})],a=new m({title:"New Device",resizable:!0,delegate:{onOk:function(a,c){var l=d.createCI("Id",13,d.createUUID(),{visible:!1,group:"Common"});c.push(l);d.toOptions(c);d.getInputCIByName(b,"Title");d.getInputCIByName(b,"Scope");d.getInputCIByName(b,"In Group")}},cis:b});a.show();a.resize()},reload:function(){},onFileChanged:function(a){if(!a._pp2){a._pp2=
!0;var b=a.data;this.fileUpdateTimes||(this.fileUpdateTimes={});if(b.event===g.EVENTS.ON_FILE_CHANGED){if(b.data&&b.mask&&-1!==b.mask.indexOf("delete")){console.error("deleted");return}(new Date).getTime()}var c=d.replaceAll("\\","/",b.path),c=d.replaceAll("//","/",b.path),c=c.replace(/\\/g,"/");-1!=c.indexOf("protocols")&&(c.match(/\.json$/)&&(-1!=c.indexOf("data/system/protocols")&&console.log("protocol changed"+c),this.ls("system_protocols")),this.onFileChanged2&&this.onFileChanged2(a))}},init:function(){this.subscribe(g.EVENTS.ON_FILE_CHANGED,
this.onFileChanged)},_resetItem:function(a){a.commandsItem&&d.removeFromStore(this.getStore(),a.commandsItem,!0,"path","parentId");a.variablesItem&&d.removeFromStore(this.getStore(),a.variablesItem,!0,"path","parentId")},_completeProtocolItem:function(a){if(a&&a.user){var b=d.getInputCIByName(a.user.meta,"content"),c=this,e=this.getStore();if(!b&&(a.mount=""+a.scope,a.getPath=function(){return a.path},a.virtual=!1,a.isDir=!0,a.children=[],b=d.createCI("Content",g.ECIType.FILE_EDITOR,"no value",{group:"Content",
editor:"JSON Editor",editorArgs:{subscribers:[{event:"onSave",handler:function(b){(b=d.getJson(b.value))&&b.meta&&(a.user=b,a._completed=!1,c._resetItem(a),c._completeProtocolItem(a),c.publish(g.EVENTS.ON_PROTOCOL_CHANGED,{item:a}))},owner:c}],leftEditorArgs:{subscribers:[{event:"addAction",handler:function(a){console.log("add action",arguments)},owner:c}],hiddenFields:{},readOnlyNodes:{commands:!0,variables:!0,meta:!0},insertTemplates:[{label:"New Command",path:"commands",value:'{title:"No Title",send:""}',
newNodeTemplate:"[]",collapse:!0,select:!0},{label:"New Variable",path:"variables",value:'{title:"No Title",value:""}',newNodeTemplate:"[]",collapse:!0,select:!0}],renderTemplates:[{nodeValuePath:"field.innerHTML",match:[/^variables[\s]?\.(\d+)$/,/^commands[\s]?\.(\d+)$/],replaceWith:"{nodeValue} - {title}",variables:null,nodeValueTransform:function(a){return d.capitalize(a)},insertIfMatch:{}}]},rightEditorArgs:{subscribers:[{event:"addAction",handler:function(a){console.log("add action",arguments)},
owner:c}]}},editorItem:a,editorOverrides:{},isOwnTab:!0}),a.user.meta.inputs.push(b),!a._completed)){a._completed=!0;var f={path:d.createUUID(),name:"Commands",isDir:!0,type:"leaf",parentId:a.path,virtual:!0,children:[]};a.commandsItem=f;a.children.push(f);e.putSync(f);for(var k=a.user.commands,b=0;b<k.length;b++){var m=k[b];f.children.push(e.putSync({path:d.createUUID(),name:m.name,id:d.createUUID(),parentId:f.path,_mayHaveChildren:!1,virtual:!0,user:{},isDir:!1,value:m.value,ref:{protocol:a,item:m},
type:"protocolCommand"}))}f={path:d.createUUID(),name:"Variables",isDir:!0,type:"leaf",parentId:a.path,virtual:!0,items:[],children:[]};e.putSync(f);a.children.push(f);a.variablesItem=f;k=a.user.variables;for(b=0;b<k.length;b++)m=k[b],f.children.push(e.putSync({isDir:!1,path:d.createUUID(),name:m.name,id:d.createUUID(),parentId:f.path,_mayHaveChildren:!1,value:m.value,virtual:!0,user:{},ref:{protocol:a,item:m},type:"protocolVariable"}))}}},onStoreReady:function(a){a=a?d.queryStore(a,{isDir:!1}):[];
var b=this;_.each(a,function(a,c,d){b._completeProtocolItem(a)})},onMainViewReady:function(){var b=this,c=a.createDefault("New Protocol","fa-exchange","File/New/Protocol","__anewAction",null,{permanent:!0,handler:function(){b.newItem()}}).setVisibility(g.ACTION_VISIBILITY.ACTION_TOOLBAR,null).setVisibility(g.ACTION_VISIBILITY.MAIN_MENU,{}).setVisibility(g.ACTION_VISIBILITY.CONTEXT_MENU,null);b.publish(g.EVENTS.REGISTER_ACTION,{owner:b,action:c});f.prototype.ctx=this.ctx},openItemSettings:function(a){var b=
a.user;if(!b||!b.meta)return null;var c=this.getViewId(a),f=e.byId(c);try{if(f)return f.parentContainer&&f.parentContainer.selectChild(f),null}catch(g){d.destroy(f)}var f=this.getViewTarget(),m=this.getMetaValue(a,this.itemMetaTitleField);a.beanContextName=this.ctx.mainView.beanContextName;return d.addWidget(k,{title:m||d.toString(a.name),cis:b.meta.inputs,beanContextName:this.ctx.mainView.beanContextName,storeItem:a,iconClass:this.beanIconClass,id:c,delegate:this,storeDelegate:this,closable:!0,showAllTab:!1,
blockManager:this.ctx.getBlockManager()},this,f,!0)}})})},"xaction/Action":function(){define("xdojo/declare xide/model/Base xide/types xide/utils/ObjectUtils xide/utils xide/mixins/EventedMixin".split(" "),function(h,p,n,g,d,c){d.mixin(n,{ACTION_VISIBILITY:{MAIN_MENU:"MAIN_MENU",CONTEXT_MENU:"CONTEXT_MENU",QUICK_LAUNCH:"QUICK_LAUNCH",ACTION_TOOLBAR:"ACTION_TOOLBAR",PROPERTY_VIEW:"PROPERTY_VIEW",RIBBON:"RIBBON",widgetArgs:null,factory:function(){var a=arguments[1]||d.clone(n.ACTION_VISIBILITY),c=arguments;
if(0<c[0].length&&_.isNumber(c[0][0])){var f=c[0],g=0;_.each(a,function(c,d){"function"!==typeof a[d]&&g<f.length&&(a[d+"_val"]=f[g]);g++})}if(_.isString(c[0][0])){if(!0===c[0][2])d.mixin(a[c[0][0]+"_val"],c[0][2]);else return a[c[0][0]+"_val"]=c[0][1],a;return c[1]}return a}}});n.ACTION_VISIBILITY_ALL="ACTION_VISIBILITY_ALL";var a=h("xaction/Action",[p,c],{disabled:!1,enabled:!0,object:null,show:!0,group:"",types:"",command:null,icon:"fa-play",event:null,handler:null,tab:null,visibility_:null,value:null,
setVisibility:function(){if(2==arguments.length&&_.isString(arguments[0])&&arguments[0]==n.ACTION_VISIBILITY_ALL){var a=arguments[1],c=n.ACTION_VISIBILITY,f=this;[c.MAIN_MENU,c.ACTION_TOOLBAR,c.CONTEXT_MENU,c.RIBBON].forEach(function(c){f.setVisibility(c,d.cloneKeys(a,!1))});return this}c=_.isArray(arguments[0])?arguments[0]:arguments;this.visibility_=n.ACTION_VISIBILITY.factory(c,this.visibility_);return this},getVisibility:function(a){this.visibility_||this.setVisibility(n.ACTION_VISIBILITY_ALL,
{});return this.visibility_?(null==this.visibility_[a+"_val"]&&(this.visibility_[a+"_val"]={vis:a}),this.visibility_[a+"_val"]):{}},shouldDestroyWidget:function(a,c,d){a=null!=this.getVisibility?this.getVisibility(a):null;var g=!0;a&&a.permanent&&(g=!(_.isFunction(a.permanent)?a.permanent(this,c,d):a.permanent));return g}});a.create=function(b,c,f,g,k,e,h,l,n,p,t){b=new a({permanent:g,command:f,icon:c,label:b,owner:this,types:e,operation:k,group:h,handler:p,title:b});d.mixin(b,t);return b};a.createDefault=
function(b,c,d,g,k,e){return a.create(b,c,d,!1,null,null,g||"nogroup",null,!1,k,e)};return a})},"xcf/manager/Application":function(){define("dcl/dcl require xide/manager/Application xide/utils xide/types xdojo/declare xdojo/has xdojo/has!xcf-ui?xcf/manager/Application_UI xdojo/has!xexpression?xexpression/Expression".split(" "),function(h,p,n,g,d,c,a,b,r,f){return h(n,{declaredClass:"xcf.manager.Application",vfsItems:null,onReloaded:function(){},onMountDataReady:function(a){},onPluginLoaded:function(a){this.publish(d.EVENTS.ON_PLUGIN_READY,
{name:a.name,mainView:this.rootView,config:this.config,ctx:this.ctx,panelManager:this,fileManager:this.ctx.getFileManager(),store:this.store,serviceObject:this.ctx.getService()},this)},_onXBlocksReady:function(){p("xfile/manager/BlockManager");var a=this.ctx;if(a.blockManager)a.blockManager.onReady();p(["xcf/manager/BlockManager"],function(b){a.blockManager=new b;a.blockManager.ctx=a;a.blockManager.updatePalette=!1;a.blockManager.init();a.blockManager.onReady();a.blockManager.serviceObject=a.fileManager.serviceObject});
var b=p("xblox/views/BlocksFileEditor");a.registerEditorExtension("xBlocks","xblox","fa-play-circle-o",this,!0,null,b,{ctx:this.ctx,mainView:this.mainView,blockManagerClass:"xfile.manager.BlockManager",registerView:!0})},onComponentReady:function(a){}})})},"xide/manager/Application":function(){define("dcl/dcl xdojo/has xide/manager/ManagerBase xide/types xide/utils dojo/Deferred dojo/promise/all dojo/has!host-browser?xide/manager/Application_UI".split(" "),function(h,p,n,g,d,c,a,b){return h([n],{declaredClass:"xide.manager.Application",
container:null,ctx:null,_debug:!0,_loadedComponents:{},_loadingComponents:null,getComponents:function(){return this._loadedComponents},doComponents:function(){function b(a,l){if(p(a)&&d[a].dfd){var k=new c;e.push(k);d[a].dfd.then(function(){l(k)})}}var d=this.loadComponents(),m=require,k=this,e=[],h=new c;if(!d||!d.dfd)return console.error("componentsToLoad is null or has no head dfd"),d;var l=g.COMPONENT_NAMES;b(l.XFILE,function(a){k.initXFile().then(function(){a.resolve()})});b(l.XIDEVE,function(a){k.initXIDEVE().then(function(){a.resolve()})});
b(l.XNODE,function(a){k.initXNODE().then(function(){a.resolve()})});b(l.XBLOX,function(a){m(["xblox/embedded_ui","xfile/manager/BlockManager","xblox/views/BlocksFileEditor"],function(){k.onXBlocksReady().then(function(){a.resolve()})})});d.dfd.then(function(){a(e).then(function(){h.resolve()})});h.then(function(){k.registerEditorExtensions()});return h},loadComponents:function(a){if(this._loadingComponents)return this._loadingComponents;var b=this,m,k;b._loadedComponents={};a=a||d.getJson(this.ctx.getResourceManager().getVariable("COMPONENTS"));
_.each(a,function(b,c){!1===p(c)&&delete a[c]});if(!a)return null;m=function(){var c=_.find(a,{status:0});c?k(c.name,c):(a.dfd.resolve(a),b.publish(g.EVENTS.ON_ALL_COMPONENTS_LOADED,a),a.dfd.resolve())};k=function(a,c){var d=c.settings;!1===p(a)&&console.error("loading component "+a+"which is disabled by has!");b.ctx.getPluginManager().loadComponent(a,null,!0===d?null:d).then(function(d){b._loadedComponents[a]=d;d={component:d,name:a};c.dfd.resolve(d);b.publish(g.EVENTS.ON_COMPONENT_READY,d);c.status=
1;m()})};for(var e in a){var h=""+e,l=a[h];a[h]=l?{settings:l,status:0,name:h,dfd:new c}:{status:1}}a.dfd=new c;m();return this._loadingComponents=a},hasComponent:function(a){var b=d.getJson(this.ctx.getResourceManager().getVariable("COMPONENTS"));return!(!b||!b[a])}})})},"xcf/manager/LogManager":function(){define(["dcl/dcl","xlog/manager/LogManager"],function(h,p){return h(p,{declaredClass:"xcf.manager.LogManager",ls:function(h){var g=this;return this.callMethodEx(null,"ls",["unset"],function(d){g.rawData=
d;g.initStore(d);h&&h(d)},!0)}})})},"xlog/manager/LogManager":function(){define("dcl/dcl xdojo/declare xide/manager/ServerActionBase xide/manager/BeanManager xide/encoding/MD5 xide/types xide/utils dojo/cookie dojo/json dojo/Deferred xide/data/Memory xide/mixins/EventedMixin".split(" "),function(h,p,n,g,d,c,a,b,r,f,m,k){var e=p([k],{bytesLoaded:null,percentValue:null,item:null,delegate:null,_onEnd:null,_onHandle:null,serviceClass:"XIDE_Log_Service",constructor:function(a){this.item=a;this.subscribe(a.progressMessage,
this._onProgress);this.subscribe(a.progressFailedMessage,this._onProgressFailed)},_onProgressFailed:function(a){this.item.level="error";this.item.message=this.item.oriMessage+" : Failed";this.item._isTerminated=!0;a&&a.item&&a.item.error&&this.item.details&&(this.item.details.error=a.item.error)},_onFinish:function(){this._onHandle&&this._onHandle.remove()},_onProgress:function(a){try{var b=a.progress;a=null;null==a&&(a=Math.round(100*b.loaded/b.total),this.bytesLoaded=b.loaded);if(this.percentValue!=
a){var c=""+this.item.oriMessage;this.item.message=""+(c+(" : "+a+"%"))}this.percentValue=a;this._emit("progress");100<=this.percentValue&&(this.item.message=this.item.oriMessage+" : Done",this._emit("finish"),this._onFinish(),this.destroy())}catch(d){console.error("crash in log progress "+d)}}});return h([n,g],{declaredClass:"xcf.manager.LogManager",serviceClass:"XIDE_Log_Service",cookiePrefix:"logging",singleton:!0,serviceView:null,clients:null,beanNamespace:"logging",views:null,stores:{},removeStore:function(a){var b=
this.stores[a];b&&(b.destroy&&b.destroy(),delete this.stores[a])},getViewId:function(a){return this.beanNamespace+d(JSON.stringify({info:a.info}),1)},loadPreferences:function(){var a=b(this.cookiePrefix+"_debug_settings");return a=a?r.parse(a):{}},savePreferences:function(a){b(this.cookiePrefix+"_debug_settings",r.stringify(a))},empty:function(a){this.clear(a);a=this.getStore(a);a.then&&a.then(function(a){a.setData([])})},clear:function(a){return this.runDeferred(null,"clearAbs",[a||""]).then(function(a){})},
getViewTarget:function(){return this.ctx.getApplication().mainView.getNewAlternateTarget()},getStore:function(b){if(!b)return this.store;var c=new f;if(this.stores[b])return c.resolve(this.stores[b]),c;var d=this;this.runDeferred(null,"lsAbs",[b||""]).then(function(e){_.isString(e)&&(e=a.getJson(e));e=d.initStore(e);d.stores[b]=e;c.resolve(e)});return c},isValid:function(){return null!=this.store},_buildLoggingMessage:function(b){var c={id:a.createUUID(),level:b.level,message:b.message,host:"",data:b.data||
{},time:b.time||(new Date).getTime(),type:"",show:!0,showDevice:!0};b.type&&(c.type=b.type);b.device&&b.device.host&&(c.host=b.device.host+":"+b.device.port);b.deviceMessage&&(c.message=c.message+":"+b.deviceMessage);c.ori=b;return c},initStore:function(b){var c={identifier:"time",label:"level",items:[],sort:"time"};0==b.length&&(b=[]);for(var d=0;d<b.length;d++)c.items.push(this._buildLoggingMessage(b[d]));return new (p("LogStore",[m],{}))({idProperty:"time",data:c,id:a.createUUID()})},createLoggingView:function(b,
c,d){c=c||this.getViewTarget();return a.addWidget(!1,{delegate:this,store:b,title:"Log",closable:!0,style:"padding:0px",silent:d},this,c,!0)},updateViews:function(a,b){for(var c=0;c<this.views.length;c++)this.views[c].update(a,b)},refreshViews:function(){for(var a=0;a<this.views.length;a++)this.views[a].grid.refresh()},addLogView:function(a){this.views.push(a)},openLogView:function(a,b){this.isValid()||this.initStore([]);var c=this.createLoggingView(this.store,a,b);this.views.push(c);return c},_createPendingEvent:function(a,
b,c,d){function f(a){!b._isTerminated&&k&&(b.message=b.oriMessage+" : Done",a&&!0===a.failed&&(b.level="error",b.message=b.oriMessage+" : Failed"),b._isTerminated=!0,k.remove(),k=null,g.refreshViews(),b.progressHandler&&b.progressHandler.destroy())}var k=null,g=this;b._isInProgress=!0;k=g.subscribe(c,f,g)[0];b.showProgress&&b.progressMessage&&!b.progressHandler&&(a=new e(b,this),a._onEnd=f,a._onEndHandle=k,b.progressHandler=a)},addLoggingMessage:function(b){if(b&&b.data){var c=b.data.logId;!c&&b.data&&
b.data.device&&(c=b.data.device,c=c.host+"_"+c.port+"_"+c.protocol)}var d={id:a.createUUID(),level:b.level,message:b.message,host:b.host||"",data:b.data||{},time:b.time||(new Date).getTime(),type:b.type||"",show:!0,showDevice:!0,terminatorItem:b.item,terminatorMessage:b.terminatorMessage,showProgress:b.showProgress,progressMessage:b.progressMessage,progressFailedMessage:b.progressFailedMessage,details:b.details};b.data&&(b.data.type&&(d.type=b.data.type),b.data.device&&b.data.device.host&&(d.host=
b.data.device.host+":"+b.data.device.port),b.data.deviceMessage&&(d.message=d.message+":"+b.data.deviceMessage));try{null==d.terminatorMessage||d._isTerminated||(null==d.oriMessage&&(d.oriMessage=""+d.message),this._createPendingEvent(d.oriMessage,d,d.terminatorMessage,d.time));var e=this.getStore(c);e&&(e.then?e.then(function(a){e=a;d=a.putSync(d);a._emit("added",{item:d,store:e})}):(d=e.putSync(d),e._emit("added",{item:d,store:e})))}catch(f){console.error("adding log message to store failed "+f)}},
onServerLogMessage:function(a){a.data&&a.data.time&&(a.time=a.data.time);this.addLoggingMessage(a);!0===a.write&&this.publish(c.EVENTS.ON_CLIENT_LOG_MESSAGE,{message:a.message,data:a.data,details:a.details,level:a.level,type:a.type,time:a.data.time||a.time})},init:function(){this.subscribe([c.EVENTS.ON_SERVER_LOG_MESSAGE]);this.views=[];this.stores={}},onStoreReloaded:function(){for(var a=0;a<this.views.length;a++){var b=this.views[a];b.reload(this.store);b.update()}},reload:function(){var a=this;
this.currentItem=null;this.ls(function(b){a.onStoreReloaded(b)})},ls:function(b,c,d){var e=this;return this.callMethodEx(null,"lsAbs",[c||""],d||function(c){e.rawData=c;_.isString(c)&&(c=a.getJson(c));e.store=e.initStore(c);b&&b(c)},!0)}})})},"xide/manager/ResourceManager":function(){define(["dcl/dcl","xide/manager/ServerActionBase","xide/utils","xide/mixins/VariableMixin"],function(h,p,n,g){return h([p,g.dcl],{declaredClass:"xide.manager.ResourceManager",serviceClass:"XApp_Resource_Service",resourceData:null,
resourceVariables:null,getResourceVariables:function(){return this.resourceVariables},setVariable:function(d,c){return this.resourceVariables[d]=c},getVariable:function(d){return this.resourceVariables[d]},init:function(){this.resourceVariables||(this.resourceVariables={})},replaceVariables:function(d,c){return n.multipleReplace(""+d,c||this.resourceVariables)}})})},"xide/mixins/VariableMixin":function(){define(["dcl/dcl","xdojo/declare","xide/utils"],function(h,p,n){var g={resolve:function(d,c,a){c=
c||this.resourceVariables||this.ctx.getResourceManager().getResourceVariables()||null;a=a||this.variableDelimiters||null;return n.replace(d,null,c,a)}};p=p("xide/mixins/VariableMixin",null,g);p.dcl=h(null,g);return p})},"xide/manager/PluginManager":function(){define("dcl/dcl dojo/has xide/manager/ManagerBase xide/utils xide/types xide/factory dojo/Deferred dojo/promise/all".split(" "),function(h,p,n,g,d,c,a,b){return h(n,{declaredClass:"xide.manager.PluginManager",_defaultPackageLocationPrefix:"../../",
_defaultPackageLocationSuffix:"/component",_defaultComponentFlags:{LOAD:1,RUN:2},defaultComponentMixin:function(a){return{owner:this,ctx:this.ctx,flags:a}},componentBaseClasses:null,ctx:null,pluginResources:null,pluginInstances:null,_componentReady:function(a,b,c){if(b.RUN)try{a.run(this.ctx)}catch(d){}return c.resolve(a)},_componentLoaded:function(a,b,d,k){try{g.mixin(d,this.defaultComponentMixin(b));var e=c.createInstance(a,d,this.componentBaseClasses),h=function(a,b,c){this._componentReady(a,b,
c)}.bind(this);b.LOAD?e.load().then(function(){h(e,b,k)}):h(e,b,k)}catch(l){k.reject(arguments),logError(l)}},loadComponent:function(b,c,d,k,e){d="true"===d?{}:d;b=-1==b.indexOf("/")?this._defaultPackageLocationPrefix+b+this._defaultPackageLocationSuffix:b;c=null!=c?c:this._defaultComponentFlags;var h=new a,l=this;(k=g.getObject(b))?_.isFunction(k.then)?k.then(function(a){l._componentLoaded(a,c,d,h)},function(a){console.error("error in loading component at path "+b,a)}):this._componentLoaded(k,c,
d,h):console.error("cant get object at "+b);return h},loadComponentResources:function(a,b){},reloadComponent:function(a){},loadPlugins:function(c){if(p("plugins")){var f=new a,g=[],k=this;this.pluginResources=c;this.pluginInstances=[];if(this.pluginResources)for(var e=0;e<this.pluginResources.length;e++){var h=this.pluginResources[e];h.type&&"JS-PLUGIN"==h.type&&h.path&&g.push(this.loadComponent(h.path,null,h).then(function(a){a.pluginResources=h;k.pluginInstances.push(a)}))}b(g).then(function(){f.resolve(g);
k.publish(d.EVENTS.ALL_PLUGINS_READY,{instances:k.pluginInstances,resources:c})});return f}}})})},"nxapp/manager/DeviceManager":function(){define("dcl/dcl dojo/node!fs xcf/manager/DeviceManager xide/utils xide/types nxapp/utils/_console nxapp/utils dojo/node!child_process".split(" "),function(h,p,n,g,d,c,a,b){function r(a,b,c,d,g,h,r){m.exec(c,k,function(a,b,c){if(b&&127===parseInt(b,10)&&(f.error("--have error "+c),r&&r.onCommandError))r.onCommandError();b&&0===parseInt(b,10)&&f.error("--terminate with "+
b);b&&1===parseInt(b,10)&&f.error("--terminate with 1 "+b);f.error("response ",arguments)}.bind(this))}var f=c;h(null,{emit:function(){f.error("device server client emit",arguments)}});var m=b,k={stdout:!0,stderr:!0,stdin:!0,failOnError:!0,stdinRawMode:!1,killSignal:"SIGTERM"};return h(n,{declaredClass:"nxapp.manager.DeviceManager",connection:null,runShell:function(a,b,c){var h=this.getContext().getConnectionManager();m.exec(a,k,function(b,k,m){k&&127===parseInt(k,10)&&f.error("--have error "+m);
b&&f.log("err",b);k&&f.log("stdout",k);m&&f.log("stderr",m);k&&0===parseInt(k,10)&&f.info("--terminate with 0"+k);if(k&&1===parseInt(k,10)){f.info("--terminate with 1 "+k);try{h.onData(h.getConnection2(c),g.mixin({cmd:a,event:d.EVENTS.ON_COMMAND_FINISH,result:k},c),new Buffer(k))}catch(r){f.error("onFinish-Error:",r)}}}.bind(this))},runShell2:function(a,b,c,d,f,g){f=a.options;r(a,{host:f.host,port:f.port,protocol:f.protocol},b,c,d,k,g)},onDeviceMetaChanged:function(b,c){var d=this.store;d&&_.each(d.data,
function(d){if(-1!==d.path.indexOf(c)&&p.existsSync(b)){var f=g.getJson(a.readFile(b));f&&(d.user=f)}})},onFileChanged:function(a){if("changed"===a.type&&!a._did){a._did=!0;a=g.replaceAll("\\","/",a.path);a=g.replaceAll("//","/",a);a=a.replace(/\\/g,"/");var b;b=a;b=-1!=b.indexOf("system/devices")?b.substr(b.indexOf("system/devices")+15,b.length):null;if(b&&-1!==b.indexOf(".meta.json"))this.onDeviceMetaChanged(a,b)}},checkDeviceServerConnection:function(){},sendManagerCommand:function(a,b){try{var c=
this.ctx.getDeviceServer(),d={manager_command:a};g.mixin(d,b);c.handleManagerCommand(d,this.connection)}catch(k){f.error("error "+k.message,k.stack)}},sendDeviceCommand:function(a,b,c,d){a=a.options;g.mixin({src:c},a);b={command:b,device_command:"Device_Send",options:a};g.mixin(b.options,{params:{src:c,id:d}});this.ctx.getDeviceServer().handleDeviceCommand(b,this.connection)}})})},"xcf/manager/BlockManager":function(){define(["dcl/dcl","xide/types","xide/manager/ManagerBase","xblox/manager/BlockManager",
"xide/lodash"],function(h,p,n,g,d){return h([n,g],{declaredClass:"xcf.manager.BlockManager",onReady:function(){},addDriverFunctions:function(c,a){for(var b in a)"constructor"!==b&&"inherited"!==b&&d.isFunction(a[b])&&(c[b]=a[b])},setScriptFunctions:function(c,a,b){var d=b;a.context||(a.context=c);c.blockScope||(c.blockScope=a);a.context?a.context.instance&&(a.device=a.context.instance):console.error("scope has no context!");c.callCommand||(c.callCommand=function(a){var b=this.blockScope.getBlockByName(a);
b?b.solve(this.blockScope):console.log("no such variable : "+a)});c.setVariable||(c.setVariable=function(b,g,k,e,h){var l=this.blockScope.getVariable(b);l?(l.value=g,l.set("value",g),console.log("setting variable "+b+" to "+g),!1!==e&&d.publish(p.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:l,scope:a,driver:c,owner:d,save:!0===k,source:h||p.MESSAGE_SOURCE.BLOX})):console.log("no such variable : "+b)});c.getVariable||(c.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""});this.inherited(arguments)},
onReloaded:function(){this.init()},getDeviceVariablesAsEventOptions:function(){},onCreateVariableCI:function(c){}})})},"xblox/manager/BlockManager":function(){define("dcl/dcl dojo/has dojo/Deferred dojo/promise/all xide/types xide/utils xide/factory xblox/model/ModelBase xblox/model/Scope xblox/model/BlockModel xide/mixins/ReloadMixin xide/manager/ManagerBase xblox/data/Store xdojo/has!xblox-ui?xblox/manager/BlockManagerUI xide/lodash".split(" "),function(h,p,n,g,d,c,a,b,r,f,m,k,e,q,l){return h([k,
m.dcl],{declaredClass:"xblox/manager/BlockManager",serviceObject:null,loaded:{},scope:null,scopes:null,_createBlock:null,_registerActions:function(){},toScope:function(a){try{a=c.getJson(a)}catch(b){return console.error("BlockManager::toScope: failed,err\x3d"+b),null}a||(console.error("correct data"),a={blocks:[],variables:[]});var d=c.createUUID(),e=a;!l.isArray(a)&&l.isObject(a)&&(d=a.scopeId||d,e=a.blocks||[]);a=this.getScope(d,{owner:this},!0);e=a.blocksFromJson(e);for(d=0;d<e.length;d++)e[d]._lastRunSettings=
{force:!1,highlight:!0};a.serviceObject=this.serviceObject;return a},loadFiles:function(a){for(var b=[],c=new n,d=0;d<a.length;d++){var e=a[d];b.push(this.load(e.mount,e.path,e.force))}g(b).then(function(a){c.resolve(a)});return c.promise},load:function(a,b,d){var e=new n,f=this,l=c.replaceAll("/","",a),k=c.replaceAll("./","",b),g=l+k,g=g.trim();this.loaded[g]&&!0===d&&(this.removeScope(this.loaded[g].id),this.loaded[g]=null);if(!0!==d&&this.loaded[g])return e.resolve(this.loaded[g]),e.promise;this.ctx.getFileManager().getContent(l,
k,function(c){if(c=f.toScope(c))f.loaded[g]=c,c.mount=a,c.path=b;e.resolve(c)},!1);return e.promise},onBlocksReady:function(a){for(var b=a.allBlocks(),c=0;c<b.length;c++)this.setScriptFunctions(b[c],a,this);if((a=a.getBlocks({group:"On Load"}))&&0<a.length)for(c=0;c<a.length;c++)if(b=a[c],b.onLoad)b.onLoad()},getBlock:function(){},setScriptFunctions:function(a,b,c){a.blockScope||(a.blockScope=b);b.serviceObject=this.serviceObject;a.setVariable||(a.setVariable=function(e,f,l,k,g){if(e=this.blockScope.getVariable(e))e.value=
f,!1!==k&&c.publish(d.EVENTS.ON_VARIABLE_CHANGED,{item:e,scope:b,driver:a,owner:c,save:!0===l,source:g||d.MESSAGE_SOURCE.BLOX})});a.getVariable||(a.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""})},hasScope:function(a){this.scopes||(this.scopes={});return this.scopes[a]?this.scopes[a]:null},getScope:function(b,c,e){this.scopes||(this.scopes={});if(!this.scopes[b]&&(this.scopes[b]=this.createScope({id:b,ctx:this.ctx}),this.scopes[b].userData=c,!1!==e))try{a.publish(d.EVENTS.ON_SCOPE_CREATED,
this.scopes[b])}catch(f){console.error("bad, scope creation failed "+f,f)}return this.scopes[b]},removeScope:function(a){this.scopes||(this.scopes={});for(var b in this.loaded)this.loaded[b].id==a&&delete this.loaded[b];this.scopes[a]&&(this.scopes[a]._destroy(),delete this.scopes[a]);return null},createScope:function(a,b,d){b=b||[];var l=new e({data:[],Model:f,id:c.createUUID(),__events:{},observedProperties:["name","enabled","value"],getLabel:function(a){return a.name},labelAttr:"name"});l.reset();
l.setData([]);l={owner:this,blockStore:l,serviceObject:this.serviceObject,config:this.config};c.mixin(l,a);try{var k=new r(l);b&&k.initWithData(b,d);k.init()}catch(g){logError(g,"error creating scope, data:",a)}return k},onReloaded:function(){},init:function(){this.scope={variables:[],blocks:[]};b.prototype.types=d;b.prototype.factory=a;if(this.onReady)this.onReady()}})})},"xblox/model/Scope":function(){define("dcl/dcl ./ModelBase ./Expression xide/factory xide/utils xide/types xide/mixins/EventedMixin dojo/_base/lang dojo/has xide/encoding/MD5 xcf/model/Variable xdojo/has!host-node?nxapp/utils/_console".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m,k){var e="undefined"!==typeof window?window.console:"undefined"!==typeof global?global.console:k;k&&(e=k);var q=r("xcf-ui");p=h([p,a.dcl],{declaredClass:"xblox.model.Scope",variableStore:null,serviceObject:null,context:null,blockStore:null,expressionModel:null,start:function(){if(!0===this.__didStartBlocks)e.error("already started blocks");else{this.__didStartBlocks=!0;var a=this.getVariable("value");a||(a=new m({id:d.createUUID(),name:"value",value:"",scope:this,type:13,
group:"processVariables",gui:!1,cmd:!1}),this.blockStore.putSync(a));var a=[],b=this.getBlocks({group:c.COMMAND_TYPES.INIT_COMMAND});try{_.each(b,function(a){!1!==a.enabled&&!0!==a.__started&&(a.solve(this),a.__started=!0)},this)}catch(f){e.error("starting init blocks failed",f),logError(f,this)}a=a.concat(this.getBlocks({group:c.COMMAND_TYPES.BASIC_COMMAND}));for(b=0;b<a.length;b++){var k=a[b];k.enabled&&k.start&&k.startup&&!0!==k.__started&&(k.start(),k.__started=!0)}}},getExpressionModel:function(){this.expressionModel||
(this.expressionModel=new n);return this.expressionModel},toFriendlyName:function(a,b){if(!b||!a)return null;var c=this,e=this.ctx,f=this.driver,f=e.getDeviceManager(),k=e.getDriverManager();if(-1==b.indexOf("://"))return(c=c.getBlockById(b))?c.name:b;var e=d.parse_url(b),e=d.urlArgs(e.host),g=f.getItemById(e.device.value);if(g){var h=f.toDeviceControlInfo(g),f=k.getDriverById(h.driverId);if((g=g.driverInstance)||f)if(c=f.blockScope?f.blockScope:g?g.blockScope:c,(a=c.getStore().getSync(e.block.value))||
g&&g.blockScope&&(a=g.blockScope.getBlock(e.block.value)))return h.title+"/"+a.name}return b},getContext:function(){return this.instance},toString:function(){var a={blocks:null,variables:null},b=this.blocksToJson();try{d.fromJson(JSON.stringify(b))}catch(c){return}a.blocks=b;return JSON.stringify(a,null,2)},initWithData:function(a,b){a&&this.blocksFromJson(a,null,b);this.clearCache()},getService:function(){return this.serviceObject},getStore:function(){return this.blockStore},reset:function(){this.getExpressionModel().reset()},
empty:function(){this.clearCache();var a=this.blockStore,b=this.getBlocks();a.silent(!0);_.each(b,function(b){b&&a.removeSync(b.id)});a.setData([]);a.silent(!1)},fromScope:function(a){var b=this.blockStore;b.silent(!0);this.empty();a=a.blocksToJson();this.blocksFromJson(a);b.silent(!1)},clearCache:function(){this.getExpressionModel().reset()},getVariableStore:function(){return this.blockStore},getBlockStore:function(){return this.blockStore},getVariables:function(a){if(!this.blockStore)return[];var b=
this.blockStore.data,c=[];if(a&&"processVariables"===a.group){for(a=0;a<b.length;a++)"processVariables"===b[a].group&&c.push(b[a]);return c}if(!a){for(a=0;a<b.length;a++){var d=b[a],e=d.declaredClass;"xblox.model.variables.Variable"!=e&&"xcf.model.Variable"!=e||c.push(d)}return c}return this.blockStore.query(a)},loopBlock:function(a,b){1==a._destroyed&&e.error("block destroyed");var c=a.getInterval?a.getInterval():0;if(a&&0<c&&a.enabled&&!0!==a._destroyed){var d=this;a._loop&&clearInterval(a._loop);
a._loop=setInterval(function(){!a.enabled||a._destroyed?(clearInterval(a._loop),a._loop=null):a.solve(d,b||a._lastSettings)},c)}},getEventsAsOptions:function(a){var b=[],d;for(d in c.EVENTS)b.push({label:c.EVENTS[d],value:c.EVENTS[d]});b=b.concat([{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",
value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}]);for(d=0;d<b.length;d++){var e=b[d];if(e.value===a){e.selected=!0;break}}return b},getVariablesAsObject:function(){for(var a=this.getVariables(),b={},c=0;c<a.length;c++)b[a[c].title]=a[c].value;return b},getVariablesAsOptions:function(){var a=this.getVariables(),b=[];
if(a)for(var c=0;c<a.length;c++)b.push({label:a[c].label,value:a[c].variable});return b},getCommandsAsOptions:function(a){var b=this.getBlocks({declaredClass:"xcf.model.Command"}),c=[];if(b)for(var d=0;d<b.length;d++){var e={};e[a||"label"]=b[d].name;e.value=b[d].name;c.push(e)}return c},_cached:null,getBlocks:function(a,b){if(!q&&!1!==b&&(this._cached||(this._cached={}),a)){var c=f(JSON.stringify(a),1);if(c=this._cached[c])return c}if(!this.blockStore)return[];a=a||{id:/\S+/};var d=_.isEmpty(a)?
this.blockStore.data:this.blockStore.query(a,null,!0);q||!1===b||(c=f(JSON.stringify(a),1),this._cached[c]=d);return d},registerVariable:function(a){this.variables[a.title]=a;this.blockStore&&this.blockStore.putSync(a)},getVariable:function(a){for(var b=this.getVariables(),c=0;c<b.length;c++){var d=b[c];if(d.name===a)return d}return null},getVariableById:function(a){if(!a)return null;var b=a.split("/"),c=this;2==b.length&&((a=c.owner)&&a.hasScope&&(a.hasScope(b[0])?c=a.getScope(b[0]):e.error("have scope id but cant resolve it",
this)),a=b[1]);return(b=c.blockStore.getSync(a))?b:null},registerBlock:function(a,b){var c=this.blockStore;if(c){var d=c.getSync(a.id);if(d)return d;d=null;return d=a.addToStore?a.addToStore(c):c.putSync(a,b)}},allBlocks:function(a,b){return this.getBlocks({},b)},hasGroup:function(a){for(var b=this.allGroups({},!1),c=0;c<b.length;c++)if(b[c]===a)return!0;return!1},allGroups:function(){for(var a=[],b=this.allBlocks({},!1),c=function(b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1},d=0;d<
b.length;d++){var e=b[d];e.parentId||(e.group?c(e.group)||a.push(e.group):c("No Group")||a.push("No Group"))}return a},variablesToJson:function(){var a=[],b=this.variableStore?this.getVariables():this.variables,c;for(c in b){var d=b[c];if(!1!==d.serializeMe&&null!=d.keys){var e={},f;for(f in d)if(this.isString(d[f])||this.isNumber(d[f])||this.isBoolean(d[f]))e[f]=d[f];a.push(e)}}return a},isScript:function(a){return this.isString(a)&&(-1!=a.indexOf("return")||-1!=a.indexOf(";")||-1!=a.indexOf("[")||
-1!=a.indexOf("{")||-1!=a.indexOf("}"))},variablesToJavascriptEx:function(a,b){for(var c=[],d=this.variableStore?this.getVariables():this.variables,e=0;e<d.length;e++){var f=d[e];if(f!=a){var k=""+f.value;a&&a.value&&-1==a.value.indexOf(f.title)||b&&-1==b.indexOf(f.title)||0==k.length||(this.isScript(k)||-1!=k.indexOf("'")?this.isScript(k)&&(k=this.expressionModel.parseVariable(this,f)):k="'"+k+"'","''"===k&&(k="'0'"),c.push(k))}}return c},variablesToJavascript:function(a,b){for(var c="",d=this.variableStore?
this.getVariables():this.variables||[],e=0;e<d.length;e++){var f=d[e];if(f!=a){var k=""+f.value;a&&a.value&&-1==a.value.indexOf(f.title)||b&&-1==b.indexOf(f.title)||0==k.length||(this.isScript(k)||-1!=k.indexOf("'")?this.isScript(k)&&(k=this.expressionModel.parseVariable(this,f)):k="'"+k+"'","''"===k&&(k="'0'"),c+="var "+f.title+" \x3d "+k+";",c+="\n")}}return c},variablesFromJson:function(a){for(var b=[],c=0;c<a.length;c++){var f=a[c];f.scope=this;if(f.declaredClass){var k=d.replaceAll(".","/",f.declaredClass),
g=require(k);g?b.push(new g(f)):e.log("couldnt resolve "+k)}else e.log("   variable has no class ")}return b},regenerateIDs:function(a){for(var b=this,c=function(a){var e=d.createUUID(),f=b.getBlocks({parentId:a.id});if(f&&0<f.length)for(var l=0;l<f.length;l++){var k=f[l];k.parentId=e;c(k)}a.id=e},e=0;e<a.length;e++)c(a[e])},cloneBlocks2:function(a,b){var c=this.blocksToJson(a),e=this.owner.getScope(d.createUUID(),null,!1),c=e.blocksFromJson(c,!1),f=this.blockStore,c=e.allBlocks();e.regenerateIDs(c);
c=e.blocksToJson(c);if(b)for(e=0;e<c.length;e++){var k=c[e];null==k.parentId&&(k.group=b)}var g=[],c=this.blocksFromJson(c);_.each(c,function(a){g.push(f.getSync(a.id))});return g},cloneBlocks:function(a){a=this.blocksToJson(a);var b=this.owner.getScope(d.createUUID(),null,!1);a=b.blocksFromJson(a,!1);a=b.allBlocks();for(b=0;b<a.length;b++){var c=a[b];c.id=d.createUUID();c.parentId=null}this.blocksToJson(a);this.blocksFromJson(a);return a},blockToJson:function(a){var b={_containsChildrenIds:[]},c;
for(c in a)if("ctrArgs"!=c&&("function"===typeof a[c]||a.serializeField(c))){if(this.isString(a[c])||this.isNumber(a[c])||this.isBoolean(a[c]))b[c]=a[c];if("parent"!=c)if(this.isBlock(a[c]))b[c]=a[c].id,b._containsChildrenIds.push(c);else if(this.areBlocks(a[c])){b[c]=[];for(var d=0;d<a[c].length;d++)b[c].push(a[c][d].id);b._containsChildrenIds.push(c)}}return b},blocksToJson:function(a){try{var b=[];a=a&&a.length?a:this.blockStore?this.blockStore.data:this.blocks;for(var c in a){var d=a[c];if(null!=
d.keys&&!1!==d.serializeMe){var f={_containsChildrenIds:[]},k;for(k in d)if("ctrArgs"!=k&&("function"===typeof d[k]||d.serializeField(k))){if(this.isString(d[k])||this.isNumber(d[k])||this.isBoolean(d[k]))f[k]=d[k];_.isObject(d[k])&&d.serializeObject&&!0===d.serializeObject(k)&&(f[k]=JSON.stringify(d[k],null,2));if("parent"!=k)if(this.isBlock(d[k]))f[k]=d[k].id,f._containsChildrenIds.push(k);else if(this.areBlocks(d[k])){f[k]=[];for(var g=0;g<d[k].length;g++)f[k].push(d[k][g].id);f._containsChildrenIds.push(k)}}b.push(f)}}}catch(h){e.error("from json failed : "+
h)}return b},_createBlockStore:function(){},blockFromJson:function(a){a.scope=this;null==a._containsChildrenIds&&(a._containsChildrenIds=[]);for(var b={},c=0;c<a._containsChildrenIds.length;c++){var f=a._containsChildrenIds[c];b[f]=a[f];a[f]=null}delete a._containsChildrenIds;if(!a.declaredClass)return e.log("   not a class "),null;f=c=null;try{f=d.replaceAll(".","/",a.declaredClass),c=require(f)}catch(k){try{f=d.replaceAll("/",".",a.declaredClass),c=require(f)}catch(m){}}c||(c=h.getObject(a.declaredClass));
if(!c)return null;f=null;try{f=g.createBlock(c,a)}catch(r){return logError(r),null}f._children=b;return f},blocksFromJson:function(a,b,c){for(var f=[],k={},m=0;m<a.length;m++){var r=a[m];r.scope=this;null==r._containsChildrenIds&&(r._containsChildrenIds=[]);for(var q={},n=0;n<r._containsChildrenIds.length;n++){var p=r._containsChildrenIds[n];q[p]=r[p];r[p]=null}delete r._containsChildrenIds;if(r.declaredClass){var F=n=null;try{F=d.replaceAll(".","/",r.declaredClass),n=require(F)}catch(B){e.error("couldnt resolve class "+
F)}n||(n=h.getObject(r.declaredClass));if(n){F=null;try{F=g.createBlock(n,r,null,!1)}catch(D){e.error("error in block creation ",D+" "+r.declaredClass);logError(D);continue}F._children=q;k[F.id]=q;f.push(F)}else e.log("couldnt resolve "+F)}else e.log("   not a class ")}a=this.allBlocks(null,!1);for(m=0;m<a.length;m++){r=a[m];r._children=k[r.id];if(r._children){for(p in r._children)if("string"==typeof r._children[p])(q=this.getBlockById(r._children[p]))?(r[p]=q,q.parent=r,q.postCreate&&q.postCreate()):
(this.blockStore.removeSync(r._children[p]),c&&c("   couldnt resolve child: "+r._children[p]+"@"+r.name+":"+r.declaredClass),e.log("   couldnt resolve child: "+r._children[p]+"@"+r.name+":"+r.declaredClass));else if("object"==typeof r._children[p])for(r[p]=[],n=0;n<r._children[p].length;n++)(q=this.getBlockById(r._children[p][n]))?(r[p].push(q),(F=this.getBlockById(q.parentId))?q.parent=F:e.error("child has no parent")):(c&&c("   couldnt resolve child: "+r._children[p]+"@"+r.name+":"+r.declaredClass),
e.log("   couldnt resolve child: "+r._children[p][n]+"@"+r.name+":"+r.declaredClass));delete r._children}!1!==b&&null!=r.parentId&&null==this.getBlockById(r.parentId)&&(r.parentId=null);r.postCreate()}this.allBlocks();return f},resolveBlock:function(a){var b=this,c=this.ctx,b=this.driver,b=c.getDeviceManager(),c=c.getDriverManager();if(-1==a.indexOf("://"))return(b=this.getBlockById(a))?b:a;a=d.parse_url(a);a=d.urlArgs(a.host);var e=b.getItemById(a.device.value);if(!e){var f=b.getInstanceByName(a.device.value);
f&&(e=f.device)}if(e&&(b=b.toDeviceControlInfo(e),b=c.getDriverById(b.driverId),(c=e.driverInstance)||b)&&(a=(b=c?c.blockScope:b.blockScope)?b.getStore().getSync(a.block.value):null))return a},getBlock:function(a){return this.getBlockById(a)},getBlockByName:function(a){if(-1!==a.indexOf("://")){var b=this.resolveBlock(a);if(b)return b}for(var c=this.getBlocks(),d=0;d<c.length;d++)if(b=c[d],b.name===a)return b;return(a=this.blockStore.query({name:a}))&&0<a.length?a[0]:null},getBlockById:function(a){return this.blockStore.getSync(a)},
_flatten:function(a){var b=[],c;for(c in a){var d=a[c];if(null!=d.keys){b.push(d);for(var e in d)if("ctrArgs"!=e&&"parent"!==e)if(this.isBlock(d[e]))b.push(d[e]);else if(this.areBlocks(d[e]))for(var f=0;f<d[e].length;f++)b.push(d[e][f])}}return b},flatten:function(a){var b=[],c;for(c in a){var d=a[c];if(null!=d.keys){var e=_.find(b,{id:d.id});e||b.push(d);for(var f in d)if("ctrArgs"!=f&&"parent"!==f){var k=d[f];if(this.isBlock(k))(e=_.find(b,{id:k.id}))||b.push(k);else if(this.areBlocks(k))for(var g=
0;g<k.length;g++){var h=k[g];(e=_.find(b,{id:h.id}))||b.push(h);b=b.concat(this.flatten([h]))}}}}return b=_.uniq(b,!1,function(a){return a.id})},_getSolve:function(a){return a.prototype?a.prototype.solve:a.__proto__.solve},solveBlock:function(a,c,e,f){c=c||{highlight:!1};var k=null;this.isString(a)?(k=this.getBlockByName(a))||(k=this.getBlockById(a)):this.isObject(a)&&(k=a);a=null;if(k){if(!0!==c.force&&0==k.enabled)return null;!0===c.force&&(c.force=!1);var g=k.declaredClass;(g=b.getObject(d.replaceAll("/",
".",g))||b.getObject(g))?g.prototype&&g.prototype.solve&&(a=g.prototype.solve.apply(k,[this,c])):(a=k.solve(k.getScope(),c,e,f),delete k.override,k.override={})}return a},solve:function(a,b){for(var c="",d=0;d<this.items.length;d++)c+=this.items[d].solve(a,b);return c},parseExpression:function(a,b,c,d,e,f,k,g){return this.getExpressionModel().parse(this,a,b,d,e,f,c,k,g)},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isBoolean:function(a){return"boolean"==
typeof a},isObject:function(a){return"object"===typeof a},isBlock:function(a){var b=!1;"object"==typeof a&&null!=a&&void 0==a.length&&a.serializeMe&&(b=!0);return b},areBlocks:function(a){var b=!1;"object"==typeof a&&null!=a&&0<a.length&&this.isBlock(a[0])&&(b=!0);return b},_onVariableChanged:function(a){a.item&&this.getExpressionModel().variableFuncCache[a.item.title]&&delete this.expressionModel.variableFuncCache[a.item.title]},init:function(){this.getExpressionModel();this.subscribe(c.EVENTS.ON_DRIVER_VARIABLE_CHANGED,
this._onVariableChanged);var a=this;this.subscribe(c.EVENTS.ON_MODULE_RELOADED,function(b){var c=b.module,e=b.newModule;(b=a.getBlocks().filter(function(a){return a.declaredClass==c||a.declaredClass==d.replaceAll("/",".",c)?a:null}))&&_.each(b,function(a){var b=e.prototype,c;for(c in b){var d=b[c];d&&_.isFunction(d)&&(a[c]=d)}})})},_destroy:function(){for(var a=this.allBlocks(),b=0;b<a.length;b++){var d=a[b];if(d)try{d&&d.stop&&d.stop(!0),d&&d.reset&&d.reset(),d&&d._destroy&&d._destroy(),d&&d.destroy&&
d.destroy(),d._emit&&d._emit(c.EVENTS.ON_ITEM_REMOVED,{item:d})}catch(e){}}},destroy:function(){this._destroy();this.reset();this._destroyed=!0;delete this.expressionModel},moveTo:function(a,b,c,d){if(d){if(b.canAdd&&b.canAdd()){var f=this.getBlockById(a.parentId);f&&f.removeBlock(a,!1);b.add(a,null,null);return}e.error("cant reparent");return!1}if(b.parentId||0!=d)if(!a.parentId&&b.parentId&&0==d)a.group=b.group;else if(a.parentId||b.parentId||!d){if(a.parentId&&b.parentId&&0==d&&a.parentId===b.parentId){var k=
this.getBlockById(a.parentId);if(!k)return!1;var g=k[k._getContainer(a)],f=a.indexOf(g,a);b=a.indexOf(g,b);g=f>b?-1:1;c=Math.abs(f-(b+(1==c?-1:1)));for(b=0;b<c-1;b++)k.move(a,g);return!0}if(a.parentId&&b.parentId&&0==d&&a.parentId!==b.parentId){e.log("same parent!");f=this.getBlockById(a.parentId);if(f&&(k=this.getBlockById(b.parentId))&&f&&f.removeBlock&&k.canAdd&&k.canAdd())f.removeBlock(a,!1),k.add(a,null,null);else return!1;g=k[k._getContainer(a)];null==g&&e.error("weird : target parent has no item container");
f=k.indexOf(g,a);b=k.indexOf(g,b);if(!f||!b){e.error(" weird : invalid drop processing state, have no valid item indicies");return}g=f>b?-1:1;c=Math.abs(f-(b+(1==c?-1:1)));for(b=0;b<c-1;b++)k.move(a,g);return!0}}else return b.canAdd&&b.canAdd()&&(a.group=null,b.add(a,null,null)),!0;else{(f=this.getBlockById(a.parentId))&&f.removeBlock&&(f.removeBlock(a,!1),a.parentId=null,a.group=b.group);var k=[],g=this.getBlocks({group:b.group}),h=[],f=this.getBlockStore(),m=f.storage.index[b.id];for(b=0;b<g.length;b++)if(d=
g[b],null==g[b].parentId&&g[b]!=a&&(d=f.storage.index[d.id],d=c?d>=m:d<=m))k.push(g[b]),h.push(f.storage.index[g[b].id]);for(b=0;b<k.length;b++)f.remove(k[b].id);this.getBlockStore().remove(a.id);c&&this.getBlockStore().putSync(a);for(b=0;b<k.length;b++)f.put(k[b]);c||this.getBlockStore().putSync(a);return!0}return!1}});h.chainAfter(p,"destroy");return p})},"xblox/model/Expression":function(){define(["xdojo/declare","xdojo/has","xide/utils","xide/types","xblox/model/ModelBase"],function(h,p,n,g,d,
c,a){var b="undefined"!==typeof window?window.console:global.console;c&&b&&b.error&&(b=a);return h("xblox.model.Expression",[d],{id:null,context:null,variableDelimiters:{begin:"[",end:"]"},blockCallDelimiters:{begin:"{",end:"}"},expressionCache:null,variableFuncCache:null,constructor:function(){this.reset()},reset:function(){this.expressionCache={};this.variableFuncCache={}},replaceVariables:function(a,c,d,k,e,h,l,n){l=l||this.variableDelimiters;n=n||g.CIFLAG.NONE;n&g.CIFLAG.DONT_ESCAPE&&(k=!1);n&
g.CIFLAG.DONT_PARSE&&(d=!1);var p=this._findOcurrences(c,l);if(p)for(var t=0;t<p.length;t++){var y=p[t],y=y.replace(l.begin,""),y=y.replace(l.end,"");(y=this._getVar(a,y))&&y.flags&g.CIFLAG.DONT_PARSE&&(d=!1);var w=null;if(y){if(h){c=c.replace(p[t],"this.getVariable('"+y.name+"')");continue}w=this.getValue(y.value);e&&y.name in e&&(w=e[y.name]);if(this.isScript(w)&&!1!==d)try{var A=a.variablesToJavascript(y,!0);A&&(w=A+w);var z=(new Function("{\n"+w+"\n}")).call(a.context||{});"undefined"===z||"undefined"===
typeof z?w=""+y.value:(w=z,n&g.CIFLAG.DONT_ESCAPE||(w="'"+w+"'"))}catch(G){b.log(" parsed variable expression failed \n"+w,G)}else this.isNumber(w)||!1!==k&&(w="'"+w+"'")}else w=p[t];c=c.replace(p[t],w)}return c},parse:function(a,c,d,k,e,g,l,h,n){c=this.replaceAll("''","'",c);d=g||a.context||a.getContext()||{};c=this.replaceVariables(a,c,null,null,l,null!=d.getVariable,null,n);l=this.isScript(c);if(!l&&(this.isString(c)||this.isNumber(c)))return k&&k("Expression "+c+" evaluates to "+c),c;-1==c.indexOf("return")&&
l&&(c="return "+c);a=this;try{c=this.replaceAll("''","'",c);var p=this.expressionCache[c];p||(p=new Function("{"+c+"; }"),this.expressionCache[c]=p);a=p.apply(d,h)}catch(y){return b.error("     invalid expression : \n"+c,y),e&&e("invalid expression : \n"+c+": "+y,y),a=""+c}k&&k("Expression "+c+" evaluates to "+a);return a},parseVariableO:function(a,c){var d=""+c.value;if("None"===c.title)return"";try{var k=a.variablesToJavascript(c,!1);k&&(d=k+d);var e=(new Function("{"+d+"}")).call(this.context||
{});"undefined"===e||"undefined"===typeof e?d=""+c.value:this.isNumber(e)?d=e:(d=""+e,d="'"+d+"'")}catch(g){b.error("parse variable failed : "+c.title+"\n"+d)}return d},parseVariable:function(a,b,c,d,e,g,l){var h=""+b.value;c=c||"";!1!==e?(e=this.variableFuncCache[a.id+"|"+b.title],e||(e=new Function("{"+c+h+"}"),this.variableFuncCache[a.id+"|"+b.title]=e)):e=new Function("{"+c+h+"}");a=e.apply(g||a.context||{},l||[]);return h="undefined"===a||"undefined"===typeof a?""+b.value:this.isNumber(a)||!1===
d?a:"'"+a+"'"},replaceBlockCalls:function(a,b){var c=this._findOcurrences(b,this.blockCallDelimiters);if(c)for(var d=0;d<c.length;d++){var e=this._removeDelimiters(c[d],this.blockCallDelimiters),e=a.solveBlock(e).join("\n");b=b.replace(c[d],e)}return b},_getVar:function(a,b){return a.getVariable(this._getVarName(b))},_getVarName:function(a){return this._removeDelimiters(a,this.variableDelimiters)},_removeDelimiters:function(a,b){return a.replace(b.begin,"").replace(b.end,"")},_escapeRegExp:function(a){for(var b=
"[](){}*+.".split(""),c=0;c<b.length;c++)a=a.replace(b[c],"\\"+b[c]);return a},_findOcurrences:function(a,b){var c=this._escapeRegExp(b.begin),d=this._escapeRegExp(b.end);return a.match(new RegExp(c+"("+("[^"+d+"]*")+")"+d,"g"))}})})},"xblox/model/BlockModel":function(){define(["dcl/dcl","xdojo/declare","xide/data/Model","xide/data/Source"],function(h,p,n,g){return p("xblox.model.BlockModel",[n,g],{declaredClass:"xblox.model.BlockModel",icon:"fa-play",postCreate:function(){console.error("post create")},
constructor:function(){console.error("sd")},mayHaveChildren:function(d){return null!=this.items&&0<this.items.length},getChildren:function(d){return this.items},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e'}})})},"xblox/data/Store":function(){define(["dojo/_base/declare","xide/data/TreeMemory","xide/data/ObservableStore","dstore/Trackable","dojo/Deferred"],function(h,p,n,g,d){return h("xblox.data.Store",[p,g,n],{idProperty:"id",parentField:"parentId",filter:function(c){var a=
this.inherited(arguments);delete this._state.filter;this._state.filter=c;return a},getChildren:function(c){return this.root.filter({parentId:this.getIdentity(c)})},_fetchRange:function(c){var a=new d;c=this.fetchRangeSync(c);if(this._state.filter){if(this._state&&this._state.filter&&this._state.filter.parentId){var b=this.getSync(this._state.filter.parentId);b&&(this.reset(),c=b.items,b.getChildren&&(c=b.getChildren()),a.resolve(c))}this._state&&this._state.filter&&this._state.filter.group&&(this.getSync(this._state.filter.parent),
b&&(this.reset(),c=b.items))}a.resolve(c);return a},mayHaveChildren:function(c){return c.mayHaveChildren?c.mayHaveChildren(c):null!=c.items&&0<c.items.length}})})},"xblox/factory/Blocks":function(){define("xide/factory xide/utils xide/types xide/mixins/ReloadMixin xide/mixins/EventedMixin xblox/model/logic/CaseBlock xblox/model/Block xblox/model/functions/CallBlock xblox/model/functions/StopBlock xblox/model/functions/PauseBlock xblox/model/functions/SetProperties xblox/model/code/CallMethod xblox/model/code/RunScript xblox/model/loops/ForBlock xblox/model/loops/WhileBlock xblox/model/variables/VariableAssignmentBlock xblox/model/logic/IfBlock xblox/model/logic/ElseIfBlock xblox/model/logic/SwitchBlock xblox/model/variables/VariableSwitch xblox/model/logging/Log xblox/model/server/RunServerMethod xblox/model/server/Shell xblox/model/code/RunBlock xblox/model/events/OnEvent xblox/model/events/OnKey xblox/model/mqtt/Subscribe xblox/model/mqtt/Publish xblox/model/File/ReadJSON xcf/factory/Blocks".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m,k,e,q,l,u,v,t,y,w,A,z,G,H,F,B,D,C,x){var E=null;h.prepareBlockContructorArgs=function(a){a||(a={});a.id||(a.id=p.createUUID());a.items||(a.items=[])};h.createBlock=function(a,b,c,d){h.prepareBlockContructorArgs(b);a=h.createInstance(a,b,c);a.ctrArgs=null;var e;try{a&&a.init&&a.init(),a.scope&&(e=a.scope.registerBlock(a,d)),a.initReload&&a.initReload()}catch(f){logError(f,"create block")}return e||a};h.clearVariables=function(){};h.getAllBlocks=function(a,b,c,d,e){if(!1!==
e&&null!=E){for(a=0;a<E.length;a++)if(b=E[a],"Set Variable"===b.name){E.remove(b);break}return E}0==e&&(E=null);e=h._getFlowBlocks(a,b,c,d);e=e.concat(h._getLoopBlocks(a,b,c,d));e=e.concat(h._getCommandBlocks(a,b,c,d));e=e.concat(h._getCodeBlocks(a,b,c,d));e=e.concat(h._getEventBlocks(a,b,c,d));e=e.concat(h._getLoggingBlocks(a,b,c,d));e=e.concat(h._getServerBlocks(a,b,c,d));e=e.concat(h._getMQTTBlocks(a,b,c,d));return E=e=e.concat(h._getFileBlocks(a,b,c,d))};h._getMQTTBlocks=function(a,b,c,d){var e=
[];e.push({name:"MQTT",iconClass:"fa-cloud",items:[{name:"Subscribe",owner:b,iconClass:"fa-bell",proto:D,target:c,ctrArgs:{scope:a,group:d}},{name:"Publish",owner:b,iconClass:"fa-send",proto:C,target:c,ctrArgs:{scope:a,group:d}}]});h.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"MQTT"});return e};h._getFileBlocks=function(a,b,c,d){var e=[];e.push({name:"File",iconClass:"fa-file",items:[{name:"%%Read JSON",owner:b,iconClass:"fa-file",proto:x,target:c,ctrArgs:{scope:a,group:d}}]});h.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,
{items:e,group:"File"});return e};h._getServerBlocks=function(a,b,c,d){var e=[];e.push({name:"Server",iconClass:"el-icon-repeat",items:[{name:"Run Server Method",owner:b,iconClass:"fa-plug",proto:z,target:c,ctrArgs:{scope:a,group:d}},{name:"Shell",owner:b,iconClass:"fa-code",proto:G,target:c,ctrArgs:{scope:a,group:d}}]});h.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Server"});return e};h._getVariableBlocks=function(a,b,c,d){var e=[];e.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",
owner:b,iconClass:"el-icon-fork",proto:v,target:c,ctrArgs:{scope:a,group:d,condition:"[value]\x3d\x3d'PW'"}}]});return e};h._getEventBlocks=function(a,b,c,d){var e=[];e.push({name:"Events",iconClass:"fa-bell",items:[{name:"On Event",owner:b,iconClass:"fa-bell",proto:F,target:c,ctrArgs:{scope:a,group:d}},{name:"On Key",owner:b,iconClass:"fa-keyboard-o",proto:B,target:c,ctrArgs:{scope:a,group:d}}]});h.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Events"});return e};h._getLoggingBlocks=
function(a,b,c,d){var e=[];e.push({name:"Logging",iconClass:"fa-bug",items:[{name:"Log",owner:b,iconClass:"fa-bug",proto:A,target:c,ctrArgs:{scope:a,group:d}}]});h.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Logging"});return e};h._getCodeBlocks=function(a,b,c,d){var f=[];f.push({name:"Code",iconClass:"fa-code",items:[{name:"Call Method",owner:b,iconClass:"el-icon-video",proto:k,target:c,ctrArgs:{scope:a,group:d}},{name:"Run Script",owner:b,iconClass:"fa-code",proto:e,target:c,ctrArgs:{scope:a,
group:d}},{name:"Run Block",owner:b,iconClass:"fa-code",proto:H,target:c,ctrArgs:{scope:a,group:d}},{name:"Set Properties",owner:b,iconClass:"fa-code",proto:m,target:c,ctrArgs:{scope:a,group:d}}]});h.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:f,group:"Code"});return f};h._getFlowBlocks=function(a,b,c,d){var e=[];e.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:v,target:c,ctrArgs:{scope:a,group:d,condition:"[value]\x3d\x3d'PW'"}},
{name:"Switch",owner:b,iconClass:"el-icon-fork",proto:y,target:c,ctrArgs:{scope:a,group:d}},{name:"Variable Switch",owner:b,iconClass:"el-icon-fork",proto:w,target:c,ctrArgs:{scope:a,group:d}}]});h.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Flow"});return e};h._getLoopBlocks=function(a,b,c,d){var e=[];e.push({name:"Loops",iconClass:"el-icon-repeat",items:[{name:"While",owner:b,iconClass:"el-icon-repeat",proto:l,target:c,ctrArgs:{scope:a,group:d,condition:"[Volume]\x3c\x3d100"}},{name:"For",
owner:b,iconClass:"el-icon-repeat",proto:q,target:c,ctrArgs:{scope:a,group:d,initial:"1",comparator:"\x3c\x3d","final":"5",modifier:"+1",counterName:"value"}}]});h.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Loops"});return e};h._getMathBlocks=function(a,b,c,d){b=[];b.push({name:"Math",owner:this,iconClass:"el-icon-qrcode",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-compass",proto:v,item:c,ctrArgs:{scope:a,group:d}}]});return b};h._getTimeBlocks=function(a,b,c,d){b=
[];b.push({name:"Time",owner:this,iconClass:"el-icon-qrcode",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-time",proto:v,item:c,ctrArgs:{scope:a,group:d}}]});return b};h._getTransformBlocks=function(a,b,c,d){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-magic",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-time",proto:v,item:c,ctrArgs:{scope:a,group:d}}]});return b};return h})},"xblox/model/logic/CaseBlock":function(){define("dcl/dcl xide/utils xide/types xblox/model/Block dojo/Deferred xblox/model/logic/BreakBlock".split(" "),
function(h,p,n,g,d,c){return h(g,{declaredClass:"xblox.model.logic.CaseBlock",comparator:null,expression:null,items:null,name:"Case",icon:"",hasInlineEdits:!0,toText:function(){return'\x3cspan style\x3d"text-indent: 1em;"\x3e\x26nbsp;\x26nbsp;\x26nbsp;'+this.getBlockIcon("I")+this.name+" "+this.makeEditable("comparator","right","text","Enter a comparison","inline")+(null!=this.expression?" "+this.makeEditable("expression","right","text","Enter a value to compare"):"")+"\x3c/span\x3e"},canAdd:function(){return[]},
_solve:function(a,b,c){b=b||{highlight:!1};for(var d=[],g=0;g<this.items.length;g++){var k=this.items[g];-1!==k.declaredClass.indexOf("BreakBlock")&&c.stop();this.addToEnd(d,k.solve(a,b))}return d},solve:function(a,b,c){try{var d=a.getVariableById(b.variable);!d&&c.args&&c.args[0]&&(d={value:c.args[0]});var g="";if(d)g=this._getArg(d.value,!0);else return this.onFailed(this,c),!1;if(!0===a.parseExpression(""+g+""+this.comparator+this._getArg(this.expression,!0)))return this.onSuccess(this,c),this._solve(a,
c,b),!0;this.onFailed(this,c);return!1}catch(k){console.error("case block crashed! ",k.stack),console.trace()}},getChildren:function(a){return this.items},getFields:function(){function a(a,b){return{label:b||a,value:a}}var b=this.inherited(arguments)||this.getDefaultFields();b.push(p.createCI("Expression",13,this.expression,{group:"General",title:"Expression",dst:"expression"}));b.push(p.createCI("Comparator",3,this.comparator,{group:"General",title:"Comparator",dst:"comparator",widget:{options:[a("\x3d\x3d"),
a("\x3c\x3d"),a("\x3d\x3e"),a("!\x3d"),a("\x3c"),a("\x3e")],editable:!0}}));return b},runAction:function(a){if("New/Break"===a.command){a=new d;var b=this.add(c,{group:null});a.resolve({select:[b],focus:!0,append:!1});b.refresh();return a}},getActions:function(){return[this.createAction({label:"Break",command:"New/Break",tab:"Home",icon:"fa-stop",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}})]}})})},"xblox/model/logic/BreakBlock":function(){define(["dcl/dcl","xide/utils","xide/types",
"xblox/model/Block"],function(h,p,n,g){return h(g,{declaredClass:"xblox.model.logic.BreakBlock",name:"Break",icon:"fa-stop",hasInlineEdits:!1,canAdd:!1,toText:function(){return'\x26nbsp;\x3cspan class\x3d"fa-stop text-warning"\x3e\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan\x3e'+this.name+"\x3c/span\x3e"},solve:function(d,c){this.onSuccess(this,c)},getFields:function(){return this.inherited(arguments)||this.getDefaultFields()}})})},"xblox/model/functions/CallBlock":function(){define("dcl/dcl xide/utils xide/types dojo/Deferred xblox/model/Block xcf/model/Command".split(" "),
function(h,p,n,g,d,c){return h(c,{declaredClass:"xblox.model.functions.CallBlock",command:"Select command please",icon:"",args:null,_timeout:100,isCommand:!0,_commandHandles:null,onCommandProgress:function(a){this.getScope().getContext();var b=a.params;b&&b.id&&(this._emit("cmd:"+a.cmd+"_"+b.id,{msg:a}),a.lastResponse&&this.storeResult(a.lastResponse),this._emit("progress",{msg:a,id:b.id}));this._lastResult=null;this._lastResult=a?a.result:null;a=this.getItems(n.BLOCK_OUTLET.PROGRESS);this._lastSettings||
(this._lastSettings={});this._lastSettings.override={};a.length&&this.runFrom(a,0,this._lastSettings)},stop:function(){this._lastCommand&&this._lastCommand.stop()},pause:function(){this._lastCommand&&this._lastCommand.pause()},destroy:function(){_.invoke(this._commandHandles,"remove");delete this._commandHandles;delete this._lastCommand},solve:function(a,b){this._commandHandles&&_.invoke(this._commandHandles,"remove");this._commandHandles=[];var c=this._timeout||50;_.isString(c)&&(c=parseInt(c));
var d=new g,h=this._commandHandles;b=b||{};setTimeout(function(){if(this.command){var c=null;if(this.args){b.override=b.override||{};var e=a.expressionModel.replaceVariables(a,this.args,!1,!1,null,null,{begin:"%%",end:"%%"});try{c=p.fromJson(e)}catch(g){c=e}b.override.args=_.isArray(c)?c:[e];b.override.mixin=c}if(this._lastCommand=a.resolveBlock(this.command))h.push(this._lastCommand._on("paused",this.onCommandPaused,this)),h.push(this._lastCommand._on("finished",this.onCommandFinish,this)),h.push(this._lastCommand._on("stopped",
this.onCommandStopped,this)),h.push(this._lastCommand._on("error",this.onCommandError,this)),h.push(this._lastCommand._on("progress",this.onCommandProgress,this));if(c=a.solveBlock(this.command,b))this.onSuccess(this,b);else this.onFailed(this,b);d.resolve(c);return c}}.bind(this),c);return d},hasInlineEdits:!0,makeEditable:function(a,b,c,d,g,k,e){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+b+"' display-mode\x3d'"+(g||"popup")+"' display-type\x3d'"+(c||"text")+"' data-prop\x3d'"+a+"' data-title\x3d'"+
d+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[a]+"\x3c/a\x3e"},getFieldOptions:function(a){if("command"===a)return this.scope.getCommandsAsOptions("text")},toText:function(){var a="Unknown",b=this.scope.getBlock(this.command);b&&(a=b.name);-1!==this.command.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Call Command : "+a},getFields:function(){var a=this.getDefaultFields();this.command.indexOf("://")&&
this.scope.toFriendlyName(this,this.command);a.push(p.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));a.push(p.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(p.createCI("timeout",13,this._timeout,{group:"General",title:"Delay",dst:"_timeout"}));return a}})})},"xcf/model/Command":function(){define("dcl/dcl xblox/model/Block xblox/model/Contains xide/utils xide/types dojo/Deferred xblox/types/Types".split(" "),
function(h,p,n,g,d,c,a){return h([p,n],{declaredClass:"xcf.model.Command",startup:!1,auto:null,send:"",name:"No Title",observed:["send"],interval:0,flags:2048,_runningDfd:null,__started:!1,isCommand:!0,getItems:function(a){return this.getItemsByType(a)},onCommandFinish:function(a){this.getScope();var c=null;if(a.params&&a.params.id){var f=a.params.id,c=this.getDeferred(f);delete this._solving[f];a.lastResponse&&this.storeResult(a.lastResponse);this._emit("finished",{msg:a,result:this._lastResult})}a=
this.getItems(d.BLOCK_OUTLET.FINISH);a.length&&this.runFrom(a,0,this._lastSettings);this.resolve({});this.onSuccess(this,this._lastSettings);c&&c.resolve(this._lastResult)},onCommandPaused:function(a){var c=a.params;c&&c.id&&(a.lastResponse&&this.storeResult(a.lastResponse),this._emit("paused",{msg:a,result:this._lastResult,id:c.id}));a=this.getItems(d.BLOCK_OUTLET.PAUSED);a.length&&this.runFrom(a,0,this._lastSettings)},onCommandStopped:function(a){this.getScope();var c=a.params;c&&c.id&&(a.lastResponse&&
this.storeResult(a.lastResponse),this._emit("stopped",{msg:a,result:this._lastResult,id:c.id}));a=this.getItems(d.BLOCK_OUTLET.STOPPED);a.length&&this.runFrom(a,0,this._lastSettings)},onCommandProgress:function(a){var c=a.params;c&&c.id&&(a.lastResponse&&this.storeResult(a.lastResponse),this._emit("progress",{msg:a,result:this._lastResult,id:c.id}));a=this.getItems(d.BLOCK_OUTLET.PROGRESS);a.length&&this.runFrom(a,0,this._lastSettings)},storeResult:function(a){var c=g.getJson(a);a=null;if(c&&c.result&&
_.isString(c.result)){var d=c.result,h=-1!==d.indexOf("{")||-1!==d.indexOf("["),c=d;h&&(d=g.getJson(d,!0,!1))&&(c=d);this._lastResult=null!==c?a=c:null}return a},resolve:function(a){a=a||this._lastResult;this._runningDfd&&this._runningDfd.resolve(a)},onCommandError:function(a){this.getScope();var c=a.params;c.id&&(a.lastResponse&&this.storeResult(a.lastResponse),this._emit("cmd:"+a.cmd+"_"+c.id,a),this._emit("error",{msg:a,result:this._lastResult,id:c.id}));this.onFailed(this,this._settings);a=this.getItems(d.BLOCK_OUTLET.ERROR);
a.length&&this.runFrom(a,0,this._lastSettings)},sendToDevice:function(a,c,f,h,k){if(!this._destroyed){a=this.replaceAll("'","",a);k=k||g.createUUID();var e=this,q=this.flags&d.CIFLAG.WAIT?!0:!1;this.lastCommand=""+a;if(this.scope.instance)q&&this._on("cmd:"+a+"_"+k,function(a){if(a.error)e.onFailed(e,c);else e.onSuccess(e,c)}),this.scope.instance.sendMessage(a,null,this.id,k,q,f,h);else return this.publish(d.EVENTS.ON_STATUS_MESSAGE,{text:"Command "+this.name+" : have no device",type:"error",delay:1E3}),
!1;return k}},reset:function(){this._lastSettings={};this._loop&&(clearTimeout(this._loop),this._loop=null);delete this._runningDfd},_solving:null,addDeferred:function(a){this._solving||(this._solving={});this._solving[a]=new c;return this._solving[a]},getDeferred:function(a){this._solving||(this._solving={});return this._solving[a]},_resolve:function(a,c,f){if(_.isNumber(a)||_.isBoolean(a))return a;var h=this.scope;a=a||this._get("send");c=c||{};var k=c.flags||this.flags,e=!(k&d.CIFLAG.DONT_PARSE),
q=k&d.CIFLAG.EXPRESSION;k&d.CIFLAG.TO_HEX&&(a=g.to_hex(a));!1!==e&&(a=g.convertAllEscapes(a,"none"));c=c||this._lastSettings||{};if(k=(c=c.override||this.override||{},c.variables)?c.variables:null)for(var l in k)_.isNumber(k[l])&&(k[l]=Math.round(k[l]));l="";var n=this.getDriverModule();n&&n.resolveBefore&&!1!==f&&(a=n.resolveBefore(this,a)||a);l=q&&!1!==e?h.parseExpression(a,null,k,null,null,null,c.args):""+a;n&&n.resolveAfter&&!1!==f&&(l=n.resolveAfter(this,l)||l);return l},solve:function(a,c,f,
h){var k=null;a=a||this.scope;(c=this._lastSettings=c||this._lastSettings||{},c.override)&&c.override.mixin&&g.mixin(this.override,c.override.mixin);var e=h||this._get("send")||this.send,n=!(this.flags&d.CIFLAG.DONT_PARSE);h=this.flags&d.CIFLAG.WAIT?!0:!1;var l=g.createUUID();this.flags&d.CIFLAG.TO_HEX&&(e=g.to_hex(e));!1!==n&&(e=g.convertAllEscapes(e,"none"));if(this.enabled||!0===f){!0===f&&this._loop&&this.reset();if(!0!==h)this.onRun(this,c);else this.onRun(this,c,{timeout:!1}),k=this.addDeferred(l);
if(this.items&&0<this.items.length){if(e&&0<e.length&&(e=this._resolve(this.send,c))&&0<e.length)if(this.sendToDevice(e,c))this.onSuccess(this,c);else this.onFailed(this,c);if(h)return k;f=[];for(k=0;k<this.items.length;k++)h=this.items[k],h.enabled&&f.push(h.solve(a,c));return f}if(0<e.length){if((e=this._resolve(this.send,c))&&0<e.length&&!this.sendToDevice(e,c,null,null,l))this.onFailed(this,c);if(!0!==h)this.onSuccess(this,c);else this._settings=c;f&&this.auto&&0<this.getInterval()&&this.scope.loopBlock(this,
c);return h?k:[e]}return!1}this.reset()},canAdd:function(){return[]},mayHaveChildren:function(a){return null!=this.items&&0<this.items.length},getChildren:function(a){return this.items},hasInlineEdits:!0,toText:function(a,c,d,g){var k="";!1!==a&&(k+="\x3cspan class\x3d'text-primary inline-icon'\x3e"+this.getBlockIcon()+"\x3c/span\x3e");!1!==c&&(k+=""+this.makeEditable("name","bottom","text","Enter a unique name","inline")+"");!0===g&&(k+="\x3cbr/\x3e");!1!==d&&(k+="\x3cspan class\x3d'text-muted small'\x3e Send:\x3ckbd class\x3d'text-warning'\x3e"+
this.makeEditable("send","bottom","text","Enter the string to send","inline")+"\x3c/kbd\x3e\x3c/span\x3e");!1!==a&&(this.startup&&(k+=this.getIcon("fa-bell inline-icon text-warning","text-align:right;float:right;","")),this.auto&&0<this.getInterval()&&(k+=this.getIcon("fa-clock-o inline-icon text-warning","text-align:right;float:right","")));return k=this.getDriverToText(k)||k},getInterval:function(){return parseInt(this.interval,10)},start:function(){this.startup&&!this.auto?this.solve(this.scope):
this.auto&&0<this.getInterval()&&this.scope.loopBlock(this)},getDriverModule:function(){var a=null,c=this.getInstance();c?a=c.Module:(c=this.getScope().driver)&&c.Module&&(a=c.Module);return a},getDriverToText:function(a){var c=this.getDriverModule();if(c&&c.toText)return c.toText(this,a)},getDriverFields:function(a){var c=this.getDriverModule(),d=[];c&&c.getFields&&(d=c.getFields(this,a)||[]);return d},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),c=this;a.push(this.utils.createCI("name",
13,this.name,{group:"General",title:"Name",dst:"name",order:200}));a.push(this.utils.createCI("startup",0,this.startup,{group:"General",title:"Send on Startup",dst:"startup",order:199}));a.push(this.utils.createCI("auto",0,this.auto,{group:"General",title:"Auto Send",dst:"auto",order:198}));a.push(this.utils.createCI("interval",13,this.interval,{group:"General",title:"Interval",dst:"interval",order:197}));a.push(this.utils.createCI("send",d.ECIType.EXPRESSION_EDITOR,this.send,{group:"Send",title:"Send",
dst:"send",widget:{instantChanges:!1,allowACECache:!0,showBrowser:!1,showSaveButton:!0,style:"height:inherit;",editorOptions:{showGutter:!1,autoFocus:!1},aceOptions:{hasEmmet:!1,hasLinking:!1,hasMultiDocs:!1},item:this},delegate:{runExpression:function(a,b,d){return c.scope.expressionModel.parse(c.scope,a,!1,b,d)}}}));a.push(this.utils.createCI("flags",5,this.flags,{group:"General",title:"Flags",dst:"flags",data:[{value:4096,label:"Dont parse",title:"Do not parse the string and use it as is"},{value:2048,
label:"Expression",title:"Parse it as Javascript"},{value:32768,label:"Wait",title:"Wait for response"}],widget:{hex:!0}}));return a=a.concat(this.getDriverFields(a))},icon:"fa-exclamation",getIconClass:function(){return"el-icon-play-circle"},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e '},canEdit:function(){return!0},onChangeField:function(a,c,d){var g=this.getInterval();"auto"==a&&(!0===c?0<g&&this.scope.loopBlock(this):this._loop&&this.reset());"enabled"==a&&
(!1===c?this.reset():g&&this.scope.loopBlock(this));"interval"==a&&(0<g&&this.auto?this.scope.loopBlock(this):this.reset());this.inherited(arguments)},destroy:function(){this.reset()},pause:function(){var a=this.lastCommand||this._resolve(this.send,this._lastSettings);null!==a&&this.sendToDevice(a,this._lastSettings,!1,!0)},stop:function(a){!0!==a&&(this.onSuccess(this,{highlight:!0}),this.resolve(""),a=this.lastCommand||this._resolve(this.send,this._lastSettings),_.isEmpty(a)||this.sendToDevice(a,
this._lastSettings,!0,!1),delete this._runningDfd)}})})},"xblox/model/Contains":function(){define(["dcl/dcl","dojo/promise/all","xide/types"],function(h,p,n){return h(null,{declaredClass:"xblox.model.Contains",runByType:function(g,d){var c=this.getItemsByType(g);c.length&&this.runFrom(c,0,d)},getItemsByType:function(g){var d=this.items;if(!g)return d;var c=[];_.each(d,function(a){a.outlet&g&&c.push(a)});return c},getContainer:function(){return this[this._getContainer()]},mayHaveChildren:function(g){g=
this[this._getContainer()];return null!=g&&0<g.length},getChildren:function(g){return this[this._getContainer()]},canAdd:function(){return[]},runFrom:function(g,d,c){var a=this,b=g||this.items;g=[];var h=function(d){d._deferredObject.then(function(e){console.log("----def block finish");d._lastResult=d._lastResult||e;a._currentIndex++;a.runFrom(b,a._currentIndex,c)})};if(b.length)for(;d<b.length;d++){var f=b[d];if(!0===f.deferred&&f.enabled){f._deferredObject=new Deferred;this._currentIndex=d;h(f);
var m=f.solve(this.scope,c);g.push(m);break}else f.enabled&&(m=f.solve(this.scope,c),g.push(m),f.onDidRun())}else this.onSuccess(this,c);this._lastSettings&&delete this._lastSettings.override;return g},_solve:function(g,d,c,a){!this._lastRunSettings&&d&&(this._lastRunSettings=d);d=this._lastRunSettings||d;this._currentIndex=0;this._return=[];g=this[this._getContainer()];if(g.length)return g=this.runFrom(g,0,d),this.onSuccess(this,d),g;this.onSuccess(this,d);return[]},onDidRunItem:function(g,d,c){this._emit(n.EVENTS.ON_RUN_BLOCK_SUCCESS,
this);g.resolve(d)},onDidRunItemError:function(g,d,c){g.reject(d)},onRunThis:function(g){this._emit(n.EVENTS.ON_RUN_BLOCK,this)},onDidRunThis:function(g,d,c,a){var b=this;if(c&&c.length)c=b.runFrom(c,0,a),p(c).then(function(c){b.onDidRunItem(g,d,a)},function(c){console.error("error in chain",c);b.onDidRunItem(g,c,a)});else b.onDidRunItem(g,d,a)},___solve:function(g,d,c,a){}})})},"xblox/types/Types":function(){define(["xide/types/Types","xide/utils"],function(h,p){h.BLOCK_MODE={NORMAL:0,UPDATE_WIDGET_PROPERTY:1};
h.BLOCK_OUTLET={NONE:0,PROGRESS:1,ERROR:2,PAUSED:4,FINISH:8,STOPPED:16};p.mixin(h.EVENTS,{ON_RUN_BLOCK:"onRunBlock",ON_RUN_BLOCK_FAILED:"onRunBlockFailed",ON_RUN_BLOCK_SUCCESS:"onRunBlockSuccess",ON_BLOCK_SELECTED:"onItemSelected",ON_BLOCK_UNSELECTED:"onBlockUnSelected",ON_BLOCK_EXPRESSION_FAILED:"onExpressionFailed",ON_BUILD_BLOCK_INFO_LIST:"onBuildBlockInfoList",ON_BUILD_BLOCK_INFO_LIST_END:"onBuildBlockInfoListEnd",ON_BLOCK_PROPERTY_CHANGED:"onBlockPropertyChanged",ON_SCOPE_CREATED:"onScopeCreated",
ON_VARIABLE_CHANGED:"onVariableChanged",ON_CREATE_VARIABLE_CI:"onCreateVariableCI"});h.BlockType={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",
ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",
SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"};return h})},"xblox/model/functions/StopBlock":function(){define(["dcl/dcl","xide/utils","xide/types","dojo/Deferred","xblox/model/Block"],
function(h,p,n,g,d){return h(d,{declaredClass:"xblox.model.functions.StopBlock",command:"Select command please",icon:"",args:null,_timeout:100,solve:function(c,a){if(this.command){var b=c.resolveBlock(this.command);if(b&&b.stop){var d=b.stop();this.onSuccess(this,a)}else this.onFailed(this,a);return d}},hasInlineEdits:!0,makeEditable:function(c,a,b,d,f,g,k){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+a+"' display-mode\x3d'"+(f||"popup")+"' display-type\x3d'"+(b||"text")+"' data-prop\x3d'"+c+"' data-title\x3d'"+
d+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[c]+"\x3c/a\x3e"},getFieldOptions:function(c){if("command"===c)return this.scope.getCommandsAsOptions("text")},toText:function(){var c="Unknown",a=this.scope.getBlock(this.command);a&&(c=a.name);-1!==this.command.indexOf("://")&&(c='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Stop Command : "+c},onChangeField:function(c,a){},getFields:function(){var c=this.inherited(arguments)||
this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);c.push(p.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));return c}})})},"xblox/model/functions/PauseBlock":function(){define(["dcl/dcl","xide/utils","xide/types","dojo/Deferred","xblox/model/Block"],function(h,p,n,g,d){return h(d,{declaredClass:"xblox.model.functions.PauseBlock",
command:"Select command please",icon:"",args:null,_timeout:100,solve:function(c,a){if(this.command){var b=c.resolveBlock(this.command);if(b&&b.pause){var d=b.pause();this.onSuccess(this,a)}else this.onFailed(this,a);return d}},hasInlineEdits:!0,makeEditable:function(c,a,b,d,f,g,k){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+a+"' display-mode\x3d'"+(f||"popup")+"' display-type\x3d'"+(b||"text")+"' data-prop\x3d'"+c+"' data-title\x3d'"+d+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[c]+
"\x3c/a\x3e"},getFieldOptions:function(c){if("command"===c)return this.scope.getCommandsAsOptions("text")},toText:function(){var c="Unknown",a=this.scope.getBlock(this.command);a&&(c=a.name);-1!==this.command.indexOf("://")&&(c='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Pause Command : "+c},onChangeField:function(c,a){},getFields:function(){var c=this.inherited(arguments)||this.getDefaultFields();this.command.indexOf("://")&&
this.scope.toFriendlyName(this,this.command);c.push(p.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));return c}})})},"xblox/model/functions/SetProperties":function(){define(["dcl/dcl","xide/utils","xide/types","dojo/Deferred","xblox/model/Block"],function(h,p,n,g,d){return h(d,{declaredClass:"xblox.model.functions.SetProperties",command:"Select block",
icon:"",args:null,_timeout:100,solve:function(c,a){var b=new g;if(this.command){var d=c.resolveBlock(this.command);if(d&&this.props){for(var f in this.props)d.set(f,this.props[f]),d[f]=this.props[f],d.onChangeField&&d.onChangeField(f,this.props[f]);this.onSuccess(this,a)}else this.onFailed(this,a);b.resolve([])}return b},hasInlineEdits:!1,makeEditable:function(c,a,b,d,f,g,k){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+a+"' display-mode\x3d'"+(f||"popup")+"' display-type\x3d'"+(b||"text")+"' data-prop\x3d'"+
c+"' data-title\x3d'"+d+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[c]+"\x3c/a\x3e"},getFieldOptions:function(c){if("command"===c)return this.scope.getCommandsAsOptions("text")},toText:function(){var c="Unknown",a=this.scope.getBlock(this.command);a&&(c=a.name);-1!==this.command.indexOf("://")&&(c='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Set Properties : "+c},serializeObject:function(c){return"props"===
c?!0:!1},onChangeField:function(c,a,b){"command"===c&&(delete this.props,this.props={})},init:function(){this.props&&_.isString(this.props)&&(this.props=p.fromJson(this.props))},getFields:function(){var c=this.inherited(arguments)||this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);c.push(p.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",
value:this.command}));var a=this.scope.resolveBlock(this.command);if(a&&a.getFields){this.props||(this.props={});var a=a.getFields(),b=_.find(a,{dst:"description"});a.remove(b);_.each(a,function(a){a.group="Properties";a.value=p.getAt(this.props,a.dst,a.value);a.dst="props."+a.dst},this);c=c.concat(a)}return c}})})},"xblox/model/code/CallMethod":function(){define(["dcl/dcl","xblox/model/Block","xide/utils"],function(h,p,n){return h(p,{declaredClass:"xblox.model.code.CallMethod",name:"Call Method",
method:"",args:"",sharable:!0,solve:function(g,d){var c=this.getContext();if(c&&null!=c[this.method]){var a=[],b=c[this.method];try{var h=this.getArgs(d);console.log("args",h);a=b.apply(c,h||[]);this.onSuccess(this,d);return a}catch(f){console.error("call method "+this.method+" failed: "+f),logError(f),this.onFailed(this,d)}}else this.onFailed(this,d);return[]},toText:function(){var g=this.getBlockIcon()+" "+this.name+" ";this.method&&(g+=this.makeEditable("method","bottom","text","Enter a driver method",
"inline"));return g},getFields:function(){var g=this.getDefaultFields();this.getContext();g.push(n.createCI("value",13,this.method,{group:"General",title:"Method",dst:"method"}));g.push(n.createCI("value",27,this.args,{group:"Arguments",dst:"args",widget:{title:""}}));return g},getBlockIcon:function(){return'\x3cspan class\x3d"fa-caret-square-o-right"\x3e\x3c/span\x3e'}})})},"xblox/model/code/RunScript":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains dojo/promise/all xide/types module".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m,k,e){var q="undefined"!==typeof window?window.console:global.console;f&&q&&q.error&&(q=m);return h([g,c],{declaredClass:"xblox.model.code.RunScript",name:"Run Script",method:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-code",observed:["method"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve2:function(a,b,c,d){this._currentIndex=0;this._return=[];var e=""+this._get("method"),f=this,k=this.getContext();
if(e&&e.length){var g=function(){var a=new Function("{"+e+"}"),g=f.getArgs()||[];try{var h=a.apply(k,g||{});f._lastResult=h;c&&c("Expression "+e+" evaluates to "+h);if("false"!==h&&!1!==h)f.onSuccess(f,b,{result:h});else return f.onFailed(f,b),[]}catch(l){return d&&d("invalid expression : \n"+e+": "+l),f.onFailed(f,b),[]}};if(a.global)(function(){window=a.global;var g=f.getArgs()||[];try{var h=null,h=k.runExpression?k.runExpression(e,null,g):(new Function("{"+e+"}")).bind(this).apply(k,g||{});f._lastResult=
h;c&&c("Expression "+e+" evaluates to "+h);if("false"!==h&&!1!==h)f.onSuccess(f,b);else return f.onFailed(f,b),[]}catch(m){return f._lastResult=null,d&&d("invalid expression : \n"+e+": "+m),f.onFailed(f,b),[]}}).call(a.global);else return g()}else q.error("have no script");g=this[this._getContainer()];if(g.length)this.runFrom(g,0,b);else this.onSuccess(this,b);this.onDidRun();return[]},solve:function(a,b,c,d,e,f){this._currentIndex=0;this._return=[];b=b||{};c=d||(this._get("method")?this._get("method"):
this.method);var k=this;d=this.getContext();var g=this[this._getContainer()],h=new n,m=k.deferred;this.onRunThis(b);var q=a.expressionModel.replaceVariables(a,c,null,null),r=a.expressionModel.expressionCache[q];r||(r=a.expressionModel.expressionCache[q]=new Function("{"+q+"}"));a=k.getArgs(b)||[];try{m&&(d.resolve=function(a){k._deferredObject&&k._deferredObject.resolve();k.onDidRunThis(h,a,g,b)});var p=r.apply(d,a||{});k._lastResult=p;e&&e("Expression "+c+" evaluates to "+p);if(!m)k.onDidRunThis(h,
p,g,b);if("false"!==p&&!1!==p)k.onSuccess(k,b);else k.onFailed(k,b)}catch(C){C=C||{},k.onDidRunItemError(h,C,b),k.onFailed(k,b),f&&f("invalid expression : \n"+c+": "+C)}return h},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.name+" :: \x3c/span\x3e";this.method&&(a+=this.method.substr(0,50));return a},canAdd:function(){return[]},getFields:function(){"No Description"===this.description&&(this.description=k);var a=this.inherited(arguments)||this.getDefaultFields(),
c=this;a.push(d.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));a.push(d.createCI("deferred",0,this.deferred,{group:"General",title:"Deferred",dst:"deferred"}));a.push(d.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(d.createCI("value",b.ECIType.EXPRESSION_EDITOR,this.method,{group:"Script",title:"Script",dst:"method",select:!0,widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!0,autoFocus:!1},
item:this},delegate:{runExpression:function(a,b,d){c.method=a;c.solve(c.scope,null,b,d)}}}));return a}})})},"xblox/model/loops/ForBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/variables/Variable xblox/model/Contains dojo/promise/all dojo/Deferred".split(" "),function(h,p,n,g,d,c){return h([p,g],{declaredClass:"xblox.model.loops.ForBlock",initial:null,"final":null,comparator:null,modifier:null,items:null,counterName:null,_counter:null,name:"For",sharable:!0,icon:"",ignoreErrors:!1,
deferred:!0,_forState:!1,_currentForIndex:0,runFrom:function(a,b,d){var f=this,g=a||this.items;a=[];var k=function(a){a._deferredObject.then(function(b){console.log("----def block finish");a._lastResult=a._lastResult||b;f._currentIndex++;f.runFrom(g,f._currentIndex,d)})};if(g.length)for(;b<g.length;b++){var e=g[b];if(!1!==e.enabled)if(!0===e.deferred){e._deferredObject=new c;this._currentIndex=b;k(e);e=e.solve(this.scope,d);a.push(e);break}else e=e.solve(this.scope,d),a.push(e)}else this.onSuccess(this,
d);return a},runFromDirect:function(a,b,d){var f=this,g=a||this.items;a=[];var k=function(a){a._deferredObject.then(function(b){a._lastResult=a._lastResult||b;f._currentIndex++;f.runFrom(g,f._currentIndex,d)})};if(g.length)for(;b<g.length;b++){var e=g[b];if(!1!==e.enabled)if(!0===e.deferred){e._deferredObject=new c;this._currentIndex=b;k(e);e=e.solve(this.scope,d);a.push(e);break}else e=e.solve(this.scope,d),a.push(e)}else this.onSuccess(this,d);return a},solveSubs:function(a,b,c,f){var g=this;f.override=
f.override||{};f.override.args=[this._currentForIndex];if(c.length)return b=g.runFrom(c,0,f),d(b).then(function(a){},function(b){console.error("error in chain",b);g.onDidRunItem(a,b,f)}),b;g.onDidRunItem(a,b,f)},solveSubsDirect:function(a,b,c,d){d.override=d.override||{};d.override.args=[this._currentForIndex];if(c.length)return this.runFromDirect(c,0,d)},_solve:function(a,b){var g=new c,f=this,h=this.solveSubs(g,null,this.items,b);h?d(h).then(function(a){a=a.indexOf(!1);!0!==f.ignoreErrors&&-1!==
a?g.resolve(!1):g.resolve(!0)}):g.resolve(!0);return g},step:function(a,b){var d=this._checkCondition(a,b),f=new c;d&&this._solve(a,b).then(function(a){1==a?f.resolve(!0):f.resolve(!1)});return f},loop:function(a,b){var c=this;this.step(a,b).then(function(d){c._updateCounter(a);c._currentForIndex=c._counter.value;if(1==d)c.loop(a,b);else c.onFailed(c,b)})},_solveDirect:function(a,b){return this.solveSubsDirect(null,null,this.items,b)},stepDirect:function(a,b){return this._solveDirect(a,b)},loopDirect:function(a,
b){this.stepDirect(a,b);for(var c=parseInt(this.initial);c<parseInt(this["final"]);c++)this.stepDirect(a,b)},solve:function(a,b){this._counter=new n({title:this.counterName,value:this.initial,scope:a,register:!1});this._forState=!0;this._currentForIndex=this.initial;this.deferred?this.loop(a,b):this.loopDirect(a,b);return[]},_checkCondition:function(a,b){var c=a.parseExpression(""+this._counter.value+this.comparator+this["final"]);if(0!=c)this.onSuccess(this,b);return this._forState=c},_updateCounter:function(a){var b=
this._counter.value,b=a.parseExpression(""+b+this.modifier);if(b==this._counter.value)return!1;this._counter.value=b;return!0},mayHaveChildren:function(a){return null!=this.items&&0<this.items.length},getChildren:function(a){a=[];this.items&&(a=a.concat(this.items));return a},canAdd:function(){return[]},toText:function(){return this.getBlockIcon("F")+this.name+" "+this.initial+" "+this.comparator+" "+this["final"]+" with "+this.modifier},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();
return a=a.concat([this.utils.createCI("initial",13,this.initial,{group:"General",title:"Initial",dst:"initial"}),this.utils.createCI("Final",13,this["final"],{group:"General",title:"Final",dst:"final"}),this.utils.createCI("comparator",13,this.comparator,{group:"General",title:"Comparision",dst:"comparator"}),this.utils.createCI("modifier",13,this.modifier,{group:"General",title:"Modifier",dst:"modifier"}),this.utils.createCI("Abort on Error",0,this.ignoreErrors,{group:"General",title:"Ignore Errors",
dst:"ignoreErrors"}),this.utils.createCI("Deferred",0,this.deferred,{group:"General",title:"Use Deferred",dst:"deferred"})])}})})},"xblox/model/loops/WhileBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/variables/Variable"],function(h,p,n){return h(p,{declaredClass:"xblox.model.loops.WhileBlock",condition:null,items:null,loopLimit:1500,name:"While",wait:0,_currentIndex:0,sharable:!0,icon:"",_timer:null,canAdd:function(){return[]},_solve:function(g,d){for(var c=0;c<this.items.length;c++)this.items[c].solve(g,
d);return[]},doStep:function(g){if(this._currentIndex<this.loopLimit){var d=[];this._checkCondition(this.scope)?(this.onSuccess(this,g),this.addToEnd(d,this._solve(this.scope,g)),this._currentIndex++):(this._timer&&clearInterval(this._timer),this.onFailed(this,g))}else console.error("--while block : reached loop limit"),this.reset()},reset:function(){this._timer&&(clearTimeout(this._timer),this._timer=null);this._currentIndex=0},solve:function(g,d){this.loopLimit=1500;d=d||{};var c=0,a=this,b=this._getArg(this.wait);
this.reset();if(0<b)return this._timer=setInterval(function(){a.doStep(d)},b),[];for(;this._checkCondition(g)&&c<this.loopLimit;)this._solve(g,d),c++;this.reset();return[]},toText:function(){return this.getBlockIcon("G")+this.name+" "+this.condition},_checkCondition:function(g){return g.parseExpression(this.condition)},mayHaveChildren:function(g){return null!=this.items&&0<this.items.length},getChildren:function(g){g=[];this.items&&(g=g.concat(this.items));return g},getFields:function(){var g=this,
d=this.inherited(arguments)||this.getDefaultFields();d.push(this.utils.createCI("condition",25,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(c,a,b){return g.scope.expressionModel.parse(g.scope,c,!1,a,b)}}}));d.push(this.utils.createCI("wait",13,this.wait,{group:"General",title:"Wait",dst:"wait"}));return d}})})},"xblox/model/variables/VariableAssignmentBlock":function(){define("dcl/dcl xblox/model/Block xide/utils xide/types dstore/legacy/DstoreAdapter xide/factory xdojo/has".split(" "),
function(h,p,n,g,d,c,a){return h(p,{declaredClass:"xblox.model.variables.VariableAssignmentBlock",variable:null,value:null,name:"Set Variable",icon:"",hasInlineEdits:!0,flags:4,toText:function(){var a=this.scope.getVariableById(this.variable),a=a?a.name:"";this.variable&&-1!==this.variable.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.variable)+"\x3c/span\x3e");return this.getBlockIcon("C")+this.name+" "+a+"\x3cspan class\x3d'text-muted small'\x3e to \x3ckbd class\x3d'text-warning'\x3e"+
this.makeEditable("value","bottom","text","Enter the string to send","inline")+"\x3c/kbd\x3e\x3c/span\x3e"},_getPreviousResult:function(){var a=null;return(a=(a=this.getPreviousBlock())&&a._lastResult&&a.enabled?a:this.getParent())&&null!=a._lastResult?(this.isArray(a._lastResult),a._lastResult):null},solve:function(a,d){var f=this.value,h=!1;if(!f){var k=this.getArgs();0<k.length&&(f=k[0])}if(this.variable&&null!==f){this.onRun(this,d);var e=-1!==this.variable.indexOf("://")?this.scope.resolveBlock(this.variable):
a.getVariableById(this.variable),k=this._getArg(f),n=this.getArgs(d)||[];if(!e)return[];var l=null;this.isScript(k)?(l=this.override||{},l=a.parseExpression(f,null,null,null,null,null,n||l.args),l=this.replaceAll("'","",l),e.value!==l&&(h=!0)):(n&&1==n.length&&(k=n[0]),e.value!==k&&(h=!0),l=e.value=k);e.set("value",l);f=!1;(n=this.getContext())&&(n=n.device)&&n.info&&n.info.serverSide&&(f=this.flags&g.VARIABLE_FLAGS.PUBLISH_IF_SERVER?!0:!1);this.flags&g.VARIABLE_FLAGS.PUBLISH&&h&&(f=!0);h&&c.publish(g.EVENTS.ON_DRIVER_VARIABLE_CHANGED,
{item:e,scope:this.scope,save:!1,block:this,name:e.name,value:k,publish:f,result:l});this.onSuccess(this,d);return[]}},canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(!1),c=this;a.push(this.utils.createCI("value",29,this.value,{group:"General",title:"Value",dst:"value",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!1,autoSelect:!1,autoFocus:!1,hasConsole:!1,hasItemActions:function(){return!1}},item:this},
delegate:{runExpression:function(a,b,d){return c.scope.expressionModel.parse(c.scope,a,!1,b,d)}}}));a.push(n.createCI("value","xcf.widgets.CommandPicker",this.variable,{group:"Variable",title:"Variable",dst:"variable",block:this,pickerType:"variable",value:this.variable,widget:{store:this.scope.blockStore,labelField:"name",valueField:"id",value:this.variable,query:[{group:"basicVariables"},{group:"processVariables"}]}}));a.push(this.utils.createCI("flags",5,this.flags,{group:"Variable",title:"Flags",
dst:"flags",data:[{value:2,label:"Publish to network",title:"Publish to network in order to make a network variable"},{value:4,label:"Publish if server",title:"Publish only on network if this is running server side"}],widget:{hex:!0}}));return a}})})},"dstore/legacy/DstoreAdapter":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/store/util/QueryResults"],function(h,p,n){function g(c){return c}var d={store:null,constructor:function(c){this.store=c;if(c._getQuerierFactory("filter")||
c._getQuerierFactory("sort"))this.queryEngine=function(a,d){d=d||{};var f=c._getQuerierFactory("filter"),h=f?f(a):g,f=c._getQuerierFactory("sort"),k=g;f&&(k=f(p.map(d.sort,function(a){return{property:a.attribute,descending:a.descending}})));var e=g;isNaN(d.start)&&isNaN(d.count)||(e=function(a){var b=d.start||0,b=a.slice(b,b+(d.count||Infinity));b.total=a.length;return b});return function(a){return e(k(h(a)))}};var a=this;c.on("add,update,delete",function(b){var d=b.type,f=b.target;a.notify("add"===
d||"update"===d?f:void 0,"delete"===d||"update"===d?"id"in b?b.id:c.getIdentity(f):void 0)})},labelAttr:"title",getLabel:function(c){return this.store.getLabel(c)},query:function(c,a){a=a||{};var b=this.store.filter(c),d,f,g;if(g=a.sort)if("[object Array]"===Object.prototype.toString.call(g))for(var k;k=g.pop();)b=b.sort(k.attribute,k.descending);else b=b.sort(g);b.track&&!b.tracking&&(b=b.track(),f=!0);"start"in a&&(d=a.start||0,d=b[b.fetchRangeSync?"fetchRangeSync":"fetchRange"]({start:d,end:a.count?
d+a.count:Infinity}));d=d||b[b.fetchSync?"fetchSync":"fetch"]();g=d.totalLength;d=new n(d);d.total=g;d.observe=function(a,c){function d(a){return void 0===a&&f?-1:a}var k=b.on("add",function(b){a(b.target,-1,d(b.index))}),g=b.on("update",function(b){!c&&b.previousIndex===b.index&&isFinite(b.index)||a(b.target,d(b.previousIndex),d(b.index))}),h=b.on("delete",function(b){a(b.target,d(b.previousIndex),-1)}),m={remove:function(){k.remove();g.remove();h.remove()}};m.cancel=m.remove;return m};return d},
notify:function(){}};p.forEach(["get","put","add","remove","getIdentity"],function(c){d[c]=function(){var a=this.store;return(a[c+"Sync"]||a[c]).apply(a,arguments)}});return h(null,d)})},"xblox/model/logic/IfBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/Statement xblox/model/logic/ElseIfBlock dojo/Deferred xide/utils".split(" "),function(h,p,n,g,d,c){return h(p,{declaredClass:"xblox.model.logic.IfBlock",condition:"Invalid Expression",consequent:null,elseIfBlocks:null,alternate:null,
canAdd:function(){return[]},autoCreateElse:!0,name:"if",icon:"",add:function(a,b,c){null==c&&(c="consequent");return this._add(a,b,c,!1)},__addToStore:function(a){a.put(this)},mayHaveChildren:function(a){return null!==this.items&&this.items.length||null!==this.elseIfBlocks&&this.elseIfBlocks.length||null!=this.consequent&&this.consequent.length||null!=this.alternate&&this.alternate.length},getChildren:function(a){a=[];this.consequent&&(a=a.concat(this.consequent));this.elseIfBlocks&&(a=a.concat(this.elseIfBlocks));
this.alternate&&(a=a.concat(this.alternate));return a},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon("E")+this.name+" \x3c/span\x3e\x3cspan class\x3d'text-warning small'\x3e"+this.condition+"\x3cspan\x3e"},_checkCondition:function(a){return a.parseExpression(this.condition,null,null)},solve:function(a,b){var c=this._checkCondition(a),d=this.getElseIfBlocks(),h=this.childrenByNotClass(g),k=null,h=h.filter(function(a){return!a.isInstanceOf(n)});if(1==c||0<c){this.onSuccess(this,
b);if(h&&h.length)for(d=0;d<h.length;d++)k=h[d].solve(a,b);return k}k=!1;this.onFailed(this,b);if(d)for(h=0;h<d.length&&!k;h++){c=d[h];if(c._checkCondition(a))return c.onSuccess(c,b),k=!0,c.solve(a,b);c.onFailed(c,b)}h=this.childrenByClass(n);if(0<h.length&&!k){k=null;for(d=0;d<h.length;d++)k=h[d].solve(a,b);return k}return[]},empty:function(a){this._empty(this.alternate);this._empty(this.consequent);this._empty(this.elseIfBlocks)},removeBlock:function(a){a&&(a&&a.empty&&a.empty(),delete a.items,
a.parent=null,this.alternate.remove(a),this.consequent.remove(a),this.elseIfBlocks.remove(a))},_getContainer:function(a){return-1!=this.consequent.indexOf(a)?"consequent":-1!=this.alternate.indexOf(a)?"alternate":-1!=this.elseIfBlocks.indexOf(a)?"elseIfBlocks":"_"},init:function(){this.alternate=this.alternate||[];this.consequent=this.consequent||[];this.elseIfBlocks=this.elseIfBlocks||[];for(var a=0;a<this.alternate.length;a++)this.alternate[a].parentId=this.id,this.alternate[a].parent=this;for(a=
0;a<this.elseIfBlocks.length;a++)this.elseIfBlocks[a].parentId=this.id,this.elseIfBlocks[a].parent=this;for(a=0;a<this.consequent.length;a++)this.consequent[a].parentId=this.id,this.consequent[a].parent=this},getFields:function(){var a=this,b=this.inherited(arguments)||this.getDefaultFields();b.push(this.utils.createCI("condition",this.types.ECIType.EXPRESSION_EDITOR,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(b,c,d){return a.scope.expressionModel.parse(a.scope,
b,!1,c,d)}}}));return b},postCreate:function(){this._postCreated||(this._postCreated=!0)},toCode:function(a,b){},getElseIfBlocks:function(){return this.childrenByClass(g)},runAction:function(a){var b=this.scope.blockStore;a=a.command;if("New/Else"===a||"New/Else If"===a){a="New/Else If"===a?g:n;var h=c.mixin({name:"else",items:[],dstField:"alternate",parentId:this.id,parent:this,scope:this.scope,canAdd:function(){return[]},canEdit:function(){return!1}},a==g?{name:"else if",dstField:"elseIfBlocks"}:
{name:"else",dstField:"alternate"});a=this.add(a,h,a==n?"alternate":"elseIfBlocks");var h={select:[a],focus:!0,append:!1,expand:!0,delay:10},f=new d;b._emit("added",{target:a});f.resolve(h);a.refresh();return f}},getActions:function(){var a=[];0==this.alternate.length&&a.push(this.createAction({label:"Else",command:"New/Else",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0}}));a.push(this.createAction({label:"Else If",command:"New/Else If",icon:this.getBlockIcon("I"),
tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0}}));return a}})})},"xblox/model/Statement":function(){define(["dcl/dcl","xblox/model/Block"],function(h,p){return h(p,{declaredClass:"xblox.model.Statement",toText:function(){return this.name},getChildren:function(){return this.items}})})},"xblox/model/logic/ElseIfBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/Contains"],function(h,p,n){return h([p,n],{declaredClass:"xblox.model.logic.ElseIfBlock",condition:"",consequent:null,
name:"else if",icon:"",solve:function(g,d){return this._checkCondition(g)?this._solve(g,d):!1},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon("E")+this.name+" \x3c/span\x3e\x3cspan class\x3d'text-warning small'\x3e"+(this.condition||"")+"\x3cspan\x3e"},_checkCondition:function(g){return null!==this.condition?g.parseExpression(this.condition):!1},getFields:function(){var g=this,d=this.inherited(arguments)||this.getDefaultFields();d.push(this.utils.createCI("condition",
this.types.ECIType.EXPRESSION_EDITOR,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(c,a,b){return g.scope.expressionModel.parse(g.scope,c,!1,a,b)}}}));return d}})})},"xblox/model/logic/SwitchBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/logic/CaseBlock","xblox/model/logic/DefaultBlock","dojo/Deferred"],function(h,p,n,g,d){return h(p,{declaredClass:"xblox.model.logic.SwitchBlock",items:null,name:"Switch",icon:null,toText:function(){return this.getBlockIcon("H")+
this.name+" "},canAdd:function(){return[]},getFields:function(){return this.getDefaultFields(!1,!1)},solve:function(c,a){var b=this._stopped=!1,d=[];this.onSuccess(this,a);for(var f=0;f<this.items.length;f++){var g=this.items[f];if("xblox.model.logic.CaseBlock"===g.declaredClass&&(g=g.solve(c,this,a),0!=g)){b=!0;this.addToEnd(d,g);break}if(this._stopped)break}if(!b)for(f=0;f<this.items.length;f++)g=this.items[f],"xblox.model.logic.CaseBlock"!=g.declaredClass&&this.addToEnd(d,g.solve(c,a));return d},
init:function(){},getChildren:function(c){return this.items},stop:function(){this._stopped=!0},runAction:function(c){var a=c.command;if("New/Case"===a||"New/Default"===c.command){c=this.scope.blockStore;var b=new d,h=null;switch(a){case "New/Case":h=this.add(n,{comparator:"\x3d\x3d",expression:"on",group:null});break;case "New/Default":h=this.add(g,{group:null})}b.resolve({select:[h],focus:!0,append:!1});h.refresh();c._emit("added",{target:h})}},getActions:function(c,a){var b=[this.createAction({label:"New Case",
command:"New/Case",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}})];_.find(this.items,{declaredClass:"xblox.model.logic.DefaultBlock"})||b.push(this.createAction({label:"Default",command:"New/Default",icon:"fa-eject",tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}}));return b}})})},"xblox/model/logic/DefaultBlock":function(){define(["dcl/dcl","xide/utils","xide/types","xblox/model/Block"],function(h,p,n,g){return h(g,{declaredClass:"xblox.model.logic.DefaultBlock",
name:"Default",icon:"",hasInlineEdits:!1,toText:function(){return'\x26nbsp;\x3cspan class\x3d"fa-eject text-info"\x3e\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan\x3e'+this.name+"\x3c/span\x3e"},solve:function(d,c){this.onSuccess(this,c);return this._solve(d,c)},getFields:function(){return this.inherited(arguments)||this.getDefaultFields()}})})},"xblox/model/variables/VariableSwitch":function(){define("dcl/dcl xblox/model/logic/SwitchBlock xide/types xblox/model/logic/CaseBlock xblox/model/logic/DefaultBlock dojo/Deferred".split(" "),
function(h,p,n,g,d,c){return h(p,{declaredClass:"xblox.model.variables.VariableSwitch",name:"Switch on Variable",icon:"",variable:"PowerState",toText:function(){var a=this.scope.getVariableById(this.variable),a=a?a.name:"";return this.getBlockIcon("H")+this.name+" "+a},getFields:function(){var a=this.getDefaultFields(!1,!1);return a=a.concat([this.utils.createCI("Variable",3,this.variable,{group:"General",widget:{store:this.scope.blockStore,labelField:"name",valueField:"id",query:[{group:"basicVariables"},
{group:"processVariables"}]},dst:"variable"})])}})})},"xblox/model/logging/Log":function(){define("dcl/dcl dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin".split(" "),function(h,p,n,g,d,c){return h([n,c.dcl],{declaredClass:"xblox.model.logging.Log",name:"Log Message",level:"info",message:'return "Message: " + arguments[0];',_type:"XBlox",host:"this host",sharable:!0,toText:function(){var a="text-primary";switch(this.level){case "info":a="text-info";break;case "warn":a=
"text-warning";break;case "error":a="text-danger"}a=this.getBlockIcon()+" "+this.name+" : \x3cspan class\x3d'"+a+" small'\x3e  :: ";this.message&&(a+=this.message);return a+"\x3c/span\x3e"},_solveExpression:function(a,b,c,d,h){if((a=""+a)&&a.length){a=g.convertAllEscapes(a,"none");var k=this.getArgs();try{var e=b.parseExpression(a,null,null,null,null,this,k);d&&d("Expression "+a+" evaluates to "+e);return e}catch(n){h&&h("invalid expression : \n"+a+": "+n),this.onFailed(this,c)}}else console.error("have no script");
return a},solve:function(a,b,c,f){console.log("-log");var g=new p,k=a.device;a=this._solveExpression(this.message,a,b,c,f);k={message:a,level:this.level,type:this._type,details:this.getArgs(),time:(new Date).getTime(),data:{device:k?k.info:null},write:!0};this.onSuccess(this,b);g.resolve(a);try{this.publish(d.EVENTS.ON_SERVER_LOG_MESSAGE,k)}catch(e){this.onFailed(this,b)}return g},canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),b=this;a.push(g.createCI("Level",
3,this.level,{group:"General",options:[{value:"info",label:"Info"},{value:"warn",label:"Warning"},{value:"error",label:"Error"},{value:"debug",label:"Debug"},{value:"help",label:"Help"},{value:"verbose",label:"verbose"},{value:"silly",label:"Silly"}],dst:"level"}));a.push(g.createCI("message",25,this.message,{group:"General",title:"Message",dst:"message",delegate:{runExpression:function(a,c,d){b._solveExpression(a,b.scope,null,c,d)}}}));a.push(g.createCI("message",13,this._type,{group:"General",title:"Type",
dst:"_type"}));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bug"\x3e\x3c/span\x3e'}})})},"xblox/model/server/RunServerMethod":function(){define(["dcl/dcl","xblox/model/server/ServerBlock","xide/utils"],function(h,p,n){return h(p,{declaredClass:"xblox.model.server.RunServerMethod",description:"Runs a JSON-RPC-2.0 method on the server",name:"Run Server Method",method:"XShell::run",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onMethodChanged:function(g,
d){this.method=g;if(!n.isValidString(this.args)){var c=this.getServerParams();c&&this._updateArgs(c,d)}},_getArgs:function(){var g=n.getJson(this.args||"[]"),d=[];if(g){var c=!1;g&&g[0]&&null!=g[0].optional&&(c=!0);if(c)for(c=0;c<g.length;c++){var a=g[c],b=a.value;-1!=a.name.indexOf("Base64")&&(b=this.getService().base64_encode(b));"notset"!==a.value?-1!=a.value.indexOf("[")&&-1!=a.value.indexOf("]")?(b=this.scope.expressionModel.replaceVariables(this.scope,a.value,!1,!1),-1!=a.name.indexOf("Base64")&&
(b=this.getService().base64_encode(b)),d.push(b)):d.push(b||a["default"]):d.push(a["default"]||b)}}else return[this.args];return d},_updateArgs:function(g,d){var c=this.utils.getCIWidgetByName(d,"args");if(c){var a=JSON.stringify(g);c.editBox.set("value",a);this.args=a}},getServerParams:function(){var g=this.getService().getParameterMap(this.getServiceClass(),this.getServiceMethod());if(g)for(var d=0;d<g.length;d++)g[d].value="notset";return g},onReloaded:function(g){console.log("sdfsd");this._solve()},
_solve:function(g,d,c,a){console.log("solve223")},solve:function(g,d,c,a){this._return=[];this._lastResult=null;g=[];if(!this.isInValidState())return this.onFailed(this,d),g;g=this._getArgs();this.onRun(this,d);this.getService();d=this.scope.serviceObject;console.error("run deferred");(d=d.runDeferred(this.getServiceClass(),this.getServiceMethod(),g))&&d.then(function(a){console.error("returned ",a)});return d},toText:function(){var g=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(g+=this.method.substr(0,
50));return g},canAdd:function(){return[]},getFields:function(){var g=this.inherited(arguments)||this.getDefaultFields(),d=this;g.push(n.createCI("value",25,this.method,{group:"General",title:"Method",dst:"method",description:"This should be in the format : MyServerClass::myMethod",delegate:{runExpression:function(c,a,b){d.method=c;d.solve(d.scope,null,a,b)}}}));return g=g.concat(this.getServerDefaultFields())},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(g){return null!=
this.items&&0<this.items.length},getChildren:function(g){return this.items},onChangeField:function(g,d,c){if("method"===g)this.onMethodChanged(d,c)},isInValidState:function(){return null!=this.getService()},getService:function(){var g=this.scope.getService();g||console.error("have no service object");return g},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(g){return this.isInValidState()&&
null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(g){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/server/ServerBlock":function(){define(["dcl/dcl","xblox/model/Block","xide/utils"],
function(h,p,n){return h(p,{declaredClass:"xblox.model.server.ServerBlock",name:"Run Server Block",method:"XShell::run",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onReloaded:function(){console.log("1")},solve:function(g,d,c,a){this._currentIndex=0;this._return=[];if((g=""+this.method)&&g.length){var b=new Function("{"+g+"}"),h=this.getArgs();try{var f=b.apply(this,h||{});this._lastResult=f;c&&c("Expression "+g+" evaluates to "+f);if("false"!==f&&!1!==f)this.onSuccess(this,
d);else return this.onFailed(this,d),[]}catch(m){return a&&a("invalid expression : \n"+g+": "+m),this.onFailed(this,d),[]}}else console.error("have no script");c=this[this._getContainer()];if(c.length)this.runFrom(c,0,d);else this.onSuccess(this,d);return[]},toText:function(){var g=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(g+=this.method.substr(0,50));return g},canAdd:function(){return[]},getServerDefaultFields:function(g){g=g||[];g.push(n.createCI("args",27,this.args,{group:"General",
title:"Arguments",dst:"args"}));return g},getFields:function(){return this.inherited(arguments)||this.getDefaultFields()},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(g){return null!=this.items&&0<this.items.length},getChildren:function(g){return this.items},isInValidState:function(){return null!=this.getService()},getService:function(){return this.scope.getService()},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},
getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(g){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(g){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:
null}})})},"xblox/model/server/Shell":function(){define(["dcl/dcl","xblox/model/server/ServerBlock","xide/utils","xcf/model/Command"],function(h,p,n,g){return h([g,p],{declaredClass:"xblox.model.server.Shell",description:"Runs a JSON-RPC-2.0 method on the server",name:"Run Shell",method:"",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onMethodChanged:function(d,c){this.method=d;if(!n.isValidString(this.args)){var a=this.getServerParams();a&&this._updateArgs(a,
c)}},_getArgs:function(){var d=n.getJson(this.args||"[]"),c=[];if(d){var a=!1;d&&d[0]&&null!=d[0].optional&&(a=!0);if(a)for(a=0;a<d.length;a++){var b=d[a],g=b.value;-1!=b.name.indexOf("Base64")&&(g=this.getService().base64_encode(g));"notset"!==b.value?-1!=b.value.indexOf("[")&&-1!=b.value.indexOf("]")?(g=this.scope.expressionModel.replaceVariables(this.scope,b.value,!1,!1),-1!=b.name.indexOf("Base64")&&(g=this.getService().base64_encode(g)),c.push(g)):c.push(g||b["default"]):c.push(b["default"]||
g)}}else return[this.args];return c},_updateArgs:function(d,c){var a=this.utils.getCIWidgetByName(c,"args");if(a){var b=JSON.stringify(d);a.editBox.set("value",b);this.args=b}},getServerParams:function(){var d=this.getService().getParameterMap(this.getServiceClass(),this.getServiceMethod());if(d)for(var c=0;c<d.length;c++)d[c].value="notset";return d},onReloaded:function(d){console.log("sdfsd");this._solve()},_solve:function(d,c,a,b){console.log("solve223")},solve:function(d,c,a,b,g,f){this._return=
[];this._lastResult=null;this._lastSettings=c||this._lastSettings;c=this.getInstance();console.log("run");d=d.expressionModel.replaceVariables(d,this.method,!1,!1);c.runShell(d,n.mixin({},{}),this.id,this.id,this)},toText:function(){var d=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(d+=this.method.substr(0,50));return d},canAdd:function(){return[]},getFields:function(){var d=this.inherited(arguments)||this.getDefaultFields(),c=this;d.push(n.createCI("value",25,this.method,{group:"General",
title:"Cmd",dst:"method",delegate:{runExpression:function(a,b,d){c.method=a;c.solve(c.scope,null,b,d)}}}));return d},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(d){return null!=this.items&&0<this.items.length},getChildren:function(d){return this.items},onChangeField:function(d,c,a){if("method"===d)this.onMethodChanged(c,a)},isInValidState:function(){return null!=this.getService()},getService:function(){var d=this.scope.getService();d||console.error("have no service object");
return d},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(d){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(d){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&
this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/code/RunBlock":function(){define(["dcl/dcl","xblox/model/Block","xide/types","xide/utils"],function(h,p,n,g){return h(p,{declaredClass:"xblox.model.code.RunBlock",name:"Run Block",file:"",method:"",args:"",sharable:!0,block:"",description:"Runs another Block",solve:function(d,c){var a=this.getContext();if(a&&null!=a[this.method]){var b=[],g=a[this.method];try{var f=
this._getArgs(),b=g.apply(a,f||[]);this.onSuccess(this,c);return b}catch(h){console.error("call method failed"),this.onFailed(this,c)}}else this.onFailed(this,c);return[]},toText:function(){var d=this.getBlockIcon()+" "+this.name+" ";this.method&&(d+=this.method.substr(0,20));return d},getFields:function(){var d=this.getDefaultFields();d.push(g.createCI("Block",n.ECIType.BLOCK_REFERENCE,this.block,{toolTip:"Enter  block, you can use also the block's share title",group:"General",dst:"block",value:this.block,
title:"Block",scope:this.scope}));d.push(g.createCI("File",n.ECIType.FILE,this.file,{toolTip:"Leave empty to auto-select this file",group:"General",dst:"file",value:this.file,intermediateChanges:!1,acceptFolders:!1,acceptFiles:!0,encodeFilePath:!1,buildFullPath:!0,filePickerOptions:{dialogTitle:"Select Block File",filePickerMixin:{beanContextName:this.id,persistent:!1,globalPanelMixin:{allowLayoutCookies:!1}},configMixin:{beanContextName:this.id,LAYOUT_PRESET:n.LAYOUT_PRESET.SINGLE,PANEL_OPTIONS:{ALLOW_MAIN_MENU:!1,
ALLOW_NEW_TABS:!0,ALLOW_MULTI_TAB:!1,ALLOW_INFO_VIEW:!0,ALLOW_LOG_VIEW:!1,ALLOW_CONTEXT_MENU:!0,ALLOW_LAYOUT_SELECTOR:!0,ALLOW_SOURCE_SELECTOR:!0,ALLOW_COLUMN_RESIZE:!0,ALLOW_COLUMN_REORDER:!0,ALLOW_COLUMN_HIDE:!0,ALLOW_ACTION_TOOLBAR:!0,ALLOW_BREADCRUMBS:!1}},defaultStoreOptions:{fields:1663,includeList:"xblox",excludeList:"*"},startPath:this.file}}));return d},getBlockIcon:function(){return'\x3cspan class\x3d"el-icon-share-alt"\x3e\x3c/span\x3e'}})})},"xblox/model/events/OnEvent":function(){define("dcl/dcl dojo/_base/lang dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xide/registry dojo/on xwire/_Base".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m){return h([g,a.dcl,b.dcl,m],{declaredClass:"xblox.model.events.OnEvent",name:"On Event",event:"",reference:"",references:null,sharable:!0,_didSubscribe:!1,filterPath:"item.name",filterValue:"",valuePath:"item.value",_nativeEvents:"onclick ondblclick onmousedown onmouseup onmouseover onmousemove onmouseout onkeypress onkeydown onkeyup onfocus onblur onchange".split(" "),stop:function(){this._destroy()},solve:function(a,b,c,d){c&&this._destroy();b=this._lastSettings=b||
this._lastSettings;if(!this._didSubscribe)return this._registerEvent(this.event),this.onSuccess(this,b),!1;this.onSuccess(this,b);this._currentIndex=0;this._return=[];a=this[this._getContainer()];if(a.length)return a=this.runFrom(a,0,b),this.onSuccess(this,b),a;this.onSuccess(this,b);return[]},toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();
this.deserialize(this.reference);var b=null;if(-1<d.contains(this._nativeEvents,this.event))for(var b=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",
value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],f=0;f<b.length;f++){var g=b[f];if(g.value===this.event){g.selected=!0;break}}else b=this.scope.getEventsAsOptions(this.event);a.push(d.createCI("Event",c.ECIType.ENUMERATION,this.event,{group:"General",options:b,dst:"event",widget:{search:!0}}));a.push(d.createCI("Filter Path",13,this.filterPath,{group:"General",dst:"filterPath"}));a.push(d.createCI("Filter Value",13,this.filterValue,{group:"General",dst:"filterValue"}));
a.push(d.createCI("Value Path",13,this.valuePath,{group:"General",dst:"valuePath"}));a.push(d.createCI("Object/Widget",c.ECIType.WIDGET_REFERENCE,this.reference,{group:"Widget",dst:"reference",value:this.reference}));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bell"\x3e\x3c/span\x3e'},onEvent:function(a){this._lastResult=a;if(this.filterPath&&this.filterValue){var b=this.getValue(a,this.filterPath);if(b&&this.filterValue!==b)return}b=null;this.valuePath&&(this._lastSettings||(this._lastSettings=
{}),b=this.getValue(a,this.valuePath),null!==b&&(!this._lastSettings.override&&(this._lastSettings.override={}),this._lastSettings.override.args=[b]));this.solve(this.scope,this._lastSettings)},_subscribe:function(a,b,c){if(a)if(-1==d.contains(this._nativeEvents,a))this.__events&&this.__events[a]&&(c=this.__events[a],_.each(c,function(a){this.unsubscribe(a.type,a.handler);a.remove()},this),_.each(c,function(b){this.__events[a].remove(b)},this)),this.subscribe(a,this.onEvent);else if(c){b=a.replace("on",
"");var g=this;c=f(c,b,function(a){g.onEvent(a)});console.log("wire native event : "+b);this._events.push(c)}},_registerEvent:function(a){try{if(!a||!a.length)return;console.log("register event : "+a+" for "+this.reference);var b=this.resolveReference(this.deserialize(this.reference)),c=this;if(b&&b.length){for(var d=0;d<b.length;d++){var f=b[d];if(f&&f.id){var g=r.byId(f.id);if(g&&g.on){var h=this.event.replace("on","");console.log("found widget : "+f.id+" will register event "+h);var m=g.on(h,p.hitch(this,
function(a){console.log("event triggered : "+c.event);c.onEvent(a)}));this._events.push(m)}else this._subscribe(a,this.onEvent,f)}else this._subscribe(a,this.onEvent,f)}console.log("objects found : ",b)}else this._subscribe(a,this.onEvent)}catch(n){logError(n,"registering event failed")}this._didSubscribe=a},onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},updateEventSelector:function(a,b){var d=[];if(a&&a.length)for(var d=[{label:"onclick",
value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],f=0;f<d.length;f++){var g=
d[f];if(g.value===this.event){g.selected=!0;break}}else d=this.scope.getEventsAsOptions(this.event);for(f=0;f<b.length;f++)if(g=b[f],g.widget&&"Event"===g.widget.title){f=g._widget;f.nativeWidget.set("options",d);f.nativeWidget.reset();f.nativeWidget.set("value",this.event);this.publish(c.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this._destroy();this.reference=a;var c=this.resolveReference(this.deserialize(a));this.updateEventSelector(c,b);this._registerEvent(this.event)},onChangeField:function(a,
b,c){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=b,this._registerEvent(b)));if("reference"==a)this.onReferenceChanged(b,c);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){this._events||(this._events=[]);_.each(this._events,dojo.unsubscribe);this.unsubscribe(this.event,this.onEvent);this._lastResult=null;this._didSubscribe=!1}})})},"xblox/model/Referenced":function(){define(["dcl/dcl",
"dojo/_base/declare","xide/mixins/ReferenceMixin","xide/utils"],function(h,p,n,g){var d={reference:null,deserialize:function(c){if(!c||0==c.length)return{};try{return g.fromJson(c)}catch(a){return{}}}};p=p("xblox.model.Referenced",[n],d);p.dcl=h(n.dcl,d);return p})},"xide/mixins/ReferenceMixin":function(){define(["dcl/dcl","dojo/_base/declare","xide/types","xide/utils","xide/registry"],function(h,p,n,g,d){function c(a,c){var d=a.document.getElementById(c);return d?d:null}g.find=function(a,c,d){return(a=
$(c).find(a))&&0<a.length?!1===d?a:a[0]:null};var a={_targetReference:null,getTarget:function(){return this._targetReference||this.inherited(arguments)},skipWidgetCSSClasses:"dijitButtonHover dijitHover dijit dijitInline dijitReset dijitCheckBoxChecked dijitChecked dijitLeft".split(" "),_cssClassesToQuery:function(a){var c="";if(a){a=a.split(" ");for(var d=0;d<a.length;d++)-1<g.contains(this.skipWidgetCSSClasses,a[d])||-1<a[d].toLowerCase().indexOf("hover")||(c+=""+a[d])}return c.trim()},resolveReference:function(a,
p){var f=null;try{f=this.getTarget()}catch(m){return logError(m),null}var k=this.scope,e=a.reference;if(!(a&&e&&e.length)&&f)return[f];switch(a.mode){case n.WIDGET_REFERENCE_MODE.BY_ID:if(this.scope&&this.scope.document){f=[];if(-1!==e.indexOf(" "))for(var e=e.split(" "),q=0;q<e.length;q++){var l=c(k,e[q]);l&&f.push(l)}else return[c(k,e)];return f}k=d.byId(e);f="undefined"!==typeof document?document.getElementById(e):null;if(k||f)return k?[k]:[f];break;case n.WIDGET_REFERENCE_MODE.BY_CLASS:if(k=dojo.getObject(e)||
h.getObject(e))return[k];break;case n.WIDGET_REFERENCE_MODE.BY_CSS:k=this._cssClassesToQuery(e);this._parseString&&(k=this._parseString(k,p,null,p&&p.flags?p.flags:n.CIFLAG.EXPRESSION)||k);f=null;this.scope&&this.scope.global&&this.scope.global.$?f=this.scope.global.$:"undefined"!==typeof $&&(f=$);if(f&&(f=f(k)))return f;if(k=g.find(k,null,!1))return k}return null}};p=p("xblox.model.ReferenceMixin",null,a);p.dcl=h(null,a);return p})},"xwire/_Base":function(){define(["dcl/dcl","xide/mixins/EventedMixin"],
function(h,p){function n(d,c){for(var a=g(c),b=0,h=a.length;b<h;++b){var f=a[b];d=null==d?d:d[f]}return d}function g(d,c){return""===d?[]:"function"!==typeof d.splice?d.split("."):c?d.slice():d}return h([p.dcl],{declaredClass:"xwire._Base",constructor:function(d){for(var c in d)d.hasOwnProperty(c)&&(this[c]=d[c])},getValue:function(d,c){return n(d,c)},setValue:function(d,c,a){var b=g(c,!0),h=b.pop();d=0<b.length?n(d,b):d;return Object(d)===d&&c?"function"===typeof d.set?d.set(h,a):d[h]=a:void 0}})})},
"xblox/model/events/OnKey":function(){define("dcl/dcl dojo/_base/lang dojo/_base/array dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xblox/model/Contains xblox/model/events/OnEvent xide/registry dojo/on".split(" "),function(h,p,n,g,d,c,a,b,r,f,m,k,e){return h([d,b.dcl,r.dcl,f],{declaredClass:"xblox.model.events.OnKey",name:"On Key",event:"",reference:"",references:null,description:"Triggers when a keyboard sequence "+this.event+" has been entered",
listeners:null,sharable:!0,toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();b.push(c.createCI("Keyboard Sequence",a.ECIType.STRING,this.event,{group:"General",dst:"event",value:this.event,intermediateChanges:!1}));b.push(c.createCI("Object/Widget",a.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",value:this.reference}));
return b},getBlockIcon:function(){return'\x3cspan class\x3d"fa-keyboard-o"\x3e\x3c/span\x3e'},onEvent:function(a){this._lastResult=a;this.solve(this.scope,this._lastRunSettings)},_addListerner:function(a,b,c){null==this.listeners&&(this.listeners=[]);var d=null,d=new window.keypress.Listener(c,{is_unordered:!0,prevent_repeat:!1,prevent_default:!1,on_keyup:function(a){console.log("up")},on_keydown:function(a){console.log("down")},on_release:function(a){console.log("release")}});d.simple_combo(a,function(a){b&&
b(arguments)});this.listeners.push(d)},_subscribe:function(a,b,c){a&&(c&&c.domNode&&(c=c.domNode),this._addListerner(a,b,c))},_registerEvent:function(a){if(a&&a.length){var b=this.resolveReference(this.deserialize(this.reference)),c=this;if(b&&b.length)for(var d=0;d<b.length;d++){var e=b[d];if(e&&e.id){var f=k.byId(e.id);f=null,this._subscribe(a,function(){c.onEvent(arguments)},e)}else this._subscribe(a,function(){c.onEvent(arguments)},e)}else this._subscribe(a,function(){c.onEvent(arguments)})}},
onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},destroy:function(){this.inherited(arguments)},updateEventSelector:function(b,c){var d=[];if(b&&b.length)for(var d=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},
{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],e=0;e<d.length;e++){var f=d[e];if(f.value===this.event){f.selected=!0;break}}else d=this.scope.getEventsAsOptions(this.event);for(e=0;e<c.length;e++)if(f=c[e],f.widget&&"Event"===f.widget.title){e=f._widget;e.nativeWidget.set("options",d);e.nativeWidget.reset();e.nativeWidget.set("value",
this.event);this.publish(a.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this._destroy();this.reference=a;this.resolveReference(this.deserialize(a));this._registerEvent(this.event)},onChangeField:function(a,b,c){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=b,this._registerEvent(b)));if("reference"==a)this.onReferenceChanged(b,c);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){if(this.listeners)for(var a=
0;a<this.listeners.length;a++){var b=this.listeners[a];b.stop_listening();var c=b.get_registered_combos();c&&b.unregister_many(c);b.reset();console.log("did destroy listener")}this.listeners=[]},onFieldsRendered:function(a,b){}})})},"xblox/model/mqtt/Subscribe":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains xide/types".split(" "),function(h,p,n,g,d,c,a,b,r){p="undefined"!==typeof window?window.console:global.console;b&&p&&p.error&&(p=r);return h([g,
c],{declaredClass:"xblox.model.mqtt.Subscribe",name:"Subscribe",topic:"Topic",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-bell",path:"",qos:0,stop:function(){var a=this.getInstance();a&&a.callMethod("unSubscribeTopic",d.mixin({topic:this.topic},d.getJson(this.args)),this.id,this.id)},onData:function(a){if(a&&a.topic&&a.topic==this.topic){delete a.src;delete a.id;this.getContext();var b=this[this._getContainer()],c=this._lastSettings,e=[];if(0<b.length){var b=a,g=this.path&&this.path.length?
this.path:null!==a.payload?"payload":null;g&&_.isObject(a)&&(b=d.getAt(a,g,a));for(a=0;a<this.items.length;a++)g=this.items[a],g.enabled&&(g.override={args:[b]},e.push(g.solve(this.scope,c)))}this.onSuccess(this,this._lastSettings);return e}},observed:["topic"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve:function(a,b,c,e,g,h){this._currentIndex=0;this._return=[];this._lastSettings=b;(a=this.getInstance())&&a.callMethod("subscribeTopic",d.mixin({topic:this.topic,
qos:this.qos},d.getJson(this.args||"{}")),this.id,this.id);b=b||{};this.onRunThis(b)},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+""+this.makeEditable("topic","bottom","text","Enter a topic","inline")+" :: \x3c/span\x3e";this.topic&&(a+=this.topic.substr(0,30));return a},canAdd:function(){return[]},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();b.push(d.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));b.push(d.createCI("arguments",
27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));b.push(d.createCI("topic",a.ECIType.STRING,this.topic,{group:"General",title:"Topic",dst:"topic",select:!0}));b.push(d.createCI("name",a.ECIType.ENUMERATION,this.qos,{group:"General",title:"QOS",dst:"qos",widget:{options:[{label:"0 - at most once",value:0},{label:"1 - at least once",value:1},{label:"2 - exactly once",value:2}]}}));b.push(d.createCI("path",a.ECIType.STRING,this.path,{group:"General",title:"Value Path",dst:"path"}));return b}})})},
"xblox/model/mqtt/Publish":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains xide/types xcf/model/Command".split(" "),function(h,p,n,g,d,c,a,b,r,f){p="undefined"!==typeof window?window.console:global.console;r&&p&&p.error&&(p=f);return h(b,{declaredClass:"xblox.model.mqtt.Publish",name:"Publish",topic:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-send",isCommand:!0,qos:0,retain:!1,path:null,onData:function(a){if(a&&a.topic&&a.topic==this.topic){this.getContext();
var b=this[this._getContainer()],c=this._lastSettings,f=[];if(0<b.length)for(b=a,(this.path="value",_.isObject(a))&&(b=d.getAt(a,this.path,a)),a=0;a<this.items.length;a++){var g=this.items[a];g.enabled&&(g.override={args:[b]},f.push(g.solve(this.scope,c)))}this.onSuccess(this,this._lastSettings);return f}},observed:["topic"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve:function(a,b,c,f,g,h){this._currentIndex=0;this._return=[];b=this._lastSettings=
b||this._lastSettings;f=this.getInstance();1==c&&this._loop&&this.reset();c=this.args;g=this.getArgs(b);g[0]&&(c=g[0]);f&&(c=d.getJson(c,!0,!1),null!==c&&0!==c&&!0!==c&&!1!==c&&_.isObject(c)||(c={payload:this.args}),a=a.expressionModel.replaceVariables(a,this.topic,!1,!1),f.callMethod("publishTopic",d.mixin({topic:a,qos:this.qos,retain:this.retain},c),this.id,this.id));b=b||{};this.onDidRun();this.onSuccess(this,b);return!0},toText:function(a,b,c,d){a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+
" "+this.makeEditable("name","top","text","Enter a name","inline")+" :: \x3c/span\x3e";this.topic&&(a+=this.makeEditable("topic","bottom","text","Enter a topic","inline"),this.startup&&(a+=this.getIcon("fa-bell inline-icon text-warning","text-align:right;float:right;","")),0<this.interval&&(a+=this.getIcon("fa-clock-o inline-icon text-warning","text-align:right;float:right","")));return a},canAdd:function(){return[]},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();b.push(d.createCI("qos",
a.ECIType.ENUMERATION,this.qos,{group:"General",title:"QOS",dst:"qos",widget:{options:[{label:"0 - at most once",value:0},{label:"1 - at least once",value:1},{label:"2 - exactly once",value:2}]}}));b.push(d.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));b.push(d.createCI("topic",a.ECIType.STRING,this.topic,{group:"General",title:"Topic",dst:"topic",select:!0}));b.push(d.createCI("retain",a.ECIType.BOOL,this.retain,{group:"General",title:"Retain",dst:"retain"}));
b.remove(_.find(b,{name:"send"}));b.remove(_.find(b,{name:"waitForResponse"}));return b}})})},"xblox/model/File/ReadJSON":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains dojo/promise/all xide/types module xdojo/has!xblox-ui?xfile/data/DriverStore xdojo/has!xblox-ui?xfile/views/FileGridLight".split(" "),function(h,p,n,g,d,c,a,b,r,f,m){p("electronx");p("xcf-ui");p("php");return h([g,c],{declaredClass:"xblox.model.File.ReadJSON",name:"Read JSON",deferred:!1,
sharable:!1,context:null,icon:"fa-file",observed:["path"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},getFileContent:function(a){new n;var b=this.getScope().ctx;b.getFileManager();(b=b.getDeviceManager().getInstanceByName("File-Server"))||console.error("ReadJSON : have no file server driver");return b.callCommand("GetProg",{override:{args:[a]}})},processJSON:function(a,c){var f=this.jsonPath;this._lastResult=f?d.getAt(a,f):a;this.onSuccess(this,
c);this.runByType(b.BLOCK_OUTLET.FINISH,c)},solve:function(a,b,c,f,g){this._currentIndex=0;this._return=[];b=this._lastSettings=b||this._lastSettings||{};c=""+this._get("path");this.getContext();this._getContainer();var h=new n,m=this;this.onRunThis(b);a=a.expressionModel.replaceVariables(a,c,null,null);console.log("path "+a);this.getFileContent(a).then(function(a){(a=a.content)&&(a=d.getJson(a,!0))&&m.processJSON(a,b)});this.getArgs(b);try{f&&f("Expression "+c+" evaluates to "+a)}catch(p){p=p||{},
this.onDidRunItemError(h,p,b),this.onFailed(this,b),g&&g("invalid expression : \n"+c+": "+p)}return h},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.name+" :: \x3c/span\x3e";this.path&&(a+=this.path.substr(0,50));return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),c=this.getScope().ctx,g=c.getDeviceManager().getInstanceByName("File-Server"),h=d.clone(b.DEFAULT_FILE_GRID_PERMISSIONS),c={ctx:c,owner:this,
selection:"/",resizeToParent:!0,Module:m,permissions:h};if(g&&f){var h=function(a){return new f({data:[],config:n,mount:"none",options:p,driver:g,micromatch:"(*.json)|!(*.*)",glob:a})},n={},p={fields:b.FIELDS.SHOW_ISDIR|b.FIELDS.SHOW_OWNER|b.FIELDS.SHOW_SIZE|b.FIELDS.SHOW_FOLDER_SIZE|b.FIELDS.SHOW_MIME|b.FIELDS.SHOW_PERMISSIONS|b.FIELDS.SHOW_TIME|b.FIELDS.SHOW_MEDIA_INFO};c.leftStore=h("/*");c.rightStore=h("/*")}a.push(d.createCI("path",4,this.path,{group:"General",title:"Path",dst:"path",filePickerOptions:c,
widget:{item:this}}));a.push(d.createCI("jsonPath",13,this.jsonPath,{group:"General",title:"Select",dst:"jsonPath"}));return a}})})},"xcf/factory/Blocks":function(){define("xblox/factory/Blocks xcf/model/Command xblox/model/functions/CallBlock xblox/model/functions/StopBlock xblox/model/functions/PauseBlock xide/factory".split(" "),function(h,p,n,g,d,c){return h?(h._getCommandBlocks=function(a,b,c,f){var h=[];h.push({name:"Commands",iconClass:"el-icon-random",items:[{name:"Call Command",owner:b,iconClass:"el-icon-video",
proto:n,target:c,ctrArgs:{scope:a,group:f,condition:""}},{name:"Stop Command",owner:b,iconClass:"el-icon-video",proto:g,target:c,ctrArgs:{scope:a,group:f,condition:""}},{name:"Pause Command",owner:b,iconClass:"el-icon-video",proto:d,target:c,ctrArgs:{scope:a,group:f,condition:""}},{name:"New Command",owner:b,iconClass:"el-icon-video",proto:p,target:c,ctrArgs:{scope:a,group:f,condition:"",name:"No-Title"}}]});return h},h):c})},"nxapp/manager/TestManager":function(){define("dcl/dcl dojo/node!fs xcf/manager/DeviceManager xide/utils xide/types nxapp/utils/_console nxapp/utils dojo/node!child_process nxapp/manager/ManagerBase require xide/mixins/ReloadMixin dojo/node!path xdojo/has".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m,k,e){function q(){l.clear();f(["intern/lib/executors/PreExecutorEmbedded","intern/lib/reporters/Console"],function(a,b){var c=new a({executorId:"client",config:g.mixin(u,{suites:["tests/devices/all"]}),defaultLoaderOptions:dojoConfig});try{l.error("run tests"),c.run(function(a){l.error("did tests ",a)}),f.undef("tests/devices/all")}catch(d){l.error("error running tests ",d)}})}var l=c,u={proxyPort:9E3,proxyUrl:"http://localhost:9000/",tunnel:"NullTunnel",capabilities:{name:"dojo-loader",
project:"Dojo 2",fixSessionCapabilities:!1},environments:[{browserName:"internet explorer",version:["9.0","10.0","11.0"],platform:"Windows 7"},{browserName:"firefox",platform:"Windows 10"},{browserName:"chrome",platform:"Windows 10"},{browserName:"safari",version:"9",platform:"OS X 10.11"},{browserName:"android",platform:"Linux",version:"4.4",deviceName:"Google Nexus 7 HD Emulator"}],maxConcurrency:2,loaderOptions:{packages:[{name:"dojo",location:"./node_modules/dojo"},{name:"dijit",location:"dijit"},
{name:"dgrid",location:"dgrid"},{name:"dstore",location:"dstore"},{name:"xide",location:"xide"},{name:"xfile",location:"xfile"},{name:"dojox",location:"dojox"},{name:"xdojo",location:"xdojo"},{name:"xgrid",location:"xgrid"},{name:"xblox",location:"xblox"},{name:"xdocker",location:"xdocker"},{name:"wcDocker",location:"wcDocker/src"},{name:"dcl",location:"./node_modules/dcl"},{name:"tests",location:"tests"}]},excludeInstrumentation:/(?:node_modules|bower_components|tests)[\/\\]/,suites:["tests/all"],
functionalSuites:[],reporters:[{id:"tests/ConsoleEmbedded",delegate:{onStart:function(a){l.error("on start "+a.name)},onFail:function(a){l.error("on fail "+a.name)},onEnd:function(a){l.error("on start "+a.name)}}},{id:"JUnit",filename:"report.xml"}]};(p=global.sctx)&&p.getTestManager();return h([r,m.dcl],{declaredClass:"nxapp.manager.TestManager",connection:null,test1:function(){return"   ha"},loadFixtures:function(){k.resolve("./tests/")},onReloaded:function(){l.error("on reloaded")},doTests:function(){},
init:function(){this.subscribe(d.EVENTS.ON_MODULE_RELOADED,function(a){-1!==a.module.indexOf("tests/devices")&&a.module.indexOf(".js")&&(f.undef("tests/devices/Minimal"),q())})}})})},"nxappmain/main_export":function(){require("dojo/node!path dojo/node!fs dojo/node!util dojo/node!vm nxapp/Commons nxapp/Logger nxapp/utils/_console xide/utils nxappmain/nxAppExport nxapp/manager/ExportManager nxapp/model/ExportOptions xide/types require".split(" "),function(h,p,n,g,d,c,a,b,r,f,m,k,e){h=new r({commander:null});
h.init();h=h.profile;a.log("export "+h.user+" and system data:  "+h.system);new m(h);(new f).initWithOptions(h)})},"nxapp/Logger":function(){define(["dcl/dcl","xide/types","xide/factory","dojo/node!winston","nxapp/utils/_console"],function(h,p,n,g,d){return h(null,{declaredClass:"nxapp.Logger",fileLogger:null,loggly:null,delegate:null,publishLog:!1,loggers:{},constructor:function(c){for(var a in arguments)arguments.hasOwnProperty(a)&&(this[a]=c[a])},createLogger:function(c){var a=new g.Logger({transports:[new g.transports.File(c)]});
if(this.publishLog)a.on("logging",function(a,d,f,g){g.logId=c.filename;a={level:d,message:f,data:g,time:(new Date).getTime()};n.publish(p.EVENTS.ON_SERVER_LOG_MESSAGE,a)});return a},log:function(){return this.logger.log.apply(this.logger,arguments)},verbose:function(){return this.logger.verbose.apply(this.logger,arguments)},info:function(){return this.logger.info.apply(this.logger,arguments)},start:function(c){this.loggers={};this.options=c;this.logger=new g.Logger({transports:[new g.transports.Console({level:"debug"})]});
this.logger.transports.console.level="debug";this.logger.on("logging",function(a,b,c,d){})}})})},"nxappmain/nxAppExport":function(){define("dcl/dcl nxapp/utils/FileUtils dojo/node!commander dojo/node!fs dojo/node!os dojo/node!path xide/factory/Events dojo/has xide/model/Base xide/utils nxappmain/nxAppBase".split(" "),function(h,p,n,g,d,c,a,b,r,f,m){b.add("windows",function(){return"win32"===d.platform()});b.add("osx",function(){return"darwin"===d.platform()});b.add("linux",function(){return"linux"===
d.platform()});b.add("arm",function(){return"arm"===d.arch()});return h(m,{declaredClass:"nxappmain.nxAppExport",profilePath:"/nxappmain/profile_device_server.json",init:function(){this.commander||(n.version("0.0.1").option("-f, --file \x3cpath\x3e","run a file").option("-r, --root \x3cpath\x3e","root path to Control-Freak").option("-u, --user \x3cpath\x3e","user directory").option("-t, --target \x3cpath\x3e","target directory").option("-s, --system \x3cname\x3e","path to system scope location").option("-d, --dist \x3cpath\x3e",
"path to the pre-compiled NodeJS servers").option("--windows \x3cboolean\x3e","true/false to export windows NodeJS server").option("--osx \x3cboolean\x3e","true/false to export OSX NodeJS server").option("--linux32 \x3cboolean\x3e","true/false to export Linux-32 Bit NodeJS server").option("--linux64 \x3cboolean\x3e","true/false to export Linux-64 NodeJS server").option("--arm \x3cboolean\x3e","true/false to export ARM-v7 NodeJS server").option("--client \x3cstring\x3e","path to client root"),this.commander=
n,this.commander.allowUnknownOption(!0),this.commander.parse(process.argv));if(n.jhelp){var a=[];n.options.map(function(b){a.push(b)});console.log(JSON.stringify(a));process.exit()}this.profile=this.getProfile(this.profilePath);n.root||(this.profile.root=p.resolve("../.."));n.target||(this.profile.target=p.resolve("../../myapp"));f.mixin(this.profile,this.commander);var b=c.resolve(this.profile.system);g.existsSync(b)?this.profile.system=b:(b=process.cwd()+"/data/system",this.profile.system=b,n.system=
b)}})})},"nxapp/model/ExportOptions":function(){define(["dcl/dcl","xide/model/Base","xide/mixins/EventedMixin","xide/encoding/MD5","xide/utils"],function(h,p,n,g,d){return h([p.dcl,n.dcl],{connected:!1,__registered:!1,declaredClass:"nxapp/model/ExportOptions",toString:function(){var c=this.options;return c.deviceScope+"://"+c.host+":"+c.port+"@"+c.protocol},constructor:function(c){this.options=c}})})},"nxappmain/main_server":function(){require("dojo/node!readline nxapp/Commons xide/types nxapp/utils/TCPUtils nxappmain/nxAppBase nxapp/manager/DeviceServerContext nxapp/client/WebSocket xlog/Server dojo/node!winston dojo/node!path dojo/node!fs dojo/node!util dojo/node!vm nxapp/manager/MQTTManager nxapp/Commons nxapp/utils/FileUtils nxapp/Logger nxapp/utils/_console require dojo/node!tcp-port-used".split(" "),
function(h,p,n,g,d,c,a,b,r,f,m,k,e,q,l,u,v,t,y,w){global.dojoRequire=y;p={filename:"all.log",dirname:dojoConfig.logRoot,json:!0};var A=new b({});A.start({fileLogger:p,console:null});var z=new d({commander:null}),G,H,F;z.init();var B=z.profile;d=z.commander;if(d.diagnose){console.error("run diagnose");console.log("loaded modules: ",null!==global.nRequire.cache);for(var D in global.nRequire.cache)console.log(D)}else{if(d.modules){e=["/nxappmain/server","/nxappmain/dojoConfig","/dojo/dojo","/dojo/_base/configNode"];
u="";w=0;for(D in global.nRequire.cache)c=D.replace(process.cwd(),"").replace(f.sep+"node_modules"+f.sep,"").replace(".js",""),-1===e.indexOf(c)&&(u+="var a_"+w+' \x3d require("'+c+'");\n',w++);console.log(u);return u}if(d.file){f=f.resolve(d.file);if(m.existsSync(f)){D=new e.createContext({require:y.nodeRequire,commander:d,console:console,process:process,setTimeout:setTimeout,global:global});f=u.readFile(f);(new e.Script(f)).runInContext(D);return}console.error("file specified but doesnt exists "+
d.file)}d.port&&(B.socket_server.port=d.port);d.host&&(B.socket_server.host=d.host);if(z.commander.info)console.log(JSON.stringify({host:"http://"+z.profile.socket_server.host,port:z.profile.socket_server.port})),process.exit();else{var C=new c;C.profile=B;C.constructManagers();C.initManagers(B);C.logManager=A;f=new q({ctx:C,profile:B});f.init(B);C.connectionManager.mqttManager=f;C.mqttManager=f;var x=null,E=function(){var b=new a;b.init({options:{host:"http://"+z.profile.socket_server.host,port:z.profile.socket_server.port,
debug:z.profile.debug}});b.connect();b.onSignal(n.SIGNAL_RESPONSE,function(a){B.common.stdout&&process.stdout.write(a+"\n");z.commander.oneshot&&z.commander.command&&process.exit()});return b},I=function(){z.commander.host&&(G=z.commander.host);z.commander.port&&(H=parseInt(z.commander.port));z.commander.protocol&&(F=z.commander.protocol);if(z.commander.driver){console.error("run in driver mode");var a=E(),b={driver:"xcf/driver/SubTest",host:"192.168.1.20",port:23,protocol:"tcp"},c=n.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER;
b.manager_command=n.SOCKET_SERVER_COMMANDS.START_DRIVER;c=n.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER;a.emit(c,b)}else if(z.commander.send){console.error("sending command");console.error("  create web socket client to control server : http://"+z.profile.socket_server.host+":"+z.profile.socket_server.port);var a=E(),d=function(b){if(null!==a&&null!=b){var c={command:b,host:G,port:H,protocol:F},d=n.SOCKET_SERVER_COMMANDS.SIGNAL_DEVICE;"startDriver"==b?(c.manager_command=n.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,
d=n.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):"status"==b?(c.manager_command=n.SOCKET_SERVER_COMMANDS.MANAGER_STATUS,d=n.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):"closeall"==b?(c.manager_command=n.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL,d=n.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):c.device_command=n.SOCKET_SERVER_COMMANDS.DEVICE_SEND;a.emit(d,c)}},b=function(b){if(null!==a&&null!=b)if(b.indexOf&&-1!=b.indexOf(";")){b=b.split(";");for(var c=0;c<b.length;c++)d(b[c])}else d(b)};h.createInterface({input:process.stdin,
output:process.stdout}).on("line",function(a){null!=a&&0<a.length&&(console.log("sending stdin : "+a),d(a))});"string"==typeof z.commander.command&&b(z.commander.command);console.error("Send command. ^C to close connection and quit")}};if(B.common.createSocketServer){var M=function(){x=g.createDeviceServer(B,C);C.deviceServer=x;C.logger=r;C.deviceServer.logger=r;C.logManager=A};w.check(B.socket_server.port,B.socket_server.host).then(function(a){a?(console.log("device server already started"),E()):
(M(),I())},function(a){M();I()})}else try{I()}catch(N){console.error("app crash!")}}}})},"nxapp/manager/MQTTManager":function(){define("dcl/dcl nxapp/manager/ManagerBase nxapp/utils/_LogMixin nxapp/types/Types dojo/node!mosca dojo/node!mqtt dojo/node!node-notifier dojo/node!colors xide/utils nxapp/utils/_console dojo/node!tcp-port-used".split(" "),function(h,p,n,g,d,c,a,b,r,f,m){return h([p,n],{declaredClass:"nxapp.manager.MQTTManager",options:null,profile:null,lastUpTime:null,mqttClients:null,publishTopic:function(a,
b){var c={topic:a,payload:JSON.stringify(b),qos:1};this.server.publish(c,function(){})},createMQTTClient2:function(a,b,d){var h=a+":"+b,m=c.connect("mqtt://localhost",{clean:!1,clientId:h}),n=this.ctx;f.log("create mqtt - client for "+h);m.on("connect",function(){f.log("on connected local mqtt client for "+h)});m.on("message",function(c,f){n.getDeviceServer().broadCastMessage(g.EVENTS.ON_MQTT_MESSAGE,{host:a,port:b,topic:c,message:f.toString(),mqtt:d})});return m},createMQTTClient:function(a,b,d){a=
a+":"+b;if(this.mqttClients[a])return this.mqttClients[a];if(!this.mqttClients[a])return b=c.connect("mqtt://localhost",{clean:!1,clientId:a}),b.on("connect",function(){}),this.mqttClients[a]=b},onConnectedToDevice:function(a,b,c){},onWakeup:function(){this.lastUpTime=(new Date).getTime();for(var a=0;a<this.pool.length;a++){var b=this.pool[a];b.socket&&b.socket.close&&b.socket.close();b.socket&&b.socket._socket&&b.socket._socket.close&&b.socket._socket.close()}this.pool=[]},init:function(c){function e(){if(!g.__started){g.__started=
!0;try{a.notify({title:"Control-Freak",message:"All servers up and running, you can start now Control-Freak IDE",sound:!0,wait:!0,open:"file:///"},function(a,b){})}catch(c){}f.log(b.green("\n\r\t Device server up and running\n\r \t ***********   You can start Control Freak now  **************\n\r"));g.ctx.onReady()}}this.profile=c;this.lastUpTime=(new Date).getTime();var g=this;this.mqttClients={};var h={type:"mongo",url:"mongodb://localhost:27017/mqtt",pubsubCollection:"xcf",mongo:{}};r.mixin(h,
this.profile.ascoltatore);var n={port:1883,backend:h,persistence:{factory:d.persistence.Mongo,url:"mongodb://localhost:27017/mqtt"}};this.profile.mosca.port&&(this.profile.mosca.port=parseInt(this.profile.mosca.port));r.mixin(n,this.profile.mosca);if("false"===this.profile.mqtt)f.warn("MQTT is disabled, proceed without"),this.server={},e();else try{var p=function(){var a=new d.Server(n);a.on("error",function(a){f.error("Unable to connect to Mongo:"+a.message);e()});a.on("ready",e);a.on("clientConnected",
function(){});a.on("clientDisconnected",function(){});g.server=a};m.check(c.socket_server.port,c.socket_server.host).then(function(a){a||p()},function(){p()})}catch(t){f.error("error starting mosca ",t)}},onTimeout:function(a){},onClose:function(a){this.removeConnection(a)},onDrain:function(a){},onError:function(a,b){},onData:function(a,b){throw Error();},onConnect:function(a,b,c,d){f.log("Connected to "+a+":"+b+" via "+c,"protocol_messages");a={device:{host:a,port:b,protocol:c,deviceScope:d}};this.ctx.getDeviceServer().broadCastMessage(g.EVENTS.ON_DEVICE_CONNECTED,
a)},onHandle:function(a,b){this.showDebugMsg("protocol_messages")}})})}}});define("nxappmain/serverbuild",[],1);
//# sourceMappingURL=serverbuild.js.map