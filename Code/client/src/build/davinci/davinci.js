//>>built
require({cache:{"davinci/main":function(){define("dojo/_base/kernel dojo/_base/declare davinci/davinci davinci/ve/metadata davinci/Runtime davinci/Workbench davinci/ve/metadata davinci/ui/widgets/OutlineTree".split(" "),function(p){return p.davinci})},"davinci/ve/metadata":function(){define("require dojo/Deferred dojo/promise/all dojo/_base/lang dojo/_base/connect ../library ../model/Path ../repositoryinfo xide/types xide/utils".split(" "),function(p,m,h,e,b,k,a,g,n,f){function d(c,q){c=c||{};for(var a=
1,f=arguments.length;a<f;a++){var n=arguments[a],r,b;for(r in n)n.hasOwnProperty(r)&&(b=n[r],r in c&&("object"===typeof b||c[r]===b)?d(c[r],b):c[r]=b)}return c}function c(c,n,r){E[c.name]=c;n=new a(n);var b=c.overlays,u;for(u in b)b.hasOwnProperty(u)&&("oam"!==u&&"maqetta"!==u||d(c,b[u]));delete c.overlays;c.__metadataModuleId="maq-metadata-"+c.name;u=new a(location.href);u.path=u.path.substring(0,u.path.lastIndexOf("/"));u.path=f.removeURLParameter(u.path,"theme");u.path=""+r;b=[{name:c.__metadataModuleId,
location:r+n}];b[0].location=b[0].location.replace("index.php","");b[0].location=b[0].location.replace("?debug\x3dtrue","");b[0].location=b[0].location.replace("\x26isDesktop\x3dtrue","");b[0].location=b[0].location.replace("maqetta.html","");b[0].location=b[0].location.replace("maqettar.html","");b[0].location=b[0].location.replace("index.html","");b[0].location=b[0].location.replace("xui.php","");b[0].location=b[0].location.replace("xui.php?debug\x3dtrue","");"dojo"!=c.name&&"xide"!=c.name&&"xblox"!=
c.name&&(c.__libraryModuleId=c.name,u={name:c.__libraryModuleId,location:u.append("app/static/lib/"+c.name+"/"+c.version).toString()},"xide"!=c.__libraryModuleId&&b.push(u));p=p({packages:b});var k;if(e.exists("scripts.widget_metadata",c))if("string"==typeof c.scripts.widget_metadata){var h=n.append(c.scripts.widget_metadata);k=dojo.xhrGet({url:r+h.toString()+(0<g.revision.length?"?"+g.revision:""),handleAs:"json"}).then(function(d){if(d){var a=h.getParentPath();return q(c.name,d,a,a,r)}})}else k=
q(c.name,c.scripts.widget_metadata,n,r);if(e.exists("scripts.callbacks",c)){var z=new m;p([c.scripts.callbacks],function(d){c.$callbacks=d;z.resolve()});G.push(z)}return k}function q(c,d,q,a){function n(c,d,q){"undefined"==typeof c.$providedTags[d]&&(c.$providedTags[d]=[]);c.$providedTags[d].push(q)}c||console.error("parseLibraryDescriptor: missing 'libName' arg");var f=E[c];d.$descriptorFolderPath=q.toString();d.$moduleFolderPath=a.toString();if(f)if(f.$widgets){d.widgets.forEach(function(c){f.$wm.widgets.push(c)});
for(var r in d.categories)f.$wm.categories.hasOwnProperty(r)||(f.$wm.categories[r]=d.categories[r])}else if(f.$wm)for(a=0;a<d.widgets.length;a++){r=!1;for(var b=0;!r&&b<f.$wm.widgets.length;b++)f.$wm.widgets[b].type==d.widgets[a].type&&(r=!0);r||f.$wm.widgets.push(d.widgets[a])}else f.$wm||(f.$wm=d);else E[c]={$wm:d,name:d.name,version:d.version},d.__metadataModuleId&&(E[c].__metadataModuleId=d.__metadataModuleId),f=E[c];var g=f.$wm;g.$providedTypes=g.$providedTypes||{};g.$providedTags=g.$providedTags||
{};g.widgets.forEach(function(c){g.$providedTypes[c.type]=c;if("string"==typeof c.tags)n(g,c.tags,c);else if(c.tags&&c.tags.length)for(var d=0;d<c.tags.length;d++)n(g,c.tags[d],c);c.icon&&!c.iconLocal&&(c.icon=q.append(c.icon).toString());c.iconLarge&&!c.iconLargeLocal&&(c.iconLarge=q.append(c.iconLarge).toString());c.widgetClass=g.categories[c.category].widgetClass});dojo.mixin(g,{_maqGetString:z});if(g.extend)for(var k in g.extend)g.extend.hasOwnProperty(k)&&(E[k]&&E[k].$wm?u(E[k].$wm,[g.extend[k]]):
(d=N[k]||[],d.push(g.extend[k]),N[k]=d));N[c]&&u(g,N[c]);return f}function u(c,d){var q=c.$providedTypes;d.forEach(function(c){for(var d in c)if(c.hasOwnProperty(d)){var a=c[d],f=q[d];a.mixin&&e.mixin(f,a.mixin);if(a.concat)for(var n in a.concat)if(a.concat.hasOwnProperty(n)){var r=a.concat[n];if(f[n]){var b=f,u=n;var g=f[n];"string"===typeof g?r=g+","+r:g instanceof Array?r=g.concat(r):(console.error('Unhandled type for "concat()"'),r=void 0);b[u]=r}else f[n]=r}}})}function r(c){if(c)for(var d in E)if(E.hasOwnProperty(d)){var q=
E[d];if(q.$wm&&q.$wm.$providedTypes[c])return q}return null}function z(c){K||(K=!0);return null}function y(c){if(c){if(I.hasOwnProperty(c))return I[c];var q=r(c),a;q&&(a=q.$wm.$descriptorFolderPath);if(!a)return null;var q=q.$wm,f=null,b=L.getResourceManager().getVariable(n.RESOURCE_VARIABLES.APP_URL);q.localPath?(a=c.replace(/\./g,"/").split("/"),a.shift(),a=a.join("/"),a=[q.$moduleFolderPath,"/",a,"_oam.json"].join(""),b=system.resource.findResource(a).getContentSync(),f=dojo.fromJson(b)):(a=[a,
"/",c.replace(/\./g,"/"),"_oam.json"].join(""),a=b+"/lib/xideve/metadata/"+a,dojo.xhrGet({url:a,handleAs:"json",sync:!0}).then(function(c){f=c}));if(!f)return console.error("ERROR: Could not load metadata for type: "+c),null;f.$ownproperty=dojo.mixin({},f.property);f.property=dojo.mixin({},M,f.property);f.$src=a;I[c]=f;d(f,q.$providedTypes[c].metadata);return f}}function B(c,d){if(!d)return c;dojo.every(d.split("."),function(d){if(void 0===c[d])return c=void 0,!1;c=c[d];return!0});return c}function x(c,
d){var q=A.queryDescriptor(d,"allowed"+c);q||(q="Parent"===c?"ANY":"NONE");return q.split(/\s*,\s*/)}function w(c,d){var q=A.queryDescriptor(c,d);if(!q)return null;var a=r(c);return v(a,q)}function v(c,d){return c&&d?"string"===typeof d&&"./"===d.substr(0,2)?(new a(c.__metadataModuleId)).append(d).toString():d:null}var A,C,L,E={},I={},D={},G=[],N={},M={id:{datatype:"string",hidden:!0},lang:{datatype:"string",hidden:!0},dir:{datatype:"string",hidden:!0},"class":{datatype:"string",hidden:!0},style:{datatype:"string",
hidden:!0},title:{datatype:"string",hidden:!0}};dojo.subscribe("/davinci/ui/libraryChanged/start",function(){E={};I={};D={};A.init().then(function(){dojo.publish("/davinci/ui/libraryChanged")})});var K=!1;A={prefix:"",init:function(d,q){L=d;var a=[];C=p("../Workbench");L.getResourceManager().getVariable(n.RESOURCE_VARIABLES.APP_URL);k.getUserLibs(C.getProject()).forEach(function(d){var f=d.metaRoot;(f=f.replace("app/metadata/",""))&&a.push(dojo.xhrGet({url:q+f+"/package.json?"+g.revision,handleAs:"json"}).then(function(d){return c(d,
f,q)}))});return h(a)},parseMetaData:function(c,d,a,f){return q(c,d,a,f)},getLibrary:function(c){return c?E[c]:E},getLibraryActions:function(c,d){var q=[],a;for(a in E)if(E.hasOwnProperty(a)){var f=E[a];if(f.$wm){var n=f.$wm["davinci.actionSets"];n&&dojo.forEach(n,function(a){a.id!=c||d&&a.targetID!==d||(a=dojo.clone(a.actions),dojo.forEach(a,function(c){if(c.action){var d=v(f,c.action);c.action=d}c.menu&&c.menu.forEach(function(c){if(c.action){var d=v(f,c.action);c.action=d}});q.push(c)}))})}}return q},
loadThemeMeta:function(c){for(var d=c.find({elementType:"HTMLElement",tag:"style"}),q=[],f,n=0;n<d.length;n++)for(var r=0;r<d[n].children.length;r++)"CSSImport"==d[n].children[r].elementType&&q.push(d[n].children[r]);new a(c.fileName);n=k.getThemes(C.getProject());d={};for(r=0;r<n.length;r++)if(n[r].files)for(var b=0;b<n[r].files.length;b++)d[n[r].files[b]]=n[r];for(r=0;r<q.length;r++){var n=q[r].url,u;for(u in d)if(-1<u.indexOf("claro")&&(f=u),-1<n.indexOf(u))return{themeUrl:n,themeMetaCache:k.getThemeMetadata(d[u]),
theme:d[u]}}if(r=A._loadThemeMetaDojoxMobile(c,d))return r;if(f){for(var g,r=0;r<q.length;r++)if((u=q[r].url.match(/\/([^\/]*)\.css$/))&&2==u.length&&(u=u[1],q[r].url.match(new RegExp("themes/"+u+"/"+u+".css$")))){g=u;break}if(g)return u=c.getDocumentElement(),c=u.getChildElement("head"),u=u.getChildElement("body"),(n=u.getAttribute("class"))&&u.setAttribute("class",n.replace(new RegExp("\\b"+g+"\\b","g"),"claro")),c=c.getChildElements("style"),dojo.forEach(c,function(c){dojo.forEach(c.children,function(c){"CSSImport"==
c.elementType&&(c.url=c.url.replace(new RegExp("/"+g,"g"),"/claro"))})}),n=q[r].url.replace(new RegExp("/"+g,"g"),"/claro"),q={themeUrl:n,themeMetaCache:k.getThemeMetadata(d[f]),theme:d[f]},q.themeMetaCache.usingSubstituteTheme={oldThemeName:g,newThemeName:"claro"},q}},_loadThemeMetaDojoxMobile:function(c,d){for(var q=c.find({elementType:"HTMLElement",tag:"script"}),a=0;a<q.length;a++){var f=q[a].getElementText();if(f.length){var n=f.indexOf("dojoxMobile.themeMap");if(0<n){var n=f.indexOf("\x3d",
n),r=f.indexOf(";",n);if(r>n){var f=dojo.fromJson(f.substring(n+1,r))[0][2][0],b;for(b in d)if(-1<f.indexOf(b))return{themeUrl:f,themeMetaCache:k.getThemeMetadata(d[b]),theme:d[b]}}}}}},getLibraryForType:function(c){return r(c)},getLibraryMetadataForType:function(c){return(c=r(c))?c.$wm:null},getWidgetDescriptorForType:function(c){var d=r(c);c=d?d.$wm.$providedTypes[c]:void 0;return c},getOamDescriptivePropertyForType:function(c,d){var q=y(c);return q&&q[d]?(q=q[d],"string"==typeof q?{type:"text/plain",
value:q}:"string"==typeof q.value?{type:q.type?q.type:"text/plain",value:q.value}:null):null},getWidgetsWithTag:function(c){var d=[];if(c)for(var q in E)if(E.hasOwnProperty(q)){var a=E[q];a.$wm&&a.$wm.$providedTags[c]&&(d=d.concat(a.$wm.$providedTags[c]))}return d},getLibraryBase:function(c){if(c=r(c))return c.$wm.$descriptorFolderPath},invokeCallback:function(c,d,q){var a=c;"string"===typeof c&&(a=r(type));if(a&&a.$callbacks&&(c=a.$callbacks[d]))return c.apply(a.$callbacks,q)},query:function(c,d){if(c){var q,
a;c.declaredClass?(c.metadata&&(a=c.metadata),q=c.type):q=c;if(!a){a=y(q);if(!a)return;c.declaredClass&&(c.metadata=a)}return B(a,d)}},queryDescriptorByName:function(c,d,q){d=r(d);var a;if(d){d=d.$wm.widgets;for(var f=0;f<d.length;f++)if(d[f].name==c){a=d[f];break}}return this._queryDescriptor(a,q)},queryDescriptor:function(c,d){var q=r(c),a;q&&(a=q.$wm.$providedTypes[c]);return this._queryDescriptor(a,d)},_queryDescriptor:function(c,d){if(c&&"object"===typeof c){var q=B(c,d);"resizable"===d&&(q||
(q="both"));return q}},getAllowedParent:function(c){return x("Parent",c)},getAllowedChild:function(c){return x("Child",c)},getHelper:function(c,d){var q=new m,a=c+":"+d;if(a in D)return q.resolve(D[a]),q;var f=w(c,d);f?p([f],function(c){q.resolve(c);D[a]=c}):q.resolve();return q},getSmartInput:function(c){var d=new m;if(c in F)d.resolve(F[c]);else{var q=w(c,"inlineEdit");q?"string"===typeof q?p([q],function(q){d.resolve(F[c]=new q)}):"[object Array]"===Object.prototype.toString.call(q.property)?p(["davinci/ve/input/MultiFieldSmartInput"],
function(a){a=new a;e.mixin(a,q);d.resolve(F[c]=a)}):p(["davinci/ve/input/SmartInput"],function(a){a=new a;e.mixin(a,q);d.resolve(F[c]=a)}):d.resolve(null)}return d},getDeferreds:function(){return G}};var F={};b.subscribe("/davinci/ui/libraryChanged/start",function(){F={}});return dojo.setObject("davinci.ve.metadata",A)})},"davinci/library":function(){define("dojo/_base/xhr dojo/Deferred ./Runtime ./model/Path ./ve/themeEditor/metadata/CSSThemeProvider ./ve/themeEditor/metadata/query ./workbench/Preferences".split(" "),
function(p,m,h,e,b,k,a){var g={_customWidgets:{}},n={},f={},d={},c={};dojo.subscribe("/davinci/ui/libraryChanged/start",this,function(){c={};d={}});dojo.subscribe("/davinci/resource/resourceChanged",this,function(c,d){var f=require("davinci/Workbench").getProject();if("deleted"==c||"renamed"==c){var b=a.getPreferences("davinci.ui.ProjectPrefs",f),b=(new e(f)).append(b.themeFolder);(new e(d.getPath())).startsWith(b)&&delete n[f]}"File"==d.elementType&&"theme"==d.extension&&"modified"==c&&d.getContent().then(function(c){c=
JSON.parse(c);c.path=[d.getPath()];c.getFile=function(){return system.resource.findResource(this.path[0])}.bind(c);for(var q=0;q<n[f].length;q++)if(n[f][q].name==c.name){n[f][q]=c;return}n[f].push(c)}.bind(this))});return g={themesChanged:function(c){n[c]=c?null:[]},getThemes:function(c,d,f){function b(){var a=[];n[c]&&(a=d?n[c].filter(function(c){return!c.getFile().isVirtual()}):n[c]);return a}f&&delete n[c];if(n[c])return b();f=a.getPreferences("davinci.ui.ProjectPrefs",c);f.themeFolder="themes";
f=(new e(c)).append(f.themeFolder);f=h.serverJSONRequest({url:h.cmdOffset+"cmd/getThemes",handleAs:"json",content:{path:"*.theme",ignoreCase:!0,workspaceOnly:!1,inFolder:f.toString()},sync:!0});f.forEach(function(c){c.getFile=function(){return system.resource.findResource(this.path[0])}.bind(c)}.bind(this));n[c]=f;return b()},getThemeMetadata:function(c){return f[c.name]?f[c.name]:null},addCustomWidgets:function(c,d,f,n){var b=a.getPreferences("davinci.ui.ProjectPrefs",c);b.widgetFolder||(b.widgetFolder=
"./lib/custom",a.savePreferences("davinci.ui.ProjectPrefs",c,b));d=d.getParentFolder().getPath();d=new e(d);f=require("davinci/ve/metadata").parseMetaData(n.name,n,d,f);g._customWidgets[c].hasOwnProperty("name")||(g._customWidgets[c].name="custom",g._customWidgets[c].metaPath=b.widgetFolder,g._customWidgets[c].localPath=!0);g._customWidgets[c]=f;dojo.publish("/davinci/ui/addedCustomWidget",[f]);return f},getCustomWidgets:function(d){if(!g._customWidgets||!g._customWidgets[d]){g._customWidgets||(g._customWidgets=
{});g._customWidgets[d]||(g._customWidgets[d]=[]);var f=a.getPreferences("davinci.ui.ProjectPrefs",d);f.widgetFolder||(f.widgetFolder="./lib/custom",a.savePreferences("davinci.ui.ProjectPrefs",d,f));for(var n=(new e(d)).append(f.widgetFolder).getSegments(),f=system.resource.findResource(n[0]),b=1;b<n.length;b++)var k=f.getChild(n[b]),f=k?k:f.createResource(n[b],!0);var h;f.getChildren(function(c){h=c},!0);this._customWidgetPackages=[];null==h&&(h=[]);n={};for(b=0;b<h.length;b++)if(k=h[b],"Folder"==
k.elementType){n[k.name]=k.getPath();var x="maq-lib-custom-"+k.name,w=k.getURL();require({packages:[{name:x,location:w}]});this._customWidgetPackages.push({name:k.name,location:w})}k=system.resource.findResource("*_widgets.json",!1,f);this._customWidgetDescriptors={};for(b=0;b<k.length;b++){var v=k[b],A=v.getParentFolder(),w=f.getURL(),x=A.getURL(),m=x.substr(w.length+1),w=null;try{w=dojo.fromJson(v.getContentSync())}catch(L){}if(w&&w.customWidgetSpec&&(m=m.split("/").shift(),w.__metadataModuleId=
"maq-lib-custom-"+m,g.addCustomWidgets(d,v,n[m],w),c[d]||(c[d]={}),c[d][A.name]||(c[d][A.name]={}),c[d][A.name][w.version]=x,w&&w.widgets))for(v=0;v<w.widgets.length;v++)(A=w.widgets[v].type)&&(this._customWidgetDescriptors[A]={name:m,location:x,descriptor:w})}}return{custom:g._customWidgets[d]}},getCustomWidgetPackages:function(){return this._customWidgetPackages||[]},getCustomWidgetDescriptors:function(){return this._customWidgetDescriptors?this._customWidgetDescriptors:{}},getInstalledLibs:function(){g._serverLibs||
(g._serverLibs=h.serverJSONRequest({url:"cmd/listLibs",handleAs:"json",content:{},sync:!0})[0].userLibs);return g._serverLibs},getUserLibs:function(c){if(d.base)return d.base;d.base=h.serverJSONRequest({url:h.cmdOffset+"cmd/getUserLibs.json",handleAs:"json",content:{base:c},sync:!0})[0].userLibs;return d.base},getLibRoot:function(d,a,f){var n=new m,b=c;if(b[f]&&b[f][d]&&void 0!==b[f][d][a])return n.resolve(b[f][d][a]||"");b[f]||(b[f]={});b[f][d]||(b[f][d]={});return p.get({url:h.cmdOffset+"cmd/getLibRoots.php",
handleAs:"json",content:{libId:d,version:a,base:f}}).then(function(c){c=c?c[0].libRoot.root:null;b[d]||(b[d]={});b[f][d][a]=c;return n.resolve(c||"")})},modifyLib:function(c){return h.serverJSONRequest({url:"cmd/modifyLib",handleAs:"text",content:{libChanges:JSON.stringify(c)},sync:!0})},addLib:function(c,d){return h.serverJSONRequest({url:"cmd/getLibRoots",handleAs:"json",content:{libId:c,version:d},sync:!0})[0].libRoot.root},getLibraryId:function(c,d){return{sketch:"sketch",claro:"claro"}[c]+(d||
"")},getLibraryName:function(c){var d,a;for(a in c)d=a;return d}}})},"davinci/Runtime":function(){define("dojo/i18n!./nls/webContent ./commands/CommandStack ./ui.plugin ./html/html.plugin ./js/js.plugin ./ve/ve.plugin".split(" "),function(p,m,h,e,b,k){var a=[h,e,k],g={plugins:[],extensionPoints:[],subscriptions:[],currentSelection:[],commandStack:new m,getUser:function(){return this._initializationInfo.userInfo},getWorkbenchState:function(){return this._initializationInfo?this._initializationInfo.workbenchState:
{activeEditor:null,editors:[],nhfo:{project1:{device:"iphone",layout:"flow",themeSet:{name:"(none)",desktopTheme:"claro",mobileTheme:[{theme:"android",device:"Android"},{theme:"blackberry",device:"BlackBerry"},{theme:"ipad",device:"iPad"},{theme:"iphone",device:"iPhone"},{theme:"iphone",device:"other"}]}}},project:"project1",id:"",Fields:[]}},getSiteConfigData:function(a){return"widgetPalette"==a?{_COMMENT1_:"Defines site-specific organization for widget palette",name:"widgetPalette_dojo_default",
_COMMENT2_:"One entry for each section (\x3d\x3dfolder) in widget palette",_COMMENT3_:"includes provides ordered list of widgets to appear in each section",_COMMENT4_:"each entry in array causes a new item to appear in that section",_COMMENT5_:"each entry in array can be either a string or an array",_COMMENT6_:"if a string, can be either a string that begins with type:, which is a particular widget type",_COMMENT7_:"otherwise the string holds a tag, which causes all widgets that match tag to share that item",
_COMMENT8_:"if an array, then it holds a list of strings, each of which can start with type: (widget type) or a tag",defs:{$XBLOXSection:{id:"xblox",name:"xblox",iconBase64:"data:image/gif;base64,R0lGODlhEAAQAKIAAFhYWtXV1v///0BAQP///wAAAAAAAAAAACH5BAEAAAQALAAAAAAQABAAAAMuSLo0w5CNIF6EM9grN2+Z82WCEGjcVJbopa5tlJ2nh4W2XH9LyCu+X/AHAPyOCQA7",subsections:["$XBLOXSection_Controls"]},$XBLOXSection_Controls:{id:"Controls",name:"Controls",iconBase64:"data:image/gif;base64,R0lGODlhEAAQALMAAN7e4oyMjtXV1sDAwf///+Dg4MvLyzMzM////wAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAgALAAAAAAQABAAAAQ3EMlJq704a3RO2NIhBIexHYRgeFTndkQ8HmER33g60EcB/ECcYBd6wWSkDErFUs5Mms4HRK1SIwA7",
includes:["RunScript","CSSState","StyleState","Script"]},$ClipartSection_Arrows:{id:"Arrows",name:"Arrows",iconBase64:"data:image/gif;base64,R0lGODlhEAAQALMAAN7e4oyMjtXV1sDAwf///+Dg4MvLyzMzM////wAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAgALAAAAAAQABAAAAQ3EMlJq704a3RO2NIhBIexHYRgeFTndkQ8HmER33g60EcB/ECcYBd6wWSkDErFUs5Mms4HRK1SIwA7",includes:["ArrowDown","ArrowLeft","ArrowRight","ArrowUp"]},$ClipartSection_Community:{id:"Community",name:"Community",iconBase64:"data:image/gif;base64,R0lGODlhEAAQAMQAANXV1v///9HR0cXFxbm5uaKiooyMjHR0dGlpaVJSUkZGRkREREJCQkFBQT09PTo6OjMzM////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABEALAAAAAAQABAAAAVdIJEoZGmSiTgAbOuywwgEdAAY5WyTul0gAYFCB+DRWJCAqFArDo+QRcDRgBCNu1rgueMWG4FHw4u1Maa9bg8AdqSd6/a7zEZr4U35vRw4KA5aOwkrL4UxIieJCikhADs\x3d",
includes:["Facebook","Rss","Twitter"]},$ClipartSection_Devices:{id:"Devices",name:"Devices",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMTgwMTE3NDA3MjA2ODExOTJCMEJDQTgxOTc0RDYxMiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo4NTQ0QUU2NjhCMzMxMUUyOTQ3N0ExRTg0NEJENzk4RiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo4NTQ0QUU2NThCMzMxMUUyOTQ3N0ExRTg0NEJENzk4RiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1LjEgTWFjaW50b3NoIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDM4MDExNzQwNzIwNjgxMTkyQjBCQ0E4MTk3NEQ2MTIiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MDE4MDExNzQwNzIwNjgxMTkyQjBCQ0E4MTk3NEQ2MTIiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7l5plaAAAAIVBMVEX///8zMzP3+PnV1dZ+fn7ExMZ9fX4sKis1NTVZWVmgoKKPJ3BhAAAARElEQVR42mJgIAIwM8IBM1iAkRkO2KECTFBAiQCaoZjWsrKxcgIxEHKA+BysbGysQIKLi5OVEyjCiAYYWNAAYa8CBBgA3BQB3Pw68r4AAAAASUVORK5CYII\x3d",
includes:["Cellphone","Computer","Laptop","Server","Tablet"]},$ClipartSection_DeviceSilhouettes:{id:"DeviceSilhouettes",name:"Device Silhouettes",iconBase64:"data:image/gif;base64,R0lGODlhEAAQAKIAAGZmaNXV1v///0BAQP///wAAAAAAAAAAACH5BAEAAAQALAAAAAAQABAAAAM6SErT3iu+EF5UL4/LqPfbNQRCaVbcaJ6hRK4CKr6r7MJxu6iwvX8fHUbjSDUAFEBR5AAol0wNZzpNAAA7",includes:"Android_340x480 Android_480x800 AndroidTablet Blackberry iPad iPhone".split(" ")},$ClipartSection_Media:{id:"Media",name:"Media",iconBase64:"data:image/gif;base64,R0lGODlhEAAQALMAANXV1v////z8/Pr6+vn5+fj4+Ojo6MrKyre3t6urq4iIiHV1dUdHR0BAQDMzM////yH5BAEAAA8ALAAAAAAQABAAAARZ8MlJq6Ut36c5+E3VOGAGBEAWeif6DULghk0rB8jCLAhK2zjFoXBQIFKeW2BxSDQShwWypmQUGoZGgTEFMp1Q6U+JEBKN3RsBp+P5WJ+4HCRR2e+rjX5PiQAAOw\x3d\x3d",
includes:"Camera Chat GraphBar GraphLine GraphPie Image Map Microphone PlayControl Record StreetMap Table VideoCamera VideoPlayer".split(" ")},$ClipartSection_UserInterfaceControls:{id:"UserInterfaceControls",name:"User Interface Controls",iconBase64:"data:image/gif;base64,R0lGODlhEAAQALMAAFhYWtXV1qurrKGhooKCg/////X19TMzM////wAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAgALAAAAAAQABAAAARSEElwqrUyHxG678KRIVthDoNZhGNZBFVgsppQGId5GKtYF5dKr8X5eGiSoNKXJAie0CeBSbKprsgqMDj84XS8rAt2kHWT1gJKJS4aA1nSspKJAAA7",includes:"File Folder FormattingToolbox HScrollBar HSplit ProgressBar SpinInput VScrollBar VSplit WaitingPending".split(" ")},
$ClipartSection_UserInterfaceIcons:{id:"UserInterfaceIcons",name:"User Interface Icons",iconBase64:"data:image/gif;base64,R0lGODlhEAAQANUAANXT1vj4+eLi49/f4Nra29nZ2tbW19XV1tTU1dDQ0c3NzpCQkf////7+/vX19fLy8vDw8O/v7+zs7OTk5OPj49nZ2dHR0c/Pz87Ozs3NzczMzKWlpaOjo6KioqGhoZ6enp2dnZycnJubm5mZmY+Pj4aGhoWFhYGBgX5+fnR0dHNzc2lpaWZmZllZWVdXV1VVVVNTU1FRUU5OTk1NTUxMTEJCQkBAQDY2NjMzMzIyMi8vLyoqKiYmJiMjI////wAAACH5BAEAAD4ALAAAAAAQABAAAAa8QJ/Qd0HRdD0dDXUZDj8ykqJgKGBIso/zs9IIIoFGICLQrLREWUZSmeHetookI2ueFgIGC6fSqHAzDAILJz4yFhF6LA8MD28MEQkyPjkEAQyYjS04LAwBBDk+PAYNmQ+bLYwNBjw+OJaZGzipmA4EOD4xB4mYIzgjmREHMT4mIhSZyZgUIiZELwgSvb+YEggvTT4eKQgDEB01HRATCCkcThwuIAcEAAQHIS/nTj4WJTA3OzcwJRb0/wB9BAEAOw\x3d\x3d",
includes:"Close Copy Delete Edit Error Fatal Help Home Info Lock Mail Minus Next Paste Plus Previous Print Refresh Save Search ShoppingCart Trash Warning".split(" ")},$ClipartSection_Other:{id:"Other",name:"Other",iconBase64:"data:image/gif;base64,R0lGODlhEAAQAJEAAHx8fDMzM////wAAACH5BAEAAAIALAAAAAAQABAAAAImlI9pAYoQDGxuHpvwZY8rrH1MWAWes53oRHZUK4Rkq8Gxp4roXgAAOw\x3d\x3d",includes:["Browser","Person","ProfilePicture","X"]},$ClipartSection:{id:"Clipart",name:"Clip Art",iconBase64:"data:image/gif;base64,R0lGODlhEAAQAKIAAFhYWtXV1v///0BAQP///wAAAAAAAAAAACH5BAEAAAQALAAAAAAQABAAAAMuSLo0w5CNIF6EM9grN2+Z82WCEGjcVJbopa5tlJ2nh4W2XH9LyCu+X/AHAPyOCQA7",
subsections:"$ClipartSection_Arrows $ClipartSection_Community $ClipartSection_Devices $ClipartSection_DeviceSilhouettes $ClipartSection_Media $ClipartSection_UserInterfaceControls $ClipartSection_UserInterfaceIcons $ClipartSection_Other".split(" ")},$DrawingToolsSection:{id:"DrawingTools",name:"Drawing Tools",iconBase64:"data:image/gif;base64,R0lGODlhEAAQAKIAAL+/v5aWlmNjYzMzMxwcHBYWFv///wAAACH5BAEAAAYALAAAAAAQABAAAAMgaLrc/jBKFsBcg9g7iuaFZwlhaZrD1Ikqq35Xdc10PScAOw\x3d\x3d",includes:"Text Line Arrow Polyline PolylineArrow Circle Rectangle RoundedRectangle".split(" ")},
$ViewsSection:{id:"Views",name:"Views",_COMMENT1_:"Mobile-only view widgets, often representing a single screen of UI",iconBase64:"data:image/gif;base64,R0lGODlhEAAQANUAAC5KhTFOiPj6/jJRijRTjTRUjTdXkTdXkLrH3+Hp+OHp9zdakzZYkDdYkDlbkzlck97o+ODp+N/o9ztflj5km/L2/Pj6/T5mnD9mnT5lm0FqoENupENuo0Ruo0ZxpvL2+0l3rEl4rEh2qkl3q0l2qk6BtE1+sU+BtFCDtVCFt1CEtlSLvVOJulOHuVaOv7nW78/t+////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADIALAAAAAAQABAAAAaAQJlwSCwKXcikcilzxZ5QaApGVclWMUAWMFhgYiRYACGStaJoDKzyuchQr7hc3jAwGAeZCR1lKRIRLDIjWVtdXyUSEhAnMh58UCCKECEyGnOYHRsbHBwyFJBPGVQwFDIThQBcXjEOYggOMg+hMQUwFgIEsg+8vb0BwMBGw8TFQkEAOw\x3d\x3d",
includes:["ScrollableView","SwapView","View"]},$HeadingSection:{id:"Heading, Section Labels",name:"Heading",_COMMENT1_:"Mobile-only Heading widgets, often titles at top of a screen",iconBase64:"data:image/gif;base64,R0lGODlhEAAQAMQAAEh1qkd2q0d2qkh2q0h2qkt7r0t8r0+BtU6CtFGGuVGHuVSLvFaNv1WLvKzM6a3M6a3M6LfS7DJlklaOv4y64Iy635zD5J3E5KzN6azM6IK13Iy734273////////wAAACH5BAEAAB4ALAAAAAAQABAAAAVQoCeOZGmeaKqqU+u+LdN6U2Tf+D15S5ZJwIzjgXFkIJmGJ2GRtCSbTWc6vSg8hw0HCN1UKFotwlPQmM/os8FDIADcgYGAIJgD3qu8fs/nhwAAOw\x3d\x3d",
includes:["Heading","ToolBarButton"]},$ContainersSection_Dojo:{id:"ContainersSection_Dojo",name:"Dojo",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAg9JREFUeNp8ks1rE0EYxn9bE/xqikI0lITiQW+VImoONmCQtoonUbAglFDEUtlLxdo/wUNRD0Iw1kOIEmj6D9ir2FRQi4j0lILQJoimRfJB9mNmOx42iWsT+8Iw7DwPv32feUdTSuGtyeQKaT3GZHJlGEgA40AOyKT1WL6lt0rbC2hC9IFg7/a1c5HAib5Dc+WqOb/8pVjb3K4H03os6fVqXToYHgj2RiYun34KhD1S6c27jYeb2/ViWo/lW4c9dFYiPtgfMIQTNoRDw3YwbIeGcMLxwf5AM1a7fF0A436fL15pSNAUGqCUhqYp/P4Dc0AImNoPkNvaqX8MHDn4SkOBiwA0Kg1rHoh6zd0iZD4VyrWaKUpVQ1I1bSqGpGKI0udCuQZk/gu4+XhZpfXY2amRM88vnjq2vlMz7xn2biF41L8+FAl8f5a4cFw4u/mrj3KqK0BYNkDqzv3UyR6N32uFn9H334qhtY1fhyf0lzEgVd76oQDaEKVUe43NLirP97Rnn97rG5tdRCnldrCw9EFd0TNKNEwARmayCkg1tRdAavRBVo3OZAFwpMQR8m+E12+/YjcMzW4CpBsFF7AKgG1aCNM9l4bd9vjc7FZ73gDCtDpGIw27Oc5/9R6AuzeiSFsqRwjX7DH0hYK0fiKbHSSuDyEtq/MSu63zt56o/fRuL5HWxS4srTJ1+xL71Z8BAL+kU+9a36VRAAAAAElFTkSuQmCC",
includes:[["AccordionContainer","Accordion"],"BorderContainer","Container","ContentPane","FixedSplitter","Form","GridLayout","MenuBar","Pane","RoundRect","ScrollablePane","TabContainer","TitlePane","ToolBar"]},$ContainersSection_HTML:{id:"ContainersSection_HTML",name:"HTML",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjVFNUZFNTNBNTk0QjExRTBBNkY0ODEzNDdCMzkxNTdDIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjVFNUZFNTNCNTk0QjExRTBBNkY0ODEzNDdCMzkxNTdDIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NUU1RkU1Mzg1OTRCMTFFMEE2RjQ4MTM0N0IzOTE1N0MiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NUU1RkU1Mzk1OTRCMTFFMEE2RjQ4MTM0N0IzOTE1N0MiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5wB++kAAABAklEQVR42qRToQ7CMBC9LYhK5Bz9AyaHYhIHEomcYxI5iRwOOYkcDgkKWxxyuElwnSq5hpJ2tAvJXnK5vuvd60u7eUII6IOBTo67SafafH31foroQEWZR8IFVibis2/M+G3BV9NYTydkCJSGPy59WzOKtMMlYghUTwLsXsMsLQA4yIwc10GUyaBxLvusAuGigM3+BHFIJceMnFW182K/ApfbQ6jhdBnjoTLrIljjLgF9WIcu0ulgm8zgzCrID2ejATnWcV+htt3BdDzydBHOzWEaBLLGucMB4lQkXycIffivTxmBzYdsJdcqd8GHnmg5ILDfLrXHIpaHIwbz+v7ObwEGADGQtFOesBZAAAAAAElFTkSuQmCC",
includes:["\x3ca\x3e","\x3cdiv\x3e","\x3cspan\x3e","\x3ctable\x3e","\x3cstyle\x3e"]},$ContainersSection:{id:"Containers",name:"Containers",_COMMENT1_:"Desktop and mobile containers",_COMMENT2_:"Note that default desktop preset only include desktop widgets",_COMMENT3_:"and mobile preset only include mobile widgets",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAARJJREFUeNqkUzFuhEAMNFHqHAUEiU9Q0PKS3BNo6O9aJMQDqHkM4iG05CJdGgpgfXhvvVqyECHdSNaO7PWMsRYHEaGua+z7Hgi+7wPzLZh14kACZVniPM8yTM4xTZMOqpv8nZSEENqB+e/9DmIRJ6A6Xddd3aW8FFhcrFE/TifdaEHllymeAkQYQRBAURS7OwjDEFh2U6DrOrheLrDjDXmea64FxnHU4w7DIJt/bt+AAtVenqf36cs6/DcBc2piAUSxriszMn6DF2FNcAR45BM8z9tc5N+7lkAURZBl2a57HMe2gHxIajFt20JVVasHY06Spimcv87AfS8v0eG/sWkamUiSBJhvwawTd3bf+0E8BBgAL2nsdz3dOk4AAAAASUVORK5CYII\x3d",
subsections:["$ContainersSection_Dojo","$ContainersSection_HTML"]},$ListsSection:{id:"Lists",name:"Lists",_COMMENT1_:"Mobile-only List widgets",iconBase64:"data:image/gif;base64,R0lGODlhEAAQAMQAADlck9jf6ra/zGiKukNvpERvo/P3/Ex7r0x9sUx8r1KHuVKHuFaOv3io0bnW78jg8////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABEALAAAAAAQABAAAAVWYCSOZGmeptEwbNs2hmgwgWHfd8DETQD9wKAh0IgsDBBEcGlQRBLIpfTwdFiv2CsVKp1GCkhlF2IgRAaC8c8gGEQeAAFuLgA8RI8BYM/nD+4ogYKDgiEAOw\x3d\x3d",includes:"RoundRectCategory RoundRectList RoundRectDataList EdgeToEdgeCategory EdgeToEdgeList EdgeToEdgeDataList ListItem".split(" ")},
$ControlsSection_Buttons:{id:"Buttons",name:"Buttons",iconBase64:"data:image/gif;base64,R0lGODlhEAAQANUAAC5KhTFPijZXkDZYkDxhmTtimUJsouHr9/D1+0h2q0l3q7XQ7bbQ7bbQ7MLX79vo9k6AtE6Bs6TH6bbR7NLj9FKJu1OJulaNv5C95aTH6KTI6LXR7L/Z8Mje8laOv36z4X604JC95LnW77/a8Nzr9////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACUALAAAAAAQABAAAAZiwJJwSCwaj8hk0cP0XJpQj9ByqFqvVUSlFDk4vuCw4wApKR6MxmLCbm8mj0TJQNFI7nh8hmIoFTohGIKDgyEdBCUDHCAfHyCPkI0jAiUBIpeYmZckAUIAn6ChoEqkpaanRUEAOw\x3d\x3d",
includes:[["Button","\x3cbutton\x3e"],"ComboButton","DropDownButton","ToggleButton"]},$ControlsSection_CheckboxesRadios:{id:"CheckboxesRadios",name:"Checkboxes, RadioButtons, Switch",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAP9JREFUeNpi/P//P8PGnQf/M5AJWGAMf3d7kjUDLUYYAAITd94kWnO+uzqqC2DAQkGAgYEDwpbg4ICLv/jxA8IAUicefMD0Agw8+ABRCNL7geEHXBwkHG4uD2avuPAAtwEQS4Cqf3DAtX8A2p5urw6Xv3DjBZzNhMuPP6Da0TUHdu5ksNCQwG0ASEO8uToYv/iAqtmxcSODAjCMBAQ48BuAHtIwzQZAmzUkBIBhzIHfCyBnIgNkzQJIMYPVAJACkDNBmghpxhoLEkD/CXBIgBUXzjzI4GCgAHE2B4GkDE8HLxDpQACq8cWHH4TzAnqgkZyZQBmDHMAIys6UAIAAAwBz81X4fS5oMgAAAABJRU5ErkJggg\x3d\x3d",
includes:["CheckBox","RadioButton","Switch","TriStateCheckBox"]},$ControlsSection_IconContainer:{id:"IconContainer",name:"IconContainer",_COMMENT1_:"Mobile-only",iconBase64:"data:image/gif;base64,R0lGODlhEAAQAMQAACVLiiVLiDlck/P2+zxhlzpppj9mnDh3xUJtokdzp3ak21ON0FCDvEp6rU6As1SKvFaOv////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABEALAAAAAAQABAAAAVoYBRBZGmWIjSsbMtC0TMo9FzTyvBEzrD8PuBvMXBEGoODMrlUHgaNSMJFXSUiiAGgwNByvV1ExFClGiIEWw6nHhAigiBxKB8I4MynM2/Hl1t3cQFfg12FfXF/LHdwAo6PkI4ik5SVkyEAOw\x3d\x3d",
includes:["IconContainer","IconItem","IconMenu","IconMenuItem"]},$ControlsSection_Pickers:{id:"Pickers",name:"Pickers",iconBase64:"data:image/gif;base64,R0lGODlhEAAQANUAAKFMUiI5ZjxsuTlckz1jmj1jmVyL0T1kmUNvpERvpERuo0Rvo16W2jx7wEeO4Et7r0x7r26ayUt8r0x8rqrS+lGHuVKHuZXN/1aOv6u7yJypq+38++v6+aiysJ6uqWpNK5RcON6CV+esnbq2tf/X0t26tuxmXtaJhL+Zmf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACkALAAAAAAQABAAAAZswJRwSCwSA8YhUrlMBpbPpjEqfCarUmlRezVivmBMKgweXyIMgUGMOafXKcvog2o4LKnKvH5PTUIgIh0UECkPgIIUEikLGQAnGxoJKQiOkBoKKQUcJSYkHgUpBJyeHgcpA6mqA6irqV2wsUJBADs\x3d",
includes:"Carousel CarouselItem DataCarousel DatePicker SpinWheel SpinWheelSlot SpinWheelDatePicker SpinWheelTimePicker TimePicker ValuePicker ValuePickerSlot ValuePickerDatePicker ValuePickerTimePicker".split(" ")},$ControlsSection_Select:{id:"Select",name:"Select",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAVJJREFUeNpi/P//PwMlgAVEhPcf+E+RAb++fWeoz3QlqLhxxh6G+gwXBH/6bgYmEOPHp69gAVGGvwxijH8ZhP/9AbNhWJwRgn9+/AxWl5TYy/D61hOgvi8QF3z/8Akswc/JjGLjfwZGMM0IZIHY3z5ADDi4ogQs+23+XgZGUCBaRE4EByUjRBeUATOEASoANe4/0DhGqOh/aBjIm+kzfn37/n+IkxZJAbhm3zWIAX9//WHg4OVlMDBQZhD6+5doA7aceQQx4M/PnwywePRN6IVEDzsrAysnJwMHDxcDGxCDaFZODoZJqfZwA/78+AWLxh9wf+9cWkK0C359/wEx4DeQAXOBe3QPXhfAwKwsJ3D6gSckmAGHV5cT7YLf36AuADkFBmxDO4lyweJCZ7DLIbEADIz/0DA4vaGSeBcA9YETkpF/JyLNMGBJTXgAI6XZGSDAAJsyjhMJL+H/AAAAAElFTkSuQmCC",
includes:["ComboBox","DropDownButton",["DropDownSelect","\x3cselect\x3e"],"FilteringSelect","MultiSelect","Select","\x3cselect\x3e"]},$ControlsSection_SlidersSpinners:{id:"SlidersSpinners",name:"Sliders, Spinners",iconBase64:"data:image/gif;base64,R0lGODlhEAAQANUAAM7W5DdYkDteljpfloOcwUBonkBonUFonkdzqEdzp3CUv+Tt+EZzp9Xk9Njm9dvo9kx+sU1+sZ/E6K3M68re8tDh89fm9VKHuYO14pC95ZG95Z/F6KzM663N68ne8tDi89Xl9FaOv4O24pG+5aDJ6tXj76nR7v///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACcALAAAAAAQABAAAAZZwJNwSCwaj8ikcjkMOZ/J0KJBbSxCyMtnwulMPpdiKcSIUDZoiSfCCJWEERIB8RhpMppHglCBCA0mJgoHFiIYDgYKgQVCAAGPAQIgIAOQAQBIj0ybnJ2eJ0EAOw\x3d\x3d",
includes:["HorizontalSlider","NumberSpinner","Slider","TimeSpinner","VerticalSlider"]},$ControlsSection_TextBox:{id:"TextBox",name:"TextBox",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAM1JREFUeNpi/P//PwMlgImBQkCxASzIHIvIif/lzfQZHp66yHBieT4jUSaAwgAZm0dM+I8uhg+DXRDefwAckqGWCmBD15x48H/18QcELV9Z6MAINuDPz98MtWmODBKcTAw9QL6NvhyDipoMXs0ts/chwuD39+9gDjfDfzgtyvAXe6hDQ+bXtx8IA94+eArmsLMywml+Bmbc4cbAyPD24VOEAX9//WLIyJ7KkBJiARZctPE0w5w1JxjoEgtM2NIBiCY2ITEO/bxAsQEAAQYAGVGarS2fPq4AAAAASUVORK5CYII\x3d",
includes:[["TextBox","\x3cinput\x3e"],"ComboBox","CurrencyTextBox","DateTextBox","DateTimeTextBox","NumberTextBox","SimpleTextarea",["Textarea","TextArea","ExpandingTextArea"],"ValidationTextBox","TimeTextBox"]},$ControlsSection_Toolbars:{id:"Toolbars",name:"Toolbars, ButtonBars",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOtJREFUeNpi/P//PwMlgAVEhPcf+E+RAX9+/mKoTXMiWXPTzH0MTCDGzy9f4YIxmZOIokHg19dvDIygMHAtWPq/vjQYLPgfCHecf8ngaSTOsP0cHtpQgqGxey3ECyCT3n/9CdINNsJCTZDh/ZdfcNoSRH9G8C1UBYDqfyBcYJowg7JAlJCVYGgu9CFZc+2ErRAD/v39BxZQ4STNgL9//kBi4R+QQQ749+cvzIC/ZBoAdcFfSl3w69t3sgwA6QMb8PsfeVH4599/aCwA00Jy2QIG5n+YJv1lYgKLw+h/QBqUaCBizJCERAkACDAAug6MMt3XrLUAAAAASUVORK5CYII\x3d",
includes:["TabBar","TabBarButton","Toolbar"]},$ControlsSection_Other:{id:"Other",name:"Other",iconBase64:"data:image/gif;base64,R0lGODlhEAAQANUAADlckzthmDxhl0BonkBonUVwpUp6rU+BtU+CtFOJu1OKu1aOv/b8//n9/8/t++/6//L7/+v5/+76//X8//j9/+v6/+77/+/7//L8//b9//X9//n+//j+///ovfvcsvTKofTJofbKo/TJo/TKo+20kOegfeeffuegfuWfff///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACkALAAAAAAQABAAAAZfwJRwSCwaj8ikUrloOp/QVIJErZIc2Kwiheh4v9dKpEI+pAyetPp6eVgsEkOq8AGNRKAQyoGB9DEFKQRWVHsTGgwaGQMpAiclJiYoJ3sNDRwbFAEpAJ2en6BLoqOkpEEAOw\x3d\x3d",
includes:["ProgressIndicator","Rating","SearchBox"]},$ControlsSection:{id:"Controls",name:"Controls",_COMMENT1_:"each section can either have an array of subsections or an array of includes",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjgyQUEwNTdCNTk1MTExRTBCODIzOTk0QzIzMzdBNkNGIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjgyQUEwNTdDNTk1MTExRTBCODIzOTk0QzIzMzdBNkNGIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ODJBQTA1Nzk1OTUxMTFFMEI4MjM5OTRDMjMzN0E2Q0YiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6ODJBQTA1N0E1OTUxMTFFMEI4MjM5OTRDMjMzN0E2Q0YiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7ZOYfnAAABBUlEQVR42pRSKxCDMAztdgjkJBKJnKxETk5WIpGTlcjKykpk5SSyEolETk4iI9eRrpSud7tF5NK8vHweHHoz38cHSdmVlhFkM5lN9W2dJDTKRJDNZBgxrum5oOdynB7j9NSC+aJhXjC4VCfrHQErLO0dsN2cBUDwjosOn0fyy2y19+8JsMDWjMA3QSkRPjMCW9GJ5CFWFzllu+qW1RmsXfHoW0OlNv7oYX52XRsS+rtVCbajrdGq9EeH2/rMQfZGaRPNxYwPdivpYRo1D8W+tAo3kVJ/Q+478Bt32UH5PSAFHWFVqVllRr/ploLc0VWRCyl2nT9BBDlZ8T8hKUYE/a3SS4ABAP4rm5Sxt9t9AAAAAElFTkSuQmCC",
subsections:"$ControlsSection_Buttons $ControlsSection_CheckboxesRadios $ControlsSection_IconContainer $ControlsSection_Pickers $ControlsSection_Select $ControlsSection_SlidersSpinners $ControlsSection_TextBox $ControlsSection_Toolbars $ControlsSection_Other".split(" ")},$HTMLSection_Common:{id:"Common",name:"Common",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAALNJREFUeNpi/P//P4NUxvb/DGQCFhjj2QxPkjUDLWZgYqAQgA34//8fmNO74TIcwwCMjU2MAagPbADTv79wyeIAXTBG1oALMAL1gcOA8f9vgoqRDQWxIfr+QF3w9w95/v/7C+qCf78x/AezBa8XgC5gAKUDhZh5/8kBIH3QQPxNlhdALqdOOmD8+5vMQIS6gPH/X/K8ANQHDQMyoxEYC9CE9I9BI6SHdBeA9f7/T1EgAgQYAMdnhUefY5wVAAAAAElFTkSuQmCC",
includes:["\x3ca\x3e","\x3cdiv\x3e","\x3clabel\x3e","\x3cspan\x3e","\x3cstyle\x3e"]},$HTMLSection_Forms:{id:"Forms",name:"Forms",iconBase64:"data:image/png;base64,R0lGODlhEAAQAOYAAPT2/PH0+/n6/Iaavoyfwt/o+OLq+Onv+pOmxt/o9+bt+N7k7unv+e3y+sbT59/p+OLr+PD0+t/p9/D1+/f5+5DDvKfMxgBZSqfNxgJbSqjNxqjMxQZeSqjNxQZfSgpiSgphSg9mSrXSyRNrShNqSb3Vy5zKtp3Ktr3Wy5zKtZ3KtR1zSaDMtSJ3ScTYzSZ6SSZ7SSl+SSl9SSp+SSp9SaTNtCyASXt0T392ToV5TIx8SpOASKOIQ5yEReDIj97WwbSQPbCOPquLQNSyaNSyadq9fObav9Wyaf///////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAEkALAAAAAAQABAAAAeQgEmCg4SFhoeIhECLi4g2NklASEgCRECHNi40RpMURUdBgjAxMzIzKCUvSAgAPkVDQkktIrS1Ii0RExERATxJKx0bGhYdGMIrDgQDDT1JJBXQ0dAjDAwHDDtJISYnKSom3CEOCMoKOkkgHOoeLCwfCxAG8hA5hRk1HD8J+w8SBTiFLlxIcqOgwYKJEipcaCgQADs\x3d",
includes:"\x3cbutton\x3e \x3cfieldset\x3e \x3cform\x3e \x3cinput\x3e \x3cselect\x3e \x3ctextarea\x3e".split(" ")},$HTMLSection_Headers:{id:"Headers",name:"Headers",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIpJREFUeNpi/P//PwMlgImBQkCxASwggtW3bzeQcgFiVx5NrT0gsS/Xr2GIwQBQbiaQSgPJkewCoOZyqGaEC4jUqASkQK5SIjcMlKC4Aoj34HLBbqBNuAy4B8TKwPC4B1TjgsuAs0D8Hso2BmJBmARIIzHRWAFUCAp1V6hhQyAhUWwA49DPTAABBgDGmykkJRol4AAAAABJRU5ErkJggg\x3d\x3d",
includes:["\x3ch1\x3e","\x3ch2\x3e","\x3ch3\x3e"]},$HTMLSection_ImagesMediaIframes:{id:"ImagesMediaIframes",name:"Images, Media, Iframes",iconBase64:"data:image/gif;base64,R0lGODlhEAAQANUAAOnn6f////7+/v39/fz8/Pr6+vn5+ff39/X19fT09PLy8vHx8e/v7+fn59/f397e3tvb29bW1sfHx8LCwsHBwby8vLq6urm5uba2trS0tLKysq2traKioqCgoJycnJSUlJKSkpGRkYuLi4qKiomJiYSEhHh4eHV1dXR0dGlpaWhoaFxcXP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACwALAAAAAAQABAAAAaPQBYLNAQZjcJk0mgJOBeEkXI5jEwmHMJCNC1uIBNKxzTwEJWhocPxkAQIBgY3+QFpAJTJxnRarU5KRCANVxkcFygsJIEfGAx5eQoZSFQgCQkIlwREaUsgFwdXYQIXlEJpIAWiFAEfQ4EgFQFheQEWpq8gTrsBnLBNkBO2dWhDsxTIrSydQioqKc7P0iolQkEAOw\x3d\x3d",
includes:["\x3caudio\x3e","\x3cembed\x3e","\x3cimg\x3e","\x3ciframe\x3e","\x3cvideo\x3e"]},$HTMLSection_ParagraphsFormatting:{id:"ParagraphsFormatting",name:"Paragraphs, Breaks, Rules",iconBase64:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAEZ0FNQQAAsY58+1GTAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAHGSURBVHjaZFLJbhNREKx+b2Yc7xs2EEVZlEgR4oKEOHLiH/gEfokP4EM4I0UcEApCkYAoIDlWGC9je2ymFw4zA9jUqaWu6up6r+nT1XWn1QDAnMEU2/BB5HxoxjAAmM4XQb/TGtzrcBprfOXC2l8ugVnHox+9w6eN7kGhdy4QVQCrZB7WjqOykYMZy9E0vXg9fPKqOzgCIKou76kZs6w2WbL6laRZkmarDXNmlfqg2xvefngzGX/NbYNimkFU3328niTrMKrA+Ua18vzRg73W4ab20iq38eimOzwBSoGamWLQaVSj0PuAnAO591/uWG2/1z46aU++X+bMPw7GgpvxLJ4tgzByPiDnyXkxNKt7+83Iygd0JR/MCjgiclTAERHBDBmriG05qGrG+uLZuUk5oIQYVou5qm4JzCCii1QlYxBgAIEAGMg7EdUdBzMTsbcXn+N5EoYR+ZCcd96z4Pygd9orvuvfDMZS7GEglBUoNzfV3Qym8I/PjjebdZ4WRCAyo2atwpLuCgDcfbvsCwfCO6GXoFUyrQfrQuCdA/Dw+CyKIsDyRXZg9xvt/rA4vp/TuagSka8PczL9JyDQbC26jKezxe8BAJ6U+/2r7MIJAAAAAElFTkSuQmCC",
includes:"\x3cb\x3e \x3cbr\x3e \x3cem\x3e \x3chr\x3e \x3ci\x3e \x3cp\x3e \x3cs\x3e \x3cstrong\x3e \x3cu\x3e".split(" ")},$HTMLSection_Tables:{id:"Tables",name:"Tables",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAXhJREFUeNrEUz1LA0EQnTvzO/wPYsBOrQW109ImpLPIL9DWKqQQRESEFGKjYmGwEyQggUTBRn+BIhFFTXK53Z1xZi53ulcpKdxjmXnD7Lv39iMgIhhnhDDmKKTJavXyz1KOKvNBRkCIsFWe09wxFbI1iTEy5ppB0shB69v1K18BOdTYvHvUZm1k0oi7rUwhIIkAs8VJQESfwMQxVGoXv5Le7jxAwF/yZ2aVubRxRjKYmWJrqXZyQ/3I0HtvSG8fA8Xd1z49v/ToqftJi5va/30KJhqOyGQ/WL6xCcZkCkakrMcOopyFKGKvCGLNslFrDMTGqX8hECz7AKN7YwZDnwC5uXp47XndPW17uN64zXK0zidwzsH6yozKNKxg57gFpeUi11EtHZx3YG1hKiNoNO9zx8iMcjRigWQFYuJfVAMp/jmcRf8qG90sUAWoEWUZpG8FcwRICQ7ShunSniYToiIMIb3XguXELdcKnEtM6639chD8+2v8EmAA9/wqJKl9P7kAAAAASUVORK5CYII\x3d",
includes:["\x3ctable\x3e"]},$HTMLSection:{id:"HTML",name:"HTML",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjVFNUZFNTNBNTk0QjExRTBBNkY0ODEzNDdCMzkxNTdDIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjVFNUZFNTNCNTk0QjExRTBBNkY0ODEzNDdCMzkxNTdDIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NUU1RkU1Mzg1OTRCMTFFMEE2RjQ4MTM0N0IzOTE1N0MiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NUU1RkU1Mzk1OTRCMTFFMEE2RjQ4MTM0N0IzOTE1N0MiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5wB++kAAABAklEQVR42qRToQ7CMBC9LYhK5Bz9AyaHYhIHEomcYxI5iRwOOYkcDgkKWxxyuElwnSq5hpJ2tAvJXnK5vuvd60u7eUII6IOBTo67SafafH31foroQEWZR8IFVibis2/M+G3BV9NYTydkCJSGPy59WzOKtMMlYghUTwLsXsMsLQA4yIwc10GUyaBxLvusAuGigM3+BHFIJceMnFW182K/ApfbQ6jhdBnjoTLrIljjLgF9WIcu0ulgm8zgzCrID2ejATnWcV+htt3BdDzydBHOzWEaBLLGucMB4lQkXycIffivTxmBzYdsJdcqd8GHnmg5ILDfLrXHIpaHIwbz+v7ObwEGADGQtFOesBZAAAAAAElFTkSuQmCC",
subsections:"$HTMLSection_Common $HTMLSection_Forms $HTMLSection_Headers $HTMLSection_ImagesMediaIframes $HTMLSection_ParagraphsFormatting $HTMLSection_Tables".split(" ")},$AppOtherSection:{id:"Other",name:"Other",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAcFJREFUeNqcUj1IQlEUPjfc+llqCEKwpaCgrJZqKOhnqiChsbQhF+f2moqgpaH2rDEqiiCwBB2sRbJArYa0hohSCLTQ93rvds95710VHaIDx/P5ne+ce869j3HOAW039MCPr9PwV5sddIBntJPZLAKLV+eHCDMpY2UlnP5bvyv7V9gA6qx04bMAmbwKmZwiXIWPvAI9bY0iFikSh7m8QhrUo9nKx8IknsTFGYyXcwDvohHDgbgxhWUVDbJfijE23osIO+Fnmnw79CKKzTJswEot5Aq+uV6Ix+6FJ8HewCESjJIjTtwmKWev5xAXOCEw6o2G4jR039Y5z+WK5H/FWCdX4HppLEykMtkqrJu4vaWZML2T9R2cRtP8LJygS5wa6QYDg8BdNbChmRlwMLmCd/NUjmfhu9Qr4enlALl384Q4S4N18hJ1XYeaWNMk1rRqTcUKR4Ebwq7JPiAsnss10Q9HFyY/YfKmpmKFpY0T/v2tkrvXDig+vWX54vohRXTUYMScR2gqXqGoFEqvYI7X2tQkxv6hSBq1IHHVCoHII/cHY/QJL4w7wX8ZI94t8J7gUYYYNcSPOWFyuIPJBv+1XwEGAJJgewSkj0bcAAAAAElFTkSuQmCC",
includes:"Calendar ColorPalette GridX RichText StickyNote Tree $$AllOthers$$".split(" ")},$SketchOtherSection:{id:"Other",name:"Other",iconBase64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAcFJREFUeNqcUj1IQlEUPjfc+llqCEKwpaCgrJZqKOhnqiChsbQhF+f2moqgpaH2rDEqiiCwBB2sRbJArYa0hohSCLTQ93rvds95710VHaIDx/P5ne+ce869j3HOAW039MCPr9PwV5sddIBntJPZLAKLV+eHCDMpY2UlnP5bvyv7V9gA6qx04bMAmbwKmZwiXIWPvAI9bY0iFikSh7m8QhrUo9nKx8IknsTFGYyXcwDvohHDgbgxhWUVDbJfijE23osIO+Fnmnw79CKKzTJswEot5Aq+uV6Ix+6FJ8HewCESjJIjTtwmKWev5xAXOCEw6o2G4jR039Y5z+WK5H/FWCdX4HppLEykMtkqrJu4vaWZML2T9R2cRtP8LJygS5wa6QYDg8BdNbChmRlwMLmCd/NUjmfhu9Qr4enlALl384Q4S4N18hJ1XYeaWNMk1rRqTcUKR4Ebwq7JPiAsnss10Q9HFyY/YfKmpmKFpY0T/v2tkrvXDig+vWX54vohRXTUYMScR2gqXqGoFEqvYI7X2tQkxv6hSBq1IHHVCoHII/cHY/QJL4w7wX8ZI94t8J7gUYYYNcSPOWFyuIPJBv+1XwEGAJJgewSkj0bcAAAAAElFTkSuQmCC",
includes:"Calendar ColorPalette GridX RichText StickyNote Tree $$AllOthers$$".split(" ")},$mobileSections:"$ViewsSection $HeadingSection $ListsSection $ControlsSection $ContainersSection $HTMLSection $ClipartSection $XBLOXSection $DrawingToolsSection $AppOtherSection $StatesSection".split(" "),$desktopSections:"$ContainersSection $ControlsSection $ViewsSection $HeadingSection $ListsSection $HTMLSection $ClipartSection $XBLOXSection $DrawingToolsSection $AppOtherSection $StatesSection".split(" "),
$sketchSections:"$DrawingToolsSection $ClipartSection $ControlsSection $ContainersSection $HTMLSection $HeadingSection $ListsSection $SketchOtherSection".split(" "),$sketchExcludes:["dojox.mobile.ScrollableView","dojox.mobile.SwapView","dojox.mobile.View"],$ALLMOBILE_Sections:"$ViewsSection $HeadingSection $ListsSection $ControlsSection $ContainersSection $HTMLSection $ClipartSection $XBLOXSection $DrawingToolsSection $AppOtherSection $StatesSection".split(" "),$ALLDESKTOP_Sections:"$ContainersSection $ControlsSection $ViewsSection $HeadingSection $ListsSection $HTMLSection $ClipartSection $XBLOXSection $DrawingToolsSection $AppOtherSection $StatesSection".split(" "),
$deliteSections:["$HTMLSection","$XBLOXSection","$DELITESection","$StatesSection"],$ALLDELITE_Sections:["$HTMLSection","$XBLOXSection","$DELITESection"],$DELITESection_Controls:{id:"delite",name:"Controls",iconBase64:"data:image/gif;base64,R0lGODlhEAAQALMAAN7e4oyMjtXV1sDAwf///+Dg4MvLyzMzM////wAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAgALAAAAAAQABAAAAQ3EMlJq704a3RO2NIhBIexHYRgeFTndkQ8HmER33g60EcB/ECcYBd6wWSkDErFUs5Mms4HRK1SIwA7",includes:"Button Slider Combobox Select Checkbox RadioButton Switch ToggleButton MediaPlayer".split(" ")},
$DELITESection_Containers:{id:"delite",name:"Containers",iconBase64:"data:image/gif;base64,R0lGODlhEAAQALMAAN7e4oyMjtXV1sDAwf///+Dg4MvLyzMzM////wAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAgALAAAAAAQABAAAAQ3EMlJq704a3RO2NIhBIexHYRgeFTndkQ8HmER33g60EcB/ECcYBd6wWSkDErFUs5Mms4HRK1SIwA7",includes:["ViewStack","Panel","TabBar","Accordion"]},$DELITESection_States:{id:"delite",name:"States",iconBase64:"data:image/gif;base64,R0lGODlhEAAQALMAAN7e4oyMjtXV1sDAwf///+Dg4MvLyzMzM////wAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAgALAAAAAAQABAAAAQ3EMlJq704a3RO2NIhBIexHYRgeFTndkQ8HmER33g60EcB/ECcYBd6wWSkDErFUs5Mms4HRK1SIwA7",
includes:["CSSState"]},$DELITESection:{id:"delite",name:"Deliteful",iconBase64:"data:image/gif;base64,R0lGODlhEAAQAKIAAFhYWtXV1v///0BAQP///wAAAAAAAAAAACH5BAEAAAQALAAAAAAQABAAAAMuSLo0w5CNIF6EM9grN2+Z82WCEGjcVJbopa5tlJ2nh4W2XH9LyCu+X/AHAPyOCQA7",subsections:["$DELITESection_Controls","$DELITESection_Containers"],includes:[]},$StatesSection:{id:"States",name:"States",iconBase64:"data:image/gif;base64,R0lGODlhEAAQAKIAAL+/v5aWlmNjYzMzMxwcHBYWFv///wAAACH5BAEAAAYALAAAAAAQABAAAAMgaLrc/jBKFsBcg9g7iuaFZwlhaZrD1Ikqq35Xdc10PScAOw\x3d\x3d",
includes:["CSS","Style"]}},_COMMENT11_:"Should have one each for mobile, desktop, sketchhifi, sketchlofi",_COMMENT12_:"For each preset, collections is list of each widget collection in order of precedence",_COMMENT13_:"and sections is the array of sections for this preset (or $desktopSections)",presets:{mobile:{collections:[{id:"dojoxmobile",show:!0},{id:"dijit",show:!1},{id:"html",show:!0},{id:"clipart",show:!0},{id:"shapes",show:!0}],sections:"$mobileSections"},desktop:{collections:[{id:"dijit",
show:!0},{id:"dojoxmobile",show:!1},{id:"html",show:!0},{id:"clipart",show:!0},{id:"xblox",show:!0},{id:"shapes",show:!0},{id:"delite",show:!0}],sections:"$desktopSections"},delite:{collections:[{id:"dijit",show:!1},{id:"dojoxmobile",show:!1},{id:"html",show:!0},{id:"xblox",show:!0},{id:"delite",show:!0},{id:"shapes",show:!0},{id:"clipart",show:!0}],sections:"$deliteSections"},sketchhifi:{collections:[{id:"shapes",show:!0},{id:"clipart",show:!1},{id:"dijit",show:!0},{id:"dojoxmobile",show:!0},{id:"html",
show:!0}],sections:"$sketchSections",exclude:"$sketchExcludes"},sketchlofi:{collections:[{id:"shapes",show:!0},{id:"clipart",show:!1},{id:"dijit",show:!0},{id:"dojoxmobile",show:!1},{id:"html",show:!0}],sections:"$sketchSections",exclude:"$sketchExcludes"},$ALLMOBILE:{_COMMENT1_:"$ALLMOBILE is a special preset which shows all widgets",_COMMENT2_:"regardless of the current composition type",_COMMENT3_:"ranking mobile widgets above desktop widgets",collections:[{id:"dojoxmobile",show:!0},{id:"dijit",
show:!0},{id:"html",show:!0},{id:"clipart",show:!0},{id:"xblox",show:!0},{id:"shapes",show:!0}],sections:"$ALLMOBILE_Sections"},$ALLDESKTOP:{_COMMENT1_:"$ALLDESKTOP is a special preset which shows all widgets",_COMMENT2_:"regardless of the current composition type",_COMMENT3_:"ranking desktop widgets above mobile widgets",collections:[{id:"dijit",show:!0},{id:"dojoxmobile",show:!0},{id:"html",show:!0},{id:"clipart",show:!0},{id:"xblox",show:!0},{id:"shapes",show:!0}],sections:"$ALLDESKTOP_Sections"},
$ALLDELITE:{_COMMENT1_:"$ALLDESKTOP is a special preset which shows all widgets",_COMMENT2_:"regardless of the current composition type",_COMMENT3_:"ranking desktop widgets above mobile widgets",collections:[{id:"dijit",show:!1},{id:"dojoxmobile",show:!1},{id:"html",show:!0},{id:"clipart",show:!0},{id:"xblox",show:!0},{id:"shapes",show:!0},{id:"delite",show:!0}],sections:"$ALLDELITE_Sections"}}}:this._initializationInfo[a]},getDefaultThemeSet:function(){return this.getSiteConfigData("defaultThemeSet")},
getUserDisplayName:function(a){a||(a=this.getUser());var f=a.userDisplayName;a.userDisplayName||(f=a.email);return f},getUserEmail:function(a){a||(a=this.getUser());return a.email},getUserDisplayNamePlusEmail:function(a){a||(a=this.getUser());var f=this.getUserDisplayName(a);f!=a.email&&(f+=" \x26lt;"+a.email+"\x26gt;");return f},loadPlugins:function(){a.forEach(function(a){var f=a.id;g.plugins[f]=a;for(var d in a){var c=a[d];"string"!=typeof c&&(c instanceof Array?c.forEach(function(c){g._addExtension(d,
c,f)}):g._addExtension(d,c,f))}})},singleUserMode:function(){return g.isLocalInstall},_stripMaqetta:!0,location:function(){var a=document.location.href.split("?")[0],a=a.replace("index.php",""),a=a.replace("maqetta.html",""),a=a.replace("xui.php",""),a=a.replace("xui.php?debug\x3dtrue",""),a=a.replace("maqettar.html",""),a=a.replace("index.html",""),a=a.replace("?",""),a=a.replace("debug\x3dtrue",""),a=a.replace("\x26isDesktop\x3dtrue","");this._stripMaqetta&&(a=a.replace("maqetta/",""));return a},
getUserWorkspaceUrl:function(){if(this.userBaseUrl)return this.userBaseUrl},run:function(){dojo.isMac&&dojo.addClass(document.documentElement,"isMac");var a=document.body.style;g.supportsCSS3Transitions=void 0!==a.WebkitTransition||void 0!==a.MozTransition||void 0!==a.OTransition||void 0!==a.transition;g.subscribe("/davinci/ui/selectionChanged",g._selectionChanged);dojo.connect(dojo.doc.documentElement,"onkeypress",function(a){8==a.charOrCode&&(window.davinciBackspaceKeyTime=Date.now())});dojo.connect(dojo.doc.documentElement,
"onkeydown",this,"_handleGlobalDocumentKeyEvent");dojo.addOnUnload(function(a){for(var d=null,c=davinci.Workbench&&davinci.Workbench.editorTabs?davinci.Workbench.editorTabs.getChildren():[],q=0,n=0;n<c.length;n++){var b=c[n];b.editor&&(b=b.editor.getOnUnloadWarningMessage())&&(d||(d=b),q++)}1<q&&(d=dojo.string.substitute(p.multipleFilesUnsaved,[d,q]));!d&&100>Date.now()-window.davinciBackspaceKeyTime&&(d=p.careful);if(d){if(a=a||window.event)a.returnValue=d;return d}})},subscribe:function(a,f){g.subscriptions.push(dojo.subscribe(a,
this,f))},destroy:function(){dojo.forEach(g.subscriptions,dojo.unsubscribe)},_addExtension:function(a,f,d){f.id&&(f.id=d+"."+f.id);g.extensionPoints[a]=g.extensionPoints[a]||[];d=g.extensionPoints[a];d.push(f);g.extensionPoints[a]=d},getExtensions:function(a,f){var d=g.extensionPoints[a];if(f){var c=f instanceof Function;if(d)return d.filter(function(d){return c&&f(d)||d.id==f})}return d},getExtension:function(a,f){return g.getExtensions(a,f)[0]},handleError:function(a){var f="welcome";g.singleUserMode()&&
(f=".");window.document.body.innerHTML=dojo.string.substitute(p.serverConnectError,{redirectUrl:f,error:a})},executeCommand:function(a){(a=g.getExtension("davinci.commands",a))&&a.run&&a.run()},_selectionChanged:function(a){g.currentSelection=a},getSelection:function(){return g.currentSelection},serverJSONRequest:function(a){var f,d={handleAs:"json"};dojo.mixin(d,a);dojo.xhrGet(d).then(function(c){c&&(f=c)});return f},registerKeyBinding:function(a,f){this._globalKeyBindings||(this._globalKeyBindings=
[]);this._globalKeyBindings.push({keyBinding:a,action:f})},handleKeyEvent:function(a){this._handleKeyEvent(a,!0)},_handleGlobalDocumentKeyEvent:function(a){this._handleKeyEvent(a)},_handleKeyEvent:function(a,f){if(this._globalKeyBindings){var d=!1;(d=dojo.some(this._globalKeyBindings,dojo.hitch(this,function(c){if(g.isKeyEqualToEvent(c.keyBinding,a))return davinci.Workbench._runAction(c.action),!0})))?dojo.stopEvent(a):f||this.currentEditor&&this.currentEditor.handleKeyEvent&&this.currentEditor.handleKeyEvent(a,
!0)}},isKeyEqualToEvent:function(a,f){var d=!0,c=f.altKey&&!dojo.isMac||dojo.isMac&&f.ctrlKey;!!a.accel!==(f.ctrlKey&&!dojo.isMac||dojo.isMac&&f.metaKey)&&(d=!1);!!a.meta!==c&&(d=!1);!!a.shift!==f.shiftKey&&(d=!1);d&&a.charOrCode&&f.which&&(d=dojo.isArray(a.charOrCode)?dojo.some(a.charOrCode,dojo.hitch(this,function(c){return this._comparecharOrCode(c,f)})):this._comparecharOrCode(a.charOrCode,f));return d},_comparecharOrCode:function(a,f){return dojo.isString(a)?a.toLowerCase()===String.fromCharCode(f.which).toLowerCase():
a===f.which}};return g})},"davinci/commands/CommandStack":function(){define(["dojo/_base/declare"],function(p){return p("davinci.commands.CommandStack",null,{constructor:function(m){this._context=m;this._undoStack=[];this._redoStack=[]},execute:function(m,h){if(m){var e;e=this._context&&"davinci.ve.themeEditor.Context"!=this._context.declaredClass?dojo.withDoc(this._context.getDocument(),"execute",m,[this._context,h]):m.execute(h);this._undoStack.push(m);this._redoStack=[];if(!e)this.onExecute(m,
"execute")}},undo:function(){if(this.canUndo()){var m=this._undoStack.pop();m._runDelegate?m._runDelegate.undoDelegate(m):this._context&&"davinci.ve.themeEditor.Context"!=this._context.declaredClass?dojo.withDoc(this._context.getDocument(),"undo",m):m.undo();this._redoStack.push(m);this.onExecute(m,"undo")}},redo:function(){if(this.canRedo()){var m=this._redoStack.pop();m._runDelegate?m._runDelegate.redoDelegate(m):this._context&&"davinci.ve.themeEditor.Context"!=this._context.declaredClass?dojo.withDoc(this._context.getDocument(),
"execute",m):m.execute();this._undoStack.push(m);this.onExecute(m,"redo")}},canUndo:function(){return 0<this._undoStack.length},canRedo:function(){return 0<this._redoStack.length},getUndoCount:function(){return this._undoStack.length},getRedoCount:function(){return this._redoStack.length},clear:function(){this._undoStack=[];this._redoStack=[]},jump:function(m,h){var e=this.getUndoCount(),b=this.getRedoCount();if(m==e)return m;if(0>m||m>e+b)return-1;e=m-e;if(h)if(0>e)for(;0>e;)this._redoStack.push(this._undoStack.pop()),
e++;else for(;0<e;)this._undoStack.push(this._redoStack.pop()),e--;else if(0>e)for(;0>e;)this.undo(),e++;else for(;0<e;)this.redo(),e--;return m},onExecute:function(m,h){},undoDelegate:function(m){},redoDelegate:function(m){}})})},"davinci/ui.plugin":function(){define(["require"],function(p){return{id:"davinci.ui","davinci.view":[{id:"navigator",title:"Files",viewClass:"davinci/workbench/Explorer",iconClass:"paletteIcon paletteIconFiles"},{id:"hierarchy",title:"Hierarchy"},{id:"devices",title:"Devices",
viewClass:"davinci/workbench/DeviceTreeView",iconClass:"paletteIcon paletteIconOutline"},{id:"files",title:"XFiles",viewClass:"davinci/workbench/FileView",iconClass:"paletteIcon paletteIconOutline"},{id:"comment",title:"Comments",viewClass:"davinci/review/view/CommentView",iconClass:"paletteIcon paletteIconComments"},{id:"scope",title:"Scope"},{id:"properties",title:"Properties",viewClass:"davinci/workbench/PropertyEditor"},{id:"console",title:"Console"},{id:"history",title:"History"},{id:"search",
title:"Search"}],"davinci.preferences":[{name:"Project",id:"project",hide:!0,category:"",pageContent:"Project Settings here"},{name:"Project Settings",id:"ProjectPrefs",category:"davinci.ui.project",pane:"davinci/ui/ProjectPreferences",defaultValues:{webContentFolder:"",themeFolder:"themes",widgetFolder:"lib/custom"}}],"davinci.perspective":{id:"main",title:"AJAX IDE",views:[{viewID:"davinci.ui.navigator",position:"left-bottom"},{viewID:"davinci.ui.outline",position:"right"},{viewID:"davinci.ui.properties",
position:"right-bottom"}]},"davinci.actionSets":[{id:"editorActions",visible:!0,menu:[{__mainMenu:!0,separator:["new",!1,"open",!1]},{label:"Create",path:"new",id:"davinci.new",separator:["newApp",!0,"newSketch",!0,"newFolder",!0,"newTheme",!0,"newProject",!0,"additions",!0]},{label:"Open",path:"open",id:"davinci.open",separator:["openFile",!0,"openTheme",!0,"openOrion",!1,"additions",!1]}],actions:[{id:"newHTMLMobile",run:function(){p(["./ui/Resource"],function(m){m.newHTMLMobile()})},iconClass:"newOpenMenuItem newMobileAppMenuItem",
label:"Mobile Application...",menubarPath:"davinci.new/newApp"},{id:"newHTMLDesktop",run:function(){p(["./ui/Resource"],function(m){m.newHTMLDesktop()})},iconClass:"newOpenMenuItem newDesktopAppMenuItem",label:"Desktop Application...",menubarPath:"davinci.new/newApp"},{id:"newHTMLSketchHiFi",run:function(){p(["./ui/Resource"],function(m){m.newHTMLSketchHiFi()})},iconClass:"newOpenMenuItem newSketchHiFiMenuItem",label:"Sketch (high-fidelity)...",menubarPath:"davinci.new/newSketch"},{id:"newHTMLSketchLoFi",
run:function(){p(["./ui/Resource"],function(m){m.newHTMLSketchLoFi()})},iconClass:"newOpenMenuItem newSketchLoFiMenuItem",label:"Sketch (low-fidelity)...",menubarPath:"davinci.new/newSketch"},{id:"newFolder",run:function(){p(["./ui/Resource"],function(m){m.newFolder()})},iconClass:"newOpenMenuItem newFolderMenuItem",label:"Folder...",menubarPath:"davinci.new/newFolder"},{id:"newCSS",run:function(){p(["./ui/Resource"],function(m){m.newCSS()})},iconClass:"newOpenMenuItem newCSSMenuItem",label:"CSS File...",
menubarPath:"davinci.new/newFolder"},{id:"newJS",run:function(){p(["./ui/Resource"],function(m){m.newJS()})},iconClass:"newOpenMenuItem newJSMenuItem",label:"JavaScript File...",menubarPath:"davinci.new/newFolder"},{id:"newTheme",run:function(){p(["davinci/Workbench","davinci/ui/NewTheme"],function(m,h){m.showModal(new h,"New Theme",{width:300},null,!0)})},iconClass:"newOpenMenuItem newThemeMenuItem",label:"Theme...",menubarPath:"davinci.new/newTheme"},{id:"newProject",run:function(){p(["./ui/Resource"],
function(m){m.newProject()})},iconClass:"newOpenMenuItem newProjectMenuItem",label:"Project...",menubarPath:"davinci.new/newProject"},{id:"openFile",run:function(){p(["./ui/Resource"],function(m){m.openFile()})},iconClass:"newOpenMenuItem openFileMenuItem",label:"File...",toolbarPath:"davinci.toolbar.main/edit",menubarPath:"davinci.open/openFile",keyBinding:{accel:!0,charOrCode:"o"}},{id:"openThemeEditor",run:function(){p(["davinci/Workbench","davinci/ui/OpenThemeDialog"],function(m,h){m.showModal(new h,
"Open Theme",{width:200},null,!0)})},iconClass:"newOpenMenuItem openThemeMenuItem",label:"Theme Editor...",menubarPath:"davinci.open/openTheme"},{id:"openReview",run:function(){p(["./ui/Resource"],function(m){m.openFile()})},run:function(){p(["davinci/Workbench","davinci/review/widgets/OpenReviewDialog"],function(m,h){m.showModal(new h,"Open Review",{width:350,height:250})})},iconClass:"newOpenMenuItem openReviewMenuItem",label:"Review...",menubarPath:"davinci.open/openTheme"},{id:"orionNavigator",
run:function(){window.open("../navigate/table.html#","_blank");window.focus()},iconClass:"newOpenMenuItem orionIcon",label:"Orion Navigator",menubarPath:"davinci.open/openOrion"}]},{id:"main",visible:!0,menu:[{__mainMenu:!0,separator:["usersettings",!1,"settings",!1,"additions",!1,"help",!1]},{label:"User settings",path:"usersettings",id:"davinci.usersettings",className:"userSettingsMenu",iconClass:"userSettingsMenuIcon",showLabel:!1,separator:["username",!0,"logout",!0,"additions",!1]},{label:"Settings",
path:"settings",id:"davinci.settings",className:"appSettingsMenu",iconClass:"appSettingsMenuIcon",showLabel:!1,separator:["settings",!0,"additions",!1]},{label:"Help",path:"help",id:"davinci.help",className:"helpMenu",iconClass:"helpMenuIcon",showLabel:!1,separator:["help",!0,"about",!1,"additions",!1]}],actions:[{id:"editPreferences",run:function(){p(["davinci/workbench/Preferences"],function(m){m.showPreferencePage()})},label:"Preferences...",menubarPath:"davinci.settings/settings"},{id:"editThemeSets",
run:function(){p(["davinci/ui/ThemeSetsDialog"],function(m){m()})},label:"Theme sets...",menubarPath:"davinci.settings/settings"},{id:"showHelp",run:function(){window.open("app/docs/index.html","MaqettaDocumentation")},label:"Documentation",menubarPath:"davinci.help/help",keyBinding:{charOrCode:dojo.keys.F1}},{id:"showTutotials",run:function(){window.open("app/docs/index.html#tutorials/tutorials","MaqettaTutorials")},label:"Tutorials",menubarPath:"davinci.help/help"},{id:"showVideos",run:function(){window.open("http://www.youtube.com/user/Maqetta/",
"MaqettaVideos")},label:"Videos",menubarPath:"davinci.help/help"},{id:"showCheatSheets",run:function(){window.open("app/docs/index.html#cheatsheets/cheatsheets","MaqettaCheatSheets")},label:"Cheat sheets",menubarPath:"davinci.help/help"},{id:"showHowTo",run:function(){window.open("https://www.ibm.com/search/csass/search/?sn\x3ddw\x26en\x3dutf\x26hpp\x3d20\x26dws\x3ddw\x26q\x3dmaqetta\x26Search\x3dSearch","MaqettaHowTo")},label:"How-to articles",menubarPath:"davinci.help/help"},{id:"about",run:function(){p(["davinci/ui/about"],
function(m){m.show()})},label:"About Maqetta",menubarPath:"davinci.help/about"},{id:"username",action:"davinci/actions/UserNameAction",run:function(){window.open("../settings/settings.html","_blank");window.focus()},label:"{user}",menubarPath:"davinci.usersettings/username"},{id:"logout",action:"davinci/actions/LogoutAction",label:"Logout",menubarPath:"davinci.usersettings/logout"}]},{id:"explorerActions",visible:!0,actions:[{id:"davinci.ui.rename",label:"Rename...",iconClass:"renameIcon",run:function(){p(["./ui/Resource"],
function(m){m.renameAction()})},isEnabled:function(m){return p("./ui/Resource").canModify(m)},menubarPath:"addFiles"},{id:"davinci.ui.delete",label:"Delete",iconClass:"deleteIcon",isEnabled:function(m){return p("./ui/Resource").canModify(m)},run:function(){p(["./ui/Resource"],function(m){m.deleteAction()})},menubarPath:"delete",keyBinding:{charOrCode:[dojo.keys.DELETE,dojo.keys.BACKSPACE]}},{id:"davinci.ui.download",label:"Download",iconClass:"downloadSomeIcon",action:"davinci/actions/DownloadAction",
isEnabled:function(m){return p("./ui/Resource").canModify(m)},menubarPath:"delete"}]}],"davinci.actionSetPartAssociations":[{targetID:"davinci.ui.editorActions",parts:["davinci.ui.editorMenuBar"]},{targetID:"davinci.ui.explorerActions",parts:["davinci.ui.navigator"]}],"davinci.viewActions":[{viewContribution:{targetID:"davinci.ui.problems",actions:[{id:"Copy2",iconClass:"copyIcon",run:function(){alert("view toolbar")},label:"Copy",toolbarPath:"davinci.toolbar.main/edit",menubarPath:"davinci.edit/cut"}]}},
{viewContribution:{targetID:"workbench.Explorer",actions:[{id:"davinci.ui.newfile",label:"New folder...",iconClass:"newFolderIcon",className:"FilesToolbarNewFolder",run:function(){p(["./ui/Resource"],function(m){m.newFolder()})},toolbarPath:"download"},{id:"davinci.ui.deletefile",label:"Delete file...",iconClass:"FilesToolbarDeleteFileIcon",className:"FilesToolbarDeleteFile",run:function(){p(["./ui/Resource"],function(m){m.deleteAction()})},toolbarPath:"download"},{id:"davinci.ui.renamefile",label:"Rename file...",
iconClass:"FilesToolbarRenameFileIcon",className:"FilesToolbarRenameFile",run:function(){p(["./ui/Resource"],function(m){m.renameAction()})},toolbarPath:"download"},{id:"download",iconClass:"downloadSomeIcon",className:"FilesToolbarDownloadSelected",run:function(){p(["./Workbench","./ui/DownloadSelected"],function(m,h){m.showModal(new h,"Download",{width:440})})},label:"Download Selected Files",toolbarPath:"download"},{id:"download",iconClass:"downloadAllIcon",className:"FilesToolbarDownloadAll",
run:function(){p(["./Workbench","./ui/Download"],function(m,h){m.showModal(new h,"Download",{width:440})})},label:"Download Entire Project",toolbarPath:"download"}]}}]}})},"davinci/Workbench":function(){define("dcl/dcl dojo/_base/lang require ./Runtime ./ui/Dialog ./ve/metadata ./ve/utils/GeomUtils davinci/_WokbenchEditors davinci/_WokbenchMisc davinci/_Workbench_Menu davinci/_Workbench_Palette".split(" "),function(p,m,h,e,b,k,a,g,n,f,d){Function.prototype.bind=Function.prototype.bind||function(c){return dojo.hitch(c,
this)};window.setInterval(function(){c.saveState&&c.updateWorkbenchState()},5E3);var c=new (p([g,n,f,d],{declaredClass:"davinci.Workbench",_XX_last_member:!0,activePerspective:"",actionScope:[],_DEFAULT_PROJECT:"project1",_baseTitle:"Control-Freak ",hideEditorTabs:!0,_editorTabClosing:{},_shadowTabClosing:{},service:null,serviceClass:"XApp_XIDE_Workbench_Service",currentEditor:null,run2:function(){e.subscribe("/davinci/ui/widgetPropertiesChanges",function(){var c=e.currentEditor.visualEditor;c._objectPropertiesChange.apply(c,
arguments)})},onResize:function(d){var a=d.explicitOriginalTarget?d.explicitOriginalTarget:d.srcElement;if(("resize"==d.type||a.id&&-1<a.id.indexOf("dijit_layout__Splitter_")||a.nextSibling&&a.nextSibling.id&&-1<a.nextSibling.id.indexOf("dijit_layout__Splitter_"))&&(d=davinci&&e.currentEditor)&&d.onResize)d.onResize();c._originalOnResize&&c._originalOnResize();c._repositionFocusContainer()},showModal:function(c,d,a,f,n,g){return b.showModal(c,d,a,f,n,g)},showMessage:function(c,d,a,f,n){return b.showMessage(c,
d,a,f,n)},showDialog:function(c){return b.showDialog(c)},_loadActionClass:function(c){c&&"string"==typeof c.action&&h([c.action],function(d){try{if(d)c.action=new d,c.action.item=c;else debugger}catch(a){console.error("action class creation failed : "+c.action)}})},_toggleButton:function(d,a,f,b){d.checked&&(f.forEach(function(c){c!=d&&c.set("checked",!1)}),c._runAction(d.item,a,d.item.id))},_runAction:function(c,d,a){d&&e.currentEditor&&(d=e.currentEditor);if(c.run)c.run();else if(c.action)dojo.isString(c.action)&&
this._loadActionClass(c),c.action.run(d);else if(c.method&&d&&d[c.method]instanceof Function)d[c.method](a);else c.commandID&&e.executeCommand(c.commandID)},createPopup:function(d){var a=d.partID,f=d.domNode,b=d.context,n=d.openCallback,g=this.getActionSets(a),k=g.clonedActionSets,g=g.actionSets;try{if(0<k.length){var e=c._createMenuTree(k,!0);c._initActionsKeys(g,d);var h=c._createMenu(e,b);h&&f&&h.bindDomNode(f);h._widgetCallback=n;h._partID=a;return h}}catch(A){logError(A,"creating popup")}},getActionSets:function(c){var d=
[];e.getExtension("davinci.actionSetPartAssociations",function(a){return a.parts.some(function(f){if(f==c)return d.push(a.targetID),!0})});var a,f=[];d.length&&(a=e.getExtensions("davinci.actionSets",function(c){return d.some(function(d){return d==c.id})}),a.length&&a.forEach(function(c){var d=k.getLibraryActions(c.id);d.length&&(c=m.mixin({},c),c.actions=c.actions.concat(d));f.push(c)}));return{actionSets:a,clonedActionSets:f}},getFocusContainer:function(){var c=document.getElementById("focusContainer");
c||(c=dojo.create("div",{"class":"focusContainer",id:"focusContainer"},document.body),davinci.Workbench.focusContainer=c);return c},_repositionFocusContainer:function(){var c=dojo.byId("editorsStackContainer"),d=this.getFocusContainer();if(c&&d){var f=e.currentEditor;if(c=f&&f.getFocusContainerBounds?f.getFocusContainerBounds():a.getBorderBoxPageCoords(c))d.style.left=c.l+"px",d.style.top=c.t+"px",d.style.width=c.w+"px",d.style.height=c.h+"px",f&&f.getContext&&(d=f.getContext())&&d.updateFocusAll&&
d.updateFocusAll()}},_removeFocusContainerChildren:function(){davinci.Workbench.focusContainer&&(davinci.Workbench.focusContainer.innerHTML="")}}));dojo.setObject("davinci.Workbench",c);return c})},"davinci/ui/Dialog":function(){define("dojo/_base/declare dijit/form/Button dijit/Dialog dojo/dom-geometry dojo/dom-style dojo/_base/connect dojo/window dojo/parser dojo/i18n!davinci/ve/nls/common".split(" "),function(p,m,h,e,b,k,a,g,n){var f=p(h,{contentStyle:null,buildRendering:function(){this.inherited(arguments);
dojo.addClass(this.domNode,"resizableDialog");dojo.addClass(this.domNode,"ui-widget-content");this.submitOnEnter&&dojo.addClass(this.domNode,"submitOnEnter")},_setContent:function(d,c){this.inherited(arguments);var a=dojo.doc.createElement("div");this.containerNode.appendChild(a);(a=dojo.query(".dijitDialogPaneContentArea",this.containerNode)[0])?dojo.connect(a,"onkeydown",this,"_onKeyDown"):dojo.connect(this.domNode,"onkeydown",this,"_onKeyDown")},resize:function(d){if(d){var c=b.getComputedStyle(this.containerNode),
c=e.getPadExtents(this.containerNode,c),a=d.w-c.w,f=d.h-c.h,f=f-e.getMarginBox(this.titleBar).h;d=dojo.query(".dijitDialogPaneContentArea",this.containerNode)[0];c=dojo.query(".dijitDialogPaneActionBar",this.containerNode)[0];f-=e.getMarginBox(c).h;a&&dojo.style(d,"width",a+"px");f&&dojo.style(d,"height",f+"px");dojo.forEach(this.getChildren(),dojo.hitch(this,function(c){c.resize&&c.resize({w:a,h:f})}))}},show:function(){var d=this.inherited(arguments);if(this.contentStyle){if("object"==typeof this.contentStyle){var c=
{};this.contentStyle.width&&(c.w=parseInt(this.contentStyle.width));this.contentStyle.height&&(c.h=parseInt(this.contentStyle.height));var f=a.getBox(this.ownerDocument);f.w*=this.maxRatio;f.h*=this.maxRatio;c.h>f.h&&(e.position(this.containerNode),Math.min(c.w,f.w),Math.min(c.h,f.h),c.h=f.h);this.resize(c)}this._size();this._position();dojo.style(this.containerNode,"width","auto");dojo.style(this.containerNode,"height","auto")}return d},_onKeyDown:function(d){var c=d.ctrlKey&&!dojo.isMac||dojo.isMac&&
d.metaKey;d.which==dojo.keys.ENTER&&(c||this.submitOnEnter)&&(d=dojo.query("input[type\x3dsubmit]",this.containerNode),0<d.length&&(d=dijit.getEnclosingWidget(d[0]),c=document.createEvent("MouseEvents"),c.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),d._onClick(c)))}});f._timedDestroy=function(d,c){c&&c.forEach(k.disconnect);var a=k.connect(d,"onHide",function(){k.disconnect(a);d.destroyRecursive()});d.hide()};f.showModal=function(d,c,a,b,n,g){var e=[];c={title:c,content:d,contentStyle:a,
submitOnEnter:n};g&&(c.onShow=g);var h=new f(c);g=dojo.hitch(this,function(){var c=!1;b&&(c=b());c||this._timedDestroy(h,e)});e.push(k.connect(h,"onExecute",d,g));d.onExecute&&e.push(k.connect(d,"onExecute",d,g));e.push(k.connect(d,"onClose",dojo.hitch(this,function(){this._timedDestroy(h,e)})));e.push(k.connect(h,"onCancel",dojo.hitch(this,function(){this._timedDestroy(h,e)})));h.show();return h};f.showMessage=function(d,c,a,f,b){return this.showDialog({title:d,content:c,style:a,okCallback:f,okLabel:null,
hideCancel:!0})};f.showDialog=function(d){var c=d.title,a=d.content,b=d.style,r=d.okCallback,e=d.okLabel,h=d.hideCancel,B=d.submitOnEnter,x=d.extendLabels,w=d.extendCallbacks,v,A=[];d=document.createElement("div");var C=document.createElement("div");dojo.addClass(C,"dijitDialogPaneContentArea");d.appendChild(C);var L=document.createElement("div");dojo.addClass(L,"dijitDialogPaneActionBar");e=new m({label:e?e:n.ok,type:"submit","class":"maqPrimaryButton"});L.appendChild(e.domNode);var E=dojo.hitch(this,
function(){this._timedDestroy(v,A)});if(x&&w&&0<x.length&&x.length===w.length)for(e=0;e<x.length;e++){var p=function(c){if(w[c])w[c]();v.onCancel()}.bind(this,e);L.appendChild((new m({label:x[e],onClick:p,"class":"maqSecondaryButton"})).domNode)}h||L.appendChild((new m({label:n.cancel,onClick:function(){v.onCancel()},"class":"maqSecondaryButton"})).domNode);d.appendChild(L);v=new f({title:c,content:d,contentStyle:b,submitOnEnter:B});dojo.isString(a)?(C.innerHTML=a,g.parse(C)):a.domNode?C.appendChild(a.domNode):
C.appendChild(a);A.push(k.connect(v,"onExecute",dojo.hitch(this,function(){r&&r();E()})));A.push(k.connect(v,"onCancel",dojo.hitch(this,function(){E()})));v.show();return v};return f})},"davinci/ve/utils/GeomUtils":function(){define(["dojo/_base/window","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/_base/sniff"],function(p,m,h,e,b){var k=["TABLE","TBODY","TR","TD","TH"];return{getMarginBoxPageCoords:function(a){var b;p.withDoc(a.ownerDocument,function(){var n=this.getBorderBoxPageCoords(a),
f=this.getMarginExtents(a);b={l:n.l-f.l,t:n.t-f.t,w:n.w+f.l+f.r,h:n.h+f.t+f.b}}.bind(this));return b},getMarginBoxPageCoordsCached:function(a){a._maqMarginBoxPageCoords||(a._maqMarginBoxPageCoords=this.getMarginBoxPageCoords(a));return a._maqMarginBoxPageCoords},getBorderBoxPageCoords:function(a){var b;p.withDoc(a.ownerDocument,function(){if(k.indexOf(a.tagName)){var n=a.getBoundingClientRect(),f=this.getScrollLeft(a),d=this.getScrollTop(a);b={l:n.left+f,t:n.top+d,w:n.width,h:n.height}}else{for(var n=
a.offsetLeft,f=a.offsetTop,d=a.parentNode,c=a.offsetParent;d&&"BODY"!=d.tagName;){"number"==typeof d.scrollLeft&&"number"==typeof d.scrollTop&&(n-=d.scrollLeft,f-=d.scrollTop);if(d==c)var q=m.getBorderExtents(c),n=n+(c.offsetLeft+q.l),f=f+(c.offsetTop+q.t),c=c.offsetParent;d=d.parentNode}b={l:n,t:f,w:a.offsetWidth,h:a.offsetHeight}}}.bind(this));return b},getBorderBoxPageCoordsCached:function(a){a._maqBorderBoxPageCoords||(a._maqBorderBoxPageCoords=this.getBorderBoxPageCoords(a));return a._maqBorderBoxPageCoords},
getScrollLeft:function(a){a=a&&a.ownerDocument;return e("mozilla")?(a=a&&a.defaultView)?a.pageXOffset:0:(a=a&&a.body)?a.scrollLeft:0},getScrollTop:function(a){a=a&&a.ownerDocument;return e("mozilla")?(a=a&&a.defaultView)?a.pageYOffset:0:(a=a&&a.body)?a.scrollTop:0},getMarginExtents:function(a,b){var n=b||h.getComputedStyle(a),f,d,c;n?(f=parseFloat(n.marginLeft)||0,d=parseFloat(n.marginTop)||0,c=parseFloat(n.marginRight)||0,n=parseFloat(n.marginBottom)||0):f=d=c=n=0;return{l:f,t:d,r:c,b:n,w:f+c,h:d+
n}},clearGeomCache:function(a){delete a._maqBorderBoxPageCoords;delete a._maqMarginBoxPageCoords}}})},"davinci/_WokbenchEditors":function(){define(["dcl/dcl","./Runtime","dojo/promise/all"],function(p,m,h){return p(null,{closeAllEditors:function(){var e=dijit.byId("editors_container");e&&e.getChildren().forEach(function(b){e.closeChild(b)})},getOpenEditor:function(e){return this.currentEditor?this.currentEditor:null!=e?(e=dijit.byId(filename2id(e.getPath())))?e.editor:null:(e=dijit.byId("editors_container"))&&
e.selectedChildWidget&&e.selectedChildWidget.editor?e.selectedChildWidget.editor:null},closeActiveEditor:function(){var e=dijit.byId("editors_container"),b=dijit.byId("davinci_file_tabs");if(e&&e.selectedChildWidget&&e.selectedChildWidget.editor){var k=selectedChildWidget.id.replace(/^editor/,"shadow");e.closeChild(e.selectedChildWidget);(e=dijit.byId(k))&&b.closeChild(e)}},getAllOpenEditorIds:function(){},_showEditorTopPanes:function(){this._hideShowEditorTopPanes("block")},_hideEditorTopPanes:function(){this._hideShowEditorTopPanes("none")},
_hideShowEditorTopPanes:function(e){},_editorTabClosed:function(e){if(!davinci.Workbench._editorTabClosing[e.id]){davinci.Workbench._editorTabClosing[e.id]=!0;if(e&&e.editor&&e.editor.fileName){var b=e.id.replace(/^editor/,"shadow"),k=dijit.byId("davinci_file_tabs"),a=dijit.byId(b),g=Workbench._state.editors.indexOf(e.editor.fileName);-1!=g&&Workbench._state.editors.splice(g,1);Workbench.saveState=!0;davinci.Workbench._shadowTabClosing[b]||(k.removeChild(a),a.destroyRecursive())}dijit.byId("editors_container").getChildren().length||
(Workbench._switchEditor(null),this._expandCollapsePaletteContainers(null),b=dijit.byId("editorsStackContainer"),k=dijit.byId("editorsWelcomePage"),b&&k&&b.selectChild(k),this._hideEditorTopPanes());delete davinci.Workbench._editorTabClosing[e.id]}},openEditor:function(e,b){try{var k=e.fileName,a;"string"==typeof k?a=k.substr(k.lastIndexOf(".")+1):(a=k.getExtension(),k=k.getPath());var g=dijit.byId(filename2id(k)),n=dijit.byId("editors_container");if(g){n.selectChild(g);var f=g.editor;e.startOffset&&
f.select(e)}else{var d=e.editorCreateCallback,c=m.getExtensions("davinci.editor",function(c){"string"==typeof c.extensions&&(c.extensions=c.extensions.split(","));return dojo.some(c.extensions,function(c){return c.toLowerCase()==a.toLowerCase()})}),q=c[0];1<c.length&&dojo.some(c,function(c){q=c;return c.isDefault});Workbench._createEditor(q,k,e,b).then(function(c){d&&d.call(window,c);e.noSelect||(m.currentEditor=c)},function(c){console.error("Error opening editor for filename: "+k,c)})}}catch(u){console.error("Exception opening editor for filename: "+
e&&e.fileName),console.error(u)}},_switchEditor:function(e,b){var k=m.currentEditor;m.currentEditor=e;var a=davinci.Workbench;a._state&&(a._state.activeEditor=e?e.fileName:null);this._removeFocusContainerChildren();this._showEditorTopPanes();try{dojo.publish("/davinci/ui/editorSelected",[{editor:e,oldEditor:k}])}catch(g){console.error(g)}a._updateTitle(e);setTimeout(function(){e&&e.visualEditor&&e.visualEditor.context&&e.visualEditor.context.isActive()&&e.visualEditor.context.getTopWidgets().forEach(function(a){a.resize&&
a.resize()});this._repositionFocusContainer()}.bind(this),1E3);h(this._showViewPromises).then(function(){e&&e.focus&&e.focus();this._rearrangePalettes(e);this._expandCollapsePaletteContainers(e)}.bind(this));b||(a.saveState=!0)}})})},"davinci/_WokbenchMisc":function(){define("dcl/dcl require ./Runtime ./ui/Dialog dojo/i18n!./nls/webContent ./ve/metadata dojo/_base/connect xide/manager/ServerActionBase".split(" "),function(p,m,h,e,b,k,a,g){var n=function(d,c){if(401==c.status||403==c.status)f();else if(!0===
d.canceled){var a=d.ioArgs.url;(new RegExp("(^|\\.\\/|"+document.baseURI+"\\/)cmd\\/")).test(a)&&(0<=a.indexOf("getBluePageInfo")||h.handleError(c.message))}},f=function(){var d=new e({title:b.sessionTimedOut}),c=dojo.string.substitute(b.sessionTimedOutMsg,{hrefLoc:"welcome"});d.set("content",c);dojo.connect(d,"onCancel",null,function(){window.location.href="welcome"});setTimeout(function(){window.location.href="welcome"},1E4);d.show()};return p(null,{run:function(){var d=davinci.Workbench;console.error("run ");
h.run();d._initKeys();d._baseTitle=dojo.doc.title;try{d.initService()}catch(c){debugger}window.maqetta&&maqetta.TopBanner&&maqetta.TopBanner.setup&&maqetta.TopBanner.setup();h.subscribe("/davinci/resource/resourceChanged",function(c,d){if("deleted"==c){var a;a=d.getPath();a="editor-"+encodeURIComponent(a.replace(/[\/| |\t]/g,"_")).replace(/%/g,":");var f=editorIdToShadowId(a);a=dijit.byId(a);f=dijit.byId(f);if(a&&!a._isClosing){var b=dijit.byId("editors_container"),q=dijit.byId("davinci_file_tabs");
b.removeChild(a);a.destroyRecursive();q.removeChild(f);f.destroyRecursive()}}});h.subscribe("/dojo/io/error",n);h.subscribe("/davinci/states/state/changed",function(c){var d=h.currentEditor;"davinci.ve.themeEditor.ThemeEditor"!=d.declaredClass&&"davinci.review.editor.ReviewEditor"!=d.declaredClass&&d.visualEditor.onContentChange.apply(d.visualEditor,arguments)});h.subscribe("/davinci/ui/widgetPropertiesChanges",function(){var c=h.currentEditor.visualEditor;c._objectPropertiesChange.apply(c,arguments)});
a.subscribe("/davinci/states/state/changed",function(c){var d=h.currentEditor&&"davinci.ve.PageEditor"==h.currentEditor.declaredClass&&h.currentEditor.visualEditor&&h.currentEditor.visualEditor.context;if(d){var a,f,d=d?d.getDijit():null,b=m("davinci/ve/widget");c.newState&&!c.newState.indexOf("_show:")&&(a=d.byId(c.newState.substring(6)),a=b.getWidget(a.domNode),(f=a.getHelper())&&f.popup&&f.popup(a));c.oldState&&!c.oldState.indexOf("_show:")&&(a=d.byId(c.oldState.substring(6)),a=b.getWidget(a.domNode),
(f=a.getHelper())&&f.tearDown&&f.tearDown(a))}});a.subscribe("/davinci/ui/repositionFocusContainer",function(c){d._repositionFocusContainer()});var f=this.service.serviceObject[this.serviceClass].getInfo().then(function(c){h._initializationInfo=c;c=c.userInfo;h.isLocalInstall="maqettaUser"==c.userId;h.userName=c.userId;h.userEmail=c.email;return k.init()}).then(function(){var c=h.initialPerspective||"davinci.ui.main";dojo.query(".loading").orphan();d.showPerspective(c);d._updateTitle();initializeWorkbenchState()}).otherwise(function(c){dojo.query("#load_screen").addContent(dojo.string.substitute(b.startupError,
[c.message]),"only")});d._lastAutoSave=Date.now();setInterval(dojo.hitch(this,"_autoSave"),3E4);return f},initService:function(){this.service||(this.service=new g({serviceClass:"XApp_XIDE_Workbench_Service",serviceUrl:"./xcf/xui.php?debug\x3dtrue\x26view\x3drpc",singleton:!1}),this.service.init())},findView:function(d){if(d=dijit.byId(d))return d},location:function(){return h.location()},logoff:function(d){},unload:function(){davinci.Workbench._autoSave()},singleProjectMode:function(){return!0},getProject:function(){var d=
davinci.Workbench;return d.getActiveProject()||d._DEFAULT_PROJECT},loadProject:function(d){var c=davinci.Workbench;c.setActiveProject(d);return c.updateWorkbenchState().then(function(){location.href="cmd/configProject?configOnly\x3dtrue\x26project\x3d"+encodeURIComponent(d)})},getActiveProject:function(){return"project1"},setActiveProject:function(d){var c=davinci.Workbench;c._state||(c._state={});c._state.project=d;c.saveState=!0},setActionScope:function(d,c){davinci.Workbench.actionScope[d]=c},
clearWorkbenchState:function(){var d=davinci.Workbench;d._state={};return d.updateWorkbenchState()},updateWorkbenchState:function(){delete davinci.Workbench.saveState;return null},getDefaultMount:function(){},workbenchStateCustomPropGet:function(d){var c=davinci.Workbench;if("string"==typeof d)return c._state[d]},workbenchStateCustomPropSet:function(d,c){var a=davinci.Workbench;"string"==typeof d&&("undefined"==typeof c?delete a._state[d]:a._state[d]=c,a.saveState=!0)},_autoSave:function(){var d=
davinci.Workbench,c=!1;if(this.currentEditor){var a=this.currentEditor;if(a.isReadOnly)console.error("workbench : autosave failed : isReadyOnly or is not dirty");else try{a.save(!0)}catch(f){console.error("Error while autosaving file:"+f),c=!0}}c||(d._lastAutoSave=Date.now())},_updateTitle:function(d){var c=davinci.Workbench._baseTitle||"";d&&(c+="",d.isDirty&&(c+="*"),c+=d.item.name);dojo.doc.title=c},_initActionsKeys:function(d,c){var a=davinci.Workbench,f=c.keysDomNode||c.domNode,b={},n;dojo.forEach(d,
function(c){dojo.forEach(c.actions,function(c){c.keySequence&&(b[c.keySequence]=c,n=!0)})});if(n){var g=c.context;dojo.connect(f,"onkeydown",function(c){c=a._keySequence(c);c=b[c];!c||c.action.shouldShow&&!c.action.shouldShow(g)||c.action.isEnabled(g)&&a._runAction(c,g)})}},_initKeys:function(){var d=davinci.Workbench,c={all:[]},a=h.getExtensions("davinci.keyBindings");dojo.forEach(a,function(d){var a=d.contextID||"all",f=c[a];f||(f=c[a]=[]);f[d.sequence]=d.commandID});d.keyBindings=c},handleKey:function(d){var c=
davinci.Workbench;if(c.keyBindings){d=c._keySequence(d);var a;c.currentContext&&c.keyBindings[c.currentContext]&&(a=c.keyBindings[c.currentContext][d]);a||(a=c.keyBindings.all[d]);if(a)return h.executeCommand(a),!0}},_keySequence:function(d){var c=[];window.event?(window.event.ctrlKey&&c.push("M1"),window.event.shiftKey&&c.push("M2"),window.event.altKey&&c.push("M3")):((d.ctrlKey||2==d.modifiers||3==d.modifiers||5<d.modifiers)&&c.push("M1"),(d.shiftKey||3<d.modifiers)&&c.push("M2"),d.modifiers?(d.altKey||
d.modifiers%2)&&c.push("M3"):d.altKey&&c.push("M3"));var a=String.fromCharCode(d.keyCode);/[A-Z0-9]/.test(a)||(a={46:"del",114:"f3"}[d.keyCode]||"xxxxxxxxxx");a=a.toUpperCase();" "==a&&(a="' '");c.push(a);return c.join("+")},setupGlobalKeyboardHandler:function(){var d=h.getExtensions("davinci.actionSets");dojo.forEach(d,function(c){"davinci.ui.main"!=c.id&&"davinci.ui.editorActions"!=c.id||dojo.forEach(c.actions,function(c){c.keyBinding&&h.registerKeyBinding(c.keyBinding,c)})})}})})},"davinci/_Workbench_Menu":function(){define("dcl/dcl dojo/_base/declare ./Runtime dijit/Menu dijit/MenuBar dijit/MenuItem dijit/MenuSeparator dijit/PopupMenuBarItem dijit/form/DropDownButton davinci/_WokbenchEditors davinci/_WokbenchMisc".split(" "),
function(p,m,h,e,b,k,a,g,n){var f=m(e,{menuOpened:function(d){},_openMyself:function(d){this.menuOpened(d);var c;try{var a=document.getElementById("menuOverlayDiv");a||(a=dojo.create("div",{id:"menuOverlayDiv",style:"left:0px; top:0px; width:100%; height:100%; position:absolute; z-index:10;"},document.body));if(this.adjustPosition){var f=this.adjustPosition(d);c=dijit.popup.open;dijit.popup.open=function(d){d.x+=f.x;d.y+=f.y;c.call(dijit.popup,d)}}this.onClose=function(){var c=document.getElementById("menuOverlayDiv");
c&&c.parentNode.removeChild(c)}.bind(this);this.inherited(arguments)}finally{c&&(dijit.popup.open=c)}}});return p(null,{declaredClass:"davinci.Workbench_Menu",updateMenubar:function(d,c){console.error("updateMenubar")},_updateMainMenubar:function(d,c){console.error("_updateMainMenubar")},_addItemsToMenubar:function(d,c){console.error("_addItemsToMenubar")},_createMenu:function(d,c){var a,b,n;d.menus?(a=new e({parentMenu:d}),b=d.menus,n="onOpen"):(a=new f({}),b=d,n="menuOpened");a.domNode.style.display=
"none";a.actionContext=c;this._rebuildMenu(a,b);dojo.connect(a,n,this,function(c){a._widgetCallback&&a._widgetCallback(c);this._rebuildMenu(a,b).focus()});return a},_rebuildMenu:function(d,c){dojo.forEach(d.getChildren(),function(c){d.removeChild(c);c.destroy()});d.focusedChild=null;var f,b;c.forEach(function(c,n){c.menus.length&&(c.isSeparator&&0<n&&(f=!0),c.menus.forEach(function(c){f&&b&&(d.addChild(new a({})),f=!1);b=!0;var n=c.label;c.action&&c.action.getName&&(n=c.action.getName());if(c.separator)c=
davinci.Workbench._createMenu(c),c=new k({label:n,popup:c,id:c.id+"item"}),c.actionContext=d.actionContext,d.addChild(c);else{var g=!0;c.isEnabled&&(g=h.getSelection(),g=(g=g[0]&&g[0].resource)?c.isEnabled(g):!1);if(c.action){if(c.action.shouldShow&&!c.action.shouldShow(d.actionContext,{menu:d}))return;g=c.action.isEnabled&&c.action.isEnabled(d.actionContext)}n={label:n,id:c.id,disabled:!g,onClick:dojo.hitch(this,"_runAction",c,d.actionContext)};c.iconClass&&(n.iconClass=c.iconClass);d.addChild(new k(n))}},
this))},this);return d},_createMenuTree:function(d,c){function a(c,d,b){d=(d||"additions").split("/");var n=f;davinci.Workbench._loadActionClass(c);var q=d[d.length-1];if(1<d.length)for(var g=0,k=d.length-1;g<k;g++){var r;a:{r=0;for(var e=n.length;r<e;r++)for(var h=0,B=n[r].menus.length;h<B;h++)if(d[g]==n[r].menus[h].id){r=n[r].menus[h].menus;break a}r=void 0}r&&(n=r)}g=0;for(k=n.length;g<k;g++)if(n[g].id==q){d=n[g].menus;d.push(c);if(c.separator){b=!1;d=c.menus=[];for(n=0;n<c.separator.length;n+=
2)q=c.separator[n],b="additions"==q,d.push({id:q,isSeparator:c.separator[n+1],menus:[]});b||d.push({id:"additions",isSeparator:!1,menus:[]})}return}b&&f.push({id:q,isSeparator:!1,menus:[c]})}d||(d=h.getExtensions("davinci.actionSets",function(c){return 0==h.getExtensions("davinci.actionSetPartAssociations",function(d){return d.targetID==c.id}).length}));for(var f=[],b=0,n=d.length;b<n;b++){var g=d[b];if(g.visible&&g.menu)for(var k=0,e=g.menu.length;k<e;k++){var w=g.menu[k];if(w.__mainMenu)for(var v=
0;v<w.separator.length;v+=2)f.push({id:w.separator[v],isSeparator:w.separator[v+1],menus:[]});else if(a(w,w.path,c),w.populate instanceof Function){var w=w.populate(),A;for(A in w)a(w[A],w[A].menubarPath)}}}b=0;for(n=d.length;b<n;b++)if(g=d[b],g.visible)for(k=0,e=g.actions.length;k<e;k++)A=g.actions[k],A.menubarPath&&a(A,A.menubarPath,c);return f}})})},"davinci/_Workbench_Palette":function(){define(["dcl/dcl","davinci/Runtime"],function(p,m){var h={};return p(null,{declaredClass:"davinci.Workbench_Menu",
_rearrangePalettes:function(e){var b,k,a;e?((k=m.getExtensions("davinci.editor",function(a){return e?a.id===e.editorID:!1}))&&0<k.length&&(b=k[0].palettePerspective),k=e._rightPaletteExpanded,a=e._leftPaletteExpanded):b=m.initialPerspective||"davinci.ui.main";b&&((b=m.getExtension("davinci.perspective",b))||console.error("---error"),dojo.forEach(b.views,function(a){var b=a.viewID,f=a.position;0>f.indexOf("bottom")&&(f+="-top");if(b=dijit.byId(b)){var d=b.getParent(),f=mainBody.tabs.perspective[f];
d!=f&&(d&&d.removeChild(b),a.hidden||(f.addChild(b),d=f));d&&(a.hidden?d.removeChild(b):a.selected&&(d._maqDontExpandCollapse=!0,d.selectChild(b),delete d._maqDontExpandCollapse))}}));e&&(e.hasOwnProperty("_rightPaletteExpanded")&&(e._rightPaletteExpanded=k),e.hasOwnProperty("_leftPaletteExpanded")&&(e._leftPaletteExpanded=a))},_nearlyCollapsed:function(e){e=dojo.style(e,"width");"string"==typeof e&&(e=parseInt(e));return 91>e},_expandCollapsePaletteContainer:function(e){if(e&&e.domNode&&(e=davinci.Workbench.findPaletteContainerNode(e.domNode),
e.id)){var b=e._maqExpanded,k;this._nearlyCollapsed(e)&&(b=!1,k=91<=h[e.id].expandToSize?h[e.id].expandToSize:h[e.id].initialExpandToSize);b?this.collapsePaletteContainer(e):this.expandPaletteContainer(e,{expandToSize:k})}},_expandCollapsePaletteContainers:function(e,b){var k=dijit.byId("left_mainBody"),a=dijit.byId("right_mainBody");if(e){var g=m.getExtensions("davinci.editor",function(a){return a.id===e.editorID});if(g&&0<g.length){var g=g[0].expandPalettes,n;k&&((n=e&&e.hasOwnProperty("_leftPaletteExpanded")?
e._leftPaletteExpanded:g&&0<=g.indexOf("left"))?this.expandPaletteContainer(k.domNode,b):this.collapsePaletteContainer(k.domNode,b));a&&((n=e&&e.hasOwnProperty("_rightPaletteExpanded")?e._rightPaletteExpanded:g&&0<=g.indexOf("right"))?this.expandPaletteContainer(a.domNode,b):this.collapsePaletteContainer(a.domNode,b))}}else k&&this.collapsePaletteContainer(k.domNode,b),a&&this.collapsePaletteContainer(a.domNode,b)},findPaletteContainerNode:function(e){for(var b;e&&"BODY"!=e.tagName;){if(dojo.hasClass(e,
"davinciPaletteContainer")){b=e;break}e=e.parentNode}return b},collapsePaletteContainer:function(e,b){var k=davinci.Workbench.findPaletteContainerNode(e);if(k&&k.id){var a=k.id,g=dojo.style(k,"width"),n=dijit.byNode(k),f=dojo.query("[role\x3dtablist]",k);if(n&&0<f.length){var f=dojo.marginBox(f[0]),d=n.getParent();d&&d.resize&&f&&f.w&&(this._nearlyCollapsed(k)||b&&b.dontPreserveWidth||(h[a].expandToSize=g),k.style.width=f.w+"px",d.resize(),n._isCollapsed=!0)}dojo.removeClass(k,"maqPaletteExpanded");
k._maqExpanded=!1;davinci.Workbench._repositionFocusContainer();if(a=m.currentEditor)"left_mainBody"==k.id?a._leftPaletteExpanded=!1:"right_mainBody"==k.id&&(a._rightPaletteExpanded=!1)}},expandPaletteContainer:function(e,b){var k=b&&b.expandToSize,a=davinci.Workbench.findPaletteContainerNode(e);if(a&&a.id){var g=a.id,n=dijit.byNode(a);k&&(h[g].expandToSize=k);n&&h[g].expandToSize&&(k=n.getParent())&&k.resize&&(a.style.width=h[g].expandToSize+"px",k.resize(),delete n._isCollapsed);dojo.addClass(a,
"maqPaletteExpanded");a._maqExpanded=!0;davinci.Workbench._repositionFocusContainer();if(g=m.currentEditor)"left_mainBody"==a.id?g._leftPaletteExpanded=!0:"right_mainBody"==a.id&&(g._rightPaletteExpanded=!0)}}})})},"davinci/ui/NewTheme":function(){define("dojo/_base/declare dijit/_TemplatedMixin dijit/_WidgetBase dijit/_WidgetsInTemplateMixin system/resource ../model/Path ../Workbench ../workbench/Preferences dojo/i18n!./nls/ui dojo/i18n!dijit/nls/common dojo/text!./templates/newtheme.html ../Theme ./widgets/ThemeSelection dijit/form/Button dijit/form/ValidationTextBox".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r){return p([h,m,e],{templateString:d,_themeSelection:null,_okButton:null,_folder:null,_themeName:null,_folder:null,_version:null,_selector:null,_themeLocation:null,_error1:null,_error2:null,_error3:null,_error4:null,_errorMsg:null,_themeValidator:/^[-]?([_a-z]|[^\0-\237]|\[0-9a-f]{1,6}(\r\n|[ \n\r\t\f])?|\[^\n\r\f0-9a-f])([_a-z0-9-]|[^\0-\237]|\[0-9a-f]{1,6}(\r\n|[ \n\r\t\f])?|\[^\n\r\f0-9a-f])*$/i,postMixInProperties:function(){dojo.mixin(this,n);dojo.mixin(this,
f);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);dojo.connect(this._themeSelection,"onChange",this,"_baseThemeChanged");dojo.connect(this._themeSelection,"onChange",this,"_checkValid");this._selector.validator=dojo.hitch(this,function(c,d){var a=this._themeValidator.test(c);this._okButton.set("disabled",!a);return a})},_baseThemeChanged:function(){this._theme=this._themeSelection.get("value")},_createTheme:function(){this._okButton.set("disabled",!0);var d=this._themeSelection.get("value"),
f=this._selector.get("value"),q=this._getThemeLocation();if(b.findResource(q+"/"+f+".theme"))alert(n.themeAlreadyExists);else{this._loading=dojo.create("div",null,dojo.body(),"first");this._loading.innerHTML=dojo.string.substitute("\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e\x3cspan\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3c/span\x3e\x26nbsp;${0}...\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",[n.creatingTheme]);dojo.addClass(this._loading,"loading");dojo.style(this._loading,"opacity","0.5");this.getBase();
var g=c.CloneTheme(f,null,f,q,d,!0);g.promise.then(function(c){var d=g.themeFile;if(d)return d.isNew=!1,d.getContent().then(function(c){a.openEditor({fileName:d,content:c})});throw Error(n.errorCreatingTheme+f);}).otherwise(function(c){var d="Uh oh! An error has occurred:\x3cbr\x3e\x3cb\x3e"+c.message+"\x3c/b\x3e";c.fileName&&(d+="\x3cbr\x3efile: "+c.fileName+"\x3cbr\x3eline: "+c.lineNumber);c.stack&&(d+="\x3cbr\x3e\x3cpre\x3e"+c.stack+"\x3c/pre\x3e");console.error(d)}).otherwise(function(){this._loading&&
(this._loading.parentNode.removeChild(this._loading),delete this._loading)}.bind(this))}},getBase:function(){if(a.singleProjectMode())return a.getProject()},_getThemeLocation:function(){var c=this._selector.get("value"),d=this.getBase(),a=g.getPreferences("davinci.ui.ProjectPrefs",d);return(new k(d)).append(a.themeFolder).append(c).toString()},_checkValid:function(){var c=!0,d=this._themeSelection.get("value"),a=this._selector.get("value");if(null==d||""==d||null==a||""==a)c=!1;this._okButton.set("disabled",
!c)},okButton:function(){this._createTheme()},cancelButton:function(){this.cancel=!0;this.onClose()},onClose:function(){}})})},"davinci/model/Path":function(){define(["dojo/_base/declare"],function(p){"undefined"===typeof davinci.model&&(davinci.model={});"undefined"===typeof davinci.model.Path&&(davinci.model.Path={});var m=p("davinci.model.Path",null,{constructor:function(h,e,b){h=h||".";"string"==typeof h?(this.path=h,this.getSegments()):(this.segments=h,this.hasLeading=e,this.hasTrailing=b)},
endsWith:function(h){var e=dojo.clone(this.segments);for(h=(new m(h)).getSegments();0<h.length&&0<e.length;)if(h.pop()!=e.pop())return!1;return!0},getExtension:function(){this.extension||(this.extension=this.path.substr(this.path.lastIndexOf(".")+1));return this.extension},segment:function(h){var e=this.getSegments();return e.length<h?null:e[h]},getSegments:function(){if(!this.segments){var h=this.path;this.segments=h.split("/");"/"==h.charAt(0)&&(this.hasLeading=!0);"/"==h.charAt(h.length-1)&&(this.hasTrailing=
!0,this.segments.pop());this._canonicalize()}return this.segments},isAbsolute:function(){return this.hasLeading},getParentPath:function(){if(!this._parentPath){var h=dojo.clone(this.segments);h.pop();this._parentPath=new m(h,this.hasLeading)}return dojo.clone(this._parentPath)},_clone:function(){return new m(dojo.clone(this.segments),this.hasLeading,this.hasTrailing)},append:function(h){h=h||"";"string"==typeof h&&(h=new m(h));if(h.isAbsolute())return h;var e=this.segments,b=h.getSegments(),e=e.concat(b);
h=new m(e,this.hasLeading,h.hasTrailing);".."!=b[0]&&"."!=b[0]||h._canonicalize();return h},toString:function(){var h=[];this.hasLeading&&h.push("/");for(var e=0;e<this.segments.length;e++)0<e&&h.push("/"),h.push(this.segments[e]);this.hasTrailing&&h.push("/");return h.join("")},removeRelative:function(){var h=this.getSegments();return 0<h.length&&"."==h[1]?this.removeFirstSegments(1):this},relativeTo:function(h,e){"string"==typeof h&&(h=new m(h));var b=this.segments;if(this.isAbsolute())return this;
var k=h.getSegments(),a=this.matchingFirstSegments(h),k=k.length;e&&--k;k-=a;if(0==k+b.length-a)return davinci.model.Path.EMPTY;for(var g=[],n=0;n<k;n++)g.push("..");for(n=a;n<b.length;n++)g.push(b[n]);return new m(g,!1,this.hasTrailing)},startsWith:function(h){var e=this.matchingFirstSegments(h);return h._length()==e},_length:function(h){return this.segments.length},matchingFirstSegments:function(h){var e=this.segments;h=h.getSegments();for(var b=Math.min(e.length,h.length),k=0,a=0;a<b&&e[a]==h[a];a++)k++;
return k},removeFirstSegments:function(h){return new m(this.segments.slice(h,this.segments.length),this.hasLeading,this.hasTrailing)},removeMatchingLastSegments:function(h){h=this.matchingFirstSegments(h);return this.removeLastSegments(h)},removeMatchingFirstSegments:function(h){h=this.matchingFirstSegments(h);return this._clone().removeFirstSegments(h)},removeLastSegments:function(h){h||(h=1);return new m(this.segments.slice(0,this.segments.length-h),this.hasLeading,this.hasTrailing)},lastSegment:function(){return this.segments[this.segments.length-
1]},firstSegment:function(h){return this.segments[h||0]},equals:function(h){if(this.segments.length!=h.segments.length)return!1;for(var e=0;e<this.segments.length;e++)if(h.segments[e]!=this.segments[e])return!1;return!0},_canonicalize:function(){for(var h,e=this.segments,b=0;b<e.length;b++)if("."==e[b]||".."==e[b]){h=!0;break}if(h){h=[];for(b=0;b<e.length;b++)".."==e[b]?0==h.length?this.hasLeading||h.push(e[b]):".."==h[h.length-1]?h.push(".."):h.pop():"."==e[b]&&1!=this.segments.length||h.push(e[b]);
h.length!=e.length&&(this.segments=h)}}});davinci.model.Path.EMPTY=new m("");return m})},"davinci/workbench/Preferences":function(){define("dojo/_base/declare dojo/_base/xhr dojo/_base/lang dojo/topic dojo/dom ../Runtime dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/registry davinci/ui/Dialog dijit/Tree dijit/tree/ForestStoreModel dojo/data/ItemFileReadStore dojo/i18n!./nls/workbench dojo/i18n!dijit/nls/common dojo/text!davinci/workbench/templates/Preferences.html dijit/form/Button".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y){var B=p([a,g,n],{templateString:y,commonStrings:z,resize:function(){this.borderContainer.resize()}}),x={_allPrefs:{},savePreferences:function(c,d,a){},_loadExtensions:function(){x._extensions||(x._extensions=k.getExtensions("davinci.preferences"))},showPreferencePage:function(){x._loadExtensions();var a=x.getPrefJson();if(a.items)for(var n=a.items.length-1;0<=n;n--){var g=a.items[n];g.hide&&a.items.splice(n,1)}if(!a||1>a.length)alert(r.noUserPref);else{this.dialog=
d.showModal(new B({}),r.preferences,{width:650,height:350});var g=new u({data:a,jsId:"prefTreeDataStore"}),n=new q({jsId:"fileModel",labelAttr:"name",store:g,rootId:"root"}),k=["root"];if(a=a.items){do g=a[0],k.push(g.id),a=g.children;while(a)}var e=f.byId("prefTree");e||(e=new c({model:n,id:"prefTree",persist:!1,query:"{type:'directory'}",label:"Preferences",labelAttr:"name",showRoot:!1,childrenAttrs:"children",openOnClick:!0,autoExpand:!0}));e.onClick=function(c){x.setPaneContent(c)};b.byId("pref.TreePane").appendChild(e.domNode);
e.startup();e.onLoadDeferred.then(function(){e.set("paths",[k]).then(function(){e.focusNode(e.selectedNode);x.setPaneContent(e.selectedItem)})})}},getPrefJson:function(){var c=x._extensions;if(!c)return[];for(var d=[],a=0;a<c.length;a++)c[a]._index=a,c[a].category?(d[c[a].category]||(d[c[a].category]=[]),d[c[a].category].push(c[a])):(d.root||(d.root=[]),d.root.push(c[a]));return{identifier:"id",items:d.root.map(function(c){return{id:c.id,name:c.name,hide:c.hide,index:c._index,children:x._getPrefJsonChildren(c.id,
d)}})}},_getPrefJsonChildren:function(c,d){var a=d[c];if(!a)return[];for(var f=[],b=0;b<a.length;b++)f[b]={id:a[b].id,name:a[b].name,index:a[b]._index},d[a[b].id]&&(f[b].children=x._getPrefJsonChildren(a[b].id,d));return f},setPaneContent:function(c){var d;delete x._currentPane;var a=x._extensions[c.index[0]],b=x.getPreferences(a.id,davinci.Workbench.getProject());a.pane?require([a.pane],function(c){c=new c;x._currentPane=c;x._currentPane._extension=a;x._currentPane.setPreferences(b);f.byId("pref.RightPane").setContent(c.domNode)}):
d=a.pageContent?document.createTextNode(a.pageContent):document.createTextNode("");d&&f.byId("pref.RightPane").setContent(d)},_save:function(c){if(x._currentPane){var d=x._currentPane.getPreferences(),a=x._currentPane._extension.id,f=davinci.Workbench.getProject();x.savePreferences(a,f,d);x._currentPane.save&&x._currentPane.save(d)}for(d=0;d<c.length;d++){try{c[d].save&&c[d].save()}catch(b){}c[d].children&&0<c[d].children.length&&x._save(c[d].children)}},save:function(){x._save(x._extensions);x.finish()},
finish:function(){x._extensions=null;x._currentPane=null;this.dialog.destroyRecursive(!1);this.dialog=null},getPreferences:function(c,d){x._allPrefs[d]||(x._allPrefs[d]={});return{version:"1.7",specVersion:"0.8",snap:!0,helper:"maq-metadata-dojo/dojox/mobile/ThemeHelper",themeSets:[{_COMMENT_:"Defines site-specific default theme sets",desktopTheme:"claro",mobileTheme:[{device:"Android",theme:"android"},{device:"BlackBerry",theme:"blackberry"},{device:"iPad",theme:"ipad"},{device:"iPhone",theme:"iphone"},
{device:"other",theme:"iphone"}],name:"site_dojo_default"}]}},getDefaultPreferences:function(c){x._loadExtensions();for(var d=0;d<x._extensions.length;d++)if(x._extensions[d].id==c)return"string"===typeof x._extensions[d].defaultValues?k.serverJSONRequest({url:x._extensions[d].defaultValues,handleAs:"json",sync:!0}).defaultValues:x._extensions[d].defaultValues}};return h.setObject("davinci.workbench.Preferences",x)})},"davinci/Theme":function(){define("dojo/_base/declare dojo/promise/all ./Workbench ./Runtime ./library ./workbench/Preferences ./model/Path ./html/HTMLFile ./model/Factory system/resource".split(" "),
function(p,m,h,e,b,k,a,g,n,f){var d={TEMP_CLONE_PRE:"clone_",desktop_default:"desktop_default",mobile_default:"custom_default",default_theme:"(device-specific)",none_themeset_name:"(none)",other_device:"other",none_theme:"none",dojoMobileDefault:[{theme:"android",device:"Android"},{theme:"blackberry",device:"BlackBerry"},{theme:"ipad",device:"iPad"},{theme:"iphone",device:"iPhone"},{theme:"iphone",device:"other"}],dojoMobileCustom:[{theme:"custom",device:"Android"},{theme:"custom",device:"BlackBerry"},
{theme:"custom",device:"iPad"},{theme:"custom",device:"iPhone"},{theme:"custom",device:"other"}],isThemeHTML:function(c){return-1<c.getName().indexOf("dojo-theme-editor.html")},CloneTheme:function(c,d,b,n,g,k){function e(c){var d=[];c.forEach(function(c){c=f.findResource(A+"/"+c);c=(new a(c.getPath())).relativeTo("./"+v,!0);for(var b="..",n=0;n<c.segments.length;n++)b=b+"/"+c.segments[n];d.push(b)});return d}b=[];g.getFile();k=(new a(n)).removeLastSegments(0);k=f.findResource(k.toString());k.readOnly()&&
k.createResource();f.createResource(n,!0);var h=f.findResource(n);g.getFile().getName();var w=(new a(h.getPath())).lastSegment();n=h.createResource(w+".theme");k=h.createResource(w+".css");var v=this.getThemeLocation(),A=g.getFile().parent.getPath(),C=e(g.themeEditorHtmls),p=e(g.meta),E=" ";e(g.files).forEach(function(c){E=E+'@import url("'+c+'");'});c={className:g.className,name:c,version:d||g.version,specVersion:g.specVersion,files:[""+w+".css"],meta:p,themeEditorHtmls:C,useBodyFontBackgroundClass:g.useBodyFontBackgroundClass};
g.helper&&(c.helper=g.helper.declaredClass?g.helper.declaredClass:g.helper);g.base&&(c.base=g.base);g.type&&(c.type=g.type);if(g.conditionalFiles)for(c.conditionalFiles=g.conditionalFiles,g=e(g.conditionalFiles),d=0;d<c.conditionalFiles.length;d++)w=h.createResource(c.conditionalFiles[d]),b.push(w.setContents('@import url("'+g[d]+'");'));g=n.setContents(JSON.stringify(c));g.themeFile=n;b.push(g);b.push(k.setContents(E));return{promise:m(b),themeFile:n}},getHelper:function(c){if(c){if(c.helper&&"string"!=
typeof c.helper)return c.helper;var d=c.helper;if(d){var a=new dojo.Deferred;require([d],function(c){c.declaredClass=d;d=c;a.resolve({helper:d})});return a}}},getThemeSet:function(c){var a=d.getThemeSets(h.getProject()),f=dojo.clone(this.dojoMobileDefault),b;a||(a=this.dojoThemeSets);a=dojo.clone(a);if(c){if(b=c._getDojoJsElem().getAttribute("data-dojo-config"))b=require.eval("({ "+b+" })","data-dojo-config"),b.themeMap&&(f=d.getDojoxMobileThemesFromThemeMap(c,b.themeMap));var n=c.getTheme();if(null==
n)console.error("have no desktop theme, abort!");else for(var g=0,k=a.themeSets.length;g<k;g++)if(b=a.themeSets[g],b.desktopTheme===n.name&&this.themeSetEquals(f,b.mobileTheme))return b}n||(console.error("maq hack, restore desktop theme"),n={name:"claro"});b={name:this.none_themeset_name,desktopTheme:c?n.name:"claro",mobileTheme:f};a.themeSets.push(b);return b},getBase:function(){if(h.singleProjectMode())return h.getProject()},getThemeLocation:function(){var c=this.getBase(),d=k.getPreferences("davinci.ui.ProjectPrefs",
c);return(new a(c)).append(d.themeFolder)},getTheme:function(c,d){for(var a=b.getThemes(h.getProject(),this.workspaceOnly),f=0;f<a.length;f++)if(a[f]&&a[f].name===c)return a[f]},getThemeByCssFile:function(c){var d=b.getThemes(h.getProject(),this.workspaceOnly);c=f.findResource(c.url).getPath();for(var a=0;a<d.length;a++)for(var n=d[a].getFile().getParentFolder().getPath(),g=0;g<d[a].files.length;g++)if(n+"/"+d[a].files[g]===c)return d[a];return null},getDojoxMobileThemeMap:function(c,d){for(var f=
[],b=[".*","iphone",[]],n=0;n<d.length;n++)if(d[n].theme!=this.none_theme&&d[n].theme!=this.default_theme){var g=this.getTheme(d[n].theme);if(g){var k;g.path&&g.path[0]?(k=g.path[0].lastIndexOf("/"),k=new a(g.path[0].substring(0,k+1)+g.files[0])):k=(new a(g.getFile().parent.getPath())).append(g.files[0]);var e=c.getFullResourcePath();k=k.relativeTo(e,!0).toString();d[n].device===this.other_device?b=[".*",g.base,[k]]:f.push([d[n].device,g.base,[k]])}}f.push(b);return f},getDojoxMobileThemesFromThemeMap:function(c,
d){var f=b.getThemes(h.getProject(),this.workspaceOnly),n=[];d.forEach(function(d,b,g){for(g=0;g<f.length;g++){b=f[g];var k=(new a(b.getFile().parent.getPath())).append(b.files[0]),q=c.getFullResourcePath();if(k.relativeTo(q,!0).toString()==d[2][0]){g={};g.device=d[0];g.theme=b.name;".*"===g.device&&(g.device="other");n.push(g);break}}},this);return n},themeSetEquals:function(c,d){function a(c){var d=0,f;for(f in c)c.hasOwnProperty(f)&&d++;return d}if(typeof c!==typeof d)return!1;if("function"===
typeof c)return c.toString()===d.toString();if(c instanceof Object&&d instanceof Object){if(a(c)!==a(d))return!1;var f=!0,b;for(b in c)if(f=this.themeSetEquals(c[b],d[b]),!f)return!1;return!0}return c===d},themeMapsEqual:function(c,d){var a=JSON.stringify(c),f=JSON.stringify(d);return a===f},singleMobileTheme:function(c){for(var d=c.mobileTheme[0].theme,a=1;a<c.mobileTheme.length;a++)if(c.mobileTheme[a].theme!=d)return!1;return!0},getThemeSets:function(c){var a=e.getDefaultThemeSet(),f=null;if(a){var b=
!1;if(f=k.getPreferences("maqetta.dojo.themesets",c)){for(var n=!1,g=0;g<f.themeSets.length;g++)if(f.themeSets[g].name===a.name){n=!0;d.themeSetEquals(f.themeSets[g],a)||(f.themeSets[g]=a,b=!0);break}n||(f.themeSets.push(a),b=!0)}else f=d.dojoThemeSets,f.themeSets[0]=a,b=!0;b&&d.saveThemeSets(c,f)}return f},saveThemeSets:function(c,d){k.savePreferences("maqetta.dojo.themesets",c,d)}};d.none_themeset={name:d.none_themeset_name,desktopTheme:"claro",mobileTheme:dojo.clone(d.dojoMobileDefault)};d.default_themeset=
{name:d.desktop_default,desktopTheme:"claro",mobileTheme:dojo.clone(d.dojoMobileDefault)};d.custom_themeset={name:d.mobile_default,desktopTheme:"claro",mobileTheme:d.dojoMobileCustom};d.dojoThemeSets={version:"1.7",specVersion:"0.8",helper:"maq-metadata-dojo/dojox/mobile/ThemeHelper",themeSets:[d.custom_themeset]};return d})},"davinci/html/HTMLFile":function(){define("dojo/_base/declare davinci/html/HTMLItem davinci/html/HTMLParser davinci/html/CSSSelector davinci/html/HTMLElement davinci/html/CSSImport davinci/html/CSSFile davinci/model/Model davinci/model/Path".split(" "),
function(p,m,h,e,b,k,a,g,n){return p("davinci.html.HTMLFile",m,{constructor:function(a){this.url=this.fileName=a;this.elementType="HTMLFile";this._loadedCSS={};this._styleElem=null},save:function(a){var d,c=system.resource.findResource(this.fileName);this.getText();c?(d=this.getText(),d=c.setContents(d,a)):console.error("couldnt find file in resources : "+this.fileName);return d},getText:function(a){a=a||{};a.indent=0;for(var d="",c=0;c<this.children.length;c++){var b=this.children[c],d=d+b.getText(a);
"HTMLComment"==b.elementType&&(d+=this._addWS(b._fmLine,b._fmIndent))}return d},getDocumentElement:function(a){for(a=0;a<this.children.length;a++)if("html"==this.children[a].tag)return this.children[a]},findElement:function(a){var d=this.getDocumentElement();if(d)return d.findElement(a)},getMatchingRules:function(a,d){var c={visit:function(c){if("CSSFile"==c.elementType){var d=[];c=c.getMatchingRules(a,[],d);for(var b=0;b<c.length;b++)for(var n=0;n<this.matchLevels.length;n++)if(d[b]>this.matchLevels[n]){this.matchLevels.splice(n,
0,d[b]);this.rules.splice(n,0,c[b]);break}0==this.rules.length&&(this.rules=c,this.matchLevels=d);return!0}return!1},matchLevels:[],rules:[]};this.visit(c);return d?{rules:c.rules,matchLevels:c.matchLevels}:c.rules},getRule:function(a){if(!a)return[];var d=e.parseSelectors(a);a={visit:function(c){return"CSSFile"==c.elementType?(c=c.getRule(d),this.rules=this.rules.concat(c||[]),!0):!1},rules:[]};this.visit(a);return a.rules},setText:function(a,d){this.visit({visit:function(c){"CSSImport"==c.elementType&&
c.close()}});this.children=[];this._styleElem=null;var c=h.parse(a||"",this),b="";d||0!=c.errors.length||(b=this.getText(),this.children=[],c=h.parse(b,this));this.endOffset=c.endOffset;this.errors=c.errors;var n=this;d||this.visit({visit:function(c){"CSSImport"!=c.elementType||c.cssFile||(c.load(!0),dojo.connect(c.cssFile,"onChange",null,dojo.hitch(n,"onChange")))}});this.onChange()},hasStyleSheet:function(a){for(var d=this.find({elementType:"CSSImport"}),c=0;c<d.length;c++)if(d[c].url==a)return!0;
return!1},addStyleSheet:function(a,d,c,g,e){var r=new n(this.url||this.fileName),r=r.getParentPath().append(a),r=r.toString();c||(this._loadedCSS[r]=require("davinci/model/Factory").getModel({url:r,includeImports:!0,loader:e}));d&&this._loadedCSS[r].setText(d);this.onChange();this._styleElem||(d=this.find({elementType:"HTMLElement",tag:"head"},!0),e=d.getChildElement("style"),e||(e=new b("style"),d.addChild(e)),this._styleElem=e);d=new k;d.parent=this;d.url=a;g?this._styleElem.insertBefore(d,g):this._styleElem.addChild(d);
c||d.load(!0)},close:function(){this.visit({visit:function(a){"CSSImport"==a.elementType&&a.close()}});require("davinci/model/Factory").closeModel(this)},getLabel:function(){return"\x3c\x3e"},getID:function(){return this.fileName},updatePositions:function(a,d){(new g(this)).updatePositions(this,a,d);this.visit({visit:function(c){if(c.endOffset<a)return!0;"HTMLElement"==c.elementType&&c.startTagOffset>a&&(c.startTagOffset+=d)}})},mapPositions:function(a){var d=this.getText();a=a.getText();d=d.indexOf(a);
a=d+a.lastIndexOf("\x3e")+1;return{startOffset:d,endOffset:a}},reportPositions:function(){this.visit({visit:function(a){}})},evaluate:function(a){if("/"!==a.charAt(0))console.error("invalid XPath string");else{var d=this;a.substr(1).split("/").forEach(function(c){c=c.match(this._RE_XPATH);var a=c[1];c=c[2];var f;f=d.children.filter(function(c){return c.tag===a});!c&&1<f.length?console.error("invalid XPath string; no index specified for multiple elements"):d=c?f[c-1]:f[0]},this);return d}},_RE_XPATH:/(\w+)(?:\[(\d+)\])?/})})},
"davinci/html/HTMLItem":function(){define(["dojo/_base/declare","davinci/html/HTMLModel"],function(p,m){return p("davinci.html.HTMLItem",m,{constructor:function(){this.elementType="HTMLItem"},getLabel:function(){return this.getText({indent:0})},onChange:function(h){if(this.parent&&h)this.parent.onChange(h)},_addWS:function(h,e){h=h||0;e=e||0;for(var b=[],k=0;k<h;k++)b.push("\n");b.push("                                          ".substring(0,e));return b.join("")},close:function(){for(var h=0;h<this.children.length;h++)this.children[h].close()},
getID:function(){return this.parent.getID()+":"+this.startOffset+":"+this.getLabel()},getHTMLFile:function(){for(var h=this;h&&"HTMLFile"!=h.elementType;)h=h.parent;return h}})})},"davinci/html/HTMLModel":function(){define(["dojo/_base/declare","davinci/model/Model"],function(p,m){davinci.html||(davinci.html={});davinci.html._noFormatElements={span:!0,b:!0,it:!0};davinci.html.escapeXml=function(h){return h?h.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;"):
h};davinci.html.unEscapeXml=function(h){return h&&"string"===typeof h?h.replace(/&quot;/g,'"').replace(/&gt;/g,"\x3e").replace(/&lt;/g,"\x3c").replace(/&amp;/g,"\x26"):h};return p("davinci.html.HTMLModel",m,{})})},"davinci/model/Model":function(){define(["dojo/_base/declare"],function(p){return p("davinci.model.Model",null,{constructor:function(){this.name=this.elementType="";this.endOffset=this.startOffset=0;this.parent=null;this.children=[]},inherits:function(m){1<arguments.length?m.apply(this,
Array.prototype.slice.call(arguments,1)):m.call(this)},getText:function(){},setText:function(m){},addChild:function(m,h,e){m.parent=this;void 0!=h?this.children.splice(h,0,m):this.children.push(m)},setStart:function(m){this.startOffset=m},setEnd:function(m){this.endOffset=m},getLabel:function(){return null},getID:function(){return null},mapPositions:function(m){return{startOffset:m.startOffset,endOffset:m.endOffset}},findChildAtPosition:function(m){m.endOffset||(m.endOffset=m.startOffset);if(m.startOffset>=
this.startOffset&&m.endOffset<=this.endOffset){for(var h=0;h<this.children.length;h++){var e=this.children[h].findChildAtPosition(m);if(null!=e)return e}return this}return null},removeChild:function(m){for(var h=0;h<this.children.length;h++)if(this.children[h]==m){this.children.splice(h,1);break}},find:function(m,h){var e={visit:function(b){if(0<this.found.length&&h)return!0;var k=null;for(k in m)if(b[k]!=m[k])break;b[k]==m[k]&&this.found.push(b);return!1},found:[]};this.visit(e);return h?0<e.found.length?
e.found[0]:null:e.found},setDirty:function(m){this.dirtyResource=m},isDirty:function(){return this.dirtyResource},searchUp:function(m){if(this.elementType==m)return this;for(var h=this.parent;h&&h.elementType!=m;)h=h.parent;return h},visit:function(m){if(!m.visit(this))for(var h=0;h<this.children.length;h++)this.children[h].visit(m);m.endVisit&&m.endVisit(this)},updatePositions:function(m,h,e){visitor={visit:function(b){if(b.endOffset<h)return!0;b.startOffset>=h?(b.startOffset+=e,b.endOffset+=e):
b.endOffset>=h&&(b.endOffset+=e)}};m.visit(visitor)}})})},"davinci/html/HTMLParser":function(){define("dojo/_base/declare davinci/html/HTMLText davinci/html/HTMLElement davinci/html/HTMLAttribute davinci/html/HTMLComment davinci/html/PHPBlock davinci/model/parser/Tokenizer davinci/html/CSSParser".split(" "),function(p,m,h,e,b,k,a,g){var n=function(){var f={autoSelfClosers:{br:!0,img:!0,hr:!0,link:!0,input:!0,meta:!0,col:!0,frame:!0,base:!0,area:!0},doNotIndent:{pre:!0,"!cdata":!0}},d={autoSelfClosers:{},
doNotIndent:{"!cdata":!0}},c=f,b=!1,n=function(){function c(a,f){var g=a.next();if("\x3c"==g){if(a.equals("!"))return a.next(),a.equals("[")?a.lookAhead("[CDATA[",!0)?(f(b("xml-cdata","]]\x3e")),null):"xml-text":a.lookAhead("--",!0)?(f(b("xml-comment","--\x3e")),null):a.lookAhead("DOCTYPE",!0)?(a.nextWhileMatches(/[\w\._\-]/),f(b("xml-doctype","\x3e")),"xml-doctype"):"xml-text";if(a.equals("?")){a.next();if(a.lookAhead("php",!0,!1,!0))return f(n("php-block","?\x3e")),null;a.nextWhileMatches(/[\w\._\-]/);
f(b("xml-processing","?\x3e"));return"xml-processing"}a.equals("/")&&a.next();f(d);return"xml-punctuation"}if("\x26"==g){for(;!a.endOfLine()&&";"!=a.next(););return"xml-entity"}a.nextWhileMatches(/[^&<\n]/);return"xml-text"}function d(a,b){var n=a.next();if("\x3e"==n)return b(c),"xml-punctuation";if(/[?\/]/.test(n)&&a.equals("\x3e"))return a.next(),b(c),"xml-punctuation";if("\x3d"==n)return"xml-punctuation";if(/[\'\"]/.test(n))return b(f(n)),null;a.nextWhileMatches(/[^\s\u00a0=<>\"\'\/?]/);return"xml-name"}
function f(c){return function(a,f){for(;!a.endOfLine();)if(a.next()==c){f(d);break}return"xml-attribute"}}function b(a,d){return function(f,b){for(;!f.endOfLine();){if(f.lookAhead(d,!0)){b(c);break}f.next()}return a}}function n(a,d){return function(f,b){for(var n=!1;!f.endOfLine();){if(f.lookAhead(d,!0)){n=!0;b(c);break}f.next()}if(!n&&f.endOfLine())f.next();else{for(;f.lookAheadRegex(/^[\ \t]/,!0););f.endOfLine()&&f.next()}return a}}return function(d,f){return a.tokenizer(d,f||c)}}();return{make:function(a){function d(c){for(var a=
c.length-1;0<=a;a--)J.push(c[a])}function f(){d(arguments);Q=!0}function g(){d(arguments);Q=!1}function k(){F.style+=" xml-error"}function e(c){return function(a,d){d==c?f():(k(),f(arguments.callee))}}function h(a,d){var f=c.doNotIndent.hasOwnProperty(a)||O&&O.noIndent;O={prev:O,name:a,indent:P,startOfLine:d,noIndent:f}}function A(c){return function(a,d){var f=c;if(f&&f.noIndent)return d;if(b&&/<!\[CDATA\[/.test(a))return 0;f&&/^<\//.test(a)&&(f=f.prev);for(;f&&!f.startOfLine;)f=f.prev;return f?f.indent+
indentUnit:0}}function m(){return g(p,m)}function p(c,a){"\x3c"==a?f(E,G,D(1==H)):"\x3c/"==a?f(I,e("\x3e")):("xml-cdata"==c?(O&&"!cdata"==O.name||h("!cdata"),/\]\]>$/.test(a)&&(O=O.prev)):V.hasOwnProperty(c)||k(),f())}function E(c,a){"xml-name"==c?(R=a.toLowerCase(),F.style="xml-tagname",f()):(R=null,g())}function I(c,a){"xml-name"==c&&(F.style="xml-tagname",O&&a.toLowerCase()==O.name?O=O.prev:k());f()}function D(a){return function(d,b){"/\x3e"==b||"\x3e"==b&&c.autoSelfClosers.hasOwnProperty(R)?f():
"\x3e"==b?(h(R,a),f()):(k(),f(arguments.callee))}}function G(c){"xml-name"==c?(F.style="xml-attname",f(N,G)):g()}function N(c,a){"\x3d"==a?f(M):"\x3e"==a||"/\x3e"==a?g(D):g()}function M(c){"xml-attribute"==c?f(M):g()}var K=n(a),F,J=[m],H=0,P=0,R=null,O=null,Q,V={"xml-text":!0,"xml-entity":!0,"xml-comment":!0,"xml-processing":!0,"xml-doctype":!0,"php-block":!0};return{indentation:function(){return P},next:function(){F=K.next();"whitespace"==F.style&&0==H?P=F.value.length:H++;"\n"==F.content&&(P=H=
0,F.indentation=A(O));if("whitespace"==F.style||"xml-comment"==F.type||"php-block"==F.type)return F;for(;;)if(Q=!1,J.pop()(F.style,F.content),Q)return F},copy:function(){var c=J.concat([]),a=K.state,d=O,f=this;return function(b){J=c.concat([]);H=P=0;O=d;K=n(b,a);return f}}}},electricChars:"/",configure:function(a){null!=a.useHTMLKludges&&(c=a.useHTMLKludges?f:d);a.alignCDATA&&(b=a.alignCDATA)}}}();return{parse:function(f,d){function c(c,a){C=new m;C.wasParsed=!0;C.startOffset=a;A[A.length-1].addChild(C,
void 0,!0);C.value=c}function q(a){a.content!=a.value&&c(a.value.substring(a.content.length),a.offset+a.value.length)}function u(c,a){var d=c.split("\n"),f=d[d.length-1].length;a.children.length?(lastElement=a.children[a.children.length-1],lastElement._fmLine=d.length-1,lastElement._fmIndent=f):(a._fmChildLine=d.length-1,a._fmChildIndent=f)}function r(){if(null!=C&&!C.value.match(/\S/)){var c=A[A.length-1];c.children.pop();u(C.value,c)}C=null}function z(){var c=A[A.length-1];B.nextWhileMatches(/[\s\u00a0]/);
var a=B.get();null!=C?(C.value+=a,r()):u(a,c);g.parse(B,c)}function y(c){for(w=x.next();c&&"whitespace"==w.style;)w=x.next();return w}var B=a.stringStream({next:function(){if(1==++this.count)return f;throw StopIteration;},count:0,text:f}),x=n.make(B),w,v=[],A=[];A.push(d);var C,p,E;try{do switch(w=x.next(),w.style){case "xml-punctuation":r();if("\x3c"==w.content){var I=new h;I.wasParsed=!0;I.startOffset=w.offset;A[A.length-1].addChild(I,void 0,!0);y(!0);for("xml-tagname"==w.style?I.tag=w.content:
v.push("expecting tag name");"xml-attname"==(w=y(!0)).style;){var D=new e;D.wasParsed=!0;I.attributes.push(D);D.name=w.content;D.startOffset=w.offset;y(!0);if("\x3d"==w.content)if(w=x.next(),"xml-attribute"==w.style){var G=w.content;D.setValue(G.substring(1,G.length-1))}else v.push("expecting attribute value");else D.noValue=!0,D.setValue(!0);D.endOffset=w.offset-1;if(D.noValue&&"xml-attname"!=w.style)break}"xml-punctuation"!=w.style?v.push("expecting \x3e"):(I.startTagOffset=w.offset,"\x3e"==w.content?
A.push(I):(I.noEndTag=!0,I=A[A.length-1]),q(w));"style"==I.tag&&z()}else if("\x3c/"==w.value){var N=I;w=x.next();"script"==I.tag&&(I.script=I.getElementText());A.pop();I=A[A.length-1];w=x.next();N.endOffset=w.offset;q(w)}E=null;break;case "xml-text":case "whitespace":case "xml-entity":p?p.value+=w.value:E?E.value+=w.value:C?C.value+=w.value:c(w.value,w.offset);E=null;break;case "xml-comment":r();var M=new b;M.wasParsed=!0;M.startOffset=w.offset;M.value=w.content.substring(4,w.content.length-3);M.endOffset=
w.offset+w.content.length;A[A.length-1].addChild(M,void 0,!0);E=null;break;case "php-block":r();var K=new k;K.wasParsed=!0;K.startOffset=w.offset;K.value=w.content;K.endOffset=w.offset+w.content.length;A[A.length-1].addChild(K,void 0,!0);E=K;break;case "xml-doctype":p||(r(),M=new b,M.wasParsed=!0,M.startOffset=w.offset,M.value=w.value.substring(2),A[A.length-1].addChild(M,void 0,!0),M.isProcessingInstruction=!0,w=x.next());var F=w.content.length-1;"\x3e"==w.content.charAt(w.content.length-1)?(M.endOffset=
w.offset+w.content.length,M.value+=w.content.substring(0,F),q(w),p=void 0):(p=M,M.value+=w.content);E=null}while(1)}catch(J){}return{errors:v,endOffset:w?w.offset:0}}}})},"davinci/html/HTMLText":function(){define(["dojo/_base/declare","davinci/html/HTMLItem"],function(p,m){return p("davinci.html.HTMLText",m,{constructor:function(h){this.elementType="HTMLText";this.value=h||""},getText:function(h){return this.value},setText:function(h){if(this.wasParsed||this.parent&&this.parent.wasParsed){var e=h.length-
this.value.length;0<e&&this.getHTMLFile().updatePositions(this.startOffset+1,e)}this.value=h},getLabel:function(){return 15>this.value.length?this.value:this.value.substring(0,15)+"..."}})})},"davinci/html/HTMLElement":function(){define(["dojo/_base/declare","davinci/html/HTMLItem","davinci/html/HTMLText","davinci/html/HTMLComment","davinci/html/HTMLAttribute"],function(p,m,h,e,b){return p("davinci.html.HTMLElement",m,{constructor:function(b){this.elementType="HTMLElement";this.attributes=[];this.tag=
b||"";this._fmChildIndent=this._fmChildLine=0},add:function(b){this.statements||(this.statements=[]);this.statements.push(b);this.onChange()},getText:function(b){b=b||{};var a;b.indent+=2;a="\x3c"+this.tag;for(var g=0;g<this.attributes.length;g++){var n=this.attributes[g].getText(b);0<n.length&&(a=a+" "+n)}if(this.noEndTag)a+="/\x3e";else{a=a+"\x3e"+this._addWS(this._fmChildLine,this._fmChildIndent);if(this.statements)for(g=0;g<this.statements.length;g++)a+=this.statements[g].printStatement(b,this.statements[g]);
else if(this.script)a+=this.script;else if(0<this.children.length)for(n="style"==this.tag,g=0;g<this.children.length;g++)if(a+=this.children[g].getText(b),n){var f=this._fmChildLine,d=this._fmChildIndent||0;g+1==this.children.length&&(f=this._fmLine,d=this._fmIndent);a+=this._addWS(f,d)}a=a+"\x3c/"+this.tag+"\x3e"}b.indent-=2;return a+=this._addWS(this._fmLine,this._fmIndent)},_formatModel:function(b,a,g){function n(c,a,f){d+=1+c;a?(a._fmChildLine=1,a._fmChildIndent=g.indent):(f._fmLine=1,f._fmIndent=
g.indent)}function f(c,a){c.startOffset=d;c.wasParsed=!0;d+=c.tag.length+2;for(var b=0;b<c.attributes.length;b++){c.attributes[b].startOffset=d;var g=c.attributes[b].getText(a);0<g.length&&(d+=1+g.length);c.attributes[b].endOffset=d-1}c.noEndTag&&d++;c.startTagOffset=d;g="";if(c.statements)for(b=0;b<c.statements.length;b++)g+=c.statements[b].printStatement(a,c.statements[b]);else c.script&&(g=c.script);if(g)d+=g.length;else if(0<c.children.length){var k;davinci.html._noFormatElements[c.tag]||(a.indent+=
2,n(a.indent,c),k=!0);for(var q,b=0;b<c.children.length;b++){g=c.children[b];switch(g.elementType){case "HTMLElement":q&&"HTMLText"!=q.elementType&&!davinci.html._noFormatElements[g.tag]&&n(a.indent,null,q);f(g,a);break;case "HTMLText":g.startOffset=d;d+=g.value.length;break;case "HTMLComment":g.startOffset=d,d+=g.value.length,d++,g.isProcessingInstruction&&(d+=2)}q=g}k&&(a.indent-=2);q&&"HTMLText"!=q.elementType&&n(a.indent,null,q)}d+=c.tag.length+3;c.endOffset=d-1}var d=0;void 0==a&&(a=this.children.length);
var c,q;this.children.length&&0!=a?(q=this.children[a-1],d=q.endOffset+1):(c=this,d=this.startTagOffset+1);var e=d;davinci.html._noFormatElements[b.tag]||(n(g.indent,c,q),b._fmLine=1,b._fmIndent=a<this.children.length?g.indent:g.indent-2);f(b,g);return d>e?d-e:0},getElementText:function(b){b=b||{};var a="";if(0<this.children.length)for(var g=0;g<this.children.length;g++)"HTMLComment"!=this.children[g].elementType&&(a+=this.children[g].getText(b));else{if(this.script)return this.script;if(this.statements)for(g=
0;g<this.statements.length;g++)a+=this.statements[g].printStatement(b,this.statements[g])}return a},getChildElements:function(b,a,g){g=g||[];for(var n=0;n<this.children.length;n++)this.children[n].tag==b&&g.push(this.children[n]),a&&"HTMLElement"==this.children[n].elementType&&this.children[n].getChildElements(b,a,g);return g},getChildElement:function(b){for(var a=0;a<this.children.length;a++)if(this.children[a].tag==b)return this.children[a]},hasAttribute:function(b){for(var a=0;a<this.attributes.length;a++)if(this.attributes[a].name==
b)return!0;return!1},getAttribute:function(b){if(b=this._getAttribute(b))return b.value},_getAttribute:function(b){for(var a=0;a<this.attributes.length;a++)if(this.attributes[a].name==b)return this.attributes[a]},addText:function(b){this.addChild(new h(b));this.onChange()},addComment:function(b){this.addChild(new e(b));this.onChange()},getLabel:function(){return"\x3c"+this.tag+"\x3e"},addAttribute:function(k,a,g){if("textContent"==k)this.children=[],this.addText(a);else{var n,f=0<this.attributes.length?
this.attributes[this.attributes.length-1].endOffset+1:this.startTagOffset-(this.noEndTag?2:1),d=this._getAttribute(k),c;d?n=a.length-d.value.length:(d=new b,c=!0,n=k.length+a.length+4,d.startOffset=f,d.endOffset=f+n-1);d.name=k;d.setValue(a);d.noPersist=g;this.wasParsed&&!g&&0<n&&this.getHTMLFile().updatePositions(f,n);c&&this.attributes.push(d);this.onChange()}},removeAttribute:function(b){this.attributes.every(function(a,g,n){return a.name===b?(n.splice(g,1),g=this.getHTMLFile(),!a.noPersist&&g&&
(n=a.getText(),g.updatePositions(a.startOffest,0-(n.length+1))),!1):!0},this);this.onChange()},setAttribute:function(b,a){this.removeAttribute(b);this.addAttribute(b,a)},getUniqueID:function(b){if(!this.getAttribute("id")){var a=this.getHTMLFile();a.uniqueIDs||(a.uniqueIDs={});a=a.uniqueIDs.hasOwnProperty(this.tag)?++a.uniqueIDs[this.tag]:a.uniqueIDs[this.tag]=0;this.addAttribute("id",this.tag+"_"+a,b)}},findElement:function(b){var a=this.getAttribute("id");if(b==a)return this;for(a=0;a<this.children.length;a++)if("HTMLElement"==
this.children[a].elementType){var g=this.children[a].findElement(b);if(g)return g}},insertBefore:function(b,a){var g=dojo.indexOf(this.children,a);0>g&&(g=void 0);this.addChild(b,g);this.onChange()},addChild:function(b,a,g){if(!g&&this.wasParsed)if("HTMLElement"==b.elementType){var n=this._getIndent(),f;a<this.children.length&&"HTMLElement"==this.children[a].elementType?f=this.children[a]._getIndent():this.children.length?dojo.forEach(this.children,function(c){"HTMLElement"==c.elementType&&(f=c._getIndent())}):
f=n+1;n=this._formatModel(b,a,{indent:f});this.getHTMLFile().updatePositions(b.startOffset,n)}else if("HTMLText"==b.elementType||"CSS"==b.elementType.substring(0,3)){var n=b.getText(),d=this.children.length?this.children[this.children.length-1].endOffset:this.startTagOffset,c=n.length;0<c&&("HTMLText"!=b.elementType&&(c+=this._fmChildIndent+1),this.getHTMLFile().updatePositions(d+1,c));b.startOffset=d+1;b.endOffset=b.startOffset+n.length-1}m.prototype.addChild.apply(this,arguments)},removeChild:function(b){var a=
dojo.indexOf(this.children,b);if(0<=a){var g=1+b.endOffset-b.startOffset;if("HTMLElement"==b.elementType)if(1==this.children.length)g+=1*this._fmChildLine+this._fmChildIndent,this._fmChildIndent-=2;else{if(0<a&&"HTMLElement"==this.children[a-1].elementType)var n=this.children[a-1],g=g+(1*n._fmLine+n._fmIndent);a+1==this.children.length&&"HTMLElement"==this.children[a-1].elementType&&(this.children[a-1]._fmChildIndent-=2)}0<g&&this.wasParsed&&this.getHTMLFile().updatePositions(b.startOffset,0-g)}m.prototype.removeChild.apply(this,
arguments)},_textModify:function(b,a){var g=b.length-a.length;0!=g&&this.wasParsed&&this.getHTMLFile().updatePositions(this.startOffset,g)},setScript:function(b){this._textModify(b,this.script);this.script=b},_previous:function(){var b=dojo.indexOf(this.parent.children,this);if(0<b)return this.parent.children[b-1]},_getIndent:function(){var b=this._previous();return b?" HTMLText"==b.elementType?(b=b.value.split("\n"),b[b.length-1].length):b._fmIndent:this.parent._fmChildIndent},visit:function(b){if(!b.visit(this)){for(var a=
0;a<this.attributes.length;a++)this.attributes[a].visit(b);for(a=0;a<this.children.length;a++)this.children[a].visit(b)}b.endVisit&&b.endVisit(this)},setText:function(b){this.script="";var a=this.parent;this.errors=require("davinci/html/HTMLParser").parse(b,this).errors;dojo.mixin(this,this.children[0]);this.parent=a;this.visit({visit:function(a){delete a.wasParsed},rules:[]});this.onChange()}})})},"davinci/html/HTMLComment":function(){define(["dojo/_base/declare","davinci/html/HTMLItem"],function(p,
m){return p("davinci.html.HTMLComment",m,{constructor:function(h){this.elementType="HTMLComment";this.value=h||""},getText:function(h){h=this.isProcessingInstruction?"":"--";return"\x3c!"+h+this.value+h+"\x3e"}})})},"davinci/html/HTMLAttribute":function(){define(["dojo/_base/declare","davinci/html/HTMLItem"],function(p,m){return p("davinci.html.HTMLAttribute",m,{constructor:function(){this.elementType="HTMLAttribute";this.value=this.name=""},getText:function(h){if(this.noPersist&&!h.includeNoPersist)return"";
h=this.name;({checked:1,selected:1,disabled:1,readonly:1,multiple:1,ismap:1,autofocus:1,autoplay:1,controls:1,formnovalidate:1,loop:1,muted:1,required:1})[this.name.toLowerCase()]?h=this.value&&"false"!==this.value?h+('\x3d"'+this.value+'"'):"":this.noValue||(h=h+'\x3d"'+davinci.html.escapeXml(String(this.value))+'"');return h},setValue:function(h){this.value=davinci.html.unEscapeXml(h);this.onChange()}})})},"davinci/html/PHPBlock":function(){define(["dojo/_base/declare","davinci/html/HTMLItem"],
function(p,m){return p("davinci.html.PHPBlock",m,{constructor:function(h){this.elementType="PHPBlock";this.value=h||""},getText:function(h){return h.excludeIgnoredContent?"":this.value}})})},"davinci/model/parser/Tokenizer":function(){define(["dojo/_base/declare","davinci/js/JSExpression"],function(p,m){return{stringStream:function(h){function e(){for(;k==b.length;){g+=b;b="";k=0;try{b=h.next()}catch(a){if(a!=StopIteration)throw a;return!1}}return!0}var b="",k=0,a=0,g="";return{peek:function(){return e()?
b.charAt(k):null},next:function(){if(!e()){if(0<g.length)throw"End of stringstream reached without emptying buffer ('"+g+"').";throw StopIteration;}return b.charAt(k++)},get:function(){var n=g;g="";0<k&&(n+=b.slice(0,k),b=b.slice(k),k=0);a+=n.length;return n},getOffset:function(){return a},push:function(n){b=b.slice(0,k)+n+b.slice(k);a-=n.length},lookAhead:function(a,f,d,c){function q(a){return c?a.toLowerCase():a}a=q(a);var e=!1,r=g,z=k;for(d&&this.nextWhileMatches(/[\s\u00a0]/);;){d=k+a.length;
var y=b.length-k;if(d<=b.length){e=a==q(b.slice(k,d));k=d;break}else if(a.slice(0,y)==q(b.slice(k))){g+=b;b="";try{b=h.next()}catch(B){if(B!=StopIteration)throw B;break}k=0;a=a.slice(y)}else break}e&&f||(b=g.slice(r.length)+b,k=z,g=r);return e},lookAheadRegex:function(a,f){if("^"!=a.source.charAt(0))throw Error("Regexps passed to lookAheadRegex must start with ^");for(;-1==b.indexOf("\n",k);)try{b+=h.next()}catch(d){if(d!=StopIteration)throw d;}var c=b.slice(k).match(a);c&&f&&(k+=c[0].length);return c},
more:function(){return null!==this.peek()},applies:function(a){var b=this.peek();return null!==b&&a(b)},nextWhile:function(a){for(var b;null!==(b=this.peek())&&a(b);)this.next()},matches:function(a){var b=this.peek();return null!==b&&a.test(b)},nextWhileMatches:function(a){for(var b;null!==(b=this.peek())&&a.test(b);)this.next()},equals:function(a){return a===this.peek()},endOfLine:function(){var a=this.peek();return null==a||"\n"==a}}},tokenizer:function(h,e){function b(a){return"\n"!=a&&/^[\s\u00a0]*$/.test(a)}
var k={state:e,take:function(a){"string"==typeof a&&(a={style:a,type:a});a.offset=h.getOffset();a.content=(a.content||"")+h.get();/\n$/.test(a.content)||h.nextWhile(b);a.value=a.content+h.get();return a},next:function(){if(!h.more())throw StopIteration;var a;if(h.equals("\n"))return h.next(),this.take("whitespace");if(h.applies(b))a="whitespace";else for(;!a;)a=this.state(h,function(a){k.state=a});return this.take(a)}};return k}}})},"davinci/js/JSExpression":function(){define(["dojo/_base/declare",
"davinci/js/JSElement"],function(p,m){return p("davinci.js.JSExpression",m,{constructor:function(){this.elementType="JSExpression"},getText:function(){var h="";this.comment&&(h+=this.printNewLine(context)+this.comment.getText(context));this.label&&(h+=this.printNewLine(context)+this.label.getText(context));return h},add:function(h){}})})},"davinci/js/JSElement":function(){define(["dojo/_base/declare","davinci/js/JSModel"],function(p,m){var h=null,e=null;return p("davinci.js.JSElement",m,{constructor:function(){this.elementType=
"JSElement";null!==h&&(this.comment=h,h=null);null!==e&&(this.label=e,e=null)},printNewLine:function(b){for(var k="\n",a=0;a<b.indent;a++)k+=" ";return k},printStatement:function(b,k){return this.printNewLine(b)+k.getText(b)+(k.nosemicolon?"":";")},add:function(b){this.addChild(b)},init:function(b,k,a){},getLabel:function(){context={indent:0};return this.getText(context)},getID:function(){return this.parent.getID()+":"+this.startLine+":"+this.getLabel()},getSyntaxPositions:function(b){function k(a,
f,d,c){"undefined"!=typeof b&&b!=a||g.push({line:a,col:f,length:d,type:c})}function a(a,f,d){"undefined"!=typeof b&&b!=a[0]||g.push({line:a[0],col:a[1],length:f,type:d})}var g=[];this.visit({visit:function(b){"JSFunction"==b.elementType?(k(b.startLine,b.startCol,8,"keyword"),a(b.leftParenPos,1,"delimiter"),a(b.rightParenPos,1,"delimiter"),a(b.leftBracePos,1,"delimiter"),a(b.rightBracePos,1,"delimiter")):"JSVariableDeclaration"==b.elementType?k(b.startLine,b.startCol,3,"keyword"):"JSVariableFragment"==
b.elementType?b.equalPos?a(b.equalPos,1,"operator"):k(b.startLine,b.startCol,1,"name"):"JSNameReference"==b.elementType&&k(b.startLine,b.startCol,b.endCol-b.startCol,"name")},endVisit:function(a){return!0}});return g}})})},"davinci/js/JSModel":function(){define(["dojo/_base/declare","davinci/model/Model"],function(p,m){davinci.js||(davinci.js={});return p("davinci.js.JSModel",m,{})})},"davinci/html/CSSParser":function(){define("dojo/_base/declare davinci/html/CSSSelector davinci/html/CSSCombinedSelector davinci/html/CSSRule davinci/html/CSSProperty davinci/html/CSSAtRule davinci/html/CSSImport davinci/model/parser/Tokenizer davinci/model/Comment".split(" "),
function(p,m,h,e,b,k,a,g,n){var f=null,d=function(){function c(c,a,d){return function(b){return!c||/^\}/.test(b)?d:a?d+2*indentUnit:d+indentUnit}}var a=function(){function c(f,g){var n=f.next();if("@"==n)return f.nextWhileMatches(/[a-zA-Z0-9_-]/),"css-at";if("/"==n&&f.equals("*"))return g(a),null;if("\x3c"==n&&f.equals("!"))return g(d),null;if("\x3d"==n)return"css-compare";if(!f.equals("\x3d")||"~"!=n&&"|"!=n){if('"'==n||"'"==n)return g(b(n)),null;if("#"==n)return f.nextWhileMatches(/[\w-]/),"css-hash";
if("!"==n)return f.nextWhileMatches(/[ \t]/),f.nextWhileMatches(/\w/),"css-important";if(/\d/.test(n))return f.nextWhileMatches(/[\w.%]/),"css-unit";if(/[,.+>*\/]/.test(n))return"css-select-op";if(/[;{}:\[\]]/.test(n))return"css-punctuation";f.nextWhileMatches(/[\w\\\-_]/);return"css-identifier"}f.next();return"css-compare"}function a(d,b){for(var f=!1;!d.endOfLine();){var g=d.next();if(f&&"/"==g){b(c);break}f="*"==g}return"css-comment"}function d(a,b){for(var f=0;!a.endOfLine();){var g=a.next();
if(2<=f&&"\x3e"==g){b(c);break}f="-"==g?f+1:0}return"css-comment"}function b(a){return function(d,b){for(var f=!1;!d.endOfLine();){var g=d.next();if(g==a&&!f)break;f=!f&&"\\"==g}f||b(c);return"css-string"}}return function(a,d){return g.tokenizer(a,d||c)}}();return{make:function(d,b){b=b||0;var f=a(d),g=!1,n=!1,k=!1,e={next:function(){var a=f.next(),d=a.style,q=a.content;"css-hash"==d&&(d=a.style=n?"css-colorcode":"css-identifier");"css-identifier"==d&&(n?a.style="css-value":g||k||(a.style="css-selector"));
"\n"==q&&(a.indentation=c(g,n,b));"{"==q&&"@media"==k?k=!1:"{"==q?g=!0:"}"==q?g=n=k=!1:";"==q?n=k=!1:g&&"css-comment"!=d&&"whitespace"!=d?n=!0:g||"css-at"!=d||(k=q);return a},copy:function(){var c=g,d=n,b=f.state;return function(k){f=a(k,b);g=c;n=d;return e}}};return e},electricChars:"}"}}();d.parse=function(c,q){function u(c){E.push(c)}function r(){var c;v=w.next();for(var a=!1;"css-comment"==v.style||"whitespace"==v.style;){if("css-comment"==v.style||a)f||(f=new n),c=v.content,0===v.content.indexOf("/*")&&
(c=c.substring(2),a=!0,f.addComment("block",void 0,void 0,"")),-1<c.lastIndexOf("*/")&&c.lastIndexOf("*/")==c.length-2&&(c=c.substring(0,c.length-2),a=!1),f.appendComment(c);v=w.next()}return v}function z(){A=new m;A.startOffset=v.offset;A.parent=D;C?(C.selectors.push(A),A.parent=C):D.selectors.push(A)}function y(){var c=A;c.endOffset=v.offset-1;C||(C=new h,C.parent=D,C.selectors.push(c),A.startOffset=c.startOffset,D.selectors[D.selectors.length-1]=C);z();C.combiners.push(p);p=" "}var B,x;"string"==
typeof c?B=g.stringStream({next:function(){if(1==++this.count)return c;throw StopIteration;},count:0,text:c}):(B=c,x=!0);var w=d.make(B),v,A,C,p=" ",E=[],I=[],D,G;try{do switch(r(),v.style){case "css-selector":case "css-select-op":if(x&&"\x3c"==v.content)throw B.push("\x3c"),StopIteration;D=new e;I.push(D);D.startOffset=v.offset;q&&q.addChild(D,void 0,!0);G=!1;C=void 0;p=" ";z();a:for(;;){switch(v.style){case "css-select-op":switch(v.content){case ",":C=void 0;z();break;case ".":G&&y();r();A.cls=
A.cls?A.cls+"."+v.content:v.content;G=v.value.length>v.content.length;break;case "*":(A.element||A.cls)&&y();A.element="*";break;case "+":case "\x3e":p=v.content,y()}break;case "css-selector":"css-identifier"==v.type?((A.element||A.cls||G)&&y(),A.element=v.content):"css-hash"==v.type&&((A.id||G)&&y(),A.id=v.content.substring(1));G=v.value.length>v.content.length;break;case "css-punctuation":if("{"==v.content)break a;else":"==v.content?(r(),":"==v.content?(r(),A.pseudoElement=v.content):(A.pseudoRule=
v.content,G=!0)):"["==v.content&&(r(),A.attribute={name:v.content},r(),"\x3d"===v.content||"~\x3d"===v.content||"|\x3d"===v.content)&&(A.attribute.type=v.content,r(),A.attribute.value=v.content.substring(1,v.content.length-1),r())}r()}f&&(D.comment=f,f=null);for(A.endOffset=v.offset-1;"}"!=r().content;){var N=v.offset,M=v.content,K=!1;"css-hash"==v.type?(r(),"css-identifier"==v.type?M+=v.content:K=!0):"css-identifier"!=v.type&&("*"!=v.content?u("expecting identifier around "+A.getText()+"{ "+F.name+
": "+propery.value):(r(),M+=v.content));var F=new b;F.startOffset=N;F.parent=D;f&&(F.comment=f,f=null);D.properties.push(F);D.addChild(F,void 0,!0);F.name=M;K||":"!=r().content&&u("expecting ':' "+A.getText()+"{ "+F.name+": "+propery.value);r();F.value=v.value;if("url"==F.value){for(;")"!=r().content;)F.value+=v.value;F.value+=v.value}for(;";"!=r().content&&"}"!=v.content;)F.value+=v.value;f&&(F.postComment=f,f=null);F.endOffset=v.offset-1;if("}"==v.content)break}f&&(F.postComment=f,f=null);D.endOffset=
v.offset;break;case "css-at":var J=v.content.substring(1),H="import"==J?new a:new k;H.startOffset=v.offset;q&&q.addChild(H,void 0,!0);if("import"==J)K=H,r(),"url"==v.content&&(K.isURL=!0,r(),r()),K.url=v.content.substring(1,v.content.length-1),K.isURL&&r(),r();else if(0<=J.indexOf("keyframes")){var P=K="",R=!1,O="\t\t";r();K=v.content;"."==K&&(r(),K+=v.content);r();H.value=v.content+"\n";r();if(0<=v.content.indexOf("from")||0<=v.content.indexOf("to")||0<=v.content.indexOf("%"))a:for(;;){H.value+=
"\t"+v.content+" ";r();for(H.value+=v.content+"\n";"}"!=r().content;){R&&(O="\t\t",R=!1);if(";"==v.content)P="\n",R=!0;else if(":"==v.content||")"==v.content)P=" ";H.value+=O+v.content+P;O=P=""}H.value+="\t"+v.content+"\n";r();if("}"==v.content)break a}else u("inside keyframes decl expecting from/to blocks or nn% blocks");H.value+=v.content;H.name=J+" "+K}else for(H.name=J,H.value="";";"!=r().content;)H.value+=v.content;H.endOffset=v.offset}while(1)}catch(Q){f&&D&&(D.postComment=f,f=null)}return{errors:E,
model:I}};return d})},"davinci/html/CSSSelector":function(){define(["require","dojo/_base/declare","davinci/html/CSSElement"],function(p,m,h){m=m("davinci.html.CSSSelector",h,{constructor:function(){this.elementType="CSSSelector"},matchesSelector:function(e){if(e.elementType==this.elementType&&this.id==e.id&&this.cls==e.cls&&this.element==e.element&&this.pseudoRule==e.pseudoRule)return!0},getText:function(e){e="";this.element&&(e+=this.element);this.id&&(e=e+"#"+this.id);this.cls&&(e=e+"."+this.cls);
this.pseudoRule&&(e=e+":"+this.pseudoRule);this.pseudoElement&&(e=e+"::"+this.pseudoElement);this.attribute&&(e=e+"["+this.attribute.name,this.attribute.type&&(e=e+this.attribute.type+'"'+this.attribute.value+'"'),e+="]");return e},matches:function(e,b){var k=e[b||0],a=0,g=!1;if(this.id){if(this.id!=k.id)return-1;a+=100;g=!0}if(this.element){if("*"!=this.element){if(this.element!=k.tagName&&this.element.toUpperCase()!=k.tagName)return-1;a+=1}g=!0}if(this.cls&&k.classes){k=k.classes;if(0<=this.cls.indexOf(".")){for(var g=
this.cls.split("."),n=0;n<g.length;n++){for(var f=!1,d=0;d<k.length&&!(f=k[d]==g[n]);d++);if(!f)return-1}a+=10*g.length}else{f=!1;for(d=0;d<k.length&&!(f=k[d]==this.cls&&!this.pseudoRule);d++);if(!f)return-1;a+=10}g=!0}return g?a:-1},getCSSRule:function(){return"CSSRule"==this.parent.elementType?this.parent:this.parent.parent}});m.parseSelectors=function(e){if("string"==typeof e){e+="{}";var b=new (p("davinci/html/CSSFile"));b.setText(e);return b.children[0].selectors}return e};return m})},"davinci/html/CSSElement":function(){define(["dojo/_base/declare",
"davinci/model/Model"],function(p,m){return p("davinci.html.CSSElement",m,{constructor:function(){"undefined"!=typeof pushComment&&null!==pushComment&&(this.comment=pushComment,pushComment=null);this.elementType="CSSElement"},getLabel:function(){context={indent:0,noComments:!0};return this.getText(context)},onChange:function(h){if(this.parent)if(h)this.parent.onChange(h);else this.parent.onChange(this)},close:function(h){for(h=0;h<this.children;h++)this.children[h].close()},getCSSFile:function(){var h=
this.getCSSRule();if(h)return h.parent},getCSSRule:function(){},_convertNode:function(h){if(dojo.isArray(h))return h;for(var e=[];h&&"HTML"!=h.tagName;)e.push({tagName:h.tagName,id:h.id,classes:h.className&&h.className.split(" ")}),h=h.parentNode;return e},getID:function(){return this.parent.getID()+":"+this.startOffset+":"+this.getLabel()}})})},"davinci/html/CSSCombinedSelector":function(){define(["dojo/_base/declare","davinci/html/CSSElement"],function(p,m){return p("davinci.html.CSSCombinedSelector",
m,{constructor:function(){this.selectors=[];this.combiners=[];this.elementType="CSSCombinedSelector"},matchesSelector:function(h){if(h.elementType==this.elementType&&h.selectors.length==this.selectors.length){for(var e=0;e<this.selectors.length;e++)if(this.combiners[e]!=h.combiners[e]||!this.selectors[e].matchesSelector(h.selectors[e]))return!1;return!0}},getText:function(h){for(var e="",b=0;b<this.selectors.length-1;b++)e+=this.selectors[b].getText(h),e=" "!=this.combiners[b]?e+(" "+this.combiners[b]+
" "):e+this.combiners[b];return e+=this.selectors[this.selectors.length-1].getText(h)},matches:function(h){for(var e=this.selectors.length-1,b=0,k=0;k<h.length;k++){var a;if(0<=(a=this.selectors[e].matches(h,k))&&(b+=a,e--,0>e))return b;if(0==k&&0>a)return-1}},visit:function(h){if(!h.visit(this)){for(var e=0;e<this.children.length;e++)this.children[e].visit(h);for(e=0;e<this.selectors.length;e++)this.selectors[e].visit(h)}h.endVisit&&h.endVisit(this)},getCSSRule:function(){return this.parent}})})},
"davinci/html/CSSRule":function(){define(["dojo/_base/declare","davinci/html/CSSElement","davinci/html/CSSParser","davinci/html/CSSProperty"],function(p,m,h,e){return p("davinci.html.CSSRule",m,{constructor:function(){this.elementType="CSSRule";this.selectors=[];this.properties=[]},getText:function(b){var k="";b=b||[];this.comment&&!b.noComments&&(k+=this.comment.getText(b));for(var k=k+this.getSelectorText(b),k=k+" {",a=0;a<this.properties.length;a++)k=k+"\n    "+this.properties[a].getText(b);k+=
"\n}\n";this.postComment&&!b.noComments&&(k+=this.postComment.getText(b));return k},setText:function(b){require("davinci/html/CSSParser").parse(b,this);dojo.mixin(this,this.children[0]);this.startOffset=(this.parent?this.parent.endOffset:0)+1;this.setDirty(!0)},addProperty:function(b,k){var a=new e(b,k,this);this.properties.push(a);this.setDirty(!0);this.onChange()},insertProperty:function(b,k,a){var g;(g=this.getProperty(b))&&this.removeProperty(b);g=new e(b,k,this);this.properties.splice(a,0,g);
this.setDirty(!0);this.onChange()},getSelectorText:function(b){for(var k="",a=0;a<this.selectors.length;a++)0<a&&(k+=", "),k+=this.selectors[a].getText(b);return k},matches:function(b){b=this._convertNode(b);for(var k,a=0;a<this.selectors.length;a++)if(0<=(k=this.selectors[a].matches(b)))return k},visit:function(b){if(!b.visit(this)){for(var k=0;k<this.children.length;k++)this.children[k].visit(b);for(k=0;k<this.selectors.length;k++)this.selectors[k].visit(b)}b.endVisit&&b.endVisit(this)},hasSelector:function(b){for(var k=
0;k<this.selectors.length;k++)if(this.selectors[k].getLabel()==b)return!0;return!1},matchesSelectors:function(b){for(var k=0;k<b.length;k++)for(var a=0;a<this.selectors.length;a++)if(this.selectors[a].matchesSelector(b[k]))return!0;return!1},getCSSRule:function(){return this},getLabel:function(){return this.getSelectorText({})},getProperty:function(b){for(var k=0;k<this.properties.length;k++)if(b==this.properties[k].name)return this.properties[k]},hasProperty:function(b){for(var k=0;k<this.properties.length;k++)if(b==
this.properties[k].name)return!0},getProperties:function(b){for(var k=[],a=0;a<this.properties.length;a++)b&&b!=this.properties[a].name||k.push(this.properties[a]);return k},setProperty:function(b,k){var a=this.getProperty(b);k?a?a.value=k:(a=new e,a.name=b,a.value=k,this.properties.push(a),a.parent=this):this.removeProperty(b);this.setDirty(!0);this.onChange()},removeProperty:function(b){for(var k=0;k<this.properties.length;k++)b==this.properties[k].name&&this.properties.splice(k,1);this.setDirty(!0);
this.onChange()},removeAllProperties:function(){this.properties=[];this.setDirty(!0);this.onChange()},removeStyleValues:function(b){for(var k=[],a=0;a<this.properties.length;a++){for(var g,n=0;n<b.length&&!g;n++)g=b[n]==this.properties[a].name;g||(k=this.properties[a])}this.properties=k;this.setDirty(!0);this.onChange()}})})},"davinci/html/CSSProperty":function(){define(["dojo/_base/declare","davinci/html/CSSElement"],function(p,m){return p("davinci.html.CSSProperty",m,{constructor:function(h,e,b){this.elementType=
"CSSProperty";this.name=h||"";this.value=e||"";this.parent=b;this.expanded=[];this.lengthValues=[]},getValue:function(){return this.value},getText:function(h){var e="";this.comment&&!h.noComments&&(e+="\n  "+this.comment.getText(h));e+=this.name+" : "+this.value;this.isNotImportant&&(e+=" !important");e+=";";this.postComment&&!h.noComments&&(e+=this.postComment.getText(h));return e},getCSSRule:function(){return this.parent},addProperty:function(h,e){var b=new CSSProperty(h,e,this);this.properties.push(b)},
getURL:function(){if(this.url){var h=new davinci.model.Path(this.getCSSFile().url),h=h.getParentPath().append(this.url);return h.toString()}}})})},"davinci/html/CSSAtRule":function(){define(["dojo/_base/declare","davinci/html/CSSElement"],function(p,m){return p("davinci.html.CSSAtRule",m,{constructor:function(){this.elementType="CSSAtRule"},getCSSFile:function(){return this.parent},getText:function(h){s="@";return s=s+this.name+" "+this.value+"\n"}})})},"davinci/html/CSSImport":function(){define(["dojo/_base/declare",
"davinci/html/CSSElement","davinci/model/Path","davinci/html/CSSFile"],function(p,m,h,e){return p("davinci.html.CSSImport",m,{constructor:function(){this.elementType="CSSImport"},getCSSFile:function(){return this.parent},setUrl:function(b){this.url=b},visit:function(b){if(!b.visit(this)){for(var k=0;k<this.children.length;k++)this.children[k].visit(b);this.cssFile&&this.cssFile.visit(b)}b.endVisit&&b.endVisit(this)},getText:function(b){s="@import ";return s=this.isURL?s+('url("'+this.url+'");'):s+
('"'+this.url+'";')},close:function(b){require("davinci/model/Factory").closeModel(this.cssFile);this.connection&&dojo.disconnect(this.connection);delete this.connection},load:function(b){for(var k=this.parent;k&&!k.url&&!k.fileName;)k=k.parent;k=new h(k.url||k.fileName);k=k.getParentPath().append(this.url);k=k.toString();this.cssFile=require("davinci/model/Factory").getModel({url:k,loader:this.parent.loader,includeImports:this.parent.includeImports||b});this.cssFile.relativeURL=this.url;this.connection=
dojo.connect(this.cssFile,"onChange",this.parent,"onChange")}})})},"davinci/html/CSSFile":function(){define("dojo/_base/declare dojo/_base/lang davinci/html/CSSElement davinci/html/CSSRule davinci/html/CSSSelector system/resource davinci/Workbench".split(" "),function(p,m,h,e,b,k,a){return p("davinci.html.CSSFile",h,{constructor:function(a){this.elementType="CSSFile";m.mixin(this,a);this.options||(this.options={xmode:"style",css:!0,expandShorthand:!1});a=null;this.url&&this.loader?a=this.loader(this.url):
this.url&&"app.css"===this.url&&this.setText("BODY {background-color: red!important;}");a&&this.setText(a)},save:function(a){return k.findResourceAsync(this.url).then(function(b){return b.setContents(this.getText(),a)}.bind(this))},close:function(){this.visit({visit:function(a){"CSSImport"==a.elementType&&a.close()}});require(["dojo/_base/connect"],function(a){a.publish("davinci/model/closeModel",[this])})},addRule:function(a){var b=new e;b.setText(a);this.addChild(b);this.setDirty(!0);return b},
setText:function(a){var b=this.children;this.children=[];this.errors=require("davinci/html/CSSParser").parse(a,this).errors;0<this.errors.length&&this.errors[this.errors.length-1].isException&&(this.children=b);this.includeImports&&this.children.forEach(function(a){"CSSImport"==a.elementType&&a.load()});this.onChange()},getText:function(a){a=a||{};a.indent=0;return this.children.map(function(b){return b.getText(a)}).join("")},getCSSFile:function(){return this},getID:function(){return this.fileName},
getMatchingRules:function(a,b,f){a=this._convertNode(a);b=b||[];f=f||[];for(var d=0;d<this.children.length;d++){var c=this.children[d];if("CSSRule"==c.elementType){var q=c.matches(a);if(q){for(var k=!1,e=0;e<f.length;e++)if(q>=f[e]){b.splice(e,0,c);f.splice(e,0,q);k=!0;break}k||(b.splice(0,0,c),f.splice(0,0,q))}}else"CSSImport"==c.elementType&&c.cssFile&&c.cssFile.getMatchingRules(a,b,f)}return b},getRule:function(a){var n;if(!a)return[];a=b.parseSelectors(a);for(var f=0;f<this.children.length;f++){var d=
this.children[f];if("CSSRule"==d.elementType){if(d.matchesSelectors(a)){n=d;break}}else"CSSImport"==d.elementType&&d.cssFile&&(n=d.cssFile.getRule(a)||n)}return n},getRules:function(a){a=b.parseSelectors(a);for(var n=[],f=0;f<this.children.length;f++){var d=this.children[f];"CSSRule"==d.elementType?d.matchesSelectors(a)&&n.push(d):"CSSImport"==d.elementType&&d.cssFile&&(n=n.concat(d.cssFile.getRules(a)))}return n},getStyleValue:function(a,b){var f=[],d=[];b=this._convertNode(b);this.getMatchingRules(b,
f,d);"string"==typeof a&&(a=[a]);return a.map(function(c){for(var a=0,b,g,n=0;n<f.length;n++)(g=f[n].getProperty(c))&&d[n]>a&&(b=g,a=d[n]);return b})}})})},"davinci/model/Comment":function(){define(["dojo/_base/declare","davinci/model/Model"],function(p,m){return p("davinci.model.Comment",m,{constructor:function(){this.elementType="Comment";this.nosemicolon=!0},addComment:function(h,e,b,k){null==this.comments&&(this.comments=[]);this.comments[this.comments.length]={commentType:h,start:e,stop:b,s:k}},
appendComment:function(h){var e=this.comments[this.comments.length-1];e.s+=h;e.stop+=h.length},getText:function(h){h="";for(var e=0;e<this.comments.length;e++)"line"==this.comments[e].commentType?h+="//"+this.comments[e].s+"\n":"block"==this.comments[e].commentType&&(h+="/*"+this.comments[e].s+"*/\n");return h}})})},"davinci/model/Factory":function(){define(["../html/CSSFile","../js/JSFile","../html/HTMLFile","system/resource"],function(p,m,h,e){var b=[],k=[],a={getModel:function(g){var n=g.url;if(!n)return null;
for(var f=0;f<k.length;f++)if(k[f].url==n)return b[f]++,this.incrementImports(k[f]),k[f];if(/\.html?$/i.test(n)||/\.cfhtml?$/i.test(n))return a.newHTML(g);if(/\.css$/i.test(n))return a.newCSS(g);if(/\.js$/i.test(n))return a.newJS(g)},closeModel:function(a){a=a.url;if(!a)return null;for(var n=0;n<k.length;n++)k[n].url==a&&(b[n]--,0===b[n]&&(k.splice(n,1),b.splice(n,1)))},newHTML:function(a){a=new h(a.url);k.push(a);b[k.length-1]=1;return a},newCSS:function(a){a=new p(a);k.push(a);b[k.length-1]=1;return a},
newJS:function(a){a=new m(a);k.push(a);b[k.length-1]=1;return a},getNewFromResource:function(a){a=a.extension;if(!a)return new h;switch(a){case "html":return new h;case "css":return new p;case "js":case "json":return new m;default:return new h}},incrementImports:function(a){var n={visit:function(a){if("CSSImport"==a.elementType){a=a.cssFile.url;for(var d=0;d<k.length;d++)k[d].url==a&&b[d]++}return!1}};a&&a.visit(n)},log:function(){for(var a=0;a<k.length;a++);}};require(["dojo/_base/connect"],function(b){b.subscribe("davinci/model/closeModel",
a,a.closeModel)});return a})},"davinci/js/JSFile":function(){define(["dojo/_base/declare","davinci/js/JSElement"],function(p,m){return p("davinci.js.JSFile",m,{constructor:function(h){this.elementType="JSFile";this.nosemicolon=!0;this._textContent="";h&&(this.origin=h)},getText:function(h){return this._textContent},setText:function(h){this._textContent=h},getLabel:function(){return this.fileName},getID:function(){return this.fileName},visit:function(h){if(!h.visit(this))for(var e=0;e<this.children.length;e++)this.children[e].visit(h);
h.endVisit&&h.endVisit(this)}})})},"davinci/ui/widgets/ThemeSelection":function(){define("dojo/_base/declare dijit/_Widget davinci/library davinci/Runtime davinci/Workbench system/resource dojo/i18n!davinci/ui/nls/ui dojo/i18n!dijit/nls/common".split(" "),function(p,m,h,e,b,k,a,g){return p("davinci.ui.widgets.ThemeSelection",[m],{workspaceOnly:!0,message:"Theme version does not match workspace version this could produce unexpected results. We suggest recreating the custom theme using the current version of Maqetta and deleting the existing theme.",
buildRendering:function(){var a=dojo.doc.createElement("div");this._select=dojo.doc.createElement("select");a.appendChild(this._select);this._warnDiv=dojo.doc.createElement("div");a.appendChild(this._warnDiv);this.domNode=a;dojo.style(this._select,"width","180px");dojo.style(this.domNode,"width","100%");dojo.connect(this._select,"onchange",this,"_onChange")},postCreate:function(){this._themeData=h.getThemes(b.getProject(),this.workspaceOnly);this._themeCount=this._themeData.length;for(var a=0;a<this._themeData.length;a++){var f=
dojo.doc.createElement("option");f.value=this._themeData[a].name;f.text=this._themeData[a].name;this._select.appendChild(f)}this._selection&&this._selectValue(this._selection)},_setBaseAttr:function(a){this._base=a},_getBaseAttr:function(){return this._base},_getNumberOfThemesAttr:function(){return this._themeCount},_setValueAttr:function(a){this._hasValue(a)&&((this._selection=a)&&a.name&&(this._selection=a.name),this._selectValue(this._selection))},_hasValue:function(a){for(var b=0;b<this._select.children.length;b++)if(this._select.children[b].value==
a)return!0;return!1},_selectValue:function(a){for(var b=!1,d=0;d<this._select.children.length;d++)this._select.children[d].selected&&(this._select.children[d].selected=!1),b||this._select.children[d].value!=a||(b=this._select.children[d].selected=!0);b||null==a||(b=dojo.doc.createElement("option"),b.value=a,b.text=a,b.selected=!0,this._select.appendChild(b))},_getValueAttr:function(){for(var a=dojo.attr(this._select,"value"),b=0;b<this._themeData.length;b++)if(this._themeData[b].name==a)return this._themeData[b];
return null},_setWorkspaceOnlyAttr:function(a){this.workspaceOnly=a},onChange:function(){},_onChange:function(){var a=this._getValueAttr();if(null!=a&&!this._blockChange){this.value=a;this._cookieName="maqetta_"+a.name+"_"+a.version;var b=dojo.cookie(this._cookieName);if(this.dojoVersion&&a.version!==this.dojoVersion&&!b)this._warnDiv.innerHTML="\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e"+this.message+'\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd align\x3d"center"\x3e\x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"davinci.ui.widgets.ThemeSelection.ok"\x3eOk\x3c/button\x3e\x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"davinci.ui.widgets.ThemeSelection.cancel"\x3eCancel\x3c/button\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e',
a=dijit.byId("davinci.ui.widgets.ThemeSelection.ok"),b=dijit.byId("davinci.ui.widgets.ThemeSelection.cancel"),dojo.connect(a,"onClick",this,"_warnOk"),dojo.connect(b,"onClick",this,"_warnCancel");else this.onChange()}},_getThemeDataAttr:function(){return this._themeData},_warnOk:function(){dojo.cookie(this._cookieName,"true");this._destroy();this.onChange()},_warnCancel:function(){this._destroy();this.onClose()},_destroy:function(){var a=dijit.byId("davinci.ui.widgets.ThemeSelection.ok");dojo.disconnect(a);
a.destroy();a=dijit.byId("davinci.ui.widgets.ThemeSelection.cancel");dojo.disconnect(a);a.destroy()}})})},"davinci/ui/OpenThemeDialog":function(){define("dojo/_base/declare dijit/_Templated dijit/_Widget dojo/i18n!davinci/ui/nls/ui dojo/i18n!dijit/nls/common dojo/text!./templates/OpenThemeDialog.html davinci/ui/widgets/ThemeSelection".split(" "),function(p,m,h,e,b,k){return p("davinci.ui.OpenThemeDialog",[h,m],{templateString:k,widgetsInTemplate:!0,_themeChooser:null,startup:function(){this.inherited(arguments);
1>this._themeChooser.get("numberOfThemes")&&(alert(e.noUserThemes),setTimeout(dojo.hitch(this,function(){this.destroyRecursive();this.cancel=!0;this.onClose()},500)))},postMixInProperties:function(){dojo.mixin(this,e);dojo.mixin(this,b);this.inherited(arguments)},_checkValid:function(){var a=!0,b=this._themeChooser.attr("value");if(null==b||""==b)a=!1;this._okButton.set("disabled",!a)},okButton:function(){var a=this._themeChooser.attr("value");davinci.Workbench.openEditor({fileName:a.getFile(),content:a})},
cancelButton:function(){this.cancel=!0;this.onClose()}})})},"davinci/review/widgets/OpenReviewDialog":function(){define("dojo/_base/declare dijit/_Templated dijit/_Widget dijit/Tree davinci/review/view/CommentExplorerView davinci/review/model/ReviewTreeModel davinci/Workbench dojo/i18n!davinci/ui/nls/ui dojo/i18n!dijit/nls/common dojo/text!./templates/OpenReviewDialog.html dijit/form/Button dijit/layout/ContentPane".split(" "),function(p,m,h,e,b,k,a,g,n,f){return p("davinci.ui.widgets.OpenFile",[h,
m],{widgetsInTemplate:!0,templateString:f,fileDialogFileName:null,fileDialogParentFolder:null,postMixInProperties:function(){dojo.mixin(this,g);dojo.mixin(this,n);this.finishButtonLabel||(this.finishButtonLabel=g.open);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);var a=new k;this.model=a;a=this.tree=new e({id:"openReviewDialogTree",persist:!1,showRoot:!1,model:a,labelAttr:"name",childrenAttrs:"children",getIconClass:b.getIconClass,getLabelClass:b.getLabelClass,transforms:b.getSortTransforms()});
this.treeContentPane.set("content",a);a.watch("selectedItems",dojo.hitch(this,this._updateFields))},startup:function(){this.tree.startup()},_updateFields:function(){this.okButton.set("disabled",!0);this._selectedResource=null;var a=this.tree.get("selectedItems");a&&1==a.length&&(a=a[0],"ReviewFile"==a.elementType&&(this.okButton.set("disabled",!1),this._selectedResource=a))},_okButton:function(){if(this._selectedResource){var a=this._selectedResource;davinci.Workbench.openEditor({fileName:a,content:a.getText()});
this.cancel=!1}},_cancelButton:function(){this.onClose()},resize:function(a){this.treeContentPane.resize(a)},onClose:function(){}})})},"davinci/review/view/CommentExplorerView":function(){define("dojo/_base/declare davinci/Runtime davinci/review/model/ReviewTreeModel davinci/Workbench davinci/workbench/ViewPart dijit/Tree dojo/date/stamp dojo/date/locale davinci/review/actions/CloseVersionAction davinci/review/actions/EditVersionAction davinci/review/actions/OpenVersionAction dijit/Toolbar dijit/ToolbarSeparator dijit/form/Button dijit/form/TextBox dojo/i18n!./nls/view dojo/i18n!../widgets/nls/widgets davinci/ui/widgets/TransformTreeMixin".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y){var B=function(c,a){if("ReviewVersion"==c.elementType){if(c.isDraft)return"draft-open";if(c.closed)return a?"reviewFolder-open-disabled":"reviewFolder-closed-disabled";if(!c.closed)return a?"reviewFolder-open":"reviewFolder-closed"}if("ReviewFile"==c.elementType){if(c.parent.closed)return"disabledReviewFileIcon";var d,b=c.getExtension(),f=m.getExtension("davinci.fileType",function(c){return c.extension==b});f&&(d=f.iconClass);return d||"dijitLeaf"}return"dijitLeaf"};
getLabelClass=function(c,a){var d="dijitTreeLabel";"ReviewVersion"==c.elementType&&(d=c.designerId==m.userName?"reviewOwnedByUserLabel":"reviewOwnedByOtherLabel");return d};var x=function(){return[function(c){return c.sort(function(c,a){return c.timeStamp>a.timeStamp?-1:c.timeStamp<a.timeStamp?1:0})}]};p=p(b,{postCreate:function(){this.inherited(arguments);var c=new h;this.model=c;var a=x();a.push(function(c){return c.filter(this.commentingFilter.filterItem,this)}.bind(this));this.tree=new k({id:"reviewCommentExplorerViewTree",
persist:!1,showRoot:!1,model:c,labelAttr:"name",childrenAttrs:"children",getIconClass:dojo.hitch(this,this._getIconClass),getLabelClass:dojo.hitch(this,this._getLabelClass),transforms:a,isMultiSelect:!0});this.setContent(this.tree);this.attachToolbar();this.tree.startup();dojo.connect(this.tree,"onDblClick",dojo.hitch(this,this._dblClick));dojo.connect(this.tree,"onClick",dojo.hitch(this,this._click));dojo.connect(this.tree,"_onNodeMouseEnter",dojo.hitch(this,this._over));dojo.connect(this.tree,"_onNodeMouseLeave",
dojo.hitch(this,this._leave));dojo.connect(this.tree,"_setSelectedNodesAttr",function(){this._publishSelectionChanges()}.bind(this));this.subscribe("/davinci/review/selectionChanged","_updateActionBar");this.subscribe("/davinci/review/resourceChanged",function(c,a,d){d&&d.timeStamp&&davinci.review.model.resource.root.findVersion(d.timeStamp).then(function(c){c?this.tree.set("selectedItem",c):this.tree.set("selectedItems",[]);this._publishSelectionChanges();this.tree.rootNode.expand()}.bind(this))});
e.createPopup({partID:"davinci.review.reviewNavigator",context:this,domNode:this.tree.domNode,openCallback:function(c){(c=dijit.getEnclosingWidget(c.target))&&c.item&&this.tree.set("path",this._buildTreePath(c.item))}.bind(this)});(c=e.getActionSets("davinci.review.reviewNavigator").clonedActionSets)&&1==c.length&&dojo.forEach(c[0].actions,dojo.hitch(this,function(c){c.keyBinding&&(this.keyBindings||(this.keyBindings=[]),this.keyBindings.push({keyBinding:c.keyBinding,action:c}))}));dojo.connect(this.tree.domNode,
"onkeypress",this,"_onKeyPress");this.infoCardContent=dojo.cache("davinci","review/widgets/templates/InfoCard.html",'\x3cdiv class\x3d"detail_title"\x3e${detail_title}\x3c/div\x3e\n\x3cdiv\x3e\n\t\x3cdiv class\x3d"detail_div"\x3e\x3cspan\x3e${your_role}:\x3c/span\x3e\x3cspan class\x3d"detail_role"\x3e${detail_role}\x3c/span\x3e\x3cspan\x3e${due_by}:\x3c/span\x3e\x3cspan class\x3d"${detail_dueDate_class}"\x3e${detail_dueDate}\x3c/span\x3e\x3c/div\x3e\n\t\x3cdiv class\x3d"detail_div"\x3e\x3cspan\x3e${created_by}:\x3c/span\x3e\x3cspan class\x3d"detail_creator"\x3e${detail_creator}\x3c/div\x3e\n\t\x3cdiv class\x3d"detail_div"\x3e\x3cspan\x3e${creation_date}:\x3c/span\x3e\x3cspan class\x3d"detail_creationDate"\x3e${detail_creationDate}\x3c/div\x3e\n\x3c/div\x3e\n\x3cdiv class\x3d"detail_div"\x3e\x3cstrong\x3e${artifacts_in_rev}\x3c/strong\x3e\x3c/div\x3e\n${detail_files}\n\x3cdiv class\x3d"detail_div"\x3e\x3cstrong\x3e${reviewers}\x3c/strong\x3e\x3c/div\x3e\n${detail_reviewers}');
dijit._masterTT||(dijit._masterTT=new dijit._MasterTooltip);this.connect(dijit._masterTT.domNode,"mouseover",function(){this._deleteDelTimer()});this.connect(dijit._masterTT.domNode,"mouseleave",function(){this._lastAnchorNode&&this._leave()});dojo.subscribe("/davinci/ui/editorSelected",function(c){if((c=c.editor)&&"davinci.review.CommentReviewEditor"===c.editorID){c=c.resourceFile;var a=c.parent;dojo.forEach(this.model.root.children,function(c){c!=a&&(c=this.tree.getNodesByItem(c),0<c.length&&(c=
c[0],c.isExpanded&&this.tree._collapseNode(c)))}.bind(this));this.tree.set("path",this._buildTreePath(c))}}.bind(this))},_buildTreePath:function(c){for(var a=[];c;c=c.parent)a.unshift(c);return a},_updateActionBar:function(c,a){if(a==this&&c&&c.length){var d="ReviewFile"==c[0].resource.elementType?c[0].resource.parent:c[0].resource;m.reviewers=d.reviewers||[];var b=d.designerId==m.userName,f="ReviewVersion"==d.elementType,g=d.isDraft;this.closeBtn.set("disabled",!b||!f||d.closed||g);this.openBtn.set("disabled",
!b||!f||!d.closedManual||g);this.editBtn.set("disabled",!b||!f)}else this.closeBtn.set("disabled",!0),this.editBtn.set("disabled",!0)},getTopAdditions:function(){var a=new c({},dojo.create("div")),d=new u({id:a.get("id")+".Close",showLabel:!1,label:z.closeVersion,disabled:!0,iconClass:"viewActionIcon closeVersionIcon",onClick:dojo.hitch(this,"_closeVersion")});this.closeBtn=d;var b=new u({id:a.get("id")+".Open",showLabel:!1,label:z.openVersion,disabled:!0,iconClass:"viewActionIcon openVersionIcon",
onClick:dojo.hitch(this,"_openVersion")});this.openBtn=b;var f=new u({id:a.get("id")+".Edit",showLabel:!1,label:z.editVersion,disabled:!0,iconClass:"viewActionIcon editVersionIcon",onClick:dojo.hitch(this,"_editVersion")});this.editBtn=f;var g=new r({id:"reviewExplorerFilter",placeHolder:z.filter,onKeyUp:dojo.hitch(this,this._filter)});a.addChild(d);a.addChild(b);a.addChild(new dijit.ToolbarSeparator);a.addChild(f);dojo.place(dojo.create("br"),a.domNode);a.addChild(g);dojo.addClass(a.domNode,"davinciCommentExplorer");
return a.domNode},_closeVersion:function(){(new n).run(this)},_openVersion:function(){(new d).run(this)},_editVersion:function(){(new f).run(this)},_filter:function(c){c=dijit.byId("reviewExplorerFilter").get("value");this.commentingFilter.filterString=c;dojo.forEach(this.model.root.children,dojo.hitch(this,function(c){c.getChildren(function(a){this.model.onChildrenChange(c,a)}.bind(this))}))},commentingFilter:{filterString:"",filterItem:function(c){var a=this.commentingFilter.filterString;return a?
"ReviewFile"==c.elementType?0<=c.name.toLowerCase().indexOf(a.toLowerCase()):!0:!0}},destroy:function(){this.inherited(arguments)},_dblClick:function(c){c.isDraft||c.parent.isDraft?c.designerId!=m.userName&&c.parent.designerId!=m.userName||this._openPublishWizard(c.isDraft?c:c.parent):"ReviewFile"==c.elementType&&e.openEditor({fileName:c,content:c.getText()})},_click:function(c){this._publishSelectionChanges()},_publishSelectionChanges:function(){var c=this.getSelection();this.publish("/davinci/review/selectionChanged",
[c,this])},getSelection:function(){return dojo.map(this.tree.get("selectedItems"),function(c){return{resource:c}})},_over:function(c){if("ReviewVersion"==c.item.elementType&&!this._showTimer){var d=c.item,b={};b.detail_title=d.name;b.your_role=y.yourRole;b.due_by=y.dueBy;b.created_by=y.createdBy;b.creation_date=y.creationDate;b.artifacts_in_rev=y.artifactsInRev;b.reviewers=y.reviewers;b.detail_role=d.designerId==m.userName?z.designer:z.reviewer;b.detail_dueDate="infinite"==d.dueDate?z.infinite:g.format(d.dueDate,
{selector:"date",formatLength:"long"});var f=m.getUserDisplayNamePlusEmail({email:d.designerEmail,userDisplayName:d.designerDisplayName,userId:d.designerId});b.detail_creator=f;f=d.timeStamp.match(/^(\d{4})(\d{2})(\d{2})\T(\d{2})(\d{2})(\d{2})\Z$/);f=a.fromISOString(f?dojo.replace("{1}-{2}-{3}T{4}:{5}:{6}Z",f):d.timeStamp);b.detail_creationDate=g.format(f,{formatLength:"medium"});b.detail_files="";d.getChildren(function(a){dojo.forEach(a,function(c){c=c.getLabel();b.detail_files+="\x3cdiv\x3e\x3cspan\x3e"+
c.substr(0,c.length-4)+"\x3c/span\x3e\x3cspan class\x3d'dijitTreeIcon reviewFileIcon detail_file'\x3e\x3c/span\x3e\x3c/div\x3e"});b.detail_reviewers="";dojo.forEach(d.reviewers,function(c){if(c.email!=d.designerEmail){var a="\x3cdiv\x3e"+c.email+"\x3c/div\x3e";""!=c.displayName&&c.email!=c.displayName&&(a="\x3cdiv\x3e"+c.displayName+" \x26lt;"+c.email+"\x26gt;\x3c/div\x3e");b.detail_reviewers+=a}});d.closed?b.detail_dueDate_class="closed":b.detail_dueDate_class="notClosed";this._showTimer=setTimeout(dojo.hitch(this,
function(){this._deleteDelTimer();dijit.showTooltip(dojo.string.substitute(this.infoCardContent,b),c.rowNode);this._lastAnchorNode=c;delete this._showTimer;this._createDelTimer(15E3)}),1E3)}.bind(this))}},_leave:function(c){this._deleteDelTimer();this._showTimer&&(clearTimeout(this._showTimer),delete this._showTimer);this._lastAnchorNode&&this._createDelTimer(1E3)},_createDelTimer:function(c){this._delTimer=setTimeout(dojo.hitch(this,function(){this._hideTooltip();delete this._delTimer}),c)},_deleteDelTimer:function(){this._delTimer&&
(clearTimeout(this._delTimer),delete this._delTimer)},_hideTooltip:function(){this._lastAnchorNode&&(dijit.hideTooltip(this._lastAnchorNode.rowNode),this._lastAnchorNode=null)},_openPublishWizard:function(c){(new davinci.review.actions.PublishAction(c)).run()},_getIconClass:function(c,a){return B(c,a)},_getLabelClass:function(c,a){return getLabelClass(c,a)},_onKeyPress:function(c){var a=dojo.some(this.keyBindings,dojo.hitch(this,function(a){if(m.isKeyEqualToEvent(a.keyBinding,c))return davinci.Workbench._runAction(a.action,
this,a.action.id),!0}));a&&dojo.stopEvent(c);return a}});p.getIconClass=B;p.getLabelClass=getLabelClass;p.getSortTransforms=x;return p})},"davinci/review/model/ReviewTreeModel":function(){define(["dojo/_base/declare","davinci/Runtime","davinci/model/Path","davinci/review/model/Resource"],function(p,m,h,e){return p("davinci.review.model.ReviewTreeModel",null,{foldersOnly:!1,constructor:function(b){this.root=e.getRoot();this.subscription=[dojo.subscribe("/davinci/review/resourceChanged",this,this.resourceChanged)]},
destroy:function(){this.subscriptions.forEach(dojo.unsubscribe)},getRoot:function(b){b(this.root)},mayHaveChildren:function(b){return"ReviewVersion"==b.elementType&&!b.isDraft},getChildren:function(b,k,a){b.getChildren(k,a)},getIdentity:function(b){return b.getPath()},resourceChanged:function(b,k,a){a&&(a._isLoaded&&a.getChildren(function(a){a.forEach(this.onDelete,this)}.bind(this),!0),this.onDelete(a));var g=this.root;g._isLoaded=!1;g.getChildren(function(a){this.onChildrenChange(g,a)}.bind(this))},
getLabel:function(b){var k=b.getName();"ReviewVersion"==b.elementType&&b.isDraft&&(k+=" (Draft)");"ReviewFile"==b.elementType&&(b=(new h(k)).getSegments(),k="."+m.getExtension("davinci.editor",function(a){return"davinci.review.CommentReviewEditor"===a.id}).extensions,k=b[b.length-1]+k);return k},newItem:function(b,k){},pasteItem:function(b,k,a,g){},onChange:function(b){},onDelete:function(b){},onChildrenChange:function(b,k){}})})},"davinci/review/model/Resource":function(){define(["dojo/_base/declare",
"davinci/review/model/resource/root"],function(p,m){var h=null;return{getRoot:function(){h||(h=m);return h}}})},"davinci/review/model/resource/root":function(){define(["dojo/_base/declare","davinci/model/resource/Resource","davinci/review/model/resource/Folder","davinci/Runtime","dojo/Deferred"],function(p,m,h,e,b){p=p(m,{constructor:function(b){this.elementType="ReviewRoot";this.name="root";this.parent=null},findFile:function(k,a){var g=new b;this.getChildren(function(b){var f=null;dojo.forEach(b,
function(c){c.timeStamp==k&&(f=c)});var d=null;null!=f&&f.getChildren(function(c){dojo.forEach(c,function(c){this._fileNamesEqual(c.name,a)&&(d=c)}.bind(this));g.resolve(d)}.bind(this))}.bind(this));return g},_fileNamesEqual:function(b,a){0!=b.indexOf("./")&&(b="./"+b);0!=a.indexOf("./")&&(a="./"+a);return b===a},findVersion:function(k,a){var g=new b;this.getChildren(function(b){var f=null;dojo.some(b,function(d){return d.designerId==k&&d.timeStamp==a?(f=d,!0):!1});g.resolve(f)});return g},getChildren:function(b,
a){this._isLoaded?b(this.children):this._loading?this._loading.push(b):(this._loading=[],this._loading.push(b),e.serverJSONRequest({url:"cmd/listVersions",load:dojo.hitch(this,function(a,b){this.children=[];for(var f=0;f<a.length;f++){var d=new h(dojo.mixin({name:a[f].versionTitle,parent:this},a[f]));this.children.push(d)}this._isLoaded=!0;dojo.forEach(this._loading,function(c){c(this.children)},this);delete this._loading})}))},getPath:function(){return".review/snapshot"}});return dojo.setObject("davinci.review.model.resource.root",
new p)})},"davinci/model/resource/Resource":function(){define("dojo/_base/declare dojo/_base/xhr dojo/_base/connect dojo/Deferred davinci/Runtime davinci/model/Model davinci/model/Path xide/manager/ServerActionBase".split(" "),function(p,m,h,e,b,k,a,g){return p("davinci.model.resource.Resource",[k,g],{singleton:!0,sync:!1,workspaceMount:"/ws/",_initService:function(){var a=this.findServiceUrl(this.declaredClass);a&&(this.serviceUrl=a);this.inherited(arguments)},constructor:function(){this.elementType=
"Resource";this.name="";this.parent=null;this._id=dijit.getUniqueId("maqFileResource");this.init()},getName:function(){return this.name},getPath:function(){return this.parent?this.parent.getPath()+"/"+this.name:this.name},readOnly:function(){return this.hasOwnProperty("_readOnly")?this._readOnly||null!=this.parent&&this.parent.readOnly():this.parent?this.parent.readOnly():!1},getURL:function(){var a=this.getPath();0==a.indexOf("./")&&(a=a.substring(2,a.length));return b.getUserWorkspaceUrl()+a},rename:function(b){var f=
(new a(this.getPath())).removeLastSegments().append(b);return m.get({url:"cmd/rename",handleAs:"text",content:{oldName:this.getPath(),newName:f.toString()}}).then(function(){this.name=b;h.publish("/davinci/resource/resourceChanged",["renamed",this])}.bind(this))},getParentFolder:function(){return"File"==this.elementType?this.parent:this},isVirtual:function(){return!!this.libraryId},visit:function(a,b){var d=a.visit(this);this._isLoaded||"Folder"!=this.elementType||b?this.children&&!d&&dojo.forEach(this.children,
function(c){c.visit(a,b)}):this.getChildren(dojo.hitch(this,function(){dojo.forEach(this.children,function(c){c.visit(a,b)})}))},deleteResource:function(a){var b=""+this.getPath();"."==b&&(b=""+this.workspaceMount);var b=b.replace("./",this.workspaceMount),d=this.serviceClass,c="Folder"==this.elementType?"deleteDirectory":"deleteFile",g=function(){var c=this.getName();this.parent.children.some(function(a,d,b){if(a.getName()==c)return b.splice(d,1),!0});h.publish("/davinci/resource/resourceChanged",
["deleted",this])}.bind(this);a?(a=new e,g(),a.resolve()):a=this.serviceObject[d][c](b).then(g,function(){});return a},getId:function(){return this._id}})})},"davinci/review/model/resource/Folder":function(){define(["dojo/_base/declare","davinci/model/resource/Resource","davinci/review/model/resource/File","dojo/_base/xhr","dojo/date/stamp"],function(p,m,h,e,b){return p("davinci.review.model.resource.Folder",m,{isDraft:!1,closed:!1,width:0,height:0,constructor:function(k){dojo.mixin(this,k);this.elementType=
"ReviewVersion";this.dueDate="infinite"==this.dueDate?this.dueDate:b.fromISOString(this.dueDate)},getChildrenSync:function(b,a){this.getChildren(b)},getChildren:function(b,a){this._isLoaded?b.call(null,this.children):this._loading?this._loading.then(function(){b.call(null,this.children)}.bind(this),a):this._loading=e.get({url:"cmd/listReviewFiles",handleAs:"json",content:{designer:this.designerId||"",version:this.timeStamp}}).then(function(a,n){this.children=a.map(function(a){return new h(a.path,
this)},this);this._isLoaded=!0;b.call(null,this.children);delete this._loading}.bind(this),a)},getPath:function(){return this.parent?this.parent.getPath()+"/"+this.timeStamp:this.timeStamp}})})},"davinci/review/model/resource/File":function(){define(["dojo/_base/declare","davinci/Runtime","davinci/model/resource/File","davinci/model/Path","dojo/Deferred"],function(p,m,h,e,b){return p("davinci.review.model.resource.File",h,{constructor:function(b,a){this.elementType="ReviewFile";this.name=b;this.parent=
a;this.extension="rev"},getLabel:function(){var b=(new e(this.name)).getSegments(),a="."+m.getExtension("davinci.editor",function(a){return"davinci.review.CommentReviewEditor"===a.id}).extensions;return label=b[b.length-1]+a},getContentSync:function(){return""},getContent:function(){return(new b).resolve("")},removeWorkingCopy:function(){}})})},"davinci/model/resource/File":function(){define("dojo/_base/declare dojo/_base/xhr davinci/Runtime davinci/model/resource/Resource davinci/model/resource/Marker davinci/ve/utils/URLRewrite xide/utils".split(" "),
function(p,m,h,e,b,k,a){return p("davinci.model.resource.File",e,{serviceClass:"XIDE_Directory_Service",mount:"/ws/",getMountPoint:function(){return this.mount},constructor:function(a,b){this.elementType="File";this.name=a;this.parent=b;this.markers=[];this.extension=a.substr(a.lastIndexOf(".")+1)},getExtension:function(){return this.extension},clearMarkers:function(){this.markers=[]},addMarker:function(a,n,f){this.markers.push(new b(this,a,n,f))},getMarkers:function(a){var b=[];if(this.markers)for(var f=
0;f<this.markers.length;f++){var d=this.markers[f];a?"string"==typeof a?d.type==a&&b.push(d):dojo.forEach(a,function(c){c==d.type&&b.push(d)}):b.push(d)}return b},setContents:function(a,b){this.isNew&&!b&&(this.isNew=!1);var f=(b=!1,""),d=encodeURI(this.getPath()+f);return this.serviceObject[this.serviceClass].set(this.getMountPoint(),d,a).then(function(c){this.dirtyResource=b;dojo.publish("/davinci/resource/resourceChanged",["modified",this]);return this}.bind(this),function(c){console.error("An error occurred: davinci.model.resource.File.prototype.setContents "+
c+" : "+d);return c})},getContentSync:function(){return h.serverJSONRequest({url:k.encodeURI(this.getURL()),handleAs:"text",sync:!0})},getContent:function(){return this.serviceObject[this.serviceClass].get(a.buildPath(this.getMountPoint(),encodeURI(this.getPath())),!1,!1)},removeWorkingCopy:function(){h.serverJSONRequest({url:h.cmdOffset+"cmd/removeWorkingCopy",handleAs:"text",content:{path:this.getPath()},sync:!0});this.isNew&&this.deleteResource(!0)}})})},"davinci/model/resource/Marker":function(){define(["dojo/_base/declare",
"davinci/model/resource/Resource"],function(p,m){return p("davinci.model.resource.Marker",m,{constructor:function(h,e,b,k){this.resource=h;this.type=e;this.line=b;this.text=k}})})},"davinci/ve/utils/URLRewrite":function(){define([],function(){var p=/^\s*url\s*\(\s*(\'[^\'\"]*\'|\"[^\'\"]*\"|[^\'\"]*)\s*\)\s*$/,m=/^[\'\"]?([^\'\"]*)[\'\"]?$/,h=/^(http|ftp)/;return{isAbsolute:function(e){return"string"!=typeof e?!1:(e=this.getUrl(e))?h.test(e):!1},containsUrl:function(e){return"string"!=typeof e?!1:
p.test(e)},replaceUrl:function(e,b){return"string"!=typeof e||"string"!=typeof b?null:this.getUrl(e)?"url('"+b+"')":null},stripQuotes:function(e){return e.replace(m,"$1")},encodeURI:function(e){return encodeURI(e).replace(/#/g,"%23")},getUrl:function(e){return"string"!=typeof e?null:(e=e.match(p))&&1<e.length?this.stripQuotes(e[1]):null}}})},"davinci/workbench/ViewPart":function(){define(["dojo/_base/declare","./_ToolbaredContainer","../ve/States","../Runtime"],function(p,m,h,e){return p("davinci.workbench.ViewPart",
m,{constructor:function(b,k){this.viewExt=b.view;this.subscriptions=[];this.publishing={}},startup:function(){this.inherited(arguments);this.domNode.view=this;this.viewExt.startup&&this.viewExt.startup()},subscribe:function(b,k){this.subscriptions.push(dojo.subscribe(b,this,k))},publish:function(b,k){this.publishing[b]=!0;try{dojo.publish(b,k)}catch(a){console.error(a)}delete this.publishing[b]},destroy:function(){dojo.forEach(this.subscriptions,dojo.unsubscribe);delete this.subscriptions},_getViewActions:function(){var b=
this.toolbarID||this.viewExt.id,k=[];e.getExtensions("davinci.viewActions",function(a){if(b==a.viewContribution.targetID)return k.push(a.viewContribution),!0});return k}})})},"davinci/workbench/_ToolbaredContainer":function(){define(["dojo/_base/declare","dijit/layout/_LayoutWidget","dijit/_Templated"],function(p,m,h){return p("davinci.workbench._ToolbaredContainer",[m,h],{templateString:"\x3cdiv\x3e\x3cdiv dojoAttachPoint\x3d'titleBarDiv' class\x3d'palette_titleBarDiv'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'toolbarDiv' class\x3d'toolbaredContainer_toolbarDiv'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'containerNode'\x3e\x3c/div\x3e\x3c/div\x3e",
gutters:!1,_toolbarCreated:{},layout:function(){var e=[{domNode:this.titleBarDiv,layoutAlign:"top"},{domNode:this.toolbarDiv,layoutAlign:"top"},{domNode:this.containerNode,layoutAlign:"client"}];dijit.layout.layoutChildren(this.domNode,this._contentBox,e);this._containerContentBox=dijit.layout.marginBox2contentBox(this.containerNode,e[2]);var b=dijit.byNode(this.containerNode);b&&b.resize&&b.resize(this._containerContentBox);dojo.marginBox(this.containerNode,e[2])},setContent:function(e){this.mainWidget=
e;e=e.domNode||e;dojo.place(e,this.containerNode,"replace");this.containerNode=e;this.toolbarCreated(this.declaredClass)||this._createToolbar(this.declaredClass);this.titleBarDiv.innerHTML='\x3cspan class\x3d"paletteCloseBox"\x3e\x3c/span\x3e\x3cspan class\x3d"titleBarDivTitle"\x3e'+this.title+"\x3c/span\x3e";e=dojo.query(".paletteCloseBox",this.titleBarDiv);0<e.length&&dojo.connect(e[0],"click",this,function(b){davinci.Workbench.collapsePaletteContainer(b.currentTarget)});this._started&&this.layout()},
removeContent:function(){var e=dojo.doc.createElement("div");dojo.place(e,this.containerNode,"replace");this.containerNode=e;this.mainWidget&&this.mainWidget.destroy();delete this.mainWidget},_getViewActions:function(){},getTopAdditions:function(){},_createToolbar:function(e){var b=require("davinci/Workbench"),k=this.getToolbarDiv(),a=this.getTopAdditions();a&&k.appendChild(a);this.toolbarMenuActionSets&&(a="m"+Date.now(),k=dojo.create("span",{id:a+"_menucontainer","class":"paletteDropdown"},k),k=
dojo.create("span",{id:a+"_menu"},k),b.updateMenubar(k,this.toolbarMenuActionSets));(k=this._getViewActions())&&k.length&&(a=dojo.create("div",{"class":"toolbaredContainer_toolbarDiv"}),a=dojo.create("span",{style:{display:"inline-block"}},a),b=b._createToolBar("toolbarPath",a,k,this._getViewContext()),dojo.style(b.domNode,{display:"inline-block","float":"left"}),this.toolbarCreated(e,b))},_getViewContext:function(){return this},getToolbarDiv:function(){return this.toolbarDiv},toolbarCreated:function(e,
b){1<arguments.length&&(this._toolbarCreated[e]=b);return this._toolbarCreated[e]},attachToolbar:function(){var e=this.toolbarCreated(this.declaredClass),b=this.getToolbarDiv();e&&e.domNode&&b&&(b.innerHTML="",b.appendChild(e.domNode))}})})},"davinci/ve/States":function(){"undefined"===typeof davinci&&(davinci={});davinci.AppStatesDontInitialize=!0;define("dojo/_base/declare dojo/_base/connect dojo/query dojo/dom-class dojo/dom-style dojo/_base/window dijit/registry davinci/Runtime davinci/Workbench davinci/maqetta/AppStates ./utils/GeomUtils ./commands/EventCommand ./commands/StyleCommand davinci/ve/utils/StyleArray davinci/workbench/Preferences dojo/i18n!davinci/ve/nls/ve".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z){var y=document;p=p(f,{_update:function(c,a){g.currentEditor&&"davinci.ve.PageEditor"==g.currentEditor.declaredClass&&c&&c._dvWidget&&(c._maqAppStates||!c._maqDeltas)&&this._refresh(c._dvWidget)},_refresh:function(c){var a=c.getParent();a.dijitWidget?this._refresh(a):c&&c.resize&&c.resize()},_updateEvents:function(a,d,b){if(a&&a._dvWidget){a=a._dvWidget;var f=["onclick","onmouseover","onmouseout","onfocus","onblur"],g,n;for(n in f){var q=f[n],k=a&&a.properties&&
a.properties[q];if("string"==typeof k&&0<=k.indexOf("davinci.states.setState")){var e=k,k=k.replace("'"+d+"'","'"+b+"'");k!==e&&(g=g||{},g[q]=k)}}if(d=this.getContext())g=new c(a,g),d.getCommandStack().execute(g)}},normalize:function(c,a,d,b){switch(c){case "style":var f=this.getStatesListCurrent(a);for(c=0;c<f.length;c++)f[c]="Normal";if(a=this.getStyle(a,f,d))for(c=0;c<a.length;c++)a[c][d]&&(b=a[c][d])}return b},normalizeArray:function(c,a,d,b){b=dojo.clone(b);switch(c){case "style":var f=this.getStatesListCurrent(a);
for(c=0;c<f.length;c++)f[c]="Normal";if(a=this.getStyle(a,f,d)){for(c=0;c<a.length;c++){d=a[c];for(var g in d)for(d=b.length-1;0<=d;d--){var f=b[d],n;for(n in f)if(n==g){b.splice(d,1);break}}}b=b.concat(a)}}return b},getEditor:function(){return g.currentEditor},getContext:function(){var c=this.getEditor();return c&&(c.getContext&&c.getContext()||c.context)},getDocument:function(){var c=this.getContext();return c&&c.getDocument&&c.getDocument()},resetState:function(c){if(c){var a=this.getStateContainersForNode(c);
c=this.getFocus(c.ownerDocument.body);for(var d=0;d<a.length;d++){var b=a[d],f=this.getState(b);this.setState(f,b,{focus:c&&b==c.stateContainerNode&&f==c.state,updateWhenCurrent:!0,silent:!1})}}},_updateSrcState:function(c,a){var d=c&&c._dvWidget;if(d){var b=d._srcElement.getAttribute(davinci.states.APPSTATES_ATTRIBUTE),f=d._srcElement.getAttribute(davinci.states.DELTAS_ATTRIBUTE);if(d&&d._srcElement){var g=this.serialize(c);g.maqAppStates&&g.maqAppStates.trim();g.maqAppStates?d._srcElement.addAttribute(davinci.states.APPSTATES_ATTRIBUTE,
g.maqAppStates):d._srcElement.removeAttribute(davinci.states.APPSTATES_ATTRIBUTE);g.maqDeltas&&g.maqDeltas.trim();g.maqDeltas?d._srcElement.addAttribute(davinci.states.DELTAS_ATTRIBUTE,g.maqDeltas):d._srcElement.removeAttribute(davinci.states.DELTAS_ATTRIBUTE);g=d._srcElement.getAttribute(davinci.states.APPSTATES_ATTRIBUTE);d=d._srcElement.getAttribute(davinci.states.DELTAS_ATTRIBUTE);(b!==g||f!==d)&&(b=this.getEditor())&&b._visualChanged&&b._visualChanged(a)}}},_removeStateFromNodeRecursive:function(c,
a){var d=c._dvWidget;if(c&&d&&a){this._removeStateFromNode(c,a);for(var d=d.getChildren(),b=0;b<d.length;b++)this._removeStateFromNodeRecursive(d[b].domNode,a)}},_removeStateFromNode:function(c,a){if(c&&c._maqDeltas&&c._maqDeltas[a]){delete c._maqDeltas[a];var d=!1,b;for(b in c._maqDeltas)if("undefined"!==b){d=!0;break}d||delete c._maqDeltas;this._updateSrcState(c)}},removeUnusedStates:function(c){if(c){c=c.getAllWidgets();for(var a=0;a<c.length;a++){var d=c[a].domNode;if("BODY"!==d.tagName&&d&&d._maqDeltas){var b=
this.getAllStatesForNode(d),f;for(f in d._maqDeltas)"undefined"!==f&&0>b.indexOf(f)&&this._removeStateFromNode(d,f)}}}},_getStateIndex:function(c){return c&&"Normal"!=c&&"undefined"!=c?c:"undefined"},getCurrentStateIndex:function(){return this._getStateIndex(this.getState())},getApplyToStateIndex:function(c){var a=this.getState();return this._getStateIndex("current"===c&&a&&"Normal"!=a&&"undefined"!=a?a:void 0)},getEffectiveDisplayValue:function(c,a,d,f){c=a?a.domNode:null;a="none";var g=d||"undefined";
if(f&&"string"==typeof f[g]&&"$MAQ_DELETE_PROPERTY$"!=f[g])a=f[g];else if(c){var n=!1;if(c._maqDeltas&&(!f||"$MAQ_DELETE_PROPERTY$"!=f[g])){var q=c._maqDeltas[d]&&c._maqDeltas[d].style;if(q)for(d=0;d<q.length;d++){var k=q[d],e;for(e in k)"display"==e&&(a=k[e],n=!0)}}if(!n){if(f&&"string"==typeof f.undefined)a=f.undefined;else{f=c._maqDeltas&&c._maqDeltas.undefined&&c._maqDeltas.undefined.style;g=!1;if(f)for(d=0;d<f.length;d++)for(e in k=f[d],k)"display"==e&&(a=k[e],g=!0);g||(a=b.get(c,"display"))}g=
"undefined"}if(0==c.offsetLeft&&0==c.offsetTop&&0==c.offsetWidth&&0==c.offsetHeight)a="none";else for(;c&&"BODY"!=c.tagName.toUpperCase();){if(c&&c.ownerDocument&&c.ownerDocument.defaultView&&"none"==b.get(c,"display")){a="none";break}c=c.parentNode}}else a="none";return{effectiveDisplayValue:a,effectiveState:g}},propertyDefinedForAnyCurrentState:function(c,a){var d,b=c._maqDeltas;if(b){var f=this.getStateContainersForNode(c),g=f.length-1;a:for(;0<=g;g--){var n=this.getState(f[g]),q=n&&n!=this.NORMAL?
n:"undefined";if(q=b[q]&&b[q].style)for(var k=0;k<q.length;k++)for(var e=q[k],h=0;h<a.length;h++)if(e.hasOwnProperty(a[h])){d=n;break a}}}return d},_customStateActive:function(c){return c?this.getState(c.rootNode):!1},updateStateIcons:function(c){c&&c.editor&&c.editor==g.currentEditor&&"davinci.ve.PageEditor"==c.editor.declaredClass&&k.withDoc(y,function(){var d=h(".manageStatesButton")[0],b=a.byNode(d),d=h(".manageStatesIcon")[0];b&&d&&(this.manageStatesActive(c)?(e.remove(d,"manageStatesIconDisabled"),
b.set("disabled",!1)):(e.add(d,"manageStatesIconDisabled"),b.set("disabled",!0)));var b=r.getPreferences("davinci.ve.editorPrefs",davinci.Workbench.getProject()).newWidgetsCurrentState,d=h(".newWidgetsCurrentStateButton")[0],f=a.byNode(d),d=h(".newWidgetsCurrentStateIcon")[0];f&&d&&(this.newWidgetsCurrentStateActive(c)?e.remove(d,"newWidgetsCurrentStateIconDisabled"):e.add(d,"newWidgetsCurrentStateIconDisabled"),b?(e.remove(d,"newWidgetsCurrentStateIconOff"),e.add(d,"newWidgetsCurrentStateIconOn"),
f.set("title",z.NewWidgetsCurrentStateTitleCurrentState)):(e.remove(d,"newWidgetsCurrentStateIconOn"),e.add(d,"newWidgetsCurrentStateIconOff"),f.set("title",z.NewWidgetsCurrentStateTitleBackground)))}.bind(this))},manageStatesActive:function(c){return c&&c.getSelection().length},newWidgetsCurrentStateActive:function(c){return this._customStateActive(c)},highlightBaseWidgetsActive:function(c){return this._customStateActive(c)},updateHighlightsBaseStateWidgets:function(c){},initialize:function(){this.subscribed=
!0}});davinci.ve.states=new p;davinci.ve.states.initialize();return davinci.ve.states})},"davinci/maqetta/AppStates":function(){define("dojo/_base/connect dojo/dom-style dojo/dom dojo/_base/html dojo/_base/window dojo/_base/array dojo/parser require dojo/json dojo/_base/lang".split(" "),function(p,m,h,e,b,k,a,g,n,f){m=function(){};m.prototype={NORMAL:"Normal",DELTAS_ATTRIBUTE:"data-maq-deltas",DELTAS_ATTRIBUTE_P6:"dvStates",APPSTATES_ATTRIBUTE:"data-maq-appstates",APPSTATES_ATTRIBUTE_P6:"dvStates",
reImportant:/^(.*)(!\ *important)(.*)/,isStateContainer:function(c){return!(!c||!c._maqAppStates)},getStateContainersForNode:function(c){for(var a=[];c;){c._maqAppStates&&a.splice(0,0,c);if("BODY"==c.tagName)break;c=c.parentNode}return a},getAllStateContainers:function(c){function a(c){c._maqAppStates&&d.push(c);c=b._getChildrenOfNode(c);for(var f=0;f<c.length;f++)a(c[f])}var d=[],b=this;a(c);return d},getStatesArray:function(c,a,d,b){var f=[];if(c)for(c=c.parentNode;c;){if(c._maqAppStates)if(c==
b)f.splice(0,0,{node:c,oldState:a,newState:d});else{var g=c._maqAppStates.states?c._maqAppStates.states.current:void 0;f.splice(0,0,{node:c,oldState:g,newState:g})}if("BODY"==c.tagName)break;c=c.parentNode}return f},findStateContainer:function(c,a){if(c)for(var d=c.parentNode;d;){if(d._maqAppStates&&(!a||a==this.NORMAL||d._maqAppStates.states&&0<=d._maqAppStates.states.indexOf(a)))return d;if("BODY"==d.tagName)break;d=d.parentNode}},getAllStatesForNode:function(c){var a=[this.NORMAL];if(c)for(c=c.parentNode;c;){if(c._maqAppStates&&
c._maqAppStates.states)for(var d=c._maqAppStates.states?c._maqAppStates.states:[],b=0;b<d.length;b++)a.push(d[b]);if("BODY"==c.tagName)break;c=c.parentNode}return a},getStatesListCurrent:function(c){var a=[];if(c)for(c=c.parentNode;c;){c._maqAppStates&&a.splice(0,0,c._maqAppStates.current);if("BODY"==c.tagName)break;c=c.parentNode}return a},getAllCurrentStates:function(c){c=this.getAllStateContainers(c);for(var a=[],d=0;d<c.length;d++){var b=c[d],f=this.getState(b);a.push({stateContainerNode:b,state:f})}return a},
getStates:function(c){var a=c&&c._maqAppStates;c=["Normal"];if(a)for(var a=a.states?a.states:[],d=0;d<a.length;d++){var b=a[d];"Normal"!=b&&c.push(b)}return c},_getSCNodeFromElemOrEvent:function(c,a){var d;a&&a.tagName&&a.nodeName?d=a._maqAppStates?a:this.findStateContainer(a,c):a&&a.target&&a.currentTarget?(d=a.currentTarget,d._maqAppStates||(d=this.findStateContainer(d,c))):d=this.getContainer();return d},_updateSrcState:function(c){},hasState:function(c,a){return!!(c&&c._maqAppStates&&c._maqAppStates.states&&
0<=c._maqAppStates.states.indexOf(a))},getState:function(c){return c&&c._maqAppStates&&c._maqAppStates.current},setState:function(c,a,d){var b=d?d.updateWhenCurrent:!1,f=d?d.silent:!1,g=d?d.focus:!1;(a=this._getSCNodeFromElemOrEvent(c,a))&&a._maqAppStates&&(b||a._maqAppStates.current!=c)&&(b=a._maqAppStates.current,this.isNormalState(c)?(a._maqAppStates.hasOwnProperty("current")&&delete a._maqAppStates.current,c=void 0):a._maqAppStates.current=c,g&&this._setFocus(c,a),d&&d.hasOwnProperty("initial")&&
(d.initial?a._maqAppStates.initial=c:a._maqAppStates.initial&&delete a._maqAppStates.initial),f||p.publish("/maqetta/appstates/state/changed",[{node:a,newState:c,oldState:b,stateContainerNode:a}]),this._updateSrcState(a,!c))},getInitial:function(c){return c&&c._maqAppStates&&c._maqAppStates.initial},getFocus:function(c){if(!c)return null;c=this.getAllStateContainers(c);for(var a=0;a<c.length;a++){var d=c[a]._maqAppStates;if(d&&d.hasOwnProperty("focus"))return{stateContainerNode:c[a],state:d.focus}}return null},
_setFocus:function(c,a){if(a&&a._maqAppStates){var d=a.ownerDocument&&a.ownerDocument.body;if(d){var b=this.getFocus(d);if(!b||b.stateContainerNode!=a||b.state!=c){for(var b=this.getAllStateContainers(d),f=0;f<b.length;f++)(d=b[f]._maqAppStates)&&delete d.focus;a._maqAppStates.focus=c}}}},isNormalState:function(c){0==arguments.length&&(c=this.getState());return!c||c==this.NORMAL},_styleArrayMixin:function(c,a){if(a){for(var d=0;d<a.length;d++){var b=a[d],f;for(f in b)for(b=c.length-1;0<=b;b--)c[b].hasOwnProperty(f)&&
c.splice(b,1)}for(d=0;d<a.length;d++)c.push(a[d])}},getStyle:function(c,a,d){for(var b,f=[],g=0;g<a.length;g++)if(b=a[g],b=c&&c._maqDeltas&&c._maqDeltas[b]&&c._maqDeltas[b].style,this._styleArrayMixin(f,b),2<arguments.length&&f)for(b=f.length-1;0<=b;b--){var n=f[b],k;for(k in n)if(k!=d){f.splice(b,1);break}}return f},hasStyle:function(c,a,d){if(c&&d)if(c._maqDeltas&&c._maqDeltas[a]&&c._maqDeltas[a].style)for(c=c._maqDeltas[a].style,a=0;a<c[a];a++){if(c[a].hasProperty(d))return!0}else return!1},setStyle:function(c,
a,d,b){if(c&&d){c._maqDeltas=c._maqDeltas||{};c._maqDeltas[a]=c._maqDeltas[a]||{};c._maqDeltas[a].style=c._maqDeltas[a].style||[];var f=c._maqDeltas[a].style;if(d)for(var g=0;g<d.length;g++){var n=d[g],k;for(k in n)for(n=f.length-1;0<=n;n--){var e=f[n],h;for(h in e)if(k==h){f.splice(n,1);break}}}var m;if(d)for(n=0;n<d.length;n++)for(var C in d[n])g=d[n][C],"undefined"!=typeof g&&null!==g&&("undefined"==typeof m&&(m=[]),k={},k[C]=this._getFormattedValue(C,g),m.push(k));c._maqDeltas[a].style=f&&m?f.concat(m):
f?f:m?m:void 0;b||p.publish("/davinci/states/state/style/changed",[{node:c,state:a,style:d}]);this._updateSrcState(c)}},_convertStyleName:function(c){if(0<=c.indexOf("-")){var a=c.split("-");c=a[0];for(var d=1;d<a.length;d++){var b=a[d];c+=b.charAt(0).toUpperCase()+b.substring(1)}}return c},_DYNAMIC_PROPERTIES:{width:1,height:1,top:1,right:1,bottom:1,left:1},_getFormattedValue:function(a,d){if(a in this._DYNAMIC_PROPERTIES){if("string"!=typeof d)return d+"px";var b=g("dojo/_base/lang").trim(d);/^[-+]?[0-9]*\.?[0-9]+$/.test(b)&&
(d=b+"px")}return d},_getStatesListUsingPropName:function(a,d){var b=[];if(a)for(var f=0;f<a.length;f++)b.push(a[f][d]);return b},_resetAndCacheNormalStyle:function(a,d){if(a&&d)for(var b=0;b<d.length;b++){var g=this._getStatesListUsingPropName(d,"oldState"),n=this.getStyle(a,g),g=this._getStatesListUsingPropName(d),g=this.getStyle(a,g);if(n)for(var k=0;k<n.length;k++){var e=n[k],h;for(h in e)e=this._convertStyleName(h),a.style[e]=""}if(g)for(n=0;n<g.length;n++){var k=g[n],m;for(m in k){var e=this._convertStyleName(m),
v=a.style,A=this._getFormattedValue(m,k[m])+"",C=A?A.match(this.reImportant):null;C?(A=C[1]+C[3],A=f.trim(A),v.setProperty?v.setProperty(m,A,"important"):a.style[e]=A):a.style[e]=A}}}},_update:function(a,d){if(a&&a._maqDeltas){var b=this._getStatesListUsingPropName(d,"newState"),b=this.getStyle(a,b);this._resetAndCacheNormalStyle(a,d);if(b)for(var g=0;g<b.length;g++){var n=b[g],k;for(k in n){var e=this._convertStyleName(k),h=n[k]+"",m=h?h.match(this.reImportant):null;m?(h=m[1]+m[3],h=f.trim(h),n.setProperty?
n.setProperty(k,h,"important"):a.style[e]=h):a.style[e]=h}}var v,A;a.id&&a.ownerDocument&&(k=a.ownerDocument.defaultView.dijit.byId)&&(v=k&&k(a.id));v&&v.getParent&&(A=v.getParent());A&&A.resize?A.resize():v&&v.resize&&v.resize()}},isContainer:function(a){var d=!1;if(a){var b=this.getDocument();if(a===(b&&b.body)||"BODY"==a.tagName)d=!0}return d},getContainer:function(){return document.body},add:function(a,d,b){a&&!this.hasState(a,d)&&(b=b&&b.index,a._maqAppStates=a._maqAppStates||{},a._maqAppStates.states=
a._maqAppStates.states||[],"number"==typeof b&&0<=b?a._maqAppStates.states.splice(b,0,d):a._maqAppStates.states.push(d),p.publish("/davinci/states/state/added",[{node:a,state:d}]),this._updateSrcState(a))},remove:function(a,d){if(a&&a._maqAppStates&&a._maqAppStates.states&&this.hasState(a,d)){var b=a._maqAppStates.states.indexOf(d);if(!(0>b)){var f=this.getState(a),g=this.getFocus(a.ownerDocument.body);a._maqAppStates.states.splice(b,1);b={};g&&g.stateContainerNode==a&&g.state==d&&(b.focus=!0,b.updateWhenCurrent=
!0);d==f&&this.setState(void 0,a,b);p.publish("/davinci/states/state/removed",[{node:a,state:d}]);this._updateSrcState(a)}}},rename:function(a,d){if(!d)return!1;var b=d.oldName,f=d.newName;if(!(a&&a._maqAppStates&&a._maqAppStates.states&&a._maqAppStates.states.length))return!1;var g=a._maqAppStates.states;if(0>g.indexOf(b)||0<=g.indexOf(f))return!1;g.splice(g.indexOf(b),1,f);a._maqAppStates.focus===b&&(a._maqAppStates.focus=f);a._maqAppStates.current===b&&(a._maqAppStates.current=f);g=[a];this.getState(a);
for(g=g.concat(this._getChildrenOfNode(a));g.length;){var n=g.shift();n._maqDeltas&&n._maqDeltas[b]&&(n._maqDeltas[f]=n._maqDeltas[b],delete n._maqDeltas[b]);var g=g.concat(this._getChildrenOfNode(n)),k=this.getStatesArray(n,null,f,a);this._update(n,k);this._updateSrcState(n)}p.publish("/davinci/states/state/renamed",[{node:n,oldName:b,newName:f,stateContainerNode:n}]);return!0},_isEmpty:function(a){for(var d in a)if(a.hasOwnProperty(d))return!1;return!0},stringifyWithQuotes:function(a){str=n.stringify(a);
str=str.replace(/(\\)?'/g,function(a,c){return c?a:"\\'"});return str=str.replace(/"/g,"'")},serialize:function(a){var d=this,b=function(b){var f=null;a[b]&&(b=g("dojo/_base/lang").clone(a[b]),delete b.undefined,d._isEmpty(b)||(f=this.stringifyWithQuotes(b)));return f}.bind(this),f={};if(!a)return f;var n=b("_maqAppStates");"string"==typeof n&&(f.maqAppStates=n);b=b("_maqDeltas");"string"==typeof b&&(f.maqDeltas=b);return f},deserialize:function(a,d){"string"==typeof a&&(a=a.replace(/(\\)?'/g,function(a,
c){return c?"'":'"'}),a=n.parse(a),this._migrate_m4_m5(a),a=this._migrate_m6_m7(a,d&&d.isBody));return a},_migrate_m4_m5:function(a){for(var d in a){var b=a[d];if(b){var f=b.style;if(f&&!f.length){var g=[],n;for(n in f){var k={};k[n]=f[n];g.push(k)}b.style=g}}}},_migrate_m6_m7:function(a,d){if(!a||a.states)return a;if(d){var b=[],f;for(f in a)"current"!=f&&b.push(f);if(0<b.length)return{states:b}}else return delete a.current,a},store:function(a,d,b){if(a){this.clear(a);var f="BODY"==a.tagName;d&&
(a._maqAppStates=this.deserialize(d,{isBody:f}));b&&(a._maqDeltas=this.deserialize(b,{isBody:f}));p.publish("/davinci/states/stored",[])}},retrieve:function(a){if(a){var d=a.getAttribute(this.APPSTATES_ATTRIBUTE);d||"BODY"!==a.tagName||(d=a.getAttribute(this.APPSTATES_ATTRIBUTE_P6));var b=a.getAttribute(this.DELTAS_ATTRIBUTE);b||"BODY"===a.tagName||(b=a.getAttribute(this.DELTAS_ATTRIBUTE_P6));return{maqAppStates:d,maqDeltas:b}}},clear:function(a){a&&(a._maqAppStates&&delete a._maqAppStates,a._maqDeltas&&
delete a._maqDeltas)},_parseStyleValues:function(a){var d=[];a&&k.forEach(a.split(";"),function(a){var c=a.indexOf(":");if(0<c){var b=a.substring(0,c).trim();a=a.substring(c+1).trim();c={};c[b]=a;d.push(c)}});return d},transferElementStyle:function(a,d){if(a){var b=a._maqDeltas,f=this._parseStyleValues(d);b.undefined||(b.undefined={});b.undefined.style=f}},getDocument:function(){return document},shouldInitialize:function(){return!davinci.AppStatesDontInitialize},_getChildrenOfNode:function(a){for(var d=
[],b=0;b<a.childNodes.length;b++){var f=a.childNodes[b];1===f.nodeType&&d.push(f)}return d},initialize:function(){this.subscribed||(p.subscribe("/maqetta/appstates/state/changed",this,function(a){if(!a.editorClass)for(var d=davinci.states._getChildrenOfNode(a.node);d.length;){var b=d.shift();davinci.states.isContainer(b)||(d=d.concat(davinci.states._getChildrenOfNode(b)));var f=this.getStatesArray(b,a.oldState,a.newState,a.stateContainerNode);davinci.states._update(b,f)}}),this.subscribed=!0)}};"undefined"===
typeof davinci&&(davinci={});var d=davinci.states=new m;(function(){d.initialize();d.shouldInitialize()&&"undefined"!=typeof g&&g(["dojo/_base/lang","dojo/query","dojo/aspect"],function(c,f,n){var k=0,h=!1;c=function(a){h||(n.around(a,"parse",function(a){var c={};return function(f,g){var n;(n=!g&&f&&f.rootNode?f.rootNode:f)?e.byId(n):b.body();x(c);n=a.apply(this,arguments);var k=d.getDocument(),h,q,r,u,z;for(z in c){var B;if(B="body"==z?k.body:k.querySelectorAll("."+z)[0]){var m="BODY"==B.tagName;
q=r=u=null;m?h=c[z]:(h=c[z].maqAppStates,q=c[z].maqDeltas);h&&(r=d.deserialize(h,{isBody:m}));q&&(u=d.deserialize(q,{isBody:m}));r&&(r.initial?r.current=r.initial:(r.focus&&delete r.focus,delete r.current));d.store(B,r,u);q&&davinci.states.transferElementStyle(B,c[z].style)}}z=d.getAllStateContainers(k.body);for(k=0;k<z.length;k++)h=z[k],h._maqAppStates&&"string"==typeof h._maqAppStates.current&&d.setState(h._maqAppStates.current,h,{updateWhenCurrent:!0,focus:h._maqAppStates.focus});return n}}),dojo.parser.parse=
a.parse,h=!0)};try{var m=g("dojox/mobile/parser");c.apply(m)}catch(B){}m||c.call(null,a);var x=function(a){var c=d.getDocument();if(!c.body._maqAlreadyPreserved){var b=davinci.states.retrieve(c.body);b&&b.maqAppStates&&(a.body=b.maqAppStates);c.body._maqAlreadyPreserved=!0}f("*",c).forEach(function(c){var b=c.getAttribute("class");b||(b="");if(!c._maqAlreadyPreserved&&0>b.indexOf("maqTempClass")){c._maqAlreadyPreserved=!0;var f=d.retrieve(c);if("BODY"!=c.tagName&&f&&(f.maqAppStates||f.maqDeltas)){var g=
"maqTempClass"+k;c.setAttribute("class",b+" "+g);k++;a[g]={};f.maqAppStates&&(a[g].maqAppStates=f.maqAppStates);f.maqDeltas&&(a[g].maqDeltas=f.maqDeltas);c.style?a[g].style=c.style.cssText:console.error("States.js _preserveStates. No value for node.style.")}}})}})})();davinci.Workbench||"undefined"==typeof dijit||p.subscribe("/maqetta/appstates/state/changed",function(a){var d=a&&a.node&&a.node.ownerDocument&&a.node.ownerDocument.defaultView&&a.node.ownerDocument.defaultView.dijit.byId;d&&(a.newState&&
!a.newState.indexOf("_show:")?(a=d(a.newState.substring(6)))&&a.show&&a.show():a.oldState&&!a.oldState.indexOf("_show:")&&(a=d(a.oldState.substring(6)))&&a.hide&&a.hide())});return m})},"davinci/ve/commands/EventCommand":function(){define(["dojo/_base/declare","davinci/ve/widget"],function(p,m){return p("davinci.ve.commands.EventCommand",null,{name:"EventCommand",constructor:function(h,e){this._oldId=h?h.id:void 0;this._properties=e||{}},setContext:function(h){this._context=h},execute:function(){if(this._oldId&&
this._properties){var h=m.byId(this._oldId);this._oldProps=h.properties||{};h.setProperties(this._properties,!0);if(h.isHtmlWidget){var e=h.domNode,b;for(b in this._properties)this._properties[b]||e.removeAttribute(b)}this._newId=this._oldId;dojo.publish("/davinci/ui/widgetPropertiesChanged",[[h]])}},undo:function(){if(this._newId){var h=m.byId(this._newId),e=h.domNode,b=h._srcElement,k;for(k in this._properties)this._oldProps[k]||(e.removeAttribute(k),b.removeAttribute(k));h.setProperties(this._oldProps);
dojo.publish("/davinci/ui/widgetPropertiesChanged",[[h]])}}})})},"davinci/ve/widget":function(){define("davinci/html/HTMLElement ../Runtime ./metadata dojo/Deferred dojo/_base/lang ./DijitWidget ./GenericWidget ./DeliteWidget ./HTMLWidget ./ObjectWidget dojo/window".split(" "),function(p,m,h,e,b,k,a,g,n,f,d){var c={},q=function(a,c,d){for(var b=0;b<d.children.length;b++){var f=c.childNodes[b],g=d.children[b];f&&1==f.nodeType&&"HTMLElement"==g.elementType&&(f.id=a.getUniqueID(g),q(a,f,g))}},u={_dojo:function(a){a=
(a=a?a.ownerDocument||a:dojo.doc)||dojo.doc;return d.get(a).dojo||dojo},_dijit:function(a){return d.get(a?a.ownerDocument||a:dojo.doc).dijit||dijit},parseStyleValues:function(a){var c=[];a&&dojo.forEach(a.split(";"),function(a){var d=a.indexOf(":");if(0<d){var b=a.substring(0,d).trim();a=a.substring(d+1).trim();d={};d[b]=a;c.push(d)}});return c},retrieveStyleProperty:function(a,c,d){var b=d;a&&dojo.some(a,function(a){if(a.hasOwnProperty(c))return b=a[c],!0});return b},setStyleProperty:function(a,
c,d){var b=!1;a&&dojo.some(a,function(a){if(a.hasOwnProperty(c))return a[c]=d,b=!0});if(!b){var f={};f[c]=d;a.push(f)}},getStyleString:function(a){var c="";dojo.forEach(a,function(a){for(var d in a)a[d]&&(c=c+d+":"+a[d]+";")});return c},getEnclosingWidget:function(a){var c=u.getEnclosingWidgetForRichText(a);if(c)return c;for(;a;){if(a._dvWidget)return a._dvWidget;a=a.parentNode||a.domNode&&a.domNode.parentNode}},getEnclosingWidgetForRichText:function(a){if(a&&a._dvWidget)return"html.stickynote"===
a._dvWidget.type||"html.richtext"===a._dvWidget.type?a._dvWidget:a.parentNode?u.getEnclosingWidgetForRichText(a.parentNode):null},getUniqueObjectId:function(a,c){if(a){for(var d=a.substring((a.lastIndexOf("/")||a.lastIndexOf("."))+1),b=1,f=d+"_"+b++,g=u._dojo(c);g.getObject(f)||g.byId(f);)f=d+"_"+b++;return f}},_remove_prefix:function(a){if(a){for(var c=a,d="dijit/form/ dijit/layout/ dijit/ dojox/mobile/ html. html/ OpenAjax. OpenAjax/".split(" "),b=0;b<d.length;b++)if(0==a.indexOf(d[b])){c=a.substr(d[b].length);
"html."==d[b]&&(c="\x26lt;"+c+"\x26gt;");break}return c}return""},_getWidgetNameText:function(a){a="\x3cspan class\x3d'propertiesTitleWidgetName'\x3e"+this._remove_prefix(a);return a+"\x3c/span\x3e"},_getWidgetClassText:function(a,c){var d="\x3cspan class\x3d'propertiesTitleClassName'\x3e";a&&(d+="#"+a);c&&(d+="."+c.replace(/\s+/g,"."));return d+"\x3c/span\x3e"},getLabelForNode:function(a){var c=a.getAttribute("data-dojo-type")||a.getAttribute("dojoType");c||(c=a.tagName.toLowerCase());c=c.replace(/\./g,
"/");c=this._getWidgetNameText(c);a.id&&(c+=this._getWidgetClassText(a.id));return c},getLabel:function(a){var c=this._getWidgetNameText(a.type),d,b=u.getWidgetHelper(a.type);b&&b.getWidgetText&&(d=b.getWidgetText(a));b&&b.getWidgetNameText&&(c=b.getWidgetNameText(a));var f=a.domNode;if(!a.type)return"unknown type";switch(a.type.replace(/\//g,".")){case "dijit.form.ComboBox":case "dijit.form.Button":d=a.attr("label");break;case "dijit.layout.ContentPane":d=a.attr("title");break;case "html.label":d=
f.innerHTML;break;case "html.img":d=f.alt,d||(d=f.title)}d&&(c+="\x3cspan class\x3d'propertiesTitleWidgetText'\x3e"+d+"\x3c/span\x3e ");b&&b.getWidgetDescriptor&&(c+=" \x3cspan class\x3d'propertiesTitleWidgetDescriptor'\x3e"+b.getWidgetDescriptor(a)+"\x3c/span\x3e ");var g=a._srcElement;d=a.getId();g=(g=g&&g.getAttribute("class"))&&g.trim();if(d||g)c=b&&b._getWidgetClassText?c+b._getWidgetClassText(d,g):c+this._getWidgetClassText(d,g);b&&b.getWidgetTextExtra&&(c+=b.getWidgetTextExtra(a));"html.img"==
a.type&&(c+="\x3cspan\x3e"+f.src.substr(f.src.lastIndexOf("/")+1)+"\x3c/span\x3e");return c},byId:function(a,c){var d=dojo.byId(a,c&&c.body?c:void 0);if(d){if(d._dvWidget)return d._dvWidget;if((d=u.getEnclosingWidget(d))&&d.id==a)return d}if(m.currentEditor&&m.currentEditor.currentEditor&&m.currentEditor.currentEditor.context)return m.currentEditor.currentEditor.context.widgetHash[a]},byNode:function(a){if(a._dvWidget)return a._dvWidget},createWidget:function(c,e,m){if(c&&c.type){var B=dojo.mixin({},
c),x=!1;"xblox/RunScript"===B.type&&"xblox/CSSState"===B.type&&(x=!0,delete c.properties.style);B.properties&&(B.properties=dojo.mixin({},c.properties));var w=B.type,v,A,C=h.query(w);if(C){B.properties&&("content"in B.properties&&!B.properties.content&&delete B.properties.content,B.properties.theme&&(A=B.properties.theme.themeName));m&&m.metadata&&m.metadata.childOverride&&b.mixin(B.properties,m.metadata.childOverride);c=h.queryDescriptor(w,"widgetClass");!c&&e&&e.widgetClass&&(c=e.widgetClass);if(!0===
C.delite||"xblox/RunScript"===w||"xblox/CSSState"===w||"xblox/Script"===w||"xblox/StyleSate"===w)c="delite";"delite"==c?v=g:"object"==c?(v=f,C.attributes=C.attributes||{},C.attributes.dojoType=w):"html"==c?v=n:"dijit"==c?v=k:null==v&&(v=a);if(v){c=C.content.trim().replace(/\s+/g," ");d.get(dojo.doc);var L=d.get(dojo.doc).dojo._toDom(c);L.fromWidgetData&&L.fromWidgetData(B);if(11===L.nodeType){m=0;var E=null;c=L.childNodes;for(var I=0;I<c.length&&!(8!==c[I].nodeType&&(m++,E=c[I],1<m));I++);if(1<m){console.error("ERROR: complex widget content not supported");
return}L=E}if(!L)return null;var D=new p(L.tagName.toLowerCase());if(L.hasAttributes())for(c=L.attributes,m=c.length-1;0<=m;--m)x&&"style"===c[m].name||D.addAttribute(c[m].name,c[m].value);L.innerHTML&&D.addText(L.innerHTML);x=h.queryDescriptor(w,"requiresId");c=h.queryDescriptor(w,"name");x=x&&c.match(/^[A-Za-z]\w*$/)?c:void 0;L.id=B.properties&&B.properties.id||(B.context?B.context.getUniqueID(D,x):"");if(c=B.children)dojo.isString(c)?(L.innerHTML=c,L.nodeName.toLowerCase(),x=D._getAttribute("id"),
D.addText(c),c=D.getText(B.context),D.children=[],D.setText(c),x&&D.addAttribute(x.name,x.value,x.noPersist),q(B.context,L,D)):dojo.forEach(c,function(a){if(a)if(dojo.isString(a))7<a.length&&"\x3c!--"==a.substring(0,4)&&"--\x3e"==a.substring(a.length-3)?(L.appendChild(dojo.doc.createComment(a.substring(4,a.length-3))),D.addComment(a.substring(4,a.length-3))):(L.appendChild(dojo.doc.createTextNode(a)),D.addText(a));else if(a.context=B.context,a=u.createWidget(a))L.appendChild(a.domNode),D.addChild(a._srcElement)});
(x=u.getWidgetHelper(w))&&x.preProcessData&&(B=x.preProcessData(B));x={};c={};for(var G in B.properties)m=B.properties[G],null!=m&&("on"==G.substr(0,2).toLowerCase()||"a"==D.tag.toLowerCase()&&"href"==G.toLowerCase()?c[G]=m:x[G]=m);C=new v(x,L,w,C,D,w);C._srcElement=D;C.chart&&B.properties&&B.properties.theme&&(C.chart.theme.themeName=A);B.scripts&&(C.scripts=B.scripts);B.context&&(C._edit_context=B.context);B.properties&&(C.setProperties(x),C.setProperties(c,!0));if(B.maqAppStates||B.maqDeltas)B.maqAppStates&&
(C.domNode._maqAppStates=dojo.clone(B.maqAppStates)),B.maqDeltas&&(C.domNode._maqDeltas=dojo.clone(B.maqDeltas)),A=davinci.states.serialize(C.domNode),A.maqAppStates&&C._srcElement.addAttribute(davinci.states.APPSTATES_ATTRIBUTE,A.maqAppStates),A.maqDeltas&&C._srcElement.addAttribute(davinci.states.DELTAS_ATTRIBUTE,A.maqDeltas);(x=u.getWidgetHelper(w))&&x.cleanSrcElement&&x.cleanSrcElement(C._srcElement,e);x&&x.postCreateWidget&&x.postCreateWidget(C,e);return C}}else console.error("cant get widget meta data : ",
c)}},_createSrcElement:function(a){var c=new p(a.tagName.toLowerCase());if(a.hasAttributes()){a=a.attributes;for(var d=a.length-1;0<=d;--d)c.addAttribute(a[d].name,a[d].value)}return c},getWidgetHelper:function(a){return c[a]},requireWidgetHelper:function(a){var d=new e;h.getHelper(a,"helper").then(function(b){b?d.resolve(c[a]=new b):d.resolve()});return d},getWidget:function(c,d){if(c&&1==c.nodeType){var b=u.byNode(c);if(!b){if(c){for(var b={properties:{}},e=0;e<c.attributes.length;e++){var h=c.attributes[e];
if(h.specified&&h.nodeValue){var q=h.nodeName.toLowerCase();if("id"!=q&&"widgetid"!=q&&"style"!=q&&"_"!=q.charAt(0)){if((h=h.nodeValue)&&"class"==q&&(h=h.replace("HtmlWidget","").trim(),!h))continue;b.properties[q]=h}}}"script"==c.tagName.toLowerCase()&&(b.children=c.innerHTML||void 0)}else b=void 0;if(b.properties.is||null!=c.render||-1!==c.tagName.indexOf("D-"))return b=new g(b,c);e=c.getAttribute("dvwidget");if(c.hasAttribute("widgetid")||c.hasAttribute("data-dojo-type")||c.hasAttribute("dojotype"))e=
u._dijit(c).byNode(c),q=c.getAttribute("data-dojo-type")||c.getAttribute("dojotype"),b=e?new k(b,c,e,null,null,q):new f(b,c);else if(e)b=new a(b,c,e);else{if("svg"==c.nodeName)return;b=new n(b,c,d)}}return b}}};dojo.setObject("davinci.ve.widget",u);return u})},"davinci/ve/DijitWidget":function(){define("require dojo/_base/declare dojo/_base/window dojo/_base/lang dojo/dom-attr dojo/parser ./_Widget ./metadata".split(" "),function(p,m,h,e,b,k,a,g){return m("davinci.ve.DijitWidget",a,{isDijitWidget:!0,
constructor:function(a,f,d,c,g,k){if("string"===typeof d){b.get(f,"data-dojo-type")||b.get(f,"dojoType")||b.set(f,"data-dojo-type",d);g&&g.addAttribute("data-dojo-type",d);d=f.ownerDocument;g=d.defaultView;(c=d.__DijitWidgetScratchSpace)||(c=d.__DijitWidgetScratchSpace=d.createElement("div"));c.appendChild(f);d=g.require("dojo/parser").instantiate([f],a,{noStart:!0})[0];c.firstChild&&c.removeChild(c.firstChild);if(this.domNode=d.domNode)d.domNode._dvWidget=this;this.isLayoutContainer=d.isLayoutContainer}else this.type=
k?k.replace(/\./g,"/"):d.declaredClass.replace(/\./g,"/");a=davinci.ve.metadata.getAllowedChild(this.type);this.acceptsHTMLChildren="ANY"===a[0]||-1!==a.toString().toUpperCase().indexOf("HTML");this.dijitWidget=d;this.containerNode=d.containerNode;this.styleNode=d.styleNode;this.id=d.id},getParent:function(){if(this.dijitWidget&&this.dijitWidget.domNode&&this.dijitWidget.domNode.parentNode){var a=p("davinci/ve/widget"),b=this.dijitWidget;do b=a.getEnclosingWidget(b.domNode.parentNode);while(b&&b.dijitWidget&&
"_"==b.dijitWidget.declaredClass.split(".").pop().charAt(0));return b}},_getChildren:function(a){if(this.acceptsHTMLChildren)return this.inherited(arguments);var b=[];"NONE"!==davinci.ve.metadata.getAllowedChild(this.type)[0]&&(this.dijitWidget.getChildren(),this.dijitWidget.getChildren().forEach(function(d){d._maqNotDVWidget||(a?b.push(p("davinci/ve/widget").getWidget(d.domNode)):(d=d.domNode&&d.domNode._dvWidget)&&b.push(d))}));return b},_getContainerNode:function(){return this.containerNode||this.domNode},
selectChild:function(a){this.dijitWidget.selectChild&&this.dijitWidget.selectChild(a.dijitWidget)},_addChildToDom:function(a,b){if(this.acceptsHTMLChildren){this.inherited(arguments);var d=a.dijitWidget;d&&this.dijitWidget._started&&!d._started&&a.startup()}else a.dijitWidget&&this.dijitWidget.addChild?this.dijitWidget.addChild(a.dijitWidget,b):("xblox/RunScript"===a.type&&a.getHelper()&&a.getHelper().addChildToDom&&a.getHelper().addChildToDom(this.dijitWidget,a,b),this.inherited(arguments))},_removeChildFromDom:function(a){this.dijitWidget.removeChild&&
a.dijitWidget?this.dijitWidget.removeChild(a.dijitWidget):this.inherited(arguments)},_getPropertyValue:function(a){return this.dijitWidget.get(a)},startup:function(){this.dijitWidget.startup()},isLayout:function(){var a=this.getContext().getDijit();return a.layout?this.dijitWidget.isInstanceOf(a.layout._LayoutWidget):!1},resize:function(){var a=this.getHelper();a&&a.resize?a.resize(this):this.dijitWidget.resize&&this.dijitWidget.resize()},renderWidget:function(){if(this.dijitWidget.render)this.dijitWidget.render();
else if(this.dijitWidget.chart){var a=dojo.marginBox(this.dijitWidget.domNode);this.dijitWidget.resize(a)}this.domNode.parentNode._dvWidget&&this.domNode.parentNode._dvWidget.isDijitWidget&&this._refresh(this.domNode.parentNode)},_refresh:function(a){var b=a.parentNode;b._dvWidget&&b._dvWidget.isDijitWidget?this._refresh(b):a._dvWidget.resize&&a._dvWidget.resize()},_attr:function(a,b){return this.dijitWidget.get.apply(this.dijitWidget,arguments)}})})},"davinci/ve/_Widget":function(){define("davinci/ve/_Widget",
"dojo/_base/declare ./metadata ../html/CSSModel dojox/html/entities davinci/ve/utils/StyleArray davinci/ve/utils/GeomUtils xide/mixins/EventedMixin xide/mixins/ReloadMixin".split(" "),function(p,m,h,e,b,k,a,g){var n=function(a,d,c){if(a==d)return!0;if(!a||!d||a.length!=d.length)return!1;for(var b=0;b<a.length;b++)if(c){if(!c(a[b],d[b]))return!1}else if(a[b]!=d[b])return!1;return!0};return p("davinci.ve._Widget",[a,g],{isWidget:!0,acceptsHTMLChildren:!1,_skipAttrs:"id style class dir lang _children".split(" "),
constructor:function(a,d,c,b){this.domNode=d;this.id=d.id;d._dvWidget=this;this._params=dojo.mixin({},a);this.type=c;this.metadata=b},postscript:function(){var a;if(this.domNode){var d=this.domNode.ownerDocument;d.body._edit_context?a=d.body._edit_context:d.body._dvWidget&&d.body._dvWidget._edit_context&&(a=d.body._dvWidget._edit_context)}this.id&&a&&(a.widgetHash[this.id]=this);this.buildRendering();this.postCreate()},buildRendering:function(){},postCreate:function(){},getObjectType:function(){},
getContext:function(){return this._edit_context},getChildren:function(a){var d=this.getHelper();return d&&d.getChildren?d.getChildren(this,a):this._getChildren(a)},indexOf:function(a){var d=this.getHelper();return d&&d.indexOf?d.indexOf(this,a):dojo.indexOf(this.getChildren(),a)},_getChildrenForTree:function(a){a=this.getContainerNode();var d=[];a&&!a.children.length&&this.domNode.children.length&&(a=this.domNode);a&&dojo.forEach(a.children,function(a){a=dijit.registry.getEnclosingWidget(a);a!=this&&
d.push(a)});return d},_getChildren:function(a){var d=this.getContainerNode(),c=[];d&&dojo.forEach(d.children,function(d){a?c.push(require("davinci/ve/widget").getWidget(d)):(d=d._dvWidget)&&c.push(d)});return c},getContainerNode:function(){var a=this.getHelper();return a&&a.getContainerNode?a.getContainerNode(this):"NONE"!==m.getAllowedChild(this.type)[0]?this._getContainerNode():null},_getContainerNode:function(){return this.domNode},getMetadata:function(){this.metadata||(this.metadata=m.query(this));
return this.metadata},getHelper:function(){this._edit_helper||(this._edit_helper=require("davinci/ve/widget").getWidgetHelper(this.type));return this._edit_helper},attr:function(a,d){var c=this._attr.apply(this,arguments);if(1<arguments.length)d=this._stringValue(a,d),this._srcElement.addAttribute(a,d);else return c},_attr:function(a,d){},indexOf:function(a){var d=this.getHelper();return d&&d.indexOf?d.indexOf(this,a):dojo.indexOf(this.getChildren(),a)},getStyleNode:function(){return this.styleNode||
this.domNode},addChild:function(a,d){if(this.getContainerNode()){if(void 0===d||null===d||-1===d)this._srcElement.addChild(a._srcElement);else{var c=this.getChildren();d<c.length?this._srcElement.insertBefore(a._srcElement,c[d]._srcElement):this._srcElement.addChild(a._srcElement)}(c=this.getHelper())&&c.addChild?c.addChild(this,a,d):this._addChildToDom.apply(this,arguments)}},_addChildToDom:function(a,d){try{var c=a.domNode,b=this.getContainerNode();if(void 0===d||null===d||-1===d)b.appendChild(c);
else{var g=this.getChildren();d<g.length?b.insertBefore(c,g[d].domNode):b.appendChild(c)}}catch(n){debugger}},getParent:function(){return require("davinci/ve/widget").getEnclosingWidget(this.domNode.parentNode)||this.domNode.parentNode},getObjectId:function(a){a=a||this;var d=a._edit_object_id;if(d)return d;if(a.domNode)return a.domNode.getAttribute("jsId")},addClass:function(a){var d=this.getClassNames(),d=d?d.split(/\s+/):[];-1===d.indexOf(a)&&(d.push(a),this._srcElement.setAttribute("class",d.join(" ")),
dojo.addClass(this.domNode,a))},getId:function(){if(!this.id){if(!this.domNode.id||!this.type)return;var a=this.domNode.id,d=(this.isHtmlWidget?this.getTagName():this.type).replace(/\./g,"_")+"_";if(a.length>d.length&&a.substring(0,d.length)==d)return}return this._srcElement&&this._srcElement._getAttribute("id")&&this._srcElement._getAttribute("id").noPersist?void 0:this.id},setMarginBox:function(a){var d=this.getStyleNode();d&&(dojo.marginBox(d,a),this._updateSrcStyle())},getMarginBox:function(){var a=
this.domNode,d=null,d=(d=this.getHelper())&&d.getMarginBoxPageCoords?d.getMarginBoxPageCoords(this):k.getMarginBoxPageCoords(a);d.l-=k.getScrollLeft(a);d.t-=k.getScrollTop(a);d.x=d.l;d.y=d.t;return d},getStyle:function(a){return(a=this.getStyleValues(a))?this._styleText(a):""},_sortStyleValues:function(a){a=dojo.clone(a);for(var d=h.shorthand,c=0,b=0;b<d.length;b++){var g;a:{g=d[b][0];for(var n=0;n<a.length;n++)if(a[n]&&a[n].hasOwnProperty(g)){g=n;break a}g=-1}-1<g&&(n=a[g],a.splice(g,1),a.splice(c,
0,n),c++)}return a},_styleText:function(a){var d="";if(dojo.isArray(a)){a=davinci.ve.states.normalizeArray("style",this.domNode,b,a);for(var c=0;c<a.length;c++)for(var b in a[c])value=a[c][b],void 0!==value&&""!=value&&null!=value&&(d+=b+": "+a[c][b]+"; ")}else for(b in a)value=davinci.ve.states.normalize("style",this.domNode,b,a[b]),void 0!==value&&""!=value&&null!=value&&(d+=b+": "+a[b]+"; ");return d.trim()},getChildrenData:function(a){a=a||{identify:!0};var d=this.getHelper();return d&&d.getChildrenData?
d.getChildrenData.apply(d,[this,a]):this._getChildrenData(a)},_getChildrenData:function(a){return this.getChildren().map(function(d){return d.getData(a)})},getClassNames:function(){return this._srcElement.getAttribute("class")||""},_getData:function(a){var d={type:this.type,properties:{}},c=require("davinci/ve/widget");if(a.identify){this._srcElement||(this._srcElement=c._createSrcElement(this.domNode));var b=this._srcElement._getAttribute("id");b&&b.noPersist&&(d.properties.isTempID=!0);d.properties.id=
this.id}!1!==a.preserveTagName&&this.id&&(d.tagName=this._srcElement.tag);b=m.query(this,"property");this.domNode&&this.domNode.parentNode&&(c=c.getEnclosingWidget(this.domNode.parentNode),(c=m.query(c,"childProperties"))&&(b=b?dojo.mixin({},b,c):c));if(b)for(var g in b)if(-1===this._skipAttrs.indexOf(g.toLowerCase())){var c=b[g],k=this.getPropertyValue(g);k&&k.length?"array"==c.datatype?n(k,c.defaultValue)||(d.properties[g]=k):k!=c.defaultValue&&(d.properties[g]=k):"boolean"!=c.datatype&&"number"!=
c.datatype||k==c.defaultValue?c.datatype&&(0==c.datatype.indexOf("dijit")||"object"==c.datatype&&c.isData)&&(d.properties[g]=k):d.properties[g]=k}d.properties.style=this.getStyle(a);(g=this.getClassNames(a))&&(d.properties["class"]=g);d.children=this.getChildrenData(a);d.type.indexOf("delite");return d},getData:function(a){a=a||{identify:!0,preserveStates:!0};var d=this.getHelper();a=d&&d.getData?d.getData.apply(d,[this,a]):this._getData(a);a.maqAppStates=dojo.clone(this.domNode._maqAppStates);a.maqDeltas=
dojo.clone(this.domNode._maqDeltas);a.properties||(a.properties={});if(this.properties)for(var c in this.properties)c in a.properties||(a.properties[c]=this.properties[c]);c=this._srcElement;for(var d=c.attributes,b=0;b<d.length;b++){var g=d[b];"on"==g.name.substr(0,2).toLowerCase()?a.properties[g.name]=g.value:"a"==c.tag.toLowerCase()&&"href"==g.name.toLowerCase()&&(a.properties[g.name]=g.value)}return a},getPropertyValue:function(a){if("id"===a)return this.getId();if("jsId"===a)return this.getObjectId();
var d=this.getHelper();return d&&d.getPropertyValue?d.getPropertyValue(this,a):this._getPropertyValue(a)},_getPropertyValue:function(a){return this.domNode.getAttribute(a)},getTagName:function(){return this.domNode.nodeName.toLowerCase()},getStyleValues:function(){function a(c){for(var d=b.length-1;0<=d;d--)void 0!==b[d][c]&&b.splice(d,1)}var d=this.getStyleNode().style,c=this._srcElement.getAttribute("style"),b=require("davinci/ve/widget").parseStyleValues(c),c=this.getParent();d&&c&&c.dijitWidget&&
c.dijitWidget.addChild&&!c.acceptsHTMLChildren&&(a("position"),a("left"),a("top"));return b},getStyleValuesAllStates:function(){var a=this.getStyleValues(),d={undefined:a},c=this.domNode._maqDeltas;if(c)for(var g in c)c[g].style&&(d[g]="undefined"==g?b.mergeStyleArrays(a,c[g].style):c[g].style);return d},_updateSrcStyle:function(){var a=this.getStyle();a.length?this._srcElement.addAttribute("style",a):this._srcElement.removeAttribute("style")},_getStyleString:function(a){if(!a)return"";a=this._sortStyleValues(a);
return this._styleText(a)},setStyleValuesCanvas:function(a){if(a){a=this._getStyleString(a);var d=this.getStyleNode();dojo.attr(d,"style",a);this.dijitWidget&&(this.dijitWidget.style=a)}},setStyleValuesModel:function(a){a=this._getStyleString(a);0<a.length?this._srcElement.addAttribute("style",a):this._srcElement.removeAttribute("style")},setStyleValuesAllStates:function(a){this.domNode._maqDeltas=void 0;if(a)for(var d in a){var c=a[d];"undefined"===d&&(d=void 0);davinci.ve.states.setStyle(this.domNode,
d,c,!0)}},isLayout:function(){return!1},resize:function(){},refresh:function(){var a=this.getParent();a&&a.dijitWidget?a.refresh():this.resize&&this.resize()},removeChild:function(a){this._srcElement?this._srcElement.removeChild(a._srcElement):console.error("cant remove child! this._srcElement is null",this);var d=this.getHelper();d&&d.removeChild?d.removeChild(this,a):this._removeChildFromDom.apply(this,arguments)},_removeChildFromDom:function(a){(a=a.domNode)&&a.parentNode&&a.parentNode.removeChild(a)},
setProperties:function(a,d){this.properties||(this.properties={});d=d||!1;a.id&&(this._srcElement.addAttribute("id",a.id,a.isTempID),delete a.id,delete a.isTempID);a.isTempID&&delete a.isTempID;for(var c in a){var b=a[c];b||"boolean"==typeof b||"number"==typeof b?(b=this._stringValue(c,b),d||(this.properties[c]=b),this._srcElement.addAttribute(c,b)):(delete this.properties[c],this._srcElement.removeAttribute(c))}},startup:function(){this.initReload()},renderWidget:function(){},destroyWidget:function(a){(a=
this.getHelper())&&a.destroy?a.destroy(this):this.dijitWidget?this.dijitWidget.destroyRecursive():dojo.forEach(this.getChildren(),function(a){a.destroyWidget()})},destroy:function(){this.inherited(arguments);console.error("destry")},selectChild:function(a){},attach:function(){var a=this.getHelper();a&&a.create&&a.create(this,this._srcElement)},_stringValue:function(a,d){var c=this.getMetadata(),c=c.property&&c.property[a];if(!c)return d;if("object"==c.datatype)if(d.getObjectId)d=d.getObjectId();else{if(c=
d._edit_object_id)return c;if(d.domNode)return d.domNode.getAttribute("jsId")}else if("json"==c.datatype){var c=(c=this.getContext())&&c.getDojo()||dojo,b=this.getHelper();b&&b.checkValue&&(d=b.checkValue(d));c.isObject(d)&&(d=c.toJson(d))}else if("string"==c.datatype)switch(c.format){case "date":case "time":isFinite(d)&&(d=dojo.date.stamp.toISOString(d,{selector:c.format}));break;default:d=e.encode(d)}return d}})})},"davinci/html/CSSModel":function(){define({shorthand:[["border","border-width border-style border-color border-top border-left border-right border-bottom".split(" ")],
["border-width",["border-top-width","border-right-width","border-bottom-width","border-left-width"]],["border-style",["border-top-style","border-right-style","border-bottom-style","border-left-style"]],["border-color",["border-top-color","border-right-color","border-bottom-color","border-left-color"]],["border-bottom",["border-bottom-width","border-bottom-style","border-bottom-color"]],["border-top",["border-top-width","border-top-style","border-top-color"]],["border-left",["border-left-width","border-left-style",
"border-left-color"]],["border-right",["border-right-width","border-right-style","border-right-color"]],["font","font-size line-height font-weight font-style font-family line-height".split(" ")],["border-radius",["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius"]],["-moz-border-radius",["-moz-border-radius-topleft","-moz-border-radius-topright","-moz-border-radius-bottomright","-moz-border-radius-bottomleft"]],["margin",["margin-top","margin-right",
"margin-bottom","margin-left"]],["padding",["padding-top","padding-right","padding-bottom","padding-left"]],["background",["background-color","background-image","background-repeat","background-position","background-attachment"]]]})},"davinci/ve/utils/StyleArray":function(){define([],function(){return{mergeStyleArrays:function(p,m){p||(p=[]);m||(m=[]);for(var h=dojo.clone(p),e=0;e<m.length;e++)for(var b in m[e])for(j=h.length-1;0<=j;j--){var k=h[j],a;for(a in k)if(b==a){h.splice(j,1);break}}return h.concat(m)}}})},
"davinci/ve/GenericWidget":function(){define(["dojo/_base/declare","./_Widget"],function(p,m){return p("davinci.ve.GenericWidget",m,{isGenericWidget:!0,constructor:function(h,e,b,k,a){dojo.attr(e,"dvwidget",b);a&&a.addAttribute("dvwidget",b)},buildRendering:function(){this.containerNode=this.domNode;if(this._params){for(var h in this._params)this.domNode.setAttribute(h,this._params[h]);this._params=void 0}},_getChildrenData:function(h){for(var e=[],b=this.domNode.childNodes,k=0;k<b.length;k++){var a=
b[k],g;switch(a.nodeType){case 1:(a=require("davinci/ve/widget").byNode(a))&&(g=a.getData(h));break;case 3:(g=a.nodeValue.trim())&&h.serialize&&(g=davinci.html.escapeXml(g));break;case 8:g="\x3c!--"+a.nodeValue+"--\x3e"}g&&e.push(g)}return 0===e.length?void 0:e},setProperties:function(h){var e=this.domNode,b;for(b in h)"style"===b?dojo.style(e,h[b]):h[b]?e[b]=h[b]:e.removeAttribute(b);this.inherited(arguments)},_attr:function(h,e){if(1<arguments.length)this.domNode.setAttribute(h,e);else return this.domNode.getAttribute(h)},
getTagName:function(){return this.domNode.nodeName.toLowerCase()}})})},"davinci/ve/DeliteWidget":function(){define("dojo/_base/declare ./_Widget ./widget require xide/registry xide/utils".split(" "),function(p,m,h,e,b,k){function a(a){a.declaredClass&&"davinci.ve.DeliteWidget"!==a.declaredClass?a.type=a.declaredClass:a.domNode&&a.domNode.declaredClass&&-1==a.domNode.declaredClass.indexOf("uniq")&&(a.type=a.domNode.declaredClass);if(!a.type)switch("delite/"+k.capitalize(a.domNode.baseClass.replace("d-",
""))){case "delite/Radio-button":a.type="delite/RadioButton";break;case "delite/Checkbox":a.type="delite/Checkbox";break;case "delite/Accordion-header":a.type="delite/AccordionHeader";break;case "delite/Combobox":a.type="delite/Combobox";break;case "delite/Toggle-button":a.type="delite/ToggleButton";break;case "delite/Tab-bar":a.type="delite/TabBar";break;case "delite/View-stack":a.type="delite/ViewStack";break;case "delite/MediaPlayer":a.type="delite/MediaPlayer";break;case "delite/Panel":a.type=
"delite/Panel";break;case "delite/Select":a.type="delite/Select";break;case "delite/Button":a.type="delite/Button";break;case "delite/Accordion":a.type="delite/Accordion";break;case "delite/Slider":a.type="delite/Slider"}a.type?b.add(a.domNode):console.error("have no widget type ",a)}p=p("davinci.ve.DeliteWidget",m,{isGenericWidget:!0,helper:h,getData:function(a){a=a||{identify:!0,preserveStates:!0};var n;n=(n=this.getHelper())&&n.getData?n.getData.apply(n,[this,a]):this._getData(a);var f=!1;"no_id"===
this.id&&(f=dijit.getUniqueId(this.type.replace(/\./g,"_")),f=f.replace("delite/","d-").toLowerCase(),console.error("no id! set to "+f),this.id=f,n.properties.id=f,n.properties.id=f,this.domNode.id=f,f=!0);a.identify&&!f&&b.byId(this.id);b.add(this.domNode);n.maqAppStates=dojo.clone(this.domNode._maqAppStates);n.maqDeltas=dojo.clone(this.domNode._maqDeltas);n.properties||(n.properties={});if(this.properties)for(var d in this.properties)d in n.properties||(n.properties[d]=this.properties[d]);a=this._srcElement;
for(var f=a.attributes,c=0;c<f.length;c++){var k=f[c];d=k.name;if("on"==k.name.substr(0,2).toLowerCase())n.properties[k.name]=k.value;else if("a"==a.tag.toLowerCase()&&"href"==k.name.toLowerCase())n.properties[k.name]=k.value;else if("stop"===d||"bidirectional"===d||"block"===d||"targetevent"===d)n.properties[k.name]=k.value}return n},_fixType:function(b){return a(b)},_getChildren:function(a){function b(a){dojo.forEach(a.children,function(a){(a=c.getWidget(a,!1))&&!a.type&&d._fixType(a);d.metadata&&
d.metadata.ignore&&a.type&&-1!==d.metadata.ignore.indexOf(a.type)||a&&a.type&&(-1==a.type.indexOf("html.")||d.metadata&&1==d.metadata.htmlContent)&&f.push(a)})}var f=[],d=this;a=this.container||this.domNode;a.containerNode&&null==this.domNode.render&&(a=a.containerNode);this.domNode&&null!=this.domNode.render&&(a=this.domNode);var c=e("davinci/ve/widget");a&&(b(a),0==f.length&&this.domNode.containerNode&&b(this.domNode.containerNode));return d.metadata&&d.metadata.noChildren?[]:f},getChildren:function(a){var b=
this.getHelper();return b&&b.getChildren?b.getChildren(this,a):this._getChildren(a)},constructor:function(a,b,f,d,c){this.acceptsHTMLChildren=!0},buildRendering:function(){this.containerNode=this.domNode;if(this._params){for(var a in this._params)this.domNode.setAttribute(a,this._params[a]);this._params=void 0}},_getChildrenData:function(a){var b=this.domNode;if(!b.hasChildNodes())return null;if(b&&b.getChildrenData)return b.getChildrenData();var b=[],f=this.domNode.childNodes,d=e("davinci/ve/widget");
this.metadata&&this.metadata.noChildren&&(f=[]);for(var c=0;c<f.length;c++){var k=f[c],h;switch(k.nodeType){case 1:if((k=d.byNode(k))&&k.type&&-1!==k.type.indexOf("html.")&&!0!==this.metadata.htmlContent)break;if(this.metadata&&this.metadata.ignore&&k.type&&-1!==this.metadata.ignore.indexOf(k.type))break;k&&(h=k.getData(a));break;case 3:(h=k.nodeValue.trim())&&(a.serialize||!0===this.metadata.htmlContent)&&(h=davinci.html.escapeXml(h));break;case 8:h="\x3c!--"+k.nodeValue+"--\x3e"}(h&&h.type&&-1==
h.type.indexOf("html.")||h&&!0===this.metadata.htmlContent)&&b.push(h)}return 0===b.length?void 0:b},_getPropertyValue:function(a){if(this.domNode._get){var b=this.domNode._get(a);null==b&&(b=this.domNode.getAttribute(a));return b}if(this.containerNode&&a in this.containerNode)return this.containerNode[a]},setProperties:function(a){var b=this.domNode,f;for(f in a)"style"===f?dojo.style(b,a[f]):a[f]?(b[f]=a[f],b._set&&b._set(f,a[f]),dojo.attr(b,f,a[f])):b.removeAttribute(f);this.inherited(arguments)},
_attr:function(a,b){},getTagName:function(){return this.domNode.nodeName.toLowerCase()},getParent:function(){if("xblox/RunScript"==this.type){var a=this.domNode;if(a&&a._targetReference&&a._targetReference._dvWidget)return a._targetReference._dvWidget}return this.inherited(arguments)}});p.fixType=a;return p})},"davinci/ve/HTMLWidget":function(){define(["dojo/_base/declare","./_Widget"],function(p,m){return p("davinci.ve.HTMLWidget",m,{isHtmlWidget:!0,addHTMLClasses:!0,constructor:function(h,e,b){this.type=
"html."+e.tagName.toLowerCase();this.acceptsHTMLChildren=!0;null!=b&&(this.addHTMLClasses=b)},buildRendering:function(){this.containerNode=this.domNode;if(this._params){for(var h in this._params)this.domNode.setAttribute(h,this._params[h]);this._params=void 0}try{!1!==this.addHTMLClasses&&dojo.addClass(this.domNode,"HtmlWidget")}catch(e){}},_getChildrenData:function(h){function e(a){(a=a.nodeValue.trim())&&(a=davinci.html.escapeXml(a));return a}var b=this.domNode;if(!b.hasChildNodes())return null;
if(1===b.childNodes.length&&3===b.firstChild.nodeType)return e(b.firstChild);var k=[];dojo.forEach(b.childNodes,function(a){var b;switch(a.nodeType){case 1:(a=require("davinci/ve/widget").byNode(a))&&(b=a.getData(h));break;case 3:b=e(a);break;case 8:b="\x3c!--"+a.nodeValue+"--\x3e"}b&&k.push(b)});return k},setProperties:function(h,e){var b=this.domNode;e=e||!1;for(var k in h)if("style"===k)dojo.style(b,h[k]);else if(!e){var a=h[k];a||"boolean"==typeof a||"number"==typeof a?b.setAttribute(k,a):b.removeAttribute(k)}this.inherited(arguments)},
resize:function(){this.getChildren().forEach(function(h){h.resize&&h.resize()})},_attr:function(h,e){if(1<arguments.length)this.domNode[h]=e;else return this.domNode[h]},getTagName:function(){return this.domNode.nodeName.toLowerCase()}})})},"davinci/ve/ObjectWidget":function(){define(["dojo/_base/declare","dojo/dom-attr","./_Widget"],function(p,m,h){return p("davinci.ve.ObjectWidget",h,{isObjectWidget:!0,constructor:function(e,b,k,a,g){"string"===typeof k&&(m.set(b,"data-dojo-type",k),g&&g.addAttribute("data-dojo-type",
k))},postCreate:function(){var e=this._params.jsId,b=require("davinci/ve/widget")._dojo(this.domNode),k;if(e){if(m.set(this.domNode,"jsId",e),k=this.getObjectType())if(k=b.getObject(k.replace(/\//g,".")))if(k=k.markupFactory?k.markupFactory(this._params,this.domNode,k):k.prototype&&k.prototype.markupFactory?k.prototype.markupFactory(this._params,this.domNode,k):new k(this._params,this.domNode))k._edit_object_id=e,b.setObject(e,k)}else if(e=this.getObjectId())if(k=b.getObject(e))k._edit_object_id=
e},getObjectType:function(){var e=this.domNode,e=m.get(e,"data-dojo-type")||m.get(e,"dojoType");return e=e.replace(/\./g,"/")},getObjectId:function(){return m.get(this.domNode,"jsId")},_getChildren:function(){return[]}})})},"davinci/ve/commands/StyleCommand":function(){define(["dojo/_base/declare","davinci/ve/widget","davinci/ve/utils/StyleArray"],function(p,m,h){return p("davinci.ve.commands.StyleCommand",null,{name:"style",constructor:function(e,b,k){this._newValues=b;this._id=e?e.id:void 0;this._applyToStateIndex=
k&&"Normal"!=k&&"undefined"!=k?k:"undefined"},add:function(e){e&&e._id==this._id&&e._newValues&&dojo.mixin(this._newValues,e._newValues)},execute:function(e,b){if(this._id&&this._newValues){var k=require("davinci/ve/widget").byId(this._id);if(k&&k.domNode){var a=require("davinci/ve/States"),g=k.getStyleValuesAllStates();this._oldStyleValuesAllStates=dojo.clone(g);g[this._applyToStateIndex]=g[this._applyToStateIndex]?h.mergeStyleArrays(g[this._applyToStateIndex],this._newValues):this._newValues;for(var n=
g[this._applyToStateIndex],f=n.length-1;0<=f;f--){var d=n[f],c=!1,q;for(q in d)"$MAQ_DELETE_PROPERTY$"==d[q]?delete d[q]:c=!0;c||n.splice(f,1)}k.setStyleValuesAllStates(g);n=a.getStatesListCurrent(k.domNode);d=h.mergeStyleArrays([],g.undefined);for(f=0;f<n.length;f++)g[n[f]]&&(d=h.mergeStyleArrays(d,g[n[f]]));k.setStyleValuesCanvas(d);k.setStyleValuesModel(g.undefined);k.refresh();a.resetState(k.domNode);!0!==b&&dojo.publish("/davinci/ui/widgetPropertiesChanged",[[k]])}}},undo:function(){if(this._id&&
this._oldStyleValuesAllStates){var e=require("davinci/ve/widget").byId(this._id);if(e){require("davinci/ve/States");var b=this._oldStyleValuesAllStates,k=this._applyToStateIndex;e.setStyleValuesAllStates(b);b=h.mergeStyleArrays(b.undefined,b[k]);e.setStyleValuesCanvas(b);e.setStyleValuesModel(this._oldStyleValuesAllStates.undefined);e.refresh();require("davinci/ve/States").resetState(e.domNode);dojo.publish("/davinci/ui/widgetPropertiesChanged",[[e]])}}}})})},"davinci/review/actions/CloseVersionAction":function(){define(["dojo/_base/declare",
"./_ReviewNavigatorCommon","davinci/Runtime","dojo/i18n!./nls/actions"],function(p,m,h,e){return p("davinci.review.actions.CloseVersionAction",[m],{run:function(b){if((b=this._getSelection(b))&&b.length&&(okToClose=confirm(e.areYouSureClose))){var k="ReviewFile"==b[0].resource.elementType?b[0].resource.parent:b[0].resource;dojo.xhrGet({url:"cmd/managerVersion",sync:!1,handleAs:"text",content:{type:"close",vTime:k.timeStamp}}).then(function(a){"OK"==a&&("undefined"==typeof hasToaster&&(new Toaster({position:"br-left",
duration:4E3,messageTopic:"/davinci/review/resourceChanged"}),hasToaster=!0),dojo.publish("/davinci/review/resourceChanged",[{message:e.closeSuccessful,type:"message"},"closed",k]))})}},isEnabled:function(b){b=this._getSelection(b);if(!b||0==b.length)return!1;b="ReviewFile"==b[0].resource.elementType?b[0].resource.parent:b[0].resource;return b.designerId!=h.userName||b.closed||b.isDraft?!1:!0}})})},"davinci/review/actions/_ReviewNavigatorCommon":function(){define(["dojo/_base/declare","davinci/actions/Action"],
function(p,m){return p("davinci.review.actions._ReviewNavigatorCommon",[m],{_getSelection:function(h){var e=null;return e=h.getSelection?h.getSelection():dijit.byId("davinci.review.reviewNavigator").getSelection()},shouldShow:function(h){return!0}})})},"davinci/actions/Action":function(){define(["dojo/_base/declare"],function(p){return p("davinci.actions.Action",null,{item:null,run:function(m){},isEnabled:function(m){return!0},getName:function(){return this.item.label}})})},"davinci/review/actions/EditVersionAction":function(){define(["dojo/_base/declare",
"./_ReviewNavigatorCommon","./PublishAction","../../Runtime","dojo/i18n!./nls/actions"],function(p,m,h,e,b){return p("davinci.review.actions.EditVersionAction",[m],{run:function(b){(b=this._getSelection(b))&&b.length&&(new h("ReviewFile"==b[0].resource.elementType?b[0].resource.parent:b[0].resource)).run()},isEnabled:function(b){return(b=this._getSelection(b))&&0<b.length&&("ReviewFile"==b[0].resource.elementType?b[0].resource.parent:b[0].resource).designerId==e.userName?!0:!1}})})},"davinci/review/actions/PublishAction":function(){define("dojo/_base/declare davinci/actions/Action davinci/review/widgets/PublishWizard davinci/Runtime davinci/ui/Dialog dojo/i18n!./nls/actions".split(" "),
function(p,m,h,e,b,k){return p("davinci.review.actions.PublishAction",[m],{constructor:function(a,b){this.node=a;this.isRestart=b;a&&a.isRestart&&(this.isRestart=!0)},run:function(){var a=this.publishWizard=new h;this.dialog=new b({contentStyle:{width:650,height:350},title:this.node?k.editReview:k.newReview,onCancel:dojo.hitch(this,this.close),onHide:dojo.hitch(this,this.hide)});this.dialog.setContent(a);this.dialog.show();dojo.connect(a,"onClose",this,this.close);a.initData(this.node,this.isRestart).then(function(){a.updateSubmit();
a.reviewerStackContainer.resize()})},hide:function(){this.dialog.destroyRecursive()},close:function(){this.dialog.hide()}})})},"davinci/review/widgets/PublishWizard":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/layout/StackContainer dijit/layout/ContentPane dijit/form/SimpleTextarea dijit/form/NumberTextBox dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/Button dijit/form/ComboBox dojo/data/ItemFileWriteStore dijit/form/CheckBox dojox/grid/DataGrid dojox/data/QueryReadStore dojox/validate/regexp dojo/_base/xhr dojo/string dojo/fx dojo/date/stamp dijit/Tree dojo/Deferred dojo/promise/all system/resource davinci/Runtime davinci/Workbench davinci/model/resource/Folder davinci/model/resource/File davinci/review/model/resource/Empty davinci/review/model/resource/root dijit/tree/TreeStoreModel davinci/review/model/store/GeneralReviewReadStore dojo/i18n!./nls/widgets dojo/i18n!dijit/nls/common dojo/text!./templates/PublishWizard.html dojo/text!./templates/MailFailureDialogContent.html".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y,B,x,w,v,A,C,L,E,I,D,G,N,M,K,F,J,H,P,R,O){var Q=p(dijit._TreeNode,{postCreate:function(){this.inherited(arguments);var a=dojo.create("img",{src:"app/dojo/resources/blank.gif","class":"deleteImg"});dojo.connect(a,"onclick",this,dojo.hitch(this,function(){dojo.publish("/davinci/review/deleteReviewFile",[this.item])}));dojo.place(a,this.rowNode,"first");dojo.style(this.rowNode,{width:"99%"});dojo.style(this.containerNode,{display:"block"})}}),V=p(A,{_createTreeNode:function(a){return new Q(a)}});
return p("davinci.review.widgets.PublishWizard",[m,h],{templateString:R,postMixInProperties:function(){this.inherited(arguments);dojo.mixin(this,H);dojo.mixin(this,P)},postCreate:function(){var a=this.reviewerStackContainer=new b({},this.reviewerStackContainer),c=this.page1=new k({style:"overflow:hidden;"}),d=this.page2=new k({style:"overflow:hidden;"}),f=this.page3=new k({style:"overflow:hidden;"});this.reviewerStackContainer.addChild(c);this.reviewerStackContainer.addChild(d);this.reviewerStackContainer.addChild(f);
this._initPage1();this._initPage2();this._initPage3();this._initButtons();dojo.place(this.page1Node,c.domNode);dojo.place(this.page2Node,d.domNode);dojo.place(this.page3Node,f.domNode);a.startup();this._subs=[dojo.subscribe(a.id+"-selectChild",dojo.hitch(this,this._onPageSelected)),dojo.subscribe("/davinci/review/publish/valueChanged",dojo.hitch(this,this.updateSubmit)),dojo.subscribe("/davinci/review/deleteReviewFile",dojo.hitch(this,this.delFiles)),dojo.subscribe("/davinci/review/deleteReviewer",
dojo.hitch(this,this.delRow))]},_initPage1:function(){this.versionTitle=new n({onChange:this._onValueChange,required:!0},this.versionTitle);this.receiveEmail=new u({checked:!0},this.receiveEmail);this.descriptions=new a({style:"width:460px;height:100px;font-family:Verdana, Arial, Helvetica, sans-serif;font-size:100%;"},this.descriptions);this.desireWidth=new g({constraints:{min:0,places:0},value:1024,style:"width:85px"},this.desireWidth);this.desireHeight=new g({constraints:{min:0,places:0},value:768,
style:"width:85px"},this.desireHeight);var c=new Date;this.dueDate=new f({onChange:this._onValueChange,type:"text",constraints:{min:new Date(c.getFullYear(),c.getMonth(),c.getDate())}},this.dueDate)},_initPage2:function(){this.fileIndex=1;this.reviewFiles=[];var a=this.sourceTreeModel=new F({deferItemLoadingUntilExpand:!0,store:new J({root:new G(D.getProject(),null),getLabel:function(a){var c=a.getName();a.link&&(c=c+"  ["+a.link+"]");return c}})}),a=this.sourceTree=new A({id:"reviewWizardSourceTree",
persist:!1,showRoot:!1,model:a,labelAttr:"name",getIconClass:dojo.hitch(this,this._getIconClass),isMultiSelect:!0,onDblClick:dojo.hitch(this,function(a){this.addFiles([a])}),transforms:[function(a){return a.sort(function(a,c){a=a.name.toLowerCase();c=c.name.toLowerCase();return a<c?-1:a>c?1:0})}]});this.sourceTreeNode.appendChild(a.domNode);a.startup();a=this.targetTreeModel=new F({store:new J({root:new M,getLabel:function(a){var c=a.getName();a.link&&(c=c+"  ["+a.link+"]");return c}})});a=this.targetTree=
new V({id:"reviewWizardTargetTree",showRoot:!1,model:a,labelAttr:"name",getIconClass:dojo.hitch(this,this._getIconClass),isMultiSelect:!0});this.targetTreeNode.appendChild(a.domNode);a.startup()},_initPage3:function(){var a=function(a){this.photoRepositoryUrl||(this.photoRepositoryUrl=I.serverJSONRequest({url:"cmd/getBluePageInfo",handleAs:"text",content:{type:"photo"},sync:!0}));if(""===this.photoRepositoryUrl||"not-implemented"==this.photoRepositoryUrl)this.photoRepositoryUrl="app/davinci/review/resources/img/profileNoPhoto.gif?";
return'\x3cimg src\x3d"'+this.photoRepositoryUrl+a+'" width\x3d"35px" height\x3d"35px" alt\x3d"User Photo"\x3e\x3c/img\x3e'}.bind(this),a=[{cells:[{name:H.user,field:"email",formatter:a,width:"70px",styles:"text-align: center;"},{name:H.emailAddress,field:"displayName",width:"320px"},{name:H.action,field:"action",formatter:function(a){return'\x3ca href\x3d"javascript:dojo.publish(\'/davinci/review/deleteReviewer\',[])"\x3e\x3cimg class\x3d"delImg" src\x3d"app/davinci/review/resources/img/del.gif"/\x3e\x3c/a\x3e'},
width:"70px",styles:"text-align: center;"}]}],b={identifier:"email",label:"name",items:[]};this.userData=b.items;var f=new q({data:b});this.jsonStore=f;this.grid=a=new r({elasticView:"1",store:f,structure:a,style:"height:100%;width:100%;",canSort:function(a){return 1==a?!1:!0},canResize:function(){return!1},delRow:function(a){this.removeSelectedRows();f.save()}});this.userGrid.appendChild(a.domNode);a.startup();this.addReviewerButton=new d({disabled:!0,onClick:dojo.hitch(this,this.addReviewer),label:"\x3cdiv style\x3d'width:75px;height:10px;margin:-6px 0 0 0'\x3e"+
H.add+"\x3c/div\x3e"},this.addReviewerButton);a=new z({url:"cmd/getBluePageInfo",fetch:function(a){var c=a.query.displayName,c=c.substring(0,c.length-1);a.serverQuery={searchname:c};return this.inherited("fetch",arguments)}});this.addReviewerCombox=new c({regExpGen:dojo.hitch(this,this._emailAddress),required:!0,store:a,searchAttr:"displayName",name:"displayName",autoComplete:!1,hasDownArrow:!1,highlightMatch:"all",style:"width:220px",onChange:dojo.hitch(this,this._reviewerComboxValueChanged),onKeyUp:dojo.hitch(this,
this._updateAddButton),pageSize:10,searchDelay:500,placeHolder:H.enterNameOrEmail},this.addReviewerCombox)},_emailAddress:function(a){if(this.addReviewerCombox.item)return".*";a="object"==typeof a?a:{};"boolean"!=typeof a.allowCruft&&(a.allowCruft=!1);a.allowPort=!1;var c="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+y.host(a);a.allowCruft&&(c="\x3c?(mailto\\:)?"+c+"\x3e?");return c},_initButtons:function(){this.invite=new d({disabled:!0,onClick:dojo.hitch(this,function(){this.publish()})},
this.invite);this.next=new d({onClick:dojo.hitch(this,function(){this.reviewerStackContainer.forward()})},this.next);this.prev=new d({onClick:dojo.hitch(this,function(){this.reviewerStackContainer.back()})},this.prev);this.saveDt=new d({onClick:dojo.hitch(this,function(){this.publish(!0)})},this.saveDt)},_reviewerComboxValueChanged:function(){this.addReviewerCombox.item&&this.addReviewer()},_updateAddButton:function(a){var c=this.addReviewerCombox.isValid();this.addReviewerButton.set("disabled",!c);
13==a.keyCode&&c&&this.addReviewer()},delRow:function(){this.grid.delRow();dojo.publish("/davinci/review/publish/valueChanged")},addReviewer:function(){var a=this.addReviewerCombox.item,c,d,b;a?(c=this.addReviewerCombox.value.split(",").join(""),d=a.i.emailaddress,b=a.i.name,b=b.split(",").join("")):b=d=c=this.addReviewerCombox.get("value");this.jsonStore.fetchItemByIdentity({identity:d,onItem:function(c){a=c}});var f=this.grid;a?(c=f.getItemIndex(a),f.scrollToRow(c),f=f.getRowNode(c),dojo.fx.chain([dojo.fadeOut({node:f,
duration:300}),dojo.fadeIn({node:f,duration:700}),dojo.fadeOut({node:f,duration:300}),dojo.fadeIn({node:f,duration:700})]).play(),f.removeAttribute("style")):(this.jsonStore.newItem({name:b,email:d,displayName:c}),f.scrollToRow(f.get("rowCount")),this.addReviewerCombox.item=null,this.addReviewerCombox.reset(),this.addReviewerButton.set("disabled",!0),dojo.publish("/davinci/review/publish/valueChanged"))},_onValueChange:function(){dojo.publish("/davinci/review/publish/valueChanged")},_onPageSelected:function(a){this.prev.set("disabled",
a.isFirstChild);this.next.set("disabled",a.isLastChild);dojo.removeClass(this.navPage1,"current");dojo.removeClass(this.navPage2,"current");dojo.removeClass(this.navPage3,"current");a==this.page1&&dojo.addClass(this.navPage1,"current");a==this.page2&&dojo.addClass(this.navPage2,"current");a==this.page3&&dojo.addClass(this.navPage3,"current")},updateSubmit:function(){var a=this.versionTitle.isValid()&&this.dueDate.isValid(),c=this.reviewFiles&&0<this.reviewFiles.length,d=0<this.userData.length;dojo.removeClass(this.navPage1Icon,
a?"todo":"done");dojo.addClass(this.navPage1Icon,a?"done":"todo");dojo.removeClass(this.navPage2Icon,c?"todo":"done");dojo.addClass(this.navPage2Icon,c?"done":"todo");dojo.removeClass(this.navPage3Icon,d?"todo":"done");dojo.addClass(this.navPage3Icon,d?"done":"todo");this.invite.set("disabled",!(a&&c&&d));a="";d||(a=H.noReviewersSelected);c||(a=H.noFilesSelected);this.dueDate.isValid()||(a=H.dueDateIncorrect);this.versionTitle.isValid()||(a=H.titleRequired);this.reviewMsg.innerHTML=a},select:function(a){a=
a.target;var c=this.reviewerStackContainer;a==this.navPage1||a==this.navPage1Icon?c.selectChild(this.page1,!0):a==this.navPage2||a==this.navPage2Icon?c.selectChild(this.page2,!0):a!=this.navPage3&&a!=this.navPage3Icon||c.selectChild(this.page3,!0)},update:function(){var a=this.targetTreeModel;a.onChildrenChange(a.root,a.root.children)},containReviewFile:function(a){return(this.reviewFiles||[]).some(function(c){return isNaN(a)?c==a:c.index==a})},getChildrenFiles:function(a){var c=this.reviewFiles||
[],d=this.targetTreeModel;"File"==a.elementType?this.containReviewFile(a)||(a.index=this.fileIndex++,c.push(a),c=new N(a.name,d.root),c.index=a.index,d.root.children.push(c)):"Folder"==a.elementType&&a.getChildren(function(a){dojo.forEach(a,dojo.hitch(this,function(a){"File"==a.elementType&&this.getChildrenFiles(a)}.bind(this)))}.bind(this))},addSelectFiles:function(){var a=this.sourceTree.get("selectedItems");this.addFiles(a)},addFiles:function(a){var c=this.sourceTree.get("selectedItems");a&&(c=
a);dojo.forEach(c,this.getChildrenFiles,this);this.update();dojo.publish("/davinci/review/publish/valueChanged")},delFiles:function(a){var c=this.reviewFiles,d=this.targetTree.get("selectedItems");a&&(d=[a]);dojo.forEach(d,dojo.hitch(this,function(a){if(a.index){var d,b;for(b=0;b<c.length;b++)if(a.index==c[b].index){d=c[b];c.splice(b,1);break}if(d){var f=a.parent.children;for(b=0;b<f.length;b++)if(a==f[b]){a.parent.children.splice(b,1);break}this.update(d)}}}));dojo.publish("/davinci/review/publish/valueChanged")},
_getIconClass:function(a,c){if("Folder"==a.elementType)return c?"dijitFolderOpened":"dijitFolderClosed";if("File"==a.elementType){var d,b=a.getExtension(),f=I.getExtension("davinci.fileType",function(a){return a.extension==b});f&&(d=f.iconClass);return d||"dijitLeaf"}return"dijitLeaf"},initData:function(a,c){var d=new C;this.node=a;this.isRestart=c;a||B.get({url:"cmd/getLatestVersionId"}).then(function(a){this.versionTitle.set("value",dojo.string.substitute(H.defaultReviewTitle,[a]))}.bind(this));
if(a){var b=a.name;c&&(b+=" (R)");this.versionTitle.set("value",b);this.isRestart||this.dueDate.set("value","infinite"==a.dueDate?new Date(""):a.dueDate);this.desireWidth.set("value",0===a.width?"":a.width);this.desireHeight.set("value",0===a.height?"":a.height);a.description&&this.descriptions.set("value",a.description);this.receiveEmail.set("value",a.receiveEmail);a.getChildren(function(c){dojo.forEach(c,function(a){a=E.findResource(a.name);null!=a&&this.addFiles([a])}.bind(this));for(c=0;c<a.reviewers.length;c++)if(a.reviewers[c].email!=
a.designerEmail){var b=I.getUserDisplayNamePlusEmail({email:a.reviewers[c].email,userId:a.reviewers[c].name});this.jsonStore.newItem({name:a.reviewers[c].name,email:a.reviewers[c].email,displayName:b})}d.resolve()}.bind(this))}else d.resolve();return d},publish:function(a){var c=this.userData.map(function(a){return a.email}).join(","),d=this.descriptions.value,b=this.versionTitle.value,f=this.dueDate.get("value"),f=f?v.toISOString(f,{zulu:!0}):"infinite",g=this.desireWidth.value||0,n=this.desireHeight.value||
0,k=dojo.map(this.reviewFiles,function(a){a=a.getPath();2<a.length&&0==a.indexOf("./")&&(a=a.substring(2));return a}),e="on"==this.receiveEmail.get("value")?"true":"false",c={isUpdate:this.node&&!this.isRestart,isRestart:this.isRestart,vTime:this.node?this.node.timeStamp:null,emails:c,message:d,versionTitle:b,resources:k,desireWidth:g,desireHeight:n,savingDraft:a,dueDate:f,receiveEmail:e};I.currentEditor&&I.currentEditor.getContext&&I.currentEditor.getContext().getPreference("zazl")&&(c.zazl=!0);
c=dojo.objectToQuery(c);B.post({url:"cmd/publish?"+c,handleAs:"json"}).then(function(c){"undefined"==typeof hasToaster&&(new Toaster({position:"br-left",duration:4E3,messageTopic:"/davinci/review/resourceChanged"}),hasToaster=!0);0<c.length&&(c=c[0],"OK"==c.result&&(a?dojo.publish("/davinci/review/resourceChanged",[{message:H.draftSaved,type:"message"},"draft",this.node]):c.emailResult&&("OK"==c.emailResult?dojo.publish("/davinci/review/resourceChanged",[{message:H.inviteSuccessful,type:"message"},
"create",this.node]):(c=x.substitute(O,{htmlContent:c.emailResult,inviteNotSent:H.inviteNotSent,mailFailureMsg:H.mailFailureMsg}),dojo.publish("/davinci/review/resourceChanged",[{message:H.inviteFailed,type:"warning"},"create",this.node]),D.showMessage(H.warning,c)))))}.bind(this)).otherwise(function(a){var c=a.responseText,c=c.substring(c.indexOf("\x3ctitle\x3e")+7,c.indexOf("\x3c/title\x3e"));I.handleError(x.substitute(H.errorPublish,[a,c]))});this.onClose()},onClose:function(){},destroy:function(){this.inherited(arguments);
this._subs.forEach(dojo.unsubscribe);delete this._subs;this.sourceTree.destroyRecursive();this.targetTree.destroyRecursive()}})})},"davinci/model/resource/Folder":function(){define(["dojo/_base/declare","dojo/_base/xhr","davinci/Runtime","davinci/model/resource/Resource","davinci/model/resource/File"],function(p,m,h,e,b){var k=p("davinci.model.resource.Folder",e,{serviceClass:"XIDE_Directory_Service",workspaceMount:"/ws/",constructor:function(a,b){this.elementType="Folder";this.name=a;this.parent=
b},reload:function(){this._isLoaded=!1},createResource:function(a,g,n,f){var d;null!=a?d=g?new k(a,this):new b(a,this):(d=this,g="Folder"==this.elementType);var c=this;if(!n){n=""+this.getPath();"."==n&&(n=""+this.workspaceMount);n=n.replace("./",this.workspaceMount);n=this.serviceClass;g=g?"mkDir":"mkFile";if(!this.serviceObject[n][g])return console.error("_createResource : server doesnt support :"+g),this;this.serviceObject[n][g](this.workspaceMount,d.getPath()).then(function(b){if(!0===b&&null!=
a||"The file already exists"===b)return c.children.push(d),delete d.libraryId,delete d.libVersion,delete d._readOnly,dojo.publish("/davinci/resource/resourceChanged",["created",d]),f&&f(d),d;if("OK"!=b)throw"Folder.createResource failed: name\x3d"+a+"response\x3d"+b;delete d.libraryId;delete d.libVersion;delete d._readOnly;f(c);if(!f)debugger})}},getChildren2:function(a,b){if(this._isLoaded)a(this.children);else if(this._loadingCallbacks)this._loadingCallbacks.push(a);else{this._loadingCallbacks=
[];this._loadingCallbacks.push(a);var n=""+this.getPath();"."==n&&(n="/ws/");var f=this.serviceClass;if(!this.serviceObject)debugger;if(!this.serviceObject[f])debugger;this.serviceObject.sync=!0;this.serviceObject[f].ls(this.workspaceMount,n).then(function(a){this.setChildrenSync(a);dojo.forEach(this._loadingCallbacks,function(a){a(this.children)},this);delete this._loadingCallbacks}.bind(this),b)}},getChildren:function(a,b){if(this._isLoaded)a.call(null,this.children);else if(this._loading)this._loading.then(function(){a.call(null,
this.children)}.bind(this),b);else{console.error("list files : "+this.getPath());var n=""+this.getPath();"."==n&&(n="/ws/");n=n.replace("./",this.workspaceMount);this.serviceObject[this.serviceClass].ls(n).then(function(b){this.setChildren(b);this._isLoaded=!0;a.call(null,this.children);delete this._loading}.bind(this),b)}},getChildrenSync:function(a,b){if(this._isLoaded)a(this.children);else if(this._loadingCallbacks)this._loadingCallbacks.push(a);else{this._loadingCallbacks=[];this._loadingCallbacks.push(a);
console.error("list files : "+this.getPath());var n=this.getPath();"./project1"===n&&console.error("gotcha");n=""+n;"."==n&&(n="/ws/");n=n.replace("./","/ws/");h.serverJSONRequest({url:"cmd/listFiles.php",content:{path:this.getPath(),basePath:"./"},sync:b,load:dojo.hitch(this,function(a,d){this.setChildrenSync(a);dojo.forEach(this._loadingCallbacks,function(a){a(this.children)},this);delete this._loadingCallbacks})})}},setChildren:function(a){this.children=[];this._appendFiles(a)},setChildrenSync:function(a){this.children=
[];this._appendFiles(a,!0)},_appendFiles:function(a,g){a.forEach(function(a){var f=g?this.getChildSync(a.name):this._getChild(a.name),d=null!=f;a.isDir||a.isLib?(d||(f=new k(a.name,this)),a.isLib&&(f.isLibrary=!0)):d||(f=new b(a.name,this));f.link=a.link;f.isNew=a.isNew;f._readOnly=a.readOnly;f.setDirty(a.isDirty);a.libraryId&&(f.libraryId=a.libraryId,f.libVersion=a.libVersion);d||this.children.push(f)},this);this._isLoaded=!0},getMarkers:function(a,b){var k=[];this.visit({visit:function(f){if("File"==
f.elementType)markers=f.getMarkers(a),k.concat(markers);else if(!b)return!0}},!0);return k},getChildSync:function(a){if(!this._isLoaded||1>this.children.length)this._isLoaded=!1,this.getChildrenSync(function(a){this.children=a},!0);return this._getChild(a)},getChild:function(a){if(!this._isLoaded||1>this.children.length)this._isLoaded=!1,this.getChildren2(function(a){this.children=a},!0);return this._getChild(a)},_getChild:function(a){if(!this.__CASE_SENSITIVE){if(!a||null==a.toLowerCase)debugger;
a=a.toLowerCase()}var b;this.children.some(function(k){var f=k.getName();this.__CASE_SENSITIVE||(f=f.toLowerCase());(f=f==a)&&(b=k);return f});return b}});return k})},"davinci/review/model/resource/Empty":function(){define(["dojo/_base/declare","davinci/model/resource/Resource"],function(p,m){return p("davinci.review.model.resource.Empty",m,{constructor:function(h){this.elementType="Folder";this.name="root";this.parent=null},getChildren:function(){return this.children}})})},"davinci/review/model/store/GeneralReviewReadStore":function(){define(["dojo/_base/declare"],
function(p){return p("davinci.review.model.store.GeneralReviewReadStore",null,{constructor:function(m){dojo.mixin(this,m);this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadedItems=[]},getFeatures:function(){return this._features},getIdentity:function(m){return m.getPath()},fetchItemByIdentity:function(m){var h;if(m.identity&&this.isItemLoaded(m.identity))dojo.some(this._loadedItems,function(e){if(m.identity==this.getIdentity(e))return h=e,!0},this),h&&m.onItem&&m.onItem.call(m.scope?
m.scope:dojo.global,h);else throw Error("GeneralReviewReadStore: The item cannot be found or it is not loaded!");},getValue:function(m,h,e){m=this.getValues(m,h);if(0<m.length)return m[0]},getValues:function(m,h){var e=[];m[h]&&(0<=m[h].length?e=e.concat(m[h]):e.push(m[h]));return e},isItem:function(m){if("string"==typeof m)return dojo.some(this._loadedItems,function(h){if(m==this.getIdentity(h))return!0},this);if(m)return"undefined"!=typeof m.r&&m.r===this},isItemLoaded:function(m){var h=this.isItem(m);
h&&"object"==typeof m&&(h=m.isLoaded);return h},loadItem:function(m){var h=m.item;if(h){var e=this;h.getChildren(function(b){var k=m.scope?m.scope:dojo.global;e._loadedItems=e._loadedItems.concat(b);h.children=b;h.isLoaded=!0;dojo.forEach(b,function(a){a.r=e});m.onItem&&m.onItem.call(k,h)},!0)}},fetch:function(m){if(m.onComplete){var h=m.scope?m.scope:dojo.global;this.root.r=this;this._loadedItems.push(this.root);this.loadItem({item:this.root});m.onComplete.call(h,[this.root])}return m},close:function(m){this._loadedItems.length=
0},getLabel:function(m){throw Error("GeneralReviewReadStore: getLabel method is abstract!");},hasAttribute:function(m,h){return this.isItem(m)&&("children"==h?"Folder"==m.elementType:typeof m[h])}})})},"davinci/review/actions/OpenVersionAction":function(){define(["dojo/_base/declare","./_ReviewNavigatorCommon","davinci/Runtime","dojo/i18n!./nls/actions"],function(p,m,h,e){return p("davinci.review.actions.OpenVersionAction",[m],{run:function(b){if((b=this._getSelection(b))&&b.length){var k="ReviewFile"==
b[0].resource.elementType?b[0].resource.parent:b[0].resource;dojo.xhrGet({url:"cmd/managerVersion",sync:!1,handleAs:"text",content:{type:"open",vTime:k.timeStamp}}).then(function(a){"OK"==a&&("undefined"==typeof hasToaster&&(new Toaster({position:"br-left",duration:4E3,messageTopic:"/davinci/review/resourceChanged"}),hasToaster=!0),dojo.publish("/davinci/review/resourceChanged",[{message:e.openSuccessful,type:"message"},"open",k]))})}},isEnabled:function(b){b=this._getSelection(b);if(!b||0==b.length)return!1;
b="ReviewFile"==b[0].resource.elementType?b[0].resource.parent:b[0].resource;return b.designerId==h.userName&&b.closed&&b.closedManual&&!b.isDraft?!0:!1}})})},"davinci/ui/widgets/TransformTreeMixin":function(){define("davinci/ui/widgets/TransformTreeMixin",["dijit/Tree"],function(p){var m=dijit.Tree.prototype.postCreate;dijit.Tree.prototype.postCreate=function(){var h=dijit.Tree.prototype._onItemChildrenChange;dijit.Tree.prototype._onItemChildrenChange=function(b,k){this.transforms&&this.transforms.forEach(function(a){k=
a(k)});h.apply(this,[b,k])};var e=this.model.getChildren;this.model.getChildren=dojo.hitch(this,function(b,k,a){var g=k;this.transforms&&(g=dojo.hitch(this,function(a){this.transforms.forEach(function(b){a=b(a)});k(a)}));e.apply(this.model,[b,g,a])});m.apply(this)}})},"davinci/ui/ThemeSetsDialog":function(){define("dojo/_base/declare davinci/ui/Dialog dijit/_Widget dijit/_Templated davinci/workbench/Preferences davinci/Workbench davinci/library dojo/text!./templates/ThemeSetsDialog.html dojo/text!./templates/ThemeSetsRenameDialog.html dojo/i18n!davinci/ui/nls/ui dojo/i18n!dijit/nls/common davinci/Theme dijit/form/ValidationTextBox dijit/form/Button dijit/Toolbar".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c){p("davinci.ui.ThemeSetsDialogWidget",[h,e],{templateString:g,widgetsInTemplate:!0,uiNLS:f,commonNLS:d});p("davinci.ui.ThemeSetsDialogRenameWidget",[h,e],{templateString:n,widgetsInTemplate:!0,uiNLS:f,commonNLS:d});return dojo.declare("davinci.ui.ThemeSetsDialog",null,{constructor:function(){this._connections=[];this._dialog=new m({id:"manageThemeSets",title:f.themeSetsDialog,contentStyle:{width:580}});dojo.connect(this._dialog,"onCancel",this,"onClose");this._dojoThemeSets=
c.getThemeSets(k.getProject());this._dojoThemeSets||(this._dojoThemeSets=c.dojoThemeSets,c.saveThemeSets(k.getProject(),this._dojoThemeSets));this._dojoThemeSets.themeSets[0]||(this._dojoThemeSets.themeSets.push(dojo.clone(c.custom_themeset)),c.saveThemeSets(k.getProject(),this._dojoThemeSets));this._dojoThemeSets=dojo.clone(this._dojoThemeSets);this._dialog.attr("content",new davinci.ui.ThemeSetsDialogWidget({}));this._connections.push(dojo.connect(dojo.byId("theme_select_themeset_theme_select"),
"onchange",this,"onChange"));this._connections.push(dojo.connect(dijit.byId("theme_select_themeset_add"),"onClick",this,"addThemeSet"));this._connections.push(dojo.connect(dijit.byId("theme_select_themeset_delete"),"onClick",this,"deleteThemeSet"));this._connections.push(dojo.connect(dijit.byId("theme_select_rename_button"),"onClick",this,"renameThemeSet"));this._connections.push(dojo.connect(dijit.byId("theme_select_desktop_theme_select"),"onChange",this,"onDesktopChange"));this._connections.push(dojo.connect(dijit.byId("theme_select_mobile_theme_select"),
"onChange",this,"onMobileChange"));this._connections.push(dojo.connect(dijit.byId("theme_select_ok_button"),"_onSubmit",this,"onOk"));this._connections.push(dojo.connect(dijit.byId("theme_select_cancel_button"),"onClick",this,"onClose"));this._connections.push(dojo.connect(dijit.byId("theme_select_android_select"),"onChange",this,"onAndroidThemeChange"));this._connections.push(dojo.connect(dijit.byId("theme_select_blackberry_select"),"onChange",this,"onBlackberryThemeChange"));this._connections.push(dojo.connect(dijit.byId("theme_select_ipad_select"),
"onChange",this,"oniPadThemeChange"));this._connections.push(dojo.connect(dijit.byId("theme_select_iphone_select"),"onChange",this,"oniPhoneThemeChange"));this._connections.push(dojo.connect(dijit.byId("theme_select_other_select"),"onChange",this,"onOtherThemeChange"));this.addThemeSets();this._selectedThemeSet=this._dojoThemeSets.themeSets[0];dijit.byId("theme_select_themeset_theme_select_textbox").attr("value",this._selectedThemeSet.name);this.addThemes(this._selectedThemeSet);this._dialog.show()},
addThemeSets:function(){for(var a=dojo.byId("theme_select_themeset_theme_select"),c=0;c<this._dojoThemeSets.themeSets.length;c++){var d=dojo.doc.createElement("option");d.innerHTML=this._dojoThemeSets.themeSets[c].name;d.value=this._dojoThemeSets.themeSets[c].name;0===c&&(d.selected="1");a.appendChild(d)}},addThemes:function(d){this._themeData=a.getThemes(k.getProject(),this.workspaceOnly);var b=dijit.byId("theme_select_desktop_theme_select");b.options=[];var f=dijit.byId("theme_select_android_select");
f.options=[];var g=dijit.byId("theme_select_blackberry_select");g.options=[];var n=dijit.byId("theme_select_ipad_select");n.options=[];var e=dijit.byId("theme_select_iphone_select");e.options=[];var h=dijit.byId("theme_select_other_select");h.options=[];var m=dijit.byId("theme_select_mobile_theme_select");b.options=[];m.options=[];m.addOption({value:c.default_theme,label:c.default_theme});this._themeCount=this._themeData.length;for(var v=0;v<this._themeData.length;v++){var A={value:this._themeData[v].name,
label:this._themeData[v].name};"dojox.mobile"===this._themeData[v].type?(m.addOption(A),f.addOption(A),g.addOption(A),n.addOption(A),e.addOption(A),h.addOption(A)):b.addOption(A)}b.attr("value",d.desktopTheme);for(b=0;b<d.mobileTheme.length;b++)switch(d.mobileTheme[b].device.toLowerCase()){case "android":f.attr("value",d.mobileTheme[b].theme);break;case "blackberry":g.attr("value",d.mobileTheme[b].theme);break;case "ipad":n.attr("value",d.mobileTheme[b].theme);break;case "iphone":e.attr("value",d.mobileTheme[b].theme);
break;case "other":h.attr("value",d.mobileTheme[b].theme)}c.singleMobileTheme(d)?m.attr("value",d.mobileTheme[d.mobileTheme.length-1].theme):(m.attr("value",c.default_theme),this.onMobileChange(c.default_theme))},addThemeSet:function(a){a=this._selectedThemeSet?dojo.clone(this._selectedThemeSet):dojo.clone(c.default_themeset);for(var d=a.name,b=0,f=0;f<this._dojoThemeSets.themeSets.length;f++)this._dojoThemeSets.themeSets[f].name==d&&(b++,d=a.name+"_"+b,f=-1);a.name=d;this._dojoThemeSets.themeSets.push(a);
d=dojo.byId("theme_select_themeset_theme_select");b=dojo.doc.createElement("option");b.innerHTML=a.name;b.value=a.name;d.appendChild(b)},deleteThemeSet:function(a){a=dojo.byId("theme_select_themeset_theme_select");var c=a[a.selectedIndex];if(c){for(var d=0;d<this._dojoThemeSets.themeSets.length;d++)if(this._dojoThemeSets.themeSets[d].name==c.value){this._dojoThemeSets.themeSets.splice(d,1);break}this._selectedThemeSet=null;a.removeChild(c);dijit.byId("theme_select_themeset_theme_select_textbox").attr("value",
"");a=dijit.byId("theme_select_rename_button");var c=dijit.byId("theme_select_desktop_theme_select"),d=dijit.byId("theme_select_mobile_theme_select"),b=dijit.byId("theme_select_android_select"),f=dijit.byId("theme_select_blackberry_select"),g=dijit.byId("theme_select_ipad_select"),k=dijit.byId("theme_select_iphone_select"),n=dijit.byId("theme_select_other_select");a.set("disabled",!0);c.set("disabled",!0);d.set("disabled",!0);b.set("disabled",!0);f.set("disabled",!0);g.set("disabled",!0);k.set("disabled",
!0);n.set("disabled",!0)}},renameThemeSet:function(a){dojo.byId("theme_select_themeset_theme_select");this._renameDialog=new m({id:"rename",title:f.renameThemeSet,contentStyle:{width:300},content:new davinci.ui.ThemeSetsDialogRenameWidget({})});this._renameDialog._themesetConnections=[];this._renameDialog._themesetConnections.push(dojo.connect(dijit.byId("theme_set_rename_ok_button"),"onClick",this,"onOkRename"));this._renameDialog._themesetConnections.push(dojo.connect(dijit.byId("theme_set_rename_cancel_button"),
"onClick",this,"onCloseRename"));this._renameDialog._themesetConnections.push(dojo.connect(this._renameDialog,"onCancel",this,"onCloseRename"));this._renameDialog.show();a=dijit.byId("theme_select_themeset_rename_textbox");a.attr("value",this._selectedThemeSet.name);dijit.selectInputText(a)},onOkRename:function(a){var c=dijit.byId("theme_select_themeset_rename_textbox").attr("value");if(c){for(var d=0;d<this._dojoThemeSets.themeSets.length;d++)if(this._dojoThemeSets.themeSets[d].name==c){alert("Theme set name already use");
return}d=dojo.byId("theme_select_themeset_theme_select");d=d[d.selectedIndex];d.innerHTML=c;d.value=c;this._selectedThemeSet.name=c;dijit.byId("theme_select_themeset_theme_select_textbox").attr("value",this._selectedThemeSet.name)}this.onCloseRename(a)},onCloseRename:function(a){for(;connection=this._renameDialog._themesetConnections.pop();)dojo.disconnect(connection);this._renameDialog.destroyDescendants();this._renameDialog.destroy();delete this._renameDialog},onClick:function(a){a.target.setAttribute("selected",
!1);dojo.byId("theme_select_themeset_theme_select").setAttribute("value",this._selectedThemeSet.name)},onChange:function(a){a=a.target[a.target.selectedIndex].value;for(var c=0;c<this._dojoThemeSets.themeSets.length;c++)if(this._dojoThemeSets.themeSets[c].name==a){this._selectedThemeSet=this._dojoThemeSets.themeSets[c];this.addThemes(this._dojoThemeSets.themeSets[c]);dijit.byId("theme_select_themeset_theme_select_textbox").attr("value",this._selectedThemeSet.name);a=dijit.byId("theme_select_rename_button");
var c=dijit.byId("theme_select_desktop_theme_select"),d=dijit.byId("theme_select_mobile_theme_select");a.set("disabled",!1);c.set("disabled",!1);d.set("disabled",!1);break}},onDesktopChange:function(a){this._selectedThemeSet.desktopTheme=a},onMobileChange:function(a){function c(a,n,e){switch(a){case "android":d.attr("value",n);d.set("disabled",e);break;case "blackberry":b.attr("value",n);b.set("disabled",e);break;case "ipad":f.attr("value",n);f.set("disabled",e);break;case "iphone":g.attr("value",
n);g.set("disabled",e);break;case "other":k.attr("value",n),k.set("disabled",e)}}var d=dijit.byId("theme_select_android_select"),b=dijit.byId("theme_select_blackberry_select"),f=dijit.byId("theme_select_ipad_select"),g=dijit.byId("theme_select_iphone_select"),k=dijit.byId("theme_select_other_select");if("(device-specific)"===a)for(var n=0;n<this._selectedThemeSet.mobileTheme.length;n++){var e=this._selectedThemeSet.mobileTheme[n].device.toLowerCase();c(e,this._selectedThemeSet.mobileTheme[n].theme,
!1)}else for(n=0;n<this._selectedThemeSet.mobileTheme.length;n++)e=this._selectedThemeSet.mobileTheme[n].device.toLowerCase(),this._selectedThemeSet.mobileTheme[n].theme=a,c(e,this._selectedThemeSet.mobileTheme[n].theme,!0)},onDeviceThemeChange:function(a,c){for(var d=0;d<this._selectedThemeSet.mobileTheme.length;d++)if(this._selectedThemeSet.mobileTheme[d].device.toLowerCase()===a.toLowerCase()){this._selectedThemeSet.mobileTheme[d].theme=c;break}},onAndroidThemeChange:function(a){this.onDeviceThemeChange("android",
a)},onBlackberryThemeChange:function(a){this.onDeviceThemeChange("blackberry",a)},oniPadThemeChange:function(a){this.onDeviceThemeChange("ipad",a)},oniPhoneThemeChange:function(a){this.onDeviceThemeChange("iphone",a)},onOtherThemeChange:function(a){this.onDeviceThemeChange("other",a)},onOk:function(a){c.saveThemeSets(k.getProject(),this._dojoThemeSets);this.onClose(a)},onClose:function(a){for(;connection=this._connections.pop();)dojo.disconnect(connection);this._dialog.destroyDescendants();this._dialog.destroy();
delete this._dialog},onDeleteThemeSet:function(a){for(a=0;a<this._dojoThemeSets.themeSets.length;a++)if(this._dojoThemeSets.themeSets[a].name===this._currentThemeSet.name){var c=this._dojoThemeSets.themeSets[a-1].name,d=dijit.byId("theme_select");d.store.fetchItemByIdentity({identity:this._dojoThemeSets.themeSets[a].name,onItem:function(a){d.store.deleteItem(a);d.store.save()}});this._dojoThemeSets.themeSets.splice(a,1);this._currentThemeSet=null;d.attr("value",c);break}}})})},"davinci/ui/about":function(){define("dojo/_base/declare ../Workbench davinci/version davinci/repositoryinfo dojo/date/locale dojo/date/stamp dojo/i18n!davinci/ui/nls/ui dojo/i18n!dijit/nls/common dijit/form/Button".split(" "),
function(p,m,h,e,b,k,a,g){p=p("davinci.ui.about",null,{});p.show=function(){var g="\x3cdiv class\x3d'about_container'\x3e\x3cdiv class\x3d'about_version'\x3e"+dojo.string.substitute(a.productVersion,[h])+"\x3c/div\x3e",f=e.revision,d=e.buildtime,c=k.fromISOString(d);c&&(d=b.format(c,{formatLength:"medium"}));d&&(g+="\x3cdiv class\x3d'about_date'\x3e"+dojo.string.substitute(a.productDate,[d])+"\x3c/div\x3e");f&&(f="\x3ca href\x3d'https://github.com/maqetta/maqetta/commit/"+f+"'\x3e"+f.substr(0,15)+
"...\x3c/a\x3e",g+="\x3cdiv class\x3d'about_build'\x3e"+dojo.string.substitute(a.build,[f])+"\x3c/div\x3e");m.showMessage(a.aboutMaqetta,g+"\x3c/div\x3e")};return p})},"davinci/version":function(){define([],"10")},"davinci/repositoryinfo":function(){define({revision:"",buildtime:"@buildtime@"})},"davinci/html/html.plugin":function(){define(["require"],function(p){return{id:"davinci.html","davinci.editor":[{id:"HTMLEditor",name:"HTML Editor",extensions:"html",isDefault:!1,editorClass:"davinci/html/ui/HTMLEditor",
palettePerspective:"davinci.html.htmlEditor",expandPalettes:["left"]},{id:"CSSEditor",name:"CSS Editor",extensions:"css",isDefault:!1,editorClass:"davinci/html/ui/CSSEditor",palettePerspective:"davinci.html.htmlEditor",expandPalettes:["left"]},{id:"ImageViewer",name:"Image Viewer",extensions:"jpg,gif,jpeg,png",isDefault:!0,editorClass:"davinci/html/ui/ImageViewer",palettePerspective:"davinci.html.htmlEditor",expandPalettes:["left"]}],"davinci.editorActions":{editorContribution:{targetID:"davinci.html.CSSEditor",
actions:[{id:"savecombo",className:"maqLabelButton",showLabel:!0,label:"Save",toolbarPath:"save",type:"ComboButton",run:function(){p(["../Workbench"],function(m){p("../ui/Resource").save()})},isEnabled:function(m){return p("../Workbench").getOpenEditor()},menu:[{iconClass:"saveIcon",run:function(){p("../ui/Resource").save()},isEnabled:function(m){return p("../Workbench").getOpenEditor()},label:"Save",keyBinding:{accel:!0,charOrCode:"s",allowGlobal:!0}},{iconClass:"saveAsIcon",run:function(){p("../ui/Resource").saveAs("html")},
isEnabled:function(m){return p("../Workbench").getOpenEditor()},label:"Save As",keyBinding:{accel:!0,shift:!0,charOrCode:"s",allowGlobal:!0}}]}]}},"davinci.preferences":[{name:"HTML",id:"general",category:""}],"davinci.fileType":[{extension:"html",iconClass:"htmlFileIcon",type:"text"},{extension:"css",iconClass:"cssFileIcon",type:"text"},{extension:"jpeg",iconClass:"imageFileIcon",type:"image"},{extension:"jpg",iconClass:"imageFileIcon",type:"image"},{extension:"png",iconClass:"imageFileIcon",type:"image"},
{extension:"gif",iconClass:"imageFileIcon",type:"image"}],"davinci.perspective":[{id:"htmlEditor",title:"HTML Editor",views:[{viewID:"davinci.ve.Palette",position:"left",hidden:!0},{viewID:"davinci.ui.outline",position:"left",hidden:!0},{viewID:"davinci.ve.style",position:"right"},{viewID:"davinci.ui.comment",position:"right",hidden:!0},{viewID:"davinci.ve.states",position:"right-bottom",hidden:!0},{viewID:"davinci.ui.navigator",position:"left-bottom",selected:!0},{viewID:"davinci.review.reviewNavigator",
position:"left"}]}]}})},"davinci/js/js.plugin":function(){define(["require"],function(p){return{id:"davinci.js","davinci.editor":[{id:"JSEditor",name:"JavaScript Editor",extensions:"js,json",isDefault:!1,editorClass:"davinci/js/ui/JavaScriptEditor",palettePerspective:"davinci.html.htmlEditor",expandPalettes:["left"]},{id:"XIDEEditor",name:"Editor",extensions:"js,json",isDefault:!0,editorClass:"davinci/xide/Editor",palettePerspective:"davinci.html.htmlEditor",expandPalettes:["left"]}],"davinci.actionSets":[{id:"jsSource",
visible:!0,menu:[{label:"Source",path:"edit",id:"davinci.js.source",separator:["commentGroup",!0,"editGroup",!0,"codeGroup",!0,"additions",!1]}],actions:[{id:"davinci.js.comment",icon:null,run:function(){alert("toggle comment")},label:"Toggle Comment",menubarPath:"davinci.js.source/commentGroup"}]},{id:"jsEdit",visible:!0,actions:[{id:"davinci.js.cut",icon:null,label:"cut",commandID:"davinci.js.cut",menubarPath:"davinci.edit/cut"},{id:"davinci.js.add",icon:null,label:"add",commandID:"davinci.js.add",
menubarPath:"davinci.edit/add"},{id:"davinci.js.delete",icon:null,label:"delete",commandID:"davinci.js.delete",menubarPath:"davinci.edit/delete"}]}],"davinci.actionSetPartAssociations":[{targetID:"davinci.js.jsEdit",parts:["davinci.ui.outline","davinci.js.JSEditor"]}],"davinci.editorActions":{editorContribution:{targetID:"davinci.js.JSEditor",actions:[{id:"savecombo",className:"maqLabelButton",showLabel:!0,label:"Save",toolbarPath:"save",type:"ComboButton",run:function(){p(["../Workbench"],function(m){p("../ui/Resource").save()})},
isEnabled:function(m){return p("../Workbench").getOpenEditor()},menu:[{iconClass:"saveIcon",run:function(){p("../ui/Resource").save()},isEnabled:function(m){return p("../Workbench").getOpenEditor()},label:"Save",keyBinding:{accel:!0,charOrCode:"s",allowGlobal:!0}},{iconClass:"saveAsIcon",run:function(){p("../ui/Resource").saveAs("html")},isEnabled:function(m){return p("../Workbench").getOpenEditor()},label:"Save As",keyBinding:{accel:!0,shift:!0,charOrCode:"s",allowGlobal:!0}}]}]}},"davinci.commands":[{id:"cut",
run:function(){}},{id:"add",run:function(){}},{id:"delete",run:function(){}}],"davinci.keyBindings":[{platform:"win",sequence:"M1+C",commandID:"davinci.js.copy",contextID:"davinci.js.JSEditor"}],"davinci.preferences":[{name:"JavaScript",id:"general",category:""},{name:"Formatting",id:"format",category:"davinci.js.general",pane:"davinci/js/ui/FormatOptions",defaultValues:{blockNewLine:!1,blockIndent:3,functionNewLine:!1,functionIndent:5,functionParamSpaceing:1,labelSpace:1,forParamSpacing:0,breakOnLabel:!0,
ifStmtSpacing:0,varAssignmentSpaceing:0,switchSpacing:3,objectLitFieldSpace:1}}],"davinci.fileType":[{extension:"js",iconClass:"jsFileIcon",type:"text"},{extension:"json",iconClass:"jsFileIcon",type:"text"}]}})},"davinci/ve/ve.plugin":function(){define(["require"],function(p){return{id:"davinci.ve","davinci.view":[{id:"Palette",title:"Palette",viewClass:"davinci/ve/palette/HtmlWidgets",iconClass:"paletteIcon paletteIconWidgets"},{id:"states",title:"Scenes",viewClass:"davinci/ve/views/StatesView",
iconClass:"paletteIcon paletteIconStates"},{id:"datastores",title:"DataStores",viewClass:"davinci/ve/views/DataStoresView"},{id:"object",title:"Object",viewClass:"davinci/ve/views/ObjectView"},{id:"style",title:"",viewClass:"davinci/ve/views/SwitchingStyleView"}],"davinci.perspective":[{id:"pageDesign",title:"Page Design",views:[{viewID:"davinci.ve.Palette",position:"left",selected:!0},{viewID:"davinci.ui.outline",position:"left"},{viewID:"davinci.ui.devices",position:"left"},{viewID:"davinci.ui.files",
position:"left"},{viewID:"davinci.ve.style",position:"right"},{viewID:"davinci.ui.comment",position:"right",hidden:!0},{viewID:"davinci.ve.states",position:"right-bottom",selected:!0},{viewID:"davinci.ui.navigator",position:"left-bottom",selected:!0},{viewID:"davinci.review.reviewNavigator",position:"left-bottom"}]}],"davinci.editor":[{id:"HTMLPageEditor",name:"HTML Visual Editor",extensions:["html","htm","php"],isDefault:!0,editorClass:"davinci/ve/PageEditor",palettePerspective:"davinci.ve.pageDesign",
expandPalettes:["left"]}],"davinci.actionSets":[{id:"cutCopyPaste",visible:!0,actions:[{label:"Cut",keySequence:"M1+X",iconClass:"editActionIcon editCutIconSmall",action:"davinci/ve/actions/CutAction",menubarPath:"davinci.edit/cut"},{label:"Copy",keySequence:"M1+C",iconClass:"editActionIcon editCopyIconSmall",action:"davinci/ve/actions/CopyAction",menubarPath:"davinci.edit/cut"},{keySequence:"M1+V",iconClass:"editActionIcon editPasteIconSmall",label:"Paste",action:"davinci/ve/actions/PasteAction",
menubarPath:"davinci.edit/cut"},{keySequence:"DEL",iconClass:"editActionIcon editDeleteIconSmall",label:"Delete",action:"davinci/ve/actions/DeleteAction",menubarPath:"davinci.edit/cut"},{iconClass:"fa-crosshairs",label:"Show in Outline",action:"davinci/ve/actions/ShowInOutline",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon selectParentIconSmall",label:"Select parent",action:"davinci/ve/actions/SelectParentAction",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon selectAncestorIconSmall",
label:"Select ancestor...",action:"davinci/ve/actions/SelectAncestorAction",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon unselectAllIconSmall",label:"Unselect all",action:"davinci/ve/actions/UnselectAllAction",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon",label:"Surround with \x26lt;A\x26gt;",action:"davinci/ve/actions/SurroundAction",surroundWithTagName:"a",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon",label:"Surround with \x26lt;DIV\x26gt;",action:"davinci/ve/actions/SurroundAction",
surroundWithTagName:"div",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon",label:"Surround with \x26lt;SPAN\x26gt;",action:"davinci/ve/actions/SurroundAction",surroundWithTagName:"span",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon moveToFrontIconSmall",label:"Move to front",action:"davinci/ve/actions/MoveToFrontAction",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon moveForwardIconSmall",label:"Move forward",action:"davinci/ve/actions/MoveForwardAction",menubarPath:"davinci.edit/cut"},
{iconClass:"editActionIcon moveBackwardIconSmall",label:"Move backward",action:"davinci/ve/actions/MoveBackwardAction",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon moveToBackIconSmall",label:"Move to back",action:"davinci/ve/actions/MoveToBackAction",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon",label:"Manage States...",action:"davinci/ve/actions/ManageStates",menubarPath:"davinci.edit/cut",command:"File/ManageStates",group:"View"}]}],"davinci.viewActions":[{viewContribution:{targetID:"davinci.ve.outline",
actions:[{id:"design",iconClass:"designModeIcon editActionIcon",radioGroup:"displayMode",method:"switchDisplayMode",label:"Widgets",toolbarPath:"displayMode"},{id:"source",iconClass:"sourceModeIcon editActionIcon",method:"switchDisplayMode",radioGroup:"displayMode",label:"Source",toolbarPath:"displayMode"}]}},{viewContribution:{targetID:"davinci.ve.states",actions:[{id:"addState",iconClass:"viewActionIcon addStateIcon",action:"davinci/ve/actions/AddState",label:"Add state",toolbarPath:"states1"},
{id:"removeState",iconClass:"viewActionIcon removeStateIcon",action:"davinci/ve/actions/RemoveState",label:"Remove state",toolbarPath:"states1"},{id:"modifyState",iconClass:"viewActionIcon modifyStateIcon",action:"davinci/ve/actions/ModifyState",label:"Modify state",toolbarPath:"states1"},{id:"manageStates",className:"manageStatesButton",iconClass:"viewActionIcon manageStatesIcon",action:"davinci/ve/actions/ManageStates",label:"For currently selected widgets, manage widget visibility for different states",
toolbarPath:"states1",command:"File/ManageStates",group:"View"},{id:"NewWidgetsCurrentState",className:"newWidgetsCurrentStateButton",iconClass:"viewActionIcon newWidgetsCurrentStateIcon",action:"davinci/ve/actions/NewWidgetsCurrentState",label:"Toggle whether new widgets go to Background or current state",toolbarPath:"states2"},{id:"highlightBaseWidgets",className:"highlightBaseWidgetsButton",iconClass:"viewActionIcon highlightBaseWidgetsIcon",action:"davinci/ve/actions/HighlightBaseWidgets",label:"When in custom state, highlight widgets from Background state",
toolbarPath:"states2"}]}}],"davinci.actionSetPartAssociations":[{targetID:"davinci.ve.cutCopyPaste",parts:["davinci.ve.visualEditor","davinci.ve.VisualEditorOutline"]}],"davinci.editorActions":{editorContribution:{targetID:"davinci.ve.HTMLPageEditor",actions:[{id:"savecombo",className:"maqLabelButton",showLabel:!0,label:"Save",toolbarPath:"save",type:"ComboButton",run:function(){p(["../Workbench"],function(m){p("../ui/Resource").save()})},isEnabled:function(m){return p("../Workbench").getOpenEditor()},
menu:[{iconClass:"saveIcon",run:function(){p("../ui/Resource").save()},isEnabled:function(m){return p("../Workbench").getOpenEditor()},label:"Save",keyBinding:{accel:!0,charOrCode:"s",allowGlobal:!0}},{iconClass:"saveAsIcon",run:function(){p("../ui/Resource").saveAs("html")},isEnabled:function(m){return p("../Workbench").getOpenEditor()},label:"Save As",keyBinding:{accel:!0,shift:!0,charOrCode:"s",allowGlobal:!0}},{id:"saveasdijit",iconClass:"fa-save",run:function(){return p(["davinci/de/resource"],
function(m){m.createDijiFromNewDialog()})},isEnabled:function(m){return p("../Workbench").getOpenEditor()},label:"Save As Widget",command:"File/Save As Widget",group:"File",tab:"Home"}]},{id:"undo",iconClass:"editActionIcon undoIcon",action:"davinci/actions/UndoAction",label:"Undo",toolbarPath:"undoredo",keyBinding:{accel:!0,charOrCode:"z"},command:"Edit/Undo"},{id:"redo",iconClass:"editActionIcon redoIcon",action:"davinci/actions/RedoAction",label:"Redo",toolbarPath:"undoredo",keyBinding:{accel:!0,
shift:!0,charOrCode:"z"},command:"Edit/Redo"},{id:"cut",label:"Cut",iconClass:"editActionIcon editCutIcon",action:"davinci/ve/actions/CutAction",toolbarPath:"cutcopypaste",keyBinding:{accel:!0,charOrCode:"x"}},{id:"copy",label:"Copy",iconClass:"editActionIcon editCopyIcon",action:"davinci/ve/actions/CopyAction",toolbarPath:"cutcopypaste",keyBinding:{accel:!0,charOrCode:"c"}},{id:"paste",label:"Paste",iconClass:"editActionIcon editPasteIcon",action:"davinci/ve/actions/PasteAction",toolbarPath:"cutcopypaste",
keyBinding:{accel:!0,charOrCode:"v"}},{id:"delete",iconClass:"editActionIcon editDeleteIcon",label:"Delete",action:"davinci/ve/actions/DeleteAction",toolbarPath:"delete",keyBinding:{charOrCode:[dojo.keys.DELETE,dojo.keys.BACKSPACE]}},{id:"outline",iconClass:"fa-crosshairs",label:"Show in Outline",action:"davinci/ve/actions/ShowInOutline",toolbarPath:"outline"},{id:"openBrowser",iconClass:"fa-play",className:"davinciFloatRight openBrowser",run:function(){p(["../Workbench"],function(m){(m=m.getOpenEditor())&&
m.resourceFile?m.previewInBrowser():console.error("ERROR. Cannot launch browser window. No editor info.")})},label:"Preview in Browser",toolbarPath:"undoredo",keyBinding:{accel:!0,charOrCode:"0",allowGlobal:!0},command:"File/Open In Browser",group:"File",tab:"Home"},{id:"documentSettings",iconClass:"documentSettingsIcon",className:"documentSettings davinciFloatRight",label:"Document settings",toolbarPath:"undoredo",type:"DropDownButton",menu:[{id:"theme",iconClass:"selectThemeIcon",className:"davinciFloatRight",
action:"davinci/actions/SelectThemeAction",label:"Switch theme"},{iconClass:"editActionIcon",label:"Select parent",action:"davinci/ve/actions/SelectParentAction",command:"Widget/Select/SelectParent",group:"Widget"},{iconClass:"editActionIcon",label:"Select ancestor",action:"davinci/ve/actions/SelectAncestorAction",command:"Widget/Select/SelectAnchestor",group:"Widget"},{iconClass:"editActionIcon",label:"Unselect all",action:"davinci/ve/actions/UnselectAllAction"},{iconClass:"editActionIcon moveToFrontIconSmall",
label:"Move to front",action:"davinci/ve/actions/MoveToFrontAction",command:"Widget/Move/MoveToFront",group:"Widget"},{iconClass:"editActionIcon moveForwardIconSmall",label:"Move forward",action:"davinci/ve/actions/MoveForwardAction",command:"Widget/Move/MoveToForward",group:"Widget"},{iconClass:"editActionIcon moveBackwardIconSmall",label:"Move backward",action:"davinci/ve/actions/MoveBackwardAction",command:"Widget/Move/MoveToBackward",group:"Widget"},{iconClass:"editActionIcon moveToBackIconSmall",
label:"Move to back",action:"davinci/ve/actions/MoveToBackAction",command:"Widget/Move/MoveToBack",group:"Widget"},{iconClass:"editActionIcon",label:"Surround with \x26lt;A\x26gt;",action:"davinci/ve/actions/SurroundAction",surroundWithTagName:"a",command:"Widget/SourroundWithA",group:"Widget",tab:"Tools"},{iconClass:"editActionIcon",label:"Surround with \x26lt;DIV\x26gt;",action:"davinci/ve/actions/SurroundAction",surroundWithTagName:"div",command:"Widget/SourroundWithDIV",group:"Widget",tab:"Tools"},
{iconClass:"editActionIcon",label:"Surround with \x26lt;SPAN\x26gt;",action:"davinci/ve/actions/SurroundAction",surroundWithTagName:"span",command:"Widget/SourroundWithSPAN",group:"Widget",tab:"Tools"},{iconClass:"editActionIcon",label:"Manage States...",id:"manageStates",action:"davinci/ve/actions/ManageStates",menubarPath:"davinci.edit/cut",command:"File/ManageStates",group:"States",tab:"Tools"}]},{id:"stickynote",iconClass:"stickynoteIcon",action:"davinci/actions/StickyNoteAction",label:"Add note",
toolbarPath:"stickynote"},{id:"layout",className:"maqLabelButton davinciFloatRight maqLayoutDropDownButton",showLabel:!0,label:"Flow",toolbarPath:"undoredo",type:"DropDownButton",menu:[{label:"Flow",iconClass:"flowLayoutIcon",method:"selectLayoutFlow"},{label:"Absolute",iconClass:"absoluteLayoutIcon",method:"selectLayoutAbsolute"}]},{id:"sourcecombo",className:"maqLabelButton davinciFloatRight maqSourceComboButton",showLabel:!0,label:"Source",action:"davinci/ve/actions/ViewSourceAction",toolbarPath:"undoredo",
type:"ComboButton",menu:[{keyBinding:{accel:!0,charOrCode:"2",allowGlobal:!0},iconClass:"editActionIcon sourceModeIcon sourceMenuIcon",action:"davinci/ve/actions/ViewSourceMenuAction",label:"Source only"},{keyBinding:{accel:!0,charOrCode:"3",allowGlobal:!0},iconClass:"editActionIcon splitVerticalIcon sourceMenuIcon",action:"davinci/ve/actions/ViewSplitVMenuAction",label:"Split Vertically"},{keyBinding:{accel:!0,charOrCode:"4",allowGlobal:!0},iconClass:"editActionIcon splitHorizontalIcon sourceMenuIcon",
action:"davinci/ve/actions/ViewSplitHMenuAction",label:"Split Horizontally"}]},{id:"design",showLabel:!0,className:"maqLabelButton davinciFloatRight maqDesignButton",action:"davinci/ve/actions/ViewDesignAction",label:"Design",toolbarPath:"undoredo",keyBinding:{accel:!0,charOrCode:"1",allowGlobal:!0}},{id:"closeactiveeditor",run:function(){p(["../Workbench"],function(m){m.closeActiveEditor()})},keyBinding:{accel:!0,shift:!0,charOrCode:"w",allowGlobal:!0}},{id:"showWidgetsPalette",run:function(){var m=
dijit.byId("davinci.ve.Palette");if(m){var h=m.getParent();h&&h.selectChild(m)}},keyBinding:{meta:!0,charOrCode:"p",allowGlobal:!0}}]}},"davinci.preferences":[{name:"Visual Editor",id:"editorPrefs",category:"davinci.html.general",pane:"davinci/ve/prefs/HTMLEditPreferences",defaultValues:{flowLayout:!1,snap:!0,showPossibleParents:!0,cssOverrideWarn:!0,absoluteWidgetsZindex:900,widgetPaletteLayout:"icons"}}],"davinci.dnd":[{parts:["davinci.ui.navigator"],dragSource:function(m){if("File"==m.elementType)return/gif|jpeg|jpg|png|svg|json/i.test(m.getExtension())},
dragHandler:"davinci/ve/palette/ImageDragSource"}],"davinci.fileType":[{extension:"theme",iconClass:"themeFileIcon",type:"text"}],"davinci.defaultEditorActions":{editorContribution:{actions:[{id:"save",run:function(){p("../Workbench").getOpenEditor().save()},isEnabled:function(m){return!0},className:"maqLabelButton",showLabel:!0,label:"Save",toolbarPath:"save",keyBinding:{accel:!0,charOrCode:"s"}},{id:"undo",iconClass:"editActionIcon undoIcon",action:"davinci/actions/UndoAction",label:"Undo",toolbarPath:"undoredo",
keyBinding:{accel:!0,charOrCode:"z"}},{id:"redo",iconClass:"editActionIcon redoIcon",action:"davinci/actions/RedoAction",label:"Redo",toolbarPath:"undoredo",keyBinding:{accel:!0,shift:!0,charOrCode:"z"}}]}}}})},"davinci/de/resource":function(){define("davinci/de/widgets/NewDijit davinci/Workbench davinci/workbench/Preferences system/resource davinci/de/DijitTemplatedGenerator davinci/library davinci/ui/Dialog davinci/ve/actions/ReplaceAction dojo/promise/all".split(" "),function(p,m,h,e,b,k,a,g,n){var f=
{WIDGETS_JSON:{version:"1.0",localPath:!0,customWidgetSpec:1,categories:{custom:{name:"Custom widget",description:"Custom widget",widgetClass:"dijit"}},widgets:[]},createDijiFromNewDialog:function(){var d=new p({}),c=m.getOpenEditor(),b=e.findResource(c.fileName),k=c.model,n=m.getOpenEditor().getContext(),h=n.getSelection();f.validWidget(h)?m.showModal(d,"Dijit Widget...",{height:60,width:250},function(){if(!d.cancel){var a=d.attr("value");f.createDijit(a,k,b,n,h).then(function(){a.replaceSelection&&
(new g).run(n,a.group+"."+a.name);window.location.reload(!1)})}return!0}):a.showModal("Invalid Selection.  Please select a single container widget to create a new Widget","Error creating Widget...")},validWidget:function(a){return null==a||1!=a.length?!1:a[0].acceptsHTMLChildren},_createNameSpace:function(a,c){var b=a.split("."),f=m.getProject();c=c||e.findResource(f);if(1<b.length)for(f=0;f<b.length-1;f++){var g=c.getChildSync(b[f]);c=null!=g?g:c.createResource(b[f],!0)}return c},_createFolder:function(a,
c,b){a=a.split("/");var f=m.getProject();c=c||e.findResource(f);if(a.length){for(f=0;f<a.length;f++)if("."!=a[f]){console.error("get child sync : "+a[f]);var g=c._getChild(a[f]);if(null!=g)c=g;else{c.createResource(a[f],!0,!1,b);return}}null!=c&&b&&b(c)}return c},createDijit:function(a,c,g,e,r){var z=a.name+"."+a.name,y=a.name+"/"+a.name,B=m.getProject();g=h.getPreferences("davinci.ui.ProjectPrefs",B);g.widgetFolder||(g.widgetFolder="WebContent/custom",h.savePreferences("davinci.ui.ProjectPrefs",
B,g));f._createFolder(g.widgetFolder,null,function(g){g=f._createNameSpace(z,g);var h=g.getChildSync(a.name+"_widgets.json");null==h&&(h=g.createResource(a.name+"_widgets.json"));var q=dojo.clone(f.WIDGETS_JSON);q.name=a.name;q.longName=a.name;for(var m={name:a.name,description:a.name,type:y,category:"custom",iconLocal:!0,icon:"app/davinci/img/maqetta.png"},C=0,p=r[0]._srcElement.attributes,E=p.length;C<E;C++){var I=p[C];I.noPersist||(m.properties||(m.properties={}),m.properties[I.name]=I.value)}q.widgets.push(m);
var m=[h.setContents(JSON.stringify(q,void 0,"\t"))],C=(new b({})).buildSource(c,y,a.name,!1,e,r),D;for(D in C)switch(D){case "html":p=g.createResource(a.name+".html");m.push(p.setContents(C.html));break;case "js":p=g.createResource(a.name+".js");m.push(p.setContents(C.js));break;case "metadata":p=g.createResource(a.name+"_oam.json"),m.push(p.setContents(C.metadata)),k.addCustomWidgets(B,h,g.getPath(),q)}return n(m)})}};return f})},"davinci/de/widgets/NewDijit":function(){define("dojo/_base/declare dijit/_Widget dijit/_Templated dojo/text!./templates/NewDijit.html dijit/form/RadioButton dijit/form/TextBox dijit/form/Button".split(" "),
function(p,m,h,e){return p("davinci.de.widgets.NewDijit",[m,h],{widgetsInTemplate:!0,templateString:e,_okButton:null,_dijitName:null,_widgetGroup:null,_replaceSelection:null,postMixInProperties:function(){this.inherited(arguments)},postCreate:function(){this.inherited(arguments);dojo.connect(this._dijitName,"onkeyup",this,"_checkValid")},_checkValid:function(){var b=null!=dojo.attr(this._dijitName,"value");this._okButton.set("disabled",!b)},okButton:function(){this.value={name:dojo.attr(this._dijitName,
"value"),replaceSelection:dojo.attr(this._replaceSelection,"checked")}},_getValueAttr:function(){return this.value},cancelButton:function(){this.cancel=!0;this.onClose()},onClose:function(){}})})},"davinci/de/DijitTemplatedGenerator":function(){define(["dojo/_base/declare","davinci/model/Path","davinci/ve/metadata","dojo/json"],function(p,m,h,e){return p("davinci.de.DijitTemplatedGenerator",null,{constructor:function(b){dojo.mixin(this,b)},buildSource:function(b,k,a,g,n,f){this.value={js:"",metadata:"",
amd:["dojo/_base/declare","dijit/_Widget","dijit/_Templated"]};this.metadata={id:a,name:a,spec:"1.0",version:"1.0",require:[],library:{dojo:{src:"../../dojo/dojo/dojo.js"}}};this.model=this._srcDocument=b;b=f[0]._srcElement;a=a+"/"+a+".html";g||(this.value.amd.push("dojo/text!"+a.toString()),this.value.htmlPath=a);n=b.find({elementType:"HTMLElement"});n.push(b);this.loadRequires("html.body",!0,!0,!0);f={};for(a=0;a<n.length;a++){var d=n[a],d=d.getAttribute("data-dojo-type")||d.getAttribute("dojoType")||
d.getAttribute("dvwidget");null!=d&&this.loadRequires(d,!0,!0,!0);var d=h.query(d,"library"),c;for(c in d)f[c]=d[c]}this.metadata.require.push({$library:"dojo",format:"amd",src:k,type:"javascript-module"});for(c in f)"dojo"!=c&&(this.metadata.library[c]={});this.value.html="";this.value.html+=b.getText();this.value.html+="";this.metadata.content="\x3cdiv\x3e\x3c/div\x3e";this.value.js="define([";for(a=0;a<this.value.amd.length;a++)this.value.js+="'"+this.value.amd[a]+"'",a+1<this.value.amd.length&&
(this.value.js+=",\n");this.value.js+="\n],function(";for(a=0;3>a;a++)k=this.value.amd[a].split("/"),this.value.js+=k[k.length-1],3>a+1&&(this.value.js+=",");g||(this.value.js+=",templateString");this.value.js+="){\n\n";this.value.js+=" return declare([ _Widget, _Templated";this.value.js+="], {\n";this.value.js+="       widgetsInTemplate:true,\n";g?(this.value.js+="       templateString:'"+this.escapeHtml(this.value.html)+"'",delete this.value.html):this.value.js+="       templateString:templateString";
this.value.js+="   \n});";this.value.js+="\n});";this.value.metadata=e.stringify(this.metadata,void 0,"\t");return this.value},escapeHtml:function(b){b=b.replace(/"/g,'\\"');return b=b.replace(/\n/g,"")},addMetaData:function(b){for(var k=0;k<this.metadata.require.length;k++){var a=this.metadata.require[k];if(a.$library==b.$library&&a.src==b.src&&a.type==b.type&&a.format==b.format)return}this.metadata.require.push(b)},loadRequires:function(b,k,a,g){if(!b)return!1;b=h.query(b,"require");if(!b)return!0;
b.every(function(a){this.addMetaData(a)},this)}})})},"davinci/ve/actions/ReplaceAction":function(){define("dojo/_base/declare dojo/dom-style davinci/ve/actions/ContextAction davinci/commands/CompoundCommand davinci/ve/commands/AddCommand davinci/ve/commands/MoveCommand davinci/ve/tools/CreateTool davinci/ve/widget davinci/ve/utils/GeomUtils".split(" "),function(p,m,h,e,b,k,a,g,n){return p("davinci.ve.actions.ReplaceAction",[h],{run:function(f,d){if((f=this.fixupContext(f))&&"davinci.ve.Context"===
f.declaredClass&&"davinci/delite/Context"===f.declaredClass){var c=this._normalizeSelection(f);if(this.selectionSameParent(c)){var h=[],u={type:d,context:f};if(0<c.length){var r=new e;dojo.forEach(c,function(c){var d,e=c.getData({identify:!1});e&&(e.context=f,dojo.withDoc(f.getDocument(),function(){d=g.createWidget(u)},this),d&&(r.add(new b(d,c.getParent(),void 0)),a.prototype.checkAddToCurrentState(r,d),h.push(d),"absolute"==(c&&c.domNode?m.get(c.domNode,"position"):null)&&(c=n.getMarginBoxPageCoords(c.domNode),
c.l+=25,r.add(new k(d,c.l,c.t,void 0,void 0,void 0,!0)))))});f.getCommandStack().execute(r);dojo.forEach(h,function(a,c){f.select(a,0<c)},this)}}}},isEnabled:function(a){a=(a=this.fixupContext(a))&&a.getSelection?a.getSelection():[];return 0===a.length?!1:this.selectionSameParent(a)},shouldShow:function(a){return(a=(a=this.fixupContext(a))?a.editor:null)&&"davinci.ve.PageEditor"==a.declaredClass},selectionSameParent:function(a){if(0===a.length)return!1;for(var d=a[0].getParent(),c=0;c<a.length;c++)if(a[c].getParent()!=
d)return!1;return!0}})})},"davinci/ve/actions/ContextAction":function(){define(["dojo/_base/declare","davinci/actions/Action","davinci/Runtime"],function(p,m,h){return p("davinci.ve.actions.ContextAction",[m],{_normalizeSelection:function(e){var b=e.getSelection();if(2>b.length)return b;var k=e.rootWidget,a=[];dojo.forEach(b,function(g){for(var n=g.getParent();n&&n!=k;){for(var f=0;f<b.length;f++)if(b[f]==n){e.deselect(g);return}n=n.getParent()}a.push(g)});return a},_getContext:function(e){return e?
e:(e=h.currentEditor)&&(e.getContext&&e.getContext()||e.context)},fixupContext:function(e){e=this._getContext(e);return"davinci.ve.Context"==e.declaredClass||"xideve/delite/Context"==e.declaredClass?e:"function"==typeof e.getContext?e.getContext():null}})})},"davinci/commands/CompoundCommand":function(){define(["dojo/_base/declare"],function(p){return p("davinci.commands.CompoundCommand",null,{name:"compound",_commands:[],constructor:function(m){this._commands=[];m&&(this._commands=[m])},add:function(m){if(m)if(this._commands)if("compound"==
m.name)dojo.forEach(m._commands,function(b){this.add(b)},this);else{if("modify"==m.name)for(var h=m._oldId,e=0;e<this._commands.length;e++){var b=this._commands[e];if("modify"==b.name&&b._oldId==h){b.add(m);return}}this._commands.push(m)}else this._commands="compound"==m.name?m._commands:[m]},setContext:function(m){for(var h=0;h<this._commands.length;h++)this._commands[h].setContext&&this._commands[h].setContext(m)},isEmpty:function(){return!this._commands||0===this._commands.length},execute:function(){if(this._commands)for(var m=
0;m<this._commands.length;m++)this._commands[m].execute(),this._commands[m]._oldId&&this._commands[m]._newId&&(this._oldId=this._commands[m]._oldId,this._newId=this._commands[m]._newId)},undo:function(){if(this._commands)for(var m=this._commands.length-1;0<=m;m--)this._commands[m].undo()}})})},"davinci/ve/commands/AddCommand":function(){define("dojo/_base/declare davinci/ve/commands/_hierarchyCommand davinci/ve/widget davinci/ve/utils/ImageUtils davinci/ve/States davinci/ve/commands/ModifyCommand".split(" "),
function(p,m,h,e,b,k){return p("davinci.ve.commands.AddCommand",[m],{name:"add",constructor:function(a,b,k){a&&(a.domNode?this._id=a.id:this._data=a);this._parentId=b.id;this._index=k},execute:function(){var a=h.byId(this._parentId);if(a){var g=a.getContext(),n=void 0;this._data?(this._id&&this._data.properties&&(this._data.properties.id=this._id),n=h.createWidget(this._data),this._id=n.id):this._id&&(n=h.byId(this._id,g));if(n){this._data=n.getData();this._data.properties.id=this._id;this._data.context=
g;if(this._index&&"number"!=typeof this._index)if(this._index.domNode)this._index=a.indexOf(this._index);else{var f=h.byId(this._index.id,g);this._index=a.indexOf(f)}"IMG"===n.domNode.tagName&&e.ImageUpdateFocus(n,g);a.addChild(n,this._index);g&&(g.attach(n),n.startup(),n.renderWidget(),g.widgetAddedOrDeleted(),g.widgetChanged(g.WIDGET_ADDED,n));(g=this._isRefreshOnDescendantChange(n))&&(new k(g,null,null,a._edit_context)).execute();b.resetState(n.domNode)}}},undo:function(){if(this._id&&this._parentId){var a=
h.byId(this._id);if(a){var g=h.byId(this._parentId);if(g){var n=this._isRefreshOnDescendantChange(a),f=a.getContext();f&&(f.detach(a),f.deselect(a));g.removeChild(a);f.widgetChanged(f.WIDGET_REMOVED,a);a.destroyWidget();f&&f.widgetAddedOrDeleted();n&&(new k(n,null,null,g._edit_context)).execute();b.resetState(a.domNode)}}}}})})},"davinci/ve/commands/_hierarchyCommand":function(){define(["dojo/_base/declare"],function(p){return p("davinci.ve.commands._hierarchyCommand",null,{_isRefreshOnDescendantChange:function(m){for(var h;m&&
m.domNode&&"BODY"!=m.domNode.tagName;)(m=m.getParent())&&davinci.ve.metadata.queryDescriptor(m.type,"refreshOnDescendantChange")&&(h=m);return h}})})},"davinci/ve/utils/ImageUtils":function(){define([],function(){return{ImageUpdateFocus:function(p,m){if(m&&p&&p.domNode&&"IMG"===p.domNode.tagName)var h=dojo.connect(p.domNode,"onload",function(){for(var e=m.getSelection(),b=0;b<e.length;b++)if(e[b]==p){m.updateFocus(p,b);break}dojo.disconnect(h)})}}})},"davinci/ve/commands/ModifyCommand":function(){define(["dojo/_base/declare",
"davinci/ve/commands/_hierarchyCommand","../widget","../utils/ImageUtils","../States"],function(p,m,h,e,b){return p("davinci.ve.commands.ModifyCommand",[m],{name:"modify",constructor:function(b,a,g,n,f){this._oldId=b?b.id:void 0;this._properties=a=a||{};this._children=g||"string"==typeof g?g:a._children;this._context=n||b.getContext();this._scripts=f;delete this._properties._children},setContext:function(b){this._context=b},add:function(b){b&&b._oldId==this._oldId&&(b._properties&&dojo.mixin(this._properties,
b._properties),b._children&&(this._children=b._children))},execute:function(){if(this._oldId&&this._properties){var k=h.byId(this._oldId),a=this._context;if(k){this._oldData=k.getData();this._oldData.context=a;this._newData={type:this._oldData.type,properties:dojo.mixin({},this._oldData.properties,this._properties),children:this._children||"string"==typeof this._children?this._children:this._oldData.children,scripts:dojo.mixin({},this._oldData.scripts,this._scripts),maqAppStates:this._oldData.maqAppStates,
maqDeltas:this._oldData.maqDeltas,context:a};for(var g in this._newData.properties)"$MAQ_MODIFYCOMMAND_DELETE_PROPERTY$"===this._newData.properties[g]&&delete this._newData.properties[g];if(this._doRefreshFromSource(k))k.setProperties(this._newData.properties,!0),setTimeout(function(){a.visualEditor.refresh()},0);else{a&&a.detach(k);this._oldData.properties.isTempID&&!this._properties.id||delete this._newData.properties.isTempID;g=k.getParent();var n=null,f=g.indexOf(k);g.removeChild(k);k.destroyWidget();
if(n=h.createWidget(this._newData)){"IMG"===n.domNode.tagName&&e.ImageUpdateFocus(n,a);g.addChild(n,f);this._newId=n.id;a&&(a.attach(n),n.startup(),n.renderWidget(),a.widgetAddedOrDeleted(),this._oldId!=this._newId&&a.widgetChanged(a.WIDGET_ID_CHANGED,n,this._oldId),a.widgetChanged(a.WIDGET_MODIFIED,n));this.newWidget=n;dojo.publish("/davinci/ui/widget/replaced",[n,k]);b.resetState(n.domNode);var d;if(k=this._isRefreshParentOnPropChange(n))if("string"==typeof k)for(d=g;d&&d.domNode&&d.type!=k&&"BODY"!=
d.domNode.tagName;){if(!d.domNode||"BODY"==d.domNode.tagName){d=null;break}d=d.getParent()}else d=g;(k=this._isRefreshOnDescendantChange(n))&&(d=k);d&&(new davinci.ve.commands.ModifyCommand(d,null,null,g._edit_context)).execute();dojo.publish("/davinci/ui/widgetPropertiesChanged",[[n]])}}}}},_doRefreshFromSource:function(b){var a=this._properties,g,n,f=!1;for(g in a)if(a.hasOwnProperty(g)&&(n=b.metadata.property[g])&&n.refreshFromSource){f=!0;break}return f},_isRefreshParentOnPropChange:function(b){return davinci.ve.metadata.queryDescriptor(b.type,
"refreshParentOnPropChange")},undo:function(){if(this._newId&&this._oldData){var k=h.byId(this._newId);if(k){var a=k.getParent();if(a){var g=a.indexOf(k);if(!(0>g)){var n=a.getContext();n&&n.detach(k);a.removeChild(k);k.destroyWidget();if(newWidget=h.createWidget(this._oldData)){this._oldData=newWidget.getData();this._oldData.context=this._context;a.addChild(newWidget,g);n&&(n.attach(newWidget),newWidget.startup(),newWidget.renderWidget(),n.widgetAddedOrDeleted(),n.widgetChanged(n.WIDGET_MODIFIED,
newWidget));dojo.publish("/davinci/ui/widget/replaced",[newWidget,k]);b.resetState(newWidget.domNode);var f;if(this._isRefreshParentOnPropChange(k))if("string"==typeof refreshParent)for(f=a;f&&f.domNode&&f.type!=refreshParent&&"BODY"!=f.domNode.tagName;){if(!f.domNode||"BODY"==f.domNode.tagName){f=null;break}f=f.getParent()}else f=a;(k=this._isRefreshOnDescendantChange(newWidget))&&(f=k);f&&(new davinci.ve.commands.ModifyCommand(f,null,null,a._edit_context)).execute();dojo.publish("/davinci/ui/widgetPropertiesChanged",
[[newWidget]])}}}}}}})})},"davinci/ve/commands/MoveCommand":function(){define("dojo/_base/declare dojo/dom-geometry davinci/ve/widget davinci/ve/States davinci/ve/utils/StyleArray davinci/ve/utils/GeomUtils".split(" "),function(p,m,h,e,b,k){return p("davinci.ve.commands.MoveCommand",null,{name:"move",constructor:function(a,b,n,f,d,c,k){this._id=a?a.id:void 0;this._context=a.getContext();this._newBox={l:b,t:n};this._commandForXYDeltas=f;this._oldBox=d;this._applyToStateIndex=c&&"Normal"!=c&&"undefined"!=
c?c:"undefined";this._disableSnapping=k},execute:function(){if(this._id){var a=h.byId(this._id);if(a&&a.domNode){var g=this._context;if(!this._oldBox){var n=a.getMarginBox();this._oldBox={l:n.l,t:n.t,w:n.w,h:n.h}}if(!a.domNode.offsetParent)console.error("maeh");else if(dojo.position(a.domNode.offsetParent,!0)){this._commandForXYDeltas?(this._newBox.l=this._oldBox.l+this._commandForXYDeltas._deltaX,this._newBox.t=this._oldBox.t+this._commandForXYDeltas._deltaY):(!this._disableSnapping&&g&&g._snapX&&
(n=this._oldBox.w,"left"==g._snapX.typeRefObj?this._newBox.l=g._snapX.x:n&&"right"==g._snapX.typeRefObj?this._newBox.l=g._snapX.x-n:n&&"center"==g._snapX.typeRefObj&&(this._newBox.l=g._snapX.x-n/2)),!this._disableSnapping&&g&&g._snapY&&(n=this._oldBox.h,"top"==g._snapY.typeRefObj?this._newBox.t=g._snapY.y:n&&"bottom"==g._snapY.typeRefObj?this._newBox.t=g._snapY.y-n:n&&"middle"==g._snapY.typeRefObj&&(this._newBox.t=g._snapY.y-n/2)));this._deltaX=this._newBox.l-this._oldBox.l;this._deltaY=this._newBox.t-
this._oldBox.t;var n=k.getBorderBoxPageCoords(a.domNode.offsetParent),f=m.getBorderExtents(a.domNode.offsetParent),d=this._newBox.l-n.l-f.l,c=this._newBox.t-n.t-f.t;g.getScrollOffset();d=[{left:d+"px"},{top:c+"px"}];g=a.getStyleValuesAllStates();this._oldStyleValuesAllStates=dojo.clone(g);this._oldBox&&(this._oldStyleValuesAllStates[this._applyToStateIndex]=b.mergeStyleArrays(this._oldStyleValuesAllStates[this._applyToStateIndex],[{left:this._oldBox.l-n.l-f.l+"px"},{top:this._oldBox.t-n.t-f.t+"px"}]));
g[this._applyToStateIndex]=g[this._applyToStateIndex]?b.mergeStyleArrays(g[this._applyToStateIndex],d):d;a.setStyleValuesAllStates(g);n=e.getStatesListCurrent(a.domNode);f=b.mergeStyleArrays([],g.undefined);for(d=0;d<n.length;d++)g[n[d]]&&(f=b.mergeStyleArrays(f,g[n[d]]));a.setStyleValuesCanvas(f);a.setStyleValuesModel(g.undefined);a.refresh();e.resetState(a.domNode);dojo.publish("/davinci/ui/widgetPropertiesChanged",[[a]])}}else console.error("no widget")}},undo:function(){if(this._id){var a=h.byId(this._id);
if(a){var g=this._oldStyleValuesAllStates,k=this._applyToStateIndex;a.setStyleValuesAllStates(g);g=b.mergeStyleArrays(g.undefined,g[k]);a.setStyleValuesCanvas(g);a.setStyleValuesModel(this._oldStyleValuesAllStates.undefined);a.refresh();davinci.ve.states.resetState(a.domNode);dojo.publish("/davinci/ui/widgetPropertiesChanged",[[a]])}}}})})},"davinci/ve/tools/CreateTool":function(){define("dojo/_base/declare dojo/dom-style ../tools/_Tool davinci/Workbench davinci/workbench/Preferences ../metadata ../widget dojo/Deferred dojo/promise/all davinci/ve/States davinci/commands/CompoundCommand ../commands/AddCommand ../commands/MoveCommand ../commands/ResizeCommand ../commands/StyleCommand".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r){return p("davinci.ve.tools.CreateTool",h,{constructor:function(a,c){this._data=a;this._userData=c;if(a&&a.type){var d=k.queryDescriptor(a.type,"resizableOnCreate")||k.queryDescriptor(a.type,"resizable");"none"!==d&&(this._resizable=d);this._dropCursor=k.queryDescriptor(a.type,"dropCursor")}this._requireHelpers(a)},activate:function(a){(this._context=a)&&a.rootNode&&(this._oldCursor=a.rootNode.style.cursor);a.rootNode.style.cursor="crosshair"},deactivate:function(){this._context&&
this._context.rootNode&&(this._context.rootNode.style.cursor=this._oldCursor);this._setTarget(null);delete this._mdPosition;this._context.dragMoveCleanup()},_getContentPosition:function(a){if(a)return a.target&&(a={x:a.pageX,y:a.pageY}),a},onMouseDown:function(c){this._target=a.getEnclosingWidget(c.target);this._mdPosition=this._getContentPosition(c);this._dragRect=null},onMouseMove:function(a){var c=this._context,d=c._chooseParent;a.target!=this._lastEventTarget&&d.setProposedParentWidget(null);
this._lastEventTarget=a.target;if(this._mdPosition){if(this._resizable){c.deselect();var f=this._getContentPosition(a),g,k,n=!0,h=!0;f.x>=this._mdPosition.x?(d=this._mdPosition.x,k=f.x-this._mdPosition.x):(d=f.x,k=this._mdPosition.x-f.x,n=!1);f.y>=this._mdPosition.y?(g=this._mdPosition.y,f=f.y-this._mdPosition.y):(g=f.y,f=this._mdPosition.y-f.y,h=!1);a.shiftKey&&(k>=f?(f=k,h||(g=this._mdPosition.y-f)):(k=f,n||(d=this._mdPosition.x-k)));this._dragSizeRect||(a=c.getDocument().body,this._dragSizeRect=
dojo.create("div",{style:"border:1px dashed black;z-index:1000001;position:absolute;"},a));a=this._dragSizeRect.style;a.left=d+"px";a.top=g+"px";a.width=k+"px";a.height=f+"px"}}else d=!this.createWithFlowLayout(),this._setTarget(a.target,a),g=c.getPreference("showPossibleParents"),g=!g&&this._spaceKeyDown||g&&!this._spaceKeyDown,k={x:a.pageX,y:a.pageY},f={l:a.pageX,t:a.pageY,w:0,h:0},n=b.getPreferences("davinci.ve.editorPrefs",e.getProject()).snap&&d,h=!d,"object"==typeof this._dropCursor&&!1===this._dropCursor.show&&
(h=!1),c.dragMoveUpdate({data:this._data,position:k,absolute:d,currentParent:null,eventTarget:a.target,rect:f,doSnapLinesX:n,doSnapLinesY:n,doFindParentsXY:g,doCursor:h,beforeAfter:this._dropCursor&&this._dropCursor.beforeAfter})},onMouseUp:function(c){var d=this._context,b=d._chooseParent,f=!this.createWithFlowLayout();this._dragSizeRect&&(this._dragSizeRect.parentNode.removeChild(this._dragSizeRect),this._dragSizeRect=null);var g=d.getActiveDragDiv();g&&(g=dojo.query(".maqCandidateParents",g),1==
g.length&&(g[0].innerHTML=""));this._lastEventTarget=null;var n,h,q,u,g=this._getContentPosition(c);if(this._mdPosition){var m=!0,r=!0;this._position=dojo.mixin({},this._mdPosition);g.x<this._mdPosition.x&&(this._position.x=g.x);"height"==this._resizable?q=0:0<=g.x-this._mdPosition.x?q=g.x-this._mdPosition.x:(q=this._mdPosition.x-g.x,m=!1);g.y<this._mdPosition.y&&(this._position.y=g.y);"width"==this._resizable?u=0:0<=g.y-this._mdPosition.y?u=g.y-this._mdPosition.y:(u=this._mdPosition.y-g.y,r=!1);
c.shiftKey&&(q>=u?(u=q,r||(t=this._mdPosition.y-u)):(q=u,m||(l=this._mdPosition.x-q)))}else this._position=g;this._resizable&&this._position&&(4<q||4<u)&&(n={w:0<q?q:void 0,h:0<u?u:void 0});if(q=b.getProposedParentWidget()){if(h=q.parent,q.refChild){var p=q.parent.getChildren().indexOf(q.refChild);0<=p?q.refAfter&&p++:p=null}}else{c=this._getTarget()||a.getEnclosingWidget(c.target);var G=this._data;q=b.getAllowedTargetWidget(c,G,!0,{absolute:f});var N=dojo.isArray(G)?G[0].type:G.type,M=a.getWidgetHelper(N);
1<q.length&&M&&M.chooseParent?h=M.chooseParent(q):0<q.length&&(h=0<=q.indexOf(c)?c:q[0])}b.setProposedParentWidget(null);b=function(a){this.prototype=Error.prototype;this.name="InvalidTargetWidgetError";this.message=a?a:"The selected target is not a valid parent for the given widget."};try{G=this._data instanceof Array?this._data:[this._data];if(!h){var K=G.map(function(a){return a.type}).join(", "),F=G.map(function(a){var c=k.getAllowedParent(a.type);a=a.type;var d=k.queryDescriptor(a,"class");a=
d?d.split(/\s+/).push(a):[a];return{allowedParent:c,classList:a}});n="The selected target is not a valid parent for the given widget.";1===F.length&&F[0].allowedParent&&(n+=['The widget \x3cspan style\x3d"font-family: monospace"\x3e',K,"\x3c/span\x3e requires ",1<F[0].allowedParent.length?"one of the following parent types":"the parent type",' \x3cspan style\x3d"font-family: monospace"\x3e',F[0].allowedParent.join(", "),"\x3c/span\x3e."].join(""),N=G[0].type,(M=a.getWidgetHelper(N))&&M.isAllowedError&&
(n=M.isAllowedError({errorMsg:n,type:N,allowedParent:F[0].allowedParent,absolute:f})));debugger;throw new b(n);}for(f=0;f<G.length;f++){var J=G[f].type,H=k.getLibraryForType(J),P=H.name,N=[J,d];d._widgets.hasOwnProperty(P)||(d._widgets[P]=0);1==++d._widgets[P]&&k.invokeCallback(H,"onFirstAdd",N);k.invokeCallback(H,"onAdd",N)}this.create({target:h,index:p,directTarget:this._getTarget(),size:n,userData:this._userData})}catch(R){var O,Q;R instanceof b?(O=R.message,Q="Invalid Target"):(O="The action was interrupted by an internal error.",
Q="Error",console.error(R));e.showMessage(Q,O)}finally{this.exitCreateToolOnMouseUp()&&d.setActiveTool(null),this._cleanupActions()}},_cleanupActions:function(){var a=this._context;a.dragMoveCleanup();a.inlineEditActive()||this._context.getDocument().defaultView.focus()},onKeyDown:function(a){dojo.stopEvent(a);var c=this._context;if(a.keyCode==dojo.keys.ESCAPE)c.setActiveTool(null),this._cleanupActions();else{var d=this._context.getPreference("showPossibleParents");a.keyCode==dojo.keys.SPACE?this._spaceKeyDown=
!0:this._processKeyDown(a.keyCode);a=!d&&this._spaceKeyDown||d&&!this._spaceKeyDown;var d=this._data,d=dojo.isArray(d)?d[0].type:d.type,c=c._chooseParent,b=!this.createWithFlowLayout(),f=!b;"object"==typeof this._dropCursor&&!1===this._dropCursor.show&&(f=!1);c.dragUpdateCandidateParents({widgetType:d,showCandidateParents:a,absolute:b,doCursor:f,beforeAfter:this._dropCursor&&this._dropCursor.beforeAfter,currentParent:null})}},_processKeyDown:function(a){if(49<=a&&57>=a){var c=this._context._chooseParent,
d=c.getProposedParentsList();d&&1<d.length&&(a=d.length-(a-48),0<=a&&c.setProposedParentWidget(d[a]))}},onKeyUp:function(a){a.keyCode==dojo.keys.SPACE&&(this._spaceKeyDown=!1);dojo.stopEvent(a);a=this._context.getPreference("showPossibleParents");a=!a&&this._spaceKeyDown||a&&!this._spaceKeyDown;var c=this._data,c=dojo.isArray(c)?c[0].type:c.type,d=this._context._chooseParent,b=!this.createWithFlowLayout(),f=!b;"object"==typeof this._dropCursor&&!1===this._dropCursor.show&&(f=!1);d.dragUpdateCandidateParents({widgetType:c,
showCandidateParents:a,absolute:b,doCursor:f,beforeAfter:this._dropCursor&&this._dropCursor.beforeAfter,currentParent:null})},_requireHelpers:function(c){var d=[];if(!c||!c.type)return c instanceof Array&&c.forEach(function(a){d.concat(this._requireHelpers(a))},this),d;d.push(a.requireWidgetHelper(c.type));c.children&&!dojo.isString(c.children)&&dojo.every(c.children,function(a){return d.concat(this._requireHelpers(a))},this);return d},create:function(a){if(a&&this._data){for(var c=a.target,d,b;c&&
!(d=c.getContainerNode());)b=c,c=c.getParent();var f=a.index,g;d=!1;this._data.properties&&this._data.properties.style&&0<this._data.properties.style.indexOf("absolute")&&(d=!0);!d&&this.createWithFlowLayout()?b&&(f=c.indexOf(b)):a.position?g=a.position:this._position&&(g=this._position);this._data.context=this._context;n(this._requireHelpers(this._data)).then(function(){this._create({parent:c,index:f,position:g,size:a.size,userData:this._userData})}.bind(this))}},_create:function(b){var f=this._context,
k=[],e=new g;if(!this._loadType(this._data,k))return e.reject(),e;n(k).then(function(){var g;this.createNewWidget()?dojo.withDoc(this._context.getDocument(),function(){g=a.createWidget(this._data,this._userData,b.parent)},this):g=this._widget;g||e.reject(Error("Failed to create widget"));var k=new d;if(this.createNewWidget()){b.size=this._getInitialSize(g,b);k.add(new c(g,b.parent||this._context.getContainerNode(),b.index));var n=!0;g&&g.properties&&1==g.properties.ignorePosition&&(n=!1);g&&g.metadata&&
1==g.metadata.ignorePosition&&(n=!1);b.position&&n&&(n=f.getPreference("absoluteWidgetsZindex"),"xblox/RunScript"!==g.type&&"xblox/CSSState"!==g.type&&(k.add(new r(g,[{position:"absolute"},{"z-index":n}])),k.add(new q(g,b.position.x,b.position.y))));if(b.size){var n=b.size.w,h=b.size.h;if(null!==n&&null!==h){k.add(new u(g,n,h));var m=a.getWidgetHelper(g.type);if(m&&m.onCreateResize)m.onCreateResize(k,g,n,h)}}this.checkAddToCurrentState(k,g)}n=g.id;this.addToCommandStack&&this.addToCommandStack(k,
{widget:g});k.isEmpty()||this._context.getCommandStack().execute(k);g.isLayoutContainer&&g.resize();g=a.byId(n);this._select(g);this._widget=g;e.resolve(g);this.mouseUpProcessingCompleted()}.bind(this));return e},_loadType:function(a,c){if(!a||!a.type)return!1;c.push(this._context.loadRequires(a.type,!0));a.children&&!dojo.isString(a.children)&&dojo.forEach(a.children,function(a){this._loadType(a,c)}.bind(this));return!0},_getInitialSize:function(a,c){var d=c.size,b=a.getHelper();b&&b.initialSize&&
(b=b.initialSize(c))&&(d=b);!d&&(b=k.queryDescriptor(a.type,"initialSize"))&&(c&&!c.position?(d=c.parent,"html.body"==d.type?d="auto"==b||"auto"==b.flow?{w:"100%",h:"auto"}:this._getExplicitFlowSizeFromMetadata(b):this._isTypeContainer(d.type)?"auto"==b||"auto"==b.flow?(d=d.getData().children,d={w:"100%",h:d&&d.length?"auto":"100%"}):d=this._getExplicitFlowSizeFromMetadata(b):d=this._getExplicitFlowSizeFromMetadata(b)):d="auto"==b||"auto"==b.absolute?{w:"300px",h:"300px"}:this._getExplicitAbsoluteSizeFromMetadata(b));
return d},_getExplicitFlowSizeFromMetadata:function(a){var c=null;return c=a.flow?{w:a.flow.width?a.flow.width:"100%",h:a.flow.height?a.flow.height:"auto"}:{w:a.width?a.width:"100%",h:a.height?a.height:"auto"}},_getExplicitAbsoluteSizeFromMetadata:function(a){var c=null;return c=a.absolute?{w:a.absolute.width?a.absolute.width:"300px",h:a.absolute.height?a.absolute.height:"300px"}:{w:a.width?a.width:"300px",h:a.height?a.height:"300px"}},_isTypeContainer:function(a){return a&&("dijit/layout/ContentPane"==
a||"html.div"==a||"html.form"==a||"html.fieldset"==a)},_select:function(a){if(a)if(a.type){var c=k.getSmartInput(a.type);c&&c.then?c.then(function(c){!this._data.fileDragCreate&&c&&c.displayOnCreate?(a.inLineEdit_displayOnCreate=c.displayOnCreate,this._context.select(a,null,!0)):this._context.select(a)}.bind(this)):(console.error("create tool failed::_select smart input is null"),this._context.select(a))}else console.error("create tool failed::_select w.type is null");else console.error("create tool failed::_select w is null")},
createWithFlowLayout:function(){return k.queryDescriptor(this._data.type,"forceAbsolute")?!1:this._context.getFlowLayout()},createNewWidget:function(){return!0},exitCreateToolOnMouseUp:function(){return!0},mouseUpProcessingCompleted:function(){},checkAddToCurrentState:function(a,c){var d=f.getFocus(c._edit_context.rootNode);if(d&&d.stateContainerNode){var d=f.getState(d.stateContainerNode),g=b.getPreferences("davinci.ve.editorPrefs",e.getProject());d&&g.newWidgetsCurrentState&&(g=m.get(c.domNode,
"display"),a.add(new r(c,[{display:"none"}])),a.add(new r(c,[{display:g}],d)))}}})})},"davinci/ve/tools/_Tool":function(){define(["dojo/_base/declare","davinci/ve/widget","davinci/ve/metadata","davinci/ve/utils/GeomUtils"],function(p,m,h,e){return p("davinci.ve.tools._Tool",null,{_getTarget:function(){return this._target},_setTarget:function(b,k){this._targetOverlays||(this._targetOverlays=[]);if(!this._matchesTargetOverlay(b)){for(var a=this._context.getContainerNode(),g;b&&b!=a;)if((g=m.getEnclosingWidget(b))&&
!g.getContext())b=g.domNode.parentNode,g=null;else{g&&davinci.ve.metadata.queryDescriptor(g.type,"enablePointerEvents")?g=null:g&&g.getContainerNode()&&(davinci.ve.metadata.queryDescriptor(g.type,"isControl")||(g=null));break}g?(this._target=g,this._updateTargetOverlays(k),this._insertTargetOverlays()):(this._removeTargetOverlays(),this._target=null)}},_updateTargetOverlays:function(b){this._removeTargetOverlays();if(this._target){var k=this._target.domNode,a=this._getMaxZIndex(k);if(this._targetOverlays){var g=
this._target.getHelper();if(g&&g.getTargetOverlays&&(g=g.getTargetOverlays(this._target))&&0<g.length){dojo.forEach(g,function(c){c=this._getNewTargetOverlay(c,c.x,c.y,c.width,c.height,a);this._targetOverlays.push(c)},this);return}var g=k.offsetLeft,n=k.offsetTop,f=k.offsetWidth,d=k.offsetHeight;if(b){var c,h=e.getBorderBoxPageCoordsCached(k);b.pageX<h.l&&(c=h.l-b.pageX,g-=c,f+=c);b.pageY<h.t&&(c=h.t-b.pageY,n-=c,d+=c);b.pageX>h.l+h.w&&(c=b.pageX-(h.l+h.w),f+=c);b.pageY>h.t+h.h&&(c=b.pageY-(h.t+h.h),
d+=c)}b=this._getNewTargetOverlay(k,g,n,f,d,a);this._targetOverlays.push(b)}}},_getMaxZIndex:function(b){var k=dojo.style(b,"zIndex");dojo.query("*",b).forEach(function(a){a=dojo.style(a,"zIndex");var b=Number(a),n=Number(k);isNaN(b)||(isNaN(n)?k=a:b>n&&(k=a))});return k},_getNewTargetOverlay:function(b,k,a,g,n,f){return this._context.getDojo().create("div",{className:"editFeedback",style:{position:"absolute",opacity:.1,left:k+"px",top:a+"px",width:g+"px",height:n+"px",zIndex:f}})},_insertTargetOverlays:function(){if(this._targetOverlays&&
this._target){var b=this._target.domNode,k=b.parentNode;dojo.forEach(this._targetOverlays,function(a){k.insertBefore(a,b.nextSibling)},this)}},_removeTargetOverlays:function(){if(this._targetOverlays&&this._target)for(var b=this._targetOverlays.length-1;0<=b;b--)dojo.destroy(this._targetOverlays[b]),this._targetOverlays.pop()},_matchesTargetOverlay:function(b){return dojo.some(this._targetOverlays,function(k){return b==k},this)}})})},"davinci/ve/commands/ResizeCommand":function(){define(["dojo/_base/declare",
"dojo/dom-geometry","davinci/ve/widget","davinci/ve/States","davinci/ve/utils/StyleArray"],function(p,m,h,e,b){return p("davinci.ve.commands.ResizeCommand",null,{name:"resize",constructor:function(b,a,g,n){this._id=b?b.id:void 0;b=/^\s*[-+]?[0-9]*\.?[0-9]+\s*$/;b.test(a)&&(a=parseFloat(a));b.test(g)&&(g=parseFloat(g));this._newBox={w:a,h:g};this._applyToStateIndex=n&&"Normal"!=n&&"undefined"!=n?n:"undefined"},execute:function(){if(this._id&&this._newBox){var k=h.byId(this._id);if(k&&k.domNode){var a=
k.domNode,g=a.ownerDocument.defaultView.getComputedStyle(a),n=m.getContentBox(a,g);this._oldBox={w:n.w,h:n.h};var n=this._newBox.w,f=this._newBox.h;this._usesBorderBox(a)&&(a=m.getPadBorderExtents(a,g),"number"==typeof n&&0<=n&&(n+=a.w),"number"==typeof f&&0<=f&&(f+=a.h));a=[{}];"number"==typeof n?a[0].width=n+"px":"string"==typeof n&&(a[0].width=n);"number"==typeof f?a[0].height=f+"px":"string"==typeof f&&(a[0].height=f);n=k.getStyleValuesAllStates();this._oldStyleValuesAllStates=dojo.clone(n);this._oldBox&&
(this._oldStyleValuesAllStates[this._applyToStateIndex]=b.mergeStyleArrays(this._oldStyleValuesAllStates[this._applyToStateIndex],[{width:this._oldBox.w+"px"},{height:this._oldBox.h+"px"}]));n[this._applyToStateIndex]=n[this._applyToStateIndex]?b.mergeStyleArrays(n[this._applyToStateIndex],a):a;k.setStyleValuesAllStates(n);f=e.getStatesListCurrent(k.domNode);a=b.mergeStyleArrays([],n.undefined);for(g=0;g<f.length;g++)n[f[g]]&&(a=b.mergeStyleArrays(a,n[f[g]]));k.setStyleValuesCanvas(a);k.setStyleValuesModel(n.undefined);
this._resize(k);e.resetState(k.domNode);dojo.publish("/davinci/ui/widgetPropertiesChanged",[[k]])}}},setContext:function(b){this._context=b},undo:function(){if(this._id){var k=h.byId(this._id);if(k){var a=this._oldStyleValuesAllStates,g=this._applyToStateIndex;k.setStyleValuesAllStates(a);a=b.mergeStyleArrays(a.undefined,a[g]);k.setStyleValuesCanvas(a);k.setStyleValuesModel(this._oldStyleValuesAllStates.undefined);this._resize(k);e.resetState(k.domNode);dojo.publish("/davinci/ui/widgetPropertiesChanged",
[[k]])}}},_usesBorderBox:function(b){var a=b.tagName.toLowerCase();(b=b.getAttribute("type"))&&(b=b.toLowerCase(b));return"table"==a||"button"==a||"input"==a&&"button"==b},_resize:function(b){var a=b.getParent();a&&a.dijitWidget&&a.dijitWidget.isLayoutContainer?a.resize():b.resize&&b.resize();b.renderWidget();b._updateSrcStyle()}})})},"davinci/ve/themeEditor/metadata/CSSThemeProvider":function(){define(["dojo/_base/declare","../../utils/pseudoClass"],function(p,m){return p("davinci.ve.themeEditor.metadata.CSSThemeProvider",
null,{module:"davinci.lib",path:"theme/tundra.json",constructor:function(h,e){this._theme=e;this.url=encodeURI(h[0].getURL());this.getWidgets()},getWidgets:function(){if(!this._widgets){var h=void 0;dojo.xhrGet({url:""+this.url,handleAs:"json",sync:!0,load:function(e){h=e}});this._widgets=h;this._createDefaults()}return this._widgets},_createDefaults:function(){for(var h in this._widgets){var e=this._widgets[h],b;for(b in e){var k=e[b],a;for(a in k.states)this.getStyleSelectors(h+"."+b,a);for(var g in k.subwidgets){var n=
k.subwidgets[g];for(a in n.states)this.getStyleSelectors(h+"."+b,a,g)}}}},getRelativeStyleSelectorsText:function(h,e,b,k,a){var g=this.getStyleSelectors(h,e,b),n=[];for(s in g)k.forEach(function(b){for(var d=!1,c=0;!d&&c<g[s].length;c++)if(g[s][c]==b||"$std_10"==g[s][c])d=!0;if(d){var k=""+s;b=k.split(" ");k="";b.forEach(function(c){c!="."+a&&(k+=" "+c)}.bind(this));n.push(k.replace(/^\s*/,"").replace(/\s*$/,""))}}.bind(this));return n},getStyleSelectors:function(h,e,b){if(h){e||(e="Normal");var k,
a=h.split(/[\.\/]/);h=a[0];a=a[a.length-1];if(b&&h in this._widgets&&a in this._widgets[h]){b=b.id?b.id:b;if(!this._widgets[h][a].subwidgets[""+b].states[""+e])return null;k=this._widgets[h][a].subwidgets[""+b].states[""+e].selectors;k&&"$auto"!=k||(k=this._createDefaultSelectors(""+h+b,e),this._widgets[h][a].subwidgets[""+b].states[""+e].selectors=k)}else this._widgets&&h in this._widgets&&a in this._widgets[h]&&this._widgets[h][a].states[""+e]&&(k=this._widgets[h][a].states[""+e].selectors,k&&"$auto"!=
k||(k=this._createDefaultSelectors(""+h+a,e),this._widgets[h][a].states[""+e].selectors=k));return k}},getElementStyleProperties:function(h,e,b){if(h){e||(e="Normal");var k,a=h.split(/[\.\/]/);h=a[0];a=a[a.length-1];if(b&&h in this._widgets&&a in this._widgets[h]){b=b.id?b.id:b;if(!this._widgets[h][a].subwidgets[""+b].states[""+e]||!this._widgets[h][a].subwidgets[""+b].states[""+e].element||!this._widgets[h][a].subwidgets[""+b].states[""+e].element.style)return null;k=this._widgets[h][a].subwidgets[""+
b].states[""+e].element.style}else this._widgets&&h in this._widgets&&a in this._widgets[h]&&this._widgets[h][a].states[""+e]&&this._widgets[h][a].states[""+e].element&&this._widgets[h][a].states[""+e].element.style&&(k=this._widgets[h][a].states[""+e].element.style);return k}},_createDefaultSelectors:function(h,e){var b={};b["Normal"==e?"."+this._theme.className+" ."+h:"."+this._theme.className+" ."+h+e]=["$std_10"];return b},_createDefaultQuery:function(h,e){return"."+h},_simulateState:function(h,
e,b,k){for(var a=h instanceof Array?h:[h],g=e instanceof Array?e:[e],n=0;n<g.length;n++){var f=g[n],d=a[n],c,q,u;-1<(c=f.indexOf(":"))&&(q=f.substring(c+1),f=f.substring(0,c),c=q.indexOf("\x3d"),-1<c?(u=q.substring(c+1),q=q.substring(0,c)):u=q);d=dojo.query(d,k.domNode)[0];d||(d=k.domNode);try{"add"==b?(q&&d.setAttribute(q,u),f&&dojo.addClass(d,f)):(q&&d.removeAttribute(q),f&&dojo.removeClass(d,f))}catch(m){console.error("CSSThemeProvider._simulateState invalid simulate in metadata for "+k.type+" "+
h+": "+e)}}},_updateStyle:function(h,e,b,k){if("all"!==h.id){var a=!1;b||(b="Normal",a=!0);if(!this._widgets)return null;e||(e=h.type);var g=e.split(/[\.\/]/),n=g[0],f=g[g.length-1],g=this._widgets[n][f];"Normal"===b&&1==a&&"remove"===k&&this._widgets[n][f].startState&&(b=this._widgets[n][f].startState);if(this._widgets[n][f].states[""+b]){var d=this._widgets[n][f].states[""+b].query;d&&"$auto"!=d||(d=this._createDefaultQuery(n+f,b),g.states[""+b].query=d);f=this._widgets[n][f].states[""+b].simulate;
if(!f){var f=" ",c=this.getStyleSelectors(e,b),q="",u;for(u in c)q=m.replace(u),q=q.replace(/\./g," "),q=q.replace(this._theme.className,""),f+=" "+q;"Normal"!=b&&(f=n+b+" "+f)}"Normal"!=b&&(f+=" "+m.MAQETTA_PSEUDO_CLASS+b,this._simulateState(d,f,k,h))}for(var r in g.subwidgets)if(c=g.subwidgets[r],"Normal"===b&&1==a&&"remove"===k&&c.startState&&(b=c.startState),c.states[""+b]){d=c.states[""+b].query;f=c.states[""+b].simulate;d&&"$auto"!=d||(d=this._createDefaultQuery(n+r,b),c.states[""+b].query=
d);if(!f){c=this.getStyleSelectors(e,b,r);f=" ";for(u in c)q=m.replace(u).replace(/\./g," ").replace(this._theme.className,""),f+=" "+q;"Normal"!=b&&(f=n+b+" "+f)}"Normal"!=b&&this._simulateState(d,f,k,h)}}},setStyleValues:function(h,e,b,k){this._updateStyle(h,e,b,"add")},removeStyleValues:function(h,e,b,k){b&&"Normal"!=b&&this._updateStyle(h,e,b,"remove")},setWidgetStyleValues:function(h,e){davinci.ve.widget.getWidget(h);this._updateStyle(h,null,e,"add")},removeWidgetStyleValues:function(h,e){this._updateStyle(h,
null,e,"remove")},getDomNode:function(h,e,b,k){if(!this._widgets)return null;k||(k="Normal");var a=e.split(/[\.\/]/);e=a[0];var a=a[a.length-1],g;try{b?(g=this._widgets[e][a].subwidgets[""+b].states[""+k].query,g&&"$auto"!=g||(g=this._createDefaultQuery(e+b,k),this._widgets[e][a].subwidgets[""+b].states[""+k].query=g)):(g=this._widgets[e][a].states[""+k].query,g&&"$auto"!=g||(g=this._createDefaultQuery(e+a,k),this._widgets[e][a].states[""+k].query=g))}catch(n){return null}(a=dojo.query(g instanceof
Array?g[0]:g,h)[0])||(a=h);return a},getMetadata:function(h){if(h){var e=h.split(/[\.\/]/);h=e[0];e=e[e.length-1];return this._widgets&&this._widgets[h]&&this._widgets[h][e]}},getWidgetType:function(h){var e;e=h.type;h=h.id;0===h.indexOf("all")&&(e=e+".$"+h);return e},isPropertyVaildForWidgetRule:function(h,e,b,k,a){b=this.getWidgetType(b);b=this.getMetadata(b);k&&(b=b.subwidgets[k]);b=a?b.states[a]:b.states.Normal;h=h.getSelectorText();for(var g in b.selectors)if(k=b.selectors[g],h==g)for(a=0;a<
k.length;a++){var n=k[a];if("$std_10"==n||n==e)return!0}return!1},isPropertyRuleValid:function(h,e,b){h=h.getSelectorText();for(var k in b.states){var a=b.states[k],g;for(g in a.selectors){var n=a.selectors[g];if(h==g)for(var f=0;f<n.length;f++){var d=n[f];if("$std_10"==d||d==e)return!0}}}for(var c in b.subwidgets){var q=b.subwidgets[c];for(k in q.states)for(g in a=q.states[k],a.selectors)if(n=a.selectors[g],h==g)for(f=0;f<n.length;f++)if(d=n[f],"$std_10"==d||d==e)return!0}return!1},isPropertyValidForRule:function(h,
e){h.getSelectorText();for(var b in this._widgets){var k=this._widgets[b],a;for(a in k)if(this.isPropertyRuleValid(h,e,k[a]))return!0}return!1},getStatesForAllWidgets:function(){if(!this._widgets)return null;states=[];for(var h in this._widgets){var e=this._widgets[h],b;for(b in e)if(0!=b.indexOf("$all")){var k=e[b],a;for(a in k.states)states[a]=a;for(var g in k.subwidgets){var n=k.subwidgets[g];for(a in n.states)states[a]=a}}}retStates=[];for(var f in states)retStates.push(f);return retStates.sort()},
isStateValid:function(h,e,b){if(!this._widgets||"all"===h.id&&"Normal"!=e)return!1;h=this.getMetadata(h.type);if(h.states[e]&&!b)return!0;if(b){if((b=h.subwidgets[b])&&b.states[e])return!0}else for(var k in h.subwidgets)if(b=h.subwidgets[k],b.states[e])return!0;return!1}})})},"davinci/ve/utils/pseudoClass":function(){define([],function(){return{MAQETTA_PSEUDO_CLASS:"maqettaPseudoClass",replace:function(p){return"hover link visited active focus first-letter first-line first-child before after".split(" ").reduce(function(m,
h){return m.replace(new RegExp(":"+h,"g"),".maqettaPseudoClass"+h[0].toUpperCase()+h.slice(1))},p)}}})},"davinci/ve/themeEditor/metadata/query":function(){define(["dojo/_base/declare","davinci/ve/utils/URLRewrite"],function(p,m){return p("davinci.ve.themeEditor.metadata.query",null,{constructor:function(h,e){this.files=h;this.cache={};this.lastLoaded=-1;this.modules=e;this.modulePrefix=null;this.modulePrefix=".";if(e)for(var b=0;b<e.length;b++)this.modulePrefix+="/"+e[b]},getType:function(h){var e=
null;h.declaredClass?e=h.type:(e=h,"html."==e.substring(0,5)&&(tagName=e.substring(5)));return e},_loadNextFile:function(){var h=this.files[++this.lastLoaded],e=null,e=h.getURL?m.encodeURI(h.getURL()):this.modulePrefix+h,b=null;dojo.xhrGet({url:e,handleAs:"json",sync:!0,load:function(k){b=k}});return b},_fullyLoaded:function(){return this.files.length<=this.lastLoaded+1},_cacheNext:function(){var h=this._loadNextFile();dojo.mixin(this.cache,h)},getMetaData:function(h){var e=h.split(/[\.\/]/),b=0<=
e.length?e[e.length-1]:e;return(e=this.cache[0<=e.length?e[0]:e])&&e[b]?e[b]:this._fullyLoaded()?null:(this._cacheNext(),this.getMetaData(h))}})})},"davinci/ve/input/MultiFieldSmartInput":function(){define("dojo/_base/declare davinci/Runtime davinci/ve/input/SmartInput davinci/ve/widget davinci/ve/commands/ModifyCommand dojox/html/entities dijit/form/DateTextBox dijit/form/TimeTextBox dojo/i18n!dijit/nls/common dojo/text!./templates/MultiFieldSmartInput.html dojo/text!./templates/MultiFieldTableRowSmartInput.html dojo/text!./templates/MultiFieldMultiLineTableRowSmartInput.html dijit/Tooltip davinci/css!./templates/MultiFieldSmartInput.css".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q){return p(h,{property:[{property:"placeholder",multiLine:!1},{property:"value",multiLine:!1}],displayOnCreate:"true",delimiter:", ",multiLine:"true",supportsHTML:"false",_substitutedMainTemplate:null,destroyTooltips:function(){this.property.forEach(function(a){dijit.byId("MultiFieldSmartInput_SmartInput_checkbox_"+(a.property||a.child.property)+"_tooltip").destroyRecursive()}.bind(this))},_getEditor:function(){return m.currentEditor},_getContext:function(){var a=
this._getEditor();return a&&(a.getContext&&a.getContext()||a.context)},getHelpText:function(){var a="";this.helpText?a=this.helpText:this.property.forEach(function(c){var d=c.property||c.child.property,b=this._widget.metadata.property[d]?this._widget.metadata.property[d].description:null;c.helpText&&(b=c.helpText);b&&(a=a+"\x3ci\x3e"+this.getTitle(d)+":\x3c/i\x3e "+k.encode(b)+"\x3cbr\x3e")}.bind(this));1>a.length&&(a="The toolkit provider has not supplied help for this widget, please consult your provider.");
return a},getTitle:function(a){return a},getPropertyObject:function(a){for(var c=0;c<this.property.length;c++){if(this.property[c].property&&this.property[c].property==a)return this.property[c];if(this.property[c].child&&this.property[c].child.property==a)return this.property[c].child}},onOk:function(a){a=this._getContext();var c={},d=null;this.property.forEach(function(a){var b=a.property||a.child.property,f=this._getStringValueOfTextBox(b),b=dijit.byId("MultiFieldSmartInput_SmartInput_checkbox_"+
b);a.supportsHTML&&b.checked||(f=k.encode(f));a.child?(d=this.parseChildren(a,f),a.property&&(c[a.property]=this.getSelectedOption(this._widget,d))):c[a.property]=f}.bind(this));var f=new b(this._widget,c,d,a);a.getCommandStack().execute(f);this.hide()},parseChildren:function(a,c){for(var d=this._widget.getData(),b=this.parseItems(c),d=d.children,f=0;f<b.length;f++){c=b[f];var g=c.text;a.child.supportsHTML||(b[f].text=dojox.html.entities.decode(g));if(f<d.length){var n=d[f];n.children=g;n.properties.value=
g;n.properties.selected=c.selected}else n={},n.type=a.child.type,n.properties={},n.properties[a.child.property]=g,c.selected&&(n.properties.selected=c.selected),n.children=g||c,d.push(n)}if(0<b.length)for(g=d.length,f=b.length;f<g;f++)d.pop();return d},hide:function(){if(this._inline){for(;connection=this._connection.pop();)connection&&dojo.disconnect(connection);var a=this._findSmartInputContainer(this._widget._edit_context.frameNode);if(a&&(this._loadingDiv&&a.removeChild(this._loadingDiv),"none"!=
this._inline.style.display)){this._format=this.getFormat();this._inline.style.display="none";this.destroyTooltips();this._inline.destroyRecursive();delete this._inline;var c=a.ownerDocument.getElementById("iebPointer");a.removeChild(c);this._widget.getContext().getDocument().defaultView.focus()}}},show:function(a){this._lastKeyCode=0;this._widget=e.byId(a);this._widget.getData();this._loading(255,200);dojo.addClass("ieb","MultiFieldSmartInput");a=this._getTemplate();this._inline.attr("content",a);
this._connection.push(dojo.connect(this._inline,"onBlur",this,"onOk"));this._connectHelpDiv();this._connectResizeHandle();this._connectSimDiv();this._loadingDiv&&(this._loadingDiv.style.backgroundImage="none");a=dijit.byId("MultiFieldSmartInput_SmartInput_"+(this.property[0].property||this.property[0].child.property));dijit.selectInputText(a.textbox);a.focus();this.connectEditBoxes();this.setStartSize();this.resize(null)},connectEditBoxes:function(){this.property.forEach(function(a){a=a.property||
a.child.property;var c=dijit.byId("MultiFieldSmartInput_SmartInput_"+a);this._connection.push(dojo.connect(c,"onMouseDown",this,"stopEvent"));this._connection.push(dojo.connect(c,"onKeyUp",this,"handleEvent"));var d=dojo.byId("MultiFieldSmartInput_SmartInput_checkbox_div_"+a),c=dijit.byId("MultiFieldSmartInput_SmartInput_checkbox_"+a);this._connection.push(dojo.connect(c,"onClick",this,"htmlCheckbox"));new q({id:"MultiFieldSmartInput_SmartInput_checkbox_"+a+"_tooltip",connectId:[d],label:"the text for the tooltip"});
this.updateFormats(a)}.bind(this))},containsHtml:function(a){return dojo.create("div",{innerHTML:a}).children.length?"html":"text"},htmlCheckbox:function(a){var c=a.currentTarget.id.split("_"),d=dijit.byId("MultiFieldSmartInput_SmartInput_"+c[c.length-1]),c=dijit.byId(a.currentTarget.id+"_tooltip"),d=d.getValue(),b="html";a.currentTarget.checked||(d=k.encode(d),b="text");c.attr("label","Format contents as "+b+":\x3cbr\x3e"+d)},setStartSize:function(){var a=0;dojo.query(".MultiFieldSmartInput_SmartInput_value",
"davinci.ve.input.MultiFieldSmartInput_table").forEach(function(c){a+=c.clientHeight+5});dojo.byId("iedResizeDiv");dijit.byId("iedResizeDiv");dojo.style("iedResizeDiv","height",a+5+"px");dojo.style("iedResizeDiv","minHeight",a+5+"px")},handleEvent:function(a){for(var c=!1,d=0;d<this.property.length;d++){var b=this.property[d],f=b.property||b.child.property;if(-1<a.currentTarget.id.indexOf("MultiFieldSmartInput_SmartInput_"+f)){c=b.multiLine;break}}if(13==a.keyCode){if(!c||"false"==c||13==this._lastKeyCode)this.onOk()}else c=
a.target.id.split("_"),f=c[c.length-1],this.updateFormats(f);this._lastKeyCode=a.keyCode;this.updateSimStyle()},updateFormats:function(a){var c=this._getStringValueOfTextBox(a);this.getPropertyObject(a).supportsHTML&&this.containsHtmlMarkUp(c)?dojo.style("MultiFieldSmartInput_SmartInput_checkbox_div_"+a,"display",""):dojo.style("MultiFieldSmartInput_SmartInput_checkbox_div_"+a,"display","none");var d=dijit.byId("MultiFieldSmartInput_SmartInput_checkbox_"+a+"_tooltip"),b="html";dijit.byId("MultiFieldSmartInput_SmartInput_checkbox_"+
a).checked||(c=k.encode(c),b="text");d.attr("label","Format contents as "+b+":\x3cbr\x3e"+c);this.resize(null)},serializeChildren:function(a){var c=[];a.children.forEach(function(d){var b=d.properties.value?d.properties.value:d.children,b=k.decode(b);c.push((d.properties.selected||a.properties.value==b?"+":"")+b)}.bind(this));return c=this.serializeItems(c)},resize:function(a){var c=40;a=dojo.query(".MultiFieldSmartInput_SmartInput_label","davinci.ve.input.MultiFieldSmartInput_table");a.forEach(function(a){a.clientWidth>
c&&(c=a.clientWidth)});a.forEach(function(a){a.clientWidth<c&&dojo.style(a,"width",c+"px")});var d=0;a=dojo.query(".MultiFieldSmartInput_SmartInput_checkbox","davinci.ve.input.MultiFieldSmartInput_table");a.forEach(function(a){a.clientWidth>d&&(d=a.clientWidth)});a.forEach(function(a){a.clientWidth<d&&dojo.style(a,"width",d+"px")});var b=dojo.byId("iedResizeDiv");a=b.clientHeight-6;a=b.clientHeight-50;25>a&&(a=25);var f=[],g=0;this.property.forEach(function(a){var n=dijit.byId("MultiFieldSmartInput_SmartInput_"+
(a.property||a.child.property));n._setStyleAttr({width:b.clientWidth-(c+d+20)+"px"});a.multiLine?f.push(n):g+=n.domNode.clientHeight}.bind(this));if(0<f.length){var n=(b.clientHeight-g-25)/f.length;f.forEach(function(a){a._setStyleAttr({height:n+"px",maxHeight:n+"px"})}.bind(this))}dojo.style("ieb","width",b.clientWidth+15+"px");dojo.style("davinci.ve.input.SmartInput_radio_div","width",b.clientWidth+5+"px")},_getTemplate:function(){return this._substitutedMainTemplate=dojo.replace(f,{buttonOk:n.buttonOk,
buttonCancel:n.buttonCancel,tableContent:this._addPropertiesToHTML(),helpText:this.getHelpText()})},_addPropertiesToHTML:function(){var a=this._widget.getData(),b="";this.property.forEach(function(f){var g=a.properties[f.property]||"",n=this.containsHtmlMarkUp(g)?"checked":"",k=f.property||f.child.property;f.child&&(g=this.serializeChildren(a));if(f.multiLine)b+=dojo.replace(c,{label:this.getTitle(k),textboxId:"MultiFieldSmartInput_SmartInput_"+k,textboxValue:g,checkboxDivId:"MultiFieldSmartInput_SmartInput_checkbox_div_"+
k,checkboxId:"MultiFieldSmartInput_SmartInput_checkbox_"+k,checked:n});else{f=this._widget.metadata.property[k]?this._widget.metadata.property[k].format:null;var e="dijit/form/TextBox";f&&("date"==f?e="dijit/form/DateTextBox":"time"==f&&(e="dijit/form/TimeTextBox"));b+=dojo.replace(d,{label:this.getTitle(k),textboxType:e,textboxId:"MultiFieldSmartInput_SmartInput_"+k,textboxValue:g,checkboxDivId:"MultiFieldSmartInput_SmartInput_checkbox_div_"+k,checkboxId:"MultiFieldSmartInput_SmartInput_checkbox_"+
k,checked:n})}}.bind(this));return b},getSelectedOption:function(a,c){for(var d="",b=0;b<c.length;b++){var f=c[b];if(f.properties.selected){d=f.properties.value;break}}return d},_getStringValueOfTextBox:function(c){c=dijit.byId("MultiFieldSmartInput_SmartInput_"+c);var d=c.getValue();d&&d instanceof Date&&(c instanceof a?d=d.toISOString().substring(0,10):c instanceof g&&(d="T"+d.toTimeString().substring(0,8)));return d},updateSimStyle:function(){}})})},"davinci/ve/input/SmartInput":function(){define("dojo/_base/declare dojo/dom-geometry davinci/ve/commands/ModifyRichTextCommand dijit/layout/ContentPane dojox/html/entities dojo/i18n!davinci/ve/nls/ve dojo/i18n!dijit/nls/common xide/registry".split(" "),
function(p,m,h,e,b,k,a,g){return p("davinci.ve.input.SmartInput",null,{property:null,_X_MOVE_RANGE:10,_Y_MOVE_RANGE:10,_POINTER_TOP_OFFSET:-13,multiLine:"false",displayOnCreate:"true",_connection:[],getHelpText:function(){return this.helpText?this.helpText:this.isHtmlSupported()?k.smartInputHelp1:k.smartInputHelp2},isHtmlSupported:function(){this.supportsHTML||("html"==this._widget.type.match("^html")?this.supportsHTML="true":this.supportsHTML="false");return"boolean"===typeof this.supportsHTML?this.supportsHTML:
"true"===this.supportsHTML},parse:function(a){return a},parseItems:function(a){this.trim&&(a=dojo.trim(a));return a.match(/[^\\][\r\n]/)?this.parseItemsInRows(a):this.parseItemsInColumns(a)},parseItemsInRows:function(a){a=this.splitRows(a);for(var b=a.length,d=0;d<b;d++){var c=a[d],c=this.parseItem(c);a[d]=c}return a},parseItemsInColumns:function(a){a=this.splitColumns(a);for(var b=a.length,d=0;d<b;d++){var c=a[d],c=this.parseItem(c);a[d]=c}return a},parseGrid:function(a){a=this.splitRows(a);for(var b=
a.length,d=0;d<b;d++){var c=this.parseItemsInColumns(a[d]);a[d]=c}return a},parseItem:function(a){var b=null,d=a,c=a.match(/^([-~!>|(*)[+\]]*) ?(.*)$/);c&&(b=c[1],d=c[2]);var c=0,g=!1,k=!1;if(b)for(var e=0;e<b.length;e++)switch(b[e]){case "-":case "~":case "!":g=!0;break;case "\x3e":c++;break;case "*":case "+":k=!0}return{original:a,specialChars:b,text:d,indent:c,disabled:g,selected:k}},splitRows:function(a){var b=[],d,c="",g=!1;for(d=0;d<a.length;d++){var k=a.charAt(d);switch(k){case "\\":g&&(c+=
k);g=!g;break;case "r":g?(c+="\r",g=!1):c+=k;break;case "n":g?(c+="\n",g=!1):c+=k;break;case "\r":case "\n":g?(c+=k,g=!1):(this.trim&&(c=dojo.trim(c)),b.push(c),c="");break;default:c+=k,g=!1}}c&&(this.trim&&(c=dojo.trim(c)),b.push(c));return b},splitColumns:function(a){var b=[],d,c="",g=!1;for(d=0;d<a.length;d++){var k=a.charAt(d);switch(k){case "\\":g&&(c+=k);g=!g;break;case "r":g?(c+="\r",g=!1):c+=k;break;case "n":g?(c+="\n",g=!1):c+=k;break;case ",":g?(c+=k,g=!1):(this.trim&&(c=dojo.trim(c)),b.push(c),
c="");break;default:c+=k,g=!1}}c&&(this.trim&&(c=dojo.trim(c)),b.push(c));return b},serializeItems:function(a){return"columns"==this.format?this.serializeColumns(a):this.serializeRows(a)},serializeColumns:function(a){for(var b=0;b<a.length;b++){var d=a[b],d=d.replace(/\\/g,"\\\\");a[b]=d.replace(/,/g,"\\,")}return a.join(", ")},serializeRows:function(a){for(var b=0;b<a.length;b++){var d=a[b],d=d.replace(/\\/g,"\\\\");a[b]=d.replace(/\n/g,"\\\n")}return a.join("\n")},inlineEditActive:function(){return!(!this._inline||
"none"==this._inline.style.display||!this._inline.eb)},show:function(a){this._widget=davinci.ve.widget.byId(a);this._inline||this._createInline();a=dojo.hitch(this,function(a){this._inline.style.display="block";this.setFormat(a);a=b.decode(a,[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"]]);this._inline.eb.set("value",String(a));this.updateFormats();this.help(!1);dijit.selectInputText(this._inline.eb.textbox);this.updateSimStyle();this._inline.eb.textbox.focus()});var f=this._node(this._widget),
d=this.property,c="maq_innerText"===d?"innerHTML":d,g;d&&(f?g=dojo.attr(f,c):"innerHTML"===c||"textContent"==c?(g=this._widget._srcElement.getElementText(this._context),g=g.replace(/\s+/g," ")):g=this._widget.attr(d));this.serialize?this.serialize(f||this._widget,a,g):d&&a(g)},_createInline:function(){if(this.multiLine&&"false"!=this.multiLine){this._loading(115,200);var a=this._getTemplate()}else this._loading(85,200),a=this._getTemplate();this._inline.set("content",a);this._inline.eb=dijit.byId("davinciIleb");
this._connection.push(dojo.connect(this._inline.eb,"onMouseDown",this,"stopEvent"));this._connection.push(dojo.connect(this._inline.eb,"onKeyDown",this,"stopEvent_Intercept_Enter"));this._connection.push(dojo.connect(this._inline.eb,"onKeyUp",this,"handleEvent"));"true"==this.multiLine&&(this._connection.push(dojo.connect(this._inline.eb,"onBlur",this,"onBlur")),this._connectSimDiv());a=this._widget._srcElement.getElementText(this._context);this._inline.eb.setValue(a);this._loadingDiv.style.backgroundImage=
"none";this._inline._setStyleAttr({display:"block"});this._connectHelpDiv();window.setTimeout(function(){this._inline&&this._inline.eb&&this._inline.eb.textbox&&this._inline.eb.textbox.focus();this._connection.push(dojo.connect(this._inline,"onBlur",this,"onOk"))}.bind(this),500);this.resize(null)},_connectHelpDiv:function(){var a=dojo.byId("davinci.ve.input.SmartInput_img_help");this._connection.push(dojo.connect(a,"onclick",this,"toggleHelp"));this._connection.push(dojo.connect(dijit.byId("davinci.ve.input.SmartInput_ok"),
"_onSubmit",this,"onOk"));this._connection.push(dojo.connect(dijit.byId("davinci.ve.input.SmartInput_cancel"),"onClick",this,"onCancel"))},_findSmartInputContainer:function(a){return document.body},_loading:function(a,b){this._widget&&this._widget._edit_context||console.error("have no widget");var d=this._widget._edit_context.frameNode,c=d.ownerDocument,k=c.createElement("div"),h=this._findSmartInputContainer(d);if(h){h.appendChild(k);this._loadingDiv=k;dojo.addClass(k,"smartInputLoading");k=c.createElement("div");
k.id="ieb";dojo.addClass(k,"inlineEdit dijitTooltipContainer");c=c.createElement("div");c.id="iebPointer";this._inline=k;h.appendChild(k);h.appendChild(c);var r=new dojo.dnd.Moveable("ieb");this._connection.push(dojo.connect(r,"onMoveStart",this,"onMoveStart"));this._connection.push(dojo.connect(r,"onMoveStop",this,"onMoveStop"));this._inline=new e({},k);k=g.byId("editorsStackContainer").domNode;g.byId("editorsStackContainer");k=m.position(k);this._loadingDiv.style.position="absolute";this._loadingDiv.style.left=
k.x+"px";this._loadingDiv.style.top=k.y+"px";this._loadingDiv.style.width=k.w+"px";this._loadingDiv.style.height=k.h+"px";var k=this._widget.getMarginBox(),r=dojo.position(d),z=dojo.position(h),d=r.x-z.x+h.scrollLeft-1,r=r.y-z.y+h.scrollTop-1,y=h.clientWidth,z=26,B=0;k.y+a+26<h.clientHeight?(z=k.y+26,dojo.addClass(c,"inlineEditConnectorBelow")):0<k.y-a?(z=k.y-a,B=a+12):z=26;h="0";k.x+b+20<y?h=k.x:k.x+b>y&&(h=k.x-b+k.w,0>h&&(h=0));h+=d;z+=r;this._inline._setStyleAttr({display:"block",top:z+"px",left:h+
"px",padding:"1px",overflow:"hidden",backgroundImage:"none"});this._startTop=z;this._startLeft=h;dojo.style(c,"left",k.x+20+d+"px");dojo.style(c,"top",z+B+this._POINTER_TOP_OFFSET+"px")}},handleEvent:function(a){switch(a.keyCode){case 13:var b=this.multiLine;if(!b||"false"==b||13==this._lastKeyCode||a.ctrlKey)this.onOk();else if(a.which==dojo.keys.ENTER&&a.ctrlKey)this.onOk();break;case 27:this.onCancel();break;default:this.updateFormats()}this._lastKeyCode=a.keyCode;this.updateSimStyle()},onOk:function(a){this.hide()},
onCancel:function(a){this.hide(!0)},onMoveStart:function(a){dojo.style("iebPointer","display","none")},onMoveStop:function(a){var b=dojo.style("ieb","left");a=dojo.style("ieb","top");b=this._startLeft-b;a-=this._startTop;a<this._Y_MOVE_RANGE&&a>-this._Y_MOVE_RANGE?(dojo.style("iebPointer","display",""),dojo.style("iebPointer","top",this._startTop+this._POINTER_TOP_OFFSET+a+"px"),b<this._X_MOVE_RANGE&&b>-this._X_MOVE_RANGE?dojo.style("iebPointer","display",""):dojo.style("iebPointer","display","none")):
dojo.style("iebPointer","display","none")},stopEvent:function(a){a.stopPropagation();this.updateSimStyle()},stopEvent_Intercept_Enter:function(a){this.stopEvent(a);13!=a.keyCode||this.multiLine||a.preventDefault()},_node:function(){var a,b=this.path,d=this.selector;if(b||d)a=this._widget.domNode,b&&(a=dojo.getObject(b,!1,this._widget)),d&&(a=dojo.query(d,a)[0]);return a},updateWidget:function(a){if(!this._widget._destroyed){this.parse&&(a=this.parse(a));var b=this._node(this._widget),d=this._widget.getContext(),
c=this.property,g="maq_innerText"===c?"innerHTML":c;if(this.update){if(a=this.update(b||this._widget,a,c))this._widget=a;d.select(this._widget,null,!1)}else if(c){if(b)dojo.attr(b,g,a);else{b={};a&&"string"==typeof a&&(a=a.replace(/\n/g,""));var k=null;"textContent"==c?k=a:b[c]=a;"innerHTML"===g?(b.richText=b[c],delete b[c],a=new h(this._widget,b,null,d)):a=new davinci.ve.commands.ModifyCommand(this._widget,b,k,d);this._widget._edit_context.getCommandStack().execute(a);this._widget=a.newWidget;this._widget._edit_context._focuses[0]._selectedWidget=
this._widget}d.select(this._widget,null,!1)}}},hide:function(a){if(this._inline){for(var f;connection=this._connection.pop();)connection&&dojo.disconnect(connection);var d=this._findSmartInputContainer(this._widget._edit_context.frameNode);if(d&&(this._loadingDiv&&d.removeChild(this._loadingDiv),"none"!=this._inline.style.display&&this._inline.eb)){this._value=f=this._inline.eb.get("value");this._format=this.getFormat();this._inline.style.display="none";this._inline.eb&&(this._inline.eb.destroyRecursive(),
delete this._inline.eb);this._inline.destroyRecursive();delete this._inline;var c=d.ownerDocument.getElementById("iebPointer");d.removeChild(c);null==f||a||(this.disableEncode||"text"!==this._format||(f=b.encode(f)),this.updateWidget(f));this._widget.getContext().getDocument().defaultView.focus()}}},getFormat:function(){var a=dijit.byId("davinci.ve.input.SmartInput_radio_html"),b="text";a&&a.checked&&(b="html");return b},containsHtmlMarkUp:function(a){return 0<dojo.create("div",{innerHTML:a}).children.length},
toggleHelp:function(){var a=dojo.byId("davinci.ve.input.SmartInput_img_help");dojo.hasClass(a,"inlineEditHelpSelected")?this.help(!1):this.help(!0);dojo.toggleClass(a,"inlineEditHelpSelected")},setFormat:function(a){var b=dijit.byId("davinci.ve.input.SmartInput_radio_html"),d=dijit.byId("davinci.ve.input.SmartInput_radio_text");a=dojo.create("div",{innerHTML:a}).children.length?"html":"text";"html"===a?(b.set("checked",!0),d.set("checked",!1)):(b.set("checked",!1),d.set("checked",!0));this._format=
a},help:function(a){var b=dojo.byId("davinci.ve.input.SmartInput_div_help");dojo.byId("davinci.ve.input.SmartInput_radio_div");a?dojo.style(b,"display",""):dojo.style(b,"display","none")},updateFormats:function(){var a=this._inline.eb.get("value"),f=!0;this.containsHtmlMarkUp(a)&&(f=!1);this._widget.getContext().getDojo();var d=dojo.byId("davinci.ve.input.SmartInput_radio_text_width_div"),a=b.encode(a);d.innerHTML='\x3cdiv class\x3d"dojoxEllipsis"\x3e'+dojo.replace("Plain text ({0})",[a])+"\x3c/div\x3e";
a=dojo.byId("davinci.ve.input.SmartInput_radio_html_width_div");a.innerHTML='\x3cdiv id\x3d"davinci.ve.input.SmartInput_radio_html_div" class\x3d"dojoxEllipsis"\x3e'+k.htmlMarkup+"\x3c/div\x3e";var c=dijit.byId("davinci.ve.input.SmartInput_radio_html"),g=dijit.byId("davinci.ve.input.SmartInput_radio_text"),e=dojo.byId("davinci.ve.input.SmartInput_table");c.setDisabled(f);g.setDisabled(f);f?(dojo.addClass(d,"inlineEditDisabled"),dojo.addClass(a,"inlineEditDisabled"),c.set("checked",!1),g.set("checked",
!0)):(dojo.removeClass(d,"inlineEditDisabled"),dojo.removeClass(a,"inlineEditDisabled"));!f&&this.isHtmlSupported()?(dojo.style(g.domNode,"display",""),dojo.style(c.domNode,"display",""),dojo.style(a,"display",""),dojo.style(d,"display",""),dojo.style(e,"display","")):(dojo.style(g.domNode,"display","none"),dojo.style(c.domNode,"display","none"),dojo.style(a,"display","none"),dojo.style(d,"display","none"),dojo.style(e,"display","none"))},resize:function(a){a=dojo.byId("iedResizeDiv");var b=dijit.byId("davinciIleb"),
d=a.clientWidth-5,c=a.clientHeight-6,g=a.clientWidth-10,d=a.clientWidth-8,c=a.clientHeight-20,g=a.clientWidth-9,k=dojo.byId("smartInputSim");dojo.style(k,"width",d+10+"px");this.updateSimStyle();b&&(b._setStyleAttr({width:d+"px",height:c+"px",maxHeight:c+"px"}),b._setStyleAttr({width:a.clientWidth+"px"}));b=dojo.byId("davinci.ve.input.SmartInput_radio_div");dojo.style(b,"width",g+2+"px");b=dojo.byId("davinci.ve.input.SmartInput_radio_text_width_div");dojo.style(b,"width",a.clientWidth-50+"px");b=
dojo.byId("davinci.ve.input.SmartInput_radio_html_width_div");dojo.style(b,"width",a.clientWidth-50+"px")},onBlur:function(a){this.updateSimStyle(a)},updateSimStyle:function(a){var b=dijit.byId("davinciIleb");if(a=dojo.byId("smartInputSim"))b=dojo.style(b.domNode),dojo.style(a,"borderColor",b.borderTopColor),dojo.style(a,"backgroundColor",b.backgroundColor)},_getTemplate:function(){var b='\x3cdiv id\x3d"iedResizeDiv" class\x3d"iedResizeDiv" \x3e\x3ctextarea  dojoType\x3d"dijit.form.SimpleTextarea" name\x3d"davinciIleb" trim\x3d"true" id\x3d"davinciIleb" class\x3d"smartInputTextArea" \x3e\x3c/textarea\x3e\x3cdiv id\x3d"smartInputSim" class\x3d"smartInputSim" \x3e\x3c/div\x3e\x3c/div\x3e';
"true"===this.multiLine&&(b='\x3cdiv id\x3d"iedResizeDiv" class\x3d"iedResizeDiv" \x3e\x3ctextarea  dojoType\x3d"dijit.form.SimpleTextarea" name\x3d"davinciIleb" trim\x3d"true" id\x3d"davinciIleb" class\x3d"smartInputTextAreaMulti" \x3e\x3c/textarea\x3e\x3cdiv id\x3d"smartInputSim" class\x3d"smartInputSim" \x3e\x3c/div\x3e\x3c/div\x3e');return""+b+'\x3cdiv  id\x3d"davinci.ve.input.SmartInput_div"  class\x3d"davinciVeInputSmartInputDiv" \x3e\x3cdiv id\x3d"davinci.ve.input.SmartInput_radio_div" class\x3d"smartInputRadioDiv" \x3e\x3ctable id\x3d"davinci.ve.input.SmartInput_table"\x3e \x3ctbody\x3e\x3ctr\x3e \x3ctd class\x3d"smartInputTd1" \x3e \x3cinput id\x3d"davinci.ve.input.SmartInput_radio_text" showlabel\x3d"true" type\x3d"radio" dojoType\x3d"dijit.form.RadioButton" disabled\x3d"false" readOnly\x3d"false" intermediateChanges\x3d"false" checked\x3d"true"\x3e \x3c/input\x3e \x3c/td\x3e \x3ctd class\x3d"smartInputTd2" \x3e\x3cdiv id\x3d"davinci.ve.input.SmartInput_radio_text_width_div" class\x3d"smartInputRadioTextDiv"\x3e\x3c/div\x3e\x3c/td\x3e \x3c/tr\x3e\x3ctr\x3e \x3ctd class\x3d"smartInputTd1"\x3e \x3cinput id\x3d"davinci.ve.input.SmartInput_radio_html" showlabel\x3d"true" type\x3d"radio" dojoType\x3d"dijit.form.RadioButton"\x3e \x3c/input\x3e  \x3c/td\x3e \x3ctd class\x3d"smartInputTd2"\x3e\x3cdiv id\x3d"davinci.ve.input.SmartInput_radio_html_width_div" class\x3d"smartInputRadioTextDiv"\x3e\x3c/div\x3e\x3c/td\x3e \x3c/tr\x3e \x3c/tbody\x3e\x3c/table\x3e \x3cdiv class\x3d"smartInputHelpDiv" \x3e \x3cspan id\x3d"davinci.ve.input.SmartInput_img_help"  title\x3d"Help" class\x3d"inlineEditHelp" \x3e \x3c/span\x3e\x3cspan class\x3d"smartInputSpacerSpan" \x3e\x3cbutton id\x3d"davinci.ve.input.SmartInput_ok"  dojoType\x3d"dijit.form.Button" type\x3d"submit" class\x3d"inlineEditHelpOk" \x3e'+
a.buttonOk+'\x3c/button\x3e \x3cbutton id\x3ddavinci.ve.input.SmartInput_cancel dojoType\x3d"dijit.form.Button" class\x3d"inlineEditHelpCancel"\x3e '+a.buttonCancel+'\x3c/button\x3e  \x3c/span\x3e   \x3c/div\x3e \x3cdiv id\x3d"davinci.ve.input.SmartInput_div_help" style\x3d"display:none;" class\x3d"smartInputHelpTextDiv" \x3e \x3cdiv dojoType\x3d"dijit.layout.ContentPane" class\x3d"smartInputHelpTextDivContentPane "style\x3d"padding:0;" \x3e'+this.getHelpText()+'\x3c/div\x3e \x3cdiv style\x3d"text-align: left; padding:0; height:2px;" \x3e\x3c/div\x3e \x3c/div\x3e \x3c/div\x3e\x3c/div\x3e '},
_connectResizeHandle:function(){},_connectSimDiv:function(){this._connection.push(dojo.connect(this._inline.eb,"onFocus",this,"updateSimStyle"));this._connection.push(dojo.connect(this._inline.eb,"onMouseOver",this,"updateSimStyle"));this._connection.push(dojo.connect(this._inline.eb,"onMouseOut",this,"updateSimStyle"));this._connection.push(dojo.connect(dojo.byId(" davinci.ve.input.SmartInput_div"),"onclick",this,"updateSimStyle"))}})})},"davinci/ve/commands/ModifyRichTextCommand":function(){define(["dojo/_base/declare"],
function(p){return p("davinci.ve.commands.ModifyRichTextCommand",null,{name:"modify",constructor:function(m,h,e,b){this._oldId=m?m.id:void 0;this._properties=h=h||{};h.richText?(this._richText=!0,this._children=this._newText=h.richText,delete h.richText):this._children=h._children;this._context=b||m.getContext()},setContext:function(m){this._context=m},add:function(m){m&&m._oldId==this._oldId&&(m._properties&&dojo.mixin(this._properties,m._properties),m._children&&(this._children=m._children))},execute:function(){if(this._oldId&&
this._properties){var m=require("davinci/ve/widget"),h=m.byId(this._oldId);if(h){this._parentWidget=h.getParent();this._oldText||(this._oldText=h._srcElement.getElementText(this._context))&&"string"==typeof this._oldText&&(this._oldText=this._oldText.replace(/\n/g,""));this._oldData||(this._oldData=h.getData(),this._oldData.context=this._context,this._newData={type:this._oldData.type,properties:dojo.mixin({},this._oldData.properties,this._properties),children:this._newText,maqStates:this._oldData.maqStates,
maqDeltas:this._oldData.maqDeltas,context:this._context},this._oldData={type:this._oldData.type,properties:dojo.mixin({},this._oldData.properties,this._properties),children:this._oldText,maqStates:this._oldData.maqStates,maqDeltas:this._oldData.maqDeltas,context:this._context});var e=this._context;e&&e.detach(h);this._properties.id&&delete this._newData.properties.isTempID;this._newId_isTempID||(this._newId_isTempID=this._newData.properties.isTempID);this._oldId_isTempID||(this._oldId_isTempID=this._oldData.properties.isTempID);
var b=null,k=this._parentWidget.indexOf(h);this._parentWidget.removeChild(h);h.destroyWidget();this._newId&&(this._newData.properties.id=this._newId);this._newId_isTempID&&(this._newData.properties.isTempID=this._newId_isTempID);if(b=m.createWidget(this._newData))this._parentWidget.addChild(b,k),this._newId=b.id,this._context&&this._refresh(b),e&&(e.widgetAddedOrDeleted(),this._oldId!=this._newId&&e.widgetChanged(e.WIDGET_ID_CHANGED,b,this._oldId),e.widgetChanged(e.WIDGET_MODIFIED,b)),this.newWidget=
b,dojo.publish("/davinci/ui/widget/replaced",[b,h]),require("davinci/ve/States").resetState(b.domNode)}}},undo:function(){if(this._newId&&this._oldData){var m=require("davinci/ve/widget"),h=m.byId(this._newId);if(h){var e=dojo.indexOf(this._parentWidget.getChildren(),h);if(!(0>e)){var b=this._parentWidget.getContext();b&&b.detach(h);this._parentWidget.removeChild(h);h.destroyWidget();this._oldData.children=this._oldText;this._oldData.properties.id=this._oldId;m=m.createWidget(this._oldData);this._parentWidget.addChild(m,
e);b&&this._refresh(m);b.widgetAddedOrDeleted();b.widgetChanged(b.WIDGET_MODIFIED,m);dojo.publish("/davinci/ui/widget/replaced",[m,h]);require("davinci/ve/States").resetState(m.domNode)}}}},_refresh:function(m){var h=m.getContainerNode();h&&this._context.getGlobal().require("dojo/parser").parse(h);this._context.attach(m);m.startup();m.renderWidget();h&&this._context._attachChildren(h)}})})},"davinci/css":function(){define(["dojo/_base/window","dojo/dom-construct","dojo/dom-attr"],function(p,m){var h=
p.doc.getElementsByTagName("head")[0],e={};return{load:function(b,k,a){b=k.toUrl(b);b in e||(m.create("link",{rel:"stylesheet",type:"text/css",href:b},h),e[b]=1);a()}}})},"davinci/ui/widgets/OutlineTree":function(){define(["dojo/_base/declare"],function(p){return p(null,{})})},"davinci/davinci_":function(){define("dijit/dijit ./Workbench ./ve/palette/HtmlWidgets ./ve/views/StatesView ./ve/views/SwitchingStyleView ./actions/UndoAction ./actions/SelectThemeAction ./actions/SelectLayoutAction ./actions/RedoAction ./actions/DownloadAction ./actions/StickyNoteAction ./actions/SaveAsWidget ./actions/UserNameAction ./actions/LogoutAction ./ve/actions/CopyAction ./ve/actions/CutAction ./ve/actions/DeleteAction ./ve/actions/PasteAction ./ve/actions/DuplicateAction ./ve/actions/EditValueAction ./ve/actions/EditPropertiesAction ./ve/actions/SurroundAction ./ve/actions/SelectParentAction ./ve/actions/SelectAncestorAction ./ve/actions/UnselectAllAction ./ve/actions/ArrangeAction ./ve/actions/MoveToFrontAction ./ve/actions/MoveToBackAction ./ve/actions/MoveForwardAction ./ve/actions/MoveBackwardAction ./ve/actions/OtherAction ./ve/actions/EnableApplicationStates ./ve/actions/ViewDesignAction ./ve/actions/ViewSourceAction ./ve/actions/ViewSourceMenuAction ./ve/actions/ViewSplitHMenuAction ./ve/actions/ViewSplitVMenuAction ./ve/actions/AddState ./ve/actions/RemoveState ./ve/actions/ModifyState ./ve/actions/ManageStates ./ve/actions/NewWidgetsCurrentState ./ve/actions/HighlightBaseWidgets ./ve/actions/ShowInOutline ./ve/PageEditor ./html/ui/HTMLEditor ./html/ui/ImageViewer ./ve/prefs/HTMLEditPreferences dijit/layout/LayoutContainer ./commands/OrderedCompoundCommand ./version".split(" "),
function(){})},"davinci/ve/palette/HtmlWidgets":function(){define(["dojo/_base/declare","davinci/workbench/ViewPart","davinci/ve/palette/Palette"],function(p,m,h){return p("davinci.ve.palette.HtmlWidgets",m,{constructor:function(e,b){dojo.subscribe("/davinci/ui/editorSelected",dojo.hitch(this,this._editorSelected))},_editorSelected:function(e){e.editor&&e.editor.supports("palette")?(this.setContext([e.editor.getContext()]),dojo.removeClass(this.palette.domNode,"dijitHidden")):(this.palette.domNode.scrollTop=
0,dojo.addClass(this.palette.domNode,"dijitHidden"))},postCreate:function(){this.inherited(arguments);this.attachToolbar();this.palette=new h({toolbarDiv:this.toolbarDiv});this.palette.descriptors="dijit,dojox,html,OpenAjax";this.setContent(this.palette);this.palette._loadPalette();dojo.addClass(this.palette.domNode,"dijitHidden")},setContext:function(e){this.palette.setContext(e[0])}})})},"davinci/ve/palette/Palette":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/on dojo/query dojo/dom-class dojo/Deferred dijit/focus dijit/_WidgetBase davinci/Runtime davinci/Workbench dijit/_KeyNavContainer dijit/form/TextBox dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem davinci/ui/dnd/DragSource davinci/ve/metadata davinci/library ./PaletteFolder ./PaletteItem dojo/i18n!davinci/ve/nls/common davinci/ve/tools/CreateTool davinci/workbench/Preferences".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y,B,x,w,v,A,C,L){return p("davinci.ve.palette.Palette",[n,c],{descriptors:"",_displayShowValue:"block",_presetClassNamePrefix:"maqPaletteSection_",_presetSections:{},_presetCreated:{},raisedItems:[],sunkenItems:[],moreItems:[],helpItems:[],_userWidgetSection:{id:"$$UserWidgets$$",name:"User Widgets",includes:[]},postMixInProperties:function(){this._resource=A},postCreate:function(){dojo.addClass(this.domNode,"dojoyPalette");this.refresh();h.subscribe("/davinci/ui/addedCustomWidget",
this,"addCustomWidget");h.subscribe("/davinci/preferencesChanged",this,"preferencesChanged")},addCustomWidget:function(a){if(this._loaded&&a&&a.$wm&&a.$wm.widgets&&a.$wm.widgets.length){var c=f.currentEditor.getContext().getCompType();L.getPreferences("davinci.ve.editorPrefs",d.getProject()).showAllWidgets&&(c="mobile"==c?"$ALLMOBILE":"$ALLDESKTOP");var b=a.$wm;a=a.$wm.widgets;for(var g=null,k=0;k<a.length;k++){var e=a[k],h;for(h in this._presetSections){var n=null,q=this._presetSections[h];if(q){for(var m=
0;m<q.length;m++){var r=q[m];if("$$UserWidgets$$"==r.id){n=r;break}}n||(n=dojo.clone(this._userWidgetSection),n.preset=this._presetSections[h],n.presetId=h,n.items=[],q.push(n),this._presetCreated[h]&&(this._generateCssRules([n]),this._createPalette(n),n._created=!0));q="type:"+e.type;if(0>n.includes.indexOf(q)){n.includes.push(q);e.$library=b;e.section=n;e._paletteItemGroup=this._paletteItemGroupCount++;n.items.push(e);q=null;m=this.getChildren();for(r=0;r<m.length;r++){var u=m[r];if("davinci.ve.palette.PaletteFolder"==
u.declaredClass&&u.presetId==h&&"$$UserWidgets$$"==u.section.id){q=u;break}}q&&(q.domNode.style.display="none",n={displayName:e.$library._maqGetString(e.type)||e.$library._maqGetString(e.name)||e.name,description:e.$library._maqGetString(e.type+"_description")||e.$library._maqGetString(e.name+"_description")||e.description||e.type,name:e.name,paletteId:this.id,type:e.type,data:e.data||{name:e.name,type:e.type,properties:e.properties,children:e.children},tool:e.tool,category:"custom",section:n,PaletteFolderSection:q,
PaletteFolderSubsection:null,_paletteItemGroup:e._paletteItemGroup,_paletteGroupSelected:!0},this._setIconProperties(e,n),this._createItem(n,q).domNode.style.display="none",c==h&&(g=q))}}else console.error("Palette.js:addCustomWidget - no sections for comptype\x3d"+h)}}g&&g.showHideFolderContents(!0)}},setContext:function(a){this._context=a;try{this._loadPalette()}catch(c){console.error("_loadPalette:crash "+c)}this._filter();this.updatePaletteVisibility()},refresh:function(){delete this._loaded;
this._presetSections={};this._createFolderTemplate();this._createHeader();if(this._context)try{this._loadPalette()}catch(a){console.error("_loadPalette:crash")}},_loadPalette:function(){if(!this._loaded){var a=B.getLibrary(),c={};x.getUserLibs(d.getProject()).forEach(function(b){var d;a:{d=b.id;b=b.version;for(var f in a)if(a.hasOwnProperty(f)){var g=a[f];if(g.name===d&&g.version===b){b={};b[d]=a[f];d=b;break a}}d=null}d&&dojo.mixin(c,d)});var b={},g=[],k;for(k in c)if(c.hasOwnProperty(k)){var e=
c[k].$wm;e&&dojo.forEach(e.widgets,function(a){"untested"==a.category||a.hidden||g.push(a.type)})}this._paletteItemGroupCount=0;if(this._widgetPalette=f.getSiteConfigData("widgetPalette"))if((k=this._widgetPalette.presets)&&"object"==typeof k)for(var h in k){e=g.concat();this._presetSections[h]=[];var n=k[h],q,m="string"==typeof n.sections?this._widgetPalette.defs?this._widgetPalette.defs[n.sections]:void 0:n.sections;if(m&&m.length){var r=[],u;for(u in b){var v=b[u];v.descriptor&&r.push({name:u,
value:v})}r.sort(function(a,c){var b=a.name.split("/").pop().toLowerCase(),d=c.name.split("/").pop().toLowerCase();return b<d?-1:b>d?1:0});for(var v=!1,A,z=0;z<r.length;z++){v||(u=dojo.clone(this._userWidgetSection),m=m.concat(u),v=!0,A=u.includes);var y=r[z].value.descriptor.widgets;for(u=0;u<y.length;u++)A.push("type:"+y[u].type)}for(r=0;r<m.length;r++){v=dojo.clone("string"==typeof m[r]?this._widgetPalette.defs?this._widgetPalette.defs[m[r]]:void 0:m[r]);v.preset=n;v.presetId=h;if(v.subsections&&
v.subsections.length)for(z=v.subsections,y=0;y<z.length;y++){if("string"==typeof z[y]){var C=this._widgetPalette.defs?this._widgetPalette.defs[z[y]]:void 0;C&&(z[y]=dojo.clone(C))}C=z[y];C.includes&&0<=C.includes.indexOf("$$AllOthers$$")&&(q=C);C.preset=n;C.presetId=h;this._createSectionItems(C,n,e)}else this._createSectionItems(v,n,e),v.includes&&0<=v.includes.indexOf("$$AllOthers$$")&&(q=v);this._presetSections[h].push(v)}}else console.warning("No sections defined for preset "+h+" in widgetPalette.json (in siteConfig folder)");
for(n=0;n<e.length;n++)m=e[n],q&&(m=B.getWidgetDescriptorForType(m),m=dojo.clone(m),this._prepareSectionItem(m,q,this._paletteItemGroupCount),q.items.push(m),this._paletteItemGroupCount++)}else console.warning("No presets defined in widgetPalette.json (in siteConfig folder)");else console.error("widgetPalette.json not defined (in siteConfig folder)");this._loaded=!0}},_generateCssRules:function(a){var c=dojo.doc.styleSheets[0];c&&dojo.forEach(a,function(a){a.items&&dojo.forEach(a.items,function(a){var b=
a.iconBase64||this._getIconUri(a.icon,"ve/resources/images/file_obj.gif");a="img.davinci_"+a.type.replace(/[\.\/]/g,"_");b="{background-image: url("+b+")}";dojo.isIE?c.addRule(a,b):c.insertRule(a+b,c.cssRules.length)},this)},this)},_createPaletteItemsForComponent:function(a,c){if(a.items){var b=null;dojo.forEach(a.items,function(d){if(!d.hidden){var f={displayName:d.$library._maqGetString(d.type)||d.$library._maqGetString(d.name)||d.name,description:d.$library._maqGetString(d.type+"_description")||
d.$library._maqGetString(d.name+"_description")||d.description||d.type,name:d.name,paletteId:this.id,type:d.type,data:d.data||{name:d.name,type:d.type,properties:d.properties,children:d.children},category:a.name,section:a,preset:a.preset,presetId:a.presetId,presetClassName:c.presetClassName,PaletteFolderSection:c.PaletteFolderSection,PaletteFolderSubsection:c.PaletteFolderSubsection,_paletteItemGroup:d._paletteItemGroup,_paletteGroupSelected:d._paletteItemGroup!=b,_collectionName:d.$library&&d.$library.collections&&
d.$library.collections[d.collection]&&d.$library.collections[d.collection].name,ignoreMeta:d.ignoreMeta,userData:d.userData,forceShow:d.forceShow,iconHTML:d.iconHTML};this._setIconProperties(d,f);this._createItem(f);b=d._paletteItemGroup}},this)}},_createPalette:function(a){var c=a.presetId?this._presetClassNamePrefix+a.presetId:null,b={paletteId:this.id,icon:this._getIconUri(a.icon,"ve/resources/images/fldr_obj.gif"),iconBase64:a.iconBase64,displayName:a.name,section:a,subsections:a.subsections,
subsection_container:null,preset:a.preset,presetId:a.presetId,presetClassName:c};this._createFolder(b).then(function(b){if(a.subsections&&a.subsections.length)for(var d=0;d<a.subsections.length;d++){var f=a.subsections[d],f={paletteId:this.id,icon:this._getIconUri(f.icon,"ve/resources/images/fldr_obj.gif"),iconBase64:f.iconBase64,displayName:f.name,section:a,subsection:f,subsection_container:b,preset:a.preset,presetId:a.presetId,presetClassName:c};this._createFolder(f).then(function(f){b._children.push(f);
this._createPaletteItemsForComponent(a.subsections[d],{presetClassName:c,PaletteFolderSection:b,PaletteFolderSubsection:f})}.bind(this))}else this._createPaletteItemsForComponent(a,{presetClassName:c,PaletteFolderSection:b,PaletteFolderSubsection:null})}.bind(this))},_getIconUri:function(a,c){return a?0==a.indexOf("http")?a:d.location()+a:require.toUrl("davinci/"+c)},_createFolder:function(c){var b=new a;require(["davinci/ve/palette/PaletteFolder"],function(a){a=new a(c);this.addChild(a);b.resolve(a)}.bind(this));
return b},_createFolderTemplate:function(){this.folderTemplate=dojo.create("div",{className:"dojoyPaletteCommon dojoyPaletteFolder dojoyPaletteFolderLow ui-widget-header",innerHTML:'\x3ca href\x3d"javascript:void(0)"\x3e\x3cimg border\x3d"0"/\x3e\x3c/a\x3e'})},_createHeader:function(){},_updateShowAllWidgetsPreference:function(a){var c=d.getProject(),b=L.getPreferences("davinci.ve.editorPrefs",c);b.showAllWidgets=a;L.savePreferences("davinci.ve.editorPrefs",c,b)},_updateShowAllWidgetsMenu:function(a){},
_clearFilter:function(){this.filterField&&this.filterField.set("value","");this._filter()},_filter:function(){var a=this.context.getCompType(),c=L.getPreferences("davinci.ve.editorPrefs",d.getProject());c.showAllWidgets=!0;c.showAllWidgets&&(a="mobile"==a?"$ALLMOBILE":"$ALLDESKTOP");dojo.removeClass(this.domNode,"maqWidgetsFiltered");this.toolbarDiv&&dojo.removeClass(this.toolbarDiv,"maqWidgetsToolbarFiltered");this.getChildren().forEach(function(c){"dijit.form.TextBox"!=c.declaredClass&&dojo.style(c.domNode,
"display","davinci.ve.palette.PaletteFolder"===c.declaredClass&&c.presetId==a&&0<c._children.length&&("simple"==c._type||"subsection_container"==c._type)?"block":"none")})},_hasItem:function(a){for(var c=this.getChildren(),b=0;b<c.length;b++)if(c[b].type==a)return!0;return!1},_createItem:function(a,c){if("$$UserWidgets$$"!=a.section.id){var d=B.queryDescriptor(a.type,"collection"),f;if(a.preset&&(f=a.preset.collections,!f||!f.length)){console.error("_create item : presetCollections.l\x3d0");return}if(a.preset&&
a.preset.exclude){var g="string"==typeof a.preset.exclude?this._widgetPalette.defs?this._widgetPalette.defs[a.preset.exclude]:void 0:a.preset.exclude;if(g&&0<=g.indexOf(a.type)){console.error("_create item : exclude \x3d 1");return}}g=!1;if(f&&f.length){for(var k=0;k<f.length;k++)if(f[k].id==d&&f[k].show){g=!0;break}!0===a.ignoreMeta&&(g=!0);if(!g)return}}a.icon=a.iconLarge;d=new v(a);c?c.addChild(d):this.addChild(d);a.paletteItem=d;a.PaletteFolderSubsection?(a.PaletteFolderSubsection._children.push(d),
d.domNode.style.display=a.PaletteFolderSubsection._isOpen&&d._paletteGroupSelected?this._displayShowValue:"none"):a.PaletteFolderSection&&(a.PaletteFolderSection._children.push(d),d.domNode.style.display=a.PaletteFolderSection._isOpen&&d._paletteGroupSelected?this._displayShowValue:"none");f=b(".paletteItemImageContainer",d.domNode)[0];f=new y(d.domNode,"component",d,f);f.targetShouldShowCaret=!0;f.returnCloneOnFailure=!1;this.connect(f,"onDragStart",dojo.hitch(this,function(a){this.onDragStart(a)}));
this.connect(f,"onDragEnd",dojo.hitch(this,function(a){this.onDragEnd(a)}));a.forceShow&&(d.domNode.style.display="inline-block");return d},_prepareSectionItem:function(a,c,b){var d=B.getLibraryMetadataForType(a.type);a.$library=d;a.section=c;a._paletteItemGroup=b},_createSectionItems:function(a,c,b){a.items=[];collections=c.collections;var d=a.includes;if(!d||!d.length)return console.error("No includes property for preset "+c+" in widgetPalette.json (in siteConfig folder)"),[];for(c=0;c<d.length;c++){for(var f=
d[c],g=m.isArray(f)?f:[f],f=[],k=0;k<g.length;k++){var e=g[k],h=[];if("type:"===e.substr(0,5)){var n=B.getWidgetDescriptorForType(e.substr(5));n&&h.push(n)}else h=B.getWidgetsWithTag(e);for(e=0;e<h.length;e++)n=h[e],n=dojo.clone(n),this._prepareSectionItem(n,a,this._paletteItemGroupCount),f.push(n)}g=[];if(collections&&collections.length){for(h=0;h<collections.length;h++)for(e=collections[h],k=0;k<f.length;)n=f[k],n.collection==e.id?(g.push(n),f.splice(k,1)):k++;for(k=0;k<f.length;k++)g.push(f[k])}else g=
f;for(k=0;k<g.length;k++)f=g[k],h=b.indexOf(f.type),0<=h&&b.splice(h,1),a.items.push(f);this._paletteItemGroupCount++}},updatePaletteVisibility:function(){this._clearFilter();this._updateShowAllWidgetsMenu();var a=f.currentEditor.getContext().getCompType();this._presetCreated[a]=!0;dojo.addClass(this.domNode,"paletteLayoutIcons");this._displayShowValue="inline-block";var c=this._presetSections[a];if(c)for(var b=0;b<c.length;b++){var d=c[b];d._created||(this._generateCssRules([d]),this._createPalette(d),
d._created=!0)}c=this.getChildren();b=0;for(d=c.length;b<d;b++){var g=c[b];g&&g.domNode&&g.presetId&&("davinci.ve.palette.PaletteFolder"==g.declaredClass?(g.domNode.style.display=g.presetId==a?0==g._children.length||"subsection"==g._type?"none":"block":"none","subsubsection_container"==g._type&&(g._openSubsection=null),g._isOpen=!1):g.domNode.style.display=g.forceShow?"inline-block":"none")}},preferencesChanged:function(){for(var a=L.getPreferences("davinci.ve.editorPrefs",d.getProject()),a=a.widgetPaletteLayout&&
"icons"!=a.widgetPaletteLayout?"icon":"iconLarge",c=this.getChildren(),b=0;b<c.length;b++){var f=c[b];"davinci.ve.palette.PaletteItem"==f.declaredClass&&f.updateImgSrc(f[a])}this.updatePaletteVisibility()},flattenAll:function(){for(var a=0;a<this.raisedItems.length;a++)this.raisedItems[a].flat(this.raisedItems[a].domNode);this.raisedItems=[];for(a=0;a<this.sunkenItems.length;a++){var c=this.sunkenItems[a];c._tooltipDialog&&(c.paletteItemMoreCloseCleanup(),c.paletteItemHelpCloseCleanup());c.flat(c.domNode);
c._selectionShowing=!1}this.sunkenItems=[]},removeSelectionAll:function(){try{this.flattenAll()}catch(a){console.error("flatten failed")}for(var c=b(".paletteItemSelectionContent",this.domNode),d=0;d<c.length;d++){var f=c[d];f&&f.parentNode&&(f.parentNode.innerHTML="")}},getPaletteItemsSameGroup:function(a){for(var c=[],b=a._paletteItemGroup,d;a&&a._paletteItemGroup;)if(a._paletteItemGroup==b)a=(d=a)&&a.domNode&&a.domNode.previousSibling&&a.domNode.previousSibling._paletteItem;else break;for(a=d;a&&
a._paletteItemGroup==b;)c.push(a),a=a&&a.domNode&&a.domNode.nextSibling&&a.domNode.nextSibling._paletteItem;return c},_setIconProperties:function(a,c){c.icon=a.iconBase64||a.icon&&this._getIconUri(a.icon,"ve/resources/images/file_obj.gif")||a.iconLargeBase64||a.iconLarge&&this._getIconUri(a.iconLarge,"ve/resources/images/file_obj.gif")||this._getIconUri(a.icon,"ve/resources/images/file_obj.gif");c.iconLarge=a.iconLargeBase64||a.iconLarge&&this._getIconUri(a.iconLarge,"ve/resources/images/file_obj.gif")||
a.iconBase64||this._getIconUri(a.icon,"ve/resources/images/file_obj.gif")},onDragStart:function(a){this.removeSelectionAll();this.selectedItem=null;var c=a.dragSource.data;B.getHelper(c.type,"tool").then(function(a){a=new (a||C)(dojo.clone(c.data),c.userData);this._context.setActiveTool(a)}.bind(this));this._context.blockChange(!1);a._dragClone&&(k.add(a._dragClone,"paletteDragContainer"),dojo.create("div",{className:"maqCandidateParents"},a._dragClone));this._context.setActiveDragDiv(a._dragClone);
this._dragKeyDownListener=dojo.connect(document,"onkeydown",dojo.hitch(this,function(a){var c=this._context.getActiveTool();if(c&&c.onKeyDown)c.onKeyDown(a)}));this._dragKeyUpListener=dojo.connect(document,"onkeyup",dojo.hitch(this,function(a){var c=this._context.getActiveTool();if(c&&c.onKeyUp)c.onKeyUp(a)}))},onDragEnd:function(a){this._context.setActiveTool(null);this._context.setActiveDragDiv(null);dojo.disconnect(this._dragKeyDownListener);dojo.disconnect(this._dragKeyUpListener);g.curNode&&
g.curNode.blur&&g.curNode.blur();this.removeSelectionAll();this.selectedItem=null;this.flattenAll()},onDragMove:function(a){},nop:function(){return!1},__dummy__:null})})},"davinci/ui/dnd/DragSource":function(){define(["dojo/_base/declare","dojo/fx"],function(p,m){sctx&&(window.__x=function(){this.scrollOffset.x=200});return p("davinci.ui.dnd.DragSource",null,{disabled:!1,dragObject:null,dragClone:null,offsetParent:null,offsetParentCoords:null,parentCoords:null,refNode:null,positioning:null,useCurrentPositioning:!0,
targetShouldShowCaret:!1,draggingMousePosition:"TopLeft",data:null,returnCloneOnFailure:!0,constructor:function(h,e,b,k){this.data=b;h=dojo.byId(h);h.dragSource=this;this.domNode=h;this.dragObject=k?k:h;this.refNode=h;this.type=e;this.offsetParent=dojo.doc.body},onDragDown:function(h){this.useCurrentPositioning&&(this.positioning=dojo.style(this.refNode,"position"));this.storeMouseDownInfo(h);this.initDrag(h)},onDragStart:function(h){this.createDragClone(h);return h._dragClone=this.dragClone},onDragMove:function(h){"TopLeft"==
this.draggingMousePosition?(this.dragClone.style.top=h.pageY+4+(h.documentY||0)+"px",this.dragClone.style.left=h.pageX+4+(h.documentX||0)+"px"):"ClickedPosition"==this.draggingMousePosition&&(this.dragClone.style.top=h.pageY-this.dragOffset.y+(h.documentY||0)+"px",this.dragClone.style.left=h.pageX-this.dragOffset.x+(h.documentX||0)+"px");"none"==this.dragClone.style.display&&(this.dragClone.style.display="")},onDragEnd:function(h){"dropSuccess"!=h.dragStatus&&this.returnCloneOnFailure?"dropFailure"==
h.dragStatus?this.returnClone():console.error("DragSource#onDragEnd: internal error: e.dragStatus is not set"):this.removeClone();this.cleanupDrag()},unregister:function(){this.domNode.dragSource=null;this.cleanupDrag()},reregister:function(){this.domNode.dragSource=this;this.initDrag()},storeMouseDownInfo:function(h){this.layerX=h.layerX-1;this.layerY=h.layerY-1;this.pageX=h.pageX;this.pageY=h.pageY;this.scrollOffset=dojo._docScroll();window.__x&&window.__x.apply(this);this.dragStartPosition=dojo.position(this.refNode,
!0);this.dragStartCssPosition={y:this.refNode.offsetTop,x:this.refNode.offsetLeft};this.dragOffset={y:h.pageY-this.dragStartPosition.y,x:h.pageX-this.dragStartPosition.x};this.offsetParentCoords=dojo.position(this.offsetParent,!0);h=dojo.position(this.domNode.parentNode,!0);this.parentCoords={y:h.y-this.offsetParentCoords.y,x:h.x-this.offsetParentCoords.x};this.fixMouseDownInfo&&this.fixMouseDownInfo(this)},initDrag:function(){},cleanupDrag:function(){},createDragClone:function(h){this.dragClone=
h=h.dragSource.dragHandler&&h.dragSource.dragHandler.createDragClone?h.dragSource.dragHandler.createDragClone():this.dragObject.cloneNode(!0);dojo.style(h,"opacity",.5);h.style.zIndex=1001E3;var e=dojo.contentBox(this.dragObject);h.style.width=e.w+"px";h.style.height=e.h+"px";h.style.top=this.dragObject.offsetTop+4+"px";h.style.left=this.dragObject.offsetLeft+4+"px";h.style.position="absolute";h.style.clear="both";h.style.display="none";this.offsetParent.appendChild(h)},setDragTarget:function(h){this.dragObject=
h},cancelEvent:function(h){h.stopPropagation();h.preventDefault()},removeClone:function(){setTimeout(dojo.hitch(this,"removeClone_1"),0)},removeClone_1:function(){try{this.dragClone.parentNode.removeChild(this.dragClone),this.dragClone=null}catch(h){logError(h)}},returnClone:function(){var h=dojo.position(this.dragClone,!0),e=this.dragStartPosition,b=this;m.slideTo({node:this.dragClone,top:h.y>e.y?e.y-10:e.y+10,left:h.x>e.x?e.x-10:e.x+10,duration:400,onEnd:function(){m.slideTo({node:b.dragClone,top:e.y,
left:e.x,duration:100,onEnd:function(){b.dragClone.parentNode.removeChild(b.dragClone);b.dragClone=null;b.onCloneReturned()}}).play()}}).play()},onCloneReturned:function(){},globalChangeCursor:function(h){var e=dojo.doc.styleSheets[0];if(e)if(h){if(this._showingCursor){if(this._showingCursor==h)return;this.globalChangeCursor(null)}this._showingCursor=h;this._ruleIndex=e.cssRules.length;e.insertRule("*{cursor:"+h+" ! important;}",e.cssRules.length)}else this._showingCursor&&(this._showingCursor=null,
e.deleteRule(this._ruleIndex))}})})},"davinci/ve/palette/PaletteFolder":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/dom-class dojo/fx davinci/Runtime davinci/ve/metadata".split(" "),function(p,m,h,e,b,k){return p("davinci.ve.palette.PaletteFolder",m,{icon:"",displayName:"",paletteId:"",palette:null,preset:null,presetId:null,presetClassName:null,_type:"",_isOpen:!1,_openSubsection:null,buildRendering:function(){this.palette=dijit.byId(this.paletteId);var a=this.domNode=this.palette.folderTemplate.cloneNode(!0);
this.presetClassName&&h.add(a,this.presetClassName);var b="PaletteFolder__"+this.presetId+"__"+this.section.id;this.subsection&&(b+="__"+this.subsection.id);dojo.attr(a,"selType",b);b=a.firstChild;dojo.attr(b,"tabIndex","0");b.onclick=this.palette.nop;b.firstChild.src=this.iconBase64?this.iconBase64:this.icon;b.appendChild(dojo.doc.createTextNode(this.displayName));a._paletteFolder=this;this._type=this.subsections?"subsection_container":this.subsection?"subsection":"simple";"subsection"==this._type&&
h.add(a,"PaletteFolderSubsection");this._children=[]},postCreate:function(){this.connect(this.domNode,"onmouseover","folderMouseOverHandler");this.connect(this.domNode,"onmouseout","folderMouseOutHandler");this.connect(this.domNode,"onclick","folderClickHandler")},startup:function(){},isFocusable:function(){return!0},focus:function(){dijit.focus(this.domNode)},addChild:function(a){for(var b=this.palette.getChildren(),k=0,f=b.length;k<f;k++)if(b[k]==this)return this.palette.addChild(a,k+1),!0;return!1},
_paletteItemGroupInfo:function(a,b){var k={},f=b,d=a[f],c=d._paletteItemGroup;do{d._paletteGroupSelected&&(k.selectedIndex=f);f++;if(f>=a.length)break;d=a[f]}while("davinci.ve.palette.PaletteItem"==d.declaredClass&&d._paletteItemGroup===c);"number"!=typeof k.selectedIndex&&(k.selectedIndex=b,a[b]._paletteGroupSelected=!0);k.endIndex=f-1;return k},folderClickHandler:function(a){this.showHideFolderContents()},showHideFolderContents:function(a){for(var b=this.palette.getChildren(),h=0,f=b.length;h<f;){var d=
b[h];if(d==this){"none"==this.domNode.style.display&&e.wipeIn({node:this.domNode,duration:100}).play();if("subsection_container"==this._type)for(this._isOpen="boolean"==typeof a?a:!this._isOpen,d=h+1;d<f;d++)if(h=b[d],"davinci.ve.palette.PaletteFolder"==h.declaredClass){if("subsection"!=h._type)break;0==h._children.length?(h.domNode.style.display="none",h.isOpen=!1):this._isOpen?(e.wipeIn({node:h.id,duration:100}).play(),h._isOpen=h==h.subsection_container._openSubsection):(e.wipeOut({node:h.id,duration:100}).play(),
h.isOpen=!1)}else this._isOpen&&h.PaletteFolderSubsection._isOpen?e.wipeIn({node:h.id,duration:100,onEnd:function(a){setTimeout(function(){a.style.height=""},1)}.bind(this,h.domNode)}).play():h.domNode.style.display="none";else for(this._isOpen="boolean"==typeof a?a:!this._isOpen,"subsection"==this._type&&(this.subsection_container._openSubsection=this._isOpen?this:null),d=h+1;d<f;){h=b[d];if("davinci.ve.palette.PaletteItem"!=h.declaredClass)break;for(h=this._paletteItemGroupInfo(b,d);d<=h.endIndex;d++){var c=
b[d],q=k.getWidgetDescriptorForType(c.type),m;q||(m=!0);if(q&&"custom"==q.category)m=!0;else if(q=q&&q.collection,m=!1,c.preset&&c.preset.collections)for(var r=c.preset.collections,z=0;z<r.length;z++){var y=r[z];if(y.id&&y.id===q){m=y.show;break}}d==h.selectedIndex&&m?this._isOpen?e.wipeIn({node:c.id,duration:100,onEnd:function(a){setTimeout(function(){a.style.height=""},1)}.bind(this,c.domNode)}).play():e.wipeOut({node:c.id,duration:100}).play():c.domNode.style.display="none"}}h=d}else"davinci.ve.palette.PaletteItem"==
d.declaredClass&&"none"!=d.domNode.style.display&&e.wipeOut({node:d.id,duration:100}).play(),"davinci.ve.palette.PaletteFolder"!=d.declaredClass||"simple"!=d._type&&"subsection"!=d._type||(d._isOpen=!1),"davinci.ve.palette.PaletteFolder"==d.declaredClass&&"subsection_container"==d._type&&d!=this.subsection_container&&(d._isOpen=!1),"davinci.ve.palette.PaletteFolder"!=d.declaredClass||"subsection"!=d._type||d.subsection_container._isOpen||"none"==d.domNode.style.display||(e.wipeOut({node:d.id,duration:100}).play(),
d._isOpen=!1),h++}return!1},folderMouseOverHandler:function(a){dojo.removeClass(this.domNode,"dojoyPaletteFolderLow");dojo.addClass(this.domNode,"dojoyPaletteFolderHi")},folderMouseOutHandler:function(a){dojo.removeClass(this.domNode,"dojoyPaletteFolderHi");dojo.addClass(this.domNode,"dojoyPaletteFolderLow")}})})},"davinci/ve/palette/PaletteItem":function(){define("dojo/_base/declare dojo/on dojo/_base/event dojo/query dojo/dom-construct dojo/dom-geometry dijit/focus dijit/_WidgetBase dojo/dom-class dojox/html/entities dijit/popup dijit/Tooltip dijit/TooltipDialog davinci/ve/tools/CreateTool davinci/ui/dnd/DragManager davinci/ve/utils/GeomUtils davinci/ve/metadata dojo/i18n!davinci/ve/nls/common".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y,B){return p("davinci.ve.palette.PaletteItem",g,{icon:"",displayName:"",name:"",paletteId:"",type:"",data:null,tool:"",palette:null,category:"",template:'\x3ca href\x3d"javascript:void(0)"\x3e\x3cspan class\x3d"paletteItemSelectionContainer"\x3e\x3c/span\x3e\x3cspan class\x3d"paletteItemNormalContainer"\x3e\x3cspan class\x3d"paletteItemImageContainer"\x3e\x3cimg class\x3d"paletteItemImage" border\x3d"0"/\x3e\x3c/span\x3e\x3cspan class\x3d"paletteItemLabelContainer"\x3e\x3cspan class\x3d"paletteItemLabel"\x3e\x3c/span\x3e\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e',
selectedWidgetTemplate:'\x3cspan class\x3d"paletteItemSelectionContent"\x3e\x3cspan class\x3d"paletteItemSelectedStrip paletteItemSelectedStripV paletteItemSelectedStripL"\x3e\x3c/span\x3e\x3cspan class\x3d"paletteItemSelectedStrip paletteItemSelectedStripV paletteItemSelectedStripR"\x3e\x3c/span\x3e\x3cspan class\x3d"paletteItemSelectedStrip paletteItemSelectedStripH paletteItemSelectedStripT"\x3e\x3c/span\x3e\x3cspan class\x3d"paletteItemSelectedStrip paletteItemSelectedStripH paletteItemSelectedStripB"\x3e\x3c/span\x3e\x3cspan class\x3d"paletteItemSelectedIcon paletteItemSelectedMoreIcon" title\x3d"'+
B.MoreIconTitleString+'"\x3e\x3c/span\x3e\x3cspan class\x3d"paletteItemSelectedIcon paletteItemSelectedHelpIcon" title\x3d"'+B.HelpIconTitleString+'"\x3e\x3c/span\x3e\x3c/span\x3e',preset:null,presetId:null,presetClassName:null,_paletteItemGroup:null,_collectionName:null,_paletteItemMoreConnects:[],_paletteItemHelpConnects:[],item:null,constructor:function(a){this.item=a},buildRendering:function(){this.palette=dijit.byId(this.paletteId);var a=this.domNode=dojo.create("div",{className:"dojoyPaletteCommon dojoyPaletteItem"});
a.innerHTML=this.template;a._paletteItem=this;this.presetClassName&&n.add(a,this.presetClassName);var c=this.type+"__"+this.presetId+"__"+this.PaletteFolderSection.section.id;this.PaletteFolderSubsection&&(c+="__"+this.PaletteFolderSubsection.subsection.id);dojo.attr(a,"selType",c);a=a.firstChild;dojo.attr(a,"tabIndex","0");a.onclick=this.palette.nop;c=a.querySelector("img");this.item&&this.item.iconHTML?(dojo.destroy(c),a.querySelector(".paletteItemImageContainer").innerHTML=this.item.iconHTML):
c.src=this.icon;a=a.querySelector(".paletteItemLabel");a.appendChild(dojo.doc.createTextNode(this.displayName));for(var c=f.encode(a.textContent),b=c.length-1;0<b;b--)0<="_-".indexOf(c[b])?(c=c.substr(0,b+1)+"\x26#8203;"+c.substr(b+1),a.innerHTML=c):c[b].toLowerCase()!=c[b]&&(c=c.substr(0,b)+"\x26#8203;"+c.substr(b),a.innerHTML=c);this.domNode.componentClassName=this.name;dojo.setSelectable(this.domNode,!1)},postCreate:function(){var a=e(".paletteItemNormalContainer",this.domNode)[0];this.connect(a,
"onmouseover","itemMouseOverHandler");this.connect(a,"onmouseout","itemMouseOutHandler");this.connect(this.domNode,"onmousedown","itemMouseDownHandler");this.connect(this.domNode,"onmouseup","itemMouseUpHandler");this.connect(this.domNode,"onkeydown","itemKeyDownHandler")},startup:function(){},isFocusable:function(){return"none"!=dojo.style(this.domNode,"display")},focus:function(){dijit.focus(this.domNode)},itemMouseOverHandler:function(a){this._mouseover=!0;a=this.domNode;this.palette.selectedItem!=
this&&this.raised(a);setTimeout(function(){if(this._mouseover&&0==this.palette.moreItems.length&&0==this.palette.helpItems.length&&this._tooltipNode!=this.domNode){this._tooltipNode&&dijit.hideTooltip(this._tooltipPos);this._tooltipNode=this.domNode;this._tooltipPos=k.position(this.domNode,!0);var a;a='\x3cdiv class\x3d"paletteTooltip"\x3e'+('\x3cdiv class\x3d"paletteTooltipCurrent"\x3e\x3cspan class\x3d"paletteTooltipCurrentWidget"\x3e'+f.encode(this.displayName)+'\x3c/span\x3e \x3cspan class\x3d"paletteTooltipCurrentLibrary"\x3e('+
this._collectionName+")\x3c/span\x3e\x3c/div\x3e");var c=this.palette.getPaletteItemsSameGroup(this);if(1<c.length){a+='\x3cdiv class\x3d"paletteTooltipAlternates"\x3e\x3cspan class\x3d"paletteTooltipAlternatesLabel"\x3e'+B.alternates+': \x3c/span\x3e\x3cspan class\x3d"paletteTooltipAlternatesLibraries"\x3e';for(var b=!1,d=0;d<c.length;d++){var g=c[d];g!=this&&(b&&(a+=", "),a+=g._collectionName,b=!0)}a=a+"\x3c/div\x3e"+('\x3cdiv class\x3d"paletteTooltipNote"\x3e'+B.howToChooseAlternate+"\x3c/div\x3e");
a+="\x3c/div\x3e"}dijit.showTooltip(a,this._tooltipPos);setTimeout(function(){dijit.hideTooltip(this._tooltipPos);this._tooltipPos=this._tooltipNode=null}.bind(this),5E3)}}.bind(this),750)},itemMouseOutHandler:function(a){this._mouseover=!1;this._tooltipPos&&(dijit.hideTooltip(this._tooltipPos),this._tooltipPos=this._tooltipNode=null);a=this.domNode;this.palette.selectedItem==this?this.sunken(a):this.flat(a)},itemMouseDownHandler:function(a){a=this.domNode;this.focus();this.sunken(a);this.palette.selectedItem&&
this.palette.selectedItem!=this&&(this.palette.removeSelectionAll(),this.flat(this.palette.selectedItem.domNode),this.palette.selectedItem=null);r.document=this.palette._context.getDocument();if(a=this.palette._context.frameNode){a=dojo.coords(a);var c=this.palette._context.getContainerNode();r.documentX=a.x-z.getScrollLeft(c);r.documentY=a.y-z.getScrollTop(c)}y.getHelper(this.type,"helper")},itemMouseUpHandler:function(c){c=this.domNode;if(this.palette.selectedItem==this)this.palette.removeSelectionAll(),
this.palette.selectedItem.flat(this.palette.selectedItem.domNode),this.palette.selectedItem=null,this.palette.sunkenItem=null,this.palette.flattenAll(),this.palette._context.setActiveTool(null),a.curNode&&a.curNode==c&&a.curNode.blur&&a.curNode.blur();else{this.palette.selectedItem&&this.palette.selectedItem!=this&&(this.palette.removeSelectionAll(),this.flat(this.palette.selectedItem.domNode),this.palette.selectedItem=null);this.palette.selectedItem=this;this.sunken(c);y.getHelper(this.type,"tool").then(function(a){a=
new (a||u)(dojo.clone(this.data),this.userData);this.palette._context.setActiveTool(a)}.bind(this));var b=function(){this.palette._contextMouseUpHandler&&(this.disconnect(this.palette._contextMouseUpHandler),this.palette._contextMouseUpHandler=null);this.palette._docMouseUpHandler&&(dojo.disconnect(this.palette._docMouseUpHandler),this.palette._docMouseUpHandler=null);this.palette.removeSelectionAll();this.palette.selectedItem=null;this.flat(this.domNode);this.palette._context.dragMoveCleanup()}.bind(this);
this.palette._contextMouseUpHandler=this.connect(this.palette._context,"onMouseUp",function(a){b()}.bind(this));setTimeout(function(){this.palette._docMouseUpHandler=dojo.connect(document,"onmouseup",function(a){var c=!1;if(this.palette.selectedItem){var d=this.palette.selectedItem.domNode;for(a=a.target;a&&"BODY"!=a.tagName;){if(a==d){c=!0;break}a=a.parentNode}}this.palette.selectedItem&&!c&&(b(),this.palette._context.setActiveTool(null))}.bind(this))}.bind(this),0)}},itemKeyDownHandler:function(a){a.keyCode==
dojo.keys.ENTER&&(this.palette.selectedItem&&(this.flat(this.palette.selectedItem.domNode),this.palette.selectedItem=null),y.getHelper(this.type,"tool").then(function(a){a=new (a||u)(dojo.clone(this.data));var c=this.palette._context;c.setActiveTool(a);a.create({target:c.getSelection()[0],position:{x:50,y:50}});c.setActiveTool(null);c.getContainerNode().focus()}),y.getHelper(this.type,"helper"))},flat:function(a){a&&(dojo.removeClass(a,"dojoyPaletteItemRaised"),dojo.removeClass(a,"dojoyPaletteItemSunken"),
dojo.addClass(a,"dojoyPaletteItemFlat"))},raised:function(a){dojo.removeClass(a,"dojoyPaletteItemFlat");dojo.removeClass(a,"dojoyPaletteItemSunken");dojo.addClass(a,"dojoyPaletteItemRaised");this.palette.raisedItems.push(this)},sunken:function(a){dojo.removeClass(a,"dojoyPaletteItemFlat");dojo.removeClass(a,"dojoyPaletteItemRaised");dojo.addClass(a,"dojoyPaletteItemSunken");this.palette.sunkenItems.push(this);this._selectionShowing=!0;e(".paletteItemSelectionContainer",this.domNode)[0].innerHTML=
this.selectedWidgetTemplate;var c=e(".paletteItemSelectedMoreIcon",a)[0],f=this.palette.getPaletteItemsSameGroup(this);1<f.length?(c.style.display="inline-block",m(c,"mousedown, mouseup",function(a){h.stop(a)}),m(c,"click",function(a){h.stop(a);this._tooltipNode&&(dijit.hideTooltip(this._tooltipPos),this._tooltipPos=this._tooltipNode=null);if(this._moreShowing)this.paletteItemMoreCloseCleanup();else{a=b.create("div",{className:"paletteItemMoreContent"});var g=b.create("span",{className:"paletteItemMoreCloseBox"},
a);b.create("div",{className:"paletteItemAlternatesLabel",innerHTML:B.alternateWidgets},a);this._paletteItemMoreConnects.push(m(g,"mousedown, mouseup",function(a){h.stop(a)}.bind(this)));this._paletteItemMoreConnects.push(m(g,"click",function(a){h.stop(a);this.paletteItemMoreCloseCleanup()}.bind(this)));for(var g=b.create("div",{className:"paletteItemAlternatesContainer"},a),k=[],e=0;e<f.length;e++){var n=f[e],r=n._collectionName,n=b.create("button",{className:"paletteItemAlternate "+(n._paletteGroupSelected?
"paletteItemMoreSelected":"paletteItemMoreUnselected"),innerHTML:r},g);k.push(n);this._paletteItemMoreConnects.push(m(n,"mousedown, mouseup",function(a){h.stop(a)}.bind(this)));this._paletteItemMoreConnects.push(m(n,"click",function(a,c){h.stop(c);for(var b,d=0;d<f.length;d++){var g=f[d];if(g._collectionName==a){b=g;break}}if(b){for(d=0;d<f.length;d++)g=f[d],g==b?(g._paletteGroupSelected=!0,g.domNode.style.display=this.palette._displayShowValue):(g._paletteGroupSelected=!1,g.domNode.style.display=
"none");b.sunken(b.domNode);y.getHelper(b.type,"tool").then(function(a){a=new (a||u)(dojo.clone(this.data));this.palette._context.setActiveTool(a)}.bind(b))}this.paletteItemMoreCloseCleanup()}.bind(this,r)))}this._tooltipDialog=new q({className:"paletteItemMorePopup",style:"width: auto; ",content:a,onShow:function(a){if(a=this._tooltipDialog.domNode.parentNode){var c=parseFloat(a.style.top);isNaN(c)||(a.style.top=c+12+"px")}}.bind(this)});d.open({popup:this._tooltipDialog,around:c,orient:["above-centered"]});
this._moreShowing=!0;this.palette.moreItems.push(this)}}.bind(this))):c.style.display="none";var g=e(".paletteItemSelectedHelpIcon",a)[0];m(g,"mousedown, mouseup",function(a){h.stop(a)}.bind(this));m(g,"click",function(a){h.stop(a);this._tooltipNode&&(dijit.hideTooltip(this._tooltipPos),this._tooltipPos=this._tooltipNode=null);if(this._helpShowing)this.paletteItemHelpCloseCleanup();else{var c=y.getOamDescriptivePropertyForType(this.type,"title"),f=y.getOamDescriptivePropertyForType(this.type,"description");
a=b.create("div",{className:"helpInnerContent"});var k=b.create("div",{className:"paletteTooltipCurrent"},a);b.create("span",{className:"paletteTooltipCurrentWidget"},k).textContent=this.name;this._collectionName&&b.create("span",{className:"paletteTooltipCurrentLibrary",innerHTML:" ("+this._collectionName+")"},k);k={container:"helpInnerContentSummary",title:"helpInnerContentSummaryTitle",content:"helpInnerContentSummaryContent"};this._createHelpSection(c,a,B.summary,k);this._createHelpSection(f,
a,B.description,k);c=b.create("div",{className:"paletteItemHelpContent"});f=b.create("span",{className:"paletteItemHelpCloseBox"},c);b.create("div",{className:"paletteItemHelpDescription"},c).appendChild(a);this._paletteItemHelpConnects.push(m(f,"mousedown, mouseup",function(a){h.stop(a)}.bind(this)));this._paletteItemHelpConnects.push(m(f,"click",function(a){h.stop(a);this.paletteItemHelpCloseCleanup()}.bind(this)));this._tooltipDialog=new q({className:"paletteItemHelpPopup",style:"width: auto; ",
content:c,onShow:function(a){if(a=this._tooltipDialog.domNode.parentNode){var c=parseFloat(a.style.top);isNaN(c)||(a.style.top=c-12+"px")}}.bind(this)});d.open({popup:this._tooltipDialog,around:g,orient:["below-centered"]});this._helpShowing=!0;this.palette.helpItems.push(this)}}.bind(this))},_createHelpSection:function(a,c,d,f){a&&a.value&&(c=b.create("div",{className:f.container},c),b.create("div",{className:f.title,innerHTML:d},c),d=b.create("div",{className:f.content},c),"text/html"==a.type?d.innerHTML=
a.value:d.textContent=a.value)},paletteItemMoreCloseCleanup:function(){if(this._moreShowing){for(var a=0;a<this._paletteItemMoreConnects.length;a++)this._paletteItemMoreConnects[a].remove();this._paletteItemMoreConnects=[];this._moreShowing=!1;index=this.palette.moreItems.indexOf(this);0<=index&&this.palette.moreItems.splice(index,1)}this._tooltipDialog&&(d.close(this._tooltipDialog),this._tooltipDialog.destroyRecursive(),this._tooltipDialog=null)},paletteItemHelpCloseCleanup:function(){if(this._helpShowing){for(var a=
0;a<this._paletteItemHelpConnects.length;a++)this._paletteItemHelpConnects[a].remove();this._paletteItemHelpConnects=[];this._helpShowing=!1;index=this.palette.helpItems.indexOf(this);0<=index&&this.palette.helpItems.splice(index,1)}this._tooltipDialog&&(d.close(this._tooltipDialog),this._tooltipDialog.destroyRecursive(),this._tooltipDialog=null)},updateImgSrc:function(a){this.domNode.querySelector(".paletteItemImage").src=a}})})},"davinci/ui/dnd/DragManager":function(){define(["dojo/_base/declare",
"dojo/_base/array","dojo/_base/connect","dojo/mouse"],function(p,m,h){p=p("",null,{disabled:!1,currentDragSource:null,currentDropTarget:null,dropAcceptable:!1,dropTargets:null,dragTriggered:!1,currentDomElement:null,_connectors:null,_moveConnector:null,document:null,documentX:0,documentY:0,_ABSOLUTE_THRESHOLD:3,_STATIC_THRESHOLD:40,constructor:function(){this.dropTargets=[];this._connectors=[h.connect(dojo.doc,"onkeydown",this,"onKeyDown"),h.connect(dojo.doc,"onmouseover",this,"onMouseOver"),h.connect(dojo.doc,
"onmouseout",this,"onMouseOut"),h.connect(dojo.doc,"onmousedown",this,"onMouseDown"),h.connect(dojo.doc,"onmouseup",this,"onMouseUp")]},destroy:function(){m.forEach(this._connectors,dojo.disconnect)},onKeyDown:function(b){27==b.keyCode&&this.currentDragSource&&(this.dropAcceptable=!1,this.onMouseUp(b))},onMouseDown:function(b,k){if(!(this.disabled||this.dragTriggered||!dojo.mouseButtons.isLeft(b)||b.metaKey||b.ctrlKey||this.dragTriggered)){var a=this.currentDragSource=k||this.findDragSource(b);if(a){a.onDragDown(b);
for(var a=0,g=this.dropTargets.length;a<g;a++){var e=this.dropTargets[a];if(!e.disabled)e.onDragDown(b)}b.preventDefault();this._moveConnectors=[h.connect(dojo.doc,"onmousemove",this,"onMouseMove")];this.document&&this.document!=dojo.doc&&(this._moveConnectors.push(h.connect(this.document,"onmousemove",this,"onMouseMove")),this._moveConnectors.push(h.connect(this.document,"onmouseover",this,"onMouseOver")),this._moveConnectors.push(h.connect(this.document,"onmouseout",this,"onMouseOut")),this._moveConnectors.push(h.connect(this.document,
"onmouseup",this,"onMouseUp")))}}},onMouseMove:function(b){b.preventDefault();dojo.isIE&&(b.pageX-=2,b.pageY-=2);if(b.target==this.document||b.target.ownerDocument==this.document)b.documentX=this.documentX,b.documentY=this.documentY,b.documentX-=this.document.documentElement.scrollLeft,b.documentY-=this.document.documentElement.scrollTop;var k=b.dragSource=this.currentDragSource;if(!this.dragTriggered){var a=b.pageX-k.pageX,g=b.pageY-k.pageY,a=Math.sqrt(a*a+g*g);if("absolute"==k.positioning){if(a<
this._ABSOLUTE_THRESHOLD)return}else if(a<this._STATIC_THRESHOLD)return;this.dragTriggered=!0;k.onDragStart(b);a=0;for(g=this.dropTargets.length;a<g;a++){var e=this.dropTargets[a];e.disabled||(b.dropTarget=e,e.onDragStart(b))}this.onMouseOver(b)}k.onDragMove(b);(e=this.currentDropTarget)?this.dropAcceptable&&(b.dropTarget=e,e.onDragMove(b,this.dragObjects)):this.dropAcceptable=!1},onMouseOver:function(b){this.currentDomElement=b.target;if(this.dragTriggered){var k=this.currentDragSource;if(k){b.dragSource=
k;var a=this.findDropTarget(this.currentDomElement,k);a&&k.domNode==a.domNode||(a!=this.currentDropTarget&&(this.currentDropTarget&&(b.dropTarget=this.currentDropTarget,this.currentDropTarget.onDragOut(b)),a&&(b.dropTarget=a,this.dropAcceptable=a.onDragOver(b))),this.currentDropTarget=a)}}},onMouseOut:function(b){},onMouseUp:function(b){if(!this.ignoreMouseUp){m.forEach(this._moveConnectors,dojo.disconnect);if(this.dragTriggered){for(var k=0,a=this.dropTargets.length;k<a;k++){var g=this.dropTargets[k];
g.disabled||(b.dropTarget=g,g.onDragEnd(b))}k=this.currentDragSource;a=this.currentDropTarget;b.dragSource=k;b.dropTarget=a;if(k&&(a?(a.onDropStart(b),this.dropAcceptable?(g=a.onDrop(b),a.onDragOut(b),void 0==g||b.dragStatus||(b.dragStatus=g?"dropSuccess":"dropFailure")):(a.onDragOut(b),b.dragStatus="dropFailure")):b.dragStatus="dropFailure",k.onDragEnd(b),a))a.onDropEnd(b)}this._resetStatus()}},_resetStatus:function(){this.currentDragSource=this.currentDropTarget=null;this.dragTriggered=this.dropAcceptable=
!1;this.currentDomElement=null},findDragSource:function(b){for(b=b.target;b&&b!=dojo.doc.body;b=b.parentNode)if(b.dragSource&&!b.dragSource.disabled)return b.dragSource;return null},findDropTarget:function(b,k){for(var a=null,g=b,e=null;null!=g&&g!=dojo.doc.body;g=g.parentNode){var f=g.dropTarget;if(f&&!f.disabled&&f.accepts(k)){a=f;a.nodeUnderMouse=e;break}g.dragSource&&!g.dragSource.disabled&&(e=g)}return a},registerDropTarget:function(b){this.dropTargets.push(b)},unregisterDropTarget:function(b){for(var k=
0,a=this.dropTargets.length;k<a;k++)if(this.dropTargets[k]==b){this.dropTargets.splice(k,1);break}}});var e=new p;e.Module=p;return e})},"davinci/ve/views/StatesView":function(){define("dojo/_base/declare dojo/query dojo/dom-class dojo/_base/connect dojo/aspect dojo/i18n!../nls/ve davinci/workbench/ViewPart dijit/layout/BorderContainer dijit/layout/ContentPane davinci/XPathUtils davinci/ve/States davinci/ve/widget davinci/ve/_Widget davinci/ve/commands/AppStateCommand dojo/data/ItemFileWriteStore dijit/tree/ForestStoreModel dijit/Tree dojo/_base/window".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y,B){p(y._TreeNode,{});var x=p(y._TreeNode,{_setLabelAttr:{node:"labelNode",type:"innerHTML"}}),w="sceneId category node sceneContainerNode isCurrent isFocus isInitial".split(" ");return p("davinci.ve.views.StatesView",[a],{nextId:0,_lastSelectedId:null,postCreate:function(){this.inherited(arguments);this._themeState=null;this.container=new g({design:"headline",gutters:!1,liveSplitters:!1});this.centerPane=new n({region:"center"});this.container.addChild(this.centerPane);
this.container.layout();this.container.startup();this.setContent(this.container);this.subscribe("/davinci/ui/editorSelected",this._editorSelected.bind(this));this.subscribe("/davinci/ui/context/loaded",this._contextLoaded.bind(this));this.subscribe("/davinci/ui/context/statesLoaded",this._statesLoaded.bind(this));this.subscribe("/davinci/ui/context/pagebuilt",this._pagebuilt.bind(this));this.subscribe("/davinci/ui/context/pagerebuilt",this._pagerebuilt.bind(this));this.subscribe("/davinci/states/statesReordered",
this._statesReordered.bind(this));this.subscribe("/davinci/ui/deviceChanged",this._deviceChanged.bind(this));this.subscribe("/davinci/states/state/added",this._addState.bind(this));this.subscribe("/davinci/states/state/removed",this._removeState.bind(this));this.subscribe("/davinci/states/state/renamed",this._renameState.bind(this));this.subscribe("/davinci/states/state/changed",this._changeState.bind(this));this.subscribe("/maqetta/appstates/state/changed",this._changeState.bind(this));this.subscribe("/maqetta/appstates/state/containerChange",
this._containerChange.bind(this));this.subscribe("/davinci/ui/context/registerSceneManager",this._registerSceneManager.bind(this));this.subscribe("/davinci/scene/scenesLoaded",this._scenesLoaded.bind(this));this.subscribe("/davinci/scene/added",this._addScene.bind(this));this.subscribe("/davinci/scene/removed",this._removeScene.bind(this));this.subscribe("/davinci/scene/renamed",this._renameScene.bind(this));this.subscribe("/davinci/scene/selectionChanged",this._sceneSelectionChanged.bind(this));
dojo.subscribe("/davinci/ui/widgetPropertiesChanged",dojo.hitch(this,this._widgetPropertiesChanged));this.subscribe("/davinci/ui/widgetSelected",dojo.hitch(this,this._widgetSelectionChanged));this.attachToolbar();dojo.style(this.toolbarDiv,"display","none")},_contextLoaded:function(){},_pagebuilt:function(){this._statesLoaded.apply(this,arguments)},_pagerebuilt:function(){this._destroyTree();this._statesLoaded.apply(this,arguments)},_statesReordered:function(){this._destroyTree();this._statesLoaded.apply(this,
arguments)},_statesLoaded:function(){this._editor&&"davinci.ve.themeEditor.ThemeEditor"!=this._editor.declaredClass&&this._updateView();this._hideShowToolBar()},_deviceChanged:function(){this._updateView()},_addState:function(){this._updateView()},_removeState:function(){this._updateView()},_renameState:function(){this._updateView()},_changeState:function(a){this.isThemeEditor()?this._updateThemeSelection(a.newState):this._updateView()},_containerChange:function(){this._updateView()},_registerSceneManager:function(a){},
_scenesLoaded:function(a){this._updateView()},_addScene:function(a,c,b){this._updateView()},_removeScene:function(a,c,b){this._updateView()},_renameScene:function(a,c,b){this._updateView()},_widgetPropertiesChanged:function(){this._updateView()},_widgetSelectionChanged:function(a){this._editor&&this._editor.getContext&&this._tree&&this._sceneStore&&(a=this._editor.getContext().getSelection(),1==a.length&&(a=a[0].domNode)&&a._maqAppStates&&this._sceneStore.fetch({query:{node:a},queryOptions:{deep:!0},
onComplete:dojo.hitch(this,function(a,c){if(0<a.length){var b=this._getTreeSelectionPath(a[0]);this._tree.set("path",b)}})}))},_sceneSelectionChanged:function(a,c){a&&a.category&&c&&this._updateView()},_editorSelected:function(a){a=a.editor;this._destroyTree();this._unregisterForContextEvents();a&&a.supports("states")?(this._editor=a,dojo.style(this.container.domNode,"display","block"),"davinci.ve.themeEditor.ThemeEditor"===a.declaredClass?(this.set("title",k.States),this._updateViewForThemeEditor(),
this._themeState?this._updateThemeSelection(this._themeState):this._updateThemeSelection("Normal")):(this.set("title",k.Scenes),this._registerForContextEvents(),this._updateView()),this.container.layout()):(delete this._editor,dojo.style(this.container.domNode,"display","none"));this._hideShowToolBar()},_getRootNode:function(){var a=this._editor,c;a&&a.getContext&&(c=(a=a.getContext())&&a.rootNode);return c},_updateView:function(){if(this._editor&&this._editor.getContext&&!this.isThemeEditor()){var a=
this._editor.getContext();a&&a._statesLoaded&&B.withDoc(document,function(){this._updateList();this._updateSelection()},this)}},isThemeEditor:function(){return this._editor&&"davinci.ve.themeEditor.ThemeEditor"===this._editor.declaredClass},_updateViewForThemeEditor:function(){var a=this._editor._theme.getStatesForAllWidgets(),c={Normal:"Normal"};if(a)for(var b=0;b<a.length;b++){var d=a[b];"Normal"!=d&&(c[d]=d)}window.latestStates=c;var a=this._getScenes(),c={name:this._editor&&this._editor.getFileNameToDisplay?
this._editor.getFileNameToDisplay():this._editor&&this._editor.fileName?this._editor.fileName:"file",type:"file",category:"file",children:[]},b=[],d=[c],f;for(f in latestStates)b.push({name:f,sceneId:f,type:"AppState"});c.children=c.children.concat(b);this._compareStructures(d,a)||(this._destroyTree(),this._createTree(d))},_updateList:function(){function a(b,g){var m,r,u=b.declaredClass&&b.isInstanceOf&&b.isInstanceOf(q);u?(m=b,r=m.domNode):(m=null,r=b);var A=d.isStateContainer(r),B=!1,z;for(z in k){var y=
k[z];if(y.getSceneChildren&&y.name&&y.category&&(B=y.isSceneContainer(r)))break}if("BODY"==r.tagName||A||B){for(var x=null,C=0;C<e.length;C++)if(y=e[C],y.node==r){x=y;break}var p=null;if(!x){var w=r.parentNode;a:for(;w;){for(C=0;C<e.length;C++)if(y=e[C],y.node==w){p=y;break a}if("BODY"==w.tagName)break;w=w.parentNode}}if(x)g=x;else{var G=u?c.getLabel(m):c.getLabelForNode(r),C=f.getXPath(r),G={name:G,type:"file",category:"file",node:r,children:[]};p?(G.maqid=p.maqid+"$"+C,p.children.push(G)):(G.maqid=
g.maqid+"$"+C,g.children.push(G));e.push(G);g=G}if(A){C=d.getStates(r);y=d.getState(r);y||(y=d.NORMAL);w=d.getInitial(r);w||(w=d.NORMAL);for(var N={maqid:g.maqid+"$AppStates",name:"Application States",type:"SceneManagerRoot",category:"AppStates",sceneContainerNode:r,parentItem:g,children:[]},S=0;S<C.length;S++){var T=C[S],G=h._treeNodeContent("Normal"==T?"Background":T),A=n&&n.stateContainerNode==r&&n.state==y,p=T===y,x=T===w,G={maqid:N.maqid+"$"+T,name:G,sceneId:T,type:"AppState",isFocus:A,isCurrent:p,
isInitial:x,sceneContainerNode:r,parentItem:N};N.children.push(G);e.push(G)}g.children.push(N);e.push(N)}if(B)for(z in k)if(y=k[z],y.getSceneChildren&&y.getCurrentScene&&y.getInitialScenes&&y.name&&y.category&&(B=y.getSceneChildren(r),0<B.length)){w=y.getCurrentScene(r);N=y.getInitialScenes(r);C=f.getXPath(r);S={maqid:g.maqid+"$"+C,name:y.name,type:"SceneManagerRoot",category:y.category,parentItem:g,children:[]};for(T=0;T<B.length;T++){var W=B[T],G=u?c.getLabel(W._dvWidget):c.getLabelForNode(W),G=
h._treeNodeContent(G),A=!1,p=W===w,x=0<=N.indexOf(W),C=f.getXPath(W),G={maqid:S.maqid+"$"+C,name:G,sceneId:W.id,type:y.category,isFocus:A,isCurrent:p,isInitial:x,sceneContainerNode:r,parentItem:S,node:W,children:[]};S.children.push(G);e.push(G)}g.children.push(S);e.push(G)}}m=u?m.getChildren():d._getChildrenOfNode(r);for(r=0;r<m.length;r++)a(m[r],g)}var b=this._getScenes();if(this._editor&&b){var g=this._editor.getContext();if(g&&g.rootWidget&&g.rootNode&&g._statesLoaded){var k=g.sceneManagers,e=
[],h=this,n=d.getFocus(g.rootNode);n&&!n.state&&(n.state=d.NORMAL);var m={maqid:"root",children:[]};a(g.rootWidget,m);g=[m.children[0]];if(!this._compareStructures(g,b)){var r=null;this._tree&&this._sceneStore&&(b=this._tree.get("path"),0<b.length&&(r=b[b.length-1].maqid[0]));this._destroyTree();this._createTree(g);r&&this._tree.onLoadDeferred.then(function(){this._sceneStore.fetch({query:{maqid:r},queryOptions:{deep:!0},onComplete:dojo.hitch(this,function(a,c){if(1===a.length){var b=this._getTreeSelectionPath(a[0]);
0<b.length&&this._tree.set("path",b)}})})}.bind(this))}this._hideShowToolBar()}}},_getTreeSelectionPath:function(a){var c=[];c.splice(0,0,a.id[0]);for(a=a.parentItem&&a.parentItem[0];a;)c.splice(0,0,a.id[0]),a=a.parentItem&&a.parentItem[0];c.splice(0,0,"StoryRoot");return c},_updateSelection:function(){if(this._editor&&this._tree){var a=this._editor.getContext();a&&a._statesLoaded&&this._tree.onLoadDeferred.then(function(){var c=this._tree.get("path"),c=0<c.length?c[c.length-1].maqid[0]:null,b=a.sceneManagers,
f;for(f in b){var g=b[f];if(g.getAllSceneContainers&&g.getSceneChildren&&g.getCurrentScene){g.getAllSceneContainers();var k;this._sceneStore.fetch({query:{type:g.category},queryOptions:{deep:!0},onComplete:dojo.hitch(this,function(a,c){k=a})});for(g=0;g<k.length;g++){var e=k[g],n=this._findTreeNodeSpanByClass(e,"ScenesPaletteCurrent"),q=this._findTreeNodeSpanByClass(e,"ScenesPaletteInitial");e.isCurrent&&e.isCurrent[0]?n&&h.remove(n,"ScenesPaletteCurrentHidden"):n&&h.add(n,"ScenesPaletteCurrentHidden");
e.isInitial&&e.isInitial[0]?q&&h.remove(q,"ScenesPaletteInitialHidden"):q&&h.add(q,"ScenesPaletteInitialHidden");e.maqId&&e.maqId[0]==c&&(n=e.node&&e.node[0])&&n._maqAppStates&&(q=d.getState(n),d.setState(q,n,{focus:!0,updateWhenCurrent:!0}))}}}var m=[];this._sceneStore.fetch({query:{type:"AppState"},queryOptions:{deep:!0},onComplete:dojo.hitch(this,function(a,c){m=a})});for(g=0;g<m.length;g++)f=m[g],n=this._findTreeNodeSpanByClass(f,"ScenesPaletteCurrent"),q=this._findTreeNodeSpanByClass(f,"ScenesPaletteInitial"),
f.isCurrent&&f.isCurrent[0]?n&&h.remove(n,"ScenesPaletteCurrentHidden"):n&&h.add(n,"ScenesPaletteCurrentHidden"),f.isInitial&&f.isInitial[0]?q&&h.remove(q,"ScenesPaletteInitialHidden"):q&&h.add(q,"ScenesPaletteInitialHidden")}.bind(this))}},_updateThemeSelection:function(a){if(this._sceneStore){var c;a||(a="Normal");this._sceneStore.fetch({query:{type:"AppState",sceneId:a},queryOptions:{deep:!0},onComplete:dojo.hitch(this,function(a,b){1===a.length&&(c=a[0].sceneId[0])})});c&&this._updateSelectedScene("AppState",
c)}},_getScenes:function(){var a=[];this._sceneStore&&this._sceneStore.fetch({query:{},queryOptions:{},onComplete:dojo.hitch(this,function(c,b){function d(a,c){for(var b={name:a.name[0],type:a.type[0]},f=0;f<w.length;f++){var g=w[f];a[g]&&(b[g]=a[g][0])}c.push(b);a.children&&0<a.children.length&&(b.children=[],a.children.forEach(function(a){d(a,b.children)}))}c.forEach(function(c){d(c,a)})})});return a},_compareStructures:function(a,c){function b(a,c){if(a.length!=c.length)return!1;for(var d=0;d<
a.length;d++){var f;a:{f=a[d];for(var g=c[d],k=0;k<w.length;k++){var e=w[k];e=f[e]&&!g[e]||!f[e]&&g[e]?!1:f[e]&&f[e]!==g[e]?!1:!0;if(!e){f=!1;break a}}k=f.children&&f.children.length;e=g.children&&g.children.length;f=k&&!e||!k&&e||k&&!b(f.children,g.children)?!1:!0}if(!f)return!1}return!0}return b(a,c)},_destroyTree:function(){this._tree&&(this._tree.destroyRecursive(),this._forest.destroy(),this._tree=this._forest=this._sceneStore=null)},_createTree:function(a){require(["dijit/tree/dndSource"],function(c){c=
function(a,c,b){if(a&&c){var d,f,g;c.forInSelectedItems(function(a){if(d=a.data&&a.data.item)f=d.parentItem&&d.parentItem[0],g=f.children&&f.children.indexOf(d)});var k,e;(a=dijit.getEnclosingWidget(a).item)&&(k=a.parentItem&&a.parentItem[0])&&(e=k.children&&k.children.indexOf(a));return"over"!=b&&d&&a&&f&&k&&"AppState"==d.type[0]&&"AppState"==a.type[0]&&f==k&&0!==g&&!("before"==b&&0===e)&&!("before"==b&&g+1==e)&&!("after"==b&&g==e+1)}}.bind(this);var f=function(a,c,b){if(a.tree==this._tree){var d,
f;a.forInSelectedItems(function(a){(d=a.data&&a.data.item)&&(f=d.parentItem&&d.parentItem[0])});if((a=f.sceneContainerNode&&f.sceneContainerNode[0])&&a._maqAppStates&&a._maqAppStates.states){c=[];for(b=1;b<f.children.length;b++)c.push(f.children[b].sceneId[0]);a=new u({action:"reorder",newStatesList:c,stateContainerNode:a,context:g});g.getCommandStack().execute(a)}}}.bind(this);if(this._editor){var g=this._editor.getContext(),k=g.sceneManagers;this._sceneStore=new r({data:{identifier:"id",label:"name",
items:[]},clearOnClose:!0});this._forest=new z({store:this._sceneStore,query:{type:"file"},rootId:"StoryRoot",rootLabel:"All",childrenAttrs:["children"]});this._tree=new y({model:this._forest,persist:!1,showRoot:!1,autoExpand:!0,dndController:"dijit.tree.dndSource",dragThreshold:8,betweenThreshold:5,checkItemAcceptance:c,className:"StatesViewTree",style:"height:150px; overflow-x:hidden; overflow-y:auto;",_createTreeNode:function(a){return new x(a)},getIconClass:function(a,c){return"dijitLeaf"}});
this._tree.tree&&this._tree.tree.dndController&&b.after(this._tree.tree.dndController,"onDndDrop",f,!0);this.centerPane.domNode.appendChild(this._tree.domNode);dojo.connect(this._tree,"onClick",this,function(a){var c=this._editor,b=c?c.getContext():null,f=null,g=null,e=null;a&&a.type&&(g=a.type[0],e=a.category&&a.category[0],"AppState"==g||"SceneManagerRoot"==g&&"AppStates"==e?f=a.sceneContainerNode?a.sceneContainerNode[0]:null:a.node&&a.node[0]._maqAppStates&&(f=a.node[0]));if(this.isThemeEditor())this.publish("/davinci/states/state/changed",
[{editorClass:c.declaredClass,widget:"$all",newState:a.sceneId[0],oldState:this._themeState,context:this._editor.context}]),this._themeState=a.sceneId[0];else{b&&f&&(e="AppState"==g?a.sceneId?a.sceneId[0]:null:d.getState(f),d.setState(e,f,{focus:!0,updateWhenCurrent:!0}),"davinci.ve.PageEditor"===this._editor.declaredClass&&(b.deselectInvisible(),b.clearCachedWidgetBounds(),b.updateFocusAll()));if(a.sceneId)for(var h in k){if(c=k[h],c.selectScene&&c.selectScene({sceneId:a.sceneId[0]}))break}else a.type&&
"file"==a.type[0]&&a.node&&a.node[0]._dvWidget&&b.select(a.node[0]._dvWidget);this._updateSelection()}});var e=function(a,c){var b=dojo.mixin({},a),d=this.nextId+"";this.nextId++;b.id=d;b.parentItem=c;delete b.children;var f;f=c?this._sceneStore.newItem(b,{parent:c,attribute:"children"}):this._sceneStore.newItem(b);a.children&&a.children.forEach(function(a){e(a,f)})}.bind(this);a.forEach(function(a){e(a)});this._sceneStore.save();if(this._tree.getParent){var h=this._tree.getParent();h.resize&&window.setTimeout(function(){h.resize()},
0)}}}.bind(this))},_updateSelectedScene:function(a,c){if(this._sceneStore){for(var b=c,d=[];b;)this._sceneStore.fetch({query:{type:a,sceneId:b},queryOptions:{deep:!0},onComplete:dojo.hitch(this,function(a,c){if(1!==a.length)console.error("_sceneSelectionChanged error. currentSceneId\x3d"+b+",items.length\x3d"+a.length),b=null;else{var f=a[0];d.splice(0,0,f.id[0]);b=f.parentSceneId?f.parentSceneId[0]:null;for(f=f.parentItem&&f.parentItem[0];f;)d.splice(0,0,f.id[0]),f=f.parentItem&&f.parentItem[0]}})});
d.splice(0,0,"StoryRoot");this._tree.set("paths",[d])}},_hideShowToolBar:function(){function a(c,b){var d=c+"Disabled",f=m("."+c);f.length&&(b?h.remove(f[0],d):h.add(f[0],d))}if(this._editor){var c=this._editor.getContext&&this._editor.getContext();dojo.style(this.toolbarDiv,"display","davinci.ve.PageEditor"===this._editor.declaredClass?"block":"none");var b,f,g;b=f=g=!1;c&&c.rootNode&&((c=d.getFocus(c.rootNode))&&c.stateContainerNode&&(b=g=!0),c&&c.state&&c.state!==d.NORMAL&&(f=g=!0));a("addStateIcon",
b);a("removeStateIcon",f);a("modifyStateIcon",g)}},_treeNodeContent:function(a){var c;c=""+('\x3cspan title\x3d"'+k.InitialScene+'" class\x3d"ScenesPaletteAppStateIcon ScenesPaletteInitial"\x3e\x26#x2713;\x3c/span\x3e');c+='\x3cspan title\x3d"'+k.ActiveScene+'" class\x3d"ScenesPaletteAppStateIcon ScenesPaletteCurrent"\x3e\x3c/span\x3e';return c+("\x3cspan\x3e"+a+"\x3c/span\x3e")},_findTreeNodeSpanByClass:function(a,c){var b=this._tree.getNodesByItem(a),d=(b=b&&0<b.length?b[0]:null)?b.domNode:null;
return(b=b?dojo.query("."+c,d):[])&&0<b.length?b[0]:null},_contextEventHandler:function(){this._updateView()},_unregisterForContextEvents:function(){this._contextConnects&&(this._contextConnects.forEach(e.disconnect),this._contextConnects=null)},_registerForContextEvents:function(){var a=["widgetChanged","widgetAddedOrDeleted"];this._unregisterForContextEvents();var c=this._editor&&this._editor.getContext&&this._editor.getContext();c&&(this._contextConnects=[],a.forEach(function(a){c[a]&&this._contextConnects.push(e.connect(c,
a,this,"_contextEventHandler"))}.bind(this)))}})})},"davinci/XPathUtils":function(){define(function(){function p(h){this.node=h}p.prototype={name:function(){return this.node.nodeName},parent:function(){var h=this.node.parentNode;if(h!==this.node.ownerDocument)return new p(h)},index:function(){var h=this.node.nodeName,e=this.node.parentNode,b=!1,k=0;e.id||(e.id="__XPATH_UTILS_TEMP_ID__"+Date.now(),b=!0);h=e.querySelectorAll("#"+e.id+"\x3e"+h);if(1<h.length)for(var a=0,g=h.length;a<g;a++)if(h[a]===
this.node){k=a+1;break}b&&(e.id="");return k}};var m=/(\w+)(?:\[(\d+)\])?/;return{getXPath:function(h,e){function b(a,g){var k=g.name(),f=g.parent();if(f){var d=g.index();a=(d?k+("["+d+"]"):k+"[1]")+(a?"/"+a:"");return b(a,f)}return"/"+k+"/"+a}e=e||p;var k=new e(h);return b("",k).toLowerCase()},toCssPath:function(h){"/"===h.charAt(0)&&(h=h.substr(1));var e="";h.split("/").forEach(function(b){b=b.match(m);var k=b[2];e+=(e?"\x3e":"")+b[1];k&&(e+=":nth-of-type("+k+")")});return e}}})},"davinci/ve/commands/AppStateCommand":function(){define("dojo/_base/declare dojo/_base/lang dojo/topic davinci/XPathUtils davinci/html/HtmlFileXPathAdapter davinci/ve/States".split(" "),
function(p,m,h,e,b,k){return p("davinci.ve.commands.AppStateCommand",null,{name:"AppStateCommand",_actions:["add","remove","modify","reorder"],constructor:function(a){if(a){this._params=m.mixin({},a);var g=a.stateContainerNode;g&&g._dvWidget&&(this._params.stateContainerId=g.id,this._params.stateContainerXpath=e.getXPath(g._dvWidget._srcElement,b));"reorder"==this._params.action&&((g=this._getStateContainerNode())&&a.newStatesList.length?(this._oldStatesList=k.getStates(g),this._oldStatesList.shift()):
this._params=null)}},_validParams:function(){return this._params&&0<=this._actions.indexOf(this._params.action)&&this._params.stateContainerNode&&this._params.stateContainerId&&this._params.stateContainerXpath&&this._params.context},_getStateContainerNode:function(){var a,b=this._params.context;if(!b)return a;var k=b.getDocument();if(!k)return a;var f=this._params.stateContainerXpath;a=k.getElementById(this._params.stateContainerId);a||(b=b.model.evaluate(f))&&(a=k.getElementById(b.getAttribute("id")));
return a},execute:function(){if(this._validParams()){var a=this._params.action,b=this._params.state,e=this._getStateContainerNode();e&&("add"==a?(k.add(e,b),this._setStateAndFocus(e)):"remove"==a?(this._stateIndex=e._maqAppStates&&e._maqAppStates.states&&e._maqAppStates.states.indexOf(b),this._preservedNodesId=[],this._preservedNodesXpath=[],this._preservedStateValues=[],this._preserveStateFromNodeRecursive(e,b),k.remove(e,b),this._setStateAndFocus(e)):"modify"==a?(this._params.newState&&(this._traverseRenameState(this._params.state,
this._params.newState),h.publish("/davinci/states/state/renamed",{node:e,oldName:this._params.state,newName:this._params.newState,stateContainerNode:e})),"string"==typeof this._params.initialState&&(this._oldInitialState=k.getInitial(e),a="undefined"==this._params.initialState?void 0:this._params.initialState,this._params.newState&&a==this._params.state&&(a=this._params.newState),k.setState(a,e,{initial:a,updateWhenCurrent:!0})),this._setStateAndFocus(e)):"reorder"==a&&e&&e._maqAppStates&&e._dvWidget&&
(e._maqAppStates.states=this._params.newStatesList,a=k.stringifyWithQuotes(e._maqAppStates),e.setAttribute(k.APPSTATES_ATTRIBUTE,a),srcElement=e._dvWidget._srcElement,srcElement.setAttribute(k.APPSTATES_ATTRIBUTE,a),h.publish("/davinci/states/statesReordered",[e,this._params.newStatesList])))}},undo:function(){if(this._validParams()){var a=this._params.action,b=this._params.state,e=this._getStateContainerNode();e&&("add"==a?(k.remove(e,b),this._setStateAndFocus(e)):"remove"==a?(k.add(e,b,{index:this._stateIndex}),
this._restoreState(b),k.setState(b,e,{focus:!0}),this._setStateAndFocus(e)):"modify"==a?("string"==typeof this._params.initialState&&k.setState(this._oldInitialState,e,{initial:this._oldInitialState,updateWhenCurrent:!0}),this._params.newState&&this._traverseRenameState(this._params.newState,this._params.state),this._setStateAndFocus(e)):"reorder"==a&&e&&e._maqAppStates&&e._dvWidget&&(e._maqAppStates.states=this._oldStatesList,a=k.stringifyWithQuotes(e._maqAppStates),e.setAttribute(k.APPSTATES_ATTRIBUTE,
a),srcElement=e._dvWidget._srcElement,srcElement.setAttribute(k.APPSTATES_ATTRIBUTE,a),h.publish("/davinci/states/statesReordered",[e,this._params.newStatesList])))}},_setStateAndFocus:function(a){var b=k.getState(a);k.setState(b,a,{focus:b,updateWhenCurrent:!0})},_preserveStateFromNodeRecursive:function(a,b){var k=a._dvWidget;if(a&&k&&b){this._preserveStateFromNode(a,b);for(var k=k.getChildren(),f=0;f<k.length;f++)this._preserveStateFromNodeRecursive(k[f].domNode,b)}},_preserveStateFromNode:function(a,
g){a&&a._maqDeltas&&a._maqDeltas[g]&&a._dvWidget&&a._dvWidget._srcElement&&(this._preservedNodesId.push(a.id),this._preservedNodesXpath.push(e.getXPath(a._dvWidget._srcElement,b)),this._preservedStateValues.push(m.clone(a._maqDeltas[g])))},_restoreState:function(a){var b=this._params.context;if(b&&this._preservedNodesId){var e=b.getDocument();if(e)for(var f=0;f<this._preservedNodesId.length;f++){var d=this._preservedNodesXpath[f],c=e.getElementById(this._preservedNodesId[f]);c||(d=b.model.evaluate(d))&&
(c=e.getElementById(d.getAttribute("id")));c&&(c._maqDeltas||(c._maqDeltas={}),c._maqDeltas[a]=m.clone(this._preservedStateValues[f]),k._updateSrcState(c))}}},_traverseRenameState:function(a,b){var e=this._getStateContainerNode();if(e&&(k.rename(e,{oldName:a,newName:b}),e=e._dvWidget&&e._dvWidget._srcElement)){var f=null,d=!1,c=/^(.*davinci.states.setState\s*\(\s*)('[^']*'|"[^"]*")([^\)]*\).*)$/,h=/^(['"])(.*)(['"])$/;e.visit({visit:dojo.hitch(this,function(k){if("HTMLElement"==k.elementType)f=k;
else if("HTMLAttribute"==k.elementType){var e=k.name;if(e&&"on"==e.substr(0,2).toLowerCase()&&(k=k.value.match(c))){var n=k[2].match(h);n&&n[2]==a&&(f.setAttribute(e,k[1]+n[1]+b+n[3]+k[3]),d=!0)}}})});d&&(e=this._params&&this._params.context&&this._params.context.editor)&&e._visualChanged()}}})})},"davinci/html/HtmlFileXPathAdapter":function(){define(function(){function p(m){this.elem=m}p.prototype={name:function(){return this.elem.tag},parent:function(){var m=this.elem.parent;if("HTMLFile"!==m.elementType)return new p(m)},
index:function(){var m=this.elem.tag,h=this.elem.parent.children,e=0;if(1===h.length)return 0;h=h.filter(function(b){return b.tag===m});1<h.length&&h.some(function(b,k){if(b===this.elem)return e=k+1,!0},this);return e}};return p})},"davinci/ve/views/SwitchingStyleView":function(){define("dojo/_base/declare dojo/i18n!davinci/ve/nls/ve dojo/i18n!dijit/nls/common dijit/layout/TabContainer xide/utils dijit/layout/ContentPane davinci/Runtime davinci/workbench/WidgetLite davinci/ve/widgets/HTMLStringUtil davinci/ve/widgets/WidgetToolBar davinci/ve/widgets/Cascade davinci/ve/widgets/CommonProperties davinci/ve/widgets/WidgetProperties davinci/ve/widgets/EventSelection".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u){return p("davinci.ve.views.SwitchingStyleView",[g],{_editor:null,_widget:null,_subWidget:null,_titleBarDiv:"\x3cdiv class\x3d'palette_titleBarDiv'\x3e\x3cspan class\x3d'paletteCloseBox'\x3e\x3c/span\x3e\x3cspan class\x3d'titleBarDivTitle'\x3e\x3c/span\x3e\x3c/div\x3e",constructor:function(a,c){},pageTemplate:[{key:"widgetSpecific",className:"maqPropertySection page_editor_only",addCommonPropertiesAtTop:!1,html:"\x3cdiv dojoType\x3d'davinci.ve.widgets.WidgetProperties'\x3e\x3c/div\x3e"},
{key:"events",className:"maqPropertySection page_editor_only",addCommonPropertiesAtTop:!1,pageTemplate:{html:"\x3cdiv dojoType\x3d'davinci.ve.widgets.EventSelection'\x3e\x3c/div\x3e"}},{key:"layout",className:"maqPropertySection",addCommonPropertiesAtTop:!0,pageTemplate:[{display:"width",type:"multi",target:["width"],values:["","auto","100%","200px","10em"]},{display:"height",type:"multi",target:["height"],values:["","auto","100%","200px","10em"]},{html:"\x26nbsp;"},{key:"showMinMax",display:"\x26nbsp;\x26nbsp;\x26nbsp;",
type:"toggleSection",pageTemplate:[{display:"min-height",type:"multi",target:["min-height"],rowClass:"propertiesSectionHidden"},{display:"max-height",type:"multi",target:["max-height"],rowClass:"propertiesSectionHidden"},{display:"min-width",type:"multi",target:["min-width"],rowClass:"propertiesSectionHidden"},{display:"max-width",type:"multi",target:["max-width"],rowClass:"propertiesSectionHidden"},{html:"\x26nbsp;",rowClass:"propertiesSectionHidden"}]},{display:"position",type:"combo",target:["position"],
values:["","absolute","fixed","relative","static"]},{display:"left",type:"multi",target:["left"],values:["","0px","1em"]},{display:"top",type:"multi",target:["top"],values:["","0px","1em"]},{display:"right",type:"multi",target:["right"],values:["","0px","1em"]},{display:"bottom",type:"multi",target:["bottom"],values:["","0px","1em"]},{display:"display",type:"combo",target:["display"],values:["","none","block","inline","inline-block"]},{display:"opacity",type:"multi",target:["opacity"],values:["0",
"0.5","1.0"]},{display:"box-shadow",type:"text",target:["box-shadow"],value:["","none","1px 1px rgba(0,0,0,.5)"]},{display:"float",type:"combo",target:["float"],values:["","none","left","right"]},{display:"clear",type:"combo",target:["clear"],values:["","none","left","right","both"]},{display:"overflow",type:"combo",target:["overflow"],values:["","visible","hidden","scroll","auto"]},{display:"z-index",type:"multi",target:["z-index"],values:" auto 0 1 100 -1 -100".split(" ")},{display:"box-sizing",
type:"combo",target:["box-sizing","-webkit-box-sizing","-ms-box-sizing","-moz-box-sizing"],values:["","content-box","border-box"]}]},{key:"padding",className:"maqPropertySection",addCommonPropertiesAtTop:!0,pageTemplate:[{display:"\x3cb\x3e(padding)\x3c/b\x3e",type:"multi",target:["padding"],values:["","0px","1em"]},{key:"showtrbl",display:"\x26nbsp;\x26nbsp;\x26nbsp;",type:"toggleSection",pageTemplate:[{display:"padding-top",type:"multi",target:["padding-top"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"},
{display:"padding-right",type:"multi",target:["padding-right"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"},{display:"padding-bottom",type:"multi",target:["padding-bottom"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"},{display:"padding-left",type:"multi",target:["padding-left"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"}]}]},{key:"margins",className:"maqPropertySection",addCommonPropertiesAtTop:!0,pageTemplate:[{display:"\x3cb\x3e(margin)\x3c/b\x3e",type:"multi",
target:["margin"],values:["","0px","1em"]},{key:"showtrbl",display:"\x26nbsp;\x26nbsp;\x26nbsp;",type:"toggleSection",pageTemplate:[{display:"margin-top",type:"multi",target:["margin-top"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"},{display:"margin-right",type:"multi",target:["margin-right"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"},{display:"margin-bottom",type:"multi",target:["margin-bottom"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"},{display:"margin-left",
type:"multi",target:["margin-left"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"}]}]},{key:"background",className:"maqPropertySection",addCommonPropertiesAtTop:!0,pageTemplate:[{display:"background-color",type:"background",target:["background-color"],colorswatch:!0},{display:"background-image",type:"background",target:["background-image"],values:["","none"]},{display:"background-repeat",type:"background",values:["","repeat","repeat-x","repeat-y","no-repeat"],target:["background-repeat"]},
{display:"background-position",type:"background",target:["background-position"],values:";0px 0px;0% 0%;left top;center center;right bottom".split(";")},{display:"background-size",type:"background",target:["background-size"],values:["","auto","contain","cover","100%"]},{display:"background-origin",type:"background",target:["background-origin"],values:["","border-box","padding-box","content-box"]},{display:"background-clip",type:"background",target:["background-clip"],values:["","border-box","padding-box",
"content-box"]}]},{key:"border",className:"maqPropertySection",addCommonPropertiesAtTop:!0,pageTemplate:[{display:"\x3cb\x3e(border)\x3c/b\x3e",type:"multi",target:["border"],values:["","none","1px solid black"]},{display:"show",type:"combo",values:["none","props","sides","all"],id:"properties_show_select",onchange:function(a){if("number"==typeof a){var c=function(a,c,b,d,f){for(;c<=b;c++){var g=dojo.byId(a[c].rowId);c>=d&&c<=f?dojo.removeClass(g,"propertiesSectionHidden"):dojo.addClass(g,"propertiesSectionHidden")}};
if(this.pageTemplate){a=this.pageTemplate[a];var b;a&&a.id&&(a=dojo.byId(a.id))&&(b=a.value);dojo.isString(b)&&("none"===b?c(this.pageTemplate,2,20,-1,-1):"sides"===b?c(this.pageTemplate,2,20,2,5):"props"===b?c(this.pageTemplate,2,20,6,8):"all"===b&&c(this.pageTemplate,2,20,9,20))}}}},{display:"border-top",type:"multi",target:["border-top"],values:["","none","1px solid black"],rowClass:"propertiesSectionHidden"},{display:"border-right",type:"multi",target:["border-right"],values:["","none","1px solid black"],
rowClass:"propertiesSectionHidden"},{display:"border-bottom",type:"multi",target:["border-bottom"],values:["","none","1px solid black"],rowClass:"propertiesSectionHidden"},{display:"border-left",type:"multi",target:["border-left"],values:["","none","1px solid black"],rowClass:"propertiesSectionHidden"},{display:"border-width",type:"multi",target:["border-width"],values:["","1px","1em"],rowClass:"propertiesSectionHidden"},{display:"border-style",type:"multi",target:["border-style"],values:["","none",
"solid","dotted","dashed"],rowClass:"propertiesSectionHidden"},{display:"border-color",type:"color",target:["border-color"],rowClass:"propertiesSectionHidden"},{display:"border-top-width",type:"multi",target:["border-top-width"],values:["","1px","1em"],rowClass:"propertiesSectionHidden"},{display:"border-top-style",type:"multi",target:["border-top-style"],values:["","none","solid","dotted","dashed"],rowClass:"propertiesSectionHidden"},{display:"border-top-color",type:"color",target:["border-top-color"],
rowClass:"propertiesSectionHidden"},{display:"border-right-width",type:"multi",target:["border-right-width"],values:["","1px","1em"],rowClass:"propertiesSectionHidden"},{display:"border-right-style",type:"multi",target:["border-right-style"],values:["","none","solid","dotted","dashed"],rowClass:"propertiesSectionHidden"},{display:"border-right-color",type:"color",target:["border-right-color"],rowClass:"propertiesSectionHidden"},{display:"border-bottom-width",type:"multi",target:["border-bottom-width"],
values:["","1px","1em"],rowClass:"propertiesSectionHidden"},{display:"border-bottom-style",type:"multi",target:["border-bottom-style"],values:["","none","solid","dotted","dashed"],rowClass:"propertiesSectionHidden"},{display:"border-bottom-color",type:"color",target:["border-bottom-color"],rowClass:"propertiesSectionHidden"},{display:"border-left-width",type:"multi",target:["border-left-width"],values:["","1px","1em"],rowClass:"propertiesSectionHidden"},{display:"border-left-style",type:"multi",target:["border-left-style"],
values:["","none","solid","dotted","dashed"],rowClass:"propertiesSectionHidden"},{display:"border-left-color",type:"color",target:["border-left-color"],rowClass:"propertiesSectionHidden"},{display:"border-collapse",type:"combo",target:["border-collapse"],values:["","separate","collapse"]},{display:"\x3cb\x3e(border-radius)\x3c/b\x3e",type:"multi",target:["border-radius","-moz-border-radius"],values:["","0px","6px"]},{key:"showDetails",display:"",type:"toggleSection",pageTemplate:[{display:"border-top-left-radius",
type:"multi",target:["border-top-left-radius","-moz-border-radius-topleft"],values:["","0px","6px"],rowClass:"propertiesSectionHidden"},{display:"border-top-right-radius",type:"multi",target:["border-top-right-radius","-moz-border-radius-topright"],values:["","0px","6px"],rowClass:"propertiesSectionHidden"},{display:"border-bottom-right-radius",type:"multi",target:["border-bottom-right-radius","-moz-border-radius-bottomright"],values:["","0px","6px"],rowClass:"propertiesSectionHidden"},{display:"border-bottom-left-radius",
type:"multi",target:["border-bottom-left-radius","-moz-border-radius-bottomleft"],values:["","0px","6px"],rowClass:"propertiesSectionHidden"}]}]},{key:"fontsAndText",className:"maqPropertySection",addCommonPropertiesAtTop:!0,pageTemplate:[{display:"font",type:"text",target:["font"]},{display:"font-family",type:"font",target:["font-family"]},{display:"size",type:"multi",target:["font-size"],values:["","100%","1em","10px","10pt"]},{display:"color",type:"color",target:["color"]},{display:"font-weight",
type:"combo",target:["font-weight"],values:["","normal","bold"]},{display:"font-style",type:"combo",target:["font-style"],values:["","normal","italic"]},{display:"text-decoration",type:"combo",target:["text-decoration"],values:["","none","underline","line-through"]},{display:"text-align",type:"combo",target:["text-align"],values:["","left","center","right","justify"]},{display:"vertical-align",type:"combo",target:["vertical-align"],values:["","baseline","top","middle","bottom"]},{display:"white-space",
type:"combo",target:["white-space"],values:" normal nowrap pre pre-line pre-wrap".split(" ")},{display:"text-indent",type:"multi",target:["text-indent"],values:["","0","1em","10px"]},{display:"line-height",type:"multi",target:["line-height"],values:["","normal","1.2","120%"]}]}],buildRendering:function(){this.domNode=dojo.doc.createElement("div");dojo.addClass(this.domNode,"propertiesContent");var a;a=""+this._titleBarDiv;a+="\x3cdiv class\x3d'propertiesToolBar' dojoType\x3d'davinci.ve.widgets.WidgetToolBar'\x3e\x3c/div\x3e\x3cdiv dojoType\x3d'davinci.ve.widgets.WidgetProperties'\x3e\x3c/div\x3e";
a+="\x3cdiv class\x3d'propScrollableArea'\x3e";a+="\x3ctable class\x3d'propRootDetailsContainer'\x3e";a+="\x3ctr\x3e";a+="\x3ctd class\x3d'propPaletteRoot'\x3e";for(var c=0;c<this.pageTemplate.length;c++)if(this.pageTemplate[c].title=m[this.pageTemplate[c].key]?m[this.pageTemplate[c].key]:"Key not found",this.pageTemplate[c].pageTemplate)for(var b=0;b<this.pageTemplate[c].pageTemplate.length;b++)this.pageTemplate[c].pageTemplate[b].key&&(this.pageTemplate[c].pageTemplate[b].display+=m[this.pageTemplate[c].pageTemplate[b].key]?
m[this.pageTemplate[c].pageTemplate[b].key]:"Key not found");this.domNode.innerHTML=a;this.inherited(arguments)},_widgetValuesChanged:function(a){var c=this._currentPropSection;if(c){for(var b=!1,d=0;d<this.pageTemplate.length;d++)if(this.pageTemplate[d].key==c){b=!0;break}if(b)for(c=this._getVisibleCascade(d),b=0;b<c.length;b++)c[b]._widgetValuesChanged(a)}},_getVisibleCascade:function(a){if(a)return this.pageTemplate[a].cascade;a=[];var c=this._currentPropSection;if(c)for(var b=0;b<this.pageTemplate.length;b++)if(this.pageTemplate[b].key==
c){a=a.concat(this.pageTemplate[b].cascade);break}return a},_updatePaletteValues:function(a){if(this._editor){var c=a[0];this._subwidget=(this._widget=c)&&c.subwidget;this.setReadOnly(!(this._widget||this._subwidget));for(var c=this._getVisibleCascade(),b=0;b<c.length;b++)c[b]._widgetSelectionChanged(a)}},_widgetSelectionChanged:function(a){!0!==a.isFake&&this._updatePaletteValues(a.selection)},_stateChanged:function(){this._updatePaletteValues(this._widget?[this._widget]:[])},_widgetPropertiesChanged:function(a){this._widget&&
this._widget.type!==a[0].type||this._updatePaletteValues(a)},_titlePaneOpen:function(a){a=this._getVisibleCascade(a);for(var c=0;c<a.length;c++)a[c]._editorSelected({editor:this._editor})},startup:function(){this.domNode.style.height="100%";this._editor=a.currentEditor;this.inherited(arguments);for(var c=0;c<this.pageTemplate.length;c++){var b=this.pageTemplate[c];if(b.pageTemplate)for(var d=0;d<b.pageTemplate.length;d++){var f=b.pageTemplate[d];f.onchange&&f.id&&dojo.connect(dojo.byId(f.id),"onchange",
dojo.hitch(b,f.onchange,d))}}for(c=0;c<this.pageTemplate.length;c++)this.pageTemplate[c].cascade=[];try{this.setReadOnly(!0)}catch(g){logError(g,"set read only crashed ! "+g)}this.onEditorSelected();this.subscribe("/davinci/ui/widgetValuesChanged",dojo.hitch(this,this._widgetValuesChanged));this.subscribe("/davinci/ui/widgetPropertiesChanged",dojo.hitch(this,this._widgetPropertiesChanged));this.subscribe("/davinci/ui/editorSelected",dojo.hitch(this,this._editorSelected));this.subscribe("/davinci/ui/widgetSelected",
dojo.hitch(this,this._widgetSelectionChanged));this.subscribe("/davinci/states/state/changed",dojo.hitch(this,this._stateChanged));this.subscribe("/maqetta/appstates/state/changed",dojo.hitch(this,this._stateChanged));this.subscribe("/davinci/ui/initialPerspectiveReady",dojo.hitch(this,this._initialPerspectiveReady));this.subscribe("/davinci/workbench/ready",dojo.hitch(this,this._workbenchReady))},setReadOnly:function(a){for(var c=0;c<this.pageTemplate.length;c++){var b=this.pageTemplate[c].pageTemplate;
if(b)for(var d=0;d<b.length;d++){var f=b[d].widget;f?f.set("readOnly",a):(f=b[d].domNode)&&dojo.attr(f,"disabled",a)}}},_modelEntryById:function(a){for(var c=0;c<this.pageTemplate.length;c++){var b=this.pageTemplate[c].pageTemplate;if(b)for(var d=0;d<b.length;d++)if(a==b[d].id)return b[d]}},_editorSelected:function(a){this._editor=a.editor;this.onEditorSelected(this._editor);a=this.tabContainer;this.getParent();var c=a.selectedChildWidget||a.getSelected(),b=!1,d=dojo.query(".maqPropertySection",a.domNode);
this._editor?"davinci.ve.PageEditor"!=this._editor.declaredClass&&"davinci.ve.themeEditor.ThemeEditor"!=this._editor.declaredClass?d.forEach(function(a){dijit.byNode(a)==c&&(b=!0)}):(d.forEach(function(a){dijit.byNode(a)}),"davinci.ve.themeEditor.ThemeEditor"==this._editor.declaredClass&&dojo.query(".page_editor_only",a.domNode).forEach(function(a){dijit.byNode(a)==c&&(b=!0)})):(d.forEach(function(a){dijit.byNode(a)}),b=!0);b&&this._selectFirstVisibleTab()},onEditorSelected:function(){this._subWidget=
this._widget=null;if(this._oldClassName)if(this.domNode)dojo.removeClass(this.domNode.parentNode.parentNode,this._oldClassName);else{console.error("have no dom node ! : "+this.id);return}if(this._editor)if(this._editor&&this._editor.editorID&&(this._oldClassName=this._editor.editorID.replace(/\./g,"_"),this.domNode?dojo.addClass(this.domNode.parentNode.parentNode,this._oldClassName):console.error("have no dom node !")),this.domNode){for(var a=this._currentPropSection,c=dojo.query(".propSectionButton",
this.domNode),b=0;b<c.length;b++){var d=c[b];this._editor&&this._editor.supports&&this._editor.supports("propsect_"+this.pageTemplate[b].key)?dojo.removeClass(d,"dijitHidden"):(dojo.addClass(d,"dijitHidden"),a==this.pageTemplate[b].key&&n.showRoot())}a=[];for(b=0;b<this.pageTemplate.length;b++)(c=this.pageTemplate[b].cascade)&&(a=a.concat(c));for(b=0;b<a.length;b++)c=a[b],c._editorSelected&&c._editorSelected({editor:this._editor})}else console.error("have no dom node !")},destroy:function(){this.inherited(arguments)},
_destroyContent:function(){var a=this.containerNode||this.domNode;for(dojo.forEach(dojo.query("[widgetId]",a).map(dijit.byNode),function(a){a.destroy()});a.firstChild;)dojo._destroyElement(a.firstChild);dojo.forEach(this._tooltips,function(a){a.destroy()});this._tooltips=void 0;this._destroyHandles()},sectionTitleFromKey:function(a){for(var c=0;c<this.pageTemplate.length;c++)if(this.pageTemplate[c].key==a)return this.pageTemplate[c].title},_initialPerspectiveReady:function(){var a=null;if(!this._alreadySplitIntoMultipleTabs){var c=
this.tabContainer;dojo.addClass(c.domNode,"propRootDetailsContainer");dojo.addClass(c.domNode,"propertiesContent");for(var d=0;d<this.pageTemplate.length;d++){var a=this.pageTemplate[d].key,f=this.pageTemplate[d].title,g=this.pageTemplate[d].className;g||(g="");var e=this._titleBarDiv,e=e+"\x3cdiv class\x3d'propertiesToolBar' dojoType\x3d'davinci.ve.widgets.WidgetToolBar'\x3e\x3c/div\x3e",e=e+("\x3cdiv class\x3d'cascadeBackButtonDiv'\x3e\x3cbutton class\x3d'btn-info' onclick\x3d'davinci.ve.widgets.HTMLStringUtil.showSection(\""+
a+'","'+f+"\")'\x3e"+f+" "+m.properties+"\x3c/button\x3e\x3c/div\x3e"),a=n.generateTemplate(this.pageTemplate[d]),a=e+a;0==d?(a=this,a.set("title",f),dojo.addClass(a.domNode,g)):(e=c.createTab(f,null,null,null,{"class":g,delegate:this}),a=b.addWidget(k,{title:f,content:a,"class":g,delegate:this},null,e,!1),e.cp=a,e._maqPropGroup=this.pageTemplate[d].key,e.add(a,null,!1));a._maqPropGroup=this.pageTemplate[d].key;f=dojo.query(".paletteCloseBox",a.domNode);0<f.length&&dojo.connect(f[0],"click",this,
function(a){davinci.Workbench.collapsePaletteContainer(a.currentTarget)})}for(f=0;f<this.pageTemplate.length;f++)if(this.pageTemplate[f].cascade=[],g=this.pageTemplate[f].pageTemplate){for(d=0;d<g.length;d++)e=g[d].id,(a=dijit.byId(e))?g[d].widget=a:(a=dojo.byId(e))&&(g[d].domNode=a);dojo.query("#"+this.pageTemplate[f].id+" .CascadeTop").forEach(function(a){return function(c){c=dijit.byId(c.id);a.cascade.push(c)}}(this.pageTemplate[f]))}c._on("selectChild",function(a){a._maqPropGroup&&(this._currentPropSection=
a._maqPropGroup,a=(a=this._editor&&this._editor.getContext?this._editor.getContext():null)&&a.getSelection?a.getSelection():[],this._updatePaletteValues(a),n._initSection(this._currentPropSection))}.bind(this));this._alreadySplitIntoMultipleTabs=!0}},_initialPerspectiveReadyO:function(){if(!this._alreadySplitIntoMultipleTabs){var a=this.getParent();dojo.addClass(a.domNode,"propRootDetailsContainer");dojo.addClass(a.domNode,"propertiesContent");for(var c=0;c<this.pageTemplate.length;c++){var b=this.pageTemplate[c].key,
d=this.pageTemplate[c].title,f=this.pageTemplate[c].className;f||(f="");var g=this._titleBarDiv,g=g+"\x3cdiv class\x3d'propertiesToolBar' dojoType\x3d'davinci.ve.widgets.WidgetToolBar'\x3e\x3c/div\x3e",g=g+("\x3cdiv class\x3d'cascadeBackButtonDiv'\x3e\x3cbutton onclick\x3d'davinci.ve.widgets.HTMLStringUtil.showSection(\""+b+'","'+d+"\")'\x3e"+d+" "+m.properties+"\x3c/button\x3e\x3c/div\x3e"),b=n.generateTemplate(this.pageTemplate[c]),g=g+b;0==c?(g=this,g.set("title",d),dojo.addClass(g.domNode,f)):
(g=new k({title:d,content:g,"class":f}),a.addChild(g));g._maqPropGroup=this.pageTemplate[c].key;d=dojo.query(".paletteCloseBox",g.domNode);0<d.length&&dojo.connect(d[0],"click",this,function(a){davinci.Workbench.collapsePaletteContainer(a.currentTarget)})}for(d=0;d<this.pageTemplate.length;d++)if(this.pageTemplate[d].cascade=[],f=this.pageTemplate[d].pageTemplate){for(c=0;c<f.length;c++)g=f[c].id,(b=dijit.byId(g))?f[c].widget=b:(b=dojo.byId(g))&&(f[c].domNode=b);dojo.query("#"+this.pageTemplate[d].id+
" .CascadeTop").forEach(function(a){return function(c){c=dijit.byId(c.id);a.cascade.push(c)}}(this.pageTemplate[d]))}a._on("selectChild",function(a){"none"!=a.controlButton.domNode.style.display||this._recursiveSelectChildInProcess?a._maqPropGroup&&(this._currentPropSection=a._maqPropGroup,a=(a=this._editor&&this._editor.getContext?this._editor.getContext():null)&&a.getSelection?a.getSelection():[],this._updatePaletteValues(a),n._initSection(this._currentPropSection)):(this._recursiveSelectChildInProcess=
!0,this._selectFirstVisibleTab(),delete this._recursiveSelectChildInProcess)}.bind(this));this._alreadySplitIntoMultipleTabs=!0}},_workbenchReady:function(){this._updateToolBars()},_updateToolBars:function(){dojo.query(".propertiesToolBar").forEach(function(a){this._editor&&"davinci.ve.PageEditor"==this._editor.declaredClass?(dojo.removeClass(a,"dijitHidden"),a.style.display=""):dojo.addClass(a,"dijitHidden")}.bind(this))},_selectFirstVisibleTab:function(){var a=this.getParent();if(a&&a.getChildren)for(var c=
a.getChildren(),b=0;b<c.length;b++){var d=c[b];if("none"!=d.controlButton.domNode.style.display){a._maqDontExpandCollapse=!0;a.selectChild(d);delete a._maqDontExpandCollapse;break}}}})})},"davinci/workbench/WidgetLite":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/parser","xide/mixins/EventedMixin"],function(p,m,h,e){return p("davinci.workbench.WidgetLite",[m,e],{buildRendering:function(){this.inherited(arguments);/dojotype/i.test(this.domNode.innerHTML||"")&&(this._startupWidgets=
dojo.parser.parse(this.domNode,{noStart:!this._earlyTemplatedStartup,inherited:{dir:this.dir,lang:this.lang}}))},_destroyContent:function(){var b=this.containerNode||this.domNode;for(dojo.forEach(dojo.query("[widgetId]",b).map(dijit.byNode),function(b){b.destroy()});b.firstChild;)dojo._destroyElement(b.firstChild);dojo.forEach(this._tooltips,function(b){b.destroy()});delete this._tooltips;this._destroyHandles()},startup:function(){dojo.forEach(this._startupWidgets,function(b){b&&!b._started&&b.startup&&
b.startup()});this.inherited(arguments)}})})},"davinci/ve/widgets/HTMLStringUtil":function(){define("davinci/Runtime ./FontDataStore ./FontComboBox ./MultiInputDropDown dijit/form/ComboBox dijit/form/DateTextBox dijit/form/TimeTextBox ./MetaDataStore ./ColorPicker ./Background".split(" "),function(p,m){var h=dojo.getObject("davinci.ve.widgets.HTMLStringUtil",!0);dojo.mixin(h,{__id:0,idPrefix:"davinci_ve_widgets_properties_generated",_currentPropSection:null,animSS:null,animRuleIndex:{},getCurrentPropSection:function(){return this._currentPropSection},
getId:function(){return this.idPrefix+this.__id++},injectId:function(e,b){var k=e.indexOf("\x3e");return k?e.substring(0,k)+" id\x3d'"+b+"'"+e.substring(k,e.length):"\x3cspan id\x3d'"+b+"'\x3e"+e+"\x3c/span\x3e"},getEditor:function(e){function b(a){var b={};b.value="undefined"!=typeof a.value&&null!==a.value?a.value:a;b.title=a.title||b.value;return b}var k=e.type,a=this.getId();e.id=a;var g=e.disabled?" disabled\x3d'true' ":"";switch(k){case "multi":return k="",e.values&&(k="data\x3d'"+dojo.toJson(dojo.map(e.values,
function(a){return{value:a}}))+"'"),"\x3cdiv dojoType\x3d'davinci.ve.widgets.MultiInputDropDown' "+k+"  class\x3d'propertyPaneEditablevalue' style\x3d'display:inline-block; width:100%;' id\x3d'"+a+"'"+g+"\x3e\x3c/div\x3e";case "boolean":return"\x3cinput type\x3d'checkbox' class\x3d'propertyPaneEditablevalue' style\x3d'display:inline-block;margin-left:5px' id\x3d'"+a+"'\x3e\x3c/input\x3e";case "comboEdit":e=e.values;a="\x3cselect dojoType\x3d'dijit.form.ComboBox' autoComplete\x3d'false' style\x3d'display:inline-block; width:100%;' id\x3d'"+
a+"'"+g+"\x3e";for(g=0;g<e.length;g++)k=b(e[g]),a+="\x3coption class\x3d'option' value\x3d'"+k.value+"'\x3e"+k.title+"\x3c/option\x3e";return a+="\x3c/select\x3e";case "combo":e=e.values;a="\x3cselect class\x3d'form-control input-transparent' style\x3d'display:inline-block; width:100%;' id\x3d'"+a+"'"+g+"\x3e";for(g=0;g<e.length;g++)k=b(e[g]),a+="\x3coption class\x3d'option' value\x3d'"+k.value+"'\x3e"+k.title+"\x3c/option\x3e";return a+="\x3c/select\x3e";case "font":return a="\x3cdiv dojoType\x3d'davinci.ve.widgets.FontDataStore' jsId\x3d'"+
a+"_fontStore'\x3e"+("\x3cdiv dojoType\x3d'davinci.ve.widgets.FontComboBox' value\x3d'"+m.fonts[0].value+"' store\x3d'"+a+"_fontStore'  id\x3d'"+a+"' class\x3d'propertyPaneEditablevalue' style\x3d'display:inline-block; width:100%;'\x3e\x3c/div\x3e");case "state":return a="\x3cdiv dojoType\x3d'davinci.ve.widgets.MetaDataStore' jsId\x3d'davinci.properties.event"+a+"_Store'\x3e"+("\x3cdiv dojoType\x3d'dijit.form.ComboBox' id\x3d'"+a+"'store\x3d'davinci.properties.event"+a+"_Store' class\x3d'propertyPaneEditablevalue' style\x3d'display:inline-block; width:100%;' autoComplete\x3d'false'\x3e\x3c/div\x3e");
case "color":return"\x3cdiv class\x3d'propertyPaneEditablevalue' dojoType\x3d'davinci.ve.widgets.ColorPicker' id\x3d'"+a+"' \x3e\x3c/div\x3e";case "background":return k=dojo.isArray(e.values)?" data\x3d'"+dojo.toJson(e.values)+"'":"",g=" propname\x3d'"+(dojo.isArray(e.target)?e.target[0]:e.target)+"'",a="\x3cdiv dojoType\x3d'davinci.ve.widgets.Background' id\x3d'"+a+"'"+k+g+(e.colorswatch?" colorswatch\x3d'true'":"")+"\x3e\x3c/div\x3e";case "border":case "number":case "object":case "text":case "array":case "widgetState":case "string":if("date"==
e.format)return"\x3cdiv class\x3d'propertyPaneEditablevalue' dojoType\x3d'dijit.form.DateTextBox' id\x3d'"+a+"'\x3e\x3c/input\x3e";if("time"==e.format)return"\x3cdiv class\x3d'propertyPaneEditablevalue' dojoType\x3d'dijit.form.TimeTextBox' id\x3d'"+a+"'\x3e\x3c/input\x3e";default:return a=e.data&&!0===e.data.readonly?"\x3cinput readonly type\x3d'text' class\x3d'form-control input-transparent propertyPaneEditablevalue' style\x3d'display:inline-block; width:100%;' id\x3d'"+a+"'\x3e\x3c/input\x3e":"\x3cinput type\x3d'text' class\x3d'form-control input-transparent propertyPaneEditablevalue' style\x3d'display:inline-block; width:100%;' id\x3d'"+
a+"'\x3e\x3c/input\x3e"}},generateTable:function(e,b){var k=b?b.rowsOnly:!1,a=b&&b.zeroSpaceForIncrDecr?"0px":"20px",g="";if(e.html)return e.id=this.getId(),this.injectId(e.html,e.id);var h;h="\x3ctable class\x3d'property_table_stretchable' border\x3d'0' width\x3d'100%' align\x3d'center' cellspacing\x3d'0' cellpadding\x3d'0'\x3e\x3ccolgroup\x3e\x3ccol style\x3d'width:6px;' /\x3e";h+="\x3ccol class\x3d'gap02' /\x3e";h+="\x3ccol class\x3d'gap03' /\x3e";h+="\x3ccol style\x3d'width:"+a+";' /\x3e";h+=
"\x3ccol style\x3d'width:6px;' /\x3e";h+="\x3c/colgroup\x3e";k||(g+=h);for(a=0;a<e.length;a++)if(e[a].widgetHtml)e[a].id=this.getId(),e[a].rowId=this.getId(),g+="\x3ctr id\x3d'"+e[a].rowId+"'",e[a].rowClass&&(g+=" class\x3d'"+e[a].rowClass+"'"),g+="\x3e",g+="\x3ctd colspan\x3d'5' width\x3d'100%'\x3e",g+=this.injectId(e[a].widgetHtml,e[a].id),g+="\x3c/td\x3e",g+="\x3c/tr\x3e";else if(e[a].html)e[a].id=this.getId(),e[a].rowId=this.getId(),g+="\x3ctr id\x3d'"+e[a].rowId+"'",g+=" class\x3d'cssPropertySection",
e[a].rowClass&&(g+=" "+e[a].rowClass),g+="'\x3e",g+="\x3ctd colspan\x3d'5' width\x3d'100%'\x3e",g+=e[a].html,g+="\x3c/td\x3e",g+="\x3c/tr\x3e";else if("toggleSection"==e[a].type){for(var g=g+("\x3ctr id\x3d'"+e[a].id+"'  class\x3d'cssPropertySection'\x3e\x3ctd colspan\x3d'5'\x3e"),f="",d=this.generateTable(e[a].pageTemplate,{rowsOnly:!0}),c=0;c<e[a].pageTemplate.length;c++)e[a].pageTemplate[c].rowId&&(f+="dojo.toggleClass('"+e[a].pageTemplate[c].rowId+"','propertiesSectionHidden');"),e[a].pageTemplate[c].cascadeSectionRowId&&
(f+="if(this.checked){dojo.removeClass('"+e[a].pageTemplate[c].cascadeSectionRowId+"','propertiesSectionHidden');}else{{dojo.addClass('"+e[a].pageTemplate[c].cascadeSectionRowId+"','propertiesSectionHidden');}}");g+="\x3cinput type\x3d'checkbox' onclick\x3d\""+f+'"\x3e\x3c/input\x3e';g+=e[a].display;g+="\x3c/td\x3e\x3c/tr\x3e";g+=d}else e[a].display?(e[a].toggleCascade=this.getId(),e[a].cascadeSection=this.getId(),e[a].rowId=this.getId(),e[a].cascadeSectionRowId=this.getId(),g+="\x3ctr id\x3d'"+e[a].rowId+
"'",g+=" class\x3d'cssPropertySection",e[a].rowClass&&(g+=" "+e[a].rowClass),g+="'",g+=" propName\x3d'"+e[a].display+"'",g+="\x3e",g+="\x3ctd/\x3e",g+="\x3ctd class\x3d'propertyDisplayName'\x3e"+e[a].display+":\x26nbsp;\x3c/td\x3e",g+="\x3ctd class\x3d'propertyInputField propertyInputField"+e[a].type+"' \x3e"+this.getEditor(e[a])+"\x3c/td\x3e",g+="\x3ctd class\x3d'propertyExtra' nowrap\x3d'true'\x3e",g+="\x3ctd class\x3d'propertyExtra2' nowrap\x3d'true'\x3e",e[a].target&&!e[a].hideCascade&&(g+="\x3cdiv width\x3d'100%'\x3e\x3cbutton class\x3d'showCss propertyButton' id\x3d'"+
e[a].toggleCascade+"'",g+=' onClick\x3d"davinci.ve.widgets.HTMLStringUtil.showProperty(',g+="'"+e[a].rowId+"'",g+=')"\x3e\x26gt;\x3c/button\x3e',g+="\x3c/div\x3e"),g+="\x3ctd/\x3e",g+="\x3c/tr\x3e",e[a].target&&!e[a].hideCascade&&(f="{'cascadeSectionRowId':\""+e[a].cascadeSectionRowId+"\",'toggleCascade':\""+e[a].toggleCascade+'"}',g+="\x3ctr id\x3d'"+e[a].cascadeSectionRowId+"' class\x3d'cssCascadeSection cascadeRowHidden'\x3e",g+="\x3ctd colspan\x3d'5' width\x3d'100%' class\x3d'showCascadeDiv'\x3e\x3cdiv dojoType\x3d'davinci.ve.widgets.Cascade' toggleClasses\x3d"+
f+" target\x3d'"+dojo.toJson(e[a].target)+"' targetField\x3d'\""+e[a].id+"\"' id\x3d'"+e[a].cascadeSection+"'\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e")):(g+="\x3c/table\x3e",g+=this.getEditor(e[a]),g+=h);k||(g+="\x3c/table\x3e");return g},generateTemplate:function(e){var b="";e.pageTemplate?(e.key&&(e.id=this.getId(),b="\x3cdiv class\x3d'propGroup' id\x3d'"+e.id+"' propGroup\x3d'"+e.key+"'\x3e"),b+=this.generateTable(e.pageTemplate),b+="\x3c/div\x3e"):e.html?b+=e.html:e.widgetHtml&&(e.id=this.getId(),
b+=this.injectId(e.widgetHtml,e.id));return b},stylesheetHref:"propview.css",animShowSectionClass:"propRootDetailsContainer",animShowSectionClassSelector:".propRootDetailsContainer",animShowDetailsClass:"property_table_stretchable",animShowDetailsClassSelector:".property_table_stretchable",showPropAnimClasses:["propRowFadeIn","propRowFadeOut","propRowTransparent","propRowOpaque","propRowHidden"],showRoot:function(){this._hideSectionShowRoot();this._currentPropSection=null;return!1},showSection:function(e,
b){this._initSection(e);return!1},showProperty:function(e){function b(c){dojo.disconnect(z);dojo.disconnect(y);k();var b=g._findRule(g.animShowDetailsClassSelector);b?(c=b.ss,b=b.ruleIndex,c.deleteRule(b),c.insertRule(g.animShowDetailsClassSelector+" { margin-top:0px; }",b),a()):console.error("HTMLStringUtil showProperty: transEnd: rule not found")}var k=function(){for(var a=0;a<d.children.length;a++){var c=d.children[a];1==c.nodeType&&dojo.hasClass(c,"cssPropertySection")&&(c==f?g._addRemoveClasses(c,
h,[]):g._addRemoveClasses(c,h,["propRowHidden"]))}},a=function(){q&&(dojo.removeClass(q,"cascadeRowHidden"),dojo.addClass(q,"cascadeRowTransparent"),setTimeout(function(){dojo.removeClass(q,"cascadeRowTransparent");dojo.addClass(q,"cascadeRowFadeIn")},1))};dojo.addClass(dojo.byId("root"),"showingCascade");var g=this,h=this.showPropAnimClasses,f=dojo.byId(e),d=f.parentNode,c=g._searchSiblingsByTagClass(d.children[0],"TR","cssPropertySection"),q=g._searchSiblingsByTagClass(f.nextSibling,"TR","cssCascadeSection");
e=g._searchUpByTagClass(d,"TABLE",g.animShowDetailsClass);var m=g._searchUpByTagClass(f,"DIV","propGroup"),m=dojo.attr(m,"propGroup");dojo.attr(f,"propName");require("davinci/ve/views/SwitchingStyleView").prototype.sectionTitleFromKey(m);if(p.supportsCSS3Transitions){var c=dojo.marginBox(c),c=dojo.marginBox(f).t-c.t,r=g._findRule(g.animShowDetailsClassSelector);if(r){var m=r.ss,r=r.ruleIndex,z=dojo.connect(e,"webkitTransitionEnd",b),y=dojo.connect(e,"transitionend",b);m.deleteRule(r);m.insertRule(g.animShowDetailsClassSelector+
" { margin-top:-"+c+"px; opacity:.99; -webkit-transition: all .6s ease; -moz-transition: all .6s ease; }",r);e=!1;for(c=0;c<d.children.length;c++)m=d.children[c],1==m.nodeType&&dojo.hasClass(m,"cssPropertySection")&&(m==f?(g._addRemoveClasses(m,h,["propRowFadeIn"]),e=!0):e?g._addRemoveClasses(m,h,["propRowHidden"]):g._addRemoveClasses(m,h,["propRowTransparent"]))}else console.error("HTMLStringUtil showProperty: transEnd: rule not found")}else k(),a()},_initSection:function(e){for(var b=this.showPropAnimClasses,
k=this._getRootTD(),a=dojo.query(".propGroup",k),g,k=0;k<a.length;k++){var h=a[k];dojo.attr(h,"propGroup")==e?(dojo.removeClass(h,"dijitHidden"),g=h):dojo.addClass(h,"dijitHidden")}a=dojo.query(".cssPropertySection",g);for(k=0;k<a.length;k++)this._addRemoveClasses(a[k],b,[]);b=dojo.query(".cssCascadeSection",g);for(k=0;k<b.length;k++)dojo.addClass(b[k],"cascadeRowHidden");this._currentPropSection=e;dojo.removeClass(dojo.byId("root"),"showingCascade")},_hideSectionShowRoot:function(){var e=this._getRootTD();
dojo.removeClass(e,"dijitHidden")},_findRule:function(e){function b(a,e){for(var f=0;f<a.cssRules.length;f++){var d=a.cssRules[f];if(3===d.type){if(d=b(d.styleSheet,e))return d}else if(d.selectorText==e)return{ss:a,ruleIndex:f}}}if(this.animSS&&"number"==typeof this.animRuleIndex[e]){var k=this.animRuleIndex[e];if(this.animSS.cssRules[k].selectorText==e)return{ss:this.animSS,ruleIndex:k}}for(k=0;k<document.styleSheets.length;k++){var a=b(document.styleSheets[k],e);if(a)return this.animSS=a.ss,this.animRuleIndex[e]=
a.ruleIndex,a}return null},_addRemoveClasses:function(e,b,k){for(var a=[],g=0;g<b.length;g++){for(var h=!1,f=0;f<k.length;f++)if(b[g]==k[f]){h=!0;break}h||a.push(b[g])}for(g=0;g<a.length;g++)dojo.removeClass(e,a[g]);for(g=0;g<k.length;g++)dojo.addClass(e,k[g])},_searchUpByTagClass:function(e,b,k){for(;null!=e&&"BODY"!=e.nodeName;){if(e.nodeName==b&&(!k||dojo.hasClass(e,k)))return e;e=e.parentNode}return null},_searchSiblingsByTagClass:function(e,b,k){for(;null!=e;){if(e.nodeName==b&&(!k||dojo.hasClass(e,
k)))return e;e=e.nextSibling}return null},_getRootDetailsContainer:function(){this._rootDetailsContainer||(this._rootDetailsContainer=dojo.query(this.animShowSectionClassSelector)[0]);return this._rootDetailsContainer},_getRootTD:function(){var e=this._getRootDetailsContainer();this._rootTD||(this._rootTD=dojo.query(".propPaletteRoot",e)[0]);return this._rootTD}});return h})},"davinci/ve/widgets/FontDataStore":function(){define(["dojo/_base/declare","dojo/data/ItemFileReadStore","dojo/i18n!davinci/ve/nls/ve",
"dojo/i18n!dijit/nls/common"],function(p,m){var h=p("davinci.ve.widgets.FontDataStore",m,{_allValues:[],constructor:function(e){this.setValues(e.values||davinci.ve.widgets.FontDataStore.fonts)},setValues:function(e){this._allValues=this._allValues.concat(e);this._jsonData={label:"name",identifier:"value",items:this._allValues};this._loadFinished=!1},contains:function(e){for(var b=0;b<this._allValues.length;b++)if(this._allValues[b].value==e||this._allValues[b].name==e)return b;return!1},clearValues:function(){this._allValues=
[];this._loadFinished=!1},lookupValue:function(e){e=this.contains(e);return this._allValues[e].value[0]}});return dojo.mixin(h,{fonts:[{name:"",value:""},{name:"Arial,Helvetica,sans-serif",value:"Arial,Helvetica,sans-serif"},{name:"'Arial Black,Gadget',sans-serif",value:"'Arial Black,Gadget',sans-serif"},{name:"'Comic Sans MS',cursive",value:"'Comic Sans MS',cursive"},{name:"'Courier New',Courier,monospace",value:"'Courier New',Courier,monospace"},{name:"Geneva,Tahoma,sans-serif",value:"Geneva,Tahoma,sans-serif"},
{name:"Georgia,serif",value:"Georgia,serif"},{name:"'Helvetica,Trebuchet MS',sans-serif",value:"'Helvetica,Trebuchet MS',sans-serif"},{name:"Impact,Charcoal,sans-serif",value:"Impact,Charcoal,sans-serif"},{name:"'Lucida Console',Monaco,monospace",value:"'Lucida Console',Monaco,monospace"},{name:"'Lucida Sans Unicode','Lucida Grande',sans-serif",value:"'Lucida Sans Unicode','Lucida Grande',sans-serif"},{name:"'Lucida Console', Monaco, monospace",value:"'Lucida Console', Monaco, monospace"},{name:"'Palatino Linotype','Book Antiqua',Palatino,serif",
value:"'Palatino Linotype','Book Antiqua',Palatino,serif"},{name:"Symbol",value:"Symbol"},{name:"Tahoma,Geneva,sans-serif",value:"Tahoma,Geneva,sans-serif"},{name:"'Times New Roman',Times,serif",value:"'Times New Roman',Times,serif"},{name:"'Trebuchet MS',Helvetica,sans-serif",value:"'Trebuchet MS',Helvetica,sans-serif"},{name:"Verdana,Geneva,sans-serif",value:"Verdana,Geneva,sans-serif"},{name:"Webdings",value:"Webdings"},{name:"Wingdings, 'Zapf Dingbats'",value:"Wingdings, 'Zapf Dingbats'"},{name:"'Zapf Dingbats', Wingdings",
value:"'Zapf Dingbats', Wingdings"},{name:"sans-serif",value:"sans-serif"},{name:"serif",value:"serif"},{name:"monospace",value:"monospace"},{name:"cursive",value:"cursive"},{name:"LCD",value:"LCD"}]})})},"davinci/ve/widgets/FontComboBox":function(){define(["dojo/_base/declare","dijit/form/ComboBox","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common"],function(p,m){return p("davinci.ve.widgets.FontComboBox",m,{_getValueAttr:function(){if(this.store)for(var h=0;h<this.store._allValues.length;h++){var e=
this.store._allValues[h];if(e.name[0]==this.value)return e.value[0]}return this.value},_setValueAttr:function(h){this.store&&h?this.store.fetch({query:{value:h},onComplete:function(e,b){1>e.length?this.inherited("_setValueAttr",[h]):(this.inherited("_setValueAttr",[e[0].name[0]]),this.item=e[0])}.bind(this),onError:function(){this.inherited("_setValueAttr",[h])}.bind(this)}):this.inherited("_setValueAttr",[h])}})})},"davinci/ve/widgets/MultiInputDropDown":function(){define("dojo/_base/declare dijit/_WidgetBase davinci/ve/widgets/MutableStore dijit/form/ComboBox dojo/i18n!davinci/ve/nls/ve dojo/i18n!dijit/nls/common xide/form/Select".split(" "),
function(p,m,h,e,b,k,a){var g=p("davinci.ve.widgets.MultiInputDropDown",[m],{numberDelta:1,insertPosition:1,data:null,postCreate:function(){},startup:function(){this.inherited(arguments);this.domNode.removeAttribute("data-dojo-type");this.domNode.removeAttribute("dojoType");var a=dojo.doc.createElement("div");this._run={};this.data?(this.data.push({value:g.divider}),this.data.push({value:"Remove Value",run:function(){this.set("value","")}})):this.data=[{value:""},{value:"auto"},{value:"0px"},{value:g.divider},
{value:"Remove Value",run:function(){this.set("value","")}},{value:g.divider},{value:"Help",run:function(){alert("help!")}}];for(var b=[],d=0;d<this.data.length;d++)b.push(this.data[d].value),this.data[d].run&&(this._run[this.data[d].value]=this.data[d].run);this._store=new h({values:b,divider:g.divider});var c=[];_.each(this.data,function(a){c.push({label:a.value,value:a.value,run:a.run})});this._dropDown=new e({store:this._store,required:!1,style:"width:100%"});b=dojo.doc.createElement("div");dojo.style(b,
"float","right");this._plus=dojo.doc.createElement("button");dojo.addClass(this._plus,"incrementButton");dojo.addClass(this._plus,"propertyButton");b.appendChild(this._plus);this._minus=dojo.doc.createElement("button");dojo.addClass(this._minus,"decrementButton");dojo.addClass(this._minus,"propertyButton");b.appendChild(this._minus);a.appendChild(b);b=dojo.create("div",{"class":"propInputWithIncrDecrButtons"});b.appendChild(this._dropDown.domNode);a.appendChild(b);b=dojo.doc.createElement("div");
dojo.style(b,"clear","both");a.appendChild(b);this._currentValue=this._store.getItemNumber(0);dojo.connect(this._dropDown,"onKeyUp",this,"_updateSpinner");var k=this;this._dropDown._on?this._dropDown._on("change",function(a){k._onChange(a)}):dojo.connect(this._dropDown,"onChange",this,"_onChange");dojo.connect(this._plus,"onclick",this,"_plusButton",!1);dojo.connect(this._minus,"onclick",this,"_minusButton",!1);this._updateSpinner();this.domNode.appendChild(a)},_setReadOnlyAttr:function(a){this._isReadOnly=
a;this._dropDown&&(this._dropDown.set("disabled",a),dojo.attr(this._plus,"disabled",a),dojo.attr(this._minus,"disabled",a))},onChange:function(a){},_getValueAttr:function(){return this._dropDown.get("value")},_setValueAttr:function(a,b){this._dropDown.set("value",a,!0);this._currentValue=this._dropDown.get("value");this._onChange(this._currentValue);if(!b)this.onChange()},_changeValue:function(a,b){for(var d=a.split(" "),c="",g=0;g<d.length;g++){0<g&&(c+=" ");var e=d[g].match(/([-\d\.]+)([a-zA-Z%]*)/);
if(e)if(1==e.length)c+=e[0];else for(var k=1;k<e.length;k++)c=isNaN(e[k])||""==e[k]?c+e[k]:c+(parseFloat(e[k])+b);else c+=d[g]}return c},_plusButton:function(){var a=this._dropDown.get("value"),b=this._changeValue(a,this.numberDelta);this._store.modifyItem(a,b);this._dropDown.set("value",b)},_minusButton:function(){var a=this._dropDown.get("value"),b=this._changeValue(a,-1*this.numberDelta);this._store.modifyItem(a,b);this._dropDown.set("value",b)},_updateSpinner:function(){var a=this._dropDown.get("value"),
a=/(-?)(\d+){1}/.exec(a);this._minus.disabled=a&&a.length?this._plus.disabled=!1:this._plus.disabled=!0;return!0},_onChange:function(a){var b;a in this._run?(this._dropDown.get("value",this._store.getItemNumber(0)),dojo.hitch(this,this._run[a])()):a==g.divider?this._dropDown.get("value",this._store.getItemNumber(0)):(b=this._store.findSimilar(a))?this._store.modifyItem(b,a):this._store.contains(a)||this._store.insert(this.insertPosition,a);this._currentValue!=this._dropDown.get("value")&&(this._currentValue=
this._dropDown.get("value"),this.onChange(a));this._updateSpinner()}});return dojo.mixin(g,{divider:"---"})})},"davinci/ve/widgets/MutableStore":function(){define(["dojo/_base/declare","dojo/data/ItemFileReadStore","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common"],function(p,m,h,e){return p("davinci.ve.widgets.MutableStore",m,{constructor:function(b){this.clearValues();b.divider&&(this.divider=b.divider);b.values&&this.setValues(b.values)},setValues:function(b){var e=[],a=0;b&&(this._values=
b);dojo.forEach(this._values,dojo.hitch(this,function(b){e.push({name:b,value:b,id:a++})}));this._jsonData={identifier:"id",items:e};this._loadFinished=!1},modifyItem:function(b,e){for(var a=0;a<this._values.length;a++)this._values[a]==b&&(this._values[a]=e);this.setValues()},insert:function(b,e){this._values.splice(b,0,e);this.setValues()},contains:function(b){for(var e=0;e<this._values.length;e++)if(this._values[e]==b)return!0;return!1},findSimilar:function(b){if(b=(new RegExp(/(\D*)(-?)(\d+)(\D*)/)).exec(b)){b=
new RegExp((0<b.length?b[1]:"")+"(-?)(\\d+)"+(3<b.length?b[4]:""));for(var e=0;e<this._values.length;e++)if(b.test(this._values[e]))return this._values[e]}},getItemNumber:function(b){return this._values[b]},clearValues:function(){this._loadFinished=!1}})})},"davinci/ve/widgets/MetaDataStore":function(){define(["dojo/_base/declare","dojo/data/ItemFileReadStore","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common"],function(p,m){return p("davinci.ve.widgets.MetaDataStore",m,{_allValues:[],constructor:function(h){this.setValues(h&&
h.values||[])},setValues:function(h){dojo.mixin(this._allValues,h);var e=[];dojo.forEach(this._allValues,function(b){e.push({name:b,value:b})});this._jsonData={identifier:"name",items:e};this._loadFinished=!1},contains:function(h){return-1!=dojo.indexOf(this._allValues,h)},clearValues:function(){this._allValues=[];this._loadFinished=!1}})})},"davinci/ve/widgets/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/form/ComboBox davinci/ve/widgets/ColorStore davinci/ve/widgets/ColorPickerFlat dijit/TooltipDialog dojo/i18n!davinci/ve/nls/ve dijit/popup".split(" "),
function(p,m,h,e,b,k,a){p=p("davinci.ve.widgets.ColorPicker",[m],{numberDelta:1,insertPosition:9,data:null,postCreate:function(){this.inherited(arguments);this.domNode.removeAttribute("data-dojo-type");this.domNode.removeAttribute("dojoType");this._statics=["",davinci.ve.widgets.ColorPicker.divider,a.colorPicker,a.removeValue];this._run={};this.data?(this.data.push({value:davinci.ve.widgets.ColorPicker.divider}),this.data.push({value:a.removeValue,run:function(){this.set("value","")}})):this.data=
[{value:this._statics[0]},{value:this._statics[2],run:this._chooseColorValue},{value:this._statics[3],run:function(){this.set("value","")}},{value:this._statics[1]},{value:"transparent"},{value:"black"},{value:"white"},{value:"red"},{value:"green"},{value:"blue"}];for(var g=[],k=0;k<this.data.length;k++)g.push(this.data[k].value),this.data[k].run&&(this._run[this.data[k].value]=this.data[k].run);this._store=new e({values:g,noncolors:this._statics});this._dropDown=new h({store:this._store,required:!1,
autoComplete:!1,labelType:"html",labelAttr:"label",style:"width:100%"});dojo.connect(this._dropDown,"onChange",this,"_onChange");g=dojo.doc.createElement("div");dojo.addClass(g,"colorPicker");this._selectedColor=dojo.doc.createElement("div");this._selectedColor.innerHTML="\x26nbsp;";dojo.addClass(this._selectedColor,"colorPickerSelected");dojo.connect(this._selectedColor,"onclick",dojo.hitch(this,function(a){this._chooseColorValue()}));g.appendChild(this._selectedColor);k=dojo.doc.createElement("div");
dojo.addClass(k,"colorPickerComboContainer");k.appendChild(this._dropDown.domNode);g.appendChild(k);this._colorPickerFlat=new b({});this.domNode.appendChild(g)},_chooseColorValue:function(){this._dropDown.set("value",this._value,!0);var b=this._colorPickerFlat,e=new k({id:"maqetta_prop_tooltip_color_picker",title:a.selectColor,content:b});dijit.popup.moveOffScreen(e.domNode);var f=!1,d=function(a){return function(){f&&(f=!1,dijit.popup.close(e))}}(this);e.connect(b,"onCancel",dojo.hitch(this,d));
e.connect(b,"onClose",dojo.hitch(this,d));var c=dijit.byNode(dojo.query("[widgetId]",e.domNode)[0]);if(this._value in dojo.Color.named){var h=dojo.colorFromString(this._value);b.set("value",h.toHex())}else b.set("value",this._value||"",!0);(function(a){return function(){this._isReadOnly||(dijit.popup.open({parent:a._dropDown,popup:e,around:a._dropDown.domNode,orient:a.isLeftToRight()?{BL:"TL",BR:"TR",TL:"BL",TR:"BR"}:{BR:"TR",BL:"TL",TR:"BR",TL:"BL"},onClose:function(){c.canceled||(a._dropDown.get("value"),
a._dropDown.set("value",c.get("value")));d();e.destroy()}}),f=!0,dijit.focus(e.containerNode))}})(this)()},_setReadOnlyAttr:function(a){this._isReadOnly=a;this._dropDown.set("disabled",a)},onChange:function(a){},_getValueAttr:function(){return this._dropDown.get("value")},_setValueAttr:function(a,b){this._dropDown.set("value",a,!0);dojo.style(this._selectedColor,"backgroundColor",a);if(a in dojo.Color.named){var f=dojo.colorFromString(a);this._colorPickerFlat.set("value",f.toHex(),b)}else this._colorPickerFlat.set("value",
a,b);this._onChange(a,b)},_onChange:function(a,b){a in this._run?dojo.hitch(this,this._run[a])():a==davinci.ve.widgets.ColorPicker.divider?this._dropDown.set("value",this._store.getItemNumber(0)):(this._store.contains(a)||this._store.insert(this.insertPosition,a),dojo.style(this._selectedColor,"backgroundColor",a));if(!(this._value==a||a in this._run||(this._value=a,b)))this.onChange(a)}});return dojo.mixin(p,{divider:"---"})})},"davinci/ve/widgets/ColorStore":function(){define(["dojo/_base/declare",
"dojo/data/ItemFileReadStore","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common"],function(p,m){return p("davinci.ve.widgets.ColorStore",m,{constructor:function(h){this.clearValues();h.noncolors&&(this.noncolors=h.noncolors);h.values&&this.setValues(h.values)},setValues:function(h){var e=[];h&&(this._values=h);dojo.forEach(this._values,dojo.hitch(this,function(b){for(var k=!1,a=0;!k&&a<this.noncolors.length;a++)this.noncolors[a]==b&&(k=!0);k?e.push({name:b,value:b,label:b}):e.push({value:b,
name:b,label:"\x3ctable\x3e\x3ctr\x3e\x3ctd style\x3d'width:10em'\x3e"+b+"\x3c/td\x3e\x3ctd style\x3d'width:10px;height:10px;background-color:"+b+"'\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e"})}));this._jsonData={identifier:"value",items:e};this._loadFinished=!1},insert:function(h,e){this._values.splice(h,0,e);this.setValues()},contains:function(h){for(var e=0;e<this._values.length;e++)if(this._values[e]==h)return!0;return!1},getItemNumber:function(h){return this._values[h]},clearValues:function(){this._loadFinished=
!1}})})},"davinci/ve/widgets/ColorPickerFlat":function(){define("dojo/_base/declare dijit/_Widget dijit/TooltipDialog dijit/form/Button dojox/widget/ColorPicker dojo/i18n!davinci/ve/nls/ve dojo/i18n!dijit/nls/common".split(" "),function(p,m,h,e,b,k,a){p=p("davinci.ve.widgets.ColorPickerFlat",[m],{numberDelta:1,insertPosition:1,data:null,postCreate:function(){this.inherited(arguments);var g=dojo.doc.createElement("div");this._colorPicker=new b({});g.appendChild(this._colorPicker.domNode);var k=dojo.doc.createElement("div"),
f=e({label:a.buttonOk});f.innerHtml="OK";k.appendChild(f.domNode);var d=e({label:a.buttonCancel});k.appendChild(d.domNode);g.appendChild(k);this.domNode.appendChild(g);dojo.connect(f,"onClick",this,"_onOk");dojo.connect(d,"onClick",this,"onCancel");delete this.canceled},onClose:function(){},onCancel:function(){this._value=null;this.canceled=!0},_onOk:function(){delete this.canceled;this._value=this._colorPicker.get("value");this.onClose()},_getValueAttr:function(){return this._value},_setValueAttr:function(a){a=
new dojo.Color(a);this._colorPicker.setColor(a.toHex())}});return dojo.mixin(p,{show:function(a,b,f,d){var c=new h({id:"maqetta_prop_tooltip_color_picker",title:k.selectColor,content:a});dijit.popup.moveOffScreen(c.domNode);var e=!1,m=function(a){return function(){e&&(e=!1,dijit.popup.close(c))}}();c.connect(a,"onCancel",m);c.connect(a,"onClose",m);var r=dijit.byNode(dojo.query("[widgetId]",c.domNode)[0]);b in dojo.Color.named?(b=dojo.colorFromString(b),a.set("value",b.toHex())):a.set("value",b||
"",!0);(function(a){return function(){dijit.popup.open({parent:f,popup:c,around:f.domNode,orient:d?{BL:"TL",BR:"TR",TL:"BL",TR:"BR"}:{BR:"TR",BL:"TL",TR:"BR",TL:"BL"},onClose:function(){r.canceled||(f._colorPickerFlat_comboBoxUpdateDueTo&&(f._comboBoxUpdateDueTo=f._colorPickerFlat_comboBoxUpdateDueTo),f.get("value"),f.set("value",r.get("value")));m();c.destroy()}});e=!0;dijit.focus(c.containerNode)}})()()}})})},"davinci/ve/widgets/Background":function(){define("dojo/_base/declare dojo/Deferred davinci/workbench/WidgetLite davinci/ve/widgets/ColorPickerFlat davinci/ve/widgets/ColorStore davinci/ve/widgets/MutableStore dijit/form/ComboBox davinci/ve/widgets/BackgroundDialog davinci/Workbench davinci/ve/utils/URLRewrite davinci/model/Path dojo/i18n!davinci/ve/nls/ve dojo/i18n!dijit/nls/common davinci/ve/utils/CssUtils davinci/ve/widgets/ColorPicker xide/views/_PanelDialog xide/utils".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y){var B=0;return p("davinci.ve.widgets.Background",[h],{__id:0,data:null,buildRendering:function(){this.domNode=dojo.doc.createElement("div",{style:"width:100%"});this._textFieldId="davinci_ve_widgets_properties_border_generated"+B++;this._buttonId="davinci_ve_widgets_properties_border_generated"+B++;var d=dojo.create("div",{className:"bgPropButtonDiv",style:"float:right; width:28px;"});dojo.create("button",{innerHTML:"...",id:this._buttonId,className:"bgPropButton btn-info",
style:"font-size:1em;"},d);var f=38,g=this._colorswatch="true"==this.colorswatch;if(g){var f=56,h=dojo.doc.createElement("div");dojo.addClass(h,"colorPicker");this._selectedColor=dojo.doc.createElement("div");this._selectedColor.innerHTML="\x26nbsp;";dojo.addClass(this._selectedColor,"colorPickerSelected");dojo.addClass(this._selectedColor,"colorPickerSelectedSkinny");this._colorPickerFlat=new e({})}var f=dojo.create("div",{className:"bgPropComboDiv",style:"margin-right:"+f+"px;padding:1px 0;"}),
n=dojo.isArray(this.data)?this.data:[""],q=this.langObjVE=c;if(g){this._statics=["",davinci.ve.widgets.ColorPicker.divider,q.colorPicker,q.removeValue];this._run={};this.data?(this.data.push({value:davinci.ve.widgets.ColorPicker.divider}),this.data.push({value:langObj.removeValue,run:function(){this.set("value","")}})):(this.data=[{value:this._statics[0]}],this.data.push({value:this._statics[2],run:this._chooseColorValue}),this.data.push({value:this._statics[3],run:function(){this.set("value","")}}),
this.data.push({value:this._statics[1]}),this.data.push({value:"transparent"}),this.data.push({value:"black"}),this.data.push({value:"white"}),this.data.push({value:"red"}),this.data.push({value:"green"}),this.data.push({value:"blue"}));n=[];for(q=0;q<this.data.length;q++)n.push(this.data[q].value),this.data[q].run&&(this._run[this.data[q].value]=this.data[q].run);this._store=new b({values:n,noncolors:this._statics})}else this._store=new k({values:n});this._comboBox=new a({store:this._store,id:this._textFieldId,
style:"width:100%;"});f.appendChild(this._comboBox.domNode);this.domNode.appendChild(d);g&&(this.domNode.appendChild(h),dojo.connect(h,"onclick",dojo.hitch(this,function(a){dojo.stopEvent(a);this._chooseColorValue()})),h.appendChild(this._selectedColor),this._colorPickerFlat_comboBoxUpdateDueTo="colorSwatch");this.domNode.appendChild(f);"string"==typeof this.propname&&this._comboBox&&(davinci.ve._BackgroundWidgets||(davinci.ve._BackgroundWidgets={}),davinci.ve._BackgroundWidgets[this.propname]={propPaletteWidget:this,
comboBox:this._comboBox});this.inherited(arguments)},startup:function(){this.inherited(arguments);this._button=dojo.byId(this._buttonId);dojo.connect(this._button,"onclick",this,function(){var a=this._cascade&&this._cascade._widget&&this._cascade._widget.getContext?this._cascade._widget.getContext():null,c=new g({context:a}),b=dojo.hitch(this,function(c){a||(console.error("Background.js. no context"),a={});var b=a.cascadeBatch={},g=b.propList=[],e=b.actions={},k=b.deferreds={};b.askUserResponse=void 0;
if(!c.cancel){var h=davinci.ve._BackgroundWidgets,n;for(n in h){var q=h[n];if(q.bgdWidget){var b=q.bgdWidget.get("value"),r=q.propPaletteWidget.get("value");b!==r&&(g.push(n),e[n]=dojo.hitch(this,function(a,c){a.propPaletteWidget._comboBoxUpdateDueTo="backgroundDialog";a.propPaletteWidget.set("value",c)},q,b),k[n]=new m)}}n="background-image";q=h[n];c=u.buildBackgroundImage(c.bgddata);for(b=0;b<c.length;b++)r=c[b],f.containsUrl(r)&&!f.isAbsolute(r)&&((h=f.getUrl(r))&&(r="url('"+(new d(h)).toString()+
"')"),c[b]=r);b=0==c.length?"":c[c.length-1];r=q.propPaletteWidget.get("value");b!==r&&(q.propPaletteWidget._cascade&&(q.propPaletteWidget._cascade._valueArrayNew=c),g.push(n),e[n]=dojo.hitch(this,function(a,c){q.propPaletteWidget._comboBoxUpdateDueTo="backgroundDialog";q.propPaletteWidget.set("value",c)},q,b),k[n]=new m);for(b=0;b<g.length;b++)n=g[b],k[n].then(dojo.hitch(this,function(c){(c=g[c+1])?e[c].apply():delete a.cascadeBatch},b));0<g.length&&(n=g[0],e[n].apply())}return!0},c),e=davinci.ve._BackgroundWidgets,
k;for(k in e){var h=e[k].propPaletteWidget._cascade;h&&(h._valueArrayNew=h._valueArray)}c.set("baseLocation",this._baseLocation);(new z({onOk:function(){b()},onShow:function(a,b,d){y.addChild(b,c,!0);this.add(c,null,!1);this.startDfd.resolve();return[c]}})).show()});this.connect(this._comboBox,"onChange",dojo.hitch(this,function(a){a!=davinci.ve.widgets.ColorPicker.divider&&a!=this.langObjVE.colorPicker||this._comboBox.set("value",this.value);var c=this._comboBoxUpdateDueTo;this._comboBoxUpdateDueTo=
void 0;"setAttr"!=c&&this._onChange(a)}));this.connect(this._comboBox,"onFocus",dojo.hitch(this,function(a){a=davinci.ve._BackgroundWidgets;for(var c in a){var b=a[c].propPaletteWidget._cascade;b&&(b._valueArrayNew=void 0)}(c=this._cascade&&this._cascade._widget&&this._cascade._widget.getContext?this._cascade._widget.getContext():null)&&delete c.cascadeBatch}));this._maqStartupComplete=!0},_setBaseLocationAttr:function(a){this._baseLocation=a},_setValueAttr:function(a){var c=this._comboBox.get("value");
this._colorswatch&&dojo.style(this._selectedColor,"backgroundColor",a);a=dojo.isArray(a)?0<a.length?a[a.length-1]:"":a;c!==a&&("backgroundDialog"!==this._comboBoxUpdateDueTo&&"colorSwatch"!==this._comboBoxUpdateDueTo&&(this._comboBoxUpdateDueTo="setAttr"),this._comboBox.set("value",a))},_onChange:function(a){this._colorswatch&&"string"==typeof a&&(a in this._run?dojo.hitch(this,this._run[a])():a==davinci.ve.widgets.ColorPicker.divider?this._comboBox.set("value",this._store.getItemNumber(0)):dojo.style(this._selectedColor,
"backgroundColor",a));this.value=this._comboBox.get("value");this.onChange(a)},onChange:function(a){},_getValueAttr:function(){return this._comboBox.get("value")},_setReadOnlyAttr:function(a){this._maqStartupComplete&&(this._isReadOnly=a,this._comboBox.set("disabled",a),this._button.disabled=a)},_chooseColorValue:function(){if(!this._isReadOnly){var a=this._comboBox.get("value"),c=this.isLeftToRight();davinci.ve.widgets.ColorPickerFlat.show(this._colorPickerFlat,a,this,c)}}})})},"davinci/ve/widgets/BackgroundDialog":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin davinci/Runtime davinci/ve/widgets/MutableStore davinci/ve/widgets/ColorStore xide/utils dojo/text!./templates/BackgroundDialog.html davinci/ve/utils/CssUtils dojo/i18n!davinci/ve/nls/ve dojo/i18n!dijit/nls/common davinci/ve/utils/URLRewrite davinci/model/Path dijit/form/Button davinci/ve/widgets/ColorPicker davinci/ve/widgets/ColorPickerFlat dijit/form/Textarea davinci/ui/widgets/FileFieldDialog".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u){var r=function(a,c){return"url('"+c+"')"};p=p("davinci.ve.widgets.BackgroundDialog",[m,h,e],{templateString:n,widgetsInTemplate:!0,_filePicker:null,context:null,veNLS:d,stopRowTemplate:"\x3ctr class\x3d'bgdGradOptRow bgdStopRow' style\x3d'display:none;'\x3e\x3ctd class\x3d'bgdCol1'\x3e\x3c/td\x3e\x3ctd class\x3d'bgdOptsLabel bdgStopLabel'\x3e"+d.bgdTemplate+"\x3c/td\x3e\x3ctd class\x3d'bgdStopColorTD'\x3e\x3cselect class\x3d'bgdColor' dojoType\x3d'dijit.form.ComboBox'\x3e\x3c/select\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect class\x3d'bgdPosition' dojoType\x3d'dijit.form.ComboBox'\x3e\x3c/select\x3e\x3c/td\x3e\x3ctd class\x3d'bgdPlusMinusButtons'\x3e\x3cspan class\x3d'bgdPlusButton' dojoType\x3d'dijit.form.Button'\x3e+\x3c/span\x3e\x3cspan class\x3d'bgdMinusButton' dojoType\x3d'dijit.form.Button'\x3e-\x3c/span\x3e\x3c/td\x3e\x3c/tr\x3e",
postMixInProperties:function(){this.inherited(arguments);dojo.mixin(this,c)},postCreate:function(){this.inherited(arguments);var c=this.langObj=d;this.stoppos_store=new k({values:"0% 100% 10% 20% 30% 40% 50% 60% 70% 80% 90%".split(" ")});var b=davinci.ve._BackgroundWidgets;this._statics=["",davinci.ve.widgets.ColorPicker.divider,c.colorPicker,c.removeValue];var g=[{value:this._statics[0]}];g.push({value:this._statics[2],action:"_colorpicker"});g.push({value:this._statics[3],action:"_removevalue"});
g.push({value:this._statics[1],action:"_donothing"});g.push({value:"transparent"});g.push({value:"black"});g.push({value:"white"});g.push({value:"red"});g.push({value:"green"});g.push({value:"blue"});var e=[];this._bgcolor_action={};var h=[];this._stops_action={};for(var n=0;n<g.length;n++)e.push(g[n].value),g[n].action&&(this._bgcolor_action[g[n].value]=g[n].action),""!=g[n].value&&"_removevalue"!=g[n].action&&(h.push(g[n].value),g[n].action&&(this._stops_action[g[n].value]=g[n].action));this._bgcolor_store=
new a({values:e,noncolors:this._statics});this._stops_store=new a({values:h,noncolors:this._statics});var g=b["background-image"].comboBox.get("value"),q,m;"string"==typeof g&&0<g.length?(q=f.parseBackgroundImage(g),m=q.type):q={};this.bgddata=q;this.bgdOtherTA.set("value",g);var r=[];"emptystring url linear radial none other".split(" ").forEach(function(a){r.push({value:a,label:c["bgdType_"+a]})});this.bgdTypeSelect.addOption(r);this._updateBackgroundImageType(m);this.connect(this.bgdTypeSelect,
"onChange",dojo.hitch(this,function(){var a=this.bgdTypeSelect.get("value");this._updateBackgroundImageType(a);this._onFieldChanged()}));g=b["background-color"].comboBox.get("value");m=this.bgdColorCB;m.set("store",this._bgcolor_store);m.set("value",g);q.backgroundColor=g;this.connect(this.bgdColorCB,"onChange",dojo.hitch(this,function(a){this._onChangeColor(a,this.bgdColorCB,this._bgcolor_action)}));b["background-color"].bgdWidget=this.bgdColorCB;m=b["background-repeat"].comboBox;g=m.get("value");
e=this.bgdRepeatCB;e.set("store",m.store);e.set("regExp","repeat|repeat-x|repeat-y|no-repeat");e.set("value",g);q.backgroundRepeat=g;this.connect(this.bgdRepeatCB,"onChange",dojo.hitch(this,function(){q.backgroundRepeat=this.bgdRepeatCB.get("value");this._onFieldChanged()}));b["background-repeat"].bgdWidget=this.bgdRepeatCB;m=b["background-position"].comboBox;g=m.get("value");e=this.bgdPositionCB;e.set("store",m.store);e.set("regExp","auto|contain|cover|"+f.regstr_posn);e.set("value",g);q.backgroundPosition=
g;this.connect(this.bgdPositionCB,"onChange",dojo.hitch(this,function(){q.backgroundPosition=this.bgdPositionCB.get("value");this._onFieldChanged()}));b["background-position"].bgdWidget=this.bgdPositionCB;m=b["background-size"].comboBox;g=m.get("value");e=this.bgdSizeCB;e.set("store",m.store);e.set("regExp","auto|contain|cover|"+f.regstr_len_or_pct);e.set("value",g);q.backgroundSize=g;this.connect(this.bgdSizeCB,"onChange",dojo.hitch(this,function(){q.backgroundSize=this.bgdSizeCB.get("value");this._onFieldChanged()}));
b["background-size"].bgdWidget=this.bgdSizeCB;m=b["background-origin"].comboBox;g=m.get("value");e=this.bgdOriginCB;e.set("store",m.store);e.set("regExp","border-box|padding-box|content-box");e.set("value",g);q.backgroundOrigin=g;this.connect(this.bgdOriginCB,"onChange",dojo.hitch(this,function(){q.backgroundOrigin=this.bgdOriginCB.get("value");this._onFieldChanged()}));b["background-origin"].bgdWidget=this.bgdOriginCB;m=b["background-clip"].comboBox;g=m.get("value");e=this.bgdClipCB;e.set("store",
m.store);e.set("regExp","border-box|padding-box|content-box");e.set("value",g);q.backgroundClip=g;this.connect(this.bgdClipCB,"onChange",dojo.hitch(this,function(){q.backgroundClip=this.bgdClipCB.get("value");this._onFieldChanged()}));b["background-clip"].bgdWidget=this.bgdClipCB;b=new k({values:"to bottom;to top;to right;to left;45deg;-45deg".split(";")});this.bgdLinearAngleCB.set("store",b);this.bgdLinearAngleCB.set("regExp",f.regstr_angle);this.bgdLinearAngleCB.set("value",q&&q.angle?q.angle:"to bottom");
this.connect(this.bgdLinearAngleCB,"onChange",dojo.hitch(this,function(){q.angle=this.bgdLinearAngleCB.get("value");this._onFieldChanged()}));b=new k({values:"center;left top;center center;right bottom;0% 0%;0px 0px".split(";")});this.bgdRadialPosCB.set("store",b);this.bgdRadialPosCB.set("regExp",f.regstr_posn);this.bgdRadialPosCB.set("value",q&&q.posn?q.posn:"center");this.connect(this.bgdRadialPosCB,"onChange",dojo.hitch(this,function(){q.posn=this.bgdRadialPosCB.get("value");this._onFieldChanged()}));
b=new k({values:["circle","ellipse"]});this.bgdRadialShapeCB.set("store",b);this.bgdRadialShapeCB.set("regExp",f.regstr_shape);this.bgdRadialShapeCB.set("value",q&&q.shape?q.shape:"circle");this.connect(this.bgdRadialShapeCB,"onChange",dojo.hitch(this,function(){q.shape=this.bgdRadialShapeCB.get("value");this._onFieldChanged()}));b=new k({values:["farthest-corner","farthest-side","closest-corner","closest-side"]});this.bgdRadialExtentCB.set("store",b);this.bgdRadialExtentCB.set("regExp",f.regstr_extent);
this.bgdRadialExtentCB.set("value",q&&q.extent?q.extent:"farthest-corner");this.connect(this.bgdRadialExtentCB,"onChange",dojo.hitch(this,function(){q.extent=this.bgdRadialExtentCB.get("value");this._onFieldChanged()}));this._initializeStops(q&&q.stops&&2<=q.stops.length?q.stops:[{color:"white",pos:"0%"},{color:"black",pos:"100%"}])},startup:function(){this.inherited(arguments);var a=this.bgddata&&this.bgddata.url?this.bgddata.url:"";this._filePicker.set("value",a);this._filePicker.owner=this;this.bgddata.url=
a;this.connect(this._filePicker,"onChange",dojo.hitch(this,function(){var a=this._filePicker.get("value");this.bgddata.url=a;this._onFieldChanged()}))},_updateBackgroundImageType:function(a){var c=this.domNode;if(!a||"none"!=a&&"url"!=a&&"linear"!=a&&"radial"!=a&&"other"!=a)a="emptystring";this.bgddata.type=a;this.bgdTypeSelect.set("value",a);var b=dojo.query(".bgdOptionsLabelRow",c),d=dojo.query(".bgdImageOptRow",c),f=dojo.query(".bgdGradOptRow",c),g=dojo.query(".bgdLinearOptRow",c),e=dojo.query(".bgdRadialOptRow",
c),c=dojo.query(".bgdOtherRow",c);"url"==a?(d.concat(b).forEach(function(a){dojo.removeClass(a,"dijitHidden")}),f.concat(c).forEach(function(a){dojo.addClass(a,"dijitHidden")})):"linear"==a?(f.concat(b).forEach(function(a){dojo.removeClass(a,"dijitHidden")}),d.concat(e).concat(c).forEach(function(a){dojo.addClass(a,"dijitHidden")})):"radial"==a?(f.concat(b).forEach(function(a){dojo.removeClass(a,"dijitHidden")}),d.concat(g).concat(c).forEach(function(a){dojo.addClass(a,"dijitHidden")})):"other"==
a?(c.forEach(function(a){dojo.removeClass(a,"dijitHidden")}),d.concat(f).concat(b).forEach(function(a){dojo.addClass(a,"dijitHidden")})):d.concat(f).concat(b).concat(c).forEach(function(a){dojo.addClass(a,"dijitHidden")})},_initializeStops:function(a){var c=this.langObj;a||(a=this.bgddata.stops);for(var b=this.bgdTypeSelect.get("value"),d=dojo.query(".bgdStopRow",this.domNode),g=d.length-1;0<g;g--){var e=d[g],k=dojo.query(".bgdColor",e),k=dijit.byNode(k[0]);k.destroyRecursive();k=dojo.query(".bgdPosition",
e);k=dijit.byNode(k[0]);k.destroyRecursive();dojo.destroy(e)}g=d[0];d=g.parentNode;e=g.nextSibling;for(g=0;g<a.length;g++){var h=a[g],n=dojo.create("tr",{className:"bgdGradOptRow bgdStopRow"});n.innerHTML=this.stopRowTemplate;"linear"!=b&&"radial"!=b&&dojo.addClass(n,"dijitHidden");d.insertBefore(n,e);dojo.parser.parse(n);dojo.query(".bdgStopLabel",n)[0].innerHTML=this.langObj.bgdStop+" #"+(g+1)+":";k=dojo.query(".bgdColor",n);k=dijit.byNode(k[0]);k.set("store",this._stops_store);k.set("regExp",f.regstr_stop_color);
k.set("value",h.color);this.connect(k,"onChange",dojo.hitch(this,function(a,c){this._onChangeColor(c,a,this._stops_action)},k));k=dojo.query(".bgdPosition",n);k=dijit.byNode(k[0]);k.set("store",this.stoppos_store);h="string"==typeof h.pos&&0<h.pos.length?h.pos:0==g?"0%":"100%";k.set("regExp",f.regstr_stop_pos);k.set("value",h);this.connect(k,"onChange",dojo.hitch(this,function(){this._updateDataStructureStops();this._onFieldChanged()}));k=dojo.query(".bgdPlusButton",n)[0];k=dijit.byNode(k);k.set("title",
c.bgdAddStop);this.connect(k,"onClick",dojo.hitch(this,function(a){var c=this.bgddata.stops[a];this.bgddata.stops.splice(a+1,0,{color:c.color,pos:c.pos});this._initializeStops()},g));h=dojo.query(".bgdMinusButton",n)[0];h=dijit.byNode(h);h.set("title",c.bgdRemoveStop);this.connect(h,"onClick",dojo.hitch(this,function(a){this.bgddata.stops.splice(a,1);this._initializeStops()},g));n=dojo.query(".bgdMinusButton",this.domNode);for(k=0;k<n.length;k++)h=n[k],h=dijit.byNode(h),2>=a.length?h.set("disabled",
!0):h.set("disabled",!1)}this._updateDataStructureStops()},_onFieldChanged:function(){this._updateDialogValidity();this._updateBackgroundPreview()},_setBaseLocationAttr:function(a){this._baseLocation=a;this._filePicker.set("baseLocation",a)},_updateDialogValidity:function(){var a=this.bgddata;if(a&&a.type){var c=this.domNode,a=a.type,b=[],d=!0;"url"==a?b=dojo.query(".bgdImageOptRow",c):"linear"==a?b=dojo.query(".bgdStopRow",c).concat(dojo.query(".bgdLinearOptRow",c)):"radial"==a&&(b=dojo.query(".bgdStopRow",
c).concat(dojo.query(".bgdRadialOptRow",c)));b.forEach(function(a){dojo.query("[widgetid]",a).forEach(function(a){"function"!=typeof a.isValid||a.isValid()||(d=!1)})});this.bdgValid=d}},_updateBackgroundPreview:function(){function a(c,f){var g=d[f];"string"==typeof g&&0<g.length&&(b+=";"+c+":"+g)}var c=dojo.query(".bgdPreview",this.domNode)[0],b="",d=this.bgddata;a("background-color","backgroundColor");a("background-repeat","backgroundRepeat");a("background-position","backgroundPosition");a("background-size",
"backgroundSize");a("background-origin","backgroundOrigin");a("background-clip","backgroundClip");for(var e=f.buildBackgroundImage(this.bgddata),k=0;k<e.length;k++){var h=e[k];if(q.containsUrl(h)&&!q.isAbsolute(h)&&this.context){var n=q.getUrl(h),n=g.parse_url(n);(n=this.context.ctx.getFileManager().getImageUrl({path:n.host+n.path,mount:n.scheme},!1))&&(h=r(this._baseLocation,n))}b+=";background-image:"+h}c.setAttribute("style",b);this.bgdOtherTA.set("value",e[e.length-1])},_updateDataStructureStops:function(){var a=
this.bgddata;a.stops=[];for(var c=dojo.query(".bgdStopRow",this.domNode),b=1;b<c.length;b++){var d=c[b],f=dojo.query(".bgdColor",d),f=dijit.byNode(f[0]),d=dojo.query(".bgdPosition",d),d=dijit.byNode(d[0]);a.stops.push({color:f.get("value"),pos:d.get("value")})}},_setValueAttr:function(a){a&&this._colorPickerTargetWidget.set("value",a)},_onChangeColor:function(a,c,b){if(a=b[a])if("_removevalue"==a?c.set("value",""):c.set("value",c._currentcolorvalue),"_colorpicker"==a){a=new davinci.ve.widgets.ColorPickerFlat({});
b=c.get("value");var d=this.isLeftToRight();this._colorPickerTargetWidget=c;davinci.ve.widgets.ColorPickerFlat.show(a,b,this,d)}c._currentcolorvalue=c.get("value");this.bgddata.backgroundColor=this.bgdColorCB.get("value");this._updateDataStructureStops();this._onFieldChanged()},okButton:function(){},cancelButton:function(){this.onClose()}});p.getCSSForWorkspaceURL=r;return p})},"davinci/ve/utils/CssUtils":function(){define(["dojo/_base/Color","davinci/ve/utils/URLRewrite"],function(p,m){var h=[],
e;for(e in p.named)"transparent"!=e&&h.push(e);h.sort(function(a,c){return 0==c.indexOf(a)?1:0==a.indexOf(c)?-1:a<c?-1:1});var b=[];h.forEach(function(a){b.push(a);a=p.named[a];a="#"+(16777216+(a[0]<<16)+(a[1]<<8)+a[2]).toString(16).slice(1);b.push(a)});var k=/^\-?(?:\d*\.\d+|\d+)$/,h="(?:";for(e=0;e<b.length;e+=2)0!=e&&(h+="|"),h+=b[e];h="(?:"+(h+")")+"|\\#(?:[0-9A-Fa-f]{6}|[0-9A-Fa-f]{3})|(?:rgb|hsl)\\s*\\(\\s*(?:(?:\\d*\\.\\d+|\\d+)%?)\\s*,\\s*(?:(?:\\d*\\.\\d+|\\d+)%?)\\s*,\\s*(?:(?:\\d*\\.\\d+|\\d+)%?)\\s*\\)|(?:rgba|hsla)\\s*\\(\\s*(?:(?:\\d*\\.\\d+|\\d+)%?)\\s*,\\s*(?:(?:\\d*\\.\\d+|\\d+)%?)\\s*,\\s*(?:(?:\\d*\\.\\d+|\\d+)%?)\\s*,\\s*(?:\\d*\\.\\d+|\\d+)\\s*\\))";
e="(?:"+h+"(?:\\s+(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0))?)";var a=new RegExp("(?:\\s*("+h+")\\s*((?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0))?\\s*,?(.*))");e="("+e+"(?:\\s*,\\s*"+e+")*)";var g=/^\s*(url)\s*\(\s*(?:\'([^\']*)\'*|\"([^\"]*)\"|([^\'\"]*))\s*\)\s*$/,n=new RegExp("^\\s*((?:-moz-linear-gradient|-webkit-linear-gradient|-ms-linear-gradient|-o-linear-gradient|linear-gradient))\\s*\\(\\s*(?:(?:to\\s+((?:\\s*left\\s*|\\s*right\\s*|\\s*top\\s*|\\s*bottom\\s*){1,2})|((?:\\s*left\\s*|\\s*right\\s*|\\s*top\\s*|\\s*bottom\\s*){1,2})|((?:\\-?(?:\\d*\\.\\d+|\\d+)deg)))\\s*,\\s*)?\\s*"+
e+"\\s*\\)\\s*$"),f=new RegExp("^\\s*((?:-moz-radial-gradient|-webkit-radial-gradient|-ms-radial-gradient|-o-radial-gradient|radial-gradient))\\s*\\(\\s*(?:\\s*(?:\\s*(\\s*(?:(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)|(?:left|center|right|top|bottom))(?:\\s*(?:(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)|(?:left|center|right|top|bottom)))?)\\s*((?:\\-?(?:\\d*\\.\\d+|\\d+)deg))\\s*|\\s*(\\s*(?:(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)|(?:left|center|right|top|bottom))(?:\\s*(?:(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)|(?:left|center|right|top|bottom)))?)\\s*|\\s*((?:\\-?(?:\\d*\\.\\d+|\\d+)deg))\\s*)\\s*,\\s*)?\\s*(?:\\s*(?:\\s*(circle|ellipse)\\s*((?:(?:closest-side|farthest-side|closest-corner|farthest-corner|contain|cover)|(?:(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)(?:\\s+(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)\\s*)?)))\\s*|\\s*((?:(?:closest-side|farthest-side|closest-corner|farthest-corner|contain|cover)|(?:(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)(?:\\s+(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)\\s*)?)))\\s*(circle|ellipse)\\s*|\\s*(circle|ellipse)\\s*|\\s*((?:(?:closest-side|farthest-side|closest-corner|farthest-corner|contain|cover)|(?:(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)(?:\\s+(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)\\s*)?)))\\s*)\\s*,\\s*)?\\s*"+
e+"\\s*\\)\\s*$"),d=/(?:\s*((?:top|bottom|left|right|center|(?:\-?(?:\d*\.\d+|\d+)%?)))\s+((?:top|bottom|left|right|center|(?:\-?(?:\d*\.\d+|\d+)%?)))\s*)/;e="("+("(?:\\s*,\\s*"+("(?:"+("(?:color-stop\\s*\\(\\s*(?:\\-?(?:\\d*\\.\\d+|\\d+)%?)\\s*,\\s*"+h+"\\s*\\)\\s*)")+"|"+("(?:from\\s*\\(\\s*"+h+"\\s*\\)\\s*)")+"|"+("(?:to\\s*\\(\\s*"+h+"\\s*\\)\\s*)")+")")+"\\s*)")+"+)";var c=new RegExp("(?:\\s*,\\s*"+("(?:"+("(?:(color-stop)\\s*\\(\\s*((?:\\-?(?:\\d*\\.\\d+|\\d+)%?))\\s*,\\s*("+h+")\\s*\\)\\s*)")+
"|"+("(?:(from)\\s*\\(\\s*("+h+")\\s*\\)\\s*)")+"|"+("(?:(to)\\s*\\(\\s*("+h+")\\s*\\)\\s*)")+")")+"\\s*)(.*)"),q=new RegExp("(?:\\s*(-webkit-gradient)\\s*\\(\\s*(linear)\\s*(?:\\s*,\\s*((?:\\s*(?:top|bottom|left|right|center|(?:\\-?(?:\\d*\\.\\d+|\\d+)%?))\\s+(?:top|bottom|left|right|center|(?:\\-?(?:\\d*\\.\\d+|\\d+)%?))\\s*))\\s*)(?:\\s*,\\s*((?:\\s*(?:top|bottom|left|right|center|(?:\\-?(?:\\d*\\.\\d+|\\d+)%?))\\s+(?:top|bottom|left|right|center|(?:\\-?(?:\\d*\\.\\d+|\\d+)%?))\\s*))\\s*)"+e+"\\s*\\)\\s*)"),
u=new RegExp("(?:\\s*(-webkit-gradient)\\s*\\(\\s*(radial)\\s*(?:(?:\\s*,\\s*((?:\\s*(?:top|bottom|left|right|center|(?:\\-?(?:\\d*\\.\\d+|\\d+)%?))\\s+(?:top|bottom|left|right|center|(?:\\-?(?:\\d*\\.\\d+|\\d+)%?))\\s*))\\s*)(?:\\s*,\\s*((?:\\d*\\.\\d+|\\d+))\\s*)(?:\\s*,\\s*((?:\\s*(?:top|bottom|left|right|center|(?:\\-?(?:\\d*\\.\\d+|\\d+)%?))\\s+(?:top|bottom|left|right|center|(?:\\-?(?:\\d*\\.\\d+|\\d+)%?))\\s*))\\s*)(?:\\s*,\\s*((?:\\d*\\.\\d+|\\d+))\\s*)?)"+e+"\\s*\\)\\s*)"),r=function(c){var b=
[];do{var d=c.match(a);d&&(b.push({color:d[1],pos:d[2]}),c=d[3])}while(d);return b},z=function(a){var b=[],d=[],f,g;do{var e=a.match(c);e&&(e[4]?f={color:e[5]}:e[6]?g={color:e[7]}:(a=e[2].match(k)?100*e[2]+"%":e[2],d.push({color:e[3],pos:a})),a=e[8])}while(e);f&&b.push(f);for(f=0;f<d.length;f++)b.push(d[f]);g&&b.push(g);return b};return{regstr_posn:"^\\s*\\s*(?:(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)|(?:left|center|right|top|bottom))(?:\\s*(?:(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)|(?:left|center|right|top|bottom)))?\\s*$",
regstr_len_or_pct:"^\\s*(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)\\s*$",regstr_angle:"^\\s*(?:to\\s+((?:\\s*left\\s*|\\s*right\\s*|\\s*top\\s*|\\s*bottom\\s*){1,2})|((?:\\-?(?:\\d*\\.\\d+|\\d+)deg)))\\s*$",regstr_shape:"^\\s*circle|ellipse\\s*$",regstr_extent:"^\\s*(?:(?:closest-side|farthest-side|closest-corner|farthest-corner|contain|cover)|(?:(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)(?:\\s+(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)\\s*)?))\\s*$",regstr_stop_color:"\\s*"+
h+"\\s*",regstr_stop_pos:"\\s*(?:\\-?(?:\\d*\\.\\d+|\\d+)(?:in|cm|mm|pt|pc|px|%)|0)\\s*",parseBackgroundImage:function(a){var c={},b=a.match(/^\s*$/);if(b)c.type="emptystring";else if(b=a.match(/^\s*none\s*$/))c.type="none";else if(b=a.match(g))c.type="url",c.func=b[1],c.url=b[2]?b[2]:b[3]?b[3]:b[4];else if(b=a.match(q)){c.type="linear";c.func=b[1];c.webkitGradType=b[2];c.webKitPosn1=b[3];c.webKitPosn2=b[4];var e=c.webKitPosn1,k=c.webKitPosn2;a=0<=e.indexOf("left");var h=0<=e.indexOf("top"),m=0<=
e.indexOf("right"),e=0<=e.indexOf("bottom"),p=0<=k.indexOf("left"),E=0<=k.indexOf("top"),I=0<=k.indexOf("right"),k=0<=k.indexOf("bottom");h&&k&&(a&&p||m&&I)?c.angle="to bottom":e&&E&&(a&&p||m&&I)?c.angle="to top":a&&I&&(h&&E||e&&k)?c.angle="to right":p&&m&&(h&&E||e&&k)?c.angle="to left":a&&h&&I&&k?c.angle="to bottom right":a&&e&&I&&E?c.angle="to top right":m&&h&&p&&k?c.angle="to bottom left":m&&e&&p&&E&&(c.angle="to top left");c.stops=z(b[5])}else if(b=a.match(u))c.type="radial",c.func=b[1],c.webkitGradType=
b[2],c.webKitPosn1=b[3],c.webKitRadius1=b[4],c.webKitPosn2=b[5],c.webKitRadius2=b[6],c.shape=c.webKitPosn1==c.webKitPosn2?"circle":"ellipse",h=c.webKitPosn1,(a=h.match(d))?(h=a[1],h.match(/^\d+$/)&&(h+="px"),a=a[2],a.match(/^\d+$/)&&(a+="px"),a=h+" "+a):a=h,c.posn=a,c.extent=c.webKitRadius2?c.webKitRadius2+"px":c.webKitRadius1?c.webKitRadius1+"px":"farthest-corner",c.stops=z(b[7]);else if(b=a.match(n))c.type="linear",c.func=b[1],c.angle=b[2]?"to "+b[2]:b[3]?"to "+b[3]:b[4],c.stops=r(b[5]);else if(b=
a.match(f))c.type="radial",c.func=b[1],c.posn=b[2]?b[2]:b[4],c.angle=b[3]?b[3]:b[5],c.shape=b[6]?b[6]:b[9]?b[9]:b[10],c.extent=b[7]?b[7]:b[8]?b[8]:b[11],c.stops=r(b[12]);b||(c.type="unknown");return c},buildBackgroundImage:function(a){var c=[];if("emptystring"==a.type)c.push("");else if("none"==a.type)c.push("none");else if("url"==a.type){if("string"==typeof a.url&&0<a.url.length){var b=m.getUrl(a.url);b||(b=m.stripQuotes(a.url));c.push("url('"+b+"')")}}else if("linear"==a.type||"radial"==a.type){for(var b=
"",d,f,g=[],e=0;e<a.stops.length;e++){var k=a.stops[e],h="string"==typeof k.pos&&0<k.pos.length?k.pos:"";0<e&&(b+=", ");b+=k.color;if(0<e&&e<a.stops.length-1||0==e&&0!=h.length&&"0%"!=h&&0!=h-0||e==a.stops.length-1&&0!=h.length&&"100%"!=h&&1!=h-0)b+=" "+h;0!=e||0!=h.length&&"0%"!=h&&0!=h-0?e!=a.stops.length-1||0!=h.length&&"100%"!=h&&1!=h-0?g.push("color-stop("+h+", "+k.color+")"):f="to("+k.color+")":d="from("+k.color+")"}k="";h=!1;d&&(k+=d,h=!0);f&&(h&&(k+=", "),k+=f,h=!0);for(e=0;e<g.length;e++)h&&
(k+=", "),k+=g[e],h=!0;if("linear"==a.type){d="(";var n=a.angle;(f="string"==typeof n&&0<n.length?n.match(/^\s*(?:to\s+((?:\s*left\s*|\s*right\s*|\s*top\s*|\s*bottom\s*){1,2})|((?:\-?(?:\d*\.\d+|\d+)deg)))\s*$/):null)||(n="to bottom");"to bottom"!=n&&(d+=n+",");a="(linear,";g=0<=n.indexOf("left");e=0<=n.indexOf("top");h=0<=n.indexOf("right");n=0<=n.indexOf("bottom");g&&e?a+=" right bottom, left top, ":g&&n?a+=" right top, left bottom, ":h&&e?a+=" left bottom, right top, ":h&&n?a+=" left top, right bottom, ":
g?a+=" right top, left top, ":h?a+=" left top, right top, ":e?a+=" left bottom, left top, ":n?a+=" left top, left bottom, ":(g=180*(90-parseFloat(f[4]))/Math.PI,f=Math.cos(g),g=Math.sin(g),0<=f&&0<=g?(a+="0% 100%,",a=Math.abs(f)>Math.abs(g)?a+("100% "+100*(1-Math.abs(g)/Math.abs(f))+"%"):a+(Math.abs(f)/Math.abs(g)*100+"% 100%")):0<=f&&0>g?(a+="0% 0%,",a=Math.abs(f)>Math.abs(g)?a+("100% "+Math.abs(-g)/Math.abs(f)*100+"%"):a+(Math.abs(f)/Math.abs(g)*100+"% 100%")):0>f&&0<=g?(a+="100% 100%,",a=Math.abs(f)>
Math.abs(g)?a+("0% "+100*(1-Math.abs(g)/Math.abs(f))+"%"):a+(Math.abs(f)/Math.abs(g)*100+"% 100%")):(a+="100% 0%,",a=Math.abs(f)>Math.abs(g)?a+("0% "+Math.abs(-g)/Math.abs(f)*100+"%"):a+(Math.abs(f)/Math.abs(g)*100+"% 100%")),a+=", ");d+=b+")";c.push("-webkit-gradient"+(a+(k+")")));c.push("-o-linear-gradient"+d);c.push("-ms-linear-gradient"+d);c.push("-moz-linear-gradient"+d);c.push("-webkit-linear-gradient"+d);c.push("linear-gradient"+d)}else d="(","center"!=a.posn&&"center center"!=a.posn&&(d+=
a.posn+", "),"circle"!=a.shape&&(d+=a.shape+", "),"farthest-corner"!=a.extent&&(d+=a.extent+", "),d+=b+")",a="(radial, center center, 10, center center, "+(k+")"),c.push("-webkit-gradient"+a),c.push("-o-radial-gradient"+d),c.push("-ms-radial-gradient"+d),c.push("-moz-radial-gradient"+d),c.push("-webkit-radial-gradient"+d),c.push("radial-gradient"+d)}return c}}})},"davinci/ui/widgets/FileFieldDialog":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin davinci/Workbench davinci/ui/widgets/OpenFile dijit/form/Button davinci/model/Path dojo/i18n!davinci/ui/nls/ui dojo/i18n!dijit/nls/common dojo/text!./templates/FileFieldDialog.html dijit/form/TextBox xide/views/_PanelDialog xide/utils xide/types xfile/views/FileGrid xfile/FileActions".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y){return p("davinci.ui.widgets.FileFieldDialog",[m,h,e],{templateString:d,widgetsInTemplate:!0,_fileSelectionDialog:null,_showFileSelectionDialog:function(){var a=this;this.ctx=b.ctx;y.createFilePicker(this,"",function(c){var b=u.buildPath(c.mount,c.path,!1);a.ctx.getFileManager().getImageUrl(c,!0,{oriPath:b});console.error(" file picker done ",b);a.textField.set("value",b);a._onChange()},n.selectFile,null,{mount:"workspace_user",selection:""},null,z)},_setBaseLocationAttr:function(a){this._baseLocation=
a},_setValueAttr:function(a){this.value!=a&&(this.value=a,this.textField.set("value",a))},_setDisabledAttr:function(a){this.textField.set("disabled",a);this.button.set("disabled",a);this.inherited(arguments)},_setIntermediateChangesAttr:function(a){this.textField.set("intermediateChanges",a);this.inherited(arguments)},_onChange:function(){var a=this.textField.get("value");this.value!=a&&(this.value=a,this.textField.set("value",this.value),this.onChange(a))},onChange:function(a){},_getValueAttr:function(){return this.textField.get("value")}})})},
"davinci/ui/widgets/OpenFile":function(){define("dojo/_base/declare dijit/_Templated dijit/_Widget davinci/library system/resource davinci/workbench/Preferences davinci/Runtime davinci/Workbench dijit/Menu dijit/MenuItem davinci/model/Path dijit/form/DropDownButton dojo/i18n!davinci/ui/nls/ui dojo/i18n!dijit/nls/common dojo/text!./templates/OpenFile.html dijit/form/Button dijit/form/TextBox dijit/form/RadioButton dijit/layout/ContentPane dijit/Tree".split(" "),function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,
r){return p("davinci.ui.widgets.OpenFile",[h,m],{widgetsInTemplate:!0,templateString:dojo.cache("davinci.ui.widgets","templates/OpenFile.html",'\x3cdiv class\x3d"fileDialog"\x3e\n\t\x3cdiv class\x3d"dijitDialogPaneContentArea folderContainer"\x3e\n\t\t\x3cdiv dojoType\x3d"dijit.layout.ContentPane" dojoAttachPoint\x3d"contentpane"\x3e\n\t\t\x3cdiv class\x3d"fileDialogTreeWidget" dojoAttachPoint\x3d"fileTree" dojoType\x3d"dijit.Tree" model\x3d"system.resource" persist\x3d"false" labelAttr\x3d"name" childrenAttrs\x3d"children" dojoAttachEvent\x3d"onDblClick:_onDblClick,onKeyPress:_onKeyPress"\x3e\x3c/div\x3e\n\t\t\x3c/div\x3e\n\t\x3c/div\x3e\n\t\n\t\x3cdiv class\x3d"dijitDialogPaneActionBar"\x3e\n\t\t\x3cbutton dojoType\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:_okButton" class\x3d"maqPrimaryButton" type\x3d"submit"\x3e${finishButtonLabel}\x3c/button\x3e\n\t\t\x3cbutton dojoType\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:_cancelButton" class\x3d"maqSecondaryButton"\x3e${cancelButtonLabel}\x3c/button\x3e\n\t\x3c/div\x3e\n\x3c/div\x3e\n'),
fileDialogFileName:null,fileDialogParentFolder:null,postMixInProperties:function(){dojo.mixin(this,q);dojo.mixin(this,u);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.fileTree.watch("selectedItem",dojo.hitch(this,this._updateFields));this._value||this._setValueAttr(this._getForcedRootAttr())},startup:function(){this.fileTree.startup()},_setValueAttr:function(a){a!=this._value&&(this._value=a,this.fileTree.set("selectedItems",[a]))},_getForcedRootAttr:function(){return this._forcedRoot||
b.findResource(g.getProject())},_setForcedRootAttr:function(a){this._forcedRoot=a},_updateFields:function(){var a=this.fileTree.get("selectedItems"),a=null!=a&&0<a.length?a[0]:null;dojo.attr(this._okButton,"disabled",!0);null!=a&&"File"==a.elementType&&dojo.attr(this._okButton,"disabled",!1)},_okButton:function(){this.value=this.fileTree.get("selectedItems")[0]},_onDblClick:function(a){this._okButton();this.onExecute()},_onKeyPress:function(a){a.which==dojo.keys.ENTER&&(this._okButton(),this.onExecute())},
_getValueAttr:function(){return this.value},_cancelButton:function(){this.onClose()},resize:function(a){this.contentpane.resize(a)},onExecute:function(){},onClose:function(){}})})},"davinci/ve/widgets/WidgetToolBar":function(){define("dojo/_base/declare dijit/_Templated dijit/_Widget davinci/Runtime davinci/workbench/ViewLite davinci/ve/commands/ModifyCommand dijit/form/ComboBox dijit/form/ValidationTextBox dijit/form/TextBox dojo/store/Memory dojo/i18n!davinci/ve/nls/ve dojo/i18n!dijit/nls/common davinci/ve/widget dojo/text!./templates/WidgetToolBar.html".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u){return p("davinci.ve.widgets.WidgetToolBar",[b,h,m],{templateString:u,widgetsInTemplate:!0,descNode:null,idTextBox:null,classComboBox:null,blockGroupComboBox:null,widgetDescStart:"",widgetDescUnselectEnd:"",_oldIDName:null,_oldClassName:null,_oldBlockGroup:null,veNLS:d,cssRules:null,postCreate:function(){this.idTextBox.validator=dojo.hitch(this,function(a,c){this.invalidMessage=null;if(!a||!this._widget||this.changing)return!0;var b=q.byId(a);return b&&b!==this._widget?
(this.invalidMessage=d.idAlreadyUsed,!1):!0});dojo.subscribe("/davinci/ui/widget/replaced",dojo.hitch(this,this._widgetReplaced));var a=this;this.subscribe("CSSRulesUpdated",function(c){a.cssRules=c.names;a.onWidgetSelectionChange()})},initialize:function(){if((this._editor=e.currentEditor)&&this._editor.visualEditor&&this._editor.visualEditor.context){var a=this._editor.visualEditor.context.getSelection();this._widget=0==a.length?null:a[0]}else this._widget=null;this.onWidgetSelectionChange()},cssSelect:null,
startup:function(){this.inherited(arguments);if(!this.cssSelect){this.cssSelect=$(this.cssClasses).selectize({delimiter:",",persist:!0,plugins:["restore_on_backspace"],createOnBlur:!0,dropdownParent:"body",create:function(a){return{value:a,text:a}}}).data().selectize;var a=this;this.cssSelect.on("change",function(){var c=a.cssSelect.getValue();if(a._widget&&!a.changing&&(a.context&&a.context.blockChange(!1),c=c.split(",").join(" "),c!==a._oldClassName)){a._oldClassName=c;var b={};b["class"]=c;c=new davinci.ve.commands.ModifyCommand(a._widget,
b,null);dojo.publish("/davinci/ui/widgetPropertiesChanges",[{source:a._editor.editor_id,command:c}])}})}},onEditorSelected:function(){this.initialize();this.domNode.style.display=this._editor&&"davinci.ve.HTMLPageEditor"==this._editor.editorID?"block":"none"},_widgetReplaced:function(a,c){this._widget===c&&(this._widget=a,this.onWidgetSelectionChange())},onWidgetSelectionChangeBak:function(){var a="";if(this._widget){a=q.getLabel(this._widget);this.context=this._widget.getContext();this.classComboBox.set("disabled",
!1);this.idTextBox.attr("disabled",!1);this.changing=!0;this._oldBlockGroup=this._oldClassName=this._oldIDName=null;dojo.addClass(this.domNode,"propertiesSelection");this.descNode.innerHTML=a;if(this._editor&&"davinci.ve.PageEditor"===this._editor.declaredClass&&(a=this._widget._srcElement)){var c=[],b=this._widget.getContext().getModel().getDocumentElement();if(b){var g={visit:function(a){"HTMLElement"==a.elementType&&"body"!=a.tag&&"html"!=a.tag&&(a=a.getAttribute("class"))&&(a=dojo.trim(a).split(" "),
dojo.forEach(a,dojo.hitch(this,function(a){-1==dojo.indexOf(this.classes,a)&&this.classes.push(a)})))},classes:[]};b.visit(g);dojo.forEach(g.classes,function(a){c.push({name:a})})}this.cssRules&&_.each(this.cssRules,function(a){_.find(c,{name:a})||c.push({name:a})});b=new f({data:c});this.classComboBox.set("store",b);a=(a=a.getAttribute("class"))&&dojo.trim(a)||"";this.cssSelect&&(_.each(c,function(a){this.cssSelect.addOption({value:a.name,text:a.name})},this),console.error("set "+a.split(" ").join(",")),
this.cssSelect.setValue(a.split(" "),!0));this.classComboBox.set("value",a);this._oldClassName=a;this._oldIDName=a=(a=this._widget.getId())&&dojo.trim(a)||"";this.idTextBox.attr("value",a);this._widget.domNode&&this._widget.domNode&&((a=this._widget.domNode.blockGroup)||(a=this._widget.domNode.getAttribute("blockGroup")),this._oldBlockGroup=a)}this.changing=!1}else this.descNode.innerHTML=d.noSelection,dojo.removeClass(this.domNode,"propertiesSelection"),this.context=null,this.classComboBox.set("value",
""),this.classComboBox.set("disabled",!0),this.idTextBox.attr("value",""),this.idTextBox.attr("disabled",!0)},onWidgetSelectionChange:function(){var a="";if(this._widget){a=q.getLabel(this._widget);this.context=this._widget.getContext();this.idTextBox.attr("disabled",!1);this.cssSelect&&this.cssSelect.enable();this.changing=!0;this._oldBlockGroup=this._oldClassName=this._oldIDName=null;dojo.addClass(this.domNode,"propertiesSelection");this.descNode.innerHTML=a;if(this._editor&&"davinci.ve.PageEditor"===
this._editor.declaredClass&&(a=this._widget._srcElement)){var c=[],b=this._widget.getContext().getModel().getDocumentElement();if(b){var f={visit:function(a){"HTMLElement"==a.elementType&&"body"!=a.tag&&"html"!=a.tag&&(a=a.getAttribute("class"))&&(a=dojo.trim(a).split(" "),dojo.forEach(a,dojo.hitch(this,function(a){-1==dojo.indexOf(this.classes,a)&&this.classes.push(a)})))},classes:[]};b.visit(f);dojo.forEach(f.classes,function(a){c.push({name:a})})}this.cssRules&&_.each(this.cssRules,function(a){_.find(c,
{name:a})||c.push({name:a})});a=(a=a.getAttribute("class"))&&dojo.trim(a)||"";this.cssSelect&&(_.each(c,function(a){this.cssSelect.addOption({value:a.name,text:a.name})},this),this.cssSelect.setValue(a.split(" "),!0));this._oldClassName=a;this._oldIDName=a=(a=this._widget.getId())&&dojo.trim(a)||"";this.idTextBox.attr("value",a);this._widget.domNode&&this._widget.domNode&&((a=this._widget.domNode.blockGroup)||(a=this._widget.domNode.getAttribute("blockGroup")),this._oldBlockGroup=a)}this.changing=
!1}else this.descNode.innerHTML=d.noSelection,dojo.removeClass(this.domNode,"propertiesSelection"),this.context=null,this.cssSelect&&this.cssSelect.disable(),this.cssSelect&&this.cssSelect.setValue([]),this.idTextBox.attr("value",""),this.idTextBox.attr("disabled",!0)},_onChangeIDAttribute:function(){if(this._widget&&!this.changing){var a=this.idTextBox;if(a&&a.isValid()&&(this.context&&this.context.blockChange(!1),a=a.attr("value"),a!==this._oldIDName)){this._oldIDName=a;var c={};c.id=a;a=new k(this._widget,
c,null);dojo.publish("/davinci/ui/widgetPropertiesChanges",[{source:this._editor.editor_id,command:a}])}}},_onChangeClassAttribute:function(){if(this._widget&&!this.changing){var a=this.classComboBox;if(a&&(this.context&&this.context.blockChange(!1),a=a.attr("value"),a!==this._oldClassName)){this._oldClassName=a;var c={};c["class"]=a;a=new davinci.ve.commands.ModifyCommand(this._widget,c,null);dojo.publish("/davinci/ui/widgetPropertiesChanges",[{source:this._editor.editor_id,command:a}])}}},_onChangeBlockGroupAttribute:function(){if(this._widget&&
!this.changing){var a=this.blockGroupComboBox;if(a&&(this.context&&this.context.blockChange(!1),a=a.attr("value"),a!==this._oldBlockGroup)){this._oldBlockGroup=a;var c={};c.blockGroup=a;a=new davinci.ve.commands.ModifyCommand(this._widget,c,null);this.publish("/davinci/ui/widgetPropertiesChanges",[{source:this._editor.editor_id,command:a}])}}},_onFieldFocus:function(){this.context&&this.context.blockChange(!0)},_onFieldBlur:function(){this.context&&this.context.blockChange(!1)},_onKeyPress:function(a){a.keyCode==
dojo.keys.ENTER&&this._onChangeIDAttribute()}})})},"davinci/workbench/ViewLite":function(){define(["dojo/_base/declare","./WidgetLite","../ve/States"],function(p,m){return p("davinci.workbench.ViewLite",[m],{_editor:null,_widget:null,_subWidget:null,constructor:function(h,e){this.subscriptions=[];this.publishing={};this.subscribe("/davinci/ui/editorSelected",dojo.hitch(this,this._editorSelected));this.subscribe("/davinci/ui/widgetSelected",dojo.hitch(this,this._widgetSelectionChanged))},_widgetSelectionChanged:function(h){if(this._editor)if(h.selection){var e=
h.selection[0];if(e&&this._widget==e&&this._subwidget==e.subwidget)return!1;this._subwidget=(this._widget=e)&&e.subwidget;if(this.onWidgetSelectionChange)this.onWidgetSelectionChange(h)}else console.error("have no selection")},_editorSelected:function(h){this._editor=h.editor;if(this.onEditorSelected)this.onEditorSelected(this._editor)},_subscribe:function(h,e){this.subscriptions.push(dojo.subscribe(h,this,e))},publish:function(h,e){this.publishing[h]=!0;try{dojo.publish(h,e)}catch(b){console.error(b)}delete this.publishing[h]},
destroy:function(){dojo.forEach(this.subscriptions,dojo.unsubscribe);delete this.subscriptions;this._destroyHandles()}})})},"davinci/ve/widgets/Cascade":function(){define("dojo/_base/declare ../../workbench/WidgetLite ../../workbench/Preferences ../../Workbench ../../html/CSSModel ../../library ../../Theme ../../html/CSSRule ../States dojo/i18n!../nls/ve system/resource".split(" "),function(p,m,h,e,b,k,a,g,n,f,d){p=p("davinci.ve.widgets.Cascade",[m],{target:null,targetField:null,toggleClasses:null,
_regex_combinators:/[\s\~\+\>]+/,_regex_not_pseudoclass:/(.*)\:not\((.*)\)(.*)/,_regex_pseudoelement:/(.*)(\:\:[^\:\.\#\[]*)(.*)/,_regex_id:/(.*)(\#[^\:\.\#\[]*)(.*)/,_regex_class:/(.*)(\.[^\:\.\#\[]*)(.*)/,_regex_attribute:/(.*)(\[[^\]]*\])(.*)/,_regex_pseudoclass:/(.*)(\:[^\:\.\#\[]*)(.*)/,_regex_univeral:/(.*)(\*[^\:\.\#\[]*)(.*)/,delegate:null,constructor:function(a,b){this.subscriptions=[];this.publishing={};this._radioGroupName="davinci_ve_widgets_Cascade"+davinci.ve.widgets.Cascade.__id++;
this._handles=[];this._values=[];this.inherited(arguments)},buildRendering:function(){this.domNode=dojo.doc.createElement("div");this.container=dojo.doc.createElement("div");dojo.addClass(this.container,"showCascade");this.domNode.appendChild(this.container);this.topDiv=dojo.create("div",{"class":"cascadeTopDiv"},this.container);this.cascadeTableDiv=dojo.create("div",{"class":"cascadeTableDiv widget"},this.container);dojo.removeClass(this.container,"showAllValues");dojo.isArray(this.target)||(this.target=
[this.target]);dojo.addClass(this.domNode,"CascadeTop");this.inherited(arguments)},startup:function(){var a=dijit.byId(this.targetField);if(a)a._cascade=this,this._getFieldValue=function(){return a.get("value")},this._setFieldValue=function(b,d){a.set&&(this._value=b||"",this._loc=d,a._setBaseLocationAttr&&a.set("baseLocation",d&&d.getPath?d.getPath():null),a.set("value",this._value,!0))},dojo.connect(a,"onChange",this,"_onFieldChange"),dojo.connect(a,"onFocus",this,"_onFieldFocus"),dojo.connect(a,
"onBlur",this,"_onFieldBlur");else{var b=dojo.byId(this.targetField);this._getFieldValue=function(){return dojo.attr(b,"value")};this._setFieldValue=function(a,c){this._value=a||"";this._loc=c;dojo.attr(b,"value",this._value)};dojo.connect(b,"onchange",this,"_onFieldChange",!0);dojo.connect(b,"onfocus",this,"_onFieldFocus",!0);dojo.connect(b,"onblur",this,"_onFieldBlur",!0)}this._value=this._getFieldValue();this._started=!0},_canModifyRule:function(a){return a&&a.getCSSFile?(a=a.getCSSFile())?!d.findResource(a.url).readOnly():
!0:!0},_onFieldChange:function(a){function b(){k&&p&&p[k]&&p[k].resolve()}function d(a){a._value=a._getFieldValue();a._valueArray=a._valueArrayNew;var c=a._valueArray&&dojo.isArray(a._valueArray)&&0<a._valueArray.length?a._valueArray:a._value;a._changeValue(a._targetValueIndex,c)}a=function(a,c){if(!a&&!c)return!0;if(!a&&c||a&&!c||a.length!=c.length)return!1;for(var b=0;b<a.length;b++)if(a[b]!==c[b])return!1;return!0};this.context&&this.context.blockChange(!1);if(!(this._value==this._getFieldValue()&&
a(this._valueArray,this._valueArrayNew)||1>this._values.length))if("(overrides)"==this._getFieldValue())this._setFieldValue&&this._setFieldValue("(overrides)",null);else if("number"==typeof this._targetValueIndex){var g=h.getPreferences("davinci.ve.editorPrefs",e.getProject());if(this._widget&&this.target&&0<this.target.length){var k=this.target[0];a=this._widget.getContext();var n;a&&(n=a.cascadeBatch);if(n){var m=n.askUserResponse;if(n.deferreds)var p=n.deferreds}}!1===m?(this._setFieldValue(this._value,
this._loc),b()):!0===m?(d(this),b()):(m=null,this._values[this._targetValueIndex].readOnly&&"davinci.themeEdit.ThemeEditor"!=this._editor.editorID?(m=f.propChangeCannotComplete+"\x3cbr\x3e\x3cbr\x3e"+dojo.string.substitute(f.toChangeProperty,["\x3ca href\x3d'app/docs/index.html#CreatingStyleRulesWithAppCss' target\x3d'_blank'\x3e"+f.creatingStyleRules+"\x3c/a\x3e"])+"\x3cbr/\x3e\x3cbr/\x3e",davinci.Workbench.showMessage(f.errorModifyingValue,m,{width:350},dojo.hitch(this,function(){b();return!0})),
n&&(n.askUserResponse=!1),this._setFieldValue(this._value,this._loc)):("theme"==this._values[this._targetValueIndex].type||"theme"==this._values[this._targetValueIndex].proposalTarget)&&g.cssOverrideWarn&&this._editor.supports("MultiPropTarget")?require(["davinci/ve/widgets/ChangeWillModify"],dojo.hitch(this,function(a){var c=new a;a=davinci.Workbench.showDialog({title:"",content:c,style:{width:350},okCallback:dojo.hitch(this,function(){n&&(n.askUserResponse=!0);d(this);b();c.checkbox.get("checked")&&
(g.cssOverrideWarn=!1,h.savePreferences("davinci.ve.editorPrefs",null,g))}),okLabel:null,hideCancel:null,submitOnEnter:!0});dojo.connect(a,"onCancel",dojo.hitch(this,function(){n&&(n.askUserResponse=!1);this._setFieldValue(this._value,this._loc);b();c.checkbox.get("checked")&&(g.cssOverrideWarn=!1,h.savePreferences("davinci.ve.editorPrefs",null,g))}))})):(d(this),b()))}},_changeValue:function(a,b){var d=void 0;this._whichStateInputElement&&this._whichStateInputElement.checked&&(d=this._whichState);
for(var f=this._values[a],g=[],e=0;e<this.target.length;e++)if(dojo.isArray(b))for(var k=0;k<b.length;k++){var h={};h[this.target[e]]=b[k];g.push(h)}else h={},h[this.target[e]]=b,g.push(h);this._dirtyCascadeList=!0;"element.style"==f.type?("position"==this.target[0]&&1==g.length&&("absolute"==g[0].position?(f=this.context.getPreference("absoluteWidgetsZindex"),g.push({"z-index":f})):g.push({"z-index":""})),dojo.publish("/davinci/ui/styleValuesChange",[{values:g,appliesTo:"inline",applyToWhichStates:d,
cascade:this}])):dojo.publish("/davinci/ui/styleValuesChange",[{values:g,appliesTo:f,applyToWhichStates:d}])},_getAttribStyleValue:function(){return this.context.getStyleAttributeValues(this._widget)},_getShortHands:function(){if(this._shorthands)return this._shorthands;this._shorthands=[];for(var a=0;a<this.target.length;a++)this._buildShortHands(this.target[a]);return this._shorthands},_buildShortHands:function(a){for(var d=!1,f=0;f<b.shorthand.length;f++)if(a==b.shorthand[f][0]){d=!0;break}if(d)for(a=
b.shorthand[f][1],d=0;d<a.length;d++){for(var g=!1,f=0;f<this._shorthands.length&&!g;f++)this._shorthands[f]==a[d]&&(g=!0);g||this._shorthands.push(a[d]);this._buildShortHands(a[d])}return this._shorthands},_onChangeOverride:function(a){alert(f.valueIsOverriden);return!1},_getSelector:function(a,b){var d=this.context.getThemeMeta();if(!d)return[];var f=d.loader.getType(a);if(d=d.metadata.getStyleSelectors(f,"Normal"))for(var g in d)for(f=0;f<d[g].length;f++)for(var e=0;e<b.length;e++)if(b[e]==d[g][f])return g},
_getMetaTargets:function(a,b){var d=this._getSelector(a,b);return this.context.getModel().getRule(d).filter(function(a){return a.getSelectorText()==d})},_getSelectionCssRules:function(a){this.context._cssCache=this.context._cssCache||{};var b=this.context.getSelection();if(!a&&!b.length)return{rules:null,matchLevels:null};var d=a||b[0].domNode||b[0],f=d.id+"_"+d.className;if(b.length){var g=this.context._cssCache[f]=this.context.model.getMatchingRules(d,!0);this.context.cssFiles&&this.context.cssFiles.forEach(function(a){a.getMatchingRules(d,
g.rules,g.matchLevels)});g.rules.forEach(function(a){var c=dojo.hitch(a,"onChange",this,function(){delete this.context._cssCache[f];connect.unsubscribe(c)})},this);return g}return{rules:null,matchLevels:null}},_getAllRules:function(){function a(c){if(c&&c.parent&&c.parent.url)return c=c.parent.url,/^themes\//.test(c)||/\/themes\//.test(c)?"theme":"queried"}var b=[];if("davinci.themeEdit.ThemeEditor"!=this._editor.editorID){var d=this._getDefaultSelection();if(this._editor.supports("inline-style")&&
"element.style"==d){for(var d=this._getAttribStyleValue(),f=null,g=0;g<d.length;g++)for(var e=d[g],k=0;k<this.target.length;k++){var h=this.target[k];void 0!==e[h]&&(f=e[h])}b.push({rule:d,value:f,matchLevel:"element.style",type:"element.style"})}if((d=this._getSelectionCssRules(this._topWidgetDom))&&d.rules)for(k=0;k<d.rules.length;k++){f="";g=d.rules[k];for(e=0;e<g.selectors.length;e++)0!=e&&(f+=", "),f+=g.selectors[e].getLabel();g=a(g);b.push({rule:d.rules[k],ruleString:f,matchLevel:d.matchLevels[k],
type:g})}this._addDeltaRules(this._widget,b);for(var d=this._getClasses(this._widget),n=0,k=0;k<d.length;k++){var m=d[k];"string"==typeof m&&0<m.length&&this._getClassSelector(m).forEach(function(a){for(var c=!1,d=0;d<b.length;d++)if(this._compareSelectors(b[d].ruleString,a)){b[d].className=m;c=!0;break}c||(c=this._computeMatchLevelSelector(a),b.splice(n,0,{rule:null,ruleString:a,targetFile:this.targetFile,className:m,value:null,matchLevel:c,type:"proposal"}),n++)}.bind(this))}}if("davinci.themeEdit.ThemeEditor"==
this._editor.editorID){if(d=this._editor._getCssRules(this._widget,this._editor._selectedSubWidget,this._editor._currentState)){k=[];for(f=d.length-1;-1<f;--f)k.push(d[f]);d=k}}else d=this._widget?this._getMetaTargets(this._widget,this.target):[];for(k=0;k<d.length;k++){f=!1;for(g=0;!f&&g<b.length;g++)b[g].rule==d[k]&&(f=!0,b[g].type="theme");f||b.push({rule:d[k],matchLevel:"theme",type:"theme"})}return b},_buildCssRuleset:function(){var a=this._getAllRules();this._values=[];this._hasOverride=!1;
for(var b=this._getShortHands(),d=0;d<a.length;d++){var f=a[d].rule;if(f){for(var g=0;g<b.length;g++)if("element.style"!=a[d].type&&null!=a[d].rule.getProperty(b[g])){a[d].shorthand=b[g];var e=f.getProperty(b[g]);a[d].value=e&&e.value;this._hasOverride=!0}else"element.style"==a[d].type&&-1<dojo.indexOf(a[d].rule,b[g])&&(a[d].shorthand=b[g],e=dojo.indexOf(a[d].rule,b[g]),a[d].value=f[e],this._hasOverride=!0);if(!a[d].shorthand&&"element.style"!=a[d].type)a[d].value=this._getRuleTargetValue(f);else if(!a[d].shorthand&&
"element.style"==a[d].type)for(g=0;g<f.length;g++)f[g].hasOwnProperty(this.target[0])&&(a[d].value=f[g][this.target[0]])}}a=this._sortRules(a);this._addClasses(a);this._values=a},_sortRules:function(a){for(var b=[],d=0;d<a.length;d++){var f=!1;"element.style"==a[d].type&&(b.splice(0,0,a[d]),f=!0);for(var g=0;!f&&g<b.length;g++)"element.style"!=b[g].matchLevel&&b[g].matchLevel<a[d].matchLevel&&(f=!0,b.splice(g,0,a[d]));f||b.push(a[d])}return b},_addClasses:function(a){for(var b=!1,d=0;d<a.length;d++)a[d].extraClass=
[],b&&a[d].extraClass.push("cssShorthandOverRidden"),a[d].value||"element.style"!=a[d].type&&this._getRuleTargetValue(a[d].rule)?b=!0:a[d].value||"element.style"==a[d].type||a[d].extraClass.push("hiddenCascadeNode"),"element.style"!=a[d].type||a[d].value||a[d].extraClass.push("elementStyleNode"),this._canModifyRule(a[d].rule)||(a[d].extraClass.push("readOnlyRule"),a[d].readOnly=!0)},_updateCascadeList:function(){function a(c){return function(){return this._onChange({target:c})}}function b(a){return function(){return this._onChangeRemove({target:a})}}
this._setFieldValue&&this._setFieldValue("",null);if(this._widget&&this._widget.domNode){dojo.removeClass(this.container,"dijitHidden");this._buildCssRuleset();this._destroy();var d=dojo.doc.createElement("table");dojo.addClass(d,"cascadeTable");var g=null,e=null,g=dojo.doc.createElement("tr");g.className="propApplyToLabelRow";e=dojo.doc.createElement("td");e.colSpan="3";e.innerHTML=f.applyToWhich;e.className="propApplyToLabelCell";g.appendChild(e);d.appendChild(g);this._radio=[];for(var k=0;k<this._values.length;k++){var h=
this._formatRuleString(this._values[k]);this._radio.push(dojo.create("input",{type:"radio",name:this._radioGroupName}));for(var g=dojo.doc.createElement("tr"),m=0;m<this._values[k].extraClass.length;m++)dojo.addClass(g,this._values[k].extraClass[m]);e=dojo.doc.createElement("td");g.appendChild(e);dojo.addClass(e,"cascadeSpacer");e=dojo.doc.createElement("td");dojo.addClass(e,"cascadeButton");e.appendChild(this._radio[this._radio.length-1]);g.appendChild(e);e=dojo.doc.createElement("td");dojo.addClass(e,
"cascadText");e.innerHTML="\x3cdiv class\x3d'cascadeRuleText'\x3e"+h+"\x3c/div\x3e";this._values[k].shorthand?this._handles.push(dojo.connect(this._radio[this._radio.length-1],"onclick",this,"_onChangeOverride")):this._handles.push(dojo.connect(this._radio[this._radio.length-1],"onclick",this,a(k)));if(this._values[k].shorthand)e.innerHTML+="\x3cdiv\x3e"+this._values[k].shorthand+":"+this._values[k].value+";\x3c/div\x3e";else if(this._values[k].value){for(m=0;m<this.target.length;m++);e.innerHTML+=
"\x3cdiv class\x3d'ruleValue'\x3e"+this.target[0]+":"+this._values[k].value+";\x3c/div\x3e"}g.appendChild(e);e=dojo.doc.createElement("td");dojo.addClass(e,"cascadRemove");h=dojo.doc.createElement("button");this._values[k].readOnly&&dojo.attr(h,"disabled","true");dojo.addClass(h,"cascadeRemoveButton");e.appendChild(h);this._handles.push(dojo.connect(h,"onclick",this,b(k)));g.appendChild(e);e=dojo.doc.createElement("td");e.className="cascadeSpacer";g.appendChild(e);d.appendChild(g)}this._widgetState=
this._whichStateInputElement=void 0;g=n.getStatesListCurrent(this._widget.domNode);for(k=0;k<g.length;k++)if(g[k]){k=g[k];g=dojo.doc.createElement("tr");g.className="propWhichStateRow";e=dojo.doc.createElement("td");e.colSpan="3";h=dojo.create("input",{type:"checkbox",checked:!1,className:"propWhichStateInput"});this._whichState=k;this._whichStateInputElement=h;e.appendChild(h);h=dojo.create("label",{className:"propWhichStateLabel"});h.innerHTML=dojo.string.substitute(f.onlyApplyToState,[k]);e.appendChild(h);
e.className="propWhichStateCell";g.appendChild(e);d.appendChild(g);break}this.cascadeTableDiv.appendChild(d);this._updateFieldValue()}else dojo.addClass(this.container,"dijitHidden")},selectRule:function(a){for(var b=0;b<this._values.length;b++)if("element.style"!=a&&this._values[b].rule==a){dojo.removeClass(this._radio[b].parentNode.parentNode,"hiddenCascadeNode");dojo.attr(this._radio[b],"checked",!0);this._onChange({target:b});break}else if("element.style"==a&&"element.style"==this._values[b].type){dojo.removeClass(this._radio[b].parentNode.parentNode,
"hiddenCascadeNode");dojo.attr(this._radio[b],"checked",!0);this._onChange({target:b});break}},selectRuleBySelector:function(a){if("element.style"==a)this._targetValueIndex=0,0<this._values.length&&(dojo.attr(this._radio[0],"checked",!0),this._values[0].shorthand?dojo.addClass(this._radio[0].parentNode.parentNode,"cssShorthandOverRidden"):(a=this._getBaseLocation(),this._setFieldValue(this._values[0].value,a)));else for(var b=0;b<this._values.length;b++)if("element.style"!=this._values[b].type&&this._values[b].rule&&
this._values[b].rule.hasSelector(a)){dojo.removeClass(this._radio[b].parentNode.parentNode,"hiddenCascadeNode");dojo.attr(this._radio[b],"checked",!0);this._onChange({target:b});break}},_isTarget:function(a){if("$std_10"===a)return!0;for(var b=0;b<this.target.length;b++)if(this.target[b]==a)return!0;return!1},_targetIsRootProperty:function(){for(var a=["left","top","right","bottom"],b=0;b<this.target.length;b++)if(-1<a.indexOf(this.target[b]))return!0;return!1},_updateFieldValue:function(){null==
this._widget&&this._setFieldValue("",this._getBaseLocation());var a=this._getDefaultSelection();this._targetValueIndex=0;for(var b=!1,d=!1,f=0;f<this._values.length;f++){var g="davinci.ve.HTMLPageEditor"==this._editor.editorID,e="davinci.themeEdit.ThemeEditor"==this._editor.editorID;this._values[f].value&&!b&&e||this._values[f].value&&!b&&g&&!this._values[f].readOnly||!b&&!d&&"element.style"!=this._values[f].type&&this._values[f].rule&&this._values[f].rule.hasSelector(a)||"element.style"==a&&"element.style"==
this._values[f].type?(this.selectRule("element.style"==this._values[f].type?"element.style":this._values[f].rule),this._values[f].value&&(b=!0),d=!0):b&&!d&&dojo.addClass(this._radio[f].parentNode.parentNode,"cssOverRidden")}b||d||!g||this.selectRuleBySelector("element.style")},_getThemeMetaDataByWidget:function(c){var b=this.context.getThemeMeta();if(!b)return null;c=b.loader.getType(c);var b=b.loader.getMetaData(c),d=!1,f="string"==typeof c?c.split("."):null;f&&"html"==f[0]&&(d=!0);if(!b&&this.context.cssFiles&&
!d)for(d=0;d<this.context.cssFiles.length;d++)if(f=a.getThemeByCssFile(this.context.cssFiles[d]))if(b=k.getThemeMetadata(f).loader.getMetaData(c))break;return b},_getDefaultSelection:function(){var a="Normal";"davinci.themeEdit.ThemeEditor"==this._editor.editorID&&(a=a||n.getState());var b=this._getThemeMetaDataByWidget(this._widget);if(!b||!b.states||this._targetIsRootProperty())return"element.style";if(b&&b.states[a]&&b.states[a].elements){var d=b.states[a].elements,f;for(f in d)for(var g=0;g<d[f].length;g++)if(this._isTarget(d[f][g]))return"$root"==
f?"element.style":f}if(b&&b.states[a]&&(d=this.context.getThemeMeta())&&(g=d.loader.getType(this._widget),d=d.metadata.getStyleSelectors(g,a,null)))for(f in d)for(a=0;a<d[f].length;a++)if(this._isTarget(d[f][a])){if(b.rootSelectors)for(a=0;a<b.rootSelectors.length;a++)if(f==b.rootSelectors[a])return"element.style";return f}return null},_addDeltaRules:function(a,b){var f="Normal",g=-1,e=[],k=this.context._getCssFiles(),k=k&&0<k.length?k[0].url:null,h=!1;k&&(h=(h=d.findResource(k))?h._readOnly:!0);
"davinci.themeEdit.ThemeEditor"==this._editor.editorID&&(f=f||n.getState());var m=this._getThemeMetaDataByWidget(a);if(m&&m.states[f]&&m.states[f].selectors){var f=m.states[f].selectors,p;for(p in f){f=!1;for(m=0;m<b.length;m++){var v=b[m];"element.style"===v.type&&(g=m);if("theme"===v.type&&v.ruleString===p&&(v.rule.parent.relativeURL==this.context._themeUrl||v.rule.parent.url==k)){f=!0;break}}f||(f=this._computeMatchLevelSelector(p),k&&!h&&e.push({rule:null,ruleString:p,targetFile:k,className:null,
value:null,matchLevel:f,type:"proposal"}),this.context._themeUrl&&!this.context.theme.getFile().readOnly()&&e.push({rule:null,ruleString:p,targetFile:this.context._themeUrl,className:null,value:null,matchLevel:f,type:"proposal",proposalTarget:"theme"}))}}var A=g+1;e.forEach(function(a){b.splice(A++,0,a)});return b},_getRuleTargetValue:function(a){var b=null;if(a)for(var d=0;!b&&d<this.target.length;d++)b=a.getProperties(this.target[d]);if(null!=b){if(1<b.length){a=[];for(d=0;d<b.length;d++)a.push(b[d].value);
return a}if(1==b.length)return b[0].value}return null},_onChangeRemove:function(a){this._changeValue(a.target,null);this._updateCascadeList()},_onChange:function(a){var b=null;if("element.style"==this._values[a.target].type)b=this._getBaseLocation();else if("proposal"==this._values[a.target].type){var f=this.context.getModel().find({elementType:"CSSFile",relativeURL:this._values[a.target].targetFile},!0),g=this.context._getCssFiles();f?b=d.findResource(f.url):g[0].url==this._values[a.target].targetFile&&
(b=d.findResource(g[0].url))}else b=d.findResource(this._values[a.target].rule.getCSSFile().url);this._setFieldValue&&this._setFieldValue(this._values[a.target].value||"",b);this._targetValueIndex=a.target},_widgetValuesChanged:function(a){if(this._dirtyCascadeList)this._updateCascadeList(),this._dirtyCascadeList=!1;else{var b=this._getShortHands();a=a.values;for(var d in a)for(a=0;a<b.length;a++)if(b[a]==d){this._updateCascadeList();return}}},_formatRuleString:function(a){if("element.style"==a.type)return"element.style";
var b="";if("proposal"==a.type)b=a.className?b+dojo.string.substitute(f.newRule,[a.className,a.targetFile]):b+dojo.string.substitute(f.newThemeRule,[a.targetFile]),b+=a.ruleString;else{var d=a.rule;a.className?b+=dojo.string.substitute(f.existingRule,[a.className,this.targetFile]):"theme"==a.type&&(b+="["+a.type+"] ");if(a.ruleString)b+=a.ruleString;else for(var g=0;g<d.selectors.length;g++)0!=g&&(b+=", "),b+=d.selectors[g].getLabel();(g=d.searchUp("CSSFile"))&&(b+="  ("+g.url||g.relativeURL);b=a.property?
b+dojo.string.substitute(f.line,[a.property.startLine]):b+dojo.string.substitute(f.line,[d.startLine||f.propUndefined])}return b},_getWidgetTopDom:function(a,b){var d=this._getSelector(a,b),f=function(a,c){if(c.matches(a))return a;for(;0<a.children.length;)return f(a.children[0],c)};if(d){var e=new g;e.setText(d+"{}");return f(a.domNode||a,e)}return null},_widgetSelectionChanged:function(a){(this._widget=a=a[0])?(this.context=a.getContext(),this.targetFile=this.context.getAppCssRelativeFile(),this._editor=
this.context.editor,this._topWidgetDom=this._getWidgetTopDom(this._widget,this.target)||this._widget.domNode||this._widget):this._topWidgetDom=null;this._updateCascadeList()},_getBaseLocation:function(){return{}},_editorSelected:function(a){this._editor=a.editor;var b;this._editor&&this._editor.getContext&&(b=this._editor.getContext());b&&this._editor.supports("style")?(this.context=b,this.targetFile=b.getAppCssRelativeFile(),a=b.getSelection(),0<a.length?this._widgetSelectionChanged(a):this._widgetSelectionChanged([])):
(this._widget=this.context=null,this._setFieldValue&&this._setFieldValue("",null));this._updateCascadeList()},_onFieldFocus:function(){this.context&&this.context.blockChange(!0)},_destroy:function(){var a=this.cascadeTableDiv;for(dojo.forEach(dojo.query("[widgetId]",a).map(dijit.byNode),function(a){a.destroy()});a.firstChild;)dojo._destroyElement(a.firstChild);dojo.forEach(this._handles,dojo.disconnect);this._handles=[]},_onFieldBlur:function(){this.context&&this.context.blockChange(!1)},_getClasses:function(a){a=
a.getClassNames("class")||"";a=a.split(" ");for(var b=0;b<a.length;b++)for(var d=b+1;d<a.length;d++)a[d]==a[b]&&a.splice(d,1);return a},_getRelativeMetaTargetSelector:function(a){var b=this.context.getThemeMeta();if(!b)return[];var d=this.context.getSelection();if(!d.length)return[];d=d[0];d=b.loader.getType(d);return b.metadata.getRelativeStyleSelectorsText(d,"Normal",null,a,this.context.getTheme().className)},_getClassSelector:function(a){var b=this._getRelativeMetaTargetSelector(this.target),b=
b.length?b[0]:"";bodyId=this.context.model.find({elementType:"HTMLElement",tag:"body"},!0).find({elementType:"HTMLAttribute",name:"id"},!0).value;var d=this.context.getTheme(),f=[];if(!d)return f;var g=d.className;b.split(",").forEach(function(b){b=b.trim();f.push("#"+bodyId+"."+g+" ."+a+b)}.bind(this));return f},_computeMatchLevelSelector:function(a){a=a.split(this._regex_combinators);for(var b=0,d=0;d<a.length;d++){for(var f=a[d];;){var g=f.match(this._regex_not_pseudoclass);if(null!=g)b+=this._computeMatchLevelSimpleSelector(g[2]),
f=g[1]+g[3];else break}b+=this._computeMatchLevelSimpleSelector(f)}return b},_computeMatchLevelSimpleSelector:function(a){var b=0;do{var d=function(d,g){var e=a.match(d);null!=e&&(f=!0,b+=g,a=e[1]+e[3])},f=!1;d(this._regex_pseudoelement,1);f||(d(this._regex_id,100),d(this._regex_class,10),d(this._regex_attribute,10),d(this._regex_pseudoclass,10),d(this._regex_univeral,0))}while(f);0<a.length&&(b+=1);return b},_compareSelectors:function(a,b){if(!(a&&b||a==b))return!1;var d=a.split(this._regex_combinators),
f=b.split(this._regex_combinators);if(d.length!=d.length)return!1;for(var g=0;g<d.length;g++)if(d[g]!=f[g])return!1;return!0},_compareSimpleSelectors:function(a,b){}});return dojo.mixin(p,{__id:0})})},"davinci/ve/widgets/ChangeWillModify":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/i18n!../nls/ve dojo/i18n!davinci/ui/nls/ui dojo/text!./templates/ChangeWillModify.html dijit/form/CheckBox".split(" "),function(p,m,h,e,b,k,a){return p([m,
h,e],{templateString:a,langObj:b,uiNLS:k,buildRendering:function(){this.insteadOfChanging=dojo.string.substitute(b.insteadOfChanging,["\x3ca href\x3d'app/docs/index.html#CreatingStyleRulesWithAppCss' target\x3d'_blank'\x3e"+b.creatingStyleRules+"\x3c/a\x3e"]);this.inherited(arguments)},postCreate:function(){}})})},"davinci/ve/widgets/CommonProperties":function(){define(["dojo/_base/declare","davinci/workbench/ViewLite","davinci/ve/commands/ModifyCommand"],function(p,m,h){return p("davinci.ve.widgets.CommonProperties",
[m],{buildRendering:function(){var e=["title"],b;b="\x3ctable width\x3d'100%' class\x3d'property_table_stretchable' border\x3d'0' cellspacing\x3d'0' cellpadding\x3d'0'\x3e\x3ccolgroup\x3e\x3ccol style\x3d'width:15px;' /\x3e";b+="\x3ccol class\x3d'gap02' /\x3e";b+="\x3ccol class\x3d'gap03' /\x3e";b+="\x3ccol style\x3d'width:15px;' /\x3e";b+="\x3c/colgroup\x3e";var k=0;this._boxes={};for(var a=0;a<e.length;a++)this._boxes[e[a]]={value:""},this._boxes[e[a]].id="davinci_properties_event_"+k++ +"_combo",
b+="\x3ctr\x3e",b+="\x3ctd/\x3e",b+="\x3ctd class\x3d'propertyDisplayName'\x3e",b+=e[a]+":",b+="\x3c/td\x3e",b+="\x3ctd\x3e",b+="\x3cinput type\x3d'text' id\x3d'"+this._boxes[e[a]].id+"'\x3e\x3c/input\x3e",b+="\x3c/td\x3e",b+="\x3ctd/\x3e",b+="\x3c/tr\x3e";b+="\x3c/table\x3e";this.domNode=dojo.doc.createElement("div");this.domNode.innerHTML=b;dojo.subscribe("/davinci/ui/widgetValuesChanged",dojo.hitch(this,this.onWidgetSelectionChange));dojo.subscribe("/davinci/ui/widget/replaced",dojo.hitch(this,
this._widgetReplaced));this.inherited(arguments)},onEditorSelected:function(e){this._editor&&this._editor.getContext?(this.context=this._editor.getContext(),this._setValues()):(this.context=this._widget=this._subwidget=null,this._clearValues())},startup:function(){function e(b){return function(){return this._onChange({target:b})}}this.inherited(arguments);for(var b in this._boxes)this._boxes[b].domNode=dojo.byId(this._boxes[b].id),dojo.connect(this._boxes[b].domNode,"onchange",this,e(b)),dojo.connect(this._boxes[b].domNode,
"onfocus",this,"_onFocus"),dojo.connect(this._boxes[b].domNode,"onblur",this,"_onBlur")},_onFocus:function(){this.context&&this.context.blockChange(!0)},_onBlur:function(){this.context&&this.context.blockChange(!1)},_onChange:function(e){e=e.target;var b=dojo.attr(this._boxes[e].domNode,"value");this.context&&this.context.blockChange(!1);if(this._boxes[e].value!=b){this._boxes[e].value=b;var k={};k[e]=b;e=new h(this._widget,k,null);dojo.publish("/davinci/ui/widgetPropertiesChanges",[{source:this._editor.editor_id,
command:e}])}},_widgetReplaced:function(e,b){this._widget===b&&(this._widget=e,this.onWidgetSelectionChange())},onWidgetSelectionChange:function(){this._widget?(this._setValues(),this.set("readOnly",!1)):(this.set("readOnly",!0),this._clearValues())},_clearValues:function(){for(name in this._boxes)this._boxes[name].domNode&&dojo.attr(this._boxes[name].domNode,"value",""),this._boxes[name].value=null},_setValues:function(){if(this._widget)for(var e in this._boxes){var b=this._widget,k=this._boxes[e];
k.domNode&&k.domNode.ownerDocument&&(b.getPropertyValue?(b=b.getPropertyValue(e),k.value!=b&&(k.value=b,dojo.attr(k.domNode,"value",k.value))):(k.value="",dojo.attr(k.domNode,"value","")))}}})})},"davinci/ve/widgets/WidgetProperties":function(){define("dojo/_base/declare dojo/_base/connect davinci/workbench/ViewLite davinci/ve/metadata davinci/commands/CompoundCommand davinci/ve/commands/ModifyCommand ./HTMLStringUtil dijit/form/DateTextBox dijit/form/TimeTextBox xide/types xide/factory".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d){return p("davinci.ve.widgets.WidgetProperties",[h],{key:"widgetSpecific",_connects:null,buildRendering:function(){this.domNode=this.propDom=dojo.doc.createElement("div");dojo.addClass(this.domNode,"propGroup");dojo.attr(this.domNode,"propGroup",this.key);this._connects=[];this.inherited(arguments)},onWidgetSelectionChange:function(){if(this._widget&&this._editor&&"davinci.ve.HTMLPageEditor"==this._editor.editorID){var a=davinci.ve.metadata.query(this._widget),b=this._widget.getParent();
if(b&&b.isWidget&&(b=e.query(b))&&b.childProperties)if(a.$ownproperty)for(var d in b.childProperties)a.$ownproperty[d]=b.childProperties[d];else a.$ownproperty=b.childProperties;if(a&&a.$ownproperty){this._disconnectAll();this._destroyProperties();b={};a.$ownproperty.title||(b.title={datatype:"string"});for(d in a.$ownproperty)b[d]=a.$ownproperty[d];a=this.propDom.innerHTML=this._createWidgetRows(b);-1===a.indexOf("data-dojo-type")&&-1===a.indexOf("dojoType")||dojo.parser.parse(this.propDom);this._setValues();
this._connectAll()}}else this._disconnectAll(),this._destroyProperties()},onEditorSelected:function(a){if((this._editor=a)&&"davinci.ve.HTMLPageEditor"==a.editorID){if(this.context=a.getContext())this._widget=this.context.getSelection()[0]}else this._widget=this.context=null;this.onWidgetSelectionChange()},_createWidgetRows:function(b){this._pageLayout=[];for(var d in b){var f=b[d];if(!f.hidden){var g={display:f.title||d,type:f.datatype,format:f.format,target:d,hideCascade:!0,data:f};if(f.dropdownQueryValues&&
f.dropdownQueryAttribute){var e=[];dojo.forEach(f.dropdownQueryValues,dojo.hitch(this,function(a){a=dojo.query(a,this.context.rootNode);dojo.forEach(a,function(a){e.push(a.getAttribute(f.dropdownQueryAttribute))})}));g.values=e;g.type="comboEdit"}if(dojo.isArray(f.mustHaveAncestor)){for(var k=!1,h=this._widget;!k&&h&&h.getParent()!=this.context.rootWidget;)(h=h.getParent())&&-1<dojo.indexOf(f.mustHaveAncestor,h.type)&&(k=!0);k||(g.disabled=!0)}this._pageLayout.push(g);f.option&&(this._pageLayout[this._pageLayout.length-
1].values=dojo.map(f.option,function(a){return a}),this._pageLayout[this._pageLayout.length-1].type=f.unconstrained?"comboEdit":"combo")}}return a.generateTable(this._pageLayout)},_destroyProperties:function(){var a=this.propDom;for(dojo.forEach(dojo.query("[widgetId]",a).map(dijit.byNode),function(a){a.destroy()});a.firstChild;)dojo._destroyElement(a.firstChild)},_connectAll:function(){function a(b){return function(){return this._onChange({target:b})}}for(var b=0,g=this._pageLayout.length;b<g;b++){var e=
this._pageLayout[b],k=dijit.byId(e.id),h=k||dojo.byId(e.id),n=k?"onChange":"change",m=k?"onFocus":"focus",p=k?"onBlur":"blur";h?(h.pageIndex=b,this._connect(h,n,this,a(b)),this._connect(h,m,this,"_onFieldFocus"),this._connect(h,p,this,"_onFieldBlur"),h.owner=this,h.row=b,d.publish(f.EVENTS.WIDGET_PROPERTY_RENDERED,{view:this,row:e,widget:k,node:h},this)):console.error("cant find "+e.id+" node",e)}},_connect:function(a,b,d,f,g){this._connects.push(m.connect.apply(null,arguments))},_disconnectAll:function(){this._connects.forEach(m.disconnect);
this._connects=[]},_onChange:function(a){a=this._pageLayout[a.target];var d=dijit.byId(a.id),f;this.context&&this.context.blockChange(!1);d?(f=d.get("value"))&&f instanceof Date&&(d instanceof g?f=f.toISOString().substring(0,10):d instanceof n&&(f="T"+f.toTimeString().substring(0,8))):(f=dojo.byId(a.id),f=dojo.attr(f,"checkbox"===f.type?"checked":"value"));if(a.value!=f){a.value=f;d={};d[a.target]=f;a=new b;f=new k(this._widget,d,null);a.add(f);if((d=this._widget.getHelper())&&d.onWidgetPropertyChange)d.onWidgetPropertyChange({widget:this._widget,
compoundCommand:a,modifyCommand:f});dojo.publish("/davinci/ui/widgetPropertiesChanges",[{source:this._editor.editor_id,compoundCommand:a,command:f}])}},_onFieldFocus:function(){this.context&&this.context.blockChange(!0)},_onFieldBlur:function(){this.context&&this.context.blockChange(!1)},_setValues:function(){try{for(var a=0,b=this._pageLayout.length;a<b;a++){var d=this._pageLayout[a],f=dojo.byId(d.id);if(f){var g=this._widget,e=d.target,k;k="_children"===e?(k=g.getChildrenData())&&1===k.length?k[0]:
g.getPropertyValue(e):g.getPropertyValue(e);if(k&&k.toISOString){var h=g.metadata.property[e].format;h&&("date"==h?k=k.toISOString().substring(0,10):"time"==h&&(k="T"+k.toTimeString().substring(0,8)))}if(d.value!=k){d.value=k;var n="boolean"===d.type?"checked":"value",m=dijit.byId(d.id);m?m.attr(n,d.value):dojo.attr(f,n,d.value)}}}}catch(p){debugger}}})})},"davinci/ve/widgets/EventSelection":function(){define("dojo/_base/declare dojo/_base/connect dojo/dom-class system/resource davinci/Runtime davinci/Workbench davinci/model/Path ../../workbench/Preferences ../../workbench/ViewLite ../commands/EventCommand ./HTMLStringUtil ../States xide/types".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q){var u=/^State:.*/,r=/^\s*davinci\.states\.setState\s*\(\s*([\'"])((?:(?!\1).)*)\1\s*\)\s*$/,z=/^File:.*/,y=/^\s*location\.href\s*\=\s*([\'"])((?:(?!\1).)*)\1\s*$/,B=function(a){a&&c.getAllStateContainers(a);return[""]},x=function(a){a&&a.match(u)&&(a=a.substring(6),a="davinci.states.setState('"+("Background"==a?"Normal":a)+"')");a&&a.match(z)&&(a="location.href\x3d'"+a.substring(5)+"'");return a},w=function(a){var b;a&&((b=a.match(r))&&(a="State:"+b[2]),(b=a.match(y))&&
(a="File:"+b[2]));return a};p=p("davinci.ve.widgets.EventSelection",[n],{pageTemplate:[{display:"onclick",target:"onclick",type:"state",hideCascade:!0},{display:"ondblclick",target:"ondblclick",type:"state",hideCascade:!0},{display:"onmousedown",target:"onmousedown",type:"state",hideCascade:!0},{display:"onmouseup",target:"onmouseup",type:"state",hideCascade:!0},{display:"onmouseover",target:"onmouseover",type:"state",hideCascade:!0},{display:"onmousemove",target:"onmousemove",type:"state",hideCascade:!0},
{display:"onmouseout",target:"onmouseout",type:"state",hideCascade:!0},{display:"onkeypress",target:"onkeypress",type:"state",hideCascade:!0},{display:"onkeydown",target:"onkeydown",type:"state",hideCascade:!0},{display:"onkeyup",target:"onkeyup",type:"state",hideCascade:!0},{display:"onfocus",target:"onfocus",type:"state",hideCascade:!0},{display:"onblur",target:"onblur",type:"state",hideCascade:!0},{display:"onchange",target:"onchange",type:"state",hideCascade:!0}],buildRendering:function(){this.domNode=
dojo.doc.createElement("div");this.domNode.innerHTML=d.generateTable(this.pageTemplate,{zeroSpaceForIncrDecr:!0});h.add(this.domNode,"EventSelection");this.inherited(arguments)},setReadOnly:function(a){for(var b=0;b<this.pageTemplate.length;b++){var c=this.pageTemplate[b].widget;c?c.set("readOnly",a):(c=this.pageTemplate[b].domNode)&&dojo.attr(c,"disabled",a)}},startup:function(){function a(b){return function(){return this._onChange({target:b})}}this.inherited(arguments);for(var b=0;b<this.pageTemplate.length;b++){var c=
dijit.byId(this.pageTemplate[b].id);this.pageTemplate[b].widget=c;m.connect(c,"onChange",this,a(b))}this._buildSelectionValues();this.subscribe("/davinci/ui/context/loaded",dojo.hitch(this,this._buildSelectionValues));this.subscribe("/davinci/states/stored",dojo.hitch(this,this._buildSelectionValues));this.subscribe("/davinci/states/state/added",dojo.hitch(this,this._buildSelectionValues));this.subscribe("/davinci/states/state/removed",dojo.hitch(this,this._updateValues));this.subscribe("/davinci/states/state/renamed",
dojo.hitch(this,this._updateValues));this.subscribe("/davinci/ui/widgetPropertiesChanged",dojo.hitch(this,this._widgetPropertiesChanged));this.publish(q.EVENTS.ON_EVENT_SELECTION_RENDERED,{eventSelection:this,pageTemplate:this.pageTemplate});this.setReadOnly(!0)},onEditorSelected:function(){this._editor&&this._editor.supports("states")||delete this._editor;this._buildSelectionValues()},_onChange:function(a){a=a.target;var b=dijit.byId(this.pageTemplate[a].id),c=b.get("value"),c=x(c),d={};d[this.pageTemplate[a].target]=
c;d=new f(this._widget,d);dojo.publish("/davinci/ui/widgetPropertiesChanges",[{source:this._editor.editor_id,command:d}]);this.publish(q.EVENTS.ON_WIDGET_PROPERTY_CHANGED,{widget:b,editor:this._editor,eventSelection:this,pageTemplate:this.pageTemplate,widgetProperty:this.pageTemplate[a].target,value:c,target:this._widget})},_getRoot:function(){var a=this._editor,b;a&&a.getContext&&(b=(a=a.getContext())&&a.rootNode);return b},_updateValues:function(a){a&&a.node&&a.node._dvWidget&&(a=(a=a.node._dvWidget.getContext())&&
a.editor)&&a==b.currentEditor&&(this._buildSelectionValues(),this._widget&&this._setValues())},onWidgetSelectionChange:function(){this._widget?(this._setValues(),this.setReadOnly(!1)):(this.setReadOnly(!0),this._clearValues())},_clearValues:function(){for(var a=0;a<this.pageTemplate.length;a++)dijit.byId(this.pageTemplate[a].id).set("value","",!1)},_buildSelectionValues:function(){for(var a=this._getRoot(),a=B(a),b=0;b<this.pageTemplate.length;b++){var c=dijit.byId(this.pageTemplate[b].id);c.store.clearValues();
c.store.setValues(a)}},_setValues:function(){for(var a=0;a<this.pageTemplate.length;a++){var b=this.pageTemplate[a].target,c=this._widget,d="";c.properties&&c.properties[b]?d=c.properties[b]:c._srcElement&&(d=c._srcElement.getAttribute(b));d=w(d);(b=dijit.byId(this.pageTemplate[a].id))&&b.set("value",d,!1)}},_widgetPropertiesChanged:function(a){this._updateValues({widget:a[0]})}});p.getEventSelectionValues=B;p.getEventScriptFromValue=x;p.getValueFromEventScript=w;return p})},"davinci/actions/UndoAction":function(){define(["dojo/_base/declare",
"./Action","../Workbench"],function(p,m,h){return p("davinci.actions.UndoAction",m,{run:function(e){(e=h.getOpenEditor())&&e.getContext&&e.getContext().getCommandStack().undo()},isEnabled:function(e){var b=(e=h.getOpenEditor())&&e.getContext&&e.getContext();if(e&&b){if(b=b.getCommandStack().canUndo(),"davinci.ve.PageEditor"==e.declaredClass||"davinci.ve.themeEditor.ThemeEditor"==e.declaredClass)return b}else return!1}})})},"davinci/actions/SelectThemeAction":function(){define("dojo/_base/declare ./Action ../ui/widgets/ThemeSetSelection ../ve/commands/ChangeThemeCommand dojo/i18n!davinci/actions/nls/actions davinci/Workbench".split(" "),
function(p,m,h,e,b,k){return p("davinci.actions.SelectThemeAction",m,{run:function(a){if((a=davinci.Workbench.getOpenEditor())&&a.isDirty){var g=a.getOnUnloadWarningMessage();g||(g=dojo.string.substitute(b.filesHasUnsavedChanges,[a.fileName]));k.showDialog({title:b.switchingThemes,content:g,style:{width:300},okCallback:dojo.hitch(this,this._okToSwitch),okLabel:b.save,hideCancel:null})}else this._okToSwitch()},_okToSwitch:function(){var a=davinci.Workbench.getOpenEditor();a.isDirty&&a.save();var b=
a.getContext().getTheme(),a=a.getContext().getDojo().version.major+"."+a.getContext().getDojo().version.minor;this._themeChooser=new h({value:b,workspaceOnly:!1,dojoVersion:a});this._themeChooser.buildRendering()},_changeTheme:function(){var a=this._themeChooser.attr("value");this._themeChooser.onClose();this._themeChooser.destroy();var b=davinci.Workbench.getOpenEditor();b&&b.getContext&&b.getContext().getCommandStack().execute(new e(a,b.getContext()))}})})},"davinci/ui/widgets/ThemeSetSelection":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin davinci/library system/resource davinci/workbench/Preferences davinci/Runtime davinci/Workbench davinci/ve/commands/ChangeThemeCommand davinci/ui/Dialog dojo/i18n!davinci/ui/nls/ui dojo/i18n!dijit/nls/common dijit/form/Button dijit/form/Select davinci/Theme dojo/text!./templates/ThemeSetSelection.html".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y){p("davinci.ui.widgets.ThemeSetSelectionWidget",[m,h,e],{templateString:y,widgetsInTemplate:!0,uiNLS:c,commonNLS:q});return p("davinci.ui.widgets.ThemeSetSelection",null,{workspaceOnly:!1,_connections:[],_selectedThemeSet:null,constructor:function(a){dojo.safeMixin(this,a)},buildRendering:function(){this._dialog=new d({title:c.selectTheme,contentStyle:{width:372}});dojo.connect(this._dialog,"onCancel",this,"onClose");var a=null;this.newFile||(a=n.getOpenEditor().getContext());
(a=z.getThemeSet(a))||(a=z.dojoThemeSets.themeSets[0]);this._selectedThemeSet=a;this._dialog.attr("content",new davinci.ui.widgets.ThemeSetSelectionWidget({}));this._connections.push(dojo.connect(dijit.byId("theme_select_themeset_theme_select"),"onChange",this,"onChange"));this._connections.push(dojo.connect(dijit.byId("theme_select_desktop_theme_select"),"onChange",this,"onDesktopChange"));this._connections.push(dojo.connect(dijit.byId("theme_select_mobile_theme_select"),"onChange",this,"onMobileChange"));
this._connections.push(dojo.connect(this._dialog,"onExecute",this,"onOk"));this._connections.push(dojo.connect(dijit.byId("theme_select_cancel_button"),"onClick",this,"onClose"));this._connections.push(dojo.connect(dijit.byId("theme_select_android_select"),"onChange",this,"onAndroidThemeChange"));this._connections.push(dojo.connect(dijit.byId("theme_select_blackberry_select"),"onChange",this,"onBlackberryThemeChange"));this._connections.push(dojo.connect(dijit.byId("theme_select_ipad_select"),"onChange",
this,"oniPadThemeChange"));this._connections.push(dojo.connect(dijit.byId("theme_select_iphone_select"),"onChange",this,"oniPhoneThemeChange"));this._connections.push(dojo.connect(dijit.byId("theme_select_other_select"),"onChange",this,"onOtherThemeChange"));this.addThemeSets();dijit.byId("theme_select_themeset_theme_select").attr("value",a.name);this._dialog.show()},addThemeSets:function(){this._dojoThemeSets=z.getThemeSets(n.getProject());this._dojoThemeSets||(this._dojoThemeSets=z.dojoThemeSets);
this._dojoThemeSets=dojo.clone(this._dojoThemeSets);this._selectedThemeSet.name==z.none_themeset_name?this._dojoThemeSets.themeSets.unshift(this._selectedThemeSet):this._dojoThemeSets.themeSets.unshift(z.none_themeset);for(var a=dijit.byId("theme_select_themeset_theme_select"),b=0;b<this._dojoThemeSets.themeSets.length;b++)opt={value:this._dojoThemeSets.themeSets[b].name,label:this._dojoThemeSets.themeSets[b].name},a.addOption(opt)},addThemes:function(a){this._themeData=b.getThemes(n.getProject(),
this.workspaceOnly);var c=dijit.byId("theme_select_desktop_theme_select");c.options=[];var d=dijit.byId("theme_select_android_select");d.options=[];var f=dijit.byId("theme_select_blackberry_select");f.options=[];var g=dijit.byId("theme_select_ipad_select");g.options=[];var e=dijit.byId("theme_select_iphone_select");e.options=[];var k=dijit.byId("theme_select_other_select");k.options=[];var h=dijit.byId("theme_select_mobile_theme_select");c.options=[];h.options=[];h.addOption({value:z.default_theme,
label:z.default_theme});this._themeCount=this._themeData.length;for(var m=0;m<this._themeData.length;m++){var q={value:this._themeData[m].name,label:this._themeData[m].name};"dojox.mobile"===this._themeData[m].type?(h.addOption(q),d.addOption(q),f.addOption(q),g.addOption(q),e.addOption(q),k.addOption(q)):c.addOption(q)}c.attr("value",a.desktopTheme);for(c=0;c<a.mobileTheme.length;c++)switch(a.mobileTheme[c].device.toLowerCase()){case "android":d.attr("value",a.mobileTheme[c].theme);break;case "blackberry":f.attr("value",
a.mobileTheme[c].theme);break;case "ipad":g.attr("value",a.mobileTheme[c].theme);break;case "iphone":e.attr("value",a.mobileTheme[c].theme);break;case "other":k.attr("value",a.mobileTheme[c].theme)}z.singleMobileTheme(a)?h.attr("value",a.mobileTheme[a.mobileTheme.length-1].theme):h.attr("value",z.default_theme)},onChange:function(a){for(var b=0;b<this._dojoThemeSets.themeSets.length;b++)if(this._dojoThemeSets.themeSets[b].name==a){this.addThemes(this._dojoThemeSets.themeSets[b]);this._selectedThemeSet=
this._dojoThemeSets.themeSets[b];break}var b=dijit.byId("theme_select_mobile_theme_select"),c=dijit.byId("theme_select_desktop_theme_select"),d=dijit.byId("theme_select_android_select"),f=dijit.byId("theme_select_blackberry_select"),g=dijit.byId("theme_select_ipad_select"),e=dijit.byId("theme_select_iphone_select"),k=dijit.byId("theme_select_other_select");a===z.none_themeset_name?(b.set("disabled",!1),c.set("disabled",!1),d.set("disabled",!1),f.set("disabled",!1),g.set("disabled",!1),e.set("disabled",
!1),k.set("disabled",!1)):(b.set("disabled",!0),c.set("disabled",!0),d.set("disabled",!0),f.set("disabled",!0),g.set("disabled",!0),e.set("disabled",!0),k.set("disabled",!0))},onDesktopChange:function(a){this._selectedThemeSet.desktopTheme=a},onDeviceThemeChange:function(a,b){for(var c=0;c<this._selectedThemeSet.mobileTheme.length;c++)if(this._selectedThemeSet.mobileTheme[c].device.toLowerCase()===a.toLowerCase()){this._selectedThemeSet.mobileTheme[c].theme=b;break}},onAndroidThemeChange:function(a){this.onDeviceThemeChange("android",
a)},onBlackberryThemeChange:function(a){this.onDeviceThemeChange("blackberry",a)},oniPadThemeChange:function(a){this.onDeviceThemeChange("ipad",a)},oniPhoneThemeChange:function(a){this.onDeviceThemeChange("iphone",a)},onOtherThemeChange:function(a){this.onDeviceThemeChange("other",a)},onMobileChange:function(a){if(this._selectedThemeSet.name==z.none_themeset_name){var b=dijit.byId("theme_select_android_select"),c=dijit.byId("theme_select_blackberry_select"),d=dijit.byId("theme_select_ipad_select"),
f=dijit.byId("theme_select_iphone_select"),g=dijit.byId("theme_select_other_select");if("(device-specific)"===a&&this._selectedThemeSet.name===z.none_themeset_name)b.set("disabled",!1),c.set("disabled",!1),d.set("disabled",!1),f.set("disabled",!1),g.set("disabled",!1);else for(var e=0;e<this._selectedThemeSet.mobileTheme.length;e++){var k=this._selectedThemeSet.mobileTheme[e].device.toLowerCase();this._selectedThemeSet.mobileTheme[e].theme=a;switch(k){case "android":b.attr("value",a);b.set("disabled",
!0);break;case "blackberry":c.attr("value",a);c.set("disabled",!0);break;case "ipad":d.attr("value",a);d.set("disabled",!0);break;case "iphone":f.attr("value",a);f.set("disabled",!0);break;case "other":g.attr("value",a),g.set("disabled",!0)}}}},updateDeviceThemes:function(){for(var a=0;a<this._selectedThemeSet.mobileTheme.length;a++){var b;switch(this._selectedThemeSet.mobileTheme[a].device.toLowerCase()){case "android":b=dijit.byId("theme_select_android_select");break;case "blackberry":b=dijit.byId("theme_select_blackberry_select");
break;case "ipad":b=dijit.byId("theme_select_ipad_select");break;case "iphone":b=dijit.byId("theme_select_iphone_select");break;default:b=dijit.byId("theme_select_other_select")}this._selectedThemeSet.mobileTheme[a].theme=b.attr("value")}},_changeTheme:function(){debugger;var a=n.getOpenEditor();a&&a.getContext&&a.getContext().getCommandStack().execute(new f(newTheme,a.getContext()))},_onChange:function(){var a=this._getValueAttr();if(null!=a&&!this._blockChange){this.value=a;this._cookieName="maqetta_"+
a.name+"_"+a.version;var b=dojo.cookie(this._cookieName);if(this.dojoVersion&&a.version!==this.dojoVersion&&!b)this._warnDiv.innerHTML="\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e"+c.themeVersionMessage+'\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd align\x3d"center"\x3e\x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"davinci.ui.widgets.ThemeSelection.ok"\x3e'+q.buttonOk+'\x3c/button\x3e\x3cbutton data-dojo-type\x3d"dijit.form.Button" type\x3d"button" id\x3d"davinci.ui.widgets.ThemeSelection.cancel"\x3e'+
q.buttonCancel+"\x3c/button\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",a=dijit.byId("davinci.ui.widgets.ThemeSelection.ok"),b=dijit.byId("davinci.ui.widgets.ThemeSelection.cancel"),dojo.connect(a,"onClick",this,"_warnOk"),dojo.connect(b,"onClick",this,"_warnCancel");else this.onChange()}},_warnOk:function(){dojo.cookie(this._cookieName,"true");this._destroy();this.onChange()},_warnCancel:function(){this._destroy();this.onClose()},_destroy:function(){var a=dijit.byId("davinci.ui.widgets.ThemeSelection.ok");
dojo.disconnect(a);a.destroy();a=dijit.byId("davinci.ui.widgets.ThemeSelection.cancel");dojo.disconnect(a);a.destroy()},onOk:function(a){this.onClose(a);this.newFile||(a=n.getOpenEditor())&&a.getContext&&a.getContext().getCommandStack().execute(new f(this._selectedThemeSet,a.getContext()))},onClose:function(a){for(;connection=this._connections.pop();)dojo.disconnect(connection);this._dialog.destroyRecursive();delete this._dialog},_getTemplate:function(){return'\x3ctable style\x3d"width: 100%; margin-left:10px; margin-right:10px;"\x3e\x3ctr\x3e\x3ctd style\x3d"width: 18%;"\x3e'+
c.themeSet+'\x3c/td\x3e\x3ctd style\x3d"text-align: center;"\x3e\x3cselect dojoType\x3d"dijit.form.Select" id\x3d"theme_select_themeset_theme_select" type\x3d"text" style\x3d"width: 175px;" \x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3cdiv style\x3d"border-top: 1px solid black; top: 231px; border-top-color: #ccc; left: 429px; width: 300px; height: 11px; margin-top: 6px; margin-left:10px;"\x3e\x3c/div\x3e\x3ctable style\x3d"margin-left: 15px; width: 100%;"\x3e\x3ctr\x3e\x3ctd\x3e'+c.desktopTheme+
'\x3c/td\x3e\x3ctd\x3e\x3cselect dojoType\x3d"dijit.form.Select" id\x3d"theme_select_desktop_theme_select"type\x3d"text"  style\x3d"width: 175px;"  \x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e'+c.mobileTheme+'\x3c/td\x3e\x3ctd\x3e\x3cselect dojoType\x3d"dijit.form.Select" id\x3d"theme_select_mobile_theme_select"type\x3d"text"  style\x3d"width: 175px;" \x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3ctable id\x3d"theme_select_devices_table" style\x3d"margin-left:30px; border-collapse: separate; border-spacing: 0 0; width: 100%"\x3e\x3ctr\x3e\x3ctd style\x3d"width: 139px;"\x3e'+
c.android+'\x3c/td\x3e\x3ctd\x3e\x3cselect dojoType\x3d"dijit.form.Select" id\x3d"theme_select_android_select" type\x3d"text"  style\x3d"width: 150px;"\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e'+c.blackberry+'\x3c/td\x3e\x3ctd\x3e\x3cselect dojoType\x3d"dijit.form.Select" id\x3d"theme_select_blackberry_select" type\x3d"text"  style\x3d"width: 150px;"\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e'+c.ipad+'\x3c/td\x3e\x3ctd\x3e\x3cselect dojoType\x3d"dijit.form.Select" id\x3d"theme_select_ipad_select" type\x3d"text"  style\x3d"width: 150px;"\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e'+
c.iphone+'\x3c/td\x3e\x3ctd\x3e\x3cselect dojoType\x3d"dijit.form.Select" id\x3d"theme_select_iphone_select" type\x3d"text"  style\x3d"width: 150px;"\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e'+c.other+'\x3c/td\x3e\x3ctd\x3e\x3cselect dojoType\x3d"dijit.form.Select" id\x3d"theme_select_other_select" type\x3d"text"  style\x3d"width: 150px;"\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3ctable style\x3d"width:100%; margin-top: 10px;"\x3e\x3ctr\x3e\x3ctd style\x3d"text-align:right; width:80%;"\x3e\x3cinput type\x3d"button" dojoType\x3d"dijit.form.Button" id\x3d"theme_select_ok_button" label\x3d"'+
q.buttonOk+'"\x3e\x3c/input\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d"button" dojoType\x3d"dijit.form.Button" id\x3d"theme_select_cancel_button" label\x3d"'+q.buttonCancel+'"\x3e\x3c/input\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e'}})})},"davinci/ve/commands/ChangeThemeCommand":function(){define("dojo/_base/declare dojo/_base/lang dojo/query davinci/Theme davinci/Workbench davinci/library davinci/html/CSSImport davinci/html/HTMLElement davinci/html/HTMLText preview/silhouetteiframe davinci/model/Factory".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d){return p("davinci.ve.commands.ChangeThemeCommand",null,{name:"changeTheme",constructor:function(a,b){this._newTheme=a;this._context=b;this._oldTheme=e.getThemeSet(this._context);this._oldTheme||(this._oldTheme=e.dojoThemeSets.themeSets[0])},execute:function(){this._changeTheme(this._newTheme,this._oldTheme)},undo:function(){this._changeTheme(this._oldTheme,this._newTheme)},_changeTheme:function(a,b){b.desktopTheme?this.removeThemeSet(b):this.removeTheme(b);a.desktopTheme?
this.addThemeSet(a):this.addTheme(a);var d=this._context,g=d.editor,e=d.getModel().getText();g.setContent(g.fileName,e);d.widgetAddedOrDeleted(!0);d._configDojoxMobile();g=d.getMobileDevice()||"none";"none"!=g&&(g=f.themeMap[g+".svg"]);(d=m.getObject("dojox.mobile",!0,d.getGlobal()))&&d.loadDeviceTheme&&d.loadDeviceTheme(g);window.setTimeout(function(){this._context.resizeAllWidgets()}.bind(this),50)},removeTheme:function(a){var b=e.getHelper(a);if(b&&b.removeTheme)b.removeTheme(this._context,a);
else{var d=this._context.getModel().getDocumentElement(),b=d.getChildElement("head"),d=d.getChildElement("body"),f=dojo.clone(this._context.getHeader()),g=a.files;a.conditionalFiles&&(g=g.concat(a.conditionalFiles));for(var k=0;k<g.length;k++)for(var n=g[k],m=0;m<f.styleSheets.length;m++)if(-1<f.styleSheets[m].indexOf(n)){var p=d.getAttribute("class");p&&(p=p.replace(a.className,""),f.bodyClasses=p,d.removeAttribute("class"),0<p.length&&d.addAttribute("class",p,!1));this._context.setHeader(f);for(var p=
b.find({elementType:"CSSImport"}),v=0;v<p.length;v++)if(-1<p[v].url.indexOf(n)){var A=p[v].url,C=this._context.getDocument();p[v].url="x";p[v].parent.removeChild(p[v]);p[v].close();h('link[href\x3d"'+A+'"]',C).orphan();this._context.theme=null;break}}}},addTheme:function(b){var f=e.getHelper(b);if(f&&f.addTheme)f.addTheme(this._context,b);else{var k=this._context.getModel().getDocumentElement(),f=k.getChildElement("head"),h=k.getChildElement("body"),n=dojo.clone(this._context.getHeader()),k=this._context.getFullResourcePath(),
k=(new davinci.model.Path(b.getFile().parent.getPath())).append(b.files[0]).relativeTo(k,!0).toString();n.styleSheets[n.styleSheets.length]=k;var m=h.getAttribute("class");m||(m=" ");m=m+" "+b.className;m=m.trim();n.bodyClasses=m;h.removeAttribute("class");h.addAttribute("class",m,!1);this._context.setHeader(n);h=f.getChildElement("style");h||(h=new g("style"),f.addChild(h));f=new a;f.url=k;k=d.getModel({url:e.getBase()+"/"+f.url,includeImports:!0});f.cssFile=k;h.addChild(f,0);this._context.theme=
b}},removeThemeSet:function(a){var d=k.getThemes(b.getProject(),this.workspaceOnly);if(a.desktopTheme)for(var f=0;f<d.length;f++)d[f].name===a.desktopTheme&&this.removeTheme(d[f]);a.mobileTheme&&!e.themeSetEquals(a.mobileTheme,e.dojoMobileDefault)&&(this._context.close(),this._dojoxMobileRemoveTheme(this._context))},addThemeSet:function(a){var d=k.getThemes(b.getProject(),this.workspaceOnly);if(a.desktopTheme)for(var f=0;f<d.length;f++)d[f].name===a.desktopTheme&&this.addTheme(d[f]);a.mobileTheme&&
this._dojoxMobileAddTheme(this._context,a.mobileTheme)},_dojoxMobileRemoveTheme:function(a){a._updateDojoConfig({themeMap:null,mblLoadCompatPattern:null,mblThemeFiles:null})},_dojoxMobileAddTheme:function(a,b,d){e.getThemeLocation().toString().replace(/\//g,"\\/");a._updateDojoConfig({themeMap:e.getDojoxMobileThemeMap(a,b),mblLoadCompatPattern:"''",mblThemeFiles:[]})}})})},"davinci/actions/SelectLayoutAction":function(){define(["dojo/_base/declare","./Action","../Workbench","dojo/i18n!./nls/actions"],
function(p,m,h,e){return p("davinci.actions.SelectLayoutAction",m,{_changeLayoutCommand:function(b){var e=dijit.byId("selectLayout");e&&e.destroyRecursive(!1);if((e=h.getOpenEditor())&&e.getContext){var a=!0;if("absolute"===b||"Absolute positioning"===b)a=!1;e.getContext().setFlowLayout(a);e._visualChanged()}}})})},"davinci/actions/RedoAction":function(){define(["dojo/_base/declare","./Action","../Workbench"],function(p,m,h){return p("davinci.actions.RedoAction",m,{run:function(e){(e=h.getOpenEditor())&&
e.getContext&&e.getContext().getCommandStack().redo()},isEnabled:function(e){var b=(e=h.getOpenEditor())&&e.getContext&&e.getContext();if(e&&b){if(b=b.getCommandStack().canRedo(),"davinci.ve.PageEditor"==e.declaredClass||"davinci.ve.themeEditor.ThemeEditor"==e.declaredClass)return b}else return!1}})})},"davinci/actions/DownloadAction":function(){define("dojo/_base/declare ./Action ../Workbench ../ui/DownloadSelected system/resource davinci/ui/Resource dojo/i18n!davinci/ui/nls/ui dojo/i18n!./nls/actions dijit/form/ValidationTextBox".split(" "),
function(p,m,h,e,b,k,a){return p("davinci.actions.DownloadAction",m,{run:function(){h.showModal(new e,a.downloadFile,{width:"400px"})},isEnabled:function(a){return(a=k.getSelectedResources())&&0<a.length}})})},"davinci/ui/DownloadSelected":function(){define(["dojo/_base/declare","./Download","./Resource","dojo/i18n!./nls/ui","dojo/text!./templates/downloadSelected.html"],function(p,m,h,e,b){return p([m],{templateString:b,_buildUITable:function(){this._files=h.getSelectedResources();var b=["\x3cdiv class\x3d'downloadSelectedHeader'\x3e"+
e.selectedFiles+"\x3c/div\x3e","\x3cdiv class\x3d'downloadSelectedList'\x3e"];this._files||(b.push("\x3cb\x3e"+e.noFilesSelected+"\x3c/b\x3e"),this._files=[],dojo.attr(this._okButton,"disabled","true"));b=b.concat(this._files.map(function(a){return a.getPath()+"\x3cbr\x3e"}));b.push("\x3c/div\x3e\x3cbr\x3e\x3cbr\x3e");dojo.place(b.join(""),this._selectionDiv)},_getResources:function(){return this._files.map(function(b){return b.getPath()})},_getLibs:function(){return[]}})})},"davinci/ui/Download":function(){define("dojo/_base/declare dijit/_TemplatedMixin dijit/_WidgetBase dijit/_WidgetsInTemplateMixin davinci/library system/resource dojo/promise/all dojo/parser davinci/Workbench davinci/ve/RebaseDownload dojo/i18n!./nls/ui dojo/i18n!dijit/nls/common dojo/text!./templates/download.html davinci/Theme dijit/form/Button dijit/form/ValidationTextBox dijit/form/TextBox".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u){return p([h,m,e],{templateString:q,_fileNameValidationRegExp:"[a-zA-z0-9_.]+",_fileNameMaxLength:50,postMixInProperties:function(){this._projectName=n.getProject();dojo.mixin(this,d);dojo.mixin(this,c);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this._buildUITable()},_buildUITable:function(){this._handles=[];this._userLibs=b.getUserLibs(this.getRoot());var a=[dojo.replace("\x3ctable cellspacing\x3d'0' cellpadding\x3d'0' width\x3d'100%' class\x3d'dwnloadLibTable'\x3e\x3ctr\x3e\x3ctd class\x3d'header'\x3e{library}\x3c/td\x3e\x3ctd class\x3d'header'\x3e{version}\x3c/td\x3e\x3ctd class\x3d'header'\x3e{include}\x3cbr\x3e{source}\x3c/td\x3e\x3ctd class\x3d'header'\x3e{baseLocation}\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'4'\x3e\x3chr\x3e\x3c/hr\x3e\x3c/td\x3e\x3c/tr\x3e",
d)];this.libraries={};this._userLibs.forEach(function(b,c){b.initRoot=this._getLibRoot(b.id,b.version);var d=b.id;b.initRoot&&(a.push("\x3ctr libPath\x3d'"+c+"'"),b.required&&a.push(" style\x3d'display:none'"),a.push("\x3e"),a=a.concat(["\x3ctd class\x3d'columna'\x3e"+d+"\x3c/td\x3e","\x3ctd class\x3d'columnb'\x3e"+b.version+"\x3c/td\x3e","\x3ctd class\x3d'columnc'\x3e\x3cinput type\x3d'checkbox' data-dojo-type\x3d'dijit/form/CheckBox' checked\x3e\x3c/input\x3e\x3c/td\x3e","\x3ctd class\x3d'columnd'\x3e\x3cinput type\x3d'text' data-dojo-type\x3d'dijit/form/TextBox' value\x3d'"+
b.initRoot+"'\x3e\x3c/input\x3e\x3c/td\x3e","\x3c/tr\x3e"]))},this);a.push("\x3c/table\x3e");dojo.place(a.join(""),this._tableDiv);g.parse(this._tableDiv)},_getLibRoot:function(a,b){var c=void 0;this._userLibs.some(function(d){if(d.id==a&&d.version==b)return c=d.root,!0});return c},_getLibs:function(){return dojo.query("tr[libPath]",this.domNode).map(function(a){var b=dijit.byNode(dojo.query(".dijitTextBox",a)[0]),c=dijit.byNode(dojo.query(".dijitCheckBox",a)[0]);a=parseInt(dojo.attr(a,"libPath"));
c=c.get("checked");b=b.get("value")||this._userLibs[a].root;return{id:this._userLibs[a].id,version:this._userLibs[a].version,root:b,includeSrc:c}},this)},getRoot:function(){if(n.singleProjectMode())return n.getProject()},_getResources:function(){return[n.getProject()]},_rewriteUrls:function(){var b=[];this._getResources().forEach(function(a){a=k.findResource(a);"Folder"==a.elementType?b=b.concat(k.findResource("*.html",!0,a,!0)):"html"==a.extension&&b.push(a)});var c=new f(this._getLibs()),d=b.filter(function(a){return!u.isThemeHTML(a)}).map(function(a){return c.rebuildSource(a.getContentSync(),
a).then(function(b){a.setContents(b,!0)})});return a(d)},_select:function(a){dojo.query("tr[libPath]",this.domNode).forEach(function(b){(b=dijit.byNode(dojo.query(".dijitCheckBox",b)[0]))&&b.set("checked",a)});return!1},_selectAll:function(){this._select(!0)},_selectNone:function(){this._select(!1)},okButton:function(){if(this.__fileName.isValid()){var a=dojo.attr(this.__fileName,"value");".zip"!=a.slice(-4)&&(a+=".zip");this._rewriteUrls().then(function(){var b=this._getLibs().filter(function(a){return a.includeSrc}),
c={};this.__optimize&&this.__optimize.getValue()&&(c.build="1");this.__fullSource&&this.__fullSource.getValue()&&(c.fullsource="1");setTimeout(function(){k.download(this._getResources(),a,this.getRoot(),b,c)}.bind(this),300)}.bind(this))}},cancelButton:function(){this.cancel=!0;this.onClose()}})})},"davinci/ve/RebaseDownload":function(){define(["dojo/_base/declare","./RebuildPage","../library"],function(p,m,h){return p(m,{constructor:function(e){this.libs=e},getLibraryBase:function(e,b){for(var k in this.libs){var a=
this.libs[k];if(a.id==e&&a.version==b)return k=new Deferred,k.resolve(a.root),k}return h.getLibRoot(e,b)||""}})})},"davinci/ve/RebuildPage":function(){define("dojo/_base/declare ./Context ../model/Path davinci/model/Factory dojo/Deferred dojo/promise/all davinci/ve/commands/ChangeThemeCommand".split(" "),function(p,m,h,e,b,k,a){return p(null,{constructor:function(a){dojo.mixin(this,a);this.context=new m},getPageCss:function(){return["app.css"]},getPageJs:function(){return["app.js"]},rebuildSource:function(g,
n,f,d){if(!n||!n.extension||"html"!=n.extension){var c=new b;c.resolve(g);return c}this.context.model=this.context._srcDocument=e.getNewFromResource(n);var m=new h(n?n.getPath():"");this.context.model.fileName=m.toString();this.context._srcDocument.setText(g,!0);if(null==this.context._srcDocument.find({elementType:"HTMLElement",tag:"html"},!0))return c=new b,c.resolve(g),c;var p=this.context._srcDocument.find({elementType:"HTMLElement"});g=[];g.push(this.context.loadRequires("html.body",!0,!0,!0));
for(n=0;n<p.length;n++){var r=p[n],r=r.getAttribute("data-dojo-type")||r.getAttribute("dojoType")||r.getAttribute("dvwidget");null!=r&&g.push(this.context.loadRequires(r.replace(/\./g,"/"),!0,!0,!0))}f&&this.changeThemeBase(f,m);d&&d.mobileTheme&&(new a(d,this.context))._dojoxMobileAddTheme(this.context,d.mobileTheme);p=this.getPageCss();f=this.getPageJs();d=this.context._getCurrentBasePath();m=m.getParentPath();for(n=0;n<p.length;n++)r=d.append(p[n]).relativeTo(m).toString(),this.addModeledStyleSheet(r,
p[n]);for(n=0;n<f.length;n++)p=d.append(f[n]).relativeTo(m).toString(),this.addJavaScript(p,null,null,null,f[n]);c=new b;k(g).then(function(){c.resolve(this.context._srcDocument.getText())}.bind(this));return c},addModeledStyleSheet:function(a,b){this.context._srcDocument.find({elementType:"CSSImport"}).some(function(f){if(f.url&&-1<f.url.indexOf(b))return f.setUrl(a),!0})},addJavaScript:function(a,b,f,d,c){!this.context._srcDocument.find({elementType:"HTMLElement",tag:"script"}).some(function(b){var d=
b.getAttribute("src");if(d&&-1<d.indexOf(c))return b.setAttribute("src",a),!0})&&a&&(-1<a.indexOf("dojo.js")&&this.context.addHeaderScript(a,{"data-dojo-config":"parseOnLoad: true"}),this.context.addHeaderScript(a))},changeThemeBase:function(a,b){var f=new h(a.getFile().parent.getPath()),d=function(a){var d=f.append(a).relativeTo(b,!0);this.addModeledStyleSheet(d.toString(),new h(a),!0)}.bind(this);a.files.forEach(d);a.conditionalFiles&&a.conditionalFiles.forEach(d)}})})},"davinci/ve/Context":function(){define("require dojo/_base/declare dojo/_base/lang dojo/dom-class dojo/query dojo/_base/connect xide/mixins/ReloadMixin xide/mixins/EventedMixin ./_ContextMobile ./_ContextTheme ./_ContextCSS ./_ContextJS ./_ContextDelite ./_ContextDojo ./_ContextInterface ./_ContextDocument ./_ContextWidgets ./ThemeModifier ../commands/CommandStack ./tools/SelectTool ../model/Path ../Workbench ./widget ../library ./metadata ./ChooseParent ./States dojox/html/_base".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y,B,x,w,v,A,C,L,E,I,D){davinci.ve._preferences={};var G=0,N=function(a){var b=E.getLibrary();a&&dojo.filter(a.attributes,function(a){return"on"==a.nodeName.substr(0,2).toLowerCase()}).forEach(function(a){var c=!1,d;for(d in b)if(c=E.getLibrary(d),c=E.invokeCallback(c,"requiredEventAttribute",[a]))break})};return m("davinci.ve.Context",[n,f,d,c,q,u,r,z,y,B,g,a],{_scripts:[],delite:!1,WIDGET_MODIFIED:0,WIDGET_ADDED:1,WIDGET_REMOVED:2,WIDGET_REPARENTED:3,WIDGET_ID_CHANGED:4,
maqStatesClassCount:0,maqStatesClassPrefix:"maqStatesClass",maqTypesClassCount:0,maqTypesClassPrefix:"maqTypesClass",rootWidget:null,getRootWidget:function(){return this.rootWidget},constructor:function(a){a||(a={});A.location();this._contentStyleSheet=p.toUrl("davinci/ve/resources/content.css");this._id="_edit_context_"+G++;this.widgetHash={};this.delite=a.delite;h.mixin(this,a);"string"==typeof this.containerNode&&(this.containerNode=dijit.byId(this.containerNode));this._commandStack=new x(this);
this._defaultTool=new w;this._widgetIds=[];this._objectIds=[];this._widgets=[];this._loadedCSSConnects=[];this._chooseParent=new I({context:this});this.sceneManagers={};this.catchEvents=!0;this._customWidgetPackages=h.clone(L.getCustomWidgetPackages());a=E.getLibrary();for(var b in a)a=E.getLibrary(b),E.invokeCallback(a,"onDocInit",[this]);b=document.getElementById("focusContainer");b||(b=dojo.create("div",{"class":"focusContainer",id:"focusContainer"},document.body),davinci.Workbench.focusContainer=
b);this.initReload()},getVisualEditor:function(){return this.visualEditor&&this.visualEditor._pageEditor?this.visualEditor._pageEditor.delegate:null},destroy:function(){this.deactivate();this.inherited(arguments);this._loadedCSSConnects&&(this._loadedCSSConnects.forEach(k.disconnect),delete this._loadedCSSConnects)},isActive:function(){return!!this._activeTool},onReloaded:function(){},getPath:function(){return new v(this.getModel().fileName)},activate2:function(){if(!this.isActive()){this.loadStyleSheet(this._contentStyleSheet);
this._attachAll();this._restoreStates();b("*",this.rootNode).forEach(function(a){N(a);"A"==a.tagName.toUpperCase()&&a.hasAttribute("href")&&a.removeAttribute("href")});this._AppStatesActivateActions();this._statesLoaded=!0;k.publish("/davinci/ui/context/statesLoaded",[this]);this._onLoadHelpers();var a=this.getContainerNode();e.add(a,"editContextContainer");this.catchEvents?(this._connects=[k.connect(this._commandStack,"onExecute",this,"onCommandStackExecute"),k.connect(this._commandStack,"onExecute",
function(){setTimeout(this.onContentChange.bind(this),0)}.bind(this))],this._designEvents=[k.connect(this.getDocument(),"onkeydown",this,"onKeyDown"),k.connect(this.getDocument(),"onkeyup",this,"onKeyUp"),k.connect(a,"ondblclick",this,"onDblClick"),k.connect(a,"onmousedown",this,"onMouseDown"),k.connect(a,"onclick",this,"onMouseClick"),k.connect(a,"onmousemove",this,"onMouseMove"),k.connect(a,"onmouseup",this,"onMouseUp"),k.connect(a,"onmouseover",this,"onMouseOver"),k.connect(a,"onmouseout",this,
"onMouseOut")]):this._connects=[k.connect(this._commandStack,"onExecute",this,"onCommandStackExecute"),k.connect(this._commandStack,"onExecute",function(){setTimeout(this.onContentChange.bind(this),0)}.bind(this)),k.connect(this.getDocument(),"onkeydown",this,"onKeyDown"),k.connect(this.getDocument(),"onkeyup",this,"onKeyUp")];this.visualEditor&&this.visualEditor._pageEditor&&this.visualEditor._pageEditor._visualChanged&&this.visualEditor._pageEditor._visualChanged(!0);try{this.setActiveTool()}catch(c){debugger;
console.error("set active tool failed! "+c.message)}return!0}},deactivate:function(){if(this.isActive()){this._connects.forEach(k.disconnect);this._designEvents.forEach(k.disconnect);delete this._designEvents;delete this._connects;(this._focuses||[]).forEach(function(a){a._connected=!1});this._commandStack.clear();this._activeTool&&(this._activeTool.deactivate(),delete this._activeTool);var a=this.getContainerNode();this.select(null);e.remove(a,"editContextContainer");this.getTopWidgets().forEach(this.detach,
this);this.unloadStyleSheet(this._contentStyleSheet)}},_editorSelectionChange:function(a){a.editor.fileName===this.editor.fileName&&(k.unsubscribe(this._editorSelectConnection),delete this._editorSelectConnection,this._setSource(this._srcDocument))},_preserveStates:function(a,b){var c=davinci.ve.states.retrieve(a);if("BODY"!=a.tagName.toUpperCase()&&(c.maqAppStates||c.maqDeltas)){var d=this.maqStatesClassPrefix+this.maqStatesClassCount;a.className=a.className+" "+d;this.maqStatesClassCount++;b[d]=
{};c.maqAppStates&&(b[d].maqAppStates=c.maqAppStates);c.maqDeltas&&(b[d].maqDeltas=c.maqDeltas);a.style?b[d].style=a.style.cssText:console.error("Context._preserveStates: fail")}},_restoreStates:function(){},_AppStatesActivateActions:function(){if("davinci.ve.PageEditor"===this.editor.declaredClass){if(!this.rootNode._maqAppStates){this.rootNode._maqAppStates={};var a=this.rootWidget._srcElement,b=D.serialize(this.rootNode);b.maqAppStates?a.setAttribute(D.APPSTATES_ATTRIBUTE,b.maqAppStates):a.removeAttribute(D.APPSTATES_ATTRIBUTE);
this.editor._visualChanged(!0)}D.getFocus(this.rootNode)||(a=D.getState(this.rootNode),D.setState(a,this.rootNode,{updateWhenCurrent:!0,silent:!0,focus:!0}))}},getCommandStack:function(){return this._commandStack},getSelection:function(){return this._selection||[]},getPreference:function(a){return a?davinci.ve._preferences[a]:void 0},getPreferences:function(){return h.mixin({},davinci.ve._preferences)},setPreference:function(a,b){a&&(davinci.ve._preferences[a]=b,this.isActive())},setPreferences:function(a){if(a)for(var b in a)this.setPreference(b,
a[b])},_parse:function(a){var b={metas:[],scripts:[],modules:[],styleSheets:[]},c=a.getDocumentElement();a=c.getChildElement("head");var d=c.getChildElement("body");this._uniqueIDs={};if(d){d.visit({visit:dojo.hitch(this,function(a){"HTMLElement"==a.elementType&&a!=d&&this.getUniqueID(a)})});if(c=d.getAttribute("class"))b.bodyClasses=c;b.style=d.getAttribute("style");b.content=d.getElementText({includeNoPersist:!0,excludeIgnoredContent:!0});c=d.getAttribute(davinci.ve.states.APPSTATES_ATTRIBUTE);
c||(c=d.getAttribute(davinci.ve.states.APPSTATES_ATTRIBUTE_P6))&&d.setAttribute(davinci.ve.states.APPSTATES_ATTRIBUTE,c);d.removeAttribute(davinci.ve.states.APPSTATES_ATTRIBUTE_P6);b.maqAppStates=c}if(c=a.getChildElement("title"))b.title=c.getElementText();c=a.getChildElements("script");dojo.forEach(c,function(a){var c=a.getAttribute("src");c&&b.scripts.push(c);a=a.getElementText();a.length&&(a.replace(/dojo\.require\(["']([^'"]+)["']\)/g,function(a,c){b.modules.push(c)}),a.replace(/require\(\[["']([^'"]+)["']\]\)/g,
function(a,c){b.modules.push(c)}))},this);a=a.getChildElements("style");dojo.forEach(a,function(a){dojo.forEach(a.children,function(a){"CSSImport"===a.elementType&&b.styleSheets.push(a.url)})});return b},getUniqueID:function(a,b){var c=a.getAttribute("id");if(!c){for(var d=this.rootWidget?this.rootWidget.domNode.ownerDocument:null,f=b||a.tag;;)if(c=this._uniqueIDs.hasOwnProperty(f)?++this._uniqueIDs[f]:this._uniqueIDs[f]=0,c=f+"_"+c,d){if(!d.getElementById(c))break}else break;a.addAttribute("id",
c,!b)}return c},registerSceneManager:function(a){if(a&&a.id){var b=a.id;this.sceneManagers[b]||(this.sceneManagers[b]=a,k.publish("/davinci/ui/context/registerSceneManager",[a]))}},onCommandStackExecute:function(){this.clearCachedWidgetBounds();this.editor&&this.editor.editorContainer&&this.editor.editorContainer.updateToolbars&&this.editor.editorContainer.updateToolbars();D.updateHighlightsBaseStateWidgets(this)},reorderPreserveSiblingOrder:function(a){a=[].concat(a);for(var b=0;b<a.length-1;){for(var c=
a[b].getParent(),d=b+1,f=!1;d<a.length;)if(a[d].getParent()==c)f=!0,d++;else break;if(f)for(c=c.getChildren(),f=d-2;f>=b;f--)for(var g=b;g<=f;g++){var e=c.indexOf(a[g]),k=c.indexOf(a[g+1]);e>k&&(e=a[g+1],a[g+1]=a[g],a[g]=e)}b=d}return a},_updateWidgetHash:function(){this.widgetHash={};this.getAllWidgets().forEach(function(a){var b=a.id;b&&(this.widgetHash[b]=a)},this)}})})},"davinci/ve/_ContextMobile":function(){define(["require","dojo/_base/declare","../Theme","preview/silhouetteiframe","dojox/html/_base"],
function(p,m,h,e){return m(null,{getMobileDevice:function(){var b=this.getDocumentElement().getChildElement("body");if(b){var e=b.getAttribute("data-maq-device"),a=b.getAttribute("data-maqetta-device");!e&&a&&(b.removeAttribute("data-maqetta-device"),b.setAttribute("data-maq-device",a),e=a,this.editor._visualChanged());return e}},setMobileDevice:function(b){this.getGlobal().require("dojo/_base/config").mblUserAgent=e.getMobileTheme(b+".svg");var k=this.getDocumentElement().getChildElement("body");
b&&"none"!=b?k.addAttribute("data-maq-device",b):k.removeAttribute("data-maq-device",b)},setMobileTheme:function(b){(this.getMobileDevice()||"none")!=b&&this.setMobileDevice(b);this.close();try{e.getMobileTheme(b+".svg"),this._configDojoxMobile()}catch(k){}},getMobileOrientation:function(){var b=this.getDocumentElement().getChildElement("body"),e=b.getAttribute("data-maq-orientation"),a=b.getAttribute("data-maqetta-device-orientation");!e&&a&&(b.removeAttribute("data-maqetta-device-orientation"),
b.setAttribute("data-maq-orientation",a),e=a,this.editor._visualChanged());return e},setMobileOrientation:function(b){var e=this.getDocumentElement().getChildElement("body");b?e.setAttribute("data-maq-orientation",b):e.removeAttribute("data-maq-orientation")},_mobileMetaElement:{name:"viewport",content:"width\x3ddevice-width, initial-scale\x3d1.0, user-scalable\x3dno"},setMobileMeta:function(b){"none"===b?this._removeHeadElement("meta",this._mobileMetaElement):this._addHeadElement("meta",this._mobileMetaElement)},
_configDojoxMobile:function(b){try{var e=this.getGlobal().require,a=e("dojox/mobile"),g=e("dojox/mobile/deviceTheme"),n=this.getGlobal().dojo.config,f=this._getDojoJsElem().getAttribute("data-dojo-config"),d=n.mblUserAgent||"none",c,m,u,f=f?p.eval("({ "+f+" })","data-dojo-config"):{};c=f.themeMap;m=f.mblThemeFiles;u=f.mblLoadCompatPattern;delete this.themeCssFiles;delete this.cssFiles;c||(c=h.getDojoxMobileThemeMap(this,dojo.clone(h.dojoMobileDefault)),m=[],h.getThemeLocation().toString().replace(/\//g,
"\\/"),u=RegExp(""));b=!1;h.themeMapsEqual(g.themeMap,c)||(b=!1,g.themeMap=c);m?n.mblThemeFiles=m:delete n.mblThemeFiles;u?(n.mblLoadCompatPattern=u,a.loadCompatPattern=u):(delete n.mblLoadCompatPattern,a.loadCompatPattern=/\/mobile\/themes\/.*\.css$/);if(this._selection)this.onSelectionChange(this._selection);b||g.loadDeviceTheme(d)}catch(r){}}})})},"davinci/ve/_ContextTheme":function(){define("dojo/_base/declare ../Theme ../model/Path ../Workbench ../library ./metadata dojox/html/_base".split(" "),
function(p,m,h,e,b,k){return p(null,{getTheme:function(){if(!this.theme){var a=k.loadThemeMeta(this._srcDocument);a&&(this._themeUrl=a.themeUrl,this._themeMetaCache=a.themeMetaCache,this.theme=a.theme,this.theme.helper=m.getHelper(this.theme),this.theme.helper&&this.theme.helper.then&&this.theme.helper.then(function(a){a.helper&&(this.theme.helper=a.helper)}.bind(this)))}return this.theme},getThemeMeta:function(){this._themeMetaCache||this.getTheme();return this._themeMetaCache},themeChanged:function(){var a=
!0,b=this.getModel();this._themeUrl&&b.find({elementType:"CSSImport",url:this._themeUrl},!0)&&(a=!1);a&&(this._themeMetaCache=this.theme=null)},loadTheme:function(a){var g=this.getModel(),k="claro";a&&a.themeSet?k=a.themeSet.desktopTheme:a&&a.theme&&(k="deviceSpecific"==a.theme?"claro":a.theme);a=g.find({elementType:"CSSImport"});var f={},d;b.getThemes(e.getProject()).forEach(function(a){a.name==k&&(d=a);a.files&&a.files.forEach(function(b){f[b]=a})});if(null==d)return console.error("couldnt find default theme, abort!!"),
!1;if(null==d.getFile)return console.error("default theme in invalid state, abort!!"),!1;if(a.some(function(a){for(var b in f)if(-1<a.url.indexOf(b))return!0}))return!0;g.find({elementType:"HTMLElement",tag:"body"},!0).setAttribute("class",d.className);g=d.getFile();if(null==g||null==g.getPath)return console.error("default theme file in invalid state, abort!!"),!0;var c=d.getFile().getPath();d.files.forEach(function(a){a=(new h(c)).removeLastSegments(1).append(a).relativeTo(this.getPath(),!0);this.addModeledStyleSheet(a.toString(),
!0)},this)},_themeChange:function(a){a&&"CSSRule"===a.elementType&&(this.editor.setDirty(!0),this.hotModifyCssRule(a))}})})},"davinci/ve/_ContextCSS":function(){define("dojo/_base/declare dojo/dom-construct dojo/query dojo/_base/connect system/resource ../model/Path ../Workbench ./widget ./States ./utils/pseudoClass dojox/html/_base".split(" "),function(p,m,h,e,b,k,a,g,n,f){return p(null,{getStyleAttributeValues:function(a){for(var b=a?a.getStyleValues():[],f=n.getStateContainersForNode(a.domNode),
g=!0,e=0;e<f.length;e++){var k=n.getState(f[e]);if(k&&k!=n.NORMAL){g=!1;break}}if(!g&&(f=davinci.ve.states.getStatesListCurrent(a.domNode),a=davinci.ve.states.getStyle(a.domNode,f))){for(f=0;f<a.length;f++){var g=a[f],h;for(h in g)for(g=b.length-1;0<=g;g--){var e=b[g],m;for(m in e)if(h==m){b.splice(g,1);break}}}b=b.concat(a)}return b},addPseudoClassSelectors:function(a){var b=function(a){if(a){for(var d=a.cssRules,g=0,g=0;g<d.length;g++){var e=d[g];if(e.type&&e.type===CSSRule.IMPORT_RULE)b(d[g].styleSheet);
else if(d[g].type==CSSRule.STYLE_RULE){var k=d[g].selectorText;if(-1<k.indexOf(":")){k=f.replace(k);e.selectorText=k;a.deleteRule(g);a.insertRule(e.cssText,g);break}}}return!0}return!1};dojo.some(this.getDocument().styleSheets,b)},hotModifyCssRule:function(a){function c(a,b){if(a.href==b)return a;for(var d,f=a.cssRules,g=0;g<f.length&&(!f[g].type||f[g].type!==CSSRule.IMPORT_RULE||!(d=f[g].href==b?f[g].styleSheet:c(f[g].styleSheet,b)));g++);return d}dojo.some(this.getDocument().styleSheets,function(g){var e;
e=b.findResource(a.parent.url).getURL();var k=encodeURI(e);e=a.getSelectorText();-1<e.indexOf(":")&&(e=f.replace(e));e=e.replace(/^\s+|\s+$/g,"");if(g=c(g,k)){for(var h=g.cssRules,k=0;k<h.length;k++)if(h[k].type&&h[k].type==CSSRule.STYLE_RULE&&h[k].selectorText==e){g.deleteRule(k);break}a.properties.length&&(e=a.getText({noComments:!0}),-1<e.indexOf(":")&&(e=f.replace(e)),g.insertRule(e,k));e=!0}else e=!1;return e})},unloadStyleSheet:function(a){var b=this.getGlobal();b&&b.require&&b.require("dojo/query")("link").filter(function(b){return b.getAttribute("href")==
a}).forEach(m.destroy)},addModeledStyleSheet:function(a,b){b||this.loadStyleSheet(a);if(!this.model.hasStyleSheet(a)){var f=-1<a.indexOf("app.css"),g,k=this.model.find({elementType:"HTMLElement",tag:"style"},!0);if(k)for(var k=k.children,h=0;h<k.length;h++)-1<k[h].url.indexOf("app.css")&&(g=k[h]);this.model.addStyleSheet(a,void 0,void 0,f?void 0:g);for(var n in this.model._loadedCSS)this._loadedCSSConnects.push(e.connect(this.model._loadedCSS[n],"onChange",this,"_themeChange"))}},loadStyleSheet:function(a){var b=
this.getDocument(),f=this.getGlobal().require("dojo/query")("link");f.some(function(b){return b.getAttribute("href")===a})||dojo.withDoc(b,function(){var g=b.getElementsByTagName("head")[0],e=-1<a.indexOf("app.css"),k=-1<a.indexOf("content.css"),h=-1<a.indexOf("claro.css"),n=-1<a.indexOf("claro/document.css"),e=!e&&!k&&!n&&!h,p,e=!1,h=m.create("link",{rel:"stylesheet",type:"text/css",href:a});f.forEach(function(a){-1<a.href.indexOf("app.css")?p=a:a.href.indexOf("content.css")});var w;k||(w=p);e?g.appendChild(h):
w?g.insertBefore(h,w):g.appendChild(h)})},getStyle:function(){return this._header?this._header.style:void 0},setStyle:function(a){var b=g.parseStyleValues(a);if(this._header){var f=g.parseStyleValues(this._header.style);if(f)for(var e in f)b[e]||(b[e]=void 0);this._header.style=a}else this._header={style:a}},getAppCssRelativeFile:function(){this._appCssRelativeFile||(this._appCssRelativeFile=this.getRelativeFileString("app.css"));return this._appCssRelativeFile},_addCssForDevice:function(a,b,f){f=
0;for(var g=b.length;f<g;f++){var h=b[f];if(h[0]===a||".*"===h[0]){this.themeCssFiles||(this.themeCssFiles=[]);this.themeCssFiles=this.themeCssFiles.concat(h[2]);this._themePath=new k(this.visualEditor.fileName);this._getCssFiles().forEach(function(a){this._loadedCSSConnects.push(e.connect(a,"onChange",this,"_themeChange"))},this);break}}}})})},"davinci/ve/_ContextJS":function(){define("dojo/_base/declare dojo/_base/xhr dojo/Deferred dojo/promise/all xide/factory xide/types ../html/HTMLElement ../html/HTMLText dojox/html/_base".split(" "),
function(p,m,h,e,b,k,a,g){return p(null,{_getAppJsRelativeFile:function(){this._appJsRelativeFile||(this._appJsRelativeFile=this.getRelativeFileString("app.js"));return this._appJsRelativeFile},addJavaScriptSrc:function(a,f,d,c){var g=/\/dojo.js$/.test(a),h=[];if(!this._didDojo){if(!g&&!c){var p=this;c=(new dojo._Url(this.getDocument().baseURI,a)).toString();h.push(m.get({url:c,sync:!0}).then(function(a){p.getGlobal().eval(a)}))}if(f){c=this.getDocumentElement().getChildElement("head");f={parseOnLoad:!0,
async:!0,packages:this._getLoaderPackages()};var z=this;c=c.getChildElements("script").some(function(c){var f=c.getAttribute("src");if(f&&-1<f.indexOf(d))return g&&(b.publish(k.EVENTS.ON_SET_DOJO_URL,{data:{dojoUrl:a},context:z,editor:z.editor},this),c=c.getAttribute("src"),/\/dojo.js$/.test(c)||z.addHeaderScript(c)),!0;z.addHeaderScript(f)});f.packages=f.packages.concat(this._customWidgetPackages);c?g&&this._updateDojoConfig(f):g?(b.publish(k.EVENTS.ON_SET_DOJO_URL,{data:{dojoUrl:a},context:this,
editor:this.editor},this),this.addHeaderScript(a,{"data-dojo-config":JSON.stringify(f).slice(1,-1).replace(/"/g,"'")}),h.push(this.addJavaScriptModule("dijit/dijit",!0,!0)),h.push(this.addJavaScriptModule("dojo/parser",!0,!0)),this._didDojo=!0):this.addHeaderScript(a)}return e(h)}},addJavaScriptModule:function(a,b,d){var c=new h;d?c.resolve():this.getGlobal().require([a],function(a){c.resolve(a)});if(b){if(!this._requireHtmlElem&&!this.getDocumentElement().getChildElement("head").getChildElements("script").some(function(a){var b=
a.find({elementType:"HTMLText"},!0);if(b&&this._reRequire.test(b.getText()))return this._requireHtmlElem=a,!0},this))return this._requireHtmlElem=this.addHeaderScriptText('require(["'+a+'"]);\n'),c;b=this._requireHtmlElem.find({elementType:"HTMLText"},!0);d=b.getText();var g=d.match(this._reRequire)[1].match(this._reModuleId);-1===g.indexOf(a)&&(g.push(a),d=d.replace(this._reRequire,"require("+JSON.stringify(g,null,"  ")+")"),b.setText(d),b.parent.setScript(d))}return c},addJavaScriptText:function(a,
b,d){if(!d)try{this.getGlobal().eval(a)}catch(c){d=a.length,console.error('eval of "'+a.substr(0,20)+(20<d?"...":"")+'" failed')}b&&this.addHeaderScriptText(a)},addHeaderScript:function(b,f){var d=new a("script");d.addAttribute("type","text/javascript");d.addAttribute("src",b);if(f)for(var c in f)d.addAttribute(c,f[c]);this.getDocumentElement().getChildElement("head").addChild(d)},addHeaderScriptText:function(b){var f=this.getDocumentElement().getChildElement("head"),d,c=f.children,e,k;for(e=c.length-
1;0<=e;e--)if(k=c[e],"HTMLElement"===k.elementType&&"script"===k.tag){d=k.find({elementType:"HTMLText"},!0);break}d||(c=new a("script"),c.addAttribute("type","text/javascript"),c.script="",f.addChild(c),d=new g,c.addChild(d));f=d.getText();-1===f.indexOf(b)&&(d.setText(f+"\n"+b),d.parent.setScript(f+"\n"+b));return d.parent}})})},"davinci/ve/_ContextDelite":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/xhr dojo/dom-class dojo/dom-construct dojo/dom-style dojo/query dojo/Deferred dojo/promise/all dojo/_base/connect dojo/topic dojo/window xide/utils xide/factory xide/types system/resource ../UserActivityMonitor ../Theme ./ThemeModifier ../commands/CommandStack ./commands/ChangeThemeCommand ./tools/SelectTool ../model/Path ../Runtime ../Workbench ./widget ./Focus ../library ./metadata ./ChooseParent ./Snap ./States ./HTMLWidget ../html/HTMLElement ../html/HTMLText ../workbench/Preferences ./utils/GeomUtils dojo/text!./newfile.template.html ./utils/pseudoClass dojox/html/_base".split(" "),
function(p){return p(null,{})})},"davinci/UserActivityMonitor":function(){define(["require","dojo/_base/xhr","dojo/i18n!./nls/webContent"],function(p,m,h){return{setUpInActivityMonitor:function(e,b){b.singleUserMode()?this._MaxInactiveInterval=-1:(this._firstPoll=!0,this._MaxInactiveInterval=300,this.keepAlive(b),this.addInActivityMonitor(e),b.subscribe("/dojo/io/load",this.lastServerConnection),this.userActivity())},addInActivityMonitor:function(e){return-1===this._MaxInactiveInterval?[]:[dojo.connect(e.documentElement,
"keydown",this,"userActivity"),dojo.connect(e.documentElement,"mousedown",this,"userActivity")]},userActivity:function(e){this.countdown&&this.resetIdle();this._idleTimer&&window.clearTimeout(this._idleTimer);0<this._MaxInactiveInterval&&(e=1E3*this._MaxInactiveInterval,this._idleTimer=window.setTimeout(function(){this.idle()}.bind(this),e))},keepAlive:function(e){return m.get({url:e.cmdOffset+"cmd/keepalive",handleAs:"json"}).then(function(b){b.MaxInactiveInterval&&(this._MaxInactiveInterval=b.MaxInactiveInterval,
this._firstPoll&&(delete this._firstPoll,this.userActivity(null)))}.bind(this),function(b){})},lastServerConnection:function(e,b){this._serverPollTimer&&window.clearTimeout(this._serverPollTimer);if(0<this._MaxInactiveInterval){var k=800*this._MaxInactiveInterval;this._serverPollTimer=window.setTimeout(function(){this.keepAlive()}.bind(this),k)}},idle:function(){this.warnDiv=dojo.create("div",{"class":"idleWarning",innerHTML:dojo.string.substitute(h.idleSessionMessage,{seconds:30})},dojo.byId("davinci_app"),
"first")},resetIdle:function(e){window.clearInterval(this.countdown);delete this.countdown;this.warnDiv.parentNode.removeChild(this.warnDiv);delete this.warnDiv;this.userActivity()}}})},"davinci/ve/ThemeModifier":function(){define("dojo/_base/declare ../model/Path ../model/Factory ./utils/URLRewrite ./commands/ModifyRuleCommand ./commands/StyleCommand dojo/i18n!davinci/ve/nls/common system/resource".split(" "),function(p,m,h,e,b,k,a,g){return p("davinci.ve.ThemeModifier",null,{_getCssFiles:function(){if(this.cssFiles)return this.cssFiles;
this.cssFiles=[];if(this.themeCssFiles){var a=this._themePath.getParentPath();this.cssFiles=this.themeCssFiles.map(function(b){return h.getModel({url:a.append(b).toString(),includeImports:!0})})}return this.cssFiles},_getThemeResource:function(a){a=this._themePath.getParentPath().append(a).toString();return system.resource.findResource(a)},getDeltaRule:function(a){var b=null,d=this.cssFiles[0],c=a.getSelectorText();this.cssFiles.forEach(function(a){var g=a.getRules(c);0<g.length&&(d=a);g.forEach(function(c){c.parent.url==
a.url&&(b=c)}.bind(this))}.bind(this));!b&&d&&(b=d.addRule(c+" {}"));return b},_markDirty:function(a,b){this._dirtyResource||(this._dirtyResource={});this._dirtyResource[a]={time:Date.now(),modelObject:b};this._srcChanged()},getCommandForStyleChange:function(a,f){var d=f||this.getSelection(),c=d.length?d[d.length-1]:void 0;1<d.length&&this.select(c);if("inline"==a.appliesTo){for(var g=[],h=new m(this.fileName),d=0;d<a.values.length;d++)for(var p in a.values[d]){if(e.containsUrl(a.values[d][p])&&!e.isAbsolute(a.values[d][p])){var z=
new m(e.getUrl(a.values[d][p]));if(z.isAbsolute){var y={};y[p]=a.values[d][p]}else z=z.relativeTo(h).toString(),e.replaceUrl(a.values[d][p],z)}else y={},y[p]=a.values[d][p];g.push(y)}c=new k(c,g,a.applyToWhichStates)}else{if("proposal"==a.appliesTo.type){c=this.model.find({elementType:"CSSFile",relativeURL:a.appliesTo.targetFile},!0);if(!c&&this.cssFiles){for(d=0;this.cssFiles.length;d++)if(this.cssFiles[d].url===a.appliesTo.targetFile){c=this.cssFiles[d];break}if(!c)return}c=c.addRule(a.appliesTo.ruleString+
" {}")}else c=a.appliesTo.rule;c=new b(c,a.values,this)}return c},saveDynamicCssFiles:function(b,f){var d=[],c={visit:function(b){"CSSFile"==b.elementType&&b.isDirty()&&d.push(b.save(f).then(function(a){f||g.findResource(b.url).removeWorkingCopy();b.dirtyResource=f;return b},function(c){console.error(dojo.string.substitute(a.errorSavingFile,[b.url,c]));return c}));return!1}};b&&b.forEach(function(a){a.visit(c)});return d},dirtyDynamicCssFiles:function(a){if(null==a)return console.error("dirtyDynamicCssFiles:invalid arg"),
!1;var b=!1,d={visit:function(a){"CSSFile"==a.elementType&&a.isDirty()&&(b=!0);return b}};a&&a.forEach(function(a){if(b)return b;a.visit(d)});return b},close:function(){this.cssFiles&&this.cssFiles.forEach(function(a){a.close();require("davinci/model/Factory").closeModel(a)}.bind(this));delete this.cssFiles},destroy:function(){this.close()}})})},"davinci/ve/commands/ModifyRuleCommand":function(){define(["dojo/_base/declare","../States","../../html/CSSModel"],function(p,m,h){var e=function(b,e){b.removeAllProperties();
e.forEach(function(a){b.addProperty(a.name,a.value)})};return p("davinci.ve.commands.ModifyRuleCommand",null,{name:"modify rule",constructor:function(b,e,a){this.cssRule=b;this.values=e;this.context=a},execute:function(b){this.context||(this.context=b);if(this.cssRule&&this.values&&this.context){this._oldValues=this.cssRule.getProperties();b=this.cssRule;var e=this.values,a,g,n=[],f=[];for(a=0;a<e.length;a++)for(var d in e[a])(g=b.getProperty(d))&&f.push(g),b.removeProperty(d);for(a=0;a<b.properties.length;a++){g=
b.properties[a];var c={};c[g.name]=g.value;n.push(c)}e=n.concat(dojo.clone(e));g=h.shorthand;for(a=n=0;a<g.length;a++){a:{for(var c=g[a][0],m=0;m<e.length;m++)if(e[m].hasOwnProperty(c)){c=m;break a}c=-1}-1<c&&(m=e[c],e.splice(c,1),e.splice(n,0,m),n++)}for(a=b.properties.length-1;0<=a;a--)if(g=b.properties[a])f.push(b.getProperty(g.name)),b.removeProperty(g.name);for(a=0;a<e.length;a++)for(d in e[a])if(e[a][d]&&""!==e[a][d])for(b.addProperty(d,e[a][d]),g=0;g<f.length;g++)if(f[g].name===d){n=b.getProperty(d,
e[a][d]);f[g].comment&&(n.comment=f[g].comment);f[g].postComment&&(n.postComment=f[g].postComment);f.splice(g,1);break}this._setDirty()}},undo:function(){this.cssRule&&this._oldValues&&this.context&&(e(this.cssRule,this._oldValues),this._setDirty())},_setDirty:function(){this.cssRule.getCSSFile().setDirty(!0);this.context.editor.setDirty(!0);m.resetState(this.context.rootNode);this.context._selection&&(this.context._forceSelectionChange=!0)}})})},"davinci/ve/tools/SelectTool":function(){define("dojo/_base/declare dojo/dom-geometry ../../Workbench ../../workbench/Preferences ./_Tool ../widget ../metadata dojo/dnd/Mover ../../XPathUtils ../../html/HtmlFileXPathAdapter ../Snap ../../commands/CompoundCommand ../commands/AddCommand ../commands/ReparentCommand ../commands/MoveCommand ../commands/ResizeCommand ../commands/ModifyCommand ../tools/CreateTool ../States ../utils/GeomUtils".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y,B,x,w){return p("davinci.ve.tools.SelectTool",b,{CONSTRAIN_MIN_DIST:3,activate:function(a){this._context=a},deactivate:function(){this._setTarget(null)},onMouseDown:function(b){var c=this._context;if(!c.isFocusNode(b.target)){this._shiftKey=b.shiftKey;this._sKey=this._spaceKey=!1;this._areaSelectClear();var d=this._checkFocusXY(b.pageX,b.pageY);d&&"NONE"!==a.getAllowedChild(d.type)[0]&&(d=null);var f=this._getTarget()||k.getEnclosingWidget(b.target);for(d||
(d=f);d&&!d.getContext();)d=k.getEnclosingWidget(d.domNode.parentNode);if(d)if(dojo.isMac&&b.ctrlKey||2==b.button)c.select(d);else{for(var e=c.getSelection(),h=null,n=0;n<e.length;n++){for(var q=e[n],p=d;p&&p!=c.rootWidget;){if(p==q){h=q;break}p=p.getParent()}if(h)break}p=null;n=dojo.isMac?b.metaKey:b.ctrlKey;this._mouseDownInfo=null;if(0<=dojo.indexOf(e,d))n?c.deselect(d):(p=d,this._mouseDownInfo={widget:d,eventTargetWidget:f,pageX:b.pageX,pageY:b.pageY,dateValue:Date.now()});else if(n){if(d==c.rootWidget)return;
c.select(d,n)}else if(h)p=h,this._mouseDownInfo={widget:d,eventTargetWidget:f,pageX:b.pageX,pageY:b.pageY,dateValue:Date.now()};else{if(d==c.rootWidget){c.deselect();this._areaSelectInit(b.pageX,b.pageY);return}"NONE"===a.getAllowedChild(d.type)[0]?(c.select(d,n),p=d):(this._mouseDownInfo={widget:d,eventTargetWidget:f,pageX:b.pageX,pageY:b.pageY,dateValue:Date.now()},this._areaSelectInit(b.pageX,b.pageY))}if(p&&(d=c.getDocument(),e=d.defaultView&&d.defaultView.dojo)&&(e=e.style(p.domNode,"position"),
this._moverAbsolute="absolute"==e,e=p.getParent(),f=p.getHelper(),!(f&&f.disableDragging&&f.disableDragging(p)||e&&e.isLayout&&e.isLayout()))){this._moverWidget=p;this._moverWidgets=[p];this._moverLastEventTarget=null;c._chooseParent.setProposedParentWidget(null);e=c.getSelection();this._moverStartLocations=[];this._moverStartLocationsRel=[];for(n=0;n<e.length;n++){e[n]!=p&&this._moverWidgets.push(e[n]);h=null;h=(h=e[n].getHelper())&&h.getMarginBoxPageCoords?h.getMarginBoxPageCoords(e[n]):w.getMarginBoxPageCoordsCached(e[n].domNode);
this._moverStartLocations.push(h);if((q=e[n].domNode.offsetParent)&&"BODY"!=q.tagName)var r=w.getBorderBoxPageCoordsCached(q),u=m.getBorderExtents(q),q=h.l-(r.l+u.l),h=h.t-(r.t+u.t);else q=h.l,h=h.t;this._moverStartLocationsRel.push({l:q,t:h})}n=p.domNode;h=n.offsetWidth;e=n.offsetHeight;q=null;f&&f.getMarginBoxPageCoords?(q=f.getMarginBoxPageCoords(p),h=q.w,e=q.h):q=w.getMarginBoxPageCoordsCached(n);n=q.l;f=q.t;p=q.w;q=q.h;r=c.getScrollOffset();n+=r.x;f+=r.y;this._moverAbsolute?this._moverDragDiv=
dojo.create("div",{className:"selectToolDragDiv",style:"left:"+n+"px;top:"+f+"px;width:"+p+"px;height:"+q+"px"},c.rootNode):(p=h+10,e+=10,h=p-8,q=e-8,this._moverDragDiv=dojo.create("div",{className:"flowDragOuter",style:"left:"+(n-5)+"px;top:"+(f-5)+"px;width:"+p+"px;height:"+e+"px"},c.rootNode),dojo.create("div",{className:"flowDragInner",style:"width:"+h+"px;height:"+q+"px"},this._moverDragDiv));this._mover=new g(this._moverDragDiv,b,this);this._altKey=b.altKey;this._updateMoveCursor();(b=document.getElementById("maqetta_project_select"))&&
b.focus();d.defaultView.focus()}}}},onMouseUp:function(a){var b=this._context;if(!b.isFocusNode(a.target)){var c=1===a.which,d=Date.now();this._mouseDownInfo&&(10>=Math.abs(a.pageX-this._mouseDownInfo.pageX)&&10>=Math.abs(a.pageY-this._mouseDownInfo.pageY)&&750>=d-this._mouseDownInfo.dateValue&&(this._context.select(this._mouseDownInfo.eventTargetWidget?this._mouseDownInfo.eventTargetWidget:this._mouseDownInfo.widget),c=!1),this._mouseDownInfo=null);if(this._lastMouseUp&&10>=Math.abs(a.pageX-this._lastMouseUp.pageX)&&
10>=Math.abs(a.pageY-this._lastMouseUp.pageY)&&750>=d-this._lastMouseUp.dateValue)this.onDblClick(a);this._lastMouseUp={pageX:a.pageX,pageY:a.pageY,dateValue:d};b.getScrollOffset();this._areaSelect&&c&&this._areaSelectSelectWidgets(a.pageX,a.pageY);this._areaSelectClear()}},onDblClick:function(a){if(!this._context.isFocusNode(a.target)){for(var b="selectToolDragDiv"===a.target.getAttribute("class")?this._context.getSelection()[0]:this._getTarget()||k.getEnclosingWidget(a.target);b&&!b.getContext();)b=
k.getEnclosingWidget(b.domNode.parentNode);if(b){var c=this._context.getSelection(),d=dojo.isMac?a.ctrlKey:a.metaKey;0<=dojo.indexOf(c,b)?d&&2!==a.button?this._context.deselect(b):2!==a.button&&this._context.select(b,null,!0):this._context.select(b,d,!0)}}},onMouseMove:function(a){this._context.isFocusNode(a.target)||(this._setTarget(a.target,a),this._areaSelect&&(1===a.which?this._areaSelectUpdate(a.pageX,a.pageY):this._areaSelectClear()))},onMouseOver:function(a){try{dojo.hasClass(a.target,"editFeedback")||
dojo.hasClass(a.target,"selectToolDragDiv")||(this._onMouseOverEventTargetXPath=n.getXPath(a.target)),this._setTarget(a.target,a)}catch(b){}},onMouseOut:function(a){try{this._setTarget(a.relatedTarget,a)}catch(b){}},onExtentChange:function(b){var d=b.index,f=b.newBox,g=b.copy,e=b.oldBoxes,h=b.applyToWhichStates,n,p=this._context,x=p._chooseParent,y=p.getSelection(),K=[];if(!(y.length<=d)){var F=y[d],J=void 0;if("w"in f||"h"in f){var d=a.queryDescriptor(F.type,"resizable"),H,P;b=F.domNode;var R=b.ownerDocument.defaultView.getComputedStyle(b),
x=w.getMarginExtents(b,R),O=m.getBorderExtents(b,R);b=m.getPadExtents(b,R);"number"==typeof f.w&&(f.w-=x.w+O.w+b.w);"number"==typeof f.h&&(f.h-=x.h+O.h+b.h);switch(d){case "width":H=f.w;break;case "height":P=f.h;case "both":H=f.w,P=f.h}d=new z(F,H,P,h);J||(J=new c);J.add(d);d=dojo.style(F.domNode,"position");"l"in f&&"t"in f&&"absolute"==d&&(H=f.l,f=f.t,f=new r(F,H,f,null,null,h),J.add(f))}else if(b=F.getStyleNode(),"absolute"!=dojo.style(b,"position")){var Q=x.getProposedParentWidget();if(Q){J||
(J=new c);var V=null;b=p.reorderPreserveSiblingOrder(y);dojo.forEach(b,function(a){Q.refChild&&(null!==V?n=V+1:(n=Q.parent.getChildren().indexOf(Q.refChild),0<=n?Q.refAfter&&n++:n=null),V=n);if(g){var b,c=a.getData({identify:!1});c.context=p;dojo.withDoc(p.getDocument(),function(){b=k.createWidget(c)},this);b&&(J.add(new q(b,Q.parent,n)),B.prototype.checkAddToCurrentState(J,b),K.push(b))}else J.add(new u(a,Q.parent,n)),K.push(a)},this);p.select(null)}else console.error("SelectTool: ppw is null")}else{var X=
[],Y=[];dojo.forEach(y,function(a,b){X[b]=y[b].getParent();Y[b]=X[b].indexOf(a)});H=f.l;f=f.t;J||(J=new c);var U=(Q=x.getProposedParentWidget())?Q.parent:null;b=F.getParent();P=void 0;U&&U!=b&&(P=U);var Z=H-e[0].l,aa=f-e[0].t;g&&(b=p.reorderPreserveSiblingOrder(y),dojo.forEach(b,function(a){var b=a.getParent();if(b){for(var c=b.getChildren(),d=0;d<c.length&&c[d]!=a;d++);var f,g=a.getData({identify:!1});g.context=p;dojo.withDoc(p.getDocument(),function(){f=k.createWidget(g)},this);f&&(U?J.add(new q(f,
U,-1)):J.add(new q(f,b,d)),B.prototype.checkAddToCurrentState(J,f),K.push(f))}},this),newWidget=K[d]);var S=g?newWidget:F,T=new r(S,H,f,null,e[d],h);J.add(T);P&&(J.add(new u(S,U,"last")),J.add(new r(S,H,f,null,null,h)));dojo.forEach(y,dojo.hitch(this,function(a,b){S=g?K[b]:a;if(a!=F){var c=e[b].l+Z,d=e[b].t+aa;if("absolute"==a.getStyleNode().style.position){var f=new r(S,c,d,T,e[b],h,!0);J.add(f)}f=a.getParent();U&&U!=f&&(J.add(new u(S,U,"last")),J.add(new r(S,c,d,null,null,h,!0)))}}));g&&dojo.forEach(y,
dojo.hitch(this,function(a,b){J.add(new u(y[b],X[b],Y[b]));J.add(new r(y[b],e[b].l,e[b].t,null,e[b],h,!0))}))}J?(p.getCommandStack().execute(J),dojo.forEach(K,function(a,b){p.select(a,0<b)},this)):p.select(F)}},_updateMoveCursor:function(){var a=this._context.getDocument().body;this._moverDragDiv&&(this._altKey?dojo.addClass(a,"selectToolDragCopy"):dojo.addClass(a,"selectToolDragMove"))},onKeyDown:function(a){if(a)switch(dojo.stopEvent(a),a.keyCode){case dojo.keys.SHIFT:this._shiftKey=!0;d.clearSnapLines(this._context);
break;case dojo.keys.ALT:this._altKey=!0;this._updateMoveCursor();break;case dojo.keys.SPACE:this._spaceKey=!0;break;case 83:this._sKey=!0;break;case dojo.keys.TAB:this._moveFocus(a)&&dojo.stopEvent(a);break;case dojo.keys.RIGHT_ARROW:case dojo.keys.LEFT_ARROW:case dojo.keys.DOWN_ARROW:case dojo.keys.UP_ARROW:this._move(a)}},onKeyUp:function(a){if(a&&this._moverWidget)switch(dojo.stopEvent(a),a.keyCode){case dojo.keys.SHIFT:this._shiftKey=!1;break;case dojo.keys.ALT:this._altKey=!1;this._updateMoveCursor();
break;case dojo.keys.SPACE:this._spaceKey=!1;break;case 83:this._sKey=!1}},_move:function(a){var b=this._context.getSelection();if(0!==b.length){var d=0,f=0,g=a.shiftKey?10:1;switch(a.keyCode){case dojo.keys.RIGHT_ARROW:d=g;break;case dojo.keys.LEFT_ARROW:d=-g;break;case dojo.keys.DOWN_ARROW:f=g;break;case dojo.keys.UP_ARROW:f=-g}var e=new c;dojo.forEach(b,function(a){var b=null,b=(b=a.getHelper())&&b.getMarginBoxPageCoords?b.getMarginBoxPageCoords(a):w.getMarginBoxPageCoords(a.domNode);e.add(new r(a,
b.l+d,b.t+f))},this);e.isEmpty()||(this._context.getCommandStack().execute(e),this._updateTargetOverlays())}},_moveFocus:function(a){a=a.shiftKey?-1:1;for(var b=this._context.getSelection()[0],c=this._context.getTopWidgets(),b=b?dojo.indexOf(c,b)+a:0<a?0:c.length-1,d=c[b];d&&!d.getContext();)b+=a,d=c[b];d&&this._context.select(d);return d},onMove:function(a,b,c){this._mouseDownInfo=null;a=this._context;var d=a._chooseParent,f=a.getSelection(),g=f.indexOf(this._moverWidget);if(0>g)console.error("SelectTool.js onMove error. move widget is not selected");
else{this._selectionHideFocus();var k=!1,n=d.getProposedParentWidget();if(n&&n.parent&&n.parent.domNode){var m=n.parent.domNode;if("BODY"==n.parent.domNode.tagName)k=!0;else for(n=c.target;n&&"BODY"!=n.tagName;){if(n==m){k=!0;break}n=n.parentNode}}k&&c.target==this._moverLastEventTarget||d.setProposedParentWidget(null);this._moverLastEventTarget=c.target;this._moverBox=b;this._moverDragDiv.style.left=b.l+"px";this._moverDragDiv.style.top=b.t+"px";if(this._moverAbsolute)for(k=b.l-this._moverStartLocations[g].l,
b=b.t-this._moverStartLocations[g].t,g=Math.abs(k),m=Math.abs(b),this._shiftKey&&(g>=this.CONSTRAIN_MIN_DIST||m>=this.CONSTRAIN_MIN_DIST)&&(g>m?b=0:k=0),g=0;g<f.length;g++)m=f[g],n=this._moverStartLocationsRel[g].t,m.domNode.style.left=this._moverStartLocationsRel[g].l+k+"px",m.domNode.style.top=n+b+"px";k=this._moverWidget.type;f=this._moverWidget.getParent();(b=d.parentListDivGet())||(b=d.parentListDivCreate({widgetType:k,absolute:this._moverAbsolute,doCursor:!this._moverAbsolute,beforeAfter:null,
currentParent:f}));if(g=a.getParentIframe()){offsetTop=offsetLeft=0;for(offsetNode=g;offsetNode&&"BODY"!=offsetNode.tagName;)offsetLeft+=offsetNode.offsetLeft,offsetTop+=offsetNode.offsetTop,offsetNode=offsetNode.offsetParent;g=w.getScrollLeft(a.rootNode.parentNode);m=w.getScrollTop(a.rootNode.parentNode);b.style.left=offsetLeft+c.pageX-g+"px";b.style.top=offsetTop+c.pageY-m+"px"}b=e.getPreferences("davinci.ve.editorPrefs",h.getProject());b=!this._shiftKey&&b.snap&&this._moverAbsolute;g=a.getPreference("showPossibleParents");
g=!0;d=d.isSpaceKeyDown()||this._spaceKey;d=!g&&d||g&&!d;k={type:k};g={x:c.pageX,y:c.pageY};m=null;m=(m=this._moverWidget.getHelper())&&m.getMarginBoxPageCoords?m.getMarginBoxPageCoords(this._moverWidget):w.getMarginBoxPageCoords(this._moverWidget.domNode);a.dragMoveUpdate({widgets:this._moverWidgets,data:k,eventTarget:c.target,position:g,absolute:this._moverAbsolute,currentParent:f,rect:m,doSnapLinesX:b,doSnapLinesY:b,doFindParentsXY:d,doCursor:!this._moverAbsolute})}},onFirstMove:function(a){},
onMoveStart:function(a){},onMoveStop:function(a){a=this._context;var b=this._context._chooseParent;this._moverWidget&&this._moverWidget._srcElement&&n.getXPath(this._moverWidget._srcElement,f);var c=!0,d,g;this._moverBox&&this._moverWidget&&this._moverWidget.domNode?(g={l:this._moverBox.l,t:this._moverBox.t},d=a.getSelection().indexOf(this._moverWidget),0>d&&(c=!1)):c=!1;if(c){c=void 0;if(this._sKey)for(var e=x.getStatesListCurrent(this._moverWidget.domNode),k=0;k<e.length;k++){if(e[k]){c=e[k];break}}else c=
x.propertyDefinedForAnyCurrentState(this._moverWidget.domNode,["left","top","right","bottom"]);var h=this._getPageLeftTop(this._moverWidget.domNode.offsetParent),e=a.getScrollOffset(),k=g.t-h.t-this._moverStartLocations[d].t,h=Math.abs(g.l-h.l-this._moverStartLocations[d].l),k=Math.abs(k);this._shiftKey&&(h>=this.CONSTRAIN_MIN_DIST||k>=this.CONSTRAIN_MIN_DIST)&&(h>k?g.t=this._moverStartLocations[d].t:g.l=this._moverStartLocations[d].l);g.t-=e.y;g.l-=e.x;this.onExtentChange({index:d,newBox:g,oldBoxes:this._moverStartLocations,
copy:this._altKey,applyToWhichStates:c})}this._moverDragDiv&&((d=this._moverDragDiv.parentNode)&&d.removeChild(this._moverDragDiv),this._moverDragDiv=null);this._mover=this._moverBox=this._moverWidget=this._moverWidgets=this._moverLastEventTarget=null;this._updateMoveCursor();a.dragMoveCleanup();b.parentListDivDelete();this._selectionShowFocus();b=n.toCssPath(this._onMouseOverEventTargetXPath);a=a.getDocument();(a=b?a.querySelector(b):null)&&this._setTarget(a)},_getPageLeftTop:function(a){if(a){var b=
a.offsetLeft,c=a.offsetTop;for(a=a.offsetParent;a&&"BODY"!=a.tagName;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;return{l:b,t:c}}return{l:0,t:0}},_areaSelectInit:function(a,b){this._areaSelect={x:a,y:b,attached:!1};this._areaSelectDiv=dojo.create("div",{className:"areaSelectDiv",style:"display:none"})},_areaSelectUpdate:function(a,b){if(this._areaSelect&&this._areaSelectDiv){var c=this._getBounds(this._areaSelect.x,this._areaSelect.y,a,b),d=this._areaSelectDiv.style;d.display="block";d.left=
c.l+"px";d.top=c.t+"px";d.width=c.w+"px";d.height=c.h+"px";this._areaSelect.attached||(this._context.rootNode.appendChild(this._areaSelectDiv),this._areaSelect.attached=!0)}},_areaSelectClear:function(){this._areaSelect=null;if(this._areaSelectDiv){var a=this._areaSelectDiv.parentNode;a&&a.removeChild(this._areaSelectDiv);this._areaSelectDiv=null}},_areaSelectSelectWidgets:function(a,b){if(this._areaSelect){var c=this._getBounds(this._areaSelect.x,this._areaSelect.y,a,b),d=c.l,f=c.t,g=c.w,c=c.h,e=
this._context;e.deselect();for(var e=e.getTopWidgets(),k=0;k<e.length;k++)this._areaSelectRecursive(e[k],d,f,g,c)}},_areaSelectRecursive:function(a,b,c,d,f){if(a&&a.domNode){var g=w.getBorderBoxPageCoordsCached(a.domNode);if(g.l>=b&&g.t>=c&&g.l+g.w<=b+d&&g.t+g.h<=c+f)this._context.select(a,!0);else for(a=a.getChildren(),g=0;g<a.length;g++)this._areaSelectRecursive(a[g],b,c,d,f)}},_getBounds:function(a,b,c,d){var f={};a<=c?(f.l=a,f.w=c-a):(f.l=c,f.w=a-c);b<=d?(f.t=b,f.h=d-b):(f.t=d,f.h=b-d);return f},
_checkFocusXY:function(a,b){for(var c=this._context,d=c.getSelection(),f=0;f<d.length;f++){var g=c._focuses[f].getBounds();if(a>=g.l&&a<=g.l+g.w&&b>=g.t&&b<=g.t+g.h)return d[f]}return null},_selectionHideFocus:function(){for(var a=this._context,b=a.getSelection(),c=0;c<b.length;c++)a._focuses[c].hide()},_selectionShowFocus:function(){for(var a=this._context,b=a.getSelection(),c=0;c<b.length;c++)a._focuses[c].show(b[c],{})}})})},"davinci/ve/Snap":function(){define(["davinci/ve/utils/GeomUtils"],function(p){dojo.getObject("davinci.ve.Snap",
!0);return davinci.ve.Snap={updateSnapLinesBeforeTraversal:function(m,h){m._snapX=null;m._snapY=null;if(m._lastSnapBox&&m._lastSnapBox.l==h.l&&m._lastSnapBox.t==h.t&&m._lastSnapBox.w==h.w&&m._lastSnapBox.h==h.h)return!1;snapBox={l:h.l,t:h.t,w:h.w,h:h.h,c:h.l+h.w/2,r:h.l+h.w,m:h.t+h.h/2,b:h.t+h.h};m._lastSnapBox=snapBox;return!0},findSnapOpportunities:function(m,h,e,b,k){function a(a,b,d,f){f<c&&(m._snapX={type:a,typeRefObj:a,typeCurrObj:b,x:d,widget:h,delta:f},c=f,m._snapXLast=m._snapX)}function g(a,
b,c,d){d<q&&(m._snapY={type:a,typeRefObj:a,typeCurrObj:b,y:c,widget:h,delta:d},q=d,m._snapYLast=m._snapY)}e=m._lastSnapBox;var n=h.domNode;if("BODY"!=n.tagName){var f=null,d=h.getHelper(),f=d&&d.getMarginBoxPageCoords?d.getMarginBoxPageCoords(h):p.getMarginBoxPageCoordsCached(n);m.getScrollOffset();f.x=f.l;f.y=f.t;var c=m._snapX?m._snapX.delta:6,q=m._snapY?m._snapY.delta:6,n={snapRect:{l:f.x,c:f.x+f.w/2,r:f.x+f.w,t:f.y,m:f.y+f.h/2,b:f.y+f.h}};d&&d.getSnapInfo&&(n=d.getSnapInfo(h,n));var d=n.snapRect,
u;if(d){if(b){b=m._snapXLast&&m._snapXLast.widget===h?Infinity:75;f=Math.abs(d.t-e.t);u=Math.abs(d.t-e.b);var r=Math.abs(d.b-e.t),z=Math.abs(d.b-e.b);if(f<=b||u<=b||r<=b||z<=b)b=Math.abs(d.l-e.l),f=Math.abs(d.c-e.c),u=Math.abs(d.r-e.r),a("left","left",d.l,b),a("center","center",d.c,f),a("right","right",d.r,u),a("left","center",d.c,Math.abs(d.c-e.l)),a("left","right",d.r,Math.abs(d.r-e.l)),a("right","left",d.l,Math.abs(d.l-e.r)),a("right","center",d.c,Math.abs(d.c-e.r)),a("center","left",d.l,Math.abs(d.l-
e.c)),a("center","right",d.r,Math.abs(d.r-e.c))}k&&(k=m._snapYLast&&m._snapYLast.widget===h?Infinity:75,b=Math.abs(d.l-e.l),f=Math.abs(d.l-e.r),u=Math.abs(d.r-e.l),r=Math.abs(d.r-e.r),b<=k||f<=k||u<=k||r<=k)&&(b=Math.abs(d.t-e.t),f=Math.abs(d.m-e.m),u=Math.abs(d.b-e.b),g("top","top",d.t,b),g("middle","middle",d.m,f),g("bottom","bottom",d.b,u),g("top","middle",d.m,Math.abs(d.m-e.t)),g("top","bottom",d.b,Math.abs(d.b-e.t)),g("bottom","top",d.t,Math.abs(d.t-e.b)),g("bottom","middle",d.m,Math.abs(d.m-
e.b)),g("middle","top",d.t,Math.abs(d.t-e.m)),g("middle","bottom",d.b,Math.abs(d.b-e.m)))}if(n=n.snapPoints)for(d=0;d<n.length;d++)k=n[d],b=Math.abs(k.x-e.l),f=Math.abs(k.x-e.c),u=Math.abs(k.x-e.r),a("point",k.x,b),a("point",k.x,f),a("point",k.x,u),b=Math.abs(k.y-e.t),f=Math.abs(k.y-e.m),u=Math.abs(k.y-e.b),g("point",k.y,b),g("point",k.y,f),g("point",k.y,u)}},updateSnapLinesAfterTraversal:function(m){function h(a,f,d,c){d.style.display="block";c.style.display="block";b=(c=f.getHelper())&&c.getMarginBoxPageCoords?
c.getMarginBoxPageCoords(f):p.getMarginBoxPageCoordsCached(f.domNode);a.getScrollOffset();b.x=b.l;b.y=b.t;b.r=b.x+b.w;b.b=b.y+b.h;b.c=b.x+b.w/2;b.m=b.y+b.h/2;d.style.left=b.x+"px";d.style.top=b.y+"px";d.style.width=b.w+"px";d.style.height=b.h+"px";d.style.backgroundColor="rgba(255,0,255,.05)"}var e=m.getContainerNode();m._snapLinesDiv||(m._snapLinesDiv=dojo.create("div",{"class":"snaplines",style:"position:absolute;top:0px;left:0px;z-index:1000001;pointer-events:none;"},e),m._snapLinesDivWidgetX=
dojo.create("div",{"class":"snaplinesWidgetX",style:"position:absolute;pointer-events:none;"},m._snapLinesDiv),m._snapLinesDivAlignX=dojo.create("div",{"class":"snaplinesAlignX",style:"position:absolute;pointer-events:none;"},m._snapLinesDiv),m._snapLinesDivWidgetY=dojo.create("div",{"class":"snaplinesWidgetY",style:"position:absolute;pointer-events:none;"},m._snapLinesDiv),m._snapLinesDivAlignY=dojo.create("div",{"class":"snaplinesAlignY",style:"position:absolute;pointer-events:none;"},m._snapLinesDiv));
m._snapLinesDiv.style.display="block";var b,e=m._snapLinesDivAlignX.style,k=m._snapLinesDivWidgetX.style;if(m._snapX){k=m._snapX;h(m,k.widget,m._snapLinesDivWidgetX,m._snapLinesDivAlignX);var a,g;b.y<snapBox.t?(a=b.y,g=snapBox.t-b.y):(a=snapBox.t,g=b.y-snapBox.t);e.left="point"==k.typeCurrObj?m._snapX.x+"px":"left"==k.typeCurrObj?b.x+"px":"center"==k.typeCurrObj?b.c+"px":b.r+"px";e.top=a+"px";e.width="1px";e.height=g+"px";e.backgroundColor="rgba(255,0,255,.75)"}else e.display="none",k.display="none";
e=m._snapLinesDivAlignY.style;k=m._snapLinesDivWidgetY.style;m._snapY?(k=m._snapY,h(m,k.widget,m._snapLinesDivWidgetY,m._snapLinesDivAlignY),b.x<snapBox.l?(m=b.x,a=snapBox.l-b.x):(m=snapBox.l,a=b.x-snapBox.l),e.top="point"==k.type?k.y+"px":"top"==k.typeCurrObj?b.y+"px":"middle"==k.typeCurrObj?b.m+"px":b.b+"px",e.left=m+"px",e.height="1px",e.width=a+"px",e.backgroundColor="rgba(255,0,255,.75)"):(e.display="none",k.display="none")},clearSnapLines:function(m){m._snapLinesDiv&&(m._snapLinesDiv.style.display=
"none");m._snapX=m._snapY=null}}})},"davinci/ve/commands/ReparentCommand":function(){define(["dojo/_base/declare","davinci/ve/commands/_hierarchyCommand","../widget","../States","davinci/ve/commands/ModifyCommand"],function(p,m,h,e,b){return p("davinci.ve.commands.ReparentCommand",[m],{name:"reparent",constructor:function(b,a,g){this._id=b?b.id:void 0;this._newParentId=a?a.id:"myapp";this._newIndex=g},execute:function(){if(this._id&&this._newParentId){var k=h.byId(this._id);if(k){var a=k.getParent();
a||(a=dojo.byId("myapp"));var g=h.byId(this._newParentId);g||(g=dojo.byId("myapp"));var n=this._isRefreshOnDescendantChange(k);this._oldParentId||(this._oldParentId=a.id,this._oldIndex=dojo.indexOf(a.getChildren(),k),this._newIndex&&this._newIndex.domNode&&(this._newIndex=g.indexOf(this._newIndex)));a.removeChild(k);var f=g.getContext();g.addChild(k,g==a&&this._oldIndex<this._newIndex?this._newIndex-1:this._newIndex);if(f){var d=k.getHelper();d&&d.reparent&&d.reparent(k);k.startup();k.renderWidget();
f.widgetChanged(f.WIDGET_REPARENTED,k,[a,g]);a=this._isRefreshOnDescendantChange(k);n&&(n=new b(n,null,null,f),n.execute());a&&(n=new b(a,null,null,f),n.execute())}e.resetState(k.domNode)}}},undo:function(){if(this._id&&this._oldParentId&&this._newParentId){var k=h.byId(this._id);if(k){var a=h.byId(this._oldParentId);if(a){var g=h.byId(this._newParentId);if(g){var n=this._isRefreshOnDescendantChange(k),f=a.getContext();g.removeChild(k);a.addChild(k,this._oldIndex);if(f){var d=k.getHelper();d&&d.reparent&&
d.reparent(k);k.startup();k.renderWidget();f.widgetChanged(f.WIDGET_REPARENTED,k,[a,g]);a=this._isRefreshOnDescendantChange(k);n&&(n=new b(n,null,null,f),n.execute());a&&(n=new b(a,null,null,f),n.execute())}e.resetState(k.domNode)}}}}}})})},"davinci/ve/Focus":function(){define("require dojo/_base/declare dojo/query dijit/_WidgetBase dojo/dnd/Mover ../Runtime ./metadata ./States ./utils/GeomUtils".split(" "),function(p,m,h,e,b,k,a,g,n){return m(e,{nobSize:11,frameSize:6,postCreate:function(){dojo.addClass(this.domNode,
"maqFocus");dojo.style(this.domNode,{position:"absolute",display:"none"});this._stdChrome=dojo.create("div",{"class":"editFocusStdChrome"},this.domNode);this._frames=[];for(var a=0;4>a;a++){var b=dojo.create("div",{"class":"editFocusFrame"},this._stdChrome);this._frames.push(b);this.connect(b,"onmousedown","onMouseDown")}dojo.addClass(this._frames[0],"editFocusFrameLEFT");dojo.addClass(this._frames[1],"editFocusFrameRIGHT");dojo.addClass(this._frames[2],"editFocusFrameTOP");dojo.addClass(this._frames[3],
"editFocusFrameBOTTOM");this._nobs=[];for(a=0;8>a;a++)b=dojo.create("div",{"class":"editFocusNob"},this._stdChrome),this._nobs.push(b),this.connect(b,"onmousedown","onMouseDown");this._frameIndex=this._nobIndex=-1;this._custom=dojo.create("div",{"class":"editFocusCustom"},this.domNode)},resize:function(a,b){b&&(this._selectedWidget=b);this._moverCurrent=dojo.mixin({},a);this._moverCurrentConstrained=dojo.mixin({},this._moverCurrent);this._updateFocusChrome(this._moverCurrent,!0);this._contexDiv&&
(this._contexDiv.style.left=a.w+10+"px",this._updateSubwidgetList());this._box=a},getBounds:function(){return this._moverCurrent},show:function(b,d){var c=d&&d.inline;if(b){this._custom.innerHTML="";var g=a.queryDescriptor(b.type,"showStandardSelectionChrome");this._stdChrome.style.display=!1===g?"none":"block";this.domNode.style.display="block";this._selectedWidget=b;var g=b.getHelper(),e=!0;if(g&&g.onShowSelection)g.onShowSelection({widget:b,customDiv:this._custom});c&&(this.showInline(b),e=!1);
e&&delete this._inline}},showInline:function(b){this._selectedWidget=b;var d=this._context,c=this;a.getSmartInput(b.type).then(function(a){if(a)if(c._inline=a,a.useParent){if(a=b.getParent())d.deselect(b),d.select(a),d.getFocus(a).showInline(a)}else a.show&&a.show(b.id)})},inlineEditActive:function(){return this._inline&&this._inline.inlineEditActive?this._inline.inlineEditActive():!1},hide:function(a){var b=(a=this._selectedWidget)?a.getHelper():void 0;if(b&&b.onHideSelection)b.onHideSelection({widget:a,
customDiv:this._custom});this.domNode.style.display="none";this._displayedWidget=this._selectedWidget=null;this._inline&&(this._inline.hide(),delete this._inline)},allow:function(a){if(a){this._op=a;var b={},c=this._selectedWidget.getHelper();c&&c.resizeAllowWhich?(c.resizeAllowWhich(this._selectedWidget,b),this._resizeLeft=b.resizeLeft,this._resizeRight=b.resizeRight,this._resizeTop=b.resizeTop,this._resizeBottom=b.resizeBottom):(this._resizeLeft=this._resizeRight=a.resizeWidth,this._resizeTop=this._resizeBottom=
a.resizeHeight);b.left=!this._resizeLeft||this._resizeTop||this._resizeBottom?"none":"block";b.right=!this._resizeRight||this._resizeTop||this._resizeBottom?"none":"block";b.top=!this._resizeTop||this._resizeLeft||this._resizeRight?"none":"block";b.bottom=!this._resizeBottom||this._resizeLeft||this._resizeRight?"none":"block";b.left_top=this._resizeLeft&&this._resizeTop?"block":"none";b.left_bottom=this._resizeLeft&&this._resizeBottom?"block":"none";b.right_top=this._resizeRight&&this._resizeTop?
"block":"none";b.right_bottom=this._resizeRight&&this._resizeBottom?"block":"none";this._nobs[0].style.display=b.left;this._nobs[1].style.display=b.right;this._nobs[2].style.display=b.top;this._nobs[3].style.display=b.bottom;this._nobs[4].style.display=b.left_top;this._nobs[5].style.display=b.left_bottom;this._nobs[6].style.display=b.right_top;this._nobs[7].style.display=b.right_bottom;this._nobs[0].style.cursor=this._frames[0].style.cursor=this._resizeLeft?"w-resize":"auto";this._nobs[1].style.cursor=
this._frames[1].style.cursor=this._resizeRight?"e-resize":"auto";this._nobs[2].style.cursor=this._frames[2].style.cursor=this._resizeTop?"n-resize":"auto";this._nobs[3].style.cursor=this._frames[3].style.cursor=this._resizeBottom?"s-resize":"auto";this._nobs[4].style.cursor="none"!=b.left_top?"nw-resize":"auto";this._nobs[5].style.cursor="none"!=b.left_bottom?"sw-resize":"auto";this._nobs[6].style.cursor="none"!=b.right_top?"ne-resize":"auto";this._nobs[7].style.cursor="none"!=b.right_bottom?"se-resize":
"auto"}},_updateFocusChrome:function(a,b){var c,g,e,k,h=this.nobSize+1,m=this.frameSize+1,p=dojo.byId("focusContainer");if(p){var p=n.getBorderBoxPageCoords(p),x=this._context.getParentIframe(),w=n.getBorderBoxPageCoords(x);a.l+=w.l;a.t+=w.t;if(x)if(x.contentDocument)if(x.contentDocument.body){x=x.contentDocument.body;a.l-=n.getScrollLeft(x);a.t-=n.getScrollTop(x);this.domNode.style.left=a.l-p.l+"px";this.domNode.style.top=a.t-p.t+"px";var x=p=-11,w=a.w,v=a.h,A=a.w,C=a.h,L=-6,E=-6,I=a.w,D=a.h,G=a.w+
4+4,N=a.h+4+4,M=this.domNode&&this.domNode.ownerDocument,K=M&&M.body;this._frames[0].style.left=this._frames[2].style.left=this._frames[3].style.left=L+"px";this._frames[0].style.top=this._frames[2].style.top=this._frames[1].style.top=E+"px";this._frames[0].style.height=N+"px";this._frames[1].style.height=N+"px";this._frames[1].style.left=I+"px";this._frames[2].style.width=G+"px";this._frames[3].style.top=D+"px";this._frames[3].style.width=G+"px";m=Math.round(A/2-this.nobSize/2);h=Math.round(C/2-
this.nobSize/2);this._nobs[0].style.left=this._nobs[4].style.left=this._nobs[5].style.left=p+"px";this._nobs[2].style.top=this._nobs[4].style.top=this._nobs[6].style.top=x+"px";this._nobs[0].style.top=h+"px";this._nobs[1].style.left=w+"px";this._nobs[1].style.top=h+"px";this._nobs[2].style.left=m+"px";this._nobs[3].style.left=m+"px";this._nobs[3].style.top=v+"px";this._nobs[5].style.top=v+"px";this._nobs[6].style.left=w+"px";this._nobs[7].style.left=w+"px";this._nobs[7].style.top=v+"px"}else console.error("have no body");
else console.error("have no contentDocument");else console.error("have no parent iframe")}},onMouseDown:function(a){this._removeKeyHandlers();if(this._selectedWidget&&this._selectedWidget.domNode&&2!==a.button&&!a.ctrlKey&&"davinci.ve.tools.SelectTool"==this._context._activeTool.declaredClass){this._shiftKey=a.shiftKey;this._sKey=!1;this._nobIndex=dojo.indexOf(this._nobs,a.target);this._frameIndex=dojo.indexOf(this._frames,a.target);var d=a.pageX-400,c=a.pageY-400,g=null,e=this._selectedWidget.getHelper(),
g=e&&e.getMarginBoxPageCoords?e.getMarginBoxPageCoords(this._selectedWidget):n.getMarginBoxPageCoords(this._selectedWidget.domNode),e=n.getBorderBoxPageCoords(this._context.getParentIframe());this._moverStart={moverLeft:d,moverTop:c,l:g.l+e.l,t:g.t+e.t,w:g.w,h:g.h};g=document.body;this._moverCurrent=dojo.mixin({},this._moverStart);this._moverDragDiv=dojo.create("div",{className:"focusDragDiv",style:"position:absolute;left:"+d+"px;top:"+c+"px;width:800px;height:800px"},g);this._mover=new b(this._moverDragDiv,
a,this);dojo.stopEvent(a);this._mouseDownInfo={widget:this._selectedWidget,pageX:a.pageX+e.l,pageY:a.pageY+e.t,dateValue:Date.now()};this._moverMouseDownEvent=a;this._moverMouseUpEvent=null;this._moverMouseUpHandler=dojo.connect(this._moverDragDiv,"onmouseup",dojo.hitch(this,function(a){this.onMouseUp(a)}));a=this._context.getDocument();(d=document.getElementById("maqetta_project_select"))&&d.focus();a.defaultView.focus();this._keyDownHandler=dojo.connect(a,"onkeydown",dojo.hitch(this,function(a){this.onKeyDown(a)}));
this._keyUpHandler=dojo.connect(a,"onkeyup",dojo.hitch(this,function(a){this.onKeyUp(a)}))}},onMove:function(a,b,c){this._mouseDownInfo=null;this._moverDragDiv&&(this._moverDragDiv.style.left=b.l+"px",this._moverDragDiv.style.top=b.t+"px");if(!(0===this._frameIndex&&!this._resizeLeft||1===this._frameIndex&&!this._resizeRight||2===this._frameIndex&&!this._resizeTop||3===this._frameIndex&&!this._resizeBottom)){a=this._moverStart;c=b.l-a.moverLeft;b=b.t-a.moverTop;if(0===this._frameIndex||4===this._nobIndex||
0===this._nobIndex||5===this._nobIndex)this._moverCurrent.l=a.l+c,this._moverCurrent.w=a.w-c;else if(1===this._frameIndex||6===this._nobIndex||1===this._nobIndex||7===this._nobIndex)this._moverCurrent.w=a.w+c;if(2===this._frameIndex||4===this._nobIndex||2===this._nobIndex||6===this._nobIndex)this._moverCurrent.t=a.t+b,this._moverCurrent.h=a.h-b;else if(3===this._frameIndex||5===this._nobIndex||3===this._nobIndex||7===this._nobIndex)this._moverCurrent.h=a.h+b;b=this._moverCurrent.w;a=this._moverCurrent.h;
c=!1;if(this._selectedWidget&&"IMG"===this._selectedWidget.domNode.nodeName){var g=this._selectedWidget.domNode,e=g.naturalWidth,g=g.naturalHeight;"number"==typeof g&&0<g&&"number"==typeof e&&0<e&&(c=e/g,b<c*a?b=a*c:a=b/c,c=!0)}c||(0===this._frameIndex||0===this._nobIndex||1===this._frameIndex||1===this._nobIndex?a=b:2===this._frameIndex||2===this._nobIndex||3===this._frameIndex||3===this._nobIndex?b=a:b>a?a=b:b=a);this._moverCurrentConstrained={l:this._moverCurrent.l,t:this._moverCurrent.t,w:b,h:a};
if(0===this._frameIndex||0===this._nobIndex||1===this._frameIndex||1===this._nobIndex)this._moverCurrentConstrained.t-=(this._moverCurrentConstrained.h-this._moverCurrent.h)/2;if(2===this._frameIndex||2===this._nobIndex||3===this._frameIndex||3===this._nobIndex)this._moverCurrentConstrained.l-=(this._moverCurrentConstrained.w-this._moverCurrent.w)/2;b=dojo.mixin({},this._shiftKey?this._moverCurrentConstrained:this._moverCurrent);a=n.getBorderBoxPageCoords(this._context.getParentIframe());b.l-=a.l;
b.t-=a.t;this._updateFocusChrome(b,!1)}},onFirstMove:function(a){},onMoveStart:function(a){},_moverDoneCleanup:function(){var a=this._context,b=a._chooseParent;this._lastEventTarget=null;this._removeKeyHandlers();a.dragMoveCleanup();b.parentListDivDelete();this._mover=void 0;this._frameIndex=this._nobIndex=-1},onMoveStop:function(a){if(this._moverDragDiv&&((a=this._moverDragDiv.parentNode)&&a.removeChild(this._moverDragDiv),this._moverDragDiv=null,this._moverCurrent.l!=this._moverStart.l||this._moverCurrent.t!=
this._moverStart.t||this._moverCurrent.w!=this._moverStart.w||this._moverCurrent.h!=this._moverStart.h)){a=void 0;if(this._selectedWidget&&this._selectedWidget.domNode)if(this._sKey)for(var b=g.getStatesListCurrent(this._selectedWidget.domNode),c=0;c<b.length;c++){if(b[c]){a=b[c];break}}else a=g.propertyDefinedForAnyCurrentState(this._selectedWidget.domNode,["width","height"]);b=this._shiftKey?this._moverCurrentConstrained:this._moverCurrent;b.w==this._moverStart.w&&delete b.w;b.h==this._moverStart.h&&
delete b.h;"number"!=typeof b.l&&(b.l=this._moverStart.l);"number"!=typeof b.t&&(b.t=this._moverStart.t);b.l==this._moverStart.l&&b.t==this._moverStart.t&&(delete b.l,delete b.t);b=dojo.mixin({},b);b.hasOwnProperty("l")&&(c=n.getBorderBoxPageCoords(this._context.getParentIframe()),b.l-=c.l,b.t-=c.t);this.onExtentChange(this,this._moverStart,b,a)}this._moverDoneCleanup();a=this._moverMouseUpEvent||this._moverMouseDownEvent;this._moverMouseUpEvent=this._moverMouseDownEvent=null;if(a&&a.target){b=Date.now();
this._mouseDownInfo=null;if(this._lastMouseUp&&10>=Math.abs(a.pageX-this._lastMouseUp.pageX)&&10>=Math.abs(a.pageY-this._lastMouseUp.pageY)&&750>=b-this._lastMouseUp.dateValue)this.onDblClick(a);this._lastMouseUp={pageX:a.pageX,pageY:a.pageY,dateValue:b};dojo.stopEvent(a)}},onMouseUp:function(a){this._moverMouseUpEvent=a},onDblClick:function(a){this.showInline(this._selectedWidget);a.stopPropagation()},onKeyDown:function(a){a&&this._moverDragDiv?(dojo.stopEvent(a),a.keyCode==dojo.keys.SHIFT?(this._shiftKey=
!0,this._updateFocusChrome(this._shiftKey?this._moverCurrentConstrained:this._moverCurrent,!1)):83==a.keyCode&&(this._sKey=!0)):this._removeKeyHandlers()},onKeyUp:function(a){a&&this._moverDragDiv?(dojo.stopEvent(a),a.keyCode==dojo.keys.SHIFT?(this._shiftKey=!1,this._updateFocusChrome(this._shiftKey?this._moverCurrentConstrained:this._moverCurrent,!1)):83==a.keyCode&&(this._sKey=!1)):this._removeKeyHandlers()},_removeKeyHandlers:function(){this._keyDownHandler&&(dojo.disconnect(this._keyDownHandler),
this._keyDownHandler=null);this._keyUpHandler&&(dojo.disconnect(this._keyUpHandler),this._keyUpHandler=null)},onExtentChange:function(a,b,c,g){},isFocusNode:function(a){return dojo.hasClass(a,"focusDragDiv")||dojo.hasClass(a,"editFocusNob")||dojo.hasClass(a,"editFocusFrame")||dojo.hasClass(a,"maqFocus")||dojo.hasClass(a,"editFocusStdChrome")},showContext:function(a,b){"davinci.ve.themeEditor.ThemeEditor"==this._context.editor.declaredClass&&(this._contexDiv||(this._context=a,this._createContextPopUp()),
this._contexDiv.style.display="block")},hideContext:function(){"davinci.ve.themeEditor.ThemeEditor"==this._context.editor.declaredClass&&this._contexDiv&&(this._contexDiv.style.display="none")},_createContextPopUp:function(){var a=dojo.doc.createElement("div");a.id="ieb";this._contexDiv=a;this.domNode.appendChild(a)},_createSubwidgetList:function(){var a=this._context._selectedWidget;if(a){var b=this._context.getThemeMeta().metadata,c=b.getWidgetType(a),b=(b=b.getMetadata(c))?b.subwidgets:null;this._displayedWidget=
a;if(b){c=this._contexDiv;c.innerHTML="\x3cspan\x3e\x3c/span\x3e";c.style.position="absolute";c.style.left=this._box.w+10+"px";c.className="themeSubwidgetMenu";dojo.connect(c,"onmousedown",this,"stopPropagation");c.style.display="none";this._contexDiv=c;this.domNode.appendChild(c);var g=this._contexDiv.firstElementChild,e=this._context.theme.name+"_subwidgetmenu";(c=dijit.byId(e))&&c.destroyRecursive(!1);var k=this._context.getDijit(),c=new k.Menu({id:e},g),g=!1;a.subwidget||(g=!0);g=new k.CheckedMenuItem({label:"WidgetOuterContainer",
id:this._context.theme.name+"_WidgetOuterContainer",checked:g,onClick:dojo.hitch(this,"_subwidgetSelected",this._context.theme.name+"_WidgetOuterContainer")});g.domNode.children[0].children[0].setAttribute("src",g.domNode.children[0].children[0].src);c.addChild(g);this._currentItem=g;for(var h in b)g=a.subwidget===h,b=new k.CheckedMenuItem({label:h,id:this._context.theme.name+"_"+h,checked:g,onClick:dojo.hitch(this,"_subwidgetSelected",this._context.theme.name+"_"+h)}),b.domNode.children[0].children[0].setAttribute("src",
b.domNode.children[0].children[0].src),c.addChild(b),g&&(this._currentItem=b);c.startup();this._cm=c;this._updateSubwidgetListForState();this._connections=[];this._connections.push(dojo.subscribe("/davinci/ui/subwidgetSelectionChanged",dojo.hitch(this,this._subwidgetSelectedChange)));this._connections.push(dojo.subscribe("/davinci/states/state/changed",dojo.hitch(this,this._updateSubwidgetListForState)))}else this._contexDiv.innerHTML=""}},stopPropagation:function(a){a.stopPropagation()},_subwidgetSelected:function(a,
b){b.stopPropagation();var c=this._context.getDijit(),g=c.byId(a);g.checked?(this._currentItem&&g!=this._currentItem&&this._currentItem.set("checked",!1),this._currentItem=g,c=this._currentItem.label):((this._currentItem=c.byId(this._context.theme.name+"_WidgetOuterContainer"))&&this._currentItem.set("checked",!0),c=null);b.currentTarget.id===this._context.theme.name+"_WidgetOuterContainer"&&(c=null);dojo.publish("/davinci/ui/subwidgetSelectionChanged",[{subwidget:c,origin:this.declaredClass}])},
_subwidgetSelectedChange:function(a){var b=this._context.getDijit();a.origin!==this.declaredClass&&(this._currentItem&&this._currentItem.set("checked",!1),(this._currentItem=a.subwidget?b.byId(this._context.theme.name+"_"+a.subwidget):b.byId(this._context.theme.name+"_WidgetOuterContainer"))&&this._currentItem.set("checked",!0))},_updateSubwidgetListForState:function(){if(this._context.editor==k.currentEditor)if(this._context._selectedWidget&&this._displayedWidget===this._context._selectedWidget&&
this._cm){var a=k.currentEditor,b=a._theme;this._cm.getChildren().forEach(function(c){var g=c.label;"WidgetOuterContainer"===g&&(g=null);c.setDisabled(!b.isStateValid(this._displayedWidget,a._currentState,g))},this)}else this._clearList(),this._createSubwidgetList()},_updateSubwidgetList:function(){this._displayedWidget!==this._context._selectedWidget&&(this._clearList(),this._createSubwidgetList())},_clearList:function(){if(this._cm)for(this._cm.destroyRecursive(!1),delete this._cm;connection=this._connections.pop();)dojo.unsubscribe(connection);
this._currentItem=null},dojoStyle:function(a,b,c){if(a&&a.ownerDocument&&a.ownerDocument.defaultView&&a.ownerDocument.defaultView.getComputedStyle(a))return dojo.style.apply(dojo,arguments)}})})},"davinci/ve/ChooseParent":function(){define("dojo/_base/declare davinci/Runtime ./widget ./_Widget ./metadata davinci/ve/utils/GeomUtils".split(" "),function(p,m,h,e,b,k){return p("davinci.ve.ChooseParent",null,{constructor:function(a){this._context=a.context},getAllowedTargetWidget:function(a,g,k,f){var d=
h.getEnclosingWidget,c=[],m=[];g=g.length?g:[g];var p=this;g.forEach(function(a){m.push({type:a.type,allowedParent:b.getAllowedParent(a.type),classList:p.getClassList(a.type)})});do{g=a instanceof e?a.type:a._dvWidget.type;var r=this.getClassList(g);this.isAllowed(m,a,g,r,f)&&c.push(a);a=d(a)}while(a&&k);return c},isAllowed:function(a,g,e,f,d){function c(a,b){return b.some(function(b){return-1!==a.indexOf(b)})}var k=b.getAllowedChild(e);"html.body"===e&&(k=["ANY"]);return a.every(function(a){var b=
"NONE"!==k[0]&&("ANY"===k[0]||"BLOCK"===k[0]||c(k,a.classList)),g="ANY"===a.allowedParent[0]||c(a.allowedParent,f),m=h.getWidgetHelper(a.type);return m&&m.isAllowed?m.isAllowed({childType:a.type,childClassList:a.classList,parentType:e,parentClassList:f,absolute:d.absolute,isAllowedChild:b,isAllowedParent:g}):b&&g})},getClassList:function(a){var g=b.queryDescriptor(a,"class");return g?(g=g.split(/\s+/),g.push(a),g):[a]},dragUpdateCandidateParents:function(a){var b=a.widgetType,e=a.showCandidateParents,
f=a.doCursor,d=a.absolute,c=a.currentParent;a=this._XYParent;this._proposedParentWidget||(this._proposedParentWidget=this._getDefaultParent(b,a,d,c));(e||f)&&this.highlightNewWidgetParent(this._proposedParentWidget);var b=this._context,d=b.getActiveDragDiv(),p;d&&(d=dojo.query(".maqCandidateParents",d),1==d.length&&(p=d[0]));if(p)if(e){e=!0;if(this._lastProposedParentWidget!=this._proposedParentWidget)e=!1;else if("undefined"==typeof this._lastAllowedParentList||null===this._lastAllowedParentList)e=
!1;else if(this._lastAllowedParentList.length!=a.length)e=!1;else for(c=0;c<a.length;c++)if(this._lastAllowedParentList[c]!=a[c]){e=!1;break}this._lastProposedParentWidget=this._proposedParentWidget;if(!e)if(e=dojo.i18n.getLocalization("davinci.ve","ve"),p.innerHTML="","undefined"==typeof a||null===a)this._lastAllowedParentList=null,c=0;else{this._lastAllowedParentList=a.slice();var c=a.length,u=dojo.create("div",{className:"maqCandidateParentsHeader"},p),d=dojo.create("div",{className:"maqCandidateParentsList"},
p);p=dojo.create("div",{className:"maqCandidateParentsHelp"},p);if(0===c)u.innerHTML=e.noValidParents;else if(1==c)u.innerHTML=e.willBeChildOf,dojo.create("div",{className:"maqCandidateListItem maqCandidateCurrent",innerHTML:h.getLabel(a[0])},d);else{u.innerHTML=e.candidateParents;for(var u="\x3ctable\x3e",c=a.length-1,r=1;0<=c;c--,r++){var z="maqCandidateListItem";a[c]==this._proposedParentWidget&&(z+=" maqCandidateCurrent");u+='\x3ctr class\x3d"'+z+'"\x3e\x3ctd class\x3d"maqCandidateCheckedColumn"\x3e\x26rarr;\x3c/td\x3e\x3ctd class\x3d"maqCandidateNumberColumn"\x3e'+
r+'\x3c/td\x3e\x3ctd class\x3d"maqCandidateParentColumn"\x3e'+h.getLabel(a[c])+"\x3c/td\x3e\x3c/tr\x3e"}d.innerHTML=u+"\x3c/table\x3e";p.innerHTML=e.toChangePress}}}else p.innerHTML="",this._lastAllowedParentList=null;if(f){for(var y,c=0;c<this._XYParent.length;c++)if(this._XYParent[c]===this._proposedParentWidget){y=c;break}void 0!==y&&(!this._cursorSpan&&(this._cursorSpan=dojo.create("span",{className:"editCursor"}),f=b.getGlobal())&&(this._timer=f.setInterval(function(a,b){var c=m.currentEditor;
(c.getContext&&c.getContext())!==b?this.cleanup():dojo.toggleClass(a,"editCursorBlink")}.bind(this),400,this._cursorSpan,b)),f=this._XYParent[y].domNode,a=(a=this._XYRefChild[y])?a.domNode:null,y=this._XYRefAfter[y],a?(y?a.nextSibling&&a.nextSibling._dvWidget?(b=k.getBorderBoxPageCoordsCached(a.nextSibling),y=b.l):(b=k.getBorderBoxPageCoordsCached(a),y=b.l+b.w):(b=k.getBorderBoxPageCoordsCached(a),y=b.l),a=b.t,b=b.h):(b=k.getBorderBoxPageCoordsCached(f),y=b.l,a=b.t,b=16),p=this._cursorSpan.style,
p.height=b+"px",p.left=y+"px",p.top=a+"px",f.ownerDocument.body.appendChild(this._cursorSpan))}},_getDefaultParent:function(a,b,e,f){var d;b&&(a=h.getWidgetHelper(a),d=1<b.length&&a&&a.chooseParent?a.chooseParent(b):0===b.length?null:e&&f?f:b[b.length-1]);return d},cleanup:function(){this._cursorSpan&&(this._cursorSpan.parentNode.removeChild(this._cursorSpan),this._cursorSpan=null);if(this._timer){var a=this._context.getGlobal();a&&(a.clearInterval(this._timer),this._timer=null)}this.highlightNewWidgetParent(null);
this._lastAllowedParentList=null},highlightNewWidgetParent:function(a){a!=this.newWidgetParent&&(this.newWidgetParent&&(this.newWidgetParent.domNode.style.outline=""),this.newWidgetParent=a)&&(a.domNode.style.outline="1px solid rgba(165,42,42,.7)")},getProposedParentWidget:function(){var a=null;if(this._XYParent){var b=this._XYParent.indexOf(this._proposedParentWidget);0<=b&&(a={},a.parent=this._XYParent[b],a.refChild=this._XYRefChild[b],a.refAfter=this._XYRefAfter[b])}return a},setProposedParentWidget:function(a){this._proposedParentWidget=
a},getProposedParentsList:function(){return this._XYParent},findParentsXYBeforeTraversal:function(a){a=a.position;this._XYParent=[];this._XYRefChild=[];this._XYRefAfter=[];"undefined"==typeof this.findParentsXYLastPosition&&(this.findParentsXYLastPosition={});var b=this.findParentsXYLastPosition;if(a.x===b.x&&a.y===b.y)return!1;b.x=a.x;b.y=a.y;return!0},findParentsXY:function(a){var b=a.data,e=a.widget,f=a.absolute,d=a.position;a=a.beforeAfter;this._context.getScrollOffset();var c=d.x,d=d.y,h=e.getHelper(),
m=null,m=h&&h.getMarginBoxPageCoords?h.getMarginBoxPageCoords(e):k.getMarginBoxPageCoordsCached(e.domNode),p=m.l,z=m.t,h=m.w,y=m.h,B;if(c>=p&&c<=p+h&&d>=z&&d<=z+y&&1===this.getAllowedTargetWidget(e,b,!1,{absolute:f}).length)if(!0===f)this._XYParent.push(e),this._XYRefChild.push(null),this._XYRefAfter.push(!0);else{f=e.getChildren();m=[];for(b=0;b<f.length;b++)h=f[b],p=h.domNode,z=k.getBorderBoxPageCoordsCached(p),h=p.offsetWidth,y=p.offsetHeight,p=z.l,z=z.t,B=p+h,y=z+y,m.push({l:p,t:z,r:B,b:y,c:p+
h/2});for(var x,w,v,b=0;b<m.length;b++){p=m[b];h=f[b];if(c>=p.l&&c<=p.r&&d>=p.t&&d<=p.b){x=h;w=c>=p.c?!0:!1;break}0===b?(x=h,w=d>p.b||c>=p.c?!0:!1,v=p.b):(d>=p.t||d>=v)&&c>=p.l?(x=h,w=d>p.b||c>=p.c?!0:!1):d>=v&&d>=p.b&&(x=h,w=!0);p.b>v&&(v=p.b)}this._XYParent.push(e);this._XYRefChild.push(x);this._XYRefAfter.push("after"===a?!0:"before"===a?!1:w)}},findParentsXYAfterTraversal:function(a){var b=a.widgets,e=a.currentParent,f=a.eventTarget.ownerDocument.body._dvWidget;if(a.absolute&&e&&e!=f){var d=!1;
this._XYParent.forEach(function(a){a==e&&(d=!0)});d||(this._XYParent.push(e),this._XYRefChild.push(b[0]),this._XYRefAfter.push(!0))}this.findParentsXYLastPosition={};for(a=0;a<this._XYRefAfter.length-1;a++)this._XYRefAfter[a]=!0},findParentsXYCleanup:function(a){this.findParentsXYLastPosition={}},parentListDivCreate:function(a){var b=a.widgetType,e=a.absolute,f=a.doCursor,d=a.beforeAfter,c=a.currentParent;a=this._context;if(b){var k=a.getDocument();this._oldActiveElement=document.activeElement;k.defaultView.focus();
this._keyDownHandler=dojo.connect(k,"onkeydown",dojo.hitch(this,function(a,b){this.onKeyDown(b,a[0],a[1],a[2],a[3],a[4])},[b,e,f,d,c]));this._keyUpHandler=dojo.connect(k,"onkeyup",dojo.hitch(this,function(a,b){this.onKeyUp(b,a[0],a[1],a[2],a[3],a[4])},[b,e,f,d,c]));b=this._parentListDiv=dojo.create("div",{className:"maqParentListDiv"},document.body);a.setActiveDragDiv(b);dojo.create("div",{className:"maqCandidateParents"},b);return b}},parentListDivGet:function(){return this._parentListDiv},parentListDivDelete:function(){var a=
this._context,b=this._parentListDiv;b&&(this._oldActiveElement&&(this._oldActiveElement.focus(),this._oldActiveElement=null),dojo.disconnect(this._keyDownHandler),dojo.disconnect(this._keyUpHandler),this._keyDownHandler=this._keyUpHandler=null,b.parentNode.removeChild(b),a.setActiveDragDiv(null),this._parentListDiv=null)},_keyEventDoUpdate:function(a,b,e,f,d){var c=this._context.getPreference("showPossibleParents");this.dragUpdateCandidateParents({widgetType:a,showCandidateParents:!c&&this._spaceKeyDown||
c&&!this._spaceKeyDown,doCursor:e,beforeAfter:f,absolute:b,currentParent:d})},onKeyDown:function(a,b,e,f,d,c){dojo.stopEvent(a);a.keyCode==dojo.keys.SPACE?this._spaceKeyDown=!0:this._processKeyDown(a.keyCode);this._keyEventDoUpdate(b,e,f,d,c)},onKeyUp:function(a,b,e,f,d,c){dojo.stopEvent(a);a.keyCode==dojo.keys.SPACE&&(this._spaceKeyDown=!1);this._keyEventDoUpdate(b,e,f,d,c)},_processKeyDown:function(a){if(49<=a&&57>=a){var b=this.getProposedParentsList();1<b.length&&(a=b.length-(a-48),0<=a&&this.setProposedParentWidget(b[a]))}},
isSpaceKeyDown:function(){return this._spaceKeyDown}})})},"davinci/ve/_ContextDojo":function(){define("require dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/query dojo/Deferred dojo/promise/all dojo/_base/connect dojo/window xide/factory xide/types ./commands/ChangeThemeCommand ../model/Path ../Runtime ../Workbench ../library ./metadata ../workbench/Preferences dojo/text!./newfile.template.html dojox/html/_base".split(" "),function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y,B,x){return m(null,
{_didDojo:!1,_reRequire:/\brequire\s*\(\s*\[\s*([\s\S]*?)\s*\]\s*\)/,_reModuleId:/[\w.\/]+/g,_bootstrapModules:"dijit/dijit,dijit/dijit-all",getDojoUrl:function(){var a=r.location();"/"==a.charAt(a.length-1)&&(a=a.substring(0,a.length-1));if(document&&document.getElementsByTagName)for(var b=document.getElementsByTagName("script"),c=/dojo(\.xd)?\.js(\W|$)/i,d=0;d<b.length;d++){var g=b[d].getAttribute("src");if(g&&g.match(c))return a+"/"+g}},_getLoaderPackages:function(){var a=this.getBase(),b=z.getUserLibs(a),
c,d=[];b.some(function(a){return"dojo"===a.id?(c=new q(a.root+"/dojo"),!0):!1});b=b.concat({id:"widgets",root:function(){var b=B.getPreferences("davinci.ui.ProjectPrefs",a);b.widgetFolder||(b.widgetFolder="WebContent/lib/custom",B.savePreferences("davinci.ui.ProjectPrefs",a,b));for(b=b.widgetFolder;1<b.length&&("."==b.charAt(0)||"/"==b.charAt(0));)b=b.substring(1);return b}()});b.forEach(function(a){var b=a.id;void 0!==a.root&&"dojo"!==b&&"DojoThemes"!==b&&(b=(new q(a.root)).relativeTo(c).toString(),
d.push({name:a.id,location:b}))});dojo.publish("onGetLoaderPackages",{context:this,packages:d,base:a});return d},_setSourcePostLoadRequires:function(a,d,f,k){k&&(k.themeSet&&(new c(k.themeSet,this))._dojoxMobileAddTheme(this,k.themeSet.mobileTheme,!0),this.addModeledStyleSheet(this.getAppCssRelativeFile(),!0),k=this._getAppJsRelativeFile(),this.addHeaderScript(k));a.find({elementType:"HTMLElement",tag:"script"}).forEach(function(a){for(var b=0;b<a.children.length;b++)if(0<=a.children[b].getText().indexOf("dojo.require")){a.parent.removeChild(a);
break}});var m=this._parse(a);if(this.frameNode)this.getGlobal(),b(".loading",this.frameNode.parentNode).orphan(),this._continueLoading(m,d,this,f);else{var p;dojo.some(m.scripts,function(a){if(-1!=a.indexOf("/dojo.js"))return p=a,!0});p=null;k=this.getBase();if(!p){var B=this;dojo.some(z.getUserLibs(k.toString()),function(a){return"dojo"===a.id?(p=(new q(this.getBase())).append(a.root).append("dojo/dojo.js").relativeTo(this.getPath(),!0).toString(),B.addJavaScriptSrc(p,!0,"",!1),!0):!1},this);p||
(p=this.getDojoUrl())}k=this.getFullResourcePath().getParentPath();var y=new q(p);k=k.append(y).getParentPath();for(var y=u.getUserWorkspaceUrl(),G=0;G<this._customWidgetPackages.length;G++){var N=this._customWidgetPackages[G],M=N.location.substr(y.length),M=new q(M);N.location=M.relativeTo(k).toString()}k=this.containerNode;k.style.overflow="hidden";k=e.create("iframe",this.iframeattrs,k);k.dvContext=this;this.frameNode=k;y=r.location()+"/";this.baseURL&&(y=this.baseURL);var K=k.contentDocument||
k.contentWindow.document,F=n.get(K),J={baseUrl:y};p&&(J.dojoUrl=p,J.id=this._id,k={packages:this._getLoaderPackages()},this._getDojoScriptValues(k,J),this._bootstrapModules&&(J.additionalModules=","+this._bootstrapModules.split(",").map(function(a){return"'"+a+"'"}).join(",")));a.themeCssFiles&&(J.themeCssFiles=a.themeCssFiles.map(function(a){return'\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+a+'"\x3e'}).join(""));window["loading"+this._id]=function(a,b){var c=this;try{var g=n.get(K),
e=this.rootNode=K.body;if(!e){this._waiting=this._waiting||0;if(10>this._waiting++){setTimeout(window["loading"+this._id],500);return}throw"doc.body is null";}delete window["loading"+this._id];e.id="myapp";e.style.width="100%";e.style.height="100%";e.style.visibility="visible";e.style.margin="0";e._edit_context=this;-1!=this._bootstrapModules.split(",").indexOf("dijit/dijit-all")&&(g.dojo._postLoad=!0);g.require("dojo/_base/lang").isArray=g.dojo.isArray=function(a){return a&&"[object Array]"==Object.prototype.toString.call(a)};
g.require({packages:this._customWidgetPackages})}catch(k){console.error(k.stack||k),c=Error(k.message,k.fileName,k.lineNumber),h.mixin(c,k)}this._continueLoading(m,d,c,f)}.bind(this);K.open();a=h.replace(x,function(a,b){return J.hasOwnProperty(b)?J[b]:""});K.write(a);K.close();g.connect(K.documentElement,"onkeypress",function(a){8==a.charOrCode&&(window.davinciBackspaceKeyTime=F.davinciBackspaceKeyTime=Date.now())});g.connect(K.documentElement,"onkeydown",dojo.hitch(this,function(a){this.editor.handleKeyEvent(a)}));
g.connect(K.documentElement,"onkeyup",dojo.hitch(this,function(a){this.editor.handleKeyEvent(a)}))}},getLibraryBase:function(a,b){return z.getLibRoot(a,b,this.getBase())},loadRequires:function(b,c,d,g){var f=y.query(b,"require");if(!f){var e=new k;e.resolve();return e}var h=y.query(b,"library"),n={},m=this,p=function(a,b){return m.addJavaScriptSrc(b,c,b,g)},r=function(a,b){var c=new k;if(n.hasOwnProperty(a))return c.resolve(),c;var d=y.getLibrary(a).version||b.version;return m.getLibraryBase(a,d).then(function(g){if(null==
g)return console.error("No library found for name \x3d '"+a+"' version \x3d '"+d+"'"),c.reject(),c;n[a]=(new q(m.getBase())).append(g);if(b&&b.src&&".js"===b.src.substr(-3))return g=b.src.match(/((?:\.\.\/)*)(.*)/),p(a,g[2]);c.resolve();return c})},e=[],u;for(u in h)h.hasOwnProperty(u)&&e.push(r(u,h[u]));return a(e).then(function(){var e=[];f.every(function(a){a.$library&&e.push(r(a.$library,h[a.$library]));switch(a.type){case "javascript":a.src?e.push(p(a.$library,a.src)):this.addJavaScriptText(a.$text,
c||d,g);break;case "javascript-module":"amd"!==a.format&&console.error("Unknown javascript-module format");a.src?e.push(this.addJavaScriptModule(a.src,c||d,g)):console.error("Inline 'javascript-module' not handled src\x3d"+a.src);break;case "css":a.src?(a=a.src,c?this.addModeledStyleSheet(a,g):this.loadStyleSheet(a)):console.error("Inline CSS not handled src\x3d"+a.src);break;case "image":break;default:console.error("Unhandled metadata resource type\x3d'"+a.type+"' for widget '"+b+"'")}return!0},
this);return a(e)}.bind(this))},getDojo:function(){var a=this.getGlobal();return a&&a.dojo||dojo},getDijit:function(){var a=this.getGlobal();return a&&a.dijit||dijit},_getDojoJsElem:function(){if(this._dojoScriptElem||this.getDocumentElement().getChildElement("head").getChildElements("script").some(function(a){if(/\/dojo.js$/.test(a.getAttribute("src")))return this._dojoScriptElem=a,!0},this))return this._dojoScriptElem;console.error('"dojo.js" script element not found!')},_updateDojoConfig:function(a){this.close();
var b=this._getDojoJsElem(),c=b.getAttribute("data-dojo-config"),c=c?p.eval("({ "+c+" })","data-dojo-config"):{},g="";c.mblLoadCompatPattern&&(g=", mblLoadCompatPattern: "+c.mblLoadCompatPattern.toString(),delete c.mblLoadCompatPattern);for(var e in a)"mblLoadCompatPattern"==e?g=null===a[e]?"":", 'mblLoadCompatPattern': "+a[e]:null===a[e]?delete c[e]:c[e]=a[e];f.publish(d.EVENTS.ON_BUILD_DOJO_CONFIG,{data:c,context:this,editor:this.editor},this);a=JSON.stringify(c).slice(1,-1).replace(/"/g,"'");b.setAttribute("data-dojo-config",
a+g)},_preserveDojoTypes:function(a){var b=a.getAttribute("data-dojo-type")||a.getAttribute("dojoType");if(b){var c=this._loadFileDojoTypesCache,d=this.maqTypesClassPrefix+this.maqTypesClassCount;a.className=a.className+" "+d;this.maqTypesClassCount++;c[d]=b}},_getDojoScriptValues:function(a,b){var c=this._getDojoJsElem(),d=c.getAttribute("data-dojo-config"),d=d?p.eval("({ "+d+" })","data-dojo-config"):{};h.mixin(d,a,{async:!0,parseOnLoad:!1});b.dojoConfig=JSON.stringify(d).slice(1,-1).replace(/"/g,
"'");var g=[];c.attributes.forEach(function(a){var b=a.name;a=a.value;"src"!==b&&"data-dojo-config"!==b&&g.push(b+'\x3d"'+a+'"')});g.length&&(b.additionalDojoAttrs=g.join(" "))},_restoreDojoTypes:function(){var a=this._loadFileDojoTypesCache,b=this.getDocument(),c;for(c in a)if(node=b.querySelectorAll("."+c)[0])node.className=node.className.replace(" "+c,""),node.setAttribute("data-dojo-type",a[c])},_continueLoading:function(a,b,c,d){var g,e={};try{if(c instanceof Error)throw c;g=this._setSourceData(a).then(this.onload.bind(this),
function(a){e.errorMessage='Unable to parse HTML source.  See console for error.  Please switch to "Display Source" mode and correct the error.';console.error(a.stack||a.message)})}catch(f){e=f}finally{b&&(g?g.then(function(){b.call(d||this,e)}.bind(this)):b.call(d||this,e))}}})})},"davinci/ve/_ContextInterface":function(){define("dojo/_base/declare dojo/dom-style dojo/_base/connect dojo/topic ../Theme ../Workbench ./Snap dojox/html/_base".split(" "),function(p,m,h,e,b,k,a){return p(null,{_designEvents:[],
_designMode:!0,isDesignMode:function(){return this._designMode},_disableDesignMode:function(){this._designEvents.forEach(h.disconnect);this._designEvents=[]},_enableDesignMode:function(){var a=this.getContainerNode();this._designEvents.forEach(h.disconnect);this._designEvents=[h.connect(this.getDocument(),"onkeydown",this,"onKeyDown"),h.connect(this.getDocument(),"onkeyup",this,"onKeyUp"),h.connect(a,"ondblclick",this,"onDblClick"),h.connect(a,"onmousedown",this,"onMouseDown"),h.connect(a,"onclick",
this,"onMouseClick"),h.connect(a,"onmousemove",this,"onMouseMove"),h.connect(a,"onmouseup",this,"onMouseUp"),h.connect(a,"onmouseover",this,"onMouseOver"),h.connect(a,"onmouseout",this,"onMouseOut")]},setDesignMode:function(a){!a&&this._designMode&&this._disableDesignMode();a&&!this._designMode&&this._enableDesignMode();this._designMode=a},getActiveDragDiv:function(){return this._activeDragDiv},setActiveDragDiv:function(a){this._activeDragDiv=a},blockChange:function(a){this._blockChange=a},onMouseClick:function(a){this.eventHandler&&
this.eventHandler.click&&this.eventHandler.click(a)},onMouseDown:function(a){if(this._activeTool&&this._activeTool.onMouseDown&&!this._blockChange)this._activeTool.onMouseDown(a);this.blockChange(!1)},onDblClick:function(a){},onMouseMove:function(a){if(this._activeTool&&this._activeTool.onMouseMove&&!this._blockChange)this._activeTool.onMouseMove(a)},onMouseUp:function(a){if(this._activeTool&&this._activeTool.onMouseUp)this._activeTool.onMouseUp(a);this.blockChange(!1);e.publish("/davinci/ve/context/mouseup",
a)},onMouseOver:function(a){if(this._activeTool&&this._activeTool.onMouseOver)this._activeTool.onMouseOver(a)},onMouseOut:function(a){if(this._activeTool&&this._activeTool.onMouseOut)this._activeTool.onMouseOut(a)},dragMoveUpdate:function(b){var e=this,f=this._chooseParent,d=b.widgets,c=b.data,k=b.position,h=b.absolute,m=b.currentParent,p=b.rect,y=b.doSnapLinesX,B=b.doSnapLinesY,x=b.doFindParentsXY,w=b.doCursor,v=b.beforeAfter,A=dojo.isArray(c)?c[0].type:c.type,C=function(b){if(!(d&&0<=d.indexOf(b))){var g=
this.getGlobal().require("dojo/dom-style").get(b.domNode);(y||B)&&a.findSnapOpportunities(this,b,g,y,B);f.findParentsXY({data:c,widget:b,absolute:h,position:k,doCursor:w,beforeAfter:v});dojo.forEach(b.getChildren(),function(a){C.apply(e,[a])})}};if(y||B)doSnapLines=a.updateSnapLinesBeforeTraversal(this,p);p=f.findParentsXYBeforeTraversal(b);C.apply(e,[this.rootWidget]);(y||B)&&a.updateSnapLinesAfterTraversal(this);f.findParentsXYAfterTraversal(b);p&&(f.dragUpdateCandidateParents({widgetType:A,showCandidateParents:x,
doCursor:w,beforeAfter:v,absolute:h,currentParent:m}),f.findParentsXYCleanup(b))},dragMoveCleanup:function(){a.clearSnapLines(this);this._chooseParent.cleanup(this)},onExtentChange:function(a,b,e,d){if(this._activeTool&&this._activeTool.onExtentChange&&!this._blockChange&&(a=dojo.indexOf(this._focuses,a),0<=a))this._activeTool.onExtentChange({index:a,oldBoxes:[b],newBox:e,applyToWhichStates:d});this.blockChange(!1)},onKeyDown:function(a){if(this._activeTool&&this._activeTool.onKeyDown)this._activeTool.onKeyDown(a)},
onKeyUp:function(a){if(this._activeTool&&this._activeTool.onKeyUp)this._activeTool.onKeyUp(a)},onContentChange:function(){this._updateWidgetHash();this.deselectInvisible();dojo.forEach(this.getSelection(),function(a,b){0===b?this.select(a):this.select(a,!0)},this);if("davinci.themeEdit.ThemeEditor"==this.editor.editorID){var a=b.getHelper(this.visualEditor.theme);if(a&&a.onContentChange)a.onContentChange(this,this.visualEditor.theme);else a&&a.then&&a.then(function(a){if(a.helper&&a.helper.onContentChange)a.helper.onContentChange(this,
this.visualEditor.theme)}.bind(this))}this._forceSelectionChange&&(this.onSelectionChange(this.getSelection()),delete this._forceSelectionChange);setTimeout(function(){k._autoSave.call(k)},0)},onSelectionChange:function(a){this._cssCache={};h.publish("/davinci/ui/widgetSelected",{selection:a,context:this})},getActiveTool:function(){return this._activeTool},setActiveTool:function(a){try{this._activeTool&&this._activeTool.deactivate(),this._activeTool=a,this._activeTool||(this._activeTool=this._defaultTool),
this._activeTool.activate(this),h.publish("/davinci/ve/activeToolChanged",[this,a])}catch(b){debugger}},inlineEditActive:function(){return this.getSelection().some(function(a,b){return this._focuses[b].inlineEditActive()},this)},select:function(a,b,e){if(a&&a!=this.rootWidget){var d,c=!1;this._selection&&(c=this._selection.some(function(b,c){return b===a?(d=c,!0):!1}));if(!c){b&&this._selection?(d=this._selection.length,c=this._selection,c.push(a)):c=[a];var k=a.getParent();if(k){var h=k.getHelper();
h&&h.selectChild?h.selectChild(k,a):k.selectChild(a)}if(!this._selection||1<this._selection.length||1<c.length||this.getSelection()!=a)if(k=this._selection,this._selection=c,this.onSelectionChange(c,b),k&&k.forEach(function(a){var b=a.getHelper();if(b&&b.onDeselect)b.onDeselect(a)},this),(b=a.getHelper())&&b.onSelect)b.onSelect(a)}this.updateFocus(a,d,e)}else b||this.deselect()},deselect:function(a){if(this._selection){a&&(helper=a.getHelper());if(a&&this._selection.length){if(1===this._selection.length){if(this._selection[0]!=
a)return;this.focus(null,0);this._selection=void 0}else{var b=dojo.indexOf(this._selection,a);if(0>b)return;this.focus(null,b);this._selection.splice(b,1)}if(helper&&helper.onDeselect)helper.onDeselect(a)}else this._selection&&this._selection.forEach(function(a){var b=a.getHelper();if(b&&b.onDeselect)b.onDeselect(a)},this),this.focus(null),this._selection=void 0;this.onSelectionChange(this.getSelection())}},deselectInvisible:function(){function a(b){return 1==b.nodeType&&"none"==m.get(b,"display")?
!0:b.parentNode?a(b.parentNode):!1}if(this._selection)for(var b=this._selection.length-1;0<=b;b--){var e=this._selection[b],d=e.domNode;if(a(d)&&"xblox/RunScript"!==e.type)this.deselect(e);else for(;d&&"BODY"!=d.tagName.toUpperCase();){if(d&&d.ownerDocument&&d.ownerDocument.defaultView&&"none"==m.get(d,"display")&&"xblox/RunScript"!==e.type){this.deselect(e);break}d=d.parentNode}}},getFlowLayout:function(){var a=!0;a="true"===a;return a},setFlowLayout:function(a){var b=this.getDocumentElement().getChildElement("body");
b&&b.addAttribute(PREF_LAYOUT_ATTR,""+a);return a}})})},"davinci/ve/_ContextDocument":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/query dojo/_base/connect dojo/window xide/utils xide/factory xide/types ../UserActivityMonitor ../model/Path ../Workbench ./widget ./metadata ../html/HTMLElement ../workbench/Preferences dojox/html/_base".split(" "),function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z){var y=function(a){var b=u.getLibrary();a&&dojo.filter(a.attributes,function(a){return"on"==
a.nodeName.substr(0,2).toLowerCase()}).forEach(function(a){var c=!1,d;for(d in b)if(c=u.getLibrary(d),c=u.invokeCallback(c,"requiredEventAttribute",[a]))break})};return p(null,{hasDirtyResources:function(){return!1},getCompType:function(){var a=this.getDocumentElement().getChildElement("body"),b=a&&a.getAttribute("data-maq-comptype");a&&!b&&(b=this.getMobileDevice()?"mobile":"desktop",a.addAttribute("data-maq-comptype",b));return b},_significantAttrs:{link:"href",meta:"name"},getContainerNode:function(){return this.rootNode},
getParentIframe:function(){if(!this._parentIframeElem)for(var a=this.getDocument(),b=document.getElementsByTagName("iframe"),c=0;c<b.length;c++)if(b[c].contentDocument===a){this._parentIframeElem=b[c];break}return this._parentIframeElem},getModel:function(){return this._srcDocument},setSource:function(a,b,c,d){dojo.withDoc(this.getDocument(),"_setSource",this,arguments);this.editor&&this.editor._setDirty()},getBase:function(){return""},getFullResourcePath:function(){if(!this._fullResourcePath){var a=
this.getModel().fileName;this._fullResourcePath=new d(a)}return this._fullResourcePath},_getCurrentBasePath:function(){var a=new d(c.getProject()),b=z.getPreferences("davinci.ui.ProjectPrefs",a);null!==b.webContentFolder&&""!==b.webContentFolder&&(a=a.append(b.webContentFolder));return a},getRelativeFileString:function(a){var b=this.getFullResourcePath().getParentPath();return this._getCurrentBasePath().append(a).relativeTo(b).toString()},_setSource:function(b,c,d,e){delete this._requireHtmlElem;
delete this._dojoScriptElem;delete this.rootWidget;if(this.frameNode){var f=this.frameNode.contentDocument||this.frameNode.contentWindow&&this.frameNode.contentWindow.document;if(f)try{var g=k.get(f).require("dijit/registry")._destroyAll();g&&(g.forEach(function(b){a.destroy(b,!0)}),g._hash={})}catch(h){console.error("error cleaning registry",h)}}this._srcDocument=b;e&&(f=b.getDocumentElement().getChildElement("body"),f.setAttribute("data-maq-device",e.device),f.setAttribute("data-maq-flow-layout",
e.flowlayout),f.setAttribute("data-maq-comptype",e.comptype));this.loadRequires("html.body",!0,!1,!0).then(function(){e&&this.loadTheme(e);this._setSourcePostLoadRequires(b,c,d,e)}.bind(this))},_setSourceData:function(a){g.publish(n.EVENTS.ON_SET_SOURCE_DATA,{data:a,context:this,editor:this.editor},this);this.getGlobal();this.themeChanged();var b={title:a.title,scripts:a.scripts,modules:a.modules,styleSheets:a.styleSheets,bodyClasses:a.bodyClasses,style:a.style};g.publish(n.EVENTS.ON_BUILD_HEADER,
{data:b,context:this,editor:this.editor},this);this.setHeader(b);var c=a.content||"";if(b=this.isActive())this.select(null),this.getTopWidgets().forEach(this.detach,this);var d={},f=this.getContainerNode();a.maqAppStates&&(d.body=a.maqAppStates);this.getTopWidgets().forEach(function(a){a.getContext()&&a.destroyWidget()});var k=this.getGlobal().require("dijit/registry");k.forEach(function(a){a.destroy()});k.forEach(function(a){a.destroy();k.remove(a.id)});var c=c.replace(/<\s*\/\s*br\s*>/gi,""),h;
this.getGlobal();var m=this.getDojo();m.create||this.getGlobal().require(["dojo/dom-construct","dojo/dom-style","dojo/dom-attr","dojo/_base/html"],function(a,b,c,d){m.create=a.create;m.destroy=a.destroy;m.place=a.place;m.toDom=a.toDom});this.getGlobal().require("dojox/html/_base").set(f,c,{executeScripts:!0,onEnd:function(){h=this._code;this.executeScripts=!1;this.inherited("onEnd",arguments)}});y(f);e("*",f).forEach(y);f.setAttribute("data-maq-ws","collapse");(a=this._srcDocument.getDocumentElement().getChildElement("body"))&&
a.addAttribute("data-maq-ws","collapse");this.getGlobal();(a=this.getDocumentElement().getChildElement("body"))&&a.getAttribute("data-maq-device");var p={SCRIPT:1,STYLE:1},q=function(a){dojo.forEach(a.childNodes,function(a){3==a.nodeType?a.nodeValue=a.data.replace(/^[\f\n\r\t\v\ ]+$/g,""):1!=a.nodeType||p[a.nodeName]||q(a)})};q(f);this._loadFileStatesCache=d;this.global=this.getGlobal();return this._processWidgets(f,b,this._loadFileStatesCache,h)},getSource:function(){return this._srcDocument.getText()},
getDocumentElement:function(){return this._srcDocument.getDocumentElement()},getDocumentLocation:function(){return this._srcDocument.fileName},getHeader:function(){return this._header||{}},setHeader:function(a){var b=[],c,d,e;this._header&&(b=this._header.styleSheets||[],d=this._header.bodyClasses);if(a){c=a.styleSheets||[];e=a.bodyClasses;if(a.modules){var f=this.getGlobal().require;a.modules.map(function(a){return[a.replace(/\./g,"/")]}).forEach(f)}if(a.className){var g=a.className.split(" ");dojo.some(g,
function(a,b){g.splice(b,1);e=g.join(" ");return!0})}}d!=e&&(f=this.getContainerNode(),d&&m.remove(f,d),e&&m.add(f,e));b!=c&&(b=[].concat(b),dojo.forEach(c,function(a){var c=dojo.indexOf(b,a);0>c?this.loadStyleSheet(a):b.splice(c,1)},this),dojo.forEach(b,this.unloadStyleSheet,this));this.setStyle(a?a.style:void 0);this._header=a},onload:function(){this.getCompType();this._connects=(this._connects||[]).concat(f.addInActivityMonitor(this.getDocument()));var a=this.getMobileDevice();a&&(this.setMobileDevice(a),
this.visualEditor.setDevice(a,!0),this.visualEditor.setOrientation(this.getMobileOrientation()));this._configDojoxMobile(!0);window.setTimeout(function(){this.widgetAddedOrDeleted();b.publish("/davinci/ui/context/loaded",[this]);this._markDirtyAtLoadTime?(this.editor.setDirty(!0),delete this._markDirtyAtLoadTime,this.editor.save(!0)):this.editor.setDirty(this.hasDirtyResources());this.addPseudoClassSelectors()}.bind(this),500)},_onLoadHelpers:function(){var a={};e("\x3e *",this.rootNode).map(q.getWidget).forEach(function(b){var c=
b.getHelper();if(c&&c.onLoad){var d=a[b.type];a[b.type]=!0;c.onLoad(b,d)}},this)},_addHeadElement:function(a,b,c){var d=this.getDocumentElement().getChildElement("head");if(!c){var f=this._significantAttrs[a]||"src";if(d.getChildElements(a).some(function(a){return a.getAttribute(f)===b[f]}))return}c=new r(a);for(var g in b)b.hasOwnProperty(g)&&c.addAttribute(g,b[g]);d.addChild(c);dojo.withGlobal(this.getGlobal(),function(){h.create(a,b,e("head")[0])})},_removeHeadElement:function(a,b){var c=this.getDocumentElement().getChildElement("head");
c.getChildElements(a).some(function(a){var d=!0,e;for(e in b)if(b.hasOwnProperty(e)&&a.getAttribute(e)!==b[e]){d=!1;break}if(d)return c.removeChild(a),!0});dojo.withGlobal(this.getGlobal(),function(){var c=a,d;for(d in b)b.hasOwnProperty(d)&&(c+="["+d+'\x3d"'+b[d]+'"]');e(c).orphan()})},getDocument:function(){var a=this.getContainerNode();return a&&a.ownerDocument},getGlobal:function(){var a=this.getDocument();return a?k.get(a):null}})})},"davinci/ve/_ContextWidgets":function(){define("dojo/_base/declare dojo/query dojo/Deferred dojo/promise/all dojo/_base/connect ../Theme ./widget ./Focus ./metadata ./States ./HTMLWidget ./utils/GeomUtils dojox/html/_base".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c){return p(null,{_processWidgets:function(a,b,c,d){var f=[];this._loadFileDojoTypesCache={};dojo.forEach(m("*",a),function(a){var b=a.getAttribute("data-dojo-type")||a.getAttribute("dojoType")||a.getAttribute("dvwidget");b||(b="html."+a.tagName.toLowerCase());f.push(this.loadRequires((b||"").replace(/\./g,"/"),!1,!0));f.push(this._preProcess(a));this._preserveStates(a,c);this._preserveDojoTypes(a)},this);var g=new h;e(f).then(function(){this.getGlobal().require("dojo/ready")(function(){try{this.getGlobal().require("dijit/registry"),
this.getGlobal().require("dojo/parser").parse(a).then(function(){this._restoreDojoTypes();g.resolve();b&&this._attachAll();if(d)try{dojox.html.evalInGlobal(d,a)}catch(c){console.error("Error eval script in Context._setSourceData, "+c)}}.bind(this),function(a){g.reject(a)})}catch(c){console.error("error in _processWidgets",c),g.reject(c)}}.bind(this))}.bind(this));return g},_preProcess:function(b){var c=b.getAttribute("data-dojo-type")||b.getAttribute("dojoType");c||(c="html."+b.tagName.toLowerCase());
return a.requireWidgetHelper((c||"").replace(/\./g,"/")).then(function(a){a&&a.preProcess&&a.preProcess(b,this)}.bind(this))},attach:function(a){if(a&&!a._edit_focus)if(a._srcElement||(a._srcElement=this._srcDocument.findElement(a.id)),a.type||(a.type=a.isHtmlWidget?"html."+a.getTagName():a.isGenericWidget?a.domNode.getAttribute("dvwidget"):a.isObjectWidget?a.getObjectType():a.declaredClass.replace(/\./g,"/")),a.metadata=a.metadata||n.query(a.type),a._edit_context=this,a.attach(),"_"==a.type.charAt(a.type.lastIndexOf(".")+
1))a.internal=!0;else{var b=a.getId();if(b){var c=this._widgetIds;-1===c.indexOf(b)&&c.push(b)}if(b=a.getObjectId(a))c=this._objectIds,-1===c.indexOf(b)&&c.push(b);dojo.forEach(a.getChildren(!0),this.attach,this)}},_attachAll:function(){var a=this.rootWidget=new d({},this.rootNode);a._edit_context=this;a.isRoot=!0;this._srcDocument.getDocumentElement().getChildElement("body");a._srcElement=this._srcDocument.getDocumentElement().getChildElement("body");a._srcElement&&a._srcElement.setAttribute("id",
"myapp");this._attachChildren(this.rootNode)},_attachChildren:function(b){m("\x3e *",b).map(a.getWidget).forEach(this.attach,this)},detach:function(a){this.getGlobal();var b=function(a,b){var c=a.indexOf(b);-1!=c&&a.splice(c,1)},c=a.getId(),d=this;c&&b(this._widgetIds,c);(c=a.getObjectId())&&b(this._objectIds,c);if(this._selection)for(b=0;b<this._selection.length;b++)this._selection[b]==a&&(this.focus(null,b),this._selection.splice(b,1));if(b=n.getLibraryForType(a.type)){var c=b.name,e=[a.type,this];
n.invokeCallback(b,"onRemove",e);--this._widgets[c];0===this._widgets[c]&&n.invokeCallback(b,"onLastRemove",e)}a.getChildren();dojo.forEach(a.getChildren(),function(a){d.detach(a)},this);delete this._containerControls},widgetChanged:function(a,b){1==a?this.widgetHash[b.id]=b:2==a&&delete this.widgetHash[b.id]},resizeAllWidgets:function(){this.getTopWidgets().forEach(function(a){a.resize&&a.resize()})},getAllWidgets:function(){var a=[],b=function(c){a.push(c);c.getChildren().forEach(function(a){b(a)})};
this.rootWidget&&b(this.rootWidget);return a},widgetAddedOrDeleted:function(a){var b=k.getHelper(this.getTheme());b&&b.widgetAddedOrDeleted?b.widgetAddedOrDeleted(this,a):b&&b.then&&b.then(function(b){b.helper&&(this.theme.helper=b.helper,b.helper.widgetAddedOrDeleted&&b.helper.widgetAddedOrDeleted(this,a))}.bind(this))},clearCachedWidgetBounds:function(){this.getAllWidgets().forEach(function(a){(a=a.domNode)&&c.clearGeomCache(a)})},updateFocus:function(b,d,e){this.editor.getDisplayMode&&"source"==
this.editor.getDisplayMode()||a.requireWidgetHelper(b.type).then(function(a){if(this.editor.isActiveEditor()){var f,g,k;if(!n.queryDescriptor(b.type,"isInvisible"))switch((a=b.getHelper())&&a.getMarginBoxPageCoords?f=a.getMarginBoxPageCoords(b):(f=b.getStyleNode(),a&&a.getSelectNode&&(f=a.getSelectNode(this)||f),f=c.getMarginBoxPageCoords(f)),k=b.getParent(),g={move:!(k&&k.isLayout&&k.isLayout())},k&&k.isLayout&&k.isLayout()?"none":n.queryDescriptor(b.type,"resizable")){case "width":g.resizeWidth=
!0;break;case "height":g.resizeHeight=!0;break;case "both":g.resizeWidth=!0,g.resizeHeight=!0}this.focus({box:f,op:g,hasLayout:b.isLayout&&b.isLayout(),isChild:k&&k.isLayout&&k.isLayout()},d,e);this._focuses[0].showContext(this,b)}}.bind(this))},updateFocusAll:function(){if(!this.editor||!this.editor.getDisplayMode||"source"!=this.editor.getDisplayMode()){var a=this._selection;if(a)for(var b=0;b<a.length;b++)this.updateFocus(a[b],b);f.updateHighlightsBaseStateWidgets(this)}},hideFocusAll:function(a){a||
(a=0);var b=this.getFocusContainer();if(this._focuses)for(;a<this._focuses.length;a++){var c=this._focuses[a];c.domNode.parentNode==b&&(c.hide(),b.removeChild(c.domNode))}},getFocus:function(a){a=this.getSelection().indexOf(a);return-1==a?null:this._focuses[a]},isFocusNode:function(a){if(this._selection&&this._selection.length&&this._focuses&&this._focuses.length>=this._selection.length)for(var b=0;b<this._selection.length;b++)if(this._focuses[b].isFocusNode(a))return!0;return!1},focus:function(a,
c,d){this._focuses=this._focuses||[];var e=!1;void 0===c&&(e=!0,c=0);var f;c<this._focuses.length?f=this._focuses[c]:(dojo.withDoc(this.getDocument(),dojo.hitch(this,function(){f=new g;f._edit_focus=!0;f._context=this})),this._focuses.push(f));var k=this.getFocusContainer();if(a){if(a.box&&a.op){f._connected||(this._connects.push(b.connect(f,"onExtentChange",this,"onExtentChange")),f._connected=!0);var h=this.getSelection();f.resize(a.box,h[0]);var n=c<h.length?c:0;f.resize(a.box,h[n]);f.allow(a.op);
f.domNode.parentNode!=k&&k.appendChild(f.domNode);f.show(h[n],{inline:d})}else f.hide();c++}else e||(f.domNode.parentNode==k&&(f.hide(),k.removeChild(f.domNode)),this._focuses.splice(c,1),this._focuses.push(f));e&&this.hideFocusAll(c)},getFocusContainer:function(){var a=document.getElementById("focusContainer");a||(a=dojo.create("div",{"class":"focusContainer",id:"focusContainer"},document.body),davinci.Workbench.focusContainer=a);return a},getTopWidgets:function(){for(var a=[],b=this.rootNode.firstChild;b;b=
b.nextSibling)1==b.nodeType&&b._dvWidget&&a.push(b._dvWidget);return a}})})},"davinci/ui/Resource":function(){define("system/resource ../model/Path ../Runtime ../Workbench ../workbench/Preferences ../ve/RebuildPage ./Rename ./widgets/OpenFile ./widgets/NewFolder ./NewProject dojo/i18n!./nls/ui davinci/Theme dijit/form/Button".split(" "),function(p,m,h,e,b,k,a,g,n,f,d,c){var q=function(a){(a=p.findResource(a))&&alert("File already exists!");return!a},u=function(){return(r.getSelectedResources()||[])[0]},
r={newHTMLDialogSpecificClass:"davinci/ui/widgets/NewHTMLFileOptions",newHTMLMobile:function(){this.newHTML({comptype:"mobile",title:d.createMobileApplication,dialogSpecificClassOptions:{showDevices:!0,showThemeSetsButton:!0}})},newHTMLDesktop:function(){this.newHTML({comptype:"desktop",title:d.createDesktopApplication,dialogSpecificClassOptions:{showDevices:!1,showThemeSetsButton:!0},device:"desktop"})},newHTMLSketchHiFi:function(){this.newHTML({comptype:"sketchhifi",title:d.createSketchHiFi,dialogSpecificClassOptions:{showDevices:!1,
showThemeSetsButton:!0},layout:"absolute",theme:"claro"})},newHTMLSketchLoFi:function(){this.newHTML({comptype:"sketchlofi",title:d.createSketchLoFi,dialogSpecificClassOptions:{showDevices:!1,showThemeSetsButton:!1},layout:"absolute",theme:"Sketch"})},newHTML:function(a){e.showModal(void 0,a.title,"",function(){var b,c;(void 0).dialogSpecificWidget&&(b=(void 0).dialogSpecificWidget,c=b.getOptions());b=(void 0).get("value");p.createResource(b,!1,!1,function(b){b.isNew=!0;b.dirtyResource=!0;var d=p.createText("HTML",
{resource:b});d&&b.setText(d);d="none";a&&a.dialogSpecificClassOptions&&a.dialogSpecificClassOptions.showDevices&&(d=c?c.device:"none");var f=a&&a.layout?a.layout:!0,g=a&&a.theme?a.theme:null,k=null;a&&a.dialogSpecificClassOptions&&a.dialogSpecificClassOptions.showThemeSetsButton&&(g=c?c.theme:null,k=(void 0).dialogSpecificWidget?(void 0).dialogSpecificWidget._selectedThemeSet:null);r.openResource(b,{comptype:a.comptype,device:d,flowlayout:f+"",theme:g,themeSet:k});(b=e.workbenchStateCustomPropGet("nhfo"))||
(b={});d=e.getActiveProject();b[d]=c;e.workbenchStateCustomPropSet("nhfo",b)})},!0)},newCSS:function(){e.showModal(void 0,d.createNewCSSFile,"",function(){var a=(void 0).get("value");p.createResource(a,!1,!1,function(a){a.isNew=!0;var b=p.createText("CSS",{resource:a});b&&a.setText(b);r.openResource(a)})},!0)},selectResource:function(a){for(var b=dijit.byId("resourceTree"),c=[];a.parent;a=a.parent)c.unshift(a);b.set("path",c)},newFolder:function(a,c){var f=a||u(),g;f?g="Folder"==f.elementType?f:f.parent:
(f=e.getProject(),f=b.getPreferences("davinci.ui.ProjectPrefs",f),null!=f.webContentFolder&&""!=f.webContentFolder&&(g=(new m(e.getProject())).append(f.webContentFolder),g=p.findResource(g.toString())),g||(g=p.findResource(e.getProject())));g={newFileName:r.getNewFileName("folder",g),fileFieldLabel:d.folderName,folderFieldLabel:d.parentFolder,root:g,finishButtonLabel:d.createFolder,checkFileName:q};var k=new n(g),h;e.showModal(k,d.createNewFolder,"",function(){var a=k.get("value");h=p.createResource(a,
!0);c&&c(h);null!=h&&r.selectResource(h)},!0)},closeEditor:function(a,b){var c=e.getOpenEditor(a);null!=c&&(b&&c.save(),c.editorContainer.forceClose(c));return null!=c},save:function(){var a=e.getOpenEditor();a&&system.resource.findResourceAsync(a.fileName).then(dojo.hitch(this,function(b){b.readOnly()?this.saveAs(b.getExtension(),d.savingReadonlyFile):a.save()}))},saveAs:function(a,b){var f=e.getOpenEditor(),g=f.fileName;(new m(g)).lastSegment();p.findResource(g);e.showModal(void 0,d.saveFileAs,
"",function(){var a=(void 0).get("value");p.findResource(g);var b,d,h;b="davinci.html.CSSEditor"==f.editorID?f.getText():f.model&&f.model.getText?f.model.getText():f.getText();"davinci.ve.HTMLPageEditor"==f.editorID&&(d=c.getThemeSet(f.visualEditor.context),h=f.visualEditor.context.theme);var n=p.findResource(a);f.editorContainer.forceClose(f);n&&(n.removeWorkingCopy(),n.deleteResource());f.isDirty=!1;var m=p.createResource(a);(new k).rebuildSource(b,m,h,d).then(function(a){m.setContents(a).then(function(){e.openEditor({fileName:m})})})})},
newJS:function(){e.showModal(void 0,d.createNewJSFile,"",function(){var a=(void 0).get("value");p.createResource(a,!1,!1,function(a){a.isNew=!0;var b=p.createText("CSS",{resource:a});b&&a.setText(b);r.openResource(a)})})},openFile:function(){u()||p.findResource(e.getProject());var a=new g({finishButtonLabel:d.open});e.showModal(a,d.openFile,{width:350,height:250},function(){r.openResource(a.get("value"))},!0)},addFiles:function(){var a=new AddFiles({selectedResource:u()});e.showModal(a,d.addFiles,
{width:350},null)},addFilesZip:function(){var a=new AddFilesZip({selectedResource:u()});e.showModal(a,d.addFiles,{width:350},null)},getNewFileName:function(a,b,c){var d,f,e=0;c||(c="");do e++,f="folder"===a?"folder"+e:"file"+e+c,d=b.getPath()+"/"+f,d=p.findResource(d);while(d);return f},canModify:function(a){return!a.readOnly()},newProject:function(){var a=new f({});e.showModal(a,d.newProject,{"min-width":"330px"},null,!0)},renameAction:function(){var b=r.getSelectedResources();if(1==b.length){var c=
b[0];c.parent.getChildren(function(b){b=b.map(function(a){return a.name});var f=new a({value:c.name,invalid:b});e.showModal(f,d.renameDialogTitle,"",function(){var a=f.attr("cancel"),b=f.attr("value");if(!a){var d=r.closeEditor(c,!0);c.rename(b).then(function(){d&&r.openResource(c)})}return!0},!0)},!0)}},getResourceIcon:function(a,b){var c=a.readOnly();if("Folder"==a.elementType)return c?b?"dijitFolderOpened maqettaReadonlyFolderOpened":"dijitFolderClosed maqettaReadonlyFolderClosed":b?"dijitFolderOpened":
"dijitFolderClosed";if("File"==a.elementType){var d;fileType=a.getExtension();if(extension=h.getExtension("davinci.fileType",function(a){return a.extension==fileType}))d=extension.iconClass,c&&(d+="ReadOnly");d||(d="dijitLeaf",c&&(d+=" maqettaReadonlyFile"));return d}return this.prototype.getIconClass(a,b)},getResourceClass:function(a){if(a.readOnly())return"readOnlyResource"},deleteAction:function(){var a=r.getSelectedResources(),b=a.map(function(a){return a.getPath()}).join("\n\t"),b=dojo.string.substitute(d.areYouSureDelete,
[b]),b=b+("\n\n"+d.NoteOperationNotUndoable+"\n");confirm(b)&&a.forEach(function(a){r.closeEditor(a);a.deleteResource()})},getSelectedResources:function(){var a=h.getSelection();if(a[0]&&a[0].resource)return dojo.map(a,function(a){return a.resource})},alphabeticalSortFilter:{filterList:function(a){return a.sort(function(a,b){return a.name>b.name?1:a.name<b.name?-1:0})}},foldersFilter:{filterItem:function(a){if("File"==a.elementType)return!0}},openPath:function(a,b){var c={fileName:a};b&&(c.text=b);
e.openEditor(c)},openResource:function(a,b){"File"==a.elementType&&a.getContent().then(function(c){e.openEditor({fileName:a,content:c},b)})}};return dojo.setObject("davinci.ui.Resource",r)})},"davinci/ui/Rename":function(){define("dojo/_base/declare dijit/_Templated dijit/_Widget dojo/i18n!davinci/ui/nls/ui dojo/i18n!dijit/nls/common dojo/text!./templates/Rename.html".split(" "),function(p,m,h,e,b,k){return p("davinci.ui.Rename",[h,m],{widgetsInTemplate:!0,templateString:k,_okButton:null,_newName:null,
postMixInProperties:function(){dojo.mixin(this,e);dojo.mixin(this,b);this.invalid||(this.invalid={});this.inherited(arguments)},postCreate:function(){this.inherited(arguments);dojo.connect(this._newName,"onkeyup",this,"_checkValid");this.value&&this._setValueAttr(this.value);this.invalid&&this._setInvalidAttr(this.invalid)},_setInvalidAttr:function(a){this.invalid=a},_checkValid:function(){for(var a=dojo.attr(this._newName,"value"),b=null!=a&&0<a.length,e=0;e<this.invalid.length&&b;e++)this.invalid[e]==
a&&(b=!1);this._okButton.set("disabled",!b)},okButton:function(){this.value=dojo.attr(this._newName,"value")},_getValueAttr:function(){return this.value},_setValueAttr:function(a){this.value=a;this._newName&&dojo.attr(this._newName,"value",this.value);this._checkValid()},cancelButton:function(){this.cancel=!0;this.onClose()},_getCancelAttr:function(a){return this.cancel},onClose:function(){}})})},"davinci/ui/widgets/NewFolder":function(){define("dojo/_base/declare dijit/_Templated dijit/_Widget davinci/library davinci/Workbench system/resource davinci/workbench/Preferences davinci/Runtime dijit/Menu dijit/MenuItem davinci/model/Path dijit/form/DropDownButton dojo/i18n!davinci/ui/nls/ui dojo/i18n!dijit/nls/common dojo/text!./templates/NewFolder.html dijit/form/Button dijit/form/TextBox dijit/form/RadioButton".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r){return p("davinci.ui.widgets.NewFolder",[h,m],{widgetsInTemplate:!0,templateString:r,folderName:null,fileDialogParentFolder:null,okButton:null,uiNLS:q,postMixInProperties:function(){this.inherited(arguments)},postCreate:function(){this.inherited(arguments);dojo.connect(this.folderName,"onkeyup",this,"_checkValid");this._value||this._setRootAttr(this._getRootAttr());this.okButton.onClick=dojo.hitch(this,this._okButton)},_setValueAttr:function(a){a!=this._value&&
((this._value=a)&&"Folder"==a.elementType?this.fileDialogParentFolder.innerHTML=a.getName():a&&(this.fileDialogParentFolder.innerHTML=a.parent.getPath()))},_setNewFileNameAttr:function(a){this.folderName.set("value",a)},_getRootAttr:function(){if(this._root)return this._root;var c=a.getPreferences("davinci.ui.ProjectPrefs",base);return null!=c.webContentFolder&&""!=c.webContentFolder?(c=(new d(b.getProject())).append(c.webContentFolder),k.findResource(c.toString())):k.findResource(b.getProject())},
_setRootAttr:function(a){this._root=a;this.fileDialogParentFolder.innerHTML=a.getPath()},_checkValid:function(){var a=this.folderName.get("value");this._okButton.set("disabled",!(null!=a&&0<a.length))},_okButton:function(){this.value=this.fileDialogParentFolder.innerHTML+"/"+this.folderName.get("value");return this.checkFileName(this.value)?!0:!1},_getValueAttr:function(){return this.value=this.fileDialogParentFolder.innerHTML+"/"+this.folderName.get("value")},_cancelButton:function(){this.onClose()},
_createResource:function(){var a=k.findResource(this.fileDialogParentFolder.innerHTML+"/"+this.folderName.get("value"));return a?a:k.findResource(this.fileDialogParentFolder.innerHTML).createResource(this.folderName.get("value"))},onClose:function(){}})})},"davinci/ui/NewProject":function(){define("dojo/_base/declare dojo/_base/lang dojo/on dojo/aspect dojo/Deferred dojo/dom-attr dijit/_Templated dijit/_Widget davinci/library system/resource davinci/workbench/Preferences davinci/Runtime davinci/Workbench davinci/ui/ProjectTemplates dojo/i18n!davinci/ui/nls/ui dojo/i18n!dijit/nls/common dojo/text!./templates/NewProject.html dijit/form/Button dijit/form/RadioButton dijit/form/ValidationTextBox".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y){return p([g,a],{widgetsInTemplate:!0,templateString:y,_okButton:null,_projectName:null,_eclipseSupport:null,_projectTemplate:"_none_",_regex:/^[\w\-\.\_]+$/,_postCreateDeferred:null,constructor:function(){this._postCreateDeferred=new b;f.listProjects(function(a){function b(a){var c="0000";0<=a&&15>=a?c="000"+a.toString(16):16<=a&&255>=a?c="00"+a.toString(16):256<=a&&4095>=a?c="0"+a.toString(16):4096<=a&&65535>=a&&(c=a.toString(16));return c}this._allCurrentProjectNames=
[];for(var c="",d=0;d<a.length;d++){for(var f=a[d].name,c=c+"(?!^",e=0;e<f.length;e++)var g=f.charCodeAt(e),c=c+("\\u"+b(g));c+="$)"}c+="^[\\w\\-\\.\\_]+$";this._regex=new RegExp(c);this._postCreateDeferred.then(function(){this._projectName.set("regExp",c)}.bind(this))}.bind(this))},postMixInProperties:function(){m.mixin(this,r);m.mixin(this,z);f.listProjects(this.setProjects.bind(this));this.inherited(arguments)},setProjects:function(a){this._projects={};a.forEach(function(a){a&&(this._projects[a.name]=
!0)},this)},postCreate:function(){this.inherited(arguments);h(this._projectName,"keyup",this._checkValid.bind(this));this.projectTemplates.addOption([]);this._useProjectTemplate.disabled=!0;u.getIncremental(1E3,function(a,b,c){this._updateTemplates(a);return!1}.bind(this));this.projectTemplates.set("maxHeight",200);this._projectName.set("regExp","^[\\w\\-\\.\\_]+$");h(this._useProjectTemplate,"change",function(){this.projectTemplates.set("disabled",!this._useProjectTemplate.checked)}.bind(this));
this.projectTemplates.set("disabled",!this._useProjectTemplate.checked);e.around(this._projectName,"_isValidSubset",function(a){return function(){return!1}});this._postCreateDeferred.resolve()},_updateTemplates:function(a){var b=[];if(0<a.length){for(var c=0;c<a.length;c++){var d=a[c];d.folder&&d.name&&b.push({value:d.folder,label:(d.authorEmail?'\x3cspan class\x3d"NewProjectTemplateAuthor"\x3e\x26nbsp;\x26nbsp;(Author: '+d.authorEmail+")\x3c/span\x3e":"")+'\x3cspan class\x3d"NewProjectTemplateName"\x3e'+
d.name+"\x3c/span\x3e"})}this._useProjectTemplate.disabled=!1}else this._useProjectTemplate.disabled=!0;this.projectTemplates.addOption(b);this.projectTemplates.set("disabled",!this._useProjectTemplate.checked)},_checkValid:function(){if(!this._projects)return!1;var a=this._projectName.isValid();this._okButton.set("disabled",!a)},okButton:function(){var a=this._projectName.get("value"),b=k.get(this._cloneExistingProject,"checked")?q.getProject():"",c=this._getEclipseProjectAttr(),e=k.get(this._useProjectTemplate,
"checked")?this.projectTemplates.get("value"):"";f.createProject({newProjectName:a,projectTemplateName:e,projectToClone:b,eclipseSupport:c}).then(function(){c&&d.savePreferences("davinci.ui.ProjectPrefs",a,{webContentFolder:"WebContent",themeFolder:"WebContent/themes",widgetFolder:"WebContent/lib/custom"});q.loadProject(a)})},_getEclipseProjectAttr:function(){return k.get(this._eclipseSupport,"checked")},_getValueAttr:function(){return this.value},_onChangeTemplate:function(a){this._projectTemplate=
a},cancelButton:function(){this.cancel=!0;this.onClose()},onClose:function(){}})})},"davinci/ui/ProjectTemplates":function(){define(["dojo/_base/declare","dojo/request/xhr","davinci/Runtime","davinci/Workbench"],function(p,m,h,e){return dojo.setObject("davinci.ui.ProjectTemplates",{getIncremental:function(b,e){this._getProjectTemplatesPartial(0,b,[],e)},_getProjectTemplatesPartial:function(b,e,a,g){this._getProjectTemplatesSendRequest({offset:b,limit:e},function(a,b,d){var c=!1;if(d.success)if("number"==
typeof d.totalNumProjectTemplates&&"number"==typeof d.offset&&"number"==typeof d.limit&&0<=d.offset&&1<=d.limit&&d.projectTemplatesObject&&d.projectTemplatesObject.projectTemplates){a=a.concat(d.projectTemplatesObject.projectTemplates);var g=d.offset+d.limit,h=g>=d.totalNumProjectTemplates;b(a,d,h)||h||this._getProjectTemplatesPartial(g,e,a,b)}else c=!1;else c=!1;c&&console.error("_getProjectTemplatesPartial: unexpected response from server. returnData\x3d")}.bind(this,a,g))},_getProjectTemplatesSendRequest:function(b,
e){var a=JSON.stringify(b,null,"\t");m.post("cmd/getProjectTemplates",{handleAs:"json",query:{params:a}}).then(function(a){e(a)},function(a){console.error("_getProjectTemplatesSendRequest xhr error. err\x3d")})},create:function(b){if(b&&b.projectTemplateName){var k=b.projectTemplateName;b="all"==b.sharingSimple?"all":"none";var a=(new Date).toISOString();b={projectTemplateName:k,projectToClone:e.getProject(),sharingSimple:b,timestamp:a};k=JSON.stringify(b,null,"\t");(k=h.serverJSONRequest({url:"cmd/createProjectTemplate",
handleAs:"json",content:{params:k},sync:!0}))&&k.success||console.error("cmd/createProjectTemplate error:"+k.error);return k}},modify:function(b){b=JSON.stringify(b,null,"\t");(b=h.serverJSONRequest({url:"cmd/modifyProjectTemplates",handleAs:"json",content:{params:b},sync:!0}))&&b.success||console.error("cmd/modifyProjectTemplate error:"+b.error);return b},deleteTemplates:function(b){b=JSON.stringify(b,null,"\t");(b=h.serverJSONRequest({url:"cmd/deleteProjectTemplates",handleAs:"json",content:{params:b},
sync:!0}))&&b.success||console.error("cmd/deleteProjectTemplate error:"+b.error);return b}})})},"davinci/actions/StickyNoteAction":function(){define("dojo/_base/declare ./Action ../Workbench davinci/commands/CompoundCommand ../ve/commands/AddCommand ../ve/commands/MoveCommand ../ve/commands/ResizeCommand ../ve/tools/CreateTool ../ve/widget ../ve/metadata".split(" "),function(p,m,h,e,b,k,a,g,n,f){return p("davinci.actions.StickyNoteAction",m,{run:function(d){var c=h.getOpenEditor();if(d=davinci.ve.metadata.queryDescriptor("html.stickynote")){var m=
dojo.clone(d);m.context=c.getContext();if(c&&c.getContext){var p=void 0;dojo.withDoc(c.getContext().getDocument(),function(){p=n.createWidget(m)});p&&(d=new e,c.getContext().getDocument(),c.getContext().getContainerNode(),d.add(new b(p,c.getContext().getContainerNode())),g.prototype.checkAddToCurrentState(d,p),d.add(new k(p,50,50)),p.isLayoutContainer&&d.add(new a(p,args.size&&args.size.w,args.size&&args.size.h)),c.getContext().getCommandStack().execute(d),f.getSmartInput(p.type).then(function(a){a&&
a.displayOnCreate?c.getContext().select(p,null,!0):c.getContext().select(p)}.bind(this)))}}},isEnabled:function(a){return(a=h.getOpenEditor())&&a.getContext}})})},"davinci/actions/SaveAsWidget":function(){define("dojo/_base/declare ./Action ../Workbench davinci/ui/Dialog ../ui/SaveAsWidgetForm dojo/i18n!../ui/nls/common".split(" "),function(p,m,h,e,b,k){return p("davinci.actions.SaveAsWidget",m,{run:function(a){"davinci.ve.Context"!==a.declaredClass&&(a="function"===typeof a.getContext?a.getContext():
h.getOpenEditor().getContext());a=this._generateMetadata(a);this._showDialog(a)},_generateMetadata:function(a){var b={spec:"1.0",require:[],library:{}},e=a.model.find({elementType:"HTMLElement",tag:"body"},!0);b.content=dojo.trim(e.getText(a).match(/<body[^>]*>([\s\S]*)<\/body>/)[1]);this._getRequires(a.getTopWidgets(),b);return b},_getRequires:function(a,b){function e(a,b,c){dojo.forEach(a,function(a){if(!c.hasOwnProperty(a.type)){c[a.type]=!0;dojo.forEach(a.metadata.require,function(a){this._inRequiresArray(a,
b.require)||b.require.push(a)},this);for(var d in a.metadata.library)a.metadata.library.hasOwnProperty(d)&&(b.library[d]||(b.library[d]=a.metadata.library[d]))}e.call(this,a.getChildren(),b,c)},this)}var f=f||{};e.call(this,a,b,f);if(1<b.require.length){for(var f=b.require.slice(0,1),d=1;d<b.require.length;d++){var c=b.require[d];c.$text&&f[f.length-1].$text?f[f.length-1].$text+="\n"+c.$text:f.push(c)}b.require=f}},_inRequiresArray:function(a,b){var e=a.$text?a.$text.replace(/\s/g," "):"";return dojo.some(b,
function(b){return a.type===b.type&&(a.src&&b.src&&a.src===b.src&&(a.$library&&b.$library&&a.$library===b.$library||!a.$library&&!b.$library)||a.$text&&b.$text&&e===b.$text.replace(/\s/g," "))})},_showDialog:function(a){var g=new e({title:k.sawdTitle,"class":"dvSaveAsWidgetDialog",execute:dojo.hitch(this,function(a){this._saveMetadata(a.metadata)}),onHide:function(){setTimeout(function(){g.destroyRecursive()},g.duration)}});a=new b({parentId:g.id,metadata:a});g.set("content",a);g.show()},_saveMetadata:function(a){}})})},
"davinci/ui/SaveAsWidgetForm":function(){define("dojo/_base/declare dijit/_Templated dijit/_Widget dojo/i18n!davinci/ui/nls/ui dojo/i18n!dijit/nls/common dojo/text!./templates/SaveAsWidgetForm.html".split(" "),function(p,m,h,e,b,k){return dojo.declare("davinci.ui.SaveAsWidgetForm",[h,m],{templateString:k,widgetsInTemplate:!0,postMixInProperties:function(){this.descriptionString=b.sawfDesc;this.nameString=b.name;this.idString=b.id;this.versionString=b.version;this.requiredString=b.required;this.saveString=
b.save;this.cancelString=b.cancel;this.metadataTitle=b.sawfMetadataTitle;this.namePromptString=b.sawfNamePrompt;this.idPromptString=b.sawfIdPrompt;this.initialTextareaContent=dojo.toJson(this.metadata,!0)},postCreate:function(){this.inherited(arguments);dojo.forEach(["nameInputNode","idInputNode","versionInputNode","textareaNode"],function(a){this.connect(this[a],"onChange",function(b){this._onChange(a,b)})},this);this.idInputNode.regExp="[a-zA-Z]+://[^\\s]+";this.connect(this.buttonCancel,"onClick",
function(){dijit.byId(this.parentId).hide()})},_onChange:function(a,b){switch(a){case "nameInputNode":this.metadata.name=b;break;case "idInputNode":this.metadata.id=b;break;case "versionInputNode":this.metadata.version=b;break;case "textareaNode":try{this.metadata=dojo.fromJson(b),this._invalidMetadata=!1}catch(e){this._invalidMetadata=!0}}"textareaNode"!==a&&this.textareaNode.set("value",dojo.toJson(this.metadata,!0));this.buttonSave.set("disabled",!this._isValid())},_isValid:function(){return this.idInputNode.isValid()&&
!this._invalidMetadata}})})},"davinci/actions/UserNameAction":function(){define(["dojo/_base/declare","davinci/Runtime","./Action","dojo/i18n!davinci/ui/nls/ui"],function(p,m,h,e){return p("davinci.actions.UserNameAction",h,{run:function(){},getName:function(){var b=m.getUserDisplayName();return e.User+": \x3ci\x3e"+b+"\x3c/i\x3e"}})})},"davinci/actions/LogoutAction":function(){define(["dojo/_base/declare","./Action","dojo/i18n!davinci/ui/nls/ui"],function(p,m,h){return p("davinci.actions.LogoutAction",
m,{run:function(){dojo.xhrPost({url:"../logout",handleAs:"text",headers:{"Content-Type":"application/x-www-form-urlencoded","Orion-Version":"1"},postData:"",load:function(e,b){location.href="welcome"}.bind(this)})},isEnabled:function(e){return!0}})})},"davinci/ve/actions/CopyAction":function(){define(["dojo/_base/declare","./_CutCopyAction","../../Runtime"],function(p,m,h){return p("davinci.ve.actions.CopyAction",[m],{_invokeSourceEditorAction:function(e){e.htmlEditor.copyAction.run()},_executeAction:function(e,
b,k,a){a=h.clipboard;h.clipboard=k;if(!a)e.onSelectionChange(b)}})})},"davinci/ve/actions/_CutCopyAction":function(){define("dojo/_base/declare davinci/Workbench davinci/ve/actions/ContextAction davinci/commands/CompoundCommand davinci/ve/commands/RemoveCommand davinci/ve/widget".split(" "),function(p,m,h,e,b,k){return p("davinci.ve.actions.CutAction",[h],{run:function(a){if(a=this.fixupContext(a))if("davinci.ve.PageEditor"==a.declaredClass&&"source"==a._displayMode)this._invokeSourceEditorAction(a);
else{var g=this._normalizeSelection(a);if(0<g.length){var h=new e,f=[],d=a.reorderPreserveSiblingOrder(g);dojo.forEach(d,function(a){var d=a.getData({identify:!1});d&&f.push(d);var e=a.getHelper();if(e&&e.getRemoveCommand){if(a=e.getRemoveCommand(a),"compound"===a.name){for(var e=[],g=a._commands,m=g.length-1;0<m;m--){var p=g[m];"remove"===p.name&&(p=k.byId(p._id).getData({identify:!1}),e.push(p))}d.associatedCopiedWidgetData=e}}else a=new b(a);h.add(a)});this._executeAction(a,g,f,h)}}},isEnabled:function(a){a=
this.fixupContext(a);var b=m.getOpenEditor();return b&&a?(a=0<a.getSelection().length,"davinci.ve.PageEditor"==b.declaredClass?(b=b.getDisplayMode(),a&&"source"!=b):a):!1},shouldShow:function(a){return(a=(a=this.fixupContext(a))?a.editor:null)&&"davinci.ve.PageEditor"==a.declaredClass},_invokeSourceEditorAction:function(a){},_executeAction:function(a,b,e,f){}})})},"davinci/ve/commands/RemoveCommand":function(){define(["dojo/_base/declare","davinci/ve/commands/_hierarchyCommand","davinci/ve/widget",
"davinci/ve/States","davinci/ve/commands/ModifyCommand"],function(p,m,h,e,b){return p("davinci.ve.commands.RemoveCommand",[m],{name:"remove",constructor:function(b){this._id=b?b.id:void 0},execute:function(){if(this._id){var k=h.byId(this._id);if(k){var a=k.getContext(),g=k.getParent()||a.getContainerNode(),n,f=k.getHelper();f&&f.onRemove&&(n=f.onRemove(k));if(!this._data){this._index=dojo.indexOf(g.getChildren(),k);if(0>this._index)return;this._data=k.getData();this._parentId=g.id}this._data.context=
a;f=this._isRefreshOnDescendantChange(k);a&&a.detach(k);g.removeChild(k);a&&a.widgetChanged(a.WIDGET_REMOVED,k);k.destroyWidget();a&&a.widgetAddedOrDeleted();f&&(new b(f,null,null,g._edit_context)).execute();e.resetState(k.domNode);n&&n()}}},undo:function(){if(this._data&&this._parentId){var k=h.byId(this._parentId);if(k){var a=h.createWidget(this._data);if(a){k.addChild(a,this._index);var g=k.getContext();g&&(g.attach(a),a.startup(),a.renderWidget(),g.widgetAddedOrDeleted(),g.widgetChanged(g.WIDGET_ADDED,
a),(g=this._isRefreshOnDescendantChange(a))&&(new b(g,null,null,k._edit_context)).execute(),e.resetState(a.domNode))}}}}})})},"davinci/ve/actions/CutAction":function(){define(["dojo/_base/declare","./_CutCopyAction","../../Runtime"],function(p,m,h){return p("davinci.ve.actions.CutAction",[m],{_invokeSourceEditorAction:function(e){e.htmlEditor.cutAction.run()},_executeAction:function(e,b,k,a){h.clipboard=k;e.select(null);e.getCommandStack().execute(a)}})})},"davinci/ve/actions/DeleteAction":function(){define(["dojo/_base/declare",
"davinci/Workbench","davinci/ve/actions/ContextAction","davinci/commands/CompoundCommand","davinci/ve/commands/RemoveCommand"],function(p,m,h,e,b){return p("davinci.ve.actions.DeleteAction",[h],{run:function(k){if(k=this.fixupContext(k)){var a=this._normalizeSelection(k);if(0<a.length){var g=void 0;if(1===a.length)var a=a[0],h=a.getHelper(),g=h&&h.getRemoveCommand?h.getRemoveCommand(a):new b(a);else g=new e,dojo.forEach(a,function(a){var d=a.getHelper();a=d&&d.getRemoveCommand?d.getRemoveCommand(a):
new b(a);g.add(a)});k.select(null);k.getCommandStack().execute(g)}}},isEnabled:function(b){b=this.fixupContext(b);var a=m.getOpenEditor();return a&&b?(b=0<b.getSelection().length,"davinci.ve.PageEditor"==a.declaredClass?(a=a.getDisplayMode(),b&&"source"!=a):b):!1},shouldShow:function(b){return(b=(b=this.fixupContext(b))?b.editor:null)&&"davinci.ve.PageEditor"==b.declaredClass}})})},"davinci/ve/actions/PasteAction":function(){define(["dojo/_base/declare","../../Workbench","./ContextAction","../tools/PasteTool",
"../../Runtime"],function(p,m,h,e,b){return p("davinci.ve.actions.PasteAction",[h],{shortcut:{keyCode:86,ctrlKey:!0},run:function(k){if(k=this.fixupContext(k))if("davinci.ve.PageEditor"==k.declaredClass&&"source"==k._displayMode)k.htmlEditor.pasteAction.run();else{var a=b.clipboard;a&&k.setActiveTool(new e(a))}},isEnabled:function(e){e=this.fixupContext(e);var a=m.getOpenEditor();return a&&e?"davinci.ve.PageEditor"==a.declaredClass?(e=a.getDisplayMode(),b.clipboard&&"source"!=e):b.clipboard:!1},shouldShow:function(b){return(b=
(b=this.fixupContext(b))?b.editor:null)&&"davinci.ve.PageEditor"==b.declaredClass}})})},"davinci/ve/tools/PasteTool":function(){define("dojo/_base/declare ./CreateTool ../widget ../metadata ../../commands/CompoundCommand ../commands/AddCommand ../commands/MoveCommand ../commands/StyleCommand dojo/Deferred dojo/promise/all".split(" "),function(p,m,h,e,b,k,a,g,n,f){return p("davinci.ve.tools.PasteTool",m,{constructor:function(a){this.inherited(arguments);this._position_prop=null;var b=a[0];b&&b.properties&&
(b=h.parseStyleValues(b.properties.style),this._position_prop=h.retrieveStyleProperty(b,"position",""))},_create:function(d){var c=d.index,m,p,r=new b,z,y=[],B=new n,x=this._data.map(function(b){var v=new n,A=[];if(!this._loadType(b,A))return v.reject(),v;f(A).then(function(){var f=h.parseStyleValues(b.properties&&b.properties.style);if("absolute"==this._position_prop){var n=parseInt(h.retrieveStyleProperty(f,"left","0px")),f=parseInt(h.retrieveStyleProperty(f,"top","0px"));m?p={x:n+m.x,y:f+m.y}:
d.position?(p=d.position,m={x:d.position.x-n,y:d.position.y-f}):(p={x:n,y:f},m={x:0,y:0})}dojo.withDoc(this._context.getDocument(),function(){var f=function(b){void 0!==c&&0<=c&&c++;y.push(b);if(p){var d=this._context.getPreference("absoluteWidgetsZindex");r.add(new g(b,[{position:"absolute"},{"z-index":d}]));b=new a(b,p.x,p.y,z,null,null,z);z||(z=b);r.add(b)}v.resolve()}.bind(this);b.context=this._context;e.getHelper(b.type,"tool").then(function(a){var e;a&&(e=new a(b));if(e&&e.addPasteCreateCommand)a=
{parent:d.parent||this._context.getContainerNode(),position:p,index:c},e.addPasteCreateCommand(r,a).then(function(a){if(!a)return v.reject(),v;f(a)});else{e=h.createWidget(b);if(!e)return v.reject(),v;r.add(new k(e,d.parent||this._context.getContainerNode(),c));this.checkAddToCurrentState(r,e);f(e)}}.bind(this))}.bind(this))}.bind(this));return v}.bind(this));f(x).then(function(){r.isEmpty()||(this._context.getCommandStack().execute(r),setTimeout(function(){y.forEach(function(a,b){this._context.select(a,
0<b)}.bind(this))}.bind(this),0));B.resolve()}.bind(this));return B},createWithFlowLayout:function(){return"absolute"!=this._position_prop}})})},"davinci/ve/actions/DuplicateAction":function(){define("dojo/_base/declare dojo/dom-style davinci/ve/actions/ContextAction davinci/commands/CompoundCommand davinci/ve/commands/AddCommand davinci/ve/commands/MoveCommand davinci/ve/tools/CreateTool davinci/ve/widget davinci/ve/utils/GeomUtils".split(" "),function(p,m,h,e,b,k,a,g,n){return p("davinci.ve.actions.DuplicateAction",
[h],{run:function(f){if((f=this.fixupContext(f))&&"davinci.ve.Context"===f.declaredClass&&"davinci/delite/Context"===f.declaredClass){var d=this._normalizeSelection(f);if(this.selectionSameParent(d)){var c=[];if(0<d.length){var h=new e;dojo.forEach(d,function(d){var e,p=d.getData({identify:!1});p&&(p.context=f,dojo.withDoc(f.getDocument(),function(){e=g.createWidget(p)},this),e&&(h.add(new b(e,d.getParent(),void 0)),a.prototype.checkAddToCurrentState(h,e),c.push(e),"absolute"==(d&&d.domNode?m.get(d.domNode,
"position"):null)&&(d=n.getMarginBoxPageCoords(d.domNode),d.l+=25,h.add(new k(e,d.l,d.t,void 0,void 0,void 0,!0)))))});f.getCommandStack().execute(h);dojo.forEach(c,function(a,b){f.select(a,0<b)},this)}}}},isEnabled:function(a){a=(a=this.fixupContext(a))&&a.getSelection?a.getSelection():[];return 0===a.length?!1:this.selectionSameParent(a)},shouldShow:function(a){return(a=(a=this.fixupContext(a))?a.editor:null)&&"davinci.ve.PageEditor"==a.declaredClass},selectionSameParent:function(a){if(0===a.length)return!1;
for(var b=a[0].getParent(),c=0;c<a.length;c++)if(a[c].getParent()!=b)return!1;return!0}})})},"davinci/ve/actions/EditValueAction":function(){define(["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(p,m){return p("davinci.ve.actions.EditValueAction",[m],{run:function(h){if((h=this.fixupContext(h))&&"davinci.ve.Context"===h.declaredClass&&"davinci/delite/Context"===h.declaredClass){var e=h.getSelection();1===e.length&&h.select(e[0],!1,!0)}},isEnabled:function(h){return(h=this.fixupContext(h))&&
0<h.getSelection().length},shouldShow:function(h){return(h=(h=this.fixupContext(h))?h.editor:null)&&"davinci.ve.PageEditor"==h.declaredClass}})})},"davinci/ve/actions/EditPropertiesAction":function(){define(["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(p,m){return p("davinci.ve.actions.EditPropertiesAction",[m],{run:function(h){(h=this.fixupContext(h))&&h.editor&&h.editor.editorContainer&&h.editor.editorContainer.hideShowProperties&&h.editor.editorContainer.hideShowProperties()},
isEnabled:function(h){this.fixupContext(h);return!0}})})},"davinci/ve/actions/SurroundAction":function(){define("dojo/_base/declare dojo/_base/array dojo/dom-style davinci/ve/actions/ContextAction davinci/commands/CompoundCommand davinci/ve/commands/AddCommand davinci/ve/commands/StyleCommand davinci/ve/commands/MoveCommand davinci/ve/commands/ResizeCommand davinci/ve/commands/ReparentCommand davinci/ve/tools/CreateTool davinci/ve/widget davinci/ve/utils/GeomUtils".split(" "),function(p,m,h,e,b,k,
a,g,n,f,d,c,q){return p("davinci.ve.actions.SurroundAction",[e],{run:function(e){e=this.fixupContext(e);var p,z,y,B,x=[],w,v=this.item.surroundWithTagName;if(v){dojo.withDoc(e.getDocument(),function(){w=c.createWidget({type:"html."+v,properties:{},children:[],context:e})});var A=new b,C=[].concat(e.getSelection()),L=C[0],E=L.getParent();q.getMarginBoxPageCoords(E.domNode);C.sort(function(a,b){return E.indexOf(a)-E.indexOf(b)});var I=e.getDocument(),D=I.defaultView&&I.defaultView.dojo;D.style||(D.style=
h);(I=m.every(C,function(a){if(D)return position_prop=D.style(a.domNode,"position"),"absolute"==position_prop}))&&m.forEach(C,function(a,b){x.push(q.getMarginBoxPageCoordsCached(a.domNode));A.add(new g(a,x[b].l,x[b].t,null,x[b]))});A.add(new k(w,E,E.indexOf(L)));d.prototype.checkAddToCurrentState(A,w);I&&(A.add(new a(w,[{position:"absolute"}])),m.forEach(C,function(a,b){var c=x[b].l+x[b].w,d=x[b].t+x[b].h;if(0==b||x[b].l<p)p=x[b].l;if(0==b||x[b].t<z)z=x[b].t;if(0==b||c>y)y=c;if(0==b||d>B)B=d}),A.add(new g(w,
p,z)),A.add(new n(w,y-p,B-z)));m.forEach(C,function(a){A.add(new f(a,w,"last"))});I&&m.forEach(C,function(a,b){A.add(new g(a,x[b].l,x[b].t,null,x[b]))});e.getCommandStack().execute(A);e.select(w)}else console.error("missing surroundWithTagName")},isEnabled:function(a){if((a=this.fixupContext(a))&&a.getSelection().length){var b=a.getSelection()[0].getParent(),c=[];if(!b||!b.length)return!1;if(m.every(a.getSelection(),function(a){var d=a.getParent();if(!d)return!1;c.push(b.indexOf(a));return b.id==
d.id})){c.sort();var d;for(a=c.shift();c.length;a=d)if(d=c.shift(),d!=a+1)return!1;return!0}}return!1}})})},"davinci/ve/actions/SelectParentAction":function(){define(["dojo/_base/declare","davinci/ve/actions/_SelectAncestorAction"],function(p,m){return p("davinci.ve.actions.SelectParentAction",[m],{run:function(h){var e=(h=this.fixupContext(h))&&h.getSelection();this.selectionSameParentNotBody(e)&&h.select(e[0].getParent())},isEnabled:function(h){h=(h=this.fixupContext(h))&&h.getSelection();return this.selectionSameParentNotBody(h)}})})},
"davinci/ve/actions/_SelectAncestorAction":function(){define(["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(p,m){return p("davinci.ve.actions._SelectAncestorAction",[m],{shouldShow:function(h){return(h=this.fixupContext(h))&&h.editor&&"davinci.ve.HTMLPageEditor"==h.editor.editorID},selectionSameParentNotBody:function(h){if(!h||0===h.length)return!1;var e=h[0].getParent();if(!e||!e.domNode)return!1;for(var b=0;b<h.length;b++)if(h[b].getParent()!=e)return!1;return!0}})})},"davinci/ve/actions/SelectAncestorAction":function(){define(["dojo/_base/declare",
"davinci/ve/actions/_SelectAncestorAction","davinci/Workbench","dojo/i18n!davinci/ve/nls/ve"],function(p,m,h,e){return p("davinci.ve.actions.SelectAncestorAction",[m],{run:function(b){var k=(b=this.fixupContext(b))&&b.getSelection();if(this.selectionSameParentNotBody(k)){for(var a=[],k=k[0].getParent();"BODY"!=k.domNode.tagName;)a.push(k),k=k.getParent();for(var k='\x3cdiv class\x3d"SelectAncestorLabel"\x3e'+e.selectAncestorLabel+'\x3c/div\x3e\x3cselect dojoType\x3d"dijit.form.Select" id\x3d"SelectAncestor" name\x3d"SelectAncestor" style\x3d"width:12em;"\x3e\x3coption value\x3d"-1"\x3e\x3c/option\x3e',
g=0;g<a.length;g++)var n=require("davinci/ve/widget").getLabel(a[g]),k=k+('\x3coption value\x3d"'+g+'"\x3e'+n+"\x3c/option\x3e");h.showMessage(e.selectAncestorTitle,k+"\x3c/select\x3e\x3cbr/\x3e");k=dijit.byId("SelectAncestor");k._selectAncestor=this._selectAncestor;dojo.connect(k,"onChange",function(e){b.select(a[e])})}},isEnabled:function(b){b=(b=this.fixupContext(b))&&b.getSelection();return this.selectionSameParentNotBody(b)}})})},"davinci/ve/actions/UnselectAllAction":function(){define(["dojo/_base/declare",
"davinci/ve/actions/ContextAction"],function(p,m){return p("davinci.ve.actions.SelectParentAction",[m],{run:function(h){h=this.fixupContext(h);0<(h&&h.getSelection()).length&&h.deselect()},isEnabled:function(h){return(h=(h=this.fixupContext(h))&&h.getSelection())&&0<h.length}})})},"davinci/ve/actions/ArrangeAction":function(){define(["dojo/_base/declare","./_ReorderAction","davinci/commands/CompoundCommand","davinci/ve/commands/ReparentCommand"],function(p,m,h,e){return p("davinci.ve.actions.ArrangeAction",
[m],{run:function(b){},isEnabled:function(b){return!0},shouldShow:function(b){return(b=(b=this.fixupContext(b))?b.editor:null)&&"davinci.ve.PageEditor"==b.declaredClass}})})},"davinci/ve/actions/_ReorderAction":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/dom-style","davinci/ve/actions/ContextAction"],function(p,m,h,e){return p("davinci.ve.actions._ReorderAction",[e],{shouldShow:function(b){return(b=this.fixupContext(b))&&b.editor&&"davinci.ve.HTMLPageEditor"==b.editor.editorID},
selectionSameParentAllAbsolute:function(b){if(0===b.length)return!1;var e=b[0].getParent();if(!e)return!1;for(var a=0;a<b.length;a++){var g=b[a];if(g.getParent()!=e||"absolute"!=(g&&g.domNode?h.get(g.domNode,"position"):null))return!1}return!0},selectionSameParentAllAbsoluteAdjacent:function(b){if(!b||0===b.length||!this.selectionSameParentAllAbsolute(b))return!1;var e=b[0].getParent();if(!e||!e.length)return!1;for(var e=e.getChildren(),a=Number.MAX_VALUE,g=Number.MIN_VALUE,h=0;h<e.length;h++)0<=
b.indexOf(e[h])&&(a=h<a?h:a,g=h>g?h:g);return g-a+1===b.length},getAbsoluteSiblings:function(b){b=b&&b.getParent&&b.getParent();return b?(b=b.getChildren&&b.getChildren())?m.filter(b,function(b){return"absolute"==(b&&b.domNode?h.get(b.domNode,"position"):null)}):[]:[]}})})},"davinci/ve/actions/MoveToFrontAction":function(){define(["dojo/_base/declare","./_ReorderAction","davinci/commands/CompoundCommand","davinci/ve/commands/ReparentCommand"],function(p,m,h,e){return p("davinci.ve.actions.MoveToFrontAction",
[m],{name:"MoveToFront",iconClass:"editActionIcon editMoveToFrontIcon",run:function(b){if(b=this.fixupContext(b)){var k=b&&b.getSelection?b.getSelection():[];if(0!==k.length&&this.selectionSameParentAllAbsolute(k)){for(var a=k[0].getParent(),g=this.getAbsoluteSiblings(k[0]),n=new h,f=0;f<g.length;f++){var d=g[f];0<=k.indexOf(d)&&n.add(new e(d,a,null))}b.getCommandStack().execute(n)}}},isEnabled:function(b){b=(b=this.fixupContext(b))&&b.getSelection?b.getSelection():[];if(0===b.length||!this.selectionSameParentAllAbsolute(b))return!1;
for(var e=this.getAbsoluteSiblings(b[0]),a=0;a<b.length;a++)if(e.indexOf(b[a])<e.length-b.length)return!0;return!1}})})},"davinci/ve/actions/MoveToBackAction":function(){define(["dojo/_base/declare","./_ReorderAction","davinci/commands/CompoundCommand","davinci/ve/commands/ReparentCommand"],function(p,m,h,e){return p("davinci.ve.actions.MoveToBackAction",[m],{name:"MoveToBack",iconClass:"editActionIcon editMoveToBackIcon",run:function(b){if(b=this.fixupContext(b)){var k=b&&b.getSelection?b.getSelection():
[];if(0!==k.length&&this.selectionSameParentAllAbsolute(k)){for(var a=k[0].getParent(),g=this.getAbsoluteSiblings(k[0]),n=new h,f=g.length-1;0<=f;f--){var d=g[f];0<=k.indexOf(d)&&n.add(new e(d,a,0))}b.getCommandStack().execute(n)}}},isEnabled:function(b){b=(b=this.fixupContext(b))&&b.getSelection?b.getSelection():[];if(0===b.length||!this.selectionSameParentAllAbsolute(b))return!1;for(var e=this.getAbsoluteSiblings(b[0]),a=0;a<b.length;a++)if(e.indexOf(b[a])>b.length-1)return!0;return!1}})})},"davinci/ve/actions/MoveForwardAction":function(){define(["dojo/_base/declare",
"./_ReorderAction","davinci/commands/CompoundCommand","davinci/ve/commands/ReparentCommand"],function(p,m,h,e){return p("davinci.ve.actions.MoveForwardAction",[m],{name:"MoveForward",iconClass:"editActionIcon editMoveForwardIcon",run:function(b){if(b=this.fixupContext(b)){var k=b&&b.getSelection?b.getSelection():[];if(0!==k.length&&this.selectionSameParentAllAbsoluteAdjacent(k)){for(var a,g=k[0].getParent(),n=g.getChildren(),f=this.getAbsoluteSiblings(k[0]),d=new h,c=k.slice(0),m=0;m<f.length;m++){a=
f[m];var p=c.indexOf(a);if(0<=p)c.splice(p,1);else if(0===c.length)break}n=n.indexOf(a)+1;for(c=0;c<f.length;c++)a=f[c],0<=k.indexOf(a)&&d.add(new e(a,g,n));b.getCommandStack().execute(d)}}},isEnabled:function(b){b=(b=this.fixupContext(b))&&b.getSelection?b.getSelection():[];if(0===b.length||!this.selectionSameParentAllAbsoluteAdjacent(b))return!1;for(var e=this.getAbsoluteSiblings(b[0]),a=0;a<b.length;a++)if(e.indexOf(b[a])<e.length-b.length)return!0;return!1}})})},"davinci/ve/actions/MoveBackwardAction":function(){define(["dojo/_base/declare",
"./_ReorderAction","davinci/commands/CompoundCommand","davinci/ve/commands/ReparentCommand"],function(p,m,h,e){return p("davinci.ve.actions.MoveBackwardAction",[m],{name:"MoveBackward",iconClass:"editActionIcon editMoveBackwardIcon",run:function(b){if(b=this.fixupContext(b)){var k=b&&b.getSelection?b.getSelection():[];if(0!==k.length&&this.selectionSameParentAllAbsoluteAdjacent(k)){for(var a,g=k[0].getParent(),n=g.getChildren(),f=this.getAbsoluteSiblings(k[0]),d=new h,c=k.slice(0),m=f.length-1;0<=
m;m--){a=f[m];var p=c.indexOf(a);if(0<=p)c.splice(p,1);else if(0===c.length)break}n=n.indexOf(a);for(c=f.length-1;0<=c;c--)a=f[c],0<=k.indexOf(a)&&d.add(new e(a,g,n));b.getCommandStack().execute(d)}}},isEnabled:function(b){b=(b=this.fixupContext(b))&&b.getSelection?b.getSelection():[];if(0===b.length||!this.selectionSameParentAllAbsoluteAdjacent(b))return!1;for(var e=this.getAbsoluteSiblings(b[0]),a=0;a<b.length;a++)if(e.indexOf(b[a])>b.length-1)return!0;return!1}})})},"davinci/ve/actions/OtherAction":function(){define(["dojo/_base/declare",
"./_ReorderAction","davinci/commands/CompoundCommand","davinci/ve/commands/ReparentCommand"],function(p,m,h,e){return p("davinci.ve.actions.OtherAction",[m],{run:function(b){},isEnabled:function(b){return!0},shouldShow:function(b){return(b=(b=this.fixupContext(b))?b.editor:null)&&"davinci.ve.PageEditor"==b.declaredClass}})})},"davinci/ve/actions/EnableApplicationStates":function(){define("dojo/_base/declare dojo/_base/connect dojo/dom-class dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin davinci/Runtime davinci/Workbench davinci/ve/metadata davinci/ve/widget davinci/ve/States davinci/actions/Action dojo/i18n!davinci/ve/nls/ve dojo/i18n!dijit/nls/common dojo/text!./templates/EnableApplicationStates.html dijit/form/TextBox".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r){var z=function(){if(a.currentEditor&&a.currentEditor.currentEditor&&a.currentEditor.currentEditor.context){context=a.currentEditor.currentEditor.context;var b=context.getSelection();if(1==b.length)return"ANY"==n.getAllowedChild(b[0].type)}return!1};p("davinci.ve.actions.EnableApplicationStatesWidget",[e,b,k],{templateString:r,widgetsInTemplate:!0,veNls:q,commonNls:u,oldValue:null,widget:null,postCreate:function(){if(a.currentEditor&&a.currentEditor.currentEditor&&
a.currentEditor.currentEditor.context){editor=this.editor=a.currentEditor;context=this.context=a.currentEditor.currentEditor.context;var b=context.getSelection();if(0<b.length){var b=this.widget=b[0],c=f.getLabel(b);this.widgetLabel.innerHTML=c;this.oldValue=d.isStateContainer(b.domNode);this.checkBoxWidget.set("checked",this.oldValue);this.oldValue?(b=d.getStates(b.domNode),1<b.length?(b.splice(0,1),this.statesListDiv.innerHTML=q.EnableApplicationStatesCurrentStates+": "+b.join(", ")):this.statesListDiv.innerHTML=
q.EnableApplicationStatesCurrentStates+": "+q.EnableApplicationStatesNone,this.description.innerHTML=q.DisableAsStateContainerDescription):(this.description.innerHTML=q.EnableAsStateContainerDescription,this.statesListDiv.innerHTML="")}this.okButton.connect(this.okButton,"onClick",dojo.hitch(this,function(a){this.onOk(a)}));this.cancelButton.connect(this.cancelButton,"onClick",dojo.hitch(this,function(a){this.onCancel(a)}))}},_onKeyPress:function(a){if(a.keyCode==dojo.keys.ENTER)this.onOk()},onOk:function(){var a=
this.checkBoxWidget.get("checked");if(a!=this.oldValue){var b=this.widget.domNode;a?(b._maqAppStates={},a=d.serialize(b),this.widget._srcElement.addAttribute(d.APPSTATES_ATTRIBUTE,a.maqAppStates)):(delete b._maqAppStates,this.widget._srcElement.removeAttribute(d.APPSTATES_ATTRIBUTE),d.removeUnusedStates(this.context));this.editor._visualChanged();m.publish("/maqetta/appstates/state/containerChange",[])}this.onClose()},onCancel:function(){this.onClose()}});return p("davinci.ve.actions.EnableApplicationStates",
[c],{run:function(){if(z()&&a.currentEditor&&a.currentEditor.currentEditor&&a.currentEditor.currentEditor.context){var b=new davinci.ve.actions.EnableApplicationStatesWidget;g.showModal(b,q.EnableApplicationStates,{width:"370px"})}},isEnabled:function(){return z()}})})},"davinci/ve/actions/ViewDesignAction":function(){define(["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(p,m){return p("davinci.ve.actions.ViewDesignAction",[m],{run:function(h){(h=this.fixupContext(h))&&h.editor&&
h.editor.switchDisplayModeDesign&&h.editor.switchDisplayModeDesign()},updateStyling:function(){var h=davinci.Workbench.getOpenEditor();if(h&&h.getDisplayMode){var h=h.getDisplayMode(),e=dojo.query(".maqDesignButton")[0];e&&("design"==h?dojo.addClass(e,"maqLabelButtonSelected"):dojo.removeClass(e,"maqLabelButtonSelected"))}}})})},"davinci/ve/actions/ViewSourceAction":function(){define(["dojo/_base/declare","davinci/ve/actions/ContextAction","dojo/i18n!davinci/ve/nls/ve"],function(p,m,h){return p("davinci.ve.actions.ViewSourceAction",
[m],{run:function(e){(e=this.fixupContext(e))&&e.editor&&e.editor.switchDisplayModeSourceLatest&&(editor=e.editor,editor.switchDisplayModeSourceLatest())},updateStyling:function(){var e=davinci.Workbench.getOpenEditor();if(e&&e.getDisplayMode){var b=e.getDisplayMode(),e=e.getSourceDisplayMode(),k=dojo.query(".maqSourceComboButton")[0];if(k){var a=dijit.byNode(k);a&&a.set("label",h["SourceComboButton-"+e]);"design"==b?dojo.removeClass(k,"maqLabelButtonSelected"):dojo.addClass(k,"maqLabelButtonSelected")}}}})})},
"davinci/ve/actions/ViewSourceMenuAction":function(){define(["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(p,m){return p("davinci.ve.actions.ViewSourceMenuAction",[m],{run:function(h){(h=this.fixupContext(h))&&h.editor&&h.editor.switchDisplayModeSource&&h.editor.switchDisplayModeSource()}})})},"davinci/ve/actions/ViewSplitHMenuAction":function(){define(["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(p,m){return p("davinci.ve.actions.ViewSplitHMenuAction",[m],
{run:function(h){(h=this.fixupContext(h))&&h.editor&&h.editor.switchDisplayModeSplitHorizontal&&h.editor.switchDisplayModeSplitHorizontal()}})})},"davinci/ve/actions/ViewSplitVMenuAction":function(){define(["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(p,m){return p("davinci.ve.actions.ViewSplitVMenuAction",[m],{run:function(h){(h=this.fixupContext(h))&&h.editor&&h.editor.switchDisplayModeSplitVertical&&h.editor.switchDisplayModeSplitVertical()}})})},"davinci/ve/actions/AddState":function(){define("dojo/_base/declare davinci/Runtime davinci/Workbench davinci/workbench/Preferences davinci/ve/States davinci/actions/Action dojo/i18n!davinci/ve/nls/ve davinci/ve/actions/_AddManageStatesWidget".split(" "),
function(p,m,h,e,b,k,a,g){return p("davinci.ve.actions.AddState",[k],{run:function(){var e;m.currentEditor&&m.currentEditor.currentEditor&&m.currentEditor.currentEditor.context&&(e=m.currentEditor.currentEditor.context,(e=b.getFocus(e.rootNode))&&e.stateContainerNode&&(e=new davinci.ve.actions._AddManageStatesWidget({node:e.stateContainerNode}),e._calledBy="AddState",h.showModal(e,a.createNewState,null,null,!0),e.okButton.set("disabled",!0)))}})})},"davinci/ve/actions/_AddManageStatesWidget":function(){define("dojo/_base/declare dojo/dom-style dojo/_base/event dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin davinci/Runtime davinci/Workbench davinci/workbench/Preferences davinci/ve/States davinci/commands/CompoundCommand davinci/ve/commands/StyleCommand davinci/ve/commands/AppStateCommand davinci/actions/Action dojo/i18n!davinci/ve/nls/ve dojo/i18n!dijit/nls/common dojo/text!./templates/AddState.html dijit/form/TextBox dijit/form/Select dijit/form/CheckBox dijit/form/Button".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y,B,x,w,v){return p("davinci.ve.actions._AddManageStatesWidget",[e,b,k],{templateString:y,widgetsInTemplate:!0,veNls:r,commonNls:z,_isValid:function(){var a=this.domNode.querySelector(".addStateNameDiv");if(a&&"none"==m.get(a,"display"))return!0;a=this.input.get("value");return a?davinci.ve.states.hasState(this.node,a)?(alert(dojo.string.substitute(r.stateNameExists,{name:a})),!1):!0:!1},_onKeyPress:function(a){a.keyCode!=dojo.keys.ENTER&&(this._isValid()?
this.okButton.set("disabled",!1):this.okButton.set("disabled",!0))},onOk:function(){var b;if(a.currentEditor&&a.currentEditor.currentEditor&&a.currentEditor.currentEditor.context){if(b=a.currentEditor.currentEditor.context,(b=f.getFocus(b.rootNode))&&b.stateContainerNode){f.getState(b.stateContainerNode);var c=this.input.get("value");if(c)if(a.currentEditor&&a.currentEditor.currentEditor&&a.currentEditor.currentEditor.context){b=a.currentEditor.currentEditor.context;var e=new d;c&&e.add(new q({action:"add",
state:c,stateContainerNode:this.node,context:b}));b.getCommandStack().execute(e)}else console.error("AddState.js - cannot determine context.")}}else console.error("_AddManageStatesWidget.js (from "+this._calledBy+" - cannot determine context.")},onCancel:function(){this.onClose()}})})},"davinci/ve/actions/RemoveState":function(){define("dojo/_base/declare davinci/Runtime davinci/ve/States davinci/actions/Action davinci/commands/CompoundCommand davinci/ve/commands/AppStateCommand".split(" "),function(p,
m,h,e,b,k){return p("davinci.ve.actions.RemoveState",[e],{run:function(){var a;if(m.currentEditor&&m.currentEditor.currentEditor&&m.currentEditor.currentEditor.context){a=m.currentEditor.currentEditor.context;var e=h.getFocus(a.rootNode);if(e&&e.state&&e.state!==h.NORMAL){var e=e.stateContainerNode,n=n=davinci.ve.states.getState(e);if(n){var f=new b;f.add(new k({action:"remove",state:n,stateContainerNode:e,context:a}));a.getCommandStack().execute(f)}}}}})})},"davinci/ve/actions/ModifyState":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/connect dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/popup dijit/focus davinci/ve/States davinci/ui/Dialog davinci/Runtime davinci/Workbench davinci/actions/Action dojo/i18n!davinci/ve/nls/ve dojo/i18n!dijit/nls/common dojo/text!./templates/ModifyState.html dijit/form/TextBox dijit/form/ValidationTextBox davinci/commands/CompoundCommand davinci/ve/commands/AppStateCommand".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y,B,x,w){var v=null;p("davinci.ve.actions.ModifyStateWidget",[e,b,k],{templateString:z,widgetsInTemplate:!0,veNls:u,commonNls:r,isNormalState:!1,newName:null,oldInitialStateOn:null,postCreate:function(){this._connections=[];dijit.byId("state_rename_tooltip_dialog");v.then(function(){this._statesFocus.state&&this._statesFocus.state!==n.NORMAL||(this.isNormalState=!0);var a=dojo.byId("modify_state_old_name");a&&(this._statesFocus&&this._statesFocus.state&&!this.isNormalState?
a.innerHTML=this._statesFocus.state:(a.innerHTML="\x3ci\x3e"+n.NORMAL+"\x3c/i\x3e",this.renameButton.set("disabled",!0)));this.oldInitialStateOn=a=n.getInitial(this._statesFocus.stateContainerNode)===this._statesFocus.state;this.initialState.set("checked",a);a&&this.isNormalState&&this.initialState.set("disabled",!0);this._dialog.connect(this._dialog,"hide",function(a){this.onClose()}.bind(this));this.okButton.connect(this.okButton,"onClick",dojo.hitch(this,function(a){this.onOk(a)}));this.cancelButton.connect(this.cancelButton,
"onClick",dojo.hitch(this,function(a){this.onCancel(a)}));if(a=dijit.byId("state_rename_tooltip_dialog"))a.connect(a,"onShow",function(a){this.renameStateShowTooltipDialog(a)}.bind(this)),a.connect(a,"onHide",function(a){this.renameStateHideTooltipDialog(a)}.bind(this))}.bind(this))},renameStateShowTooltipDialog:function(b){b=dojo.byId("modify_state_old_name");var c=dojo.byId("state_rename_new_name"),d=dijit.byId("state_rename_new_name");b&&d&&d.set("value",b.innerText);g.focus(c);b=dijit.byId("state_rename_do_it");
c=dijit.byId("state_rename_cancel");b.connect(b,"onMouseDown",function(a){a.stopPropagation()});c.connect(b,"onMouseDown",function(a){a.stopPropagation()});b.connect(b,"onClick",function(a){this.renameStateDoIt(a)}.bind(this));c.connect(c,"onClick",function(b){b=dijit.byId("state_rename_tooltip_dialog");a.close(b)}.bind(this))},renameStateDoIt:function(b){b=dojo.byId("modify_state_old_name");var c=dijit.byId("state_rename_new_name"),c=c?c.get("value"):null,d=dijit.byId("state_rename_tooltip_dialog");
b&&c&&(this.newName=b.innerHTML=c);d&&a.close(d)},renameStateHideTooltipDialog:function(a){},onOk:function(a){if(d.currentEditor&&d.currentEditor.currentEditor&&d.currentEditor.currentEditor.context){a=d.currentEditor.currentEditor.context;var b=n.getFocus(a.rootNode);if(b&&b.stateContainerNode){var c;this.newName&&this.newName!==this._statesFocus.state&&(c=this.newName);var e,f=this.initialState.get("checked");f!==this.oldInitialStateOn&&(e=b.state?b.state:"undefined",e=f?e:null);if(c||e)f=new x,
f.add(new w({action:"modify",state:b.state,stateContainerNode:b.stateContainerNode,context:a,newState:c,initialState:e})),a.getCommandStack().execute(f);this.onClose()}}},onCancel:function(){this.onClose()},onClose:function(a){for(;a=this._connections.pop();)h.disconnect(a)}});return p("davinci.ve.actions.ModifyState",[q],{run:function(){var a;if(d.currentEditor&&d.currentEditor.currentEditor&&d.currentEditor.currentEditor.context&&(a=d.currentEditor.currentEditor.context,a=n.getFocus(a.rootNode))){v=
new m;var b=new davinci.ve.actions.ModifyStateWidget,e=c.showModal(b,u.modifyState);this._dialog=b._dialog=e;b._statesFocus=a;v.resolve()}}})})},"davinci/ve/actions/ManageStates":function(){define("dojo/_base/declare davinci/Runtime davinci/Workbench davinci/ve/actions/ContextAction davinci/workbench/Preferences dijit/registry davinci/ve/States davinci/actions/Action dojo/i18n!davinci/ve/nls/ve davinci/ve/actions/_ManageStatesWidget".split(" "),function(p,m,h,e,b,k,a,g,n,f){return p("davinci.ve.actions.ManageStates",
[e],{run:function(){var b;m.currentEditor&&m.currentEditor.currentEditor&&m.currentEditor.currentEditor.context&&(b=m.currentEditor.currentEditor.context,(b=a.getFocus(b.rootNode))&&b.stateContainerNode&&(b=new davinci.ve.actions._ManageStatesWidget({node:b.stateContainerNode}),b._calledBy="ManageStates",b.okButton.set("label",n.updateLabel),b.updateDialog(),h.showModal(b,n.manageStates,{width:400},null,!0)))},isEnabled:function(a){a=this.fixupContext(a);var b=h.getOpenEditor();return b&&a?"davinci.ve.PageEditor"==
b.declaredClass?0<a.getSelection().length:!1:!1},shouldShow:function(a){return(a=(a=this.fixupContext(a))?a.editor:null)&&"davinci.ve.PageEditor"==a.declaredClass}})})},"davinci/ve/actions/_ManageStatesWidget":function(){define("dojo/_base/declare dojo/dom-construct dojo/on dojo/dom-style dojo/dom-class dojo/_base/event dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin davinci/Runtime davinci/Workbench davinci/workbench/Preferences davinci/ve/States davinci/commands/CompoundCommand davinci/ve/commands/StyleCommand davinci/actions/Action dojo/i18n!davinci/ve/nls/ve dojo/i18n!dijit/nls/common dojo/text!./templates/ManageStates.html dijit/form/Button".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y,B,x,w){return p("davinci.ve.actions._ManageStatesWidget",[a,g,n],{templateString:x,widgetsInTemplate:!0,anyCheckBoxChanges:!1,_states:[],_stateContainers:[],_checkBoxes:[],_overrideDisplayValue:[],_notes:[],_handlers:[],veNls:y,commonNls:B,constructor:function(){this.handlers=[]},postCreate:function(){if(this._getContext()){var a=this.domNode.querySelector(".manageStatesStatesListDiv");if(a){var c=this._getAllStatesInDoc();this._states=c.states;this._stateContainers=
c.stateContainers;if(c=this.domNode.querySelector(".manageStatesCheckAcceleratorsTable"))c.style.width="100%";if(c=this.domNode.querySelector(".manageStatesCheckCurrentStateOnlyCell"))c.style.textAlign="left";if(c=this.domNode.querySelector(".manageStatesCheckAllCell"))c.style.textAlign="center";if(c=this.domNode.querySelector(".manageStatesUncheckAllCell"))c.style.textAlign="right";for(var d,a=m.create("table",{"class":"manageStatesStatesListTable",style:"width:100%",border:0,cellspacing:0,cellpadding:3},
a),e=0;e<this._states.length;e++)c=m.create("tr",{},a),d=m.create("td",{"class":"manageStatesCheckboxCell"},c),this._checkBoxes[e]=m.create("div",{id:"manageStatesCheckBox_"+e,"class":"manageStatesCheckbox"},d),this._handlers.push(h(this._checkBoxes[e],"click",function(a,c){var d=this._checkBoxes[a];this.anyCheckBoxChanges=!0;b.remove(d,"manageStatesCheckboxNoneVisible");b.remove(d,"manageStatesCheckboxAllVisible");b.remove(d,"manageStatesCheckboxAllVisibleBackgroundAll");b.remove(d,"manageStatesCheckboxAllVisibleBackgroundSome");
b.remove(d,"manageStatesCheckboxSomeVisible");1==d._checkValue?(d._checkValue=0,b.add(d,"manageStatesCheckboxNoneVisible"),this._overrideDisplayValue[a]="none"):(d._checkValue=1,b.add(d,"manageStatesCheckboxAllVisible"),this._overrideDisplayValue[a]="");this.updateDialog()}.bind(this,e))),this._overrideDisplayValue[e]=null,d=this._states[e],m.create("td",{"class":"manageStatesStateNameCell",innerHTML:"Normal"==d?"Background":d},c),d=m.create("td",{"class":"manageStatesNotesCell"},c),this._notes[e]=
m.create("span",{"class":"manageStatesNotesSpan"},d)}(a=this.domNode.querySelector(".manageStatesCheckCurrentStateOnly"))&&this._handlers.push(h(a,"click",function(a){k.stop(a);this._acceleratorClicked("current")}.bind(this)));(a=this.domNode.querySelector(".manageStatesCheckAll"))&&this._handlers.push(h(a,"click",function(a){k.stop(a);this._acceleratorClicked("all")}.bind(this)));(a=this.domNode.querySelector(".manageStatesUncheckAll"))&&this._handlers.push(h(a,"click",function(a){k.stop(a);this._acceleratorClicked("none")}.bind(this)));
(a=this.domNode.querySelector(".manageStatesCheckBackgroundOnly"))&&this._handlers.push(h(a,"click",function(a){k.stop(a);this._acceleratorClicked("background")}.bind(this)));this.anyCheckBoxChanges=!1;setTimeout(function(){this.okButton.focus()}.bind(this),500)}},_acceleratorClicked:function(a){var c=this._getContext();if(c&&(c=q.getFocus(c.rootNode))&&c.stateContainerNode){for(var d=q.getState(c.stateContainerNode),e=0;e<this._states.length;e++){var f=this._states[e];if("undefined"==f||f==q.NORMAL)f=
void 0;var g=this._checkBoxes[e];b.remove(g,"manageStatesCheckboxNoneVisible");b.remove(g,"manageStatesCheckboxAllVisible");b.remove(g,"manageStatesCheckboxAllVisibleBackgroundAll");b.remove(g,"manageStatesCheckboxAllVisibleBackgroundSome");b.remove(g,"manageStatesCheckboxSomeVisible");"current"==a?f==d&&c.stateContainerNode==this._stateContainers[e]?(g._checkValue=1,b.add(g,"manageStatesCheckboxAllVisible"),this._overrideDisplayValue[e]=""):(g._checkValue=0,b.add(g,"manageStatesCheckboxNoneVisible"),
this._overrideDisplayValue[e]="none"):"all"==a?(g._checkValue=1,b.add(g,"manageStatesCheckboxAllVisible"),this._overrideDisplayValue[e]=""):"none"==a?(g._checkValue=0,b.add(g,"manageStatesCheckboxNoneVisible"),this._overrideDisplayValue[e]="none"):"background"==a&&(g._checkValue=1,b.add(g,"manageStatesCheckboxAllVisible"),this._overrideDisplayValue[e]=0==e?"":"$MAQ_DELETE_PROPERTY$")}this.anyCheckBoxChanges=!0;this.updateDialog()}},_isValid:function(){return!0},_onKeyPress:function(a){a.keyCode!=
dojo.keys.ENTER&&(this._isValid()?this.okButton.set("disabled",!1):this.okButton.set("disabled",!0))},_getAllStatesInDoc:function(){var a;if(f.currentEditor&&f.currentEditor.currentEditor&&f.currentEditor.currentEditor.context){a=f.currentEditor.currentEditor.context;var b=[],c=[];if(a=q.getAllStateContainers(a.rootNode))for(var d=0;d<a.length;d++)for(var e=q.getStates(a[d]),g=0;g<e.length;g++)b.push(e[g]),c.push(a[d]);return{states:b,stateContainers:c}}console.error("_ManageStatesWidget.js (from "+
this._calledBy+" - cannot determine context.")},_getContext:function(){var a;f.currentEditor&&f.currentEditor.currentEditor&&f.currentEditor.currentEditor.context?a=f.currentEditor.currentEditor.context:console.error("_ManageStatesWidget.js (from "+this._calledBy+" - cannot determine context.");return a},_getAllEffectedWidgets:function(){var a=this._getContext();if(!a)return[];var b=q.getFocus(a.rootNode);if(b&&b.stateContainerNode)return a.getSelection().slice(0)},updateDialog:function(){var a=this._getContext();
if(a){var c=q.getFocus(a.rootNode);if(c&&c.stateContainerNode)for(var c=this._getAllEffectedWidgets(),d=this._overrideDisplayValue[0],e=0;e<this._states.length;e++){var f=this._states[e];if(f==q.NORMAL||"undefined"==f)f=void 0;for(var g=0,k=0,h=0;h<c.length;h++){var m=c[h],n={undefined:d};n[void 0===f?"undefined":f]=this._overrideDisplayValue[e];m=q.getEffectiveDisplayValue(a,m,f,n);0!=m.effectiveDisplayValue.indexOf("none")&&(g++,f||"undefined"!=m.effectiveState?f&&m.effectiveState==f&&k++:k++)}f=
this._checkBoxes[e];h=this._notes[e];b.remove(f,"manageStatesCheckboxNoneVisible");b.remove(f,"manageStatesCheckboxAllVisible");b.remove(f,"manageStatesCheckboxAllVisibleBackgroundAll");b.remove(f,"manageStatesCheckboxAllVisibleBackgroundSome");b.remove(f,"manageStatesCheckboxSomeVisible");h.innerHTML="";0==g?(f._checkValue=0,b.add(f,"manageStatesCheckboxNoneVisible")):g==c.length?(f._checkValue=1,k==c.length?b.add(f,"manageStatesCheckboxAllVisible"):0<k?(b.add(f,"manageStatesCheckboxAllVisibleBackgroundSome"),
h.innerHTML=y.manageStatesSomeVisibleFromBackground):(b.add(f,"manageStatesCheckboxAllVisibleBackgroundAll"),h.innerHTML=y.manageStatesAllVisibleFromBackground)):(f._checkValue=2,b.add(f,"manageStatesCheckboxSomeVisible"),h.innerHTML=y.manageStatesSomeVisibleSomeHidden)}}},onOk:function(){if(this.anyCheckBoxChanges){var a=this._getContext();if(a){for(var b,c=this._getAllEffectedWidgets(),d=0;d<this._states.length;d++){var e=this._states[d];if(e==q.NORMAL||"undefined"==e)e=void 0;var f=this._checkBoxes[d]._checkValue;
if(0===f||1===f)for(var g=0;g<c.length;g++){var k=c[g];b||(b=new u);b.add(new r(k,[{display:this._overrideDisplayValue[d]?this._overrideDisplayValue[d]:1==f?"":"none"}],e))}}b&&a.getCommandStack().execute(b)}}},onCancel:function(){this.onClose()},destroy:function(){this.inherited(arguments);for(var a=0;a<this._handlers.length;a++)this._handlers[a].remove();this._handlers=[]}})})},"davinci/ve/actions/NewWidgetsCurrentState":function(){define("dojo/_base/declare davinci/Runtime davinci/Workbench davinci/ve/States davinci/actions/Action davinci/workbench/Preferences".split(" "),
function(p,m,h,e,b,k){return p("davinci.ve.actions.NewWidgetsCurrentState",[b],{run:function(){var a;if(m.currentEditor&&m.currentEditor.currentEditor&&m.currentEditor.currentEditor.context){a=m.currentEditor.currentEditor.context;var b=h.getProject(),n=k.getPreferences("davinci.ve.editorPrefs",b);n.newWidgetsCurrentState=n.newWidgetsCurrentState?!1:!0;k.savePreferences("davinci.ve.editorPrefs",b,n);e.updateStateIcons(a)}}})})},"davinci/ve/actions/HighlightBaseWidgets":function(){define("dojo/_base/declare davinci/Runtime davinci/Workbench davinci/ve/States davinci/actions/Action davinci/workbench/Preferences".split(" "),
function(p,m,h,e,b,k){return p("davinci.ve.actions.HighlightBaseWidgets",[b],{run:function(){var a;if(m.currentEditor&&m.currentEditor.currentEditor&&m.currentEditor.currentEditor.context){a=m.currentEditor.currentEditor.context;var b=h.getProject(),e=k.getPreferences("davinci.ve.editorPrefs",b);e.highlightBaseWidgets=e.highlightBaseWidgets?!1:!0;k.savePreferences("davinci.ve.editorPrefs",b,e);a.updateFocusAll()}}})})},"davinci/ve/actions/ShowInOutline":function(){define(["dojo/_base/declare","davinci/Runtime",
"davinci/Workbench","davinci/ve/actions/ContextAction"],function(p,m,h,e){return p("davinci.ve.actions.ManageStates",[e],{run:function(){var b=m.currentEditor;b&&b.delegate.showInOutline()},isEnabled:function(b){b=this.fixupContext(b);var e=h.getOpenEditor();return e&&b?"davinci.ve.PageEditor"==e.declaredClass?0<b.getSelection().length:!1:!1},shouldShow:function(b){return(b=(b=this.fixupContext(b))?b.editor:null)&&"davinci.ve.PageEditor"==b.declaredClass}})})},"davinci/ve/PageEditor":function(){define("require dojo/_base/declare ../ui/ModelEditor dojo/dnd/Moveable ../Runtime ../commands/CommandStack ../html/ui/HTMLEditor ./VisualEditor ./VisualEditorOutline ./widget ./States ../XPathUtils ../html/HtmlFileXPathAdapter ./utils/GeomUtils davinci/model/Factory xide/mixins/EventedMixin xide/mixins/ReloadMixin xide/utils xide/types xide/factory xideve/views/BlocksFileEditor xide/widgets/_Widget xide/views/_LayoutMixin xdocker/Docker2 xdocker/types".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y,B,x,w,v,A,C,L){m=m("davinci.ve.PageEditor",[h,A,z,y,C],{_latestSourceMode:"source",_latestLayoutMode:"flow",item:null,delegate:null,template:null,bottomTabContainer:null,textEditorPane:null,didBlockViews:!1,_propCP:null,createTab:function(a,b){var c=x.DOCKER;return this._docker.addTab(a||"DefaultTab",B.mixin({icon:!1,closeable:!0,moveable:!0,tabOrientation:c.TAB.TOP,location:c.DOCK.STACKED},b))},createLayout:function(){},constructor:function(a,b,c,d,e,f){function h(a){setTimeout(function(){var a=
m.getContext();a&&a.frameNode&&$(a.frameNode).css("pointer-events","initial")},a||4E3)}b=x.DOCKER;this.item=c;this.template=e;var m=this;this._commandStack=new k(this);this.savePoint=0;this._docker=L.createDefault(a,{});this.domNode=this._docker.$container[0];this._designCP=this.createTab(null,{title:"Design",icon:"fa-eye"});this._docker.on(x.DOCKER.EVENT.BEGIN_RESIZE,function(a){(a=m.getContext())&&a.frameNode&&$(a.frameNode).css("pointer-events","none");h()});this._docker.on(x.DOCKER.EVENT.MOVE_STARTED,
function(a){(a=m.getContext())&&a.frameNode&&$(a.frameNode).css("pointer-events","none");h()});this._docker.on(x.DOCKER.EVENT.MOVE_ENDED,function(a){h(1)});this._docker.on(x.DOCKER.EVENT.END_RESIZE,function(a){h(1)});this._docker.on(x.DOCKER.EVENT.BEGIN_FLOAT_RESIZE,function(a){a=m.getContext();$(a.frameNode).css("pointer-events","none");h()});this._docker.on(x.DOCKER.EVENT.END_FLOAT_RESIZE,function(a){h(1)});this._designCP.$container[0].domNode=this._designCP.$container[0];this._designCP.domNode=
this._designCP.$container[0];this._designCP.minSize(400,400);this.currentEditor=this.visualEditor=new g(this._designCP.$container[0],this,this.template);this.currentEditor._commandStack=this._commandStack;this.initReload();try{this._propCP=this.createTab(null,{title:"Props",icon:"fa-cogs",tabOrientation:b.TAB.TOP,location:b.TAB.RIGHT,target:this._designCP});this._propCP.maxSize(400);this._propCP.minSize(350);a=null;f.length?this._srcCP=a=this.createTab(null,{title:"HTML",icon:"fa-code",tabOrientation:b.TAB.TOP,
location:b.TAB.BOTTOM}):console.error("have no editors, ");f=null;try{f=this.htmlEditor=d(a)}catch(n){debugger}this.model=f.model;f._on(x.EVENTS.ON_FILE_CONTENT_CHANGED,function(a){m.delegate.onEditorContentChanged(a)});this._displayMode="design";this._connect(this.visualEditor,"onContentChange","_visualChanged");this.subscribe("/davinci/ui/styleValuesChange",this._stylePropertiesChange);this.subscribe("/davinci/ui/widgetSelected",this._widgetSelectionChange);this.subscribe("/davinci/ui/selectionChanged",
this._modelSelectionChange);this.subscribe("/davinci/ui/editorSelected",this._editorSelected.bind(this));this.subscribe("/davinci/ui/context/loaded",this._contextLoaded.bind(this));this.subscribe("/davinci/ui/deviceChanged",this._deviceChanged.bind(this));this._designCP.getSplitter().pos(.5);setTimeout(function(){m._srcCP.getSplitter().pos(.5);m._propCP.maxSize(500)},1500);this.resize()}catch(p){this.visualEditor._connectCallback(p),console.error("page editor crash : "+p)}this.add(this._docker,null,
!1)},getPropertyPane:function(){return this._propCP},getDesignPane:function(){return this._designCP},getSourcePane:function(){return this._srcCP},getVisualEditor:function(){return this.visualEditor},getBlocksPane:function(){return this._blocksTab},onSceneBlocksLoaded:function(a,b){if(0!=b.showBlocks&&!this.didBlockViews){this.didBlockViews=!0;var c=a.blockScopes,d=a.ctx,e=x.DOCKER;this._blocksTab=this.createTab(null,{title:"Blocks",icon:"fa-eye",target:this._srcCP,tabOrientation:e.TAB.TOP,location:e.DOCK.STACKED});
c=c[0];e=this._blocksTab;d=B.addWidget(v,{style:"height:inherit;width:inherit;padding:0px;",ctx:d,pageEditor:this,visualEditor:b,editorContext:this.getContext(),item:{path:c.path,mount:c.mount}},this,e,!0);d.initWithScope(c);e.add(d);this._blockEditor=d;(d=b.getItem())&&this._blockEditor._widgetSelectionChanged({selection:[d]})}},getBlockEditor:function(){return this._blockEditor},setRootElement:function(a){this._rootElement=a},supports:function(a){return a.match(/^palette|properties|style|states|inline-style|MultiPropTarget|propsect_common|propsect_widgetSpecific|propsect_events|propsect_layout|propsect_paddingMargins|propsect_background|propsect_border|propsect_fontsAndText|propsect_shapesSVG$/)},
focus:function(){},_editorSelected:function(a){var b=this.getContext();b&&(this==a.oldEditor&&b.hideFocusAll(),a.editor&&a.editor.editorContainer&&("davinci.ve.PageEditor"==a.editor.declaredClass||"davinci.ve.themeEditor.ThemeEditor"==a.editor.declaredClass)&&this==a.editor&&(a=b.getFlowLayout()?"flow":"absolute",this._updateLayoutDropDownButton(a),b.clearCachedWidgetBounds()))},_contextLoaded:function(){},_deviceChanged:function(){if(b.currentEditor==this&&this.editorContainer){var a=this.getContext();
a&&a.updateFocusAll&&setTimeout(function(){a.updateFocusAll()},1E3)}},_updateLayoutDropDownButton:function(a){(a=dojo.query(".maqLayoutDropDownButton"))&&a[0]&&dijit.byNode(a[0])},_selectLayout:function(a){this._latestLayoutMode=a;p(["davinci/actions/SelectLayoutAction"],function(b){b=new b;b._changeLayoutCommand(a)});this._updateLayoutDropDownButton(a)},selectLayoutFlow:function(){this._selectLayout("flow")},selectLayoutAbsolute:function(){this._selectLayout("absolute")},getDisplayMode:function(){return this._displayMode},
getSourceDisplayMode:function(){return this._latestSourceMode},_switchDisplayModeSource:function(a){this._latestSourceMode=a;this.switchDisplayMode(a)},switchDisplayModeSource:function(){this._switchDisplayModeSource("source")},switchDisplayModeSplitVertical:function(){this._switchDisplayModeSource("splitVertical")},switchDisplayModeSplitHorizontal:function(){this._switchDisplayModeSource("splitHorizontal")},switchDisplayModeSourceLatest:function(){this.switchDisplayMode(this._latestSourceMode)},
switchDisplayModeDesign:function(){this.switchDisplayMode("design")},switchDisplayMode:function(a){},hidePropertyPane:function(a){this.getPropertyPane()},_modelSelectionChange:function(a){if("source"!=this._displayMode&&p("davinci/Runtime").currentEditor===this&&(this._selectionCssRules=null,a.length&&(a=a[0].model)&&"HTMLElement"==a.elementType&&(a=a.getAttribute("id"))&&"source"!=this._displayMode)){a=f.byId(a,this.visualEditor.context.getDocument());var b=u.getMarginBoxPageCoords(a.domNode);this.getContext().getGlobal().scroll(b.l,
b.t);this.visualEditor.context.select(a)}},_widgetSelectionChange:function(a){!0===a.isFake||!this.visualEditor.context||a&&a.length&&a[0]._edit_context!=this.visualEditor.context||(a=this.visualEditor.context.getSelection())&&a.length&&"design"!=this._displayMode&&this.htmlEditor.selectModel([{model:a[0]._srcElement}])},_stylePropertiesChange:function(a){if(!(a&&a.cascade&&a.cascade._widget&&1==a.cascade._widget.isFake)){this.visualEditor._stylePropertiesChange(a);var b=this.visualEditor.context.getSelection();
if(b&&b[0]&&(b=B.getNode(b[0]))&&b.onChanged)b.onChanged();a=a.cascade._topWidgetDom;$(a).attr("style");this.getContext().updateBackground(a)}},_setDirty:function(){this.setDirty(!0)},setDirty:function(a){if(this.isDirty=a)this.lastModifiedTime=Date.now();this.editorContainer&&this.editorContainer.setDirty(a)},_visualChanged:function(a){this.delegate.shouldUpdateTextEditor()&&(a||this._setDirty(),this.htmlEditor.set("value",this.model.getText(),!0),this.getContext().visualEditorChanged())},_srcChanged:function(){dojo.withDoc(window.document,
function(){this.htmlEditor.isTyping&&(this.visualEditor.skipSave=!0);var a=this.visualEditor.context,b=a&&this._getStatesScenes(a);this.visualEditor.setContent(this.fileName,this.htmlEditor.model);this.editorContainer.updateToolbars();dojo.publish("/davinci/ui/context/pagerebuilt",[a]);b&&this._setStatesScenes(a,b);delete this.visualEditor.skipSave;this._setDirty()},this)},_getStatesScenes:function(a){return[]},_setStatesScenes:function(a,b){},getContext:function(){return this.visualEditor.context},
getOutline:function(){this.outline||(this.outline=new n(this));return this.outline},getPropertiesView:function(){return this.currentEditor.getPropertiesView()},setContent:function(a,b,c){this.fileName=a;this.htmlEditor.setContent(a,b);this.visualEditor.setContent(a,this.htmlEditor.model,c);this._connect(this.htmlEditor.model,"onChange","_themeChange")},_themeChange:function(a){a&&"CSSRule"===a.elementType&&(this.setDirty(!0),this.visualEditor.context.hotModifyCssRule(a))},getDefaultContent:function(){this._isNewFile=
!0;return this.visualEditor.getDefaultContent()},selectModel:function(a,b){if(!(this.publishingSelect||b&&this!=b)){var c=a&&a[0];c&&(c.elementType?this.htmlEditor.selectModel(a):c.model&&c.model.isWidget&&this.visualEditor.context.select(c.model,c.add))}},save:function(a){if(this.delegate&&this.delegate.save){var b=this.visualEditor.context.getModel(),c=b.getText();this.delegate.save(this,this.visualEditor,b,c)}else this.savePoint=this._commandStack.getUndoCount(),(b=this.visualEditor.save(a))&&
b.then&&b.then(function(b){this.isDirty=a;this.editorContainer&&this.editorContainer.domNode&&this.editorContainer.setDirty(a)}.bind(this),function(a){})},removeWorkingCopy:function(){},previewInBrowser:function(){this.visualEditor.previewInBrowser()},destroy:function(){this.inherited(arguments);this.visualEditor.destroy();this.htmlEditor.destroy();B.destroy(this.bottomTabContainer)},getText:function(){return this.htmlEditor.getText()},onResize:function(){for(var a=this.getContext(),b=a.getSelection(),
c=0;c<b.length;c++)a.select(b[c],0!=c)},handleKeyEvent:function(a){},getFocusContainerBounds:function(){if("source"==this._displayMode)return{l:0,t:0,w:0,h:0};var a=u.getBorderBoxPageCoords(this._designCP.domNode);a.l-=8;a.t-=8;"none"==(this.visualEditor&&this.visualEditor.getDevice?this.visualEditor.getDevice():"none")?(a.w+="splitVertical"==this._displayMode?8:16,a.h+="splitHorizontal"==this._displayMode?8:16):(a.w+=8,a.h+=8);return a},getCommandStack:function(){return this.getContext().getCommandStack()}});
m.__test="asd2f";return m})},"davinci/ui/ModelEditor":function(){define(["dojo/_base/declare","../Runtime","./TextEditor","../commands/SourceChangeCommand"],function(p,m,h,e){return p(h,{constructor:function(b,e){this.subscribe("/davinci/ui/selectionChanged",this.selectModel)},colorize:function(b){return null},setContent:function(b,e){this.inherited(arguments);this.model.fileName=b;this.model.setText(e)},getHoverText:function(b,e){var a=this.convertMouseToLine(b,e);return this.model.findChildAtPosition({startOffset:a.row,
endOffset:a.col}).getLabel()},handleChange:function(b){this.inherited(arguments);var k=this.model.getText(),a=m.currentEditor;a&&a.getCommandStack?(a=a.getCommandStack(),k=new e({model:this.model,oldText:k,newText:b}),a.execute(k)):(this.model.setText(b),dojo.publish("/davinci/ui/modelChanged",[{newModel:this.model}]))},selectModel:function(b,e){if(!(this.publishingSelect||e&&this!=e)&&b.length&&b[0].model){var a=b[0].model;a.elementType&&(a=this.model.mapPositions(a),this.select(a))}},selectionChange:function(b){var e=
this.model.mapPositions(this.model),e=this.model.endOffset-e.endOffset,e=this.model.findChildAtPosition({startOffset:b.startOffset+e,endOffset:b.endOffset+e-1});b.model=e;if(e!=this._selectedModel)try{this.publishingSelect=!0,dojo.publish("/davinci/ui/selectionChanged",[[b],this])}finally{this.publishingSelect=!1}this._selectedModel=e},getSyntaxPositions:function(b,e){this.model.setText(b);if(this.model.getSyntaxPositions)return this.model.getSyntaxPositions(e).sort(function(a,b){return a.line!=b.line?
a.line-b.line:a.col-b.col})},save:function(){this.model.setText(this.getText());this.inherited(arguments)},getErrors:function(){return this.model.errors||[]}})})},"davinci/ui/TextEditor":function(){define(["dojo/_base/declare","./Editor","../Runtime"],function(p,m,h){return p(m,{constructor:function(e,b){this.subscriptions=[];this._handles=[]},isActiveEditor:function(){return h.currentEditor==this},handleChange:function(e){this.editorContainer&&this.editorContainer.setDirty(!0);this.isDirty=!0;this.lastModifiedTime=
Date.now()},_onKey:function(e){davinci.Workbench.currentContext=this.editorID;return davinci.Workbench.handleKey(e)},subscribe:function(e,b){this.subscriptions.push(dojo.subscribe(e,this,b))},destroy:function(){this.inherited(arguments);this.subscriptions.forEach(dojo.unsubscribe);this._handles.forEach(dojo.disconnect)},getDefaultContent:function(){return null},getErrors:function(){return[]},save:function(e){var b=this.getText();if(this.resourceFile){this.resourceFile.clearMarkers();for(var k=this.getErrors(),
a=0;a<k.length;a++){var g;switch(k[a].id){case "(error)":g="error";break;case "(warning)":g="warning"}g&&this.resourceFile.addMarker(g,k[a].line+1,k[a].reason)}this.resourceFile.setContents(b,e);this.editorContainer&&this.editorContainer.setDirty(e);this.isDirty=!1;this.lastModifiedTime=0}},supports:function(e){return!1},_connect:function(e,b,k){this._handles.push(dojo.connect(e,b,this,k))}})})},"davinci/ui/Editor":function(){define(["../commands/CommandStack","dojo/_base/declare","../actions/Action"],
function(p,m,h){m("davinci.ui._EditorCutAction",h,{constructor:function(b){this._editor=b},run:function(b){this._editor.getTextView()._doCut()},isEnabled:function(b){return!this._editor.getTextView()._getSelection().isEmpty()}});m("davinci.ui._EditorCopyAction",h,{constructor:function(b){this._editor=b},run:function(b){this._editor.getTextView()._doCopy()},isEnabled:function(b){return!this._editor.getTextView()._getSelection().isEmpty()}});m("davinci.ui._EditorPasteAction",h,{constructor:function(b){this._editor=
b},run:function(b){this._editor.getTextView()._doPaste()}});var e=function(b){if(this._dontNotifyChange)delete this._dontNotifyChange;else if(this.lastChangeStamp=Date.now(),this.handleChange&&!("waiter"in this))try{if(this.waiter=!0,!doLater(1E3<Date.now()-this.lastChangeStamp,this)){delete this.waiter;this.isTyping=!0;var a=this.editor.getTextView(),e=a.getSelection(),h=a.getHorizontalPixel(),f=a.getTopPixel();this.handleChange(this._textModel.getText());delete this.isTyping;a.setSelection(e.start,
e.end,!1);a.setHorizontalPixel(h);a.setTopPixel(f)}}catch(d){console.error(d)}},b=function(b){this._progSelect||this.selectionChange({startOffset:b.newValue.start,endOffset:b.newValue.end})};return m(null,{constructor:function(b,a,e){this.contentDiv=b;this.commandStack=new p;this._existWhenVisible=e;this._isVisible=!e},setContent:function(b,a){this.editor||this._existWhenVisible&&!this._isVisible||this._createEditor();this._textModel||(this._textModel=this.editor?this.editor.getModel():new mProjectionTextModel.ProjectionTextModel(new mTextModel.TextModel));
this.fileName=b;this.setValue(a,!0);this._updateStyler();this._textModel&&(dojo.disconnect(this._textModelConnection),this._textModelConnection=dojo.connect(this._textModel,"onChanged",this,e))},setVisible:function(e){e!=this._isVisible&&this._existWhenVisible&&(e&&this._existWhenVisible?(this._createEditor(),this._updateStyler()):(this.editor.getTextView().removeEventListener("Selection",dojo.hitch(this,b)),delete this.editor));this._isVisible=e},setValue:function(b,a){this._dontNotifyChange=a;this.editor?
this.editor.setText(b):this._textModel.setText(b)},_createEditor:function(){var e,a=new mCSSContentAssist.CssContentAssistProvider,g=new mJSContentAssist.JavaScriptContentAssistProvider,h=this.contentDiv,f=this._textModel,d={statusReporter:function(a,b){b&&console.error("orion.editor: "+a)},textViewFactory:function(){return new mTextView.TextView({parent:h,model:f||new mProjectionTextModel.ProjectionTextModel(new mTextModel.TextModel),tabSize:4})},undoStackFactory:new mEditorFeatures.UndoFactory,
annotationFactory:new mEditorFeatures.AnnotationFactory,foldingRulerFactory:new mEditorFeatures.FoldingRulerFactory,lineNumberRulerFactory:new mEditorFeatures.LineNumberRulerFactory,contentAssistFactory:{createContentAssistMode:function(a){e=new mContentAssist.ContentAssist(a.getTextView());a=new mContentAssist.ContentAssistWidget(e,"contentassist");return new mContentAssist.ContentAssistMode(e,a)}},keyBindingFactory:function(a,b,d,e){var f=new mEditorFeatures.TextActions(a,d);b.push(f);a=new mEditorFeatures.SourceCodeActions(a,
d,e);b.push(a)},domNode:h};this.editor=new mEditor.Editor(d);this.editor.installTextView();/\.css$/.test(this.fileName)?e.setProviders([a]):/\.js$/.test(this.fileName)&&e.setProviders([g]);this._activityConnections=UserActivityMonitor.addInActivityMonitor(this.contentDiv.ownerDocument);this.editor.getTextView().focus();dojo.style(this.contentDiv,"overflow","hidden");this.selectionChange&&this.editor.getTextView().addEventListener("Selection",dojo.hitch(this,b));this.cutAction=new davinci.ui._EditorCutAction(this.editor);
this.copyAction=new davinci.ui._EditorCopyAction(this.editor);this.pasteAction=new davinci.ui._EditorPasteAction(this.editor)},_updateStyler:function(){if(this.editor){var b=this.fileName.substr(this.fileName.lastIndexOf(".")+1),a=this.editor.getTextView();this._styler&&(this._styler.destroy(),delete this._styler);"json"==b&&(b="js");switch(b){case "js":case "java":case "css":this._styler=new mTextStyler.TextStyler(a,b,this.editor.getAnnotationModel());this.editor.setFoldingRulerVisible(!0);break;
case "html":this._styler=new mTextMateStyler.TextMateStyler(a,new mHtmlGrammar.HtmlGrammar)}}},selectionChange:function(b){},destroy:function(){dojo.forEach(this._activityConnections,dojo.disconnect)},select:function(b){if(this.editor)try{this._progSelect=!0,this.editor.setSelection(b.endOffset,b.startOffset)}finally{delete this._progSelect}},getText:function(){return this._textModel.getText(0)},getOnUnloadWarningMessage:function(){return null}})})},"davinci/commands/SourceChangeCommand":function(){define(["dojo/_base/declare",
"davinci/Runtime"],function(p,m){return p("davinci.commands.SourceChangeCommand",null,{name:"SourceChange",constructor:function(h){this._model=h.model;this._oldText=h.oldText;this._newText=h.newText},incrementalUpdate:function(h){this._newText=h.newText},execute:function(){this._model.setText(this._newText);dojo.publish("/davinci/ui/modelChanged",[{newModel:this._model}]);var h=m.currentEditor;"davinci.ve.PageEditor"==h.declaredClass&&h.handleChange&&require(["davinci/ve/PageEditor"],function(e){e.prototype._srcChanged.call(h,
this._newText)}.bind(this));if(!this.established)return this.established=!0},undo:function(){this._model.setText(this._oldText);dojo.publish("/davinci/ui/modelChanged",[{newModel:this._model}]);var h=m.currentEditor;"davinci.ve.PageEditor"==h.declaredClass&&h.handleChange&&require(["davinci/ve/PageEditor"],function(e){e.prototype._srcChanged.call(h,this._oldText)}.bind(this))}})})},"davinci/html/ui/HTMLEditor":function(){define(["dojo/_base/declare","davinci/ui/ModelEditor","davinci/model/Factory",
"davinci/html/ui/HTMLOutline"],function(p,m,h,e){return p("davinci.html.ui.HTMLEditor",m,{constructor:function(b,e){this.model=this.htmlFile=h.getModel({url:e});this._handle=dojo.connect(this.htmlFile.getDocumentElement(),"onkeydown",this,"onKeyDown")},destroy:function(){this.htmlFile.close();dojo.disconnect(this._handle);this.inherited(arguments)},getOutline:function(){this.outline||(this.outline=new e(this.model));return this.outline},getDefaultContent:function(){return"\x3chtml\x3e\n \x3chead\x3e\x3c/head\x3e\n \x3cbody\x3e\x3c/body\x3e\n\x3c/html\x3e"},
onKeyDown:function(b){}})})},"davinci/html/ui/HTMLOutline":function(){define(["dojo/_base/declare","davinci/html/ui/HTMLOutlineModel"],function(p,m){return p("davinci/html/ui/HTMLOutline",null,{constructor:function(h){this._htmlModel=h},getModel:function(){return this._model=new m(this._htmlModel)}})})},"davinci/html/ui/HTMLOutlineModel":function(){define(["dojo/_base/declare"],function(p){return p("davinci.html.ui.HTMLOutlineModel",null,{constructor:function(m){this.root=m;this.subscription=dojo.subscribe("/davinci/ui/modelChanged",
this,this._modelChanged)},getRoot:function(m,h){m(this.root)},getIdentity:function(m){return m.getID()},getLabel:function(m){return m.getLabel().replace("\x3c","\x26lt")},_getChildren:function(m){var h=[];"HTMLFile"!=m.elementType&&"HTMLElement"!=m.elementType||dojo.forEach(m.children,function(e){"HTMLElement"==e.elementType&&h.push(e)});return h},mayHaveChildren:function(m){return 0<m.children.length},getChildren:function(m,h,e){h(this._getChildren(m))},_modelChanged:function(){this.onChildrenChange(this.root,
this._getChildren(this.root))},destroy:function(){dojo.unsubscribe(this.subscription)}})})},"davinci/ve/VisualEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom-class dojo/dom-construct dojo/promise/all dojo/text!./template.html ../Runtime ../Workbench ../model/Path ./metadata ./Context preview/silhouetteiframe preview/loadIndicator ../workbench/Preferences ./widget ../XPathUtils ../html/HtmlFileXPathAdapter ./utils/GeomUtils xide/utils xide/registry".split(" "),
function(p,m,h,e,b,k,a,g,n,f,d,c,q,u,r,z,y,B,x,w,v){return p("davinci.ve.VisualEditor",null,{deviceName:"none",_orientation:"portrait",_subscriptions:[],delite:!1,context:null,getContext:function(){return this.context},template:{},constructor2:function(a,c,f){this._pageEditor=c;this.template=f||{};this.contentPane=dijit.getEnclosingWidget(a)||v.byId(a.id);this.loadingDiv=b.create("div",{className:"loading",innerHTML:dojo.replace("\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e\x3cspan\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3c/span\x3e\x26nbsp;{0}\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
["Loading..."])},this.contentPane.domNode.parentNode,"first");e.add(this.contentPane.domNode,"fullPane");a=b.create("div",{className:"silhouette_div_container"},this.contentPane.domNode);b.create("span",{className:"silhouetteiframe_object_container"},a);this.silhouetteiframe=new q({rootNode:a,margin:20});var g=this;this.contentPane.connect(this.contentPane,"resize",function(a){var b=dojo.query(".designCP iframe",this._pageEditor.domNode)[0];b&&b.contentDocument&&b.contentDocument.body&&(g._resizeBody(b.contentDocument.body,
a),setTimeout(function(){var a=g.getContext();a.clearCachedWidgetBounds();a.updateFocusAll();g._registerScrollHandlers()},100))}.bind(this));this._pageEditor.deferreds=k(d.getDeferreds());this._subscriptions.push(dojo.subscribe("/davinci/ui/editorSelected",this._editorSelected.bind(this)));this._subscriptions.push(dojo.subscribe("/davinci/ui/context/loaded",this._contextLoaded.bind(this)))},_setContentRaw:function(a,b,d){this.fileName=a;this.basePath=new f(a);if(this.initialSet)this.context.setSource(b,
this.context._restoreStates,this.context);else{var e=g.getUserWorkspaceUrl();0==a.indexOf("./")&&(a=a.substring(2,a.length));a=e+a;a=e;this._handles=[];e=dojo.query(".silhouette_div_container",this.contentPane.containerNode)[0];$(this.contentPane.containerNode).find(".silhouette_div_container");e={editor:this._pageEditor,visualEditor:this,containerNode:e,model:b,template:this.template,baseURL:a,iframeattrs:{"class":"silhouetteiframe_iframe"},ctx:this._pageEditor.ctx};this.context=this.template&&this.template.contextClass?
new (w.getObject(this.template.contextClass))(e):new c(e);this.context._commandStack=this._commandStack;this._commandStack._context=this.context;try{this._handles.push(dojo.connect(this.context,"activate",this,this.update))}catch(h){debugger}this._handles.push(dojo.connect(this.context,"onContentChange",this,this.onContentChange));this._handles.push(dojo.connect(this.context,"onSelectionChange",this,this.onContentChange));this.title=dojo.doc.title;this.context._setSource(b,this._connectCallback,this,
d);this.context.getFlowLayout();this.initialSet=!0}},constructor:function(a,c,f){this._pageEditor=c;this.template=f||{};this.contentPane=dijit.getEnclosingWidget(a)||v.byId(a.id);a=this.contentPane.containerNode;this.loadingDiv=b.create("div",{className:"loading",innerHTML:dojo.replace("\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e\x3cspan\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3c/span\x3e\x26nbsp;{0}\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",["Loading..."])},a.parentNode,"first");e.add(a,"fullPane");a=
b.create("div",{className:"silhouette_div_container"},a);b.create("span",{className:"silhouetteiframe_object_container"},a);this.silhouetteiframe=new q({rootNode:a,margin:20});this._pageEditor.deferreds=k(d.getDeferreds());this._subscriptions.push(dojo.subscribe("/davinci/ui/editorSelected",this._editorSelected.bind(this)));this._subscriptions.push(dojo.subscribe("/davinci/ui/context/loaded",this._contextLoaded.bind(this)))},getDevice:function(){return this.deviceName},setDevice:function(a,b){this.deviceName=
a;var c=this.getContext();c.setMobileMeta(a);b||c.setMobileTheme(a);this.silhouetteiframe.setSVGFilename("none"==a?null:"app/preview/images/"+a+".svg");c.clearCachedWidgetBounds();dojo.publish("/davinci/ui/deviceChanged",[a]);dojo.publish("/davinci/ui/repositionFocusContainer",[])},toggleOrientation:function(){"none"!=this.deviceName&&this.setOrientation("landscape"==this._orientation?"portrait":"landscape");this.getContext().clearCachedWidgetBounds()},getOrientation:function(a){return this._orientation},
setOrientation:function(a){if("none"!=this.deviceName&&this._orientation!=a){this._orientation=a;a=n.getOpenEditor();a.editorContainer&&a.editorContainer.updateToolbars&&a.editorContainer.updateToolbars();var b=this.getContext();b.setMobileOrientation(this._orientation);this.silhouetteiframe.setOrientation(this._orientation);a._visualChanged();setTimeout(function(){b.clearCachedWidgetBounds();b.updateFocusAll()},100)}},_objectPropertiesChange:function(a){if(this.isActiveEditor()){var b=this.getContext(),
c=a.command;b.getCommandStack().execute(a.compoundCommand||c);c._newId?(a=z.byId(c._newId,b.getDocument()),b.select(a)):(c=b.getSelection(),a=c.length?c[c.length-1]:void 0,1<c.length&&b.select(a));this._srcChanged()}},isActiveEditor:function(){var a=g.currentEditor;return a&&"davinci.ve.PageEditor"==a.declaredClass&&a.visualEditor==this},_stylePropertiesChange:function(a){if(this.isActiveEditor()){var b=this.getContext().getCommandForStyleChange(a);b&&(this.getContext().getCommandStack().execute(b),
b._newId&&(b=z.byId(b._newId,context.getDocument()),this.context.select(b)),this._srcChanged(),dojo.publish("/davinci/ui/widgetValuesChanged",[a]))}},_srcChanged:function(){this.isDirty=!0},getTemplate:function(){return a},destroy:function(){this._handles&&(this._focusPopup&&this._focusPopup.destroyRecursive(),delete this._focusPopup,this.context.destroy(),this._handles.forEach(dojo.disconnect),this._iframeScrollHandler&&(dojo.disconnect(this._iframeScrollHandler),delete this._iframeScrollHandler),
this._designCPScrollHandler&&(dojo.disconnect(this._designCPScrollHandler),delete this._designCPScrollHandler),this._subscriptions.forEach(dojo.unsubscribe),this._subscriptions=[])},setContent:function(a,b,c){this._onloadMessages=[];this._setContent(a,b,c)},saveAs:function(a,b,c){this._setContent(a,c)},_setContent:function(a,b,c){this._setContentRaw(a,b,c)},_connectCallback:function(a){try{if(a instanceof Error)throw a;var b=this.context,c;this.savePoint=0;try{b.activate2()}catch(d){console.error("crash in context activation! : "+
d),logError(d,"crash in context activation! : ")}c=n.createPopup({partID:"davinci.ve.visualEditor",domNode:b.getContainerNode(),keysDomNode:b.getDocument(),context:b});if(!b.getDocument().createElement)debugger;c&&(c.adjustPosition=function(a){var c=dojo.position(b.frameNode);dojo.withDoc(b.getDocument(),function(){var a=dojo.docScroll();c.x-=a.x;c.y-=a.y});return c});this._focusPopup=n.createPopup({partID:"davinci.ve.visualEditor",domNode:b.getFocusContainer(),keysDomNode:b.getDocument(),context:b});
b.getTopWidgets().forEach(function(a){a.resize&&a.resize()});b.anyDojoxMobileWidgets=void 0;dojo.publish("/davinci/ui/context/pagebuilt",[b])}catch(e){a=e}finally{a.errorMessage?this.loadingDiv.innerHTML=a.errorMessage||"(unknown)":a instanceof Error?(this.loadingDiv.parentNode&&this.loadingDiv.parentNode.removeChild(this.loadingDiv),delete this.loadingDiv,console.error("error! ",a),dojo.publish("/davinci/ui/context/pagebuilt",[b])):(this.loadingDiv.parentNode&&this.loadingDiv.parentNode.removeChild(this.loadingDiv),
delete this.loadingDiv)}},getSelectedWidget:function(){var a=this.getContext(),b=a.getSelection(),c=b.length?b[b.length-1]:void 0;1<b.length&&a.select(c);return c},getSelectedSubWidget:function(){return this._selectedSubWidget},save:function(a){if(this.context){var b=[],c=this.context.getModel();c.getText();c.setDirty(!0);c.visit({visit:function(c){"HTMLFile"!=c.elementType&&"CSSFile"!=c.elementType||!c.isDirty()||b.push(c.save(a));return!1}});b=b.concat(this.getContext().saveDynamicCssFiles(this.context.cssFiles,
a));b.length?this.savePromise=k(b):delete this.savePromise;return this.savePromise}},removeWorkingCopy:function(){},getDefaultContent:function(){return this.getTemplate()},previewInBrowser:function(){var a=this.deviceName,b=n.getOpenEditor().resourceFile.getURL(),c=[];"none"!=a&&(c=["preview\x3d1","device\x3d"+encodeURIComponent(a),"file\x3d"+encodeURIComponent(b)],b=n.location(),b+="/maqetta/preview.html?","landscape"==this._orientation&&c.push("orientation\x3d"+this._orientation));this.context.getPreference("zazl")&&
c.push("zazl\x3dtrue");c.length&&(b+="?"+c.join("\x26"));a=function(){var a=window.open(b,"preview_"+b);u(a,g.location()+require.toUrl("dojox/image/resources/images/loading.gif"),"gray")};this.savePromise?this.savePromise.then(a):a()},refresh:function(){var a=this.context,b=y.getXPath(a.getSelection()[0]._srcElement,B);a.setSource(a.model);var b=a.model.evaluate(b).getAttribute("id"),c=z.byId(b,a.getDocument());setTimeout(function(){a.select(c)},0)},_contextLoaded:function(a){a==this.getContext()&&
this._registerScrollHandlers()},_editorSelected:function(a){var b=this.getContext(),b=b?b.getFocusContainer():null;a.oldEditor==this._pageEditor&&b&&this._focusPopup&&this._focusPopup.unBindDomNode(b);a.editor==this._pageEditor&&(this._registerScrollHandlers(),b&&this._focusPopup&&this._focusPopup.bindDomNode(b));if(b=document.getElementById("visualEditorBorder"))b.style.display=a.editor&&"davinci.ve.PageEditor"==a.editor.declaredClass?"block":"none"},_resizeBody:function(a,b){var c=x.getScrollLeft(a),
d=x.getScrollTop(a);a.style.width=0<c?b.w+c+"px":"100%";a.style.height=0<d?b.h+d+"px":"100%"},_scrollHandler:function(a){(a=dojo.query(".designCP iframe",this._pageEditor.domNode)[0])&&a.contentDocument&&a.contentDocument.body&&(this._resizeBody(a.contentDocument.body,{w:dojo.style(this.contentPane.domNode,"width"),h:dojo.style(this.contentPane.domNode,"height")}),setTimeout(function(){var a=this.getContext();a.clearCachedWidgetBounds();a.updateFocusAll()}.bind(this),100))},_registerScrollHandlers:function(){if(!this._iframeScrollHandler){var a=
dojo.query(".designCP iframe",this._pageEditor.domNode)[0];a&&a.contentDocument&&a.contentDocument.body&&(this._iframeScrollHandler=dojo.connect(a.contentDocument.body.ownerDocument,"onscroll",this,this._scrollHandler))}!this._designCPScrollHandler&&(a=dojo.query(".designCP",this._pageEditor.domNode)[0])&&(this._designCPScrollHandler=dojo.connect(a,"onscroll",this,this._scrollHandler))}})})},"davinci/ve/VisualEditorOutline":function(){define("dojo/_base/declare dojo/_base/connect ./commands/ReparentCommand ./commands/StyleCommand ./widget ./States ../Runtime xide/factory xide/types".split(" "),
function(p,m,h,e,b,k,a,g,n){var f=p(null,{toggleMode:!0,betweenThreshold:4,showRoot:!0,dndController:"dijit.tree.dndSource",onChange:function(a){},constructor:function(a){this._context=a;this._handles=[];this._connect("activate","_rebuild");this._connect("widgetChanged","_widgetChanged")},getRoot:function(a,b){a(this._context.rootWidget||{id:"myapp",label:"application"})},getLabel:function(a){if("myapp"==a.id)return this._context.model.fileName;var c="",e=this._getWidget(a);if("xblox/RunScript"===
a.type&&e)return(c=e.domNode)&&c.script?"XBlox::"+c.script:"XBlox::"+e.dijitWidget.targetEvent;if(e.isWidget)return c=b.getLabel(e);if(c=e.type){a=this.useRichTextLabel?"\x26lt;":"\x3c";var f=this.useRichTextLabel?"\x26gt;":"\x3e",c=0===c.indexOf("html.")?a+c.substring(5)+f:0===c.indexOf("OpenAjax.")?a+c.substring(9)+f:0<c.indexOf(".")?c.substring(c.lastIndexOf(".")+1):e.label||c;(e=b.byId(e.id,this._context.getDocument()))&&(e=e.getId())&&(c+=" id\x3d"+e);return c}},_getChildren:function(a){var b=
[];this._context.rootWidget||console.error("editor context has no root widget yet!");if(!this._context.rootWidget||!a||"state"==a.type||"html.stickynote"==a.type||"html.richtext"==a.type)return[];if("myapp"==a.id||a===this._context.rootNode)b=this._context.getTopWidgets();else{var e=this._getWidget(a);e&&e.getChildren&&(b=this._getWidget(a).getChildren())}return b.filter(function(a){return"xblox/RunScript"==a.type||"xblox/CSSState"==a.type||"xblox/StyleState"==a.type?!0:a&&a.getContext&&a.getContext()&&
!a.internal&&a._srcElement}).map(this._buildItem)},__getChildren:function(a){var b=[];a&&"dijit/form/Button"==a.type&&a.dijitWidget&&dojo.forEach(a.dijitWidget.domNode.children,function(a){(a=davinci.ve.widget.getWidget(a))&&"xblox/RunScript"==a.type&&b.push(a)});return b},mayHaveChildren:function(a){return(a=this._getWidget(a))&&a.type&&0===a.type.indexOf("OpenAjax.")?!1:0<this._getChildren(a).length},getIdentity:function(a){return a?a.id:null},getChildren:function(a,b,e){b(this._getChildren(a))},
put:function(a,b){var e=this._getWidget(a),f=e.getParent();this.onChildrenChange(f,this._getChildren(f));return this.getIdentity(e)},add:function(a,b){(b=b||{}).overwrite=!1;return this.put(a,b)},onDelete:function(a){},remove:function(a){this.onDelete(a)},newItem:function(a,b){},pasteItem:function(a,b,e,f,g,k){a&&e&&b&&(e="myapp"==e.id?this._context.rootWidget:this._getWidget(e),b="myapp"==b.id?this._context.rootWidget:this._getWidget(b),a=this._getWidget(a),b!=e||f||dojo.indexOf(b.getChildren(),
a)<g&&g++,a=new h(a,e,g),this._context.getCommandStack().execute(a))},checkItemAcceptance:function(a,b,e){switch(e){case "before":case "after":return!0;default:return a=dijit.getEnclosingWidget(a).item,a=this.tree.model._getWidget(a),a.getContainerNode&&a.getContainerNode()||"myapp"==a.id}},onChildrenChange:function(a,b){},_rebuild:function(){if(!this._skipRefresh){var a=this._context.rootNode;if(a)this.onChildrenChange(this._buildItem(a),this._getChildren(a))}},_widgetChanged:function(a,b,e){try{a===
this._context.WIDGET_ADDED?this.add(b):a===this._context.WIDGET_REMOVED?this.remove(b):a===this._context.WIDGET_MODIFIED?(this.onChange(b),this.onChildrenChange(b,this._getChildren(b))):a===this._context.WIDGET_REPARENTED?(this.remove(b),this.put(b,{overwrite:!0,parent:e[1]})):a===this._context.WIDGET_ID_CHANGED&&(this.remove({id:e}),this.add(b))}catch(f){console.error("VisualEditorOutline._widgetChanged: e \x3d "+f)}g.publish(n.EVENTS.ON_WIDGET_CHANGED,{type:a,widget:b,args:e},this)},toggle:function(a,
b,e){a=this._getWidget(a);var f=a.getHelper(),g=!0;f&&f.onToggleVisibility&&(g=f.onToggleVisibility(a,b));return g?(this._toggle(a,b,e),!0):!1},_toggle:function(a,b,f){b=b?"none":"";var g;if(f=k.getFocus(a.domNode.ownerDocument.body))g=f.state;else{f=k.getStatesListCurrent(a.domNode);for(var h=0;h<f.length;h++)if(f[h]){g=f[h];break}}a=new e(a,[{display:b}],g);this._context.getCommandStack().execute(a)},shouldShowElement:function(a,b){return"toggleNode"==a?"states"!=b.type&&"myapp"!=b.id:!0},_getToggledItemsAttr:function(){var a=
[],b;for(b in this.toggledItems)a.push(b);return a},isToggleOn:function(a){a=this._getWidget(a);var b=a.getHelper();return b&&b.isToggleOn?b.isToggleOn(a):"none"===a.domNode.style.display},_getWidget:function(a){return a?b.byId(a.id):null},_buildItem:function(a){if(a)return{id:a.id,type:a.type}},_connect:function(a,b){this._handles.push(m.connect(this._context,a,this,b))},destroy:function(){this._handles.forEach(m.disconnect)}});return p("davinci.ve.VisualEditorOutline",null,{toolbarID:"davinci.ve.outline",
_outlineMode:"design",constructor:function(b){this._editor=b;this._context=b.visualEditor.context;this._handles=[];this._connect("onSelectionChange","onSelectionChange");this._connect("deselect","deselect");this._widgetModel=new f(this._context);m.subscribe("/maqetta/appstates/state/changed/end",this,function(b){if("davinci.themeEditor.ThemeEditor"!==("undefined"!==typeof davinci&&a.currentEditor&&a.currentEditor.declaredClass)&&this._tree&&(b=b&&b.node&&b.node._dvWidget))for(b=b.getChildren();b.length;){var d=
b.shift();if(d){var e="none"!==d.domNode.style.display;this._tree&&this._tree.toggleNode(d,!e);b=b.concat(d.getChildren())}}})},getActionsID:function(){if("design"===this._outlineMode)return"davinci.ve.VisualEditorOutline"},_connect:function(a,b){this._handles.push(m.connect(this._context,a,this,b))},switchDisplayMode:function(a){this._outlineMode=a;this._outlineView.createTree()},getModel:function(){switch(this._outlineMode){case "design":this._model=this._widgetModel;break;case "source":this._model=
this._srcModel}return this._model},getSelectedItem:function(){return this._tree&&this._tree._getSelectedItemAttr()},onSelectionChange:function(a,b){"design"==this._outlineMode&&(a=a||this._context.getSelection())&&this._tree&&this._tree.selectNode(a,b)},deselect:function(){this._tree&&this._tree&&this._tree.deselectAll()},getIconClass:function(a,b){var e=a.type;return e?"xblox/RunScript"==e?"fa fa-play-circle-o":b?"fa fa-circle-thin":"fa fa-circle":b?"fa fa-circle-thin":"fa fa-circle"}})})},"davinci/html/ui/ImageViewer":function(){define([],
function(){var p=function(m){this.element=m};p.prototype={isReadOnly:!0,save:function(){},getDefaultContent:function(){},supports:function(m){return!1},setContent:function(m,h){this.fileName=m;this.element.innerHTML="\x3cdiv style\x3d'overflow:auto'\x3e\x3cimg src\x3d'"+encodeURI(this.resourceFile.getURL())+"'/\x3e\x3c/div\x3e";this.dirty=!1},destroy:function(){},getOnUnloadWarningMessage:function(){return null}};return p})},"davinci/ve/prefs/HTMLEditPreferences":function(){define("dojo/_base/declare dijit/layout/ContentPane dijit/_TemplatedMixin dijit/form/CheckBox dijit/form/TextBox dijit/form/Select dojo/i18n!../nls/common dojo/text!./HtmlEditPreferences.html".split(" "),
function(p,m,h,e,b,k,a,g){return p([m,h],{templateString:g,postMixInProperties:function(){this._loc=a},postCreate:function(){this._snap=new e({},this.snapNode);this._showPossibleParents=new e({},this.showPossibleParentsNode);this._cssOverrideWarn=new e({},this.cssOverrideWarn);this._absoluteWidgetsZindex=new b({},this.absoluteWidgetsZindex);this._zazl=new e({},this.zazl);this.containerNode||(this.containerNode=this.domNode)},getDefaults:function(){},setDefaults:function(){},doApply:function(){},getPreferences:function(){return{snap:this._snap.checked,
showPossibleParents:this._showPossibleParents.checked,cssOverrideWarn:this._cssOverrideWarn.checked,absoluteWidgetsZindex:this._absoluteWidgetsZindex.value,zazl:this._zazl.checked}},setPreferences:function(a){a=a||{};this._check(this._snap,!!a.snap);this._check(this._showPossibleParents,!!a.showPossibleParents);this._check(this._cssOverrideWarn,!!a.cssOverrideWarn);this._absoluteWidgetsZindex.set("value",a.absoluteWidgetsZindex);this._check(this._zazl,!!a.zazl)},_check:function(a,b){a.set("checked",
b)},save:function(a){davinci.ve._preferences=a}})})},"davinci/commands/OrderedCompoundCommand":function(){define(["dojo/_base/declare","davinci/commands/CompoundCommand"],function(p,m){return p("davinci.commands.OrderedCompoundCommand",m,{undo:function(){if(this._commands)for(var h=0;h<this._commands.length;h++)this._commands[h].undo()}})})}}});define("davinci/davinci",[],function(){});
//# sourceMappingURL=davinci.js.map