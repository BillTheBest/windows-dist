//>>built
require({cache:{"xblox/main":function(){define(["dojo/_base/kernel"],function(){return dojo.xblox})},"xblox/component":function(){define(["dojo/_base/declare","xdojo/has","xide/model/Component"],function(g,r,q){return g([q],{beanType:"BLOCK",_load:function(){},hasEditors:function(){return["xblox"]},getDependencies:function(){return"xide/xide xblox/types/Types xblox/manager/BlockManager xblox/manager/BlockManagerUI xblox/embedded_ui xide/widgets/ExpressionJavaScript xide/widgets/Expression xide/widgets/RichTextWidget xide/widgets/ExpressionEditor xide/widgets/WidgetReference".split(" ")},
getLabel:function(){return"xblox"},getBeanType:function(){return this.beanType}})})},"xblox/types/Types":function(){define(["xide/types/Types","xide/utils"],function(g,r){g.BLOCK_MODE={NORMAL:0,UPDATE_WIDGET_PROPERTY:1};g.BLOCK_OUTLET={NONE:0,PROGRESS:1,ERROR:2,PAUSED:4,FINISH:8,STOPPED:16};r.mixin(g.EVENTS,{ON_RUN_BLOCK:"onRunBlock",ON_RUN_BLOCK_FAILED:"onRunBlockFailed",ON_RUN_BLOCK_SUCCESS:"onRunBlockSuccess",ON_BLOCK_SELECTED:"onItemSelected",ON_BLOCK_UNSELECTED:"onBlockUnSelected",ON_BLOCK_EXPRESSION_FAILED:"onExpressionFailed",
ON_BUILD_BLOCK_INFO_LIST:"onBuildBlockInfoList",ON_BUILD_BLOCK_INFO_LIST_END:"onBuildBlockInfoListEnd",ON_BLOCK_PROPERTY_CHANGED:"onBlockPropertyChanged",ON_SCOPE_CREATED:"onScopeCreated",ON_VARIABLE_CHANGED:"onVariableChanged",ON_CREATE_VARIABLE_CI:"onCreateVariableCI"});g.BlockType={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",
ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",
MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",
WhileStatement:"WhileStatement",WithStatement:"WithStatement"};return g})},"xblox/embedded":function(){define("dojo/_base/declare xide/types xblox/types/Types xide/factory xide/utils xide/mixins/ReloadMixin xide/mixins/EventedMixin xblox/model/logic/CaseBlock xblox/model/Block xblox/model/functions/CallBlock xblox/model/code/CallMethod xblox/model/code/RunScript xblox/model/code/RunBlock xblox/model/loops/ForBlock xblox/model/loops/WhileBlock xblox/model/variables/VariableAssignmentBlock xblox/model/logic/IfBlock xblox/model/logic/ElseIfBlock xblox/model/logic/SwitchBlock xblox/model/variables/VariableSwitch xblox/model/events/OnEvent xblox/model/events/OnKey xblox/model/logging/Log xblox/model/html/SetStyle xblox/model/html/SetCSS xblox/model/html/SetStyle xblox/manager/BlockManager xblox/factory/Blocks xdojo/has!xblox-ui?xblox/model/Block_UI".split(" "),
function(){Array.prototype.remove||(Array.prototype.remove=function(){for(var g,r=arguments,q=r.length,e;q&&this.length;){g=r[--q];if(null==this.indexOf)break;for(;-1!=(e=this.indexOf(g));)this.splice(e,1)}return this});Array.prototype.swap||(Array.prototype.swap=function(g,r){var q=this[g];this[g]=this[r];this[r]=q;return this});"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(g){return this.substring(0,g.length)===g});"function"!=typeof String.prototype.endsWith&&
(String.prototype.endsWith=function(g){return this.substring(this.length-g.length,this.length)===g});Function.prototype.bind||(Function.prototype.bind=Function.prototype.bind||function(g){return dojo.hitch(g,this)})})},"xblox/model/logic/CaseBlock":function(){define("dcl/dcl xide/utils xide/types xblox/model/Block dojo/Deferred xblox/model/logic/BreakBlock".split(" "),function(g,r,q,e,c,b){return g(e,{declaredClass:"xblox.model.logic.CaseBlock",comparator:null,expression:null,items:null,name:"Case",
icon:"",hasInlineEdits:!0,toText:function(){return'\x3cspan style\x3d"text-indent: 1em;"\x3e\x26nbsp;\x26nbsp;\x26nbsp;'+this.getBlockIcon("I")+this.name+" "+this.makeEditable("comparator","right","text","Enter a comparison","inline")+(null!=this.expression?" "+this.makeEditable("expression","right","text","Enter a value to compare"):"")+"\x3c/span\x3e"},canAdd:function(){return[]},_solve:function(a,b,c){b=b||{highlight:!1};for(var k=[],p=0;p<this.items.length;p++){var x=this.items[p];-1!==x.declaredClass.indexOf("BreakBlock")&&
c.stop();this.addToEnd(k,x.solve(a,b))}return k},solve:function(a,b,c){try{var k=a.getVariableById(b.variable);!k&&c.args&&c.args[0]&&(k={value:c.args[0]});var p="";if(k)p=this._getArg(k.value,!0);else return this.onFailed(this,c),!1;if(!0===a.parseExpression(""+p+""+this.comparator+this._getArg(this.expression,!0)))return this.onSuccess(this,c),this._solve(a,c,b),!0;this.onFailed(this,c);return!1}catch(x){console.error("case block crashed! ",x.stack)}},getChildren:function(a){return this.items},
getFields:function(){function a(a,b){return{label:b||a,value:a}}var b=this.inherited(arguments)||this.getDefaultFields();b.push(r.createCI("Expression",13,this.expression,{group:"General",title:"Expression",dst:"expression"}));b.push(r.createCI("Comparator",3,this.comparator,{group:"General",title:"Comparator",dst:"comparator",widget:{options:[a("\x3d\x3d"),a("\x3c\x3d"),a("\x3d\x3e"),a("!\x3d"),a("\x3c"),a("\x3e")],editable:!0}}));return b},runAction:function(a){if("New/Break"===a.command){a=new c;
var m=this.add(b,{group:null});a.resolve({select:[m],focus:!0,append:!1});m.refresh();return a}},getActions:function(){return[this.createAction({label:"Break",command:"New/Break",tab:"Home",icon:"fa-stop",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}})]}})})},"xblox/model/Block":function(){define("dcl/dcl dojo/Deferred dojo/_base/lang dojo/has xblox/model/ModelBase xide/factory xide/utils xide/types xide/utils/ObjectUtils xdojo/has!xblox-ui?xblox/model/Block_UI".split(" "),function(g,r,
q,e,c,b,a,m,t,k){function p(a,b){for(var d=0;d<b.length;d++)if(a.id===b[d].id)return d}e=[c];a.mixin(m,{BLOCK_FLAGS:{NONE:0,ACTIVE:1,SCRIPT:2,RESERVED1:4,USEFUNCTION:8,RESERVED2:16,SINGLE:32,WAITSFORMESSAGE:64,VARIABLEINPUTS:128,VARIABLEOUTPUTS:256,VARIABLEPARAMETERINPUTS:512,VARIABLEPARAMETEROUTPUTS:1024,TOPMOST:16384,BUILDINGBLOCK:32768,MESSAGESENDER:65536,MESSAGERECEIVER:131072,TARGETABLE:262144,CUSTOMEDITDIALOG:524288,RESERVED0:1048576,EXECUTEDLASTFRAME:2097152,DEACTIVATENEXTFRAME:4194304,RESETNEXTFRAME:8388608,
INTERNALLYCREATEDINPUTS:16777216,INTERNALLYCREATEDOUTPUTS:33554432,INTERNALLYCREATEDINPUTPARAMS:67108864,INTERNALLYCREATEDOUTPUTPARAMS:134217728,INTERNALLYCREATEDLOCALPARAMS:1073741824,ACTIVATENEXTFRAME:268435456,LOCKED:536870912,LAUNCHEDONCE:2147483648},BLOCK_CALLBACKMASK:{PRESAVE:1,DELETE:2,ATTACH:4,DETACH:8,PAUSE:16,RESUME:32,CREATE:64,RESET:4096,POSTSAVE:256,LOAD:512,EDITED:1024,SETTINGSEDITED:2048,READSTATE:4096,NEWSCENE:8192,ACTIVATESCRIPT:16384,DEACTIVATESCRIPT:32768,RESETINBREAKPOINT:65536,
RENAME:131072,BASE:14,SAVELOAD:769,PPR:304,EDITIONS:3072,ALL:4294967295}});e=g(e,{declaredClass:"xblox.model.Block",scopeId:null,isCommand:!1,outlet:0,_destroyed:!1,enabled:!0,serializeMe:!0,name:null,shareTitle:"",sharable:!1,items:null,parent:null,_return:null,_lastResult:null,_deferredObject:null,_currentIndex:0,_lastRunSettings:null,_onLoaded:!1,beanType:"BLOCK",override:{},ignoreSerialize:"_didSubscribe _currentIndex _deferredObject _destroyed _return parent __started ignoreSerialize _lastRunSettings _onLoaded beanType sharable override virtual _scenario _didRegisterSubscribers additionalProperties renderBlockIcon serializeMe _statusIcon _statusClass hasInlineEdits _loop help owner _lastCommand allowActionOverride canDelete isCommand lastCommand autoCreateElse _postCreated _counter".split(" "),
_parseString:function(x,b,d,h){try{b=b||this._lastSettings||{};h=h||b.flags||m.CIFLAG.EXPRESSION;var l=this.scope,n=!(h&m.CIFLAG.DONT_PARSE),f=h&m.CIFLAG.EXPRESSION;h&m.CIFLAG.TO_HEX&&(x=a.to_hex(x));!1!==n&&(x=a.convertAllEscapes(x,"none"));var w=b.override||this.override||{},u=w&&w.variables?w.variables:null,c="",c=f&&!1!==n?l.parseExpression(x,null,u,null,null,null,w.args,h):""+x}catch(t){console.error(t)}return c},postCreate:function(){},childrenByClass:function(a){for(var b=this.getChildren(),
d=[],h=0;h<b.length;h++){var l=b[h];l.isInstanceOf(a)&&d.push(l)}return d},childrenByNotClass:function(a){for(var b=this.getChildren(),d=[],h=0;h<b.length;h++){var l=b[h];l.isInstanceOf(a)||d.push(l)}return d},getInstance:function(){var a=this.scope.instance;return a?a:null},pause:function(){},mergeNewModule:function(a){for(var b in a){var d=a[b];d&&_.isFunction(d)&&(this[b]=d)}},__onReloaded:function(x){this.mergeNewModule(x.prototype);x=this.declaredClass;(x=q.getObject(a.replaceAll("/",".",x))||
q.getObject(x))&&x.prototype&&x.prototype.solve&&this.mergeNewModule(x.prototype)},reparent:function(){if(!this)return!1;if(!this.getParent()){var a=this.next(null,1)||this.next(null,-1);a&&(this.group=null,a._add(this))}},unparent:function(a,b){if(!this)return!1;var d=this.getParent();d&&d.removeBlock&&d.removeBlock(this,!1);this.group=a;this.parent=this.parentId=null;!1!==b&&(this._place(null,-1,null),this._place(null,-1,null))},move:function(a){if(!this)return!1;var b=this.getParent(),d=null;if(b){d=
b[b._getContainer(this)];if(!d||2>d.length||!this.containsItem(d,this))return!1;b=this.indexOf(d,this);if(0>b+a)return!1;var h=d[b+a];if(!h)return!1;d[b+a]=this;d[b]=h}else this._place(null,a);return!0},_place:function(a,b,d){var h=this._store,l=this;(a=a||l.next(null,b))?(a=_.isString(a)?h.getSync(a):a,l=_.isString(l)?h.getSync(l):l,d=d||h.storage.fullData,b=-1==b?0:1,d.remove(l),-1==b&&(b=0),d.splice(Math.max(p(a,d)+b,0),0,l),h._reindex()):console.error("have no next",this)},index:function(){var a=
this.getParent(),b=null,d=this.group,b=this._store;if(a)return b=a[a._getContainer(this)]||[],b=b.filter(function(h){return h.group===d}),!b||2>b.length||!this.containsItem(b,this)?!1:this.indexOf(b,this);b=b.storage.fullData;b=b.filter(function(h){return h.group===d});return this.indexOf(b,this)},numberOfParents:function(){var a=0,b=this.getParent();b&&(a++,a+=b.numberOfParents());return a},getTopRoot:function(){var a=this.getParent();if(a){var b=a.getParent();b&&(a=b)}return a},next:function(a,
b){function d(l,n,f){var a=l.indexOf(n,l);if(a=n[a+f*h]){if(!a.parentId&&a.group&&a.group===l.group)return a;h++;return d(l,n,f)}return null}var h=1;a=a||this._store.storage.fullData;return d(this,a,b)},getParent:function(){return this.parentId?this.scope.getBlockById(this.parentId):null},getScope:function(){var a=this.scope;if(this.scopeId&&0<this.scopeId.length){var b=a.owner;b&&b.hasScope&&(b.hasScope(this.scopeId)?a=b.getScope(this.scopeId):console.error("have scope id but cant resolve it",this))}return a},
canAdd:function(){return null},getTarget:function(){var a=this._targetReference;if(a)return a;var b=this.getParent();b&&b.getTarget&&(a=b.getTarget());return a},addToEnd:function(a,b){b&&null!=a.length&&null!=b.length&&a.push.apply(a,b);return a},removeBlock:function(a,b){a&&(!1!==b&&a.empty&&a.empty(),!1!==b&&delete a.items,a.parent=null,this.items&&this.items.remove(a))},_getContainer:function(a){return"items"},empty:function(a){try{this._empty(a)}catch(b){debugger}},_empty:function(a){if(a=a||
this.items)for(var b=0;b<a.length;b++){var d=a[b];d&&d.empty&&d.empty();d&&this.scope&&this.scope.blockStore&&this.scope.blockStore.remove(d.id)}},containsItem:function(a,b){for(var d=a.length;d--;)if(a[d].id===b.id)return!0;return!1},indexOf:function(a,b){for(var d=a.length;d--;)if(a[d].id===b.id)return d;return-1},_getBlock:function(a){try{if(!this||!this.parentId)return!1;var b=this.scope.getBlockById(this.parentId);if(!b)return null;var d=b[b._getContainer(this)];if(!d||2>d.length||!this.containsItem(d,
this))return null;var h=this.indexOf(d,this);if(0>h+a)return!1;var l=d[h+a];if(l)return l}catch(n){debugger}return null},getPreviousBlock:function(){return this._getBlock(-1)},getNextBlock:function(){return this._getBlock(1)},_getPreviousResult:function(){var a=this.getPreviousBlock()||this.getParent();return a&&null!=a._lastResult?this.isArray(a._lastResult)?a._lastResult:[a._lastResult]:null},getPreviousResult:function(){var a=null;if((a=(a=this.getPreviousBlock())&&a._lastResult&&a.enabled?a:this.getParent())&&
!a._lastResult){var b=a.getParent();b&&(a=b)}return a&&null!=a._lastResult?(this.isArray(a._lastResult),a._lastResult):null},_getArg:function(a,b){var d=parseFloat(a);return isNaN(d)?"true"===a||"false"===a?"true"===a?!0:!1:a&&b&&_.isString(a)?"'"+a+"'":a:d},getArgs:function(b){var c=[];b=b||{};var d=b.args||this._get("args");b.override&&b.override.args&&(d=b.override.args);d&&(c=a.getJson(d,null,!1));if(c&&0==c.length&&d&&d.length&&_.isString(d)){if(-1!==d.indexOf(",")){d=d.split(",");for(b=0;b<
d.length;b++){var h=parseFloat(d[b]);isNaN(h)?"true"===d[b]||"false"===d[b]?c.push(a.toBoolean(d[b])):c.push(d[b]):c.push(h)}return c}c=[this._getArg(d)]}!_.isArray(c)&&(c=[]);b=this.getPreviousResult();null!=b&&(_.isArray(b)&&1==b.length?c.push(b[0]):c.push(b));return c||[d]},remove:function(a){this._destroyed=!0;null!=this.parentId&&null==this.parent&&(this.parent=this.scope.getBlockById(this.parentId));if(this.parent&&this.parent.removeBlock)this.parent.removeBlock(this);else if(a=a||this)a.empty&&
a.empty(),delete a.items,a.parent=null,this.items&&this.items.remove(a)},prepareBlockContructorArgs:function(a){a||(a={});a.id||(a.id=this.createUUID());a.items||(a.items=[])},_add:function(a,c,d,h){var l=null;try{c?(this.prepareBlockContructorArgs(c),l=b.createBlock(a,c,null,h)):null==c&&(l=a);(l.scope=this.scope)&&(l=this.scope.registerBlock(l,h));if(l.id===this.id){console.error("adding new block to our self");debugger}l.parent=this;l.parentId=this.id;var n=d||this._getContainer();if(n)if(this[n]||
(this[n]=[]),-1!=this.indexOf(this[n],l))console.error(" have already "+l.id+" in "+n);else{if(this.id==l.id){console.error("tried to add our self to "+n);return}this[n].push(l)}return l}catch(f){logError(f,"_add")}return null},getStore:function(){return this.getScope().getStore()},add:function(a,b,d){a=this._add(a,b,d);return a.getStore().getSync(a.id)},getContext:function(){return this.scope.instance&&this.scope.instance?this.scope.instance:null},resolved:function(){this._deferredObject&&(this._deferredObject.resolve(),
delete this._deferredObject)},_solve:function(a,b){b=b||{highlight:!1};for(var d=[],h=0;h<this.items.length;h++)this.addToEnd(d,this.items[h].solve(a,b));return d},solve:function(a,b){b=b||{highlight:!1};for(var d=[],h=0;h<this.items.length;h++)this.addToEnd(d,this.items[h].solve(a,b));return d},solveMany:function(a,b){!this._lastRunSettings&&b&&(this._lastRunSettings=b);b=this._lastRunSettings||b;this._currentIndex=0;this._return=[];var d=this[this._getContainer()];if(d.length)return d=this.runFrom(d,
0,b),this.onSuccess(this,b),d;this.onSuccess(this,b);return[]},runFrom:function(a,b,d){var h=this;a=a||this.items;var l=function(l){l._deferredObject.then(function(n){l._lastResult=l._lastResult||n;h._currentIndex++;h.runFrom(a,h._currentIndex,d)})};if(a.length)for(;b<a.length;b++){var n=a[b];if(!0===n.deferred){n._deferredObject=new r;this._currentIndex=b;l(n);this.addToEnd(this._return,n.solve(this.scope,d));break}else this.addToEnd(this._return,n.solve(this.scope,d))}else this.onSuccess(this,d);
return this._return},serializeField:function(a){return-1==this.ignoreSerialize.indexOf(a)},onLoad:function(){},activate:function(){},deactivate:function(){},_get:function(a){if(this.override)return a in this.override?this.override[a]:this[a]},onDidRun:function(){this.override&&(this.override.args&&delete this.override.args,delete this.override)},destroy:function(){this.stop(!0);this.reset();this._destroyed=!0},reset:function(){this._lastSettings={};this._loop&&(clearTimeout(this._loop),this._loop=
null);delete this.override;this.override={}},stop:function(){this.reset()}});e.FLAGS=m.BLOCK_FLAGS;e.EMITS=m.BLOCK_CALLBACKMASK;q.mixin(e.prototype,k.prototype);e.prototype.onSuccess||(e.prototype.onSuccess=function(){},e.prototype.onRun=function(){},e.prototype.onFailed=function(){});g.chainAfter(e,"stop");g.chainAfter(e,"destroy");g.chainAfter(e,"onDidRun");return e})},"xblox/model/ModelBase":function(){define(["dcl/dcl","xide/utils","xide/types","xide/mixins/EventedMixin"],function(g,r,q,e){e=
g(e.dcl,{declaredClass:"xblox.model.ModelBase",id:null,description:"",parent:null,parentId:null,group:null,order:0,_store:null,outputs:function(){return[]},takes:function(){return[]},needs:function(){return[]},constructor:function(c){for(var b in c)c.hasOwnProperty(b)&&(this[b]=c[b]);this.id||(this.id=this.createUUID());this.utils=r;this.types=q},keys:function(c){var b=[],a;for(a in c)b.push(a);return b},values:function(c){var b=[],a;for(a in c)b.push(c[a]);return b},toArray:function(){return this.map()},
size:function(){return this.toArray().length},createUUID:function(){var c=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()},canEdit:function(){return!0},getFields:function(){return null},isString:function(c){return"string"==typeof c},isNumber:function(c){return"number"==typeof c},isBoolean:function(c){return"boolean"==typeof c},isObject:function(c){return"object"===typeof c},isArray:function(c){return Array.isArray?Array.isArray(c):
!1},getValue:function(c){var b=parseFloat(c);return isNaN(b)?"true"===c||!0===c?!0:"false"===c||!1===c?!1:c:b},isScript:function(c){return this.isString(c)&&(-1!=c.indexOf("return")||-1!=c.indexOf(";")||-1!=c.indexOf("(")||-1!=c.indexOf("+")||-1!=c.indexOf("-")||-1!=c.indexOf("\x3c")||-1!=c.indexOf("*")||-1!=c.indexOf("/")||-1!=c.indexOf("%")||-1!=c.indexOf("\x3d")||-1!=c.indexOf("\x3d\x3d")||-1!=c.indexOf("\x3e")||-1!=c.indexOf("[")||-1!=c.indexOf("{")||-1!=c.indexOf("}"))},replaceAll:function(c,
b,a){return this.isString(a)?a.split(c).join(b):a},isInValidState:function(){return!0},destroy:function(){}});g.chainAfter(e,"destroy");return e})},"xblox/model/logic/BreakBlock":function(){define(["dcl/dcl","xide/utils","xide/types","xblox/model/Block"],function(g,r,q,e){return g(e,{declaredClass:"xblox.model.logic.BreakBlock",name:"Break",icon:"fa-stop",hasInlineEdits:!1,canAdd:!1,toText:function(){return'\x26nbsp;\x3cspan class\x3d"fa-stop text-warning"\x3e\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan\x3e'+
this.name+"\x3c/span\x3e"},solve:function(c,b){this.onSuccess(this,b)},getFields:function(){return this.inherited(arguments)||this.getDefaultFields()}})})},"xblox/model/functions/CallBlock":function(){define("dcl/dcl xide/utils xide/types dojo/Deferred xblox/model/Block xcf/model/Command".split(" "),function(g,r,q,e,c,b){return g(b,{declaredClass:"xblox.model.functions.CallBlock",command:"Select command please",icon:"",args:null,_timeout:100,isCommand:!0,_commandHandles:null,onCommandProgress:function(a){this.getScope().getContext();
var b=a.params;b&&b.id&&(this._emit("cmd:"+a.cmd+"_"+b.id,{msg:a}),a.lastResponse&&this.storeResult(a.lastResponse),this._emit("progress",{msg:a,id:b.id}));this._lastResult=null;this._lastResult=a?a.result:null;a=this.getItems(q.BLOCK_OUTLET.PROGRESS);this._lastSettings||(this._lastSettings={});this._lastSettings.override={};a.length&&this.runFrom(a,0,this._lastSettings)},stop:function(){this._lastCommand&&this._lastCommand.stop()},pause:function(){this._lastCommand&&this._lastCommand.pause()},destroy:function(){_.invoke(this._commandHandles,
"remove");delete this._commandHandles;delete this._lastCommand},solve:function(a,b){this._commandHandles&&_.invoke(this._commandHandles,"remove");this._commandHandles=[];var c=this._timeout||50;_.isString(c)&&(c=parseInt(c));var k=new e,p=this._commandHandles;b=b||{};setTimeout(function(){if(this.command){var c=null;if(this.args){b.override=b.override||{};var t=a.expressionModel.replaceVariables(a,this.args,!1,!1,null,null,{begin:"%%",end:"%%"});try{c=r.fromJson(t)}catch(d){c=t}b.override.args=_.isArray(c)?
c:[t];b.override.mixin=c}if(this._lastCommand=a.resolveBlock(this.command))p.push(this._lastCommand._on("paused",this.onCommandPaused,this)),p.push(this._lastCommand._on("finished",this.onCommandFinish,this)),p.push(this._lastCommand._on("stopped",this.onCommandStopped,this)),p.push(this._lastCommand._on("error",this.onCommandError,this)),p.push(this._lastCommand._on("progress",this.onCommandProgress,this));if(c=a.solveBlock(this.command,b))this.onSuccess(this,b);else this.onFailed(this,b);k.resolve(c);
return c}}.bind(this),c);return k},hasInlineEdits:!0,makeEditable:function(a,b,c,k,p,e,y){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+b+"' display-mode\x3d'"+(p||"popup")+"' display-type\x3d'"+(c||"text")+"' data-prop\x3d'"+a+"' data-title\x3d'"+k+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[a]+"\x3c/a\x3e"},getFieldOptions:function(a){if("command"===a)return this.scope.getCommandsAsOptions("text")},toText:function(){var a="Unknown",b=this.scope.getBlock(this.command);b&&(a=b.name);
-1!==this.command.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Call Command : "+a},getFields:function(){var a=this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);a.push(r.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));
a.push(r.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(r.createCI("timeout",13,this._timeout,{group:"General",title:"Delay",dst:"_timeout"}));return a}})})},"xblox/model/code/CallMethod":function(){define(["dcl/dcl","xblox/model/Block","xide/utils"],function(g,r,q){return g(r,{declaredClass:"xblox.model.code.CallMethod",name:"Call Method",method:"",args:"",sharable:!0,solve:function(e,c){var b=this.getContext();if(b&&null!=b[this.method]){var a=[],m=b[this.method];
try{var t=this.getArgs(c),a=m.apply(b,t||[]);this.onSuccess(this,c);return a}catch(k){console.error("call method "+this.method+" failed: "+k),logError(k),this.onFailed(this,c)}}else this.onFailed(this,c);return[]},toText:function(){var e=this.getBlockIcon()+" "+this.name+" ";this.method&&(e+=this.makeEditable("method","bottom","text","Enter a driver method","inline"));return e},getFields:function(){var e=this.getDefaultFields();this.getContext();e.push(q.createCI("value",13,this.method,{group:"General",
title:"Method",dst:"method"}));e.push(q.createCI("value",27,this.args,{group:"Arguments",dst:"args",widget:{title:""}}));return e},getBlockIcon:function(){return'\x3cspan class\x3d"fa-caret-square-o-right"\x3e\x3c/span\x3e'}})})},"xblox/model/code/RunScript":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains dojo/promise/all xide/types module".split(" "),function(g,r,q,e,c,b,a,m,t,k,p,x,y){var d="undefined"!==typeof window?window.console:global.console;
return g([e,b],{declaredClass:"xblox.model.code.RunScript",name:"Run Script",method:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-code",observed:["method"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve2:function(a,l,n,f){this._currentIndex=0;this._return=[];var b=""+this._get("method"),c=this,v=this.getContext();if(b&&b.length){var m=function(){var a=new Function("{"+b+"}"),h=c.getArgs()||[];try{var d=a.apply(v,h||{});c._lastResult=
d;n&&n("Expression "+b+" evaluates to "+d);if("false"!==d&&!1!==d)c.onSuccess(c,l,{result:d});else return c.onFailed(c,l),[]}catch(m){return f&&f("invalid expression : \n"+b+": "+m),c.onFailed(c,l),[]}};if(a.global)(function(){window=a.global;var d=c.getArgs()||[];try{var m=null,m=v.runExpression?v.runExpression(b,null,d):(new Function("{"+b+"}")).bind(this).apply(v,d||{});c._lastResult=m;n&&n("Expression "+b+" evaluates to "+m);if("false"!==m&&!1!==m)c.onSuccess(c,l);else return c.onFailed(c,l),
[]}catch(t){return c._lastResult=null,f&&f("invalid expression : \n"+b+": "+t),c.onFailed(c,l),[]}}).call(a.global);else return m()}else d.error("have no script");m=this[this._getContainer()];if(m.length)this.runFrom(m,0,l);else this.onSuccess(this,l);this.onDidRun();return[]},solve:function(a,l,n,f,b,d){this._currentIndex=0;this._return=[];l=l||{};n=f||(this._get("method")?this._get("method"):this.method);var c=this;f=this.getContext();var m=this[this._getContainer()],t=new q,p=c.deferred;this.onRunThis(l);
var k=a.expressionModel.replaceVariables(a,n,null,null),e=a.expressionModel.expressionCache[k];e||(e=a.expressionModel.expressionCache[k]=new Function("{"+k+"}"));a=c.getArgs(l)||[];try{p&&(f.resolve=function(a){c._deferredObject&&c._deferredObject.resolve();c.onDidRunThis(t,a,m,l)});var x=e.apply(f,a||{});c._lastResult=x;b&&b("Expression "+n+" evaluates to "+x);if(!p)c.onDidRunThis(t,x,m,l);if("false"!==x&&!1!==x)c.onSuccess(c,l);else c.onFailed(c,l)}catch(y){y=y||{},c.onDidRunItemError(t,y,l),c.onFailed(c,
l),d&&d("invalid expression : \n"+n+": "+y)}return t},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.name+" :: \x3c/span\x3e";this.method&&(a+=this.method.substr(0,50));return a},canAdd:function(){return[]},getFields:function(){"No Description"===this.description&&(this.description=x);var a=this.inherited(arguments)||this.getDefaultFields(),l=this;a.push(c.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));a.push(c.createCI("deferred",0,this.deferred,
{group:"General",title:"Deferred",dst:"deferred"}));a.push(c.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(c.createCI("value",m.ECIType.EXPRESSION_EDITOR,this.method,{group:"Script",title:"Script",dst:"method",select:!0,widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!0,autoFocus:!1},item:this},delegate:{runExpression:function(a,h,b){l.method=a;l.solve(l.scope,null,h,b)}}}));return a}})})},"xblox/model/Contains":function(){define(["dcl/dcl",
"dojo/promise/all","xide/types"],function(g,r,q){return g(null,{declaredClass:"xblox.model.Contains",runByType:function(e,c){var b=this.getItemsByType(e);b.length&&this.runFrom(b,0,c)},getItemsByType:function(e){var c=this.items;if(!e)return c;var b=[];_.each(c,function(a){a.outlet&e&&b.push(a)});return b},getContainer:function(){return this[this._getContainer()]},mayHaveChildren:function(e){e=this[this._getContainer()];return null!=e&&0<e.length},getChildren:function(e){return this[this._getContainer()]},
canAdd:function(){return[]},runFrom:function(e,c,b){var a=this,m=e||this.items;e=[];var t=function(c){c._deferredObject.then(function(t){c._lastResult=c._lastResult||t;a._currentIndex++;a.runFrom(m,a._currentIndex,b)})};if(m.length)for(;c<m.length;c++){var k=m[c];if(!0===k.deferred&&k.enabled){k._deferredObject=new Deferred;this._currentIndex=c;t(k);var p=k.solve(this.scope,b);e.push(p);break}else k.enabled&&(p=k.solve(this.scope,b),e.push(p),k.onDidRun())}else this.onSuccess(this,b);this._lastSettings&&
delete this._lastSettings.override;return e},_solve:function(e,c,b,a){!this._lastRunSettings&&c&&(this._lastRunSettings=c);c=this._lastRunSettings||c;this._currentIndex=0;this._return=[];e=this[this._getContainer()];if(e.length)return e=this.runFrom(e,0,c),this.onSuccess(this,c),e;this.onSuccess(this,c);return[]},onDidRunItem:function(e,c,b){this._emit(q.EVENTS.ON_RUN_BLOCK_SUCCESS,this);e.resolve(c)},onDidRunItemError:function(e,c,b){e.reject(c)},onRunThis:function(e){this._emit(q.EVENTS.ON_RUN_BLOCK,
this)},onDidRunThis:function(e,c,b,a){var m=this;if(b&&b.length)b=m.runFrom(b,0,a),r(b).then(function(b){m.onDidRunItem(e,c,a)},function(b){console.error("error in chain",b);m.onDidRunItem(e,b,a)});else m.onDidRunItem(e,c,a)},___solve:function(e,c,b,a){}})})},"xblox/model/code/RunBlock":function(){define(["dcl/dcl","xblox/model/Block","xide/types","xide/utils"],function(g,r,q,e){return g(r,{declaredClass:"xblox.model.code.RunBlock",name:"Run Block",file:"",method:"",args:"",sharable:!0,block:"",description:"Runs another Block",
solve:function(c,b){var a=this.getContext();if(a&&null!=a[this.method]){var m=[],t=a[this.method];try{var k=this._getArgs(),m=t.apply(a,k||[]);this.onSuccess(this,b);return m}catch(p){console.error("call method failed"),this.onFailed(this,b)}}else this.onFailed(this,b);return[]},toText:function(){var c=this.getBlockIcon()+" "+this.name+" ";this.method&&(c+=this.method.substr(0,20));return c},getFields:function(){var c=this.getDefaultFields();c.push(e.createCI("Block",q.ECIType.BLOCK_REFERENCE,this.block,
{toolTip:"Enter  block, you can use also the block's share title",group:"General",dst:"block",value:this.block,title:"Block",scope:this.scope}));c.push(e.createCI("File",q.ECIType.FILE,this.file,{toolTip:"Leave empty to auto-select this file",group:"General",dst:"file",value:this.file,intermediateChanges:!1,acceptFolders:!1,acceptFiles:!0,encodeFilePath:!1,buildFullPath:!0,filePickerOptions:{dialogTitle:"Select Block File",filePickerMixin:{beanContextName:this.id,persistent:!1,globalPanelMixin:{allowLayoutCookies:!1}},
configMixin:{beanContextName:this.id,LAYOUT_PRESET:q.LAYOUT_PRESET.SINGLE,PANEL_OPTIONS:{ALLOW_MAIN_MENU:!1,ALLOW_NEW_TABS:!0,ALLOW_MULTI_TAB:!1,ALLOW_INFO_VIEW:!0,ALLOW_LOG_VIEW:!1,ALLOW_CONTEXT_MENU:!0,ALLOW_LAYOUT_SELECTOR:!0,ALLOW_SOURCE_SELECTOR:!0,ALLOW_COLUMN_RESIZE:!0,ALLOW_COLUMN_REORDER:!0,ALLOW_COLUMN_HIDE:!0,ALLOW_ACTION_TOOLBAR:!0,ALLOW_BREADCRUMBS:!1}},defaultStoreOptions:{fields:1663,includeList:"xblox",excludeList:"*"},startPath:this.file}}));return c},getBlockIcon:function(){return'\x3cspan class\x3d"el-icon-share-alt"\x3e\x3c/span\x3e'}})})},
"xblox/model/loops/ForBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/variables/Variable xblox/model/Contains dojo/promise/all dojo/Deferred".split(" "),function(g,r,q,e,c,b){return g([r,e],{declaredClass:"xblox.model.loops.ForBlock",initial:null,"final":null,comparator:null,modifier:null,items:null,counterName:null,_counter:null,name:"For",sharable:!0,icon:"",ignoreErrors:!1,deferred:!0,_forState:!1,_currentForIndex:0,runFrom:function(a,c,t){var k=this,p=a||this.items;a=[];var e=
function(a){a._deferredObject.then(function(h){a._lastResult=a._lastResult||h;k._currentIndex++;k.runFrom(p,k._currentIndex,t)})};if(p.length)for(;c<p.length;c++){var y=p[c];if(!1!==y.enabled)if(!0===y.deferred){y._deferredObject=new b;this._currentIndex=c;e(y);y=y.solve(this.scope,t);a.push(y);break}else y=y.solve(this.scope,t),a.push(y)}else this.onSuccess(this,t);return a},runFromDirect:function(a,c,t){var k=this,p=a||this.items;a=[];var e=function(a){a._deferredObject.then(function(h){a._lastResult=
a._lastResult||h;k._currentIndex++;k.runFrom(p,k._currentIndex,t)})};if(p.length)for(;c<p.length;c++){var y=p[c];if(!1!==y.enabled)if(!0===y.deferred){y._deferredObject=new b;this._currentIndex=c;e(y);y=y.solve(this.scope,t);a.push(y);break}else y=y.solve(this.scope,t),a.push(y)}else this.onSuccess(this,t);return a},solveSubs:function(a,b,t,k){var p=this;k.override=k.override||{};k.override.args=[this._currentForIndex];if(t.length)return b=p.runFrom(t,0,k),c(b).then(function(a){},function(b){console.error("error in chain",
b);p.onDidRunItem(a,b,k)}),b;p.onDidRunItem(a,b,k)},solveSubsDirect:function(a,b,c,k){k.override=k.override||{};k.override.args=[this._currentForIndex];if(c.length)return this.runFromDirect(c,0,k)},_solve:function(a,m){var t=new b,k=this,p=this.solveSubs(t,null,this.items,m);p?c(p).then(function(a){a=a.indexOf(!1);!0!==k.ignoreErrors&&-1!==a?t.resolve(!1):t.resolve(!0)}):t.resolve(!0);return t},step:function(a,c){var t=this._checkCondition(a,c),k=new b;t&&this._solve(a,c).then(function(a){1==a?k.resolve(!0):
k.resolve(!1)});return k},loop:function(a,b){var c=this;this.step(a,b).then(function(k){c._updateCounter(a);c._currentForIndex=c._counter.value;if(1==k)c.loop(a,b);else c.onFailed(c,b)})},_solveDirect:function(a,b){return this.solveSubsDirect(null,null,this.items,b)},stepDirect:function(a,b){return this._solveDirect(a,b)},loopDirect:function(a,b){this.stepDirect(a,b);for(var c=parseInt(this.initial);c<parseInt(this["final"]);c++)this.stepDirect(a,b)},solve:function(a,b){this._counter=new q({title:this.counterName,
value:this.initial,scope:a,register:!1});this._forState=!0;this._currentForIndex=this.initial;this.deferred?this.loop(a,b):this.loopDirect(a,b);return[]},_checkCondition:function(a,b){var c=a.parseExpression(""+this._counter.value+this.comparator+this["final"]);if(0!=c)this.onSuccess(this,b);return this._forState=c},_updateCounter:function(a){var b=this._counter.value,b=a.parseExpression(""+b+this.modifier);if(b==this._counter.value)return!1;this._counter.value=b;return!0},mayHaveChildren:function(a){return null!=
this.items&&0<this.items.length},getChildren:function(a){a=[];this.items&&(a=a.concat(this.items));return a},canAdd:function(){return[]},toText:function(){return this.getBlockIcon("F")+this.name+" "+this.initial+" "+this.comparator+" "+this["final"]+" with "+this.modifier},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();return a=a.concat([this.utils.createCI("initial",13,this.initial,{group:"General",title:"Initial",dst:"initial"}),this.utils.createCI("Final",13,this["final"],
{group:"General",title:"Final",dst:"final"}),this.utils.createCI("comparator",13,this.comparator,{group:"General",title:"Comparision",dst:"comparator"}),this.utils.createCI("modifier",13,this.modifier,{group:"General",title:"Modifier",dst:"modifier"}),this.utils.createCI("Abort on Error",0,this.ignoreErrors,{group:"General",title:"Ignore Errors",dst:"ignoreErrors"}),this.utils.createCI("Deferred",0,this.deferred,{group:"General",title:"Use Deferred",dst:"deferred"})])}})})},"xblox/model/variables/Variable":function(){define(["dcl/dcl",
"xide/types","xblox/model/Block"],function(g,r,q){return g(q,{declaredClass:"xblox.model.variables.Variable",name:null,value:null,register:!0,readOnly:!1,initial:null,isVariable:!0,flags:4096,getValue:function(){return this.value},canDisable:function(){return!1},canMove:function(){return!1},getIconClass:function(){return"el-icon-quotes-alt"},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e '},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon()+
this.makeEditable("name","right","text","Enter a unique name","inline")+"\x3c/span\x3e"},solve:function(){this.scope.parseExpression(this.getValue(),!0);return[]},getFields:function(){var e=this.getDefaultFields(),c=this;e.push(this.utils.createCI("title",r.ECIType.STRING,this.name,{group:"General",title:"Name",dst:"name"}));e.push(this.utils.createCI("value",r.ECIType.EXPRESSION,this.value,{group:"General",title:"Value",dst:"value",delegate:{runExpression:function(b,a,m){return c.scope.expressionModel.parse(c.scope,
b,!1,a,m)}}}));return e}})})},"xblox/model/loops/WhileBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/variables/Variable"],function(g,r,q){return g(r,{declaredClass:"xblox.model.loops.WhileBlock",condition:null,items:null,loopLimit:1500,name:"While",wait:0,_currentIndex:0,sharable:!0,icon:"",_timer:null,canAdd:function(){return[]},_solve:function(e,c){for(var b=0;b<this.items.length;b++)this.items[b].solve(e,c);return[]},doStep:function(e){if(this._currentIndex<this.loopLimit){var c=
[];this._checkCondition(this.scope)?(this.onSuccess(this,e),this.addToEnd(c,this._solve(this.scope,e)),this._currentIndex++):(this._timer&&clearInterval(this._timer),this.onFailed(this,e))}else console.error("--while block : reached loop limit"),this.reset()},reset:function(){this._timer&&(clearTimeout(this._timer),this._timer=null);this._currentIndex=0},solve:function(e,c){this.loopLimit=1500;c=c||{};var b=0,a=this,m=this._getArg(this.wait);this.reset();if(0<m)return this._timer=setInterval(function(){a.doStep(c)},
m),[];for(;this._checkCondition(e)&&b<this.loopLimit;)this._solve(e,c),b++;this.reset();return[]},toText:function(){return this.getBlockIcon("G")+this.name+" "+this.condition},_checkCondition:function(e){return e.parseExpression(this.condition)},mayHaveChildren:function(e){return null!=this.items&&0<this.items.length},getChildren:function(e){e=[];this.items&&(e=e.concat(this.items));return e},getFields:function(){var e=this,c=this.inherited(arguments)||this.getDefaultFields();c.push(this.utils.createCI("condition",
25,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(b,a,c){return e.scope.expressionModel.parse(e.scope,b,!1,a,c)}}}));c.push(this.utils.createCI("wait",13,this.wait,{group:"General",title:"Wait",dst:"wait"}));return c}})})},"xblox/model/variables/VariableAssignmentBlock":function(){define("dcl/dcl xblox/model/Block xide/utils xide/types dstore/legacy/DstoreAdapter xide/factory xdojo/has".split(" "),function(g,r,q,e,c,b,a){return g(r,{declaredClass:"xblox.model.variables.VariableAssignmentBlock",
variable:null,value:null,name:"Set Variable",icon:"",hasInlineEdits:!0,flags:4,toText:function(){var a=this.scope.getVariableById(this.variable),a=a?a.name:"";this.variable&&-1!==this.variable.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.variable)+"\x3c/span\x3e");return this.getBlockIcon("C")+this.name+" "+a+"\x3cspan class\x3d'text-muted small'\x3e to \x3ckbd class\x3d'text-warning'\x3e"+this.makeEditable("value","bottom","text","Enter the string to send",
"inline")+"\x3c/kbd\x3e\x3c/span\x3e"},_getPreviousResult:function(){var a=null;return(a=(a=this.getPreviousBlock())&&a._lastResult&&a.enabled?a:this.getParent())&&null!=a._lastResult?(this.isArray(a._lastResult),a._lastResult):null},solve:function(a,c){var k=this.value,p=!1;if(!k){var x=this.getArgs();0<x.length&&(k=x[0])}if(this.variable&&null!==k){this.onRun(this,c);var y=-1!==this.variable.indexOf("://")?this.scope.resolveBlock(this.variable):a.getVariableById(this.variable),x=this._getArg(k),
d=this.getArgs(c)||[];if(!y)return[];var h=null;this.isScript(x)?(h=this.override||{},h=a.parseExpression(k,null,null,null,null,null,d||h.args),h=this.replaceAll("'","",h),y.value!==h&&(p=!0)):(d&&1==d.length&&(x=d[0]),y.value!==x&&(p=!0),h=y.value=x);y.set("value",h);k=!1;this.getContext();this.flags&e.VARIABLE_FLAGS.PUBLISH&&p&&(k=!0);p&&b.publish(e.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:y,scope:this.scope,save:!1,block:this,name:y.name,value:x,publish:k,result:h});this.onSuccess(this,c);return[]}},
canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(!1),b=this;a.push(this.utils.createCI("value",29,this.value,{group:"General",title:"Value",dst:"value",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!1,autoSelect:!1,autoFocus:!1,hasConsole:!1,hasItemActions:function(){return!1}},item:this},delegate:{runExpression:function(a,c,e){return b.scope.expressionModel.parse(b.scope,a,!1,c,e)}}}));a.push(q.createCI("value",
"xcf.widgets.CommandPicker",this.variable,{group:"Variable",title:"Variable",dst:"variable",block:this,pickerType:"variable",value:this.variable,widget:{store:this.scope.blockStore,labelField:"name",valueField:"id",value:this.variable,query:[{group:"basicVariables"},{group:"processVariables"}]}}));a.push(this.utils.createCI("flags",5,this.flags,{group:"Variable",title:"Flags",dst:"flags",data:[{value:2,label:"Publish to network",title:"Publish to network in order to make a network variable"},{value:4,
label:"Publish if server",title:"Publish only on network if this is running server side"}],widget:{hex:!0}}));return a}})})},"xblox/model/logic/IfBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/Statement xblox/model/logic/ElseIfBlock dojo/Deferred xide/utils".split(" "),function(g,r,q,e,c,b){return g(r,{declaredClass:"xblox.model.logic.IfBlock",condition:"Invalid Expression",consequent:null,elseIfBlocks:null,alternate:null,canAdd:function(){return[]},autoCreateElse:!0,name:"if",icon:"",
add:function(a,b,c){null==c&&(c="consequent");return this._add(a,b,c,!1)},__addToStore:function(a){a.put(this)},mayHaveChildren:function(a){return null!==this.items&&this.items.length||null!==this.elseIfBlocks&&this.elseIfBlocks.length||null!=this.consequent&&this.consequent.length||null!=this.alternate&&this.alternate.length},getChildren:function(a){a=[];this.consequent&&(a=a.concat(this.consequent));this.elseIfBlocks&&(a=a.concat(this.elseIfBlocks));this.alternate&&(a=a.concat(this.alternate));
return a},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon("E")+this.name+" \x3c/span\x3e\x3cspan class\x3d'text-warning small'\x3e"+this.condition+"\x3cspan\x3e"},_checkCondition:function(a){return a.parseExpression(this.condition,null,null)},solve:function(a,b){var c=this._checkCondition(a),k=this.getElseIfBlocks(),p=this.childrenByNotClass(e),x=null,p=p.filter(function(a){return!a.isInstanceOf(q)});if(1==c||0<c){this.onSuccess(this,b);if(p&&p.length)for(k=0;k<p.length;k++)x=
p[k].solve(a,b);return x}x=!1;this.onFailed(this,b);if(k)for(p=0;p<k.length&&!x;p++){c=k[p];if(c._checkCondition(a))return c.onSuccess(c,b),x=!0,c.solve(a,b);c.onFailed(c,b)}p=this.childrenByClass(q);if(0<p.length&&!x){x=null;for(k=0;k<p.length;k++)x=p[k].solve(a,b);return x}return[]},empty:function(a){this._empty(this.alternate);this._empty(this.consequent);this._empty(this.elseIfBlocks)},removeBlock:function(a){a&&(a&&a.empty&&a.empty(),delete a.items,a.parent=null,this.alternate.remove(a),this.consequent.remove(a),
this.elseIfBlocks.remove(a))},_getContainer:function(a){return-1!=this.consequent.indexOf(a)?"consequent":-1!=this.alternate.indexOf(a)?"alternate":-1!=this.elseIfBlocks.indexOf(a)?"elseIfBlocks":"_"},init:function(){this.alternate=this.alternate||[];this.consequent=this.consequent||[];this.elseIfBlocks=this.elseIfBlocks||[];for(var a=0;a<this.alternate.length;a++)this.alternate[a].parentId=this.id,this.alternate[a].parent=this;for(a=0;a<this.elseIfBlocks.length;a++)this.elseIfBlocks[a].parentId=
this.id,this.elseIfBlocks[a].parent=this;for(a=0;a<this.consequent.length;a++)this.consequent[a].parentId=this.id,this.consequent[a].parent=this},getFields:function(){var a=this,b=this.inherited(arguments)||this.getDefaultFields();b.push(this.utils.createCI("condition",this.types.ECIType.EXPRESSION_EDITOR,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(b,c,p){return a.scope.expressionModel.parse(a.scope,b,!1,c,p)}}}));return b},postCreate:function(){this._postCreated||
(this._postCreated=!0)},toCode:function(a,b){},getElseIfBlocks:function(){return this.childrenByClass(e)},runAction:function(a){var m=this.scope.blockStore;a=a.command;if("New/Else"===a||"New/Else If"===a){a="New/Else If"===a?e:q;var t=b.mixin({name:"else",items:[],dstField:"alternate",parentId:this.id,parent:this,scope:this.scope,canAdd:function(){return[]},canEdit:function(){return!1}},a==e?{name:"else if",dstField:"elseIfBlocks"}:{name:"else",dstField:"alternate"});a=this.add(a,t,a==q?"alternate":
"elseIfBlocks");var t={select:[a],focus:!0,append:!1,expand:!0,delay:10},k=new c;m._emit("added",{target:a});k.resolve(t);a.refresh();return k}},getActions:function(){var a=[];0==this.alternate.length&&a.push(this.createAction({label:"Else",command:"New/Else",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0}}));a.push(this.createAction({label:"Else If",command:"New/Else If",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0}}));
return a}})})},"xblox/model/Statement":function(){define(["dcl/dcl","xblox/model/Block"],function(g,r){return g(r,{declaredClass:"xblox.model.Statement",toText:function(){return this.name},getChildren:function(){return this.items}})})},"xblox/model/logic/ElseIfBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/Contains"],function(g,r,q){return g([r,q],{declaredClass:"xblox.model.logic.ElseIfBlock",condition:"",consequent:null,name:"else if",icon:"",solve:function(e,c){return this._checkCondition(e)?
this._solve(e,c):!1},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon("E")+this.name+" \x3c/span\x3e\x3cspan class\x3d'text-warning small'\x3e"+(this.condition||"")+"\x3cspan\x3e"},_checkCondition:function(e){return null!==this.condition?e.parseExpression(this.condition):!1},getFields:function(){var e=this,c=this.inherited(arguments)||this.getDefaultFields();c.push(this.utils.createCI("condition",this.types.ECIType.EXPRESSION_EDITOR,this.condition,{group:"General",
title:"Expression",dst:"condition",delegate:{runExpression:function(b,a,c){return e.scope.expressionModel.parse(e.scope,b,!1,a,c)}}}));return c}})})},"xblox/model/logic/SwitchBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/logic/CaseBlock","xblox/model/logic/DefaultBlock","dojo/Deferred"],function(g,r,q,e,c){return g(r,{declaredClass:"xblox.model.logic.SwitchBlock",items:null,name:"Switch",icon:null,toText:function(){return this.getBlockIcon("H")+this.name+" "},canAdd:function(){return[]},
getFields:function(){return this.getDefaultFields(!1,!1)},solve:function(b,a){var c=this._stopped=!1,e=[];this.onSuccess(this,a);for(var k=0;k<this.items.length;k++){var p=this.items[k];if("xblox.model.logic.CaseBlock"===p.declaredClass&&(p=p.solve(b,this,a),0!=p)){c=!0;this.addToEnd(e,p);break}if(this._stopped)break}if(!c)for(k=0;k<this.items.length;k++)p=this.items[k],"xblox.model.logic.CaseBlock"!=p.declaredClass&&this.addToEnd(e,p.solve(b,a));return e},init:function(){},getChildren:function(b){return this.items},
stop:function(){this._stopped=!0},runAction:function(b){var a=b.command;if("New/Case"===a||"New/Default"===b.command){b=this.scope.blockStore;var m=new c,t=null;switch(a){case "New/Case":t=this.add(q,{comparator:"\x3d\x3d",expression:"on",group:null});break;case "New/Default":t=this.add(e,{group:null})}m.resolve({select:[t],focus:!0,append:!1});t.refresh();b._emit("added",{target:t})}},getActions:function(b,a){var c=[this.createAction({label:"New Case",command:"New/Case",icon:this.getBlockIcon("I"),
tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}})];_.find(this.items,{declaredClass:"xblox.model.logic.DefaultBlock"})||c.push(this.createAction({label:"Default",command:"New/Default",icon:"fa-eject",tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}}));return c}})})},"xblox/model/logic/DefaultBlock":function(){define(["dcl/dcl","xide/utils","xide/types","xblox/model/Block"],function(g,r,q,e){return g(e,{declaredClass:"xblox.model.logic.DefaultBlock",name:"Default",
icon:"",hasInlineEdits:!1,toText:function(){return'\x26nbsp;\x3cspan class\x3d"fa-eject text-info"\x3e\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan\x3e'+this.name+"\x3c/span\x3e"},solve:function(c,b){this.onSuccess(this,b);return this._solve(c,b)},getFields:function(){return this.inherited(arguments)||this.getDefaultFields()}})})},"xblox/model/variables/VariableSwitch":function(){define("dcl/dcl xblox/model/logic/SwitchBlock xide/types xblox/model/logic/CaseBlock xblox/model/logic/DefaultBlock dojo/Deferred".split(" "),
function(g,r,q,e,c,b){return g(r,{declaredClass:"xblox.model.variables.VariableSwitch",name:"Switch on Variable",icon:"",variable:"PowerState",toText:function(){var a=this.scope.getVariableById(this.variable),a=a?a.name:"";return this.getBlockIcon("H")+this.name+" "+a},getFields:function(){var a=this.getDefaultFields(!1,!1);return a=a.concat([this.utils.createCI("Variable",3,this.variable,{group:"General",widget:{store:this.scope.blockStore,labelField:"name",valueField:"id",query:[{group:"basicVariables"},
{group:"processVariables"}]},dst:"variable"})])}})})},"xblox/model/events/OnEvent":function(){define("dcl/dcl dojo/_base/lang dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xide/registry dojo/on xwire/_Base".split(" "),function(g,r,q,e,c,b,a,m,t,k,p){return g([e,a.dcl,m.dcl,p],{declaredClass:"xblox.model.events.OnEvent",name:"On Event",event:"",reference:"",references:null,sharable:!0,_didSubscribe:!1,filterPath:"item.name",filterValue:"",valuePath:"item.value",
_nativeEvents:"onclick ondblclick onmousedown onmouseup onmouseover onmousemove onmouseout onkeypress onkeydown onkeyup onfocus onblur onchange".split(" "),stop:function(){this._destroy()},solve:function(a,b,c,h){c&&this._destroy();b=this._lastSettings=b||this._lastSettings;if(!this._didSubscribe)return this._registerEvent(this.event),this.onSuccess(this,b),!1;this.onSuccess(this,b);this._currentIndex=0;this._return=[];a=this[this._getContainer()];if(a.length)return a=this.runFrom(a,0,b),this.onSuccess(this,
b),a;this.onSuccess(this,b);return[]},toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();this.deserialize(this.reference);var p=null;if(-1<c.contains(this._nativeEvents,this.event))for(var p=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},
{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],d=0;d<p.length;d++){var h=p[d];if(h.value===this.event){h.selected=!0;break}}else p=this.scope.getEventsAsOptions(this.event);a.push(c.createCI("Event",b.ECIType.ENUMERATION,
this.event,{group:"General",options:p,dst:"event",widget:{search:!0}}));a.push(c.createCI("Filter Path",13,this.filterPath,{group:"General",dst:"filterPath"}));a.push(c.createCI("Filter Value",13,this.filterValue,{group:"General",dst:"filterValue"}));a.push(c.createCI("Value Path",13,this.valuePath,{group:"General",dst:"valuePath"}));a.push(c.createCI("Object/Widget",b.ECIType.WIDGET_REFERENCE,this.reference,{group:"Widget",dst:"reference",value:this.reference}));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bell"\x3e\x3c/span\x3e'},
onEvent:function(a){this._lastResult=a;if(this.filterPath&&this.filterValue){var b=this.getValue(a,this.filterPath);if(b&&this.filterValue!==b)return}b=null;this.valuePath&&(this._lastSettings||(this._lastSettings={}),b=this.getValue(a,this.valuePath),null!==b&&(!this._lastSettings.override&&(this._lastSettings.override={}),this._lastSettings.override.args=[b]));this.solve(this.scope,this._lastSettings)},_subscribe:function(a,b,d){if(a)if(-1==c.contains(this._nativeEvents,a))this.__events&&this.__events[a]&&
(d=this.__events[a],_.each(d,function(a){this.unsubscribe(a.type,a.handler);a.remove()},this),_.each(d,function(l){this.__events[a].remove(l)},this)),this.subscribe(a,this.onEvent);else if(d){b=a.replace("on","");var h=this;d=k(d,b,function(a){h.onEvent(a)});this._events.push(d)}},_registerEvent:function(a){try{if(!a||!a.length)return;var b=this.resolveReference(this.deserialize(this.reference)),c=this;if(b&&b.length)for(var h=0;h<b.length;h++){var l=b[h];if(l&&l.id){var n=t.byId(l.id);if(n&&n.on){var f=
this.event.replace("on",""),w=n.on(f,r.hitch(this,function(a){c.onEvent(a)}));this._events.push(w)}else this._subscribe(a,this.onEvent,l)}else this._subscribe(a,this.onEvent,l)}else this._subscribe(a,this.onEvent)}catch(u){logError(u,"registering event failed")}this._didSubscribe=a},onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},updateEventSelector:function(a,c){var d=[];if(a&&a.length)for(var d=[{label:"onclick",value:"onclick"},
{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],h=0;h<d.length;h++){var l=d[h];if(l.value===
this.event){l.selected=!0;break}}else d=this.scope.getEventsAsOptions(this.event);for(h=0;h<c.length;h++)if(l=c[h],l.widget&&"Event"===l.widget.title){h=l._widget;h.nativeWidget.set("options",d);h.nativeWidget.reset();h.nativeWidget.set("value",this.event);this.publish(b.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this._destroy();this.reference=a;var c=this.resolveReference(this.deserialize(a));this.updateEventSelector(c,b);this._registerEvent(this.event)},onChangeField:function(a,
b,c){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=b,this._registerEvent(b)));if("reference"==a)this.onReferenceChanged(b,c);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){this._events||(this._events=[]);_.each(this._events,dojo.unsubscribe);this.unsubscribe(this.event,this.onEvent);this._lastResult=null;this._didSubscribe=!1}})})},"xblox/model/Referenced":function(){define(["dcl/dcl",
"dojo/_base/declare","xide/mixins/ReferenceMixin"],function(g,r,q){var e={reference:null,deserialize:function(c){if(!c||0==c.length)return{};try{return dojo.fromJson(c)}catch(b){return{}}}};r=r("xblox.model.Referenced",[q],e);r.dcl=g(q.dcl,e);return r})},"xblox/model/events/OnKey":function(){define("dcl/dcl dojo/_base/lang dojo/_base/array dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xblox/model/Contains xblox/model/events/OnEvent xide/registry dojo/on".split(" "),
function(g,r,q,e,c,b,a,m,t,k,p,x,y){return g([c,m.dcl,t.dcl,k],{declaredClass:"xblox.model.events.OnKey",name:"On Key",event:"",reference:"",references:null,description:"Triggers when a keyboard sequence "+this.event+" has been entered",listeners:null,sharable:!0,toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var c=this.inherited(arguments)||this.getDefaultFields();c.push(b.createCI("Keyboard Sequence",
a.ECIType.STRING,this.event,{group:"General",dst:"event",value:this.event,intermediateChanges:!1}));c.push(b.createCI("Object/Widget",a.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",value:this.reference}));return c},getBlockIcon:function(){return'\x3cspan class\x3d"fa-keyboard-o"\x3e\x3c/span\x3e'},onEvent:function(a){this._lastResult=a;this.solve(this.scope,this._lastRunSettings)},_addListerner:function(a,b,l){null==this.listeners&&(this.listeners=[]);var n=null,n=new window.keypress.Listener(l,
{is_unordered:!0,prevent_repeat:!1,prevent_default:!1,on_keyup:function(a){},on_keydown:function(a){},on_release:function(a){}});n.simple_combo(a,function(a){b&&b(arguments)});this.listeners.push(n)},_subscribe:function(a,b,l){a&&(l&&l.domNode&&(l=l.domNode),this._addListerner(a,b,l))},_registerEvent:function(a){if(a&&a.length){var b=this.resolveReference(this.deserialize(this.reference)),l=this;if(b&&b.length)for(var n=0;n<b.length;n++){var f=b[n];if(f&&f.id){var c=x.byId(f.id);c=null,this._subscribe(a,
function(){l.onEvent(arguments)},f)}else this._subscribe(a,function(){l.onEvent(arguments)},f)}else this._subscribe(a,function(){l.onEvent(arguments)})}},onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},destroy:function(){this.inherited(arguments)},updateEventSelector:function(b,h){var l=[];if(b&&b.length)for(var l=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",
value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],n=0;n<l.length;n++){var f=l[n];if(f.value===this.event){f.selected=!0;break}}else l=this.scope.getEventsAsOptions(this.event);for(n=0;n<h.length;n++)if(f=
h[n],f.widget&&"Event"===f.widget.title){n=f._widget;n.nativeWidget.set("options",l);n.nativeWidget.reset();n.nativeWidget.set("value",this.event);this.publish(a.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this._destroy();this.reference=a;this.resolveReference(this.deserialize(a));this._registerEvent(this.event)},onChangeField:function(a,b,l){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=b,this._registerEvent(b)));if("reference"==a)this.onReferenceChanged(b,l);this.inherited(arguments)},
activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){if(this.listeners)for(var a=0;a<this.listeners.length;a++){var b=this.listeners[a];b.stop_listening();var l=b.get_registered_combos();l&&b.unregister_many(l);b.reset()}this.listeners=[]},onFieldsRendered:function(a,b){}})})},"xblox/model/logging/Log":function(){define("dcl/dcl dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin".split(" "),function(g,
r,q,e,c,b){return g([q,b.dcl],{declaredClass:"xblox.model.logging.Log",name:"Log Message",level:"info",message:'return "Message: " + arguments[0];',_type:"XBlox",host:"this host",sharable:!0,toText:function(){var a="text-primary";switch(this.level){case "info":a="text-info";break;case "warn":a="text-warning";break;case "error":a="text-danger"}a=this.getBlockIcon()+" "+this.name+" : \x3cspan class\x3d'"+a+" small'\x3e  :: ";this.message&&(a+=this.message);return a+"\x3c/span\x3e"},_solveExpression:function(a,
b,c,k,p){if((a=""+a)&&a.length){a=e.convertAllEscapes(a,"none");var x=this.getArgs();try{var y=b.parseExpression(a,null,null,null,null,this,x);k&&k("Expression "+a+" evaluates to "+y);return y}catch(d){p&&p("invalid expression : \n"+a+": "+d),this.onFailed(this,c)}}else console.error("have no script");return a},solve:function(a,b,e,k){var p=new r,x=a.device;a=this._solveExpression(this.message,a,b,e,k);x={message:a,level:this.level,type:this._type,details:this.getArgs(),time:(new Date).getTime(),
data:{device:x?x.info:null},write:!0};this.onSuccess(this,b);p.resolve(a);try{this.publish(c.EVENTS.ON_SERVER_LOG_MESSAGE,x)}catch(y){this.onFailed(this,b)}return p},canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),b=this;a.push(e.createCI("Level",3,this.level,{group:"General",options:[{value:"info",label:"Info"},{value:"warn",label:"Warning"},{value:"error",label:"Error"},{value:"debug",label:"Debug"},{value:"help",label:"Help"},{value:"verbose",
label:"verbose"},{value:"silly",label:"Silly"}],dst:"level"}));a.push(e.createCI("message",25,this.message,{group:"General",title:"Message",dst:"message",delegate:{runExpression:function(a,c,p){b._solveExpression(a,b.scope,null,c,p)}}}));a.push(e.createCI("message",13,this._type,{group:"General",title:"Type",dst:"_type"}));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bug"\x3e\x3c/span\x3e'}})})},"xblox/model/html/SetStyle":function(){define("dcl/dcl xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced dojo/dom-attr dojo/dom-style dojo/_base/Color xide/registry".split(" "),
function(g,r,q,e,c,b,a,m,t,k){c={declaredClass:"xblox.model.html.SetStyle",name:"Set Style",reference:"",references:null,description:"Sets HTML Node Style Attribute",value:"",mode:1,sharable:!0,solve:function(a,b){var c=this.value;b=b||{};var d=b.override||this.override||{};d.variables&&(c=q.replace(c,null,d.variables,{begin:"{",end:"}"}));d.args&&null!==d.args[0]&&(c=q.replace(c,null,{value:d.args[0]},{begin:"{",end:"}"}));this.updateObjects(null,c,this.mode,b);this.onSuccess(this,b);this.onDidRun()},
toText:function(){var a=this.deserialize(this.reference),a=this.getBlockIcon()+" "+this.name+" :: on "+a.reference+" to"||"  to ";this.value&&(a+=" "+this.value);return a},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();a.push(q.createCI("Value",e.ECIType.DOM_PROPERTIES,this.value,{group:"General",dst:"value",value:this.value,intermediateChanges:!1}));a.push(q.createCI("Mode",e.ECIType.ENUMERATION,this.mode,{group:"General",options:[q.createOption("Set",1),q.createOption("Add",
2),q.createOption("Remove",3),q.createOption("Increase",4),q.createOption("Decrease",5)],dst:"mode"}));var b={group:"General",dst:"reference",value:this.reference};this.scope&&(this.scope.global&&(b.window=this.scope.global,b.allowHTMLNodes=!0,b.allowWidgets=!1),this.scope.document&&(b.document=this.scope.document));a.push(q.createCI("Target",e.ECIType.WIDGET_REFERENCE,this.reference,b));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-paint-brush"\x3e\x3c/span\x3e'},updateEventSelector:function(a,
b){var c=[];if(a&&a.length)for(var c=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",
value:"onchange"}],d=0;d<c.length;d++){var h=c[d];if(h.value===this.event){h.selected=!0;break}}else c=this.scope.getEventsAsOptions(this.event);for(d=0;d<b.length;d++)if(h=b[d],h.widget&&"Event"===h.widget.title){d=h._widget;d.nativeWidget.set("options",c);d.nativeWidget.reset();d.nativeWidget.set("value",this.event);this.publish(e.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b,c){this.reference=a;this.references=this.resolveReference(this.deserialize(a),c);this.updateObjects(this.references,
this.value,null,c)},getPropValue:function(a,b){for(var c in a)if(c===b)return a[c];return null},_getStyle:function(a,b,c){switch(a){case "height":return c.outerHeight();case "width":return c.outerWidth();case "color":return c.css("color");case "border-color":return c.css("border-color")||"rgba(0,0,0,0)"}return null},updateObject:function(b,c,e,d){if(!b)return!1;e=e||1;(d=b.id?k.byId(b.id):null)&&(b=d);null!=b.domNode&&(b=b.domNode);d=a.get(b,"style");";"===d&&(d="");""===d&&(d=null!=b.lastStyle?b.lastStyle:
c);";"===d&&(d=c);switch(e){case 1:var h=this._toObject(d);c=c.split(";");for(d=0;d<c.length;d++)e=c[d].split(":"),2==e.length&&(h[e[0]]=e[1]);d=[];for(var l in h)d.push(l+":"+h[l]);$(b).attr("style",d.join(";"));break;case 2:c=_.uniq((d+";"+c).split(";")).join(";");a.set(b,"style",c);break;case 3:a.set(b,"style",q.replaceAll(c,"",d));break;case 4:case 5:l=new RegExp(/(\D*)(-?)(\d+)(\D*)/);e=this._toObject(c);var n={},f=$(b);if(e)for(h in e)d=this._getStyle(h,b,f),n[h]=d;f={};for(h in e){var w=""+
h.trim();if(null!=n[w]){var u=e[h],v=n[h],g=-1!=u.indexOf("#"),B=-1!=u.indexOf("rgb"),r=-1!=u.indexOf("rgba");if(g||B||r){var C=dojo.colorFromString(u);dojo.colorFromString(u);var D=dojo.colorFromString(v),A=new t;_.each(["r","g","b","a"],function(a){A[a]=Math.min(D[a]+C[a],"a"==a?1:255)});w="";g?w=A.toHex():B?w=A.toCss(!1):r&&(w=A.toCss(!0));f[h]=w;m.set(b,h,w)}else(g=l.exec(n[w]))&&3<=g.length&&parseInt(g[3])}}d=this._toObject(d);this._toObject(c);if(!d)return!1;for(h in d)w=""+h.trim();this._toStyleString(f)}},
onDomStyleChanged:function(a,b,c,d){if(a=a||this.resolveReference(this.deserialize(this.reference),d))for(var h=0;h<a.length;h++){var l=a[h];l&&l.id&&-1!=l.id.indexOf("davinci")||this.updateObject(l,b,c,d)}},updateObjects:function(a,b,c,d){a=a||this.resolveReference(this.deserialize(this.reference),d);this.onDomStyleChanged(a,b,c,d)},onChangeField:function(a,b,c){this._destroy();"mode"==a&&b!==this.mode&&(this.mode=b);"value"==a&&b!==this.value&&(this.onDomStyleChanged(null,b,this.mode),this.value=
b);if("reference"==a)this.onReferenceChanged(b,c);this.inherited(arguments)},activate:function(){this._destroy()},deactivate:function(){this._destroy()},_destroy:function(){},_changeValue:function(a,b){if(!a)return"";for(var c=a.split(" "),d="",h=0;h<c.length;h++){0<h&&(d+=" ");var l=c[h].match(/([-\d\.]+)([a-zA-Z%]*)/);if(l)if(1==l.length)d+=l[0];else for(var n=1;n<l.length;n++)d=isNaN(l[n])||""==l[n]?d+l[n]:d+(parseFloat(l[n])+b);else d+=c[h]}return d},_toObject:function(a){if(!a)return{};var b=
{};a=a.split(";");for(var c=0;c<a.length;c++){var d=a[c];if(d&&0!=d.length&&d.split){var h=d.split(":");h&&h.length&&(h=d.substring(0,d.indexOf(":")),d=d.substring(d.indexOf(":")+1,d.length),b[h]=d)}}return b},_toStyleString:function(a){var b=[],c;for(c in a)b.push(c+":"+a[c]);return b.join(";")+";"}};g=g([r,b.dcl],c);g.Impl=c;return g})},"xblox/model/html/SetCSS":function(){define("dojo/_base/declare dojo/_base/lang xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Targeted xide/registry".split(" "),
function(g,r,q,e,c,b,a,m){return g("xblox.model.html.SetCSS",[q,b,a],{name:"Set CSS",file:"",reference:"",references:null,description:"Sets HTML Node CSS",solve:function(a,b){this.onSuccess(this,b)},toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},getFields:function(){try{var a=this.inherited(arguments)||this.getDefaultFields();a.push(e.createCI("File",c.ECIType.FILE,this.file,{group:"General",dst:"file",value:this.file,intermediateChanges:!1,
acceptFolders:!1,acceptFiles:!0,encodeFilePath:!1,buildFullPath:!0,filePickerOptions:{dialogTitle:"Select CSS File",filePickerMixin:{beanContextName:"CSSFilePicker",persistent:!1,globalPanelMixin:{allowLayoutCookies:!1}},configMixin:{beanContextName:"CSSFilePicker",LAYOUT_PRESET:c.LAYOUT_PRESET.SINGLE,PANEL_OPTIONS:{ALLOW_MAIN_MENU:!1}},defaultStoreOptions:{fields:1663,includeList:"css",excludeList:"*"},startPath:this.file}}));a.push(e.createCI("Target",c.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",
dst:"reference",value:this.reference}))}catch(b){}return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-paint-brush"\x3e\x3c/span\x3e'},onReferenceChanged:function(a,b){this._destroy();this.reference=a;this.resolveReference(this.deserialize(a))},onChangeField:function(a,b,c){if("reference"==a)this.onReferenceChanged(b,c);this.inherited(arguments)},activate:function(){this._destroy()},deactivate:function(){this._destroy()},_destroy:function(){}})})},"xblox/model/Targeted":function(){define(["dojo/_base/declare",
"./Referenced"],function(g,r){return g("xblox.model.Targeted",[r],{})})},"xblox/manager/BlockManager":function(){define("dcl/dcl dojo/_base/lang dojo/has dojo/Deferred dojo/promise/all xide/types xide/utils xide/factory xblox/model/ModelBase xblox/model/Scope xblox/model/BlockModel xide/mixins/ReloadMixin xide/manager/ManagerBase xblox/data/Store xdojo/has!xblox-ui?xblox/manager/BlockManagerUI".split(" "),function(g,r,q,e,c,b,a,m,t,k,p,x,y,d,h){return g([h,y,x.dcl],{declaredClass:"xblox/manager/BlockManager",
serviceObject:null,loaded:{},scope:null,scopes:null,_createBlock:null,_registerActions:function(){},toScope:function(b){try{b=a.getJson(b)}catch(h){return console.error("BlockManager::toScope: failed,err\x3d"+h),null}b||(console.error("correct data"),b={blocks:[],variables:[]});var f=a.createUUID(),c=b;!r.isArray(b)&&r.isObject(b)&&(f=b.scopeId||f,c=b.blocks||[]);b=this.getScope(f,{owner:this},!0);c=b.blocksFromJson(c);for(f=0;f<c.length;f++)c[f]._lastRunSettings={force:!1,highlight:!0};b.serviceObject=
this.serviceObject;return b},loadFiles:function(a){for(var b=[],f=new e,h=0;h<a.length;h++){var d=a[h];b.push(this.load(d.mount,d.path,d.force))}c(b).then(function(a){f.resolve(a)});return f.promise},load:function(b,h,f){var c=new e,d=this,v=a.replaceAll("/","",b),k=a.replaceAll("./","",h),t=v+k,t=t.trim();this.loaded[t]&&!0===f&&(this.removeScope(this.loaded[t].id),this.loaded[t]=null);if(!0!==f&&this.loaded[t])return c.resolve(this.loaded[t]),c.promise;this.ctx.getFileManager().getContent(v,k,function(a){if(a=
d.toScope(a))d.loaded[t]=a,a.mount=b,a.path=h;c.resolve(a)},!1);return c.promise},onBlocksReady:function(a){for(var b=a.allBlocks(),f=0;f<b.length;f++)this.setScriptFunctions(b[f],a,this);if((a=a.getBlocks({group:"On Load"}))&&0<a.length)for(f=0;f<a.length;f++)if(b=a[f],b.onLoad)b.onLoad()},getBlock:function(){},setScriptFunctions:function(a,h,f){a.blockScope||(a.blockScope=h);h.serviceObject=this.serviceObject;a.setVariable||(a.setVariable=function(c,d,v,e,k){if(c=this.blockScope.getVariable(c))c.value=
d,!1!==e&&f.publish(b.EVENTS.ON_VARIABLE_CHANGED,{item:c,scope:h,driver:a,owner:f,save:!0===v,source:k||b.MESSAGE_SOURCE.BLOX})});a.getVariable||(a.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""})},hasScope:function(a){this.scopes||(this.scopes={});return this.scopes[a]?this.scopes[a]:null},getScope:function(a,h,f){this.scopes||(this.scopes={});if(!this.scopes[a]&&(this.scopes[a]=this.createScope({id:a,ctx:this.ctx}),this.scopes[a].userData=h,!1!==f))try{m.publish(b.EVENTS.ON_SCOPE_CREATED,
this.scopes[a])}catch(c){console.error("bad, scope creation failed "+c,c)}return this.scopes[a]},removeScope:function(a){this.scopes||(this.scopes={});for(var b in this.loaded)this.loaded[b].id==a&&delete this.loaded[b];try{this.scopes[a]&&(this.scopes[a]._destroy(),delete this.scopes[a])}catch(h){debugger}return null},createScope:function(b,h,f){h=h||[];var c=new d({data:[],Model:p,id:a.createUUID(),__events:{},observedProperties:["name","enabled","value"],getLabel:function(a){return a.name},labelAttr:"name"});
c.reset();c.setData([]);c={owner:this,blockStore:c,serviceObject:this.serviceObject,config:this.config};a.mixin(c,b);try{var u=new k(c);h&&u.initWithData(h,f);u.init()}catch(v){logError(v,"error creating scope, data:",b)}return u},onReloaded:function(){},init:function(){this.scope={variables:[],blocks:[]};t.prototype.types=b;t.prototype.factory=m;if(this.onReady)this.onReady()}})})},"xblox/model/Scope":function(){define("dcl/dcl ./ModelBase ./Expression xide/factory xide/utils xide/types xide/mixins/EventedMixin dojo/_base/lang dojo/has xide/encoding/MD5 xcf/model/Variable".split(" "),
function(g,r,q,e,c,b,a,m,t,k,p,x,y){var d=t("xcf-ui");r=g([r,a.dcl],{declaredClass:"xblox.model.Scope",variableStore:null,serviceObject:null,context:null,blockStore:null,expressionModel:null,start:function(){if(!0===this.__didStartBlocks)console.error("already started blocks");else{this.__didStartBlocks=!0;var a=this.getVariable("value");a||(a=new p({id:c.createUUID(),name:"value",value:"",scope:this,type:13,group:"processVariables",gui:!1,cmd:!1}),this.blockStore.putSync(a));var a=[],l=this.getBlocks({group:b.COMMAND_TYPES.INIT_COMMAND});
try{_.each(l,function(a){!1!==a.enabled&&!0!==a.__started&&(a.solve(scope),a.__started=!0)})}catch(n){console.error("starting init blocks failed",n)}a=a.concat(this.getBlocks({group:b.COMMAND_TYPES.BASIC_COMMAND}));for(l=0;l<a.length;l++){var f=a[l];f.enabled&&f.start&&f.startup&&!0!==f.__started&&(f.start(),f.__started=!0)}}},getExpressionModel:function(){this.expressionModel||(this.expressionModel=new q);return this.expressionModel},toFriendlyName:function(a,b){if(!b||!a)return null;var n=this,
f=this.ctx,d=this.driver,d=f.getDeviceManager(),u=f.getDriverManager();if(-1==b.indexOf("://"))return(n=n.getBlockById(b))?n.name:b;var f=c.parse_url(b),f=c.urlArgs(f.host),v=d.getItemById(f.device.value);if(v){var e=d.toDeviceControlInfo(v),d=u.getDriverById(e.driverId);if((v=v.driverInstance)||d)if(n=d.blockScope?d.blockScope:v?v.blockScope:n,(a=n.getStore().getSync(f.block.value))||v&&v.blockScope&&(a=v.blockScope.getBlock(f.block.value)))return e.title+"/"+a.name}return b},getContext:function(){return this.instance},
toString:function(){var a={blocks:null,variables:null},b=this.blocksToJson();try{dojo.fromJson(JSON.stringify(b))}catch(c){return}a.blocks=b;return JSON.stringify(a,null,2)},initWithData:function(a,b){a&&this.blocksFromJson(a,null,b);this.clearCache()},getService:function(){return this.serviceObject},getStore:function(){return this.blockStore},reset:function(){this.getExpressionModel().reset()},empty:function(){this.clearCache();var a=this.blockStore,b=this.getBlocks();a.silent(!0);_.each(b,function(b){b&&
a.removeSync(b.id)});a.setData([]);a.silent(!1)},fromScope:function(a){var b=this.blockStore;b.silent(!0);this.empty();a=a.blocksToJson();this.blocksFromJson(a);b.silent(!1)},clearCache:function(){this.getExpressionModel().reset()},getVariableStore:function(){return this.blockStore},getBlockStore:function(){return this.blockStore},getVariables:function(a){if(!this.blockStore)return[];var b=this.blockStore.data,c=[];if(a&&"processVariables"===a.group){for(a=0;a<b.length;a++)"processVariables"===b[a].group&&
c.push(b[a]);return c}if(!a){for(a=0;a<b.length;a++){var f=b[a],d=f.declaredClass;"xblox.model.variables.Variable"!=d&&"xcf.model.Variable"!=d||c.push(f)}return c}return this.blockStore.query(a)},loopBlock:function(a,b){1==a._destroyed&&console.error("block destroyed");var c=a.getInterval?a.getInterval():0;if(a&&0<c&&a.enabled&&!0!==a._destroyed){var f=this;a._loop&&clearInterval(a._loop);a._loop=setInterval(function(){!a.enabled||a._destroyed?(clearInterval(a._loop),a._loop=null):a.solve(f,b||a._lastSettings)},
c)}},getEventsAsOptions:function(a){var l=[],c;for(c in b.EVENTS)l.push({label:b.EVENTS[c],value:b.EVENTS[c]});l=l.concat([{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},
{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}]);for(c=0;c<l.length;c++){var f=l[c];if(f.value===a){f.selected=!0;break}}return l},getVariablesAsObject:function(){for(var a=this.getVariables(),b={},c=0;c<a.length;c++)b[a[c].title]=a[c].value;return b},getVariablesAsOptions:function(){var a=this.getVariables(),b=[];if(a)for(var c=0;c<a.length;c++)b.push({label:a[c].label,value:a[c].variable});return b},getCommandsAsOptions:function(a){var b=this.getBlocks({declaredClass:"xcf.model.Command"}),
c=[];if(b)for(var f=0;f<b.length;f++){var d={};d[a||"label"]=b[f].name;d.value=b[f].name;c.push(d)}return c},_cached:null,getBlocks:function(a,b){if(!d&&!1!==b&&(this._cached||(this._cached={}),a)){var c=k(JSON.stringify(a),1);if(c=this._cached[c])return c}if(!this.blockStore)return[];a=a||{id:/\S+/};var f=this.blockStore.query(a,null,b);d||!1===b||(c=k(JSON.stringify(a),1),this._cached[c]=f);return f},registerVariable:function(a){this.variables[a.title]=a;this.blockStore&&this.blockStore.putSync(a)},
getVariable:function(a){for(var b=this.getVariables(),c=0;c<b.length;c++){var f=b[c];if(f.name===a)return f}return null},getVariableById:function(a){if(!a)return null;var b=a.split("/"),c=this;2==b.length&&((a=c.owner)&&a.hasScope&&(a.hasScope(b[0])?c=a.getScope(b[0]):console.error("have scope id but cant resolve it",this)),a=b[1]);return(b=c.blockStore.getSync(a))?b:null},registerBlock:function(a,b){var c=this.blockStore;if(c){var f=c.getSync(a.id);if(f)return f;f=null;return f=a.addToStore?a.addToStore(c):
c.putSync(a,b)}},allBlocks:function(a,b){return this.getBlocks({},b)},hasGroup:function(a){for(var b=this.allGroups({},!1),c=0;c<b.length;c++)if(b[c]===a)return!0;return!1},allGroups:function(){for(var a=[],b=this.allBlocks({},!1),c=function(b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1},f=0;f<b.length;f++){var d=b[f];d.parentId||(d.group?c(d.group)||a.push(d.group):c("No Group")||a.push("No Group"))}return a},variablesToJson:function(){var a=[],b=this.variableStore?this.getVariables():
this.variables,c;for(c in b){var f=b[c];if(!1!==f.serializeMe&&null!=f.keys){var d={},u;for(u in f)if(this.isString(f[u])||this.isNumber(f[u])||this.isBoolean(f[u]))d[u]=f[u];a.push(d)}}return a},isScript:function(a){return this.isString(a)&&(-1!=a.indexOf("return")||-1!=a.indexOf(";")||-1!=a.indexOf("[")||-1!=a.indexOf("{")||-1!=a.indexOf("}"))},variablesToJavascriptEx:function(a,b){for(var c=[],f=this.variableStore?this.getVariables():this.variables,d=0;d<f.length;d++){var u=f[d];if(u!=a){var v=
""+u.value;a&&a.value&&-1==a.value.indexOf(u.title)||b&&-1==b.indexOf(u.title)||0==v.length||(this.isScript(v)||-1!=v.indexOf("'")?this.isScript(v)&&(v=this.expressionModel.parseVariable(this,u)):v="'"+v+"'","''"===v&&(v="'0'"),c.push(v))}}return c},variablesToJavascript:function(a,b){for(var c="",f=this.variableStore?this.getVariables():this.variables||[],d=0;d<f.length;d++){var u=f[d];if(u!=a){var v=""+u.value;a&&a.value&&-1==a.value.indexOf(u.title)||b&&-1==b.indexOf(u.title)||0==v.length||(this.isScript(v)||
-1!=v.indexOf("'")?this.isScript(v)&&(v=this.expressionModel.parseVariable(this,u)):v="'"+v+"'","''"===v&&(v="'0'"),c+="var "+u.title+" \x3d "+v+";",c+="\n")}}return c},variablesFromJson:function(a){for(var b=[],n=0;n<a.length;n++){var f=a[n];f.scope=this;if(f.declaredClass){var d=c.replaceAll(".","/",f.declaredClass);(d=require(d))&&b.push(new d(f))}}return b},regenerateIDs:function(a){for(var b=this,n=function(a){var f=c.createUUID(),h=b.getBlocks({parentId:a.id});if(h&&0<h.length)for(var d=0;d<
h.length;d++){var e=h[d];e.parentId=f;n(e)}a.id=f},f=0;f<a.length;f++)n(a[f])},cloneBlocks2:function(a,b){var n=this.blocksToJson(a),f=this.owner.getScope(c.createUUID(),null,!1),n=f.blocksFromJson(n,!1),d=this.blockStore,n=f.allBlocks();f.regenerateIDs(n);n=f.blocksToJson(n);if(b)for(f=0;f<n.length;f++){var u=n[f];null==u.parentId&&(u.group=b)}var v=[],n=this.blocksFromJson(n);_.each(n,function(a){v.push(d.getSync(a.id))});return v},cloneBlocks:function(a){a=this.blocksToJson(a);var b=this.owner.getScope(c.createUUID(),
null,!1);a=b.blocksFromJson(a,!1);a=b.allBlocks();for(b=0;b<a.length;b++){var n=a[b];n.id=c.createUUID();n.parentId=null}this.blocksToJson(a);this.blocksFromJson(a);return a},blockToJson:function(a){var b={_containsChildrenIds:[]},c;for(c in a)if("ctrArgs"!=c&&("function"===typeof a[c]||a.serializeField(c))){if(this.isString(a[c])||this.isNumber(a[c])||this.isBoolean(a[c]))b[c]=a[c];if("parent"!=c)if(this.isBlock(a[c]))b[c]=a[c].id,b._containsChildrenIds.push(c);else if(this.areBlocks(a[c])){b[c]=
[];for(var f=0;f<a[c].length;f++)b[c].push(a[c][f].id);b._containsChildrenIds.push(c)}}return b},blocksToJson:function(a){try{var b=[];a=a&&a.length?a:this.blockStore?this.getBlocks():this.blocks;for(var c in a){var f=a[c];if(null!=f.keys&&!1!==f.serializeMe){var d={_containsChildrenIds:[]},u;for(u in f)if("ctrArgs"!=u&&("function"===typeof f[u]||f.serializeField(u))){if(this.isString(f[u])||this.isNumber(f[u])||this.isBoolean(f[u]))d[u]=f[u];_.isObject(f[u])&&f.serializeObject&&!0===f.serializeObject(u)&&
(d[u]=JSON.stringify(f[u],null,2));if("parent"!=u)if(this.isBlock(f[u]))d[u]=f[u].id,d._containsChildrenIds.push(u);else if(this.areBlocks(f[u])){d[u]=[];for(var v=0;v<f[u].length;v++)d[u].push(f[u][v].id);d._containsChildrenIds.push(u)}}b.push(d)}}}catch(e){console.error("from json failed : "+e)}return b},_createBlockStore:function(){},blockFromJson:function(a){a.scope=this;null==a._containsChildrenIds&&(a._containsChildrenIds=[]);for(var b={},d=0;d<a._containsChildrenIds.length;d++){var f=a._containsChildrenIds[d];
b[f]=a[f];a[f]=null}delete a._containsChildrenIds;if(!a.declaredClass)return null;f=d=null;try{f=c.replaceAll(".","/",a.declaredClass),d=require(f)}catch(w){try{f=c.replaceAll("/",".",a.declaredClass),d=require(f)}catch(u){}}d||(d=g.getObject(a.declaredClass));if(!d)return null;f=null;try{f=e.createBlock(d,a)}catch(v){return logError(v),null}f._children=b;return f},blocksFromJson:function(a,b,d){for(var f=[],w={},u=0;u<a.length;u++){var v=a[u];v.scope=this;null==v._containsChildrenIds&&(v._containsChildrenIds=
[]);for(var k={},t=0;t<v._containsChildrenIds.length;t++){var p=v._containsChildrenIds[t];k[p]=v[p];v[p]=null}delete v._containsChildrenIds;if(v.declaredClass){var m=t=null;try{m=c.replaceAll(".","/",v.declaredClass),t=require(m)}catch(q){console.error("couldnt resolve class "+m)}t||(t=g.getObject(v.declaredClass));if(t){m=null;try{m=e.createBlock(t,v,null,!1)}catch(r){console.error("error in block creation ",r+" "+v.declaredClass);logError(r);continue}m._children=k;w[m.id]=k;f.push(m)}}}a=this.allBlocks(null,
!1);for(u=0;u<a.length;u++){v=a[u];v._children=w[v.id];if(v._children){for(p in v._children)if("string"==typeof v._children[p])(k=this.getBlockById(v._children[p]))?(v[p]=k,k.parent=v,k.postCreate&&k.postCreate()):(this.blockStore.removeSync(v._children[p]),d&&d("   couldnt resolve child: "+v._children[p]+"@"+v.name+":"+v.declaredClass));else if("object"==typeof v._children[p])for(v[p]=[],t=0;t<v._children[p].length;t++)(k=this.getBlockById(v._children[p][t]))?(v[p].push(k),(m=this.getBlockById(k.parentId))?
k.parent=m:console.error("child has no parent")):d&&d("   couldnt resolve child: "+v._children[p]+"@"+v.name+":"+v.declaredClass);delete v._children}!1!==b&&null!=v.parentId&&null==this.getBlockById(v.parentId)&&(v.parentId=null);v.postCreate()}this.allBlocks();return f},resolveBlock:function(a){var b=this,d=this.ctx,b=this.driver,b=d.getDeviceManager(),d=d.getDriverManager();if(-1==a.indexOf("://"))return(b=this.getBlockById(a))?b:a;a=c.parse_url(a);a=c.urlArgs(a.host);var f=b.getItemById(a.device.value);
if(!f){var w=b.getInstanceByName(a.device.value);w&&(f=w.device)}if(f&&(b=b.toDeviceControlInfo(f),b=d.getDriverById(b.driverId),(d=f.driverInstance)||b)&&(a=(b=d?d.blockScope:b.blockScope)?b.getStore().getSync(a.block.value):null))return a},getBlock:function(a){return this.getBlockById(a)},getBlockByName:function(a){if(-1!==a.indexOf("://")){var b=this.resolveBlock(a);if(b)return b}for(var c=this.getBlocks(),f=0;f<c.length;f++)if(b=c[f],b.name===a)return b;return(a=this.blockStore.query({name:a}))&&
0<a.length?a[0]:null},getBlockById:function(a){return this.blockStore.getSync(a)},_flatten:function(a){var b=[],c;for(c in a){var f=a[c];if(null!=f.keys){b.push(f);for(var d in f)if("ctrArgs"!=d&&"parent"!==d)if(this.isBlock(f[d]))b.push(f[d]);else if(this.areBlocks(f[d]))for(var u=0;u<f[d].length;u++)b.push(f[d][u])}}return b},flatten:function(a){var b=[],c;for(c in a){var f=a[c];if(null!=f.keys){var d=_.find(b,{id:f.id});d||b.push(f);for(var u in f)if("ctrArgs"!=u&&"parent"!==u){var v=f[u];if(this.isBlock(v))(d=
_.find(b,{id:v.id}))||b.push(v);else if(this.areBlocks(v))for(var e=0;e<v.length;e++){var k=v[e];(d=_.find(b,{id:k.id}))||b.push(k);b=b.concat(this.flatten([k]))}}}}return b=_.uniq(b,!1,function(a){return a.id})},_getSolve:function(a){return a.prototype?a.prototype.solve:a.__proto__.solve},solveBlock:function(a,b,d,f){b=b||{highlight:!1};var w=null;this.isString(a)?(w=this.getBlockByName(a))||(w=this.getBlockById(a)):this.isObject(a)&&(w=a);a=null;if(w){if(!0!==b.force&&0==w.enabled)return null;!0===
b.force&&(b.force=!1);var u=w.declaredClass;(u=m.getObject(c.replaceAll("/",".",u))||m.getObject(u))?u.prototype&&u.prototype.solve&&(a=u.prototype.solve.apply(w,[this,b])):(a=w.solve(w.getScope(),b,d,f),delete w.override,w.override={})}return a},solve:function(a,b){for(var c="",f=0;f<this.items.length;f++)c+=this.items[f].solve(a,b);return c},parseExpression:function(a,b,c,f,d,u,e,k){return this.getExpressionModel().parse(this,a,b,f,d,u,c,e,k)},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==
typeof a},isBoolean:function(a){return"boolean"==typeof a},isObject:function(a){return"object"===typeof a},isBlock:function(a){var b=!1;"object"==typeof a&&null!=a&&void 0==a.length&&a.serializeMe&&(b=!0);return b},areBlocks:function(a){var b=!1;"object"==typeof a&&null!=a&&0<a.length&&this.isBlock(a[0])&&(b=!0);return b},_onVariableChanged:function(a){a.item&&this.getExpressionModel().variableFuncCache[a.item.title]&&delete this.expressionModel.variableFuncCache[a.item.title]},init:function(){this.getExpressionModel();
this.subscribe(b.EVENTS.ON_DRIVER_VARIABLE_CHANGED,this._onVariableChanged);var a=this;this.subscribe(b.EVENTS.ON_MODULE_RELOADED,function(b){var d=b.module,f=b.newModule;(b=a.getBlocks().filter(function(a){return a.declaredClass==d||a.declaredClass==c.replaceAll("/",".",d)?a:null}))&&_.each(b,function(a){var b=f.prototype,c;for(c in b){var d=b[c];d&&_.isFunction(d)&&(a[c]=d)}})})},_destroy:function(){for(var a=this.allBlocks(),c=0;c<a.length;c++){var d=a[c];if(d)try{d&&d.stop&&d.stop(!0),d&&d.reset&&
d.reset(),d&&d._destroy&&d._destroy(),d&&d.destroy&&d.destroy(),d._emit&&d._emit(b.EVENTS.ON_ITEM_REMOVED,{item:d})}catch(f){}}},destroy:function(){this._destroy();this.reset();this._destroyed=!0;delete this.expressionModel},moveTo:function(a,b,c,f){if(f){if(b.canAdd&&b.canAdd()){var d=this.getBlockById(a.parentId);d&&d.removeBlock(a,!1);b.add(a,null,null);return}console.error("cant reparent");return!1}if(b.parentId||0!=f)if(!a.parentId&&b.parentId&&0==f)a.group=b.group;else if(a.parentId||b.parentId||
!f){if(a.parentId&&b.parentId&&0==f&&a.parentId===b.parentId){var u=this.getBlockById(a.parentId);if(!u)return!1;var e=u[u._getContainer(a)],d=a.indexOf(e,a);b=a.indexOf(e,b);e=d>b?-1:1;c=Math.abs(d-(b+(1==c?-1:1)));for(b=0;b<c-1;b++)u.move(a,e);return!0}if(a.parentId&&b.parentId&&0==f&&a.parentId!==b.parentId){d=this.getBlockById(a.parentId);if(d&&(u=this.getBlockById(b.parentId))&&d&&d.removeBlock&&u.canAdd&&u.canAdd())d.removeBlock(a,!1),u.add(a,null,null);else return!1;e=u[u._getContainer(a)];
null==e&&console.error("weird : target parent has no item container");d=u.indexOf(e,a);b=u.indexOf(e,b);if(!d||!b){console.error(" weird : invalid drop processing state, have no valid item indicies");return}e=d>b?-1:1;c=Math.abs(d-(b+(1==c?-1:1)));for(b=0;b<c-1;b++)u.move(a,e);return!0}}else return b.canAdd&&b.canAdd()&&(a.group=null,b.add(a,null,null)),!0;else{(d=this.getBlockById(a.parentId))&&d.removeBlock&&(d.removeBlock(a,!1),a.parentId=null,a.group=b.group);var u=[],e=this.getBlocks({group:b.group}),
k=[],d=this.getBlockStore(),t=d.storage.index[b.id];for(b=0;b<e.length;b++)if(f=e[b],null==e[b].parentId&&e[b]!=a&&(f=d.storage.index[f.id],f=c?f>=t:f<=t))u.push(e[b]),k.push(d.storage.index[e[b].id]);for(b=0;b<u.length;b++)d.remove(u[b].id);this.getBlockStore().remove(a.id);c&&this.getBlockStore().putSync(a);for(b=0;b<u.length;b++)d.put(u[b]);c||this.getBlockStore().putSync(a);return!0}return!1}});g.chainAfter(r,"destroy");return r})},"xblox/model/Expression":function(){define(["xdojo/declare","xdojo/has",
"xide/utils","xide/types","xblox/model/ModelBase"],function(g,r,q,e,c,b,a){var m="undefined"!==typeof window?window.console:global.console;return g("xblox.model.Expression",[c],{id:null,context:null,variableDelimiters:{begin:"[",end:"]"},blockCallDelimiters:{begin:"{",end:"}"},expressionCache:null,variableFuncCache:null,constructor:function(){this.reset()},reset:function(){this.expressionCache={};this.variableFuncCache={}},replaceVariables:function(a,b,c,m,g,d,h,l){h=h||this.variableDelimiters;l=
l||e.CIFLAG.NONE;l&e.CIFLAG.DONT_ESCAPE&&(m=!1);l&e.CIFLAG.DONT_PARSE&&(c=!1);var n=this._findOcurrences(b,h);if(n)for(var f=0;f<n.length;f++){var w=n[f],w=w.replace(h.begin,""),w=w.replace(h.end,"");(w=this._getVar(a,w))&&w.flags&e.CIFLAG.DONT_PARSE&&(c=!1);var u=null;if(w){if(d){b=b.replace(n[f],"this.getVariable('"+w.name+"')");continue}u=this.getValue(w.value);g&&w.name in g&&(u=g[w.name]);if(this.isScript(u)&&!1!==c)try{var v=a.variablesToJavascript(w,!0);v&&(u=v+u);var q=(new Function("{\n"+
u+"\n}")).call(a.context||{});"undefined"===q||"undefined"===typeof q?u=""+w.value:(u=q,l&e.CIFLAG.DONT_ESCAPE||(u="'"+u+"'"))}catch(r){}else this.isNumber(u)||!1!==m&&(u="'"+u+"'")}else u=n[f];b=b.replace(n[f],u)}return b},parse:function(a,b,c,e,g,d,h,l,n){b=this.replaceAll("''","'",b);c=d||a.context||a.getContext()||{};b=this.replaceVariables(a,b,null,null,h,null!=c.getVariable,null,n);h=this.isScript(b);if(!h&&(this.isString(b)||this.isNumber(b)))return e&&e("Expression "+b+" evaluates to "+b),
b;-1==b.indexOf("return")&&h&&(b="return "+b);a=this;try{b=this.replaceAll("''","'",b);var f=this.expressionCache[b];f||(f=new Function("{"+b+"; }"),this.expressionCache[b]=f);a=f.apply(c,l)}catch(w){return m.error("     invalid expression : \n"+b,w),g&&g("invalid expression : \n"+b+": "+w,w),a=""+b}e&&e("Expression "+b+" evaluates to "+a);return a},parseVariableO:function(a,b){var c=""+b.value;if("None"===b.title)return"";try{var e=a.variablesToJavascript(b,!1);e&&(c=e+c);var g=(new Function("{"+
c+"}")).call(this.context||{});"undefined"===g||"undefined"===typeof g?c=""+b.value:this.isNumber(g)?c=g:(c=""+g,c="'"+c+"'")}catch(d){m.error("parse variable failed : "+b.title+"\n"+c)}return c},parseVariable:function(a,b,c,e,m,d,h){var l=""+b.value;c=c||"";!1!==m?(m=this.variableFuncCache[a.id+"|"+b.title],m||(m=new Function("{"+c+l+"}"),this.variableFuncCache[a.id+"|"+b.title]=m)):m=new Function("{"+c+l+"}");a=m.apply(d||a.context||{},h||[]);return l="undefined"===a||"undefined"===typeof a?""+
b.value:this.isNumber(a)||!1===e?a:"'"+a+"'"},replaceBlockCalls:function(a,b){var c=this._findOcurrences(b,this.blockCallDelimiters);if(c)for(var e=0;e<c.length;e++){var m=this._removeDelimiters(c[e],this.blockCallDelimiters),m=a.solveBlock(m).join("\n");b=b.replace(c[e],m)}return b},_getVar:function(a,b){return a.getVariable(this._getVarName(b))},_getVarName:function(a){return this._removeDelimiters(a,this.variableDelimiters)},_removeDelimiters:function(a,b){return a.replace(b.begin,"").replace(b.end,
"")},_escapeRegExp:function(a){for(var b="[](){}*+.".split(""),c=0;c<b.length;c++)a=a.replace(b[c],"\\"+b[c]);return a},_findOcurrences:function(a,b){var c=this._escapeRegExp(b.begin),e=this._escapeRegExp(b.end);return a.match(new RegExp(c+"("+("[^"+e+"]*")+")"+e,"g"))}})})},"xblox/model/BlockModel":function(){define(["dcl/dcl","xdojo/declare","xide/data/Model","xide/data/Source"],function(g,r,q,e){return r("xblox.model.BlockModel",[q,e],{declaredClass:"xblox.model.BlockModel",icon:"fa-play",mayHaveChildren:function(c){return null!=
this.items&&0<this.items.length},getChildren:function(c){return this.items},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e'}})})},"xblox/data/Store":function(){define("dojo/_base/declare xide/data/TreeMemory xide/data/ObservableStore xide/data/Model dstore/Trackable dojo/Deferred".split(" "),function(g,r,q,e,c,b){return g("xblox.data.Store",[r,c,q],{idProperty:"id",parentField:"parentId",filter:function(a){var b=this.inherited(arguments);this._state.filter=a;return b},
getChildren:function(a){return this.root.filter({parentId:this.getIdentity(a)})},__getChildren:function(a){return this.inherited(arguments)},_fetchRange:function(a){var c=new b;a=this.fetchRangeSync(a);if(this._state.filter){if(this._state&&this._state.filter&&this._state.filter.parentId){var e=this.getSync(this._state.filter.parentId);e&&(this.reset(),a=e.items,e.getChildren&&(a=e.getChildren()),c.resolve(a))}this._state&&this._state.filter&&this._state.filter.group&&(this.getSync(this._state.filter.parent),
e&&(this.reset(),a=e.items))}c.resolve(a);return c},mayHaveChildren:function(a){return a.mayHaveChildren?a.mayHaveChildren(a):null!=a.items&&0<a.items.length}})})},"xblox/factory/Blocks":function(){define("xide/factory xide/utils xide/types xide/mixins/ReloadMixin xide/mixins/EventedMixin xblox/model/logic/CaseBlock xblox/model/Block xblox/model/functions/CallBlock xblox/model/functions/StopBlock xblox/model/functions/PauseBlock xblox/model/functions/SetProperties xblox/model/code/CallMethod xblox/model/code/RunScript xblox/model/loops/ForBlock xblox/model/loops/WhileBlock xblox/model/variables/VariableAssignmentBlock xblox/model/logic/IfBlock xblox/model/logic/ElseIfBlock xblox/model/logic/SwitchBlock xblox/model/variables/VariableSwitch xblox/model/logging/Log xblox/model/server/RunServerMethod xblox/model/server/Shell xblox/model/code/RunBlock xblox/model/events/OnEvent xblox/model/events/OnKey xblox/model/mqtt/Subscribe xblox/model/mqtt/Publish xblox/model/File/ReadJSON xcf/factory/Blocks".split(" "),
function(g,r,q,e,c,b,a,m,t,k,p,x,y,d,h,l,n,f,w,u,v,E,B,F,C,D,A,H,G){g.prepareBlockContructorArgs=function(a){a||(a={});a.id||(a.id=r.createUUID());a.items||(a.items=[])};g.createBlock=function(a,b,c,f){g.prepareBlockContructorArgs(b);a=g.createInstance(a,b,c);a.ctrArgs=null;var d;try{a&&a.init&&a.init();a.scope&&(d=a.scope.registerBlock(a,f));try{a.initReload&&a.initReload()}catch(l){debugger}}catch(n){logError(n,"create block")}return d||a};var z=null;g.clearVariables=function(){};g.getAllBlocks=
function(a,b,c,f,d){if(!1!==d&&null!=z){for(a=0;a<z.length;a++)if(b=z[a],"Set Variable"===b.name){z.remove(b);break}return z}0==d&&(z=null);d=g._getFlowBlocks(a,b,c,f);d=d.concat(g._getLoopBlocks(a,b,c,f));d=d.concat(g._getCommandBlocks(a,b,c,f));d=d.concat(g._getCodeBlocks(a,b,c,f));d=d.concat(g._getEventBlocks(a,b,c,f));d=d.concat(g._getLoggingBlocks(a,b,c,f));d=d.concat(g._getServerBlocks(a,b,c,f));d=d.concat(g._getMQTTBlocks(a,b,c,f));return z=d=d.concat(g._getFileBlocks(a,b,c,f))};g._getMQTTBlocks=
function(a,b,c,f){var d=[];d.push({name:"MQTT",iconClass:"fa-cloud",items:[{name:"Subscribe",owner:b,iconClass:"fa-bell",proto:A,target:c,ctrArgs:{scope:a,group:f}},{name:"Publish",owner:b,iconClass:"fa-send",proto:H,target:c,ctrArgs:{scope:a,group:f}}]});g.publish(q.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:d,group:"MQTT"});return d};g._getFileBlocks=function(a,b,c,f){var d=[];d.push({name:"File",iconClass:"fa-file",items:[{name:"%%Read JSON",owner:b,iconClass:"fa-file",proto:G,target:c,ctrArgs:{scope:a,
group:f}}]});g.publish(q.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:d,group:"File"});return d};g._getServerBlocks=function(a,b,c,f){var d=[];d.push({name:"Server",iconClass:"el-icon-repeat",items:[{name:"Run Server Method",owner:b,iconClass:"fa-plug",proto:E,target:c,ctrArgs:{scope:a,group:f}},{name:"Shell",owner:b,iconClass:"fa-code",proto:B,target:c,ctrArgs:{scope:a,group:f}}]});g.publish(q.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:d,group:"Server"});return d};g._getVariableBlocks=function(a,b,c,f){var d=
[];d.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:n,target:c,ctrArgs:{scope:a,group:f,condition:"[value]\x3d\x3d'PW'"}}]});return d};g._getEventBlocks=function(a,b,c,f){var d=[];d.push({name:"Events",iconClass:"fa-bell",items:[{name:"On Event",owner:b,iconClass:"fa-bell",proto:C,target:c,ctrArgs:{scope:a,group:f}},{name:"On Key",owner:b,iconClass:"fa-keyboard-o",proto:D,target:c,ctrArgs:{scope:a,group:f}}]});g.publish(q.EVENTS.ON_BUILD_BLOCK_INFO_LIST,
{items:d,group:"Events"});return d};g._getLoggingBlocks=function(a,b,c,f){var d=[];d.push({name:"Logging",iconClass:"fa-bug",items:[{name:"Log",owner:b,iconClass:"fa-bug",proto:v,target:c,ctrArgs:{scope:a,group:f}}]});g.publish(q.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:d,group:"Logging"});return d};g._getCodeBlocks=function(a,b,c,f){var d=[];d.push({name:"Code",iconClass:"fa-code",items:[{name:"Call Method",owner:b,iconClass:"el-icon-video",proto:x,target:c,ctrArgs:{scope:a,group:f}},{name:"Run Script",
owner:b,iconClass:"fa-code",proto:y,target:c,ctrArgs:{scope:a,group:f}},{name:"Run Block",owner:b,iconClass:"fa-code",proto:F,target:c,ctrArgs:{scope:a,group:f}},{name:"Set Properties",owner:b,iconClass:"fa-code",proto:p,target:c,ctrArgs:{scope:a,group:f}}]});g.publish(q.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:d,group:"Code"});return d};g._getFlowBlocks=function(a,b,c,f){var d=[];d.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:n,target:c,
ctrArgs:{scope:a,group:f,condition:"[value]\x3d\x3d'PW'"}},{name:"Switch",owner:b,iconClass:"el-icon-fork",proto:w,target:c,ctrArgs:{scope:a,group:f}},{name:"Variable Switch",owner:b,iconClass:"el-icon-fork",proto:u,target:c,ctrArgs:{scope:a,group:f}}]});g.publish(q.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:d,group:"Flow"});return d};g._getLoopBlocks=function(a,b,c,f){var l=[];l.push({name:"Loops",iconClass:"el-icon-repeat",items:[{name:"While",owner:b,iconClass:"el-icon-repeat",proto:h,target:c,ctrArgs:{scope:a,
group:f,condition:"[Volume]\x3c\x3d100"}},{name:"For",owner:b,iconClass:"el-icon-repeat",proto:d,target:c,ctrArgs:{scope:a,group:f,initial:"1",comparator:"\x3c\x3d","final":"5",modifier:"+1",counterName:"value"}}]});g.publish(q.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:l,group:"Loops"});return l};g._getMathBlocks=function(a,b,c,f){b=[];b.push({name:"Math",owner:this,iconClass:"el-icon-qrcode",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-compass",proto:n,item:c,ctrArgs:{scope:a,group:f}}]});
return b};g._getTimeBlocks=function(a,b,c,f){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-qrcode",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-time",proto:n,item:c,ctrArgs:{scope:a,group:f}}]});return b};g._getTransformBlocks=function(a,b,c,f){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-magic",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-time",proto:n,item:c,ctrArgs:{scope:a,group:f}}]});return b};return g})},"xblox/model/functions/StopBlock":function(){define(["dcl/dcl",
"xide/utils","xide/types","dojo/Deferred","xblox/model/Block"],function(g,r,q,e,c){return g(c,{declaredClass:"xblox.model.functions.StopBlock",command:"Select command please",icon:"",args:null,_timeout:100,solve:function(b,a){if(this.command){var c=b.resolveBlock(this.command);if(c&&c.stop){var e=c.stop();this.onSuccess(this,a)}else this.onFailed(this,a);return e}},hasInlineEdits:!0,makeEditable:function(b,a,c,e,k,p,g){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+a+"' display-mode\x3d'"+(k||"popup")+
"' display-type\x3d'"+(c||"text")+"' data-prop\x3d'"+b+"' data-title\x3d'"+e+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[b]+"\x3c/a\x3e"},getFieldOptions:function(b){if("command"===b)return this.scope.getCommandsAsOptions("text")},toText:function(){var b="Unknown",a=this.scope.getBlock(this.command);a&&(b=a.name);-1!==this.command.indexOf("://")&&(b='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Stop Command : "+
b},onChangeField:function(b,a){},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);b.push(r.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));return b}})})},"xblox/model/functions/PauseBlock":function(){define(["dcl/dcl","xide/utils","xide/types","dojo/Deferred",
"xblox/model/Block"],function(g,r,q,e,c){return g(c,{declaredClass:"xblox.model.functions.PauseBlock",command:"Select command please",icon:"",args:null,_timeout:100,solve:function(b,a){if(this.command){var c=b.resolveBlock(this.command);if(c&&c.pause){var e=c.pause();this.onSuccess(this,a)}else this.onFailed(this,a);return e}},hasInlineEdits:!0,makeEditable:function(b,a,c,e,k,p,g){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+a+"' display-mode\x3d'"+(k||"popup")+"' display-type\x3d'"+(c||"text")+"' data-prop\x3d'"+
b+"' data-title\x3d'"+e+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[b]+"\x3c/a\x3e"},getFieldOptions:function(b){if("command"===b)return this.scope.getCommandsAsOptions("text")},toText:function(){var b="Unknown",a=this.scope.getBlock(this.command);a&&(b=a.name);-1!==this.command.indexOf("://")&&(b='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Pause Command : "+b},onChangeField:function(b,a){},getFields:function(){var b=
this.inherited(arguments)||this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);b.push(r.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));return b}})})},"xblox/model/functions/SetProperties":function(){define(["dcl/dcl","xide/utils","xide/types","dojo/Deferred","xblox/model/Block"],function(g,r,q,e,c){return g(c,
{declaredClass:"xblox.model.functions.SetProperties",command:"Select block",icon:"",args:null,_timeout:100,solve:function(b,a){var c=new e;if(this.command){var t=b.resolveBlock(this.command);if(t&&this.props){for(var k in this.props)t.set(k,this.props[k]),t[k]=this.props[k],t.onChangeField&&t.onChangeField(k,this.props[k]);this.onSuccess(this,a)}else this.onFailed(this,a);c.resolve([])}return c},hasInlineEdits:!1,makeEditable:function(b,a,c,e,k,p,g){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+a+"' display-mode\x3d'"+
(k||"popup")+"' display-type\x3d'"+(c||"text")+"' data-prop\x3d'"+b+"' data-title\x3d'"+e+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[b]+"\x3c/a\x3e"},getFieldOptions:function(b){if("command"===b)return this.scope.getCommandsAsOptions("text")},toText:function(){var b="Unknown",a=this.scope.getBlock(this.command);a&&(b=a.name);-1!==this.command.indexOf("://")&&(b='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+
"Set Properties : "+b},serializeObject:function(b){return"props"===b?!0:!1},onChangeField:function(b,a,c){"command"===b&&(delete this.props,this.props={})},init:function(){this.props&&_.isString(this.props)&&(this.props=r.fromJson(this.props))},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);b.push(r.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",
options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));var a=this.scope.resolveBlock(this.command);if(a&&a.getFields){this.props||(this.props={});var a=a.getFields(),c=_.find(a,{dst:"description"});a.remove(c);_.each(a,function(a){a.group="Properties";a.value=r.getAt(this.props,a.dst,a.value);a.dst="props."+a.dst},this);b=b.concat(a)}return b}})})},"xblox/model/server/RunServerMethod":function(){define(["dcl/dcl","xblox/model/server/ServerBlock","xide/utils"],
function(g,r,q){return g(r,{declaredClass:"xblox.model.server.RunServerMethod",description:"Runs a JSON-RPC-2.0 method on the server",name:"Run Server Method",method:"XShell::run",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onMethodChanged:function(e,c){this.method=e;if(!q.isValidString(this.args)){var b=this.getServerParams();b&&this._updateArgs(b,c)}},_getArgs:function(){var e=q.getJson(this.args||"[]"),c=[];if(e){var b=!1;e&&e[0]&&null!=e[0].optional&&
(b=!0);if(b)for(b=0;b<e.length;b++){var a=e[b],m=a.value;-1!=a.name.indexOf("Base64")&&(m=this.getService().base64_encode(m));"notset"!==a.value?-1!=a.value.indexOf("[")&&-1!=a.value.indexOf("]")?(m=this.scope.expressionModel.replaceVariables(this.scope,a.value,!1,!1),-1!=a.name.indexOf("Base64")&&(m=this.getService().base64_encode(m)),c.push(m)):c.push(m||a["default"]):c.push(a["default"]||m)}}else return[this.args];return c},_updateArgs:function(e,c){var b=this.utils.getCIWidgetByName(c,"args");
if(b){var a=JSON.stringify(e);b.editBox.set("value",a);this.args=a}},getServerParams:function(){var e=this.getService().getParameterMap(this.getServiceClass(),this.getServiceMethod());if(e)for(var c=0;c<e.length;c++)e[c].value="notset";return e},onReloaded:function(e){this._solve()},_solve:function(e,c,b,a){},solve:function(e,c,b,a){this._return=[];this._lastResult=null;e=[];if(!this.isInValidState())return this.onFailed(this,c),e;e=this._getArgs();this.onRun(this,c);this.getService();c=this.scope.serviceObject;
console.error("run deferred");(c=c.runDeferred(this.getServiceClass(),this.getServiceMethod(),e))&&c.then(function(a){console.error("returned ",a)});return c},toText:function(){var e=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(e+=this.method.substr(0,50));return e},canAdd:function(){return[]},getFields:function(){var e=this.inherited(arguments)||this.getDefaultFields(),c=this;e.push(q.createCI("value",25,this.method,{group:"General",title:"Method",dst:"method",description:"This should be in the format : MyServerClass::myMethod",
delegate:{runExpression:function(b,a,e){c.method=b;c.solve(c.scope,null,a,e)}}}));return e=e.concat(this.getServerDefaultFields())},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(e){return null!=this.items&&0<this.items.length},getChildren:function(e){return this.items},onChangeField:function(e,c,b){if("method"===e)this.onMethodChanged(c,b)},isInValidState:function(){return null!=this.getService()},getService:function(){var e=this.scope.getService();
e||console.error("have no service object");return e},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(e){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(e){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},
getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/server/ServerBlock":function(){define(["dcl/dcl","xblox/model/Block","xide/utils"],function(g,r,q){return g(r,{declaredClass:"xblox.model.server.ServerBlock",name:"Run Server Block",method:"XShell::run",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onReloaded:function(){},
solve:function(e,c,b,a){this._currentIndex=0;this._return=[];if((e=""+this.method)&&e.length){var m=new Function("{"+e+"}"),t=this.getArgs();try{var k=m.apply(this,t||{});this._lastResult=k;b&&b("Expression "+e+" evaluates to "+k);if("false"!==k&&!1!==k)this.onSuccess(this,c);else return this.onFailed(this,c),[]}catch(p){return a&&a("invalid expression : \n"+e+": "+p),this.onFailed(this,c),[]}}else console.error("have no script");b=this[this._getContainer()];if(b.length)this.runFrom(b,0,c);else this.onSuccess(this,
c);return[]},toText:function(){var e=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(e+=this.method.substr(0,50));return e},canAdd:function(){return[]},getServerDefaultFields:function(e){e=e||[];e.push(q.createCI("args",27,this.args,{group:"General",title:"Arguments",dst:"args"}));return e},getFields:function(){return this.inherited(arguments)||this.getDefaultFields()},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(e){return null!=this.items&&
0<this.items.length},getChildren:function(e){return this.items},isInValidState:function(){return null!=this.getService()},getService:function(){return this.scope.getService()},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(e){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},
hasServerClass:function(e){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/server/Shell":function(){define(["dcl/dcl","xblox/model/server/ServerBlock","xide/utils","xcf/model/Command"],function(g,r,q,e){return g([e,r],{declaredClass:"xblox.model.server.Shell",description:"Runs a JSON-RPC-2.0 method on the server",
name:"Run Shell",method:"",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onMethodChanged:function(c,b){this.method=c;if(!q.isValidString(this.args)){var a=this.getServerParams();a&&this._updateArgs(a,b)}},_getArgs:function(){var c=q.getJson(this.args||"[]"),b=[];if(c){var a=!1;c&&c[0]&&null!=c[0].optional&&(a=!0);if(a)for(a=0;a<c.length;a++){var e=c[a],t=e.value;-1!=e.name.indexOf("Base64")&&(t=this.getService().base64_encode(t));"notset"!==e.value?-1!=e.value.indexOf("[")&&
-1!=e.value.indexOf("]")?(t=this.scope.expressionModel.replaceVariables(this.scope,e.value,!1,!1),-1!=e.name.indexOf("Base64")&&(t=this.getService().base64_encode(t)),b.push(t)):b.push(t||e["default"]):b.push(e["default"]||t)}}else return[this.args];return b},_updateArgs:function(c,b){var a=this.utils.getCIWidgetByName(b,"args");if(a){var e=JSON.stringify(c);a.editBox.set("value",e);this.args=e}},getServerParams:function(){var c=this.getService().getParameterMap(this.getServiceClass(),this.getServiceMethod());
if(c)for(var b=0;b<c.length;b++)c[b].value="notset";return c},onReloaded:function(c){this._solve()},_solve:function(c,b,a,e){},solve:function(c,b,a,e,t,k){this._return=[];this._lastResult=null;this._lastSettings=b||this._lastSettings;b=this.getInstance();c=c.expressionModel.replaceVariables(c,this.method,!1,!1);b.runShell(c,q.mixin({},{}),this.id,this.id,this)},toText:function(){var c=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(c+=this.method.substr(0,50));return c},canAdd:function(){return[]},
getFields:function(){var c=this.inherited(arguments)||this.getDefaultFields(),b=this;c.push(q.createCI("value",25,this.method,{group:"General",title:"Cmd",dst:"method",delegate:{runExpression:function(a,c,e){b.method=a;b.solve(b.scope,null,c,e)}}}));return c},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(c){return null!=this.items&&0<this.items.length},getChildren:function(c){return this.items},onChangeField:function(c,b,a){if("method"===c)this.onMethodChanged(b,
a)},isInValidState:function(){return null!=this.getService()},getService:function(){var c=this.scope.getService();c||console.error("have no service object");return c},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(c){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},
hasServerClass:function(c){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/mqtt/Subscribe":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains xide/types".split(" "),function(g,r,q,e,c,b,a,m,t){return g([e,b],{declaredClass:"xblox.model.mqtt.Subscribe",
name:"Subscribe",topic:"Topic",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-bell",path:"",qos:0,stop:function(){var a=this.getInstance();a&&a.callMethod("unSubscribeTopic",c.mixin({topic:this.topic},c.getJson(this.args)),this.id,this.id)},onData:function(a){if(a&&a.topic&&a.topic==this.topic){delete a.src;delete a.id;this.getContext();var b=this[this._getContainer()],e=this._lastSettings,m=[];if(0<b.length){var b=a,d=this.path&&this.path.length?this.path:null!==a.payload?"payload":null;d&&
_.isObject(a)&&(b=c.getAt(a,d,a));for(a=0;a<this.items.length;a++)d=this.items[a],d.enabled&&(d.override={args:[b]},m.push(d.solve(this.scope,e)))}this.onSuccess(this,this._lastSettings);return m}},observed:["topic"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve:function(a,b,e,m,d,h){this._currentIndex=0;this._return=[];this._lastSettings=b;(a=this.getInstance())&&a.callMethod("subscribeTopic",c.mixin({topic:this.topic,qos:this.qos},c.getJson(this.args||
"{}")),this.id,this.id);b=b||{};this.onRunThis(b)},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+""+this.makeEditable("topic","bottom","text","Enter a topic","inline")+" :: \x3c/span\x3e";this.topic&&(a+=this.topic.substr(0,30));return a},canAdd:function(){return[]},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();b.push(c.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));b.push(c.createCI("arguments",27,this.args,{group:"Arguments",
title:"Arguments",dst:"args"}));b.push(c.createCI("topic",a.ECIType.STRING,this.topic,{group:"General",title:"Topic",dst:"topic",select:!0}));b.push(c.createCI("name",a.ECIType.ENUMERATION,this.qos,{group:"General",title:"QOS",dst:"qos",widget:{options:[{label:"0 - at most once",value:0},{label:"1 - at least once",value:1},{label:"2 - exactly once",value:2}]}}));b.push(c.createCI("path",a.ECIType.STRING,this.path,{group:"General",title:"Value Path",dst:"path"}));return b}})})},"xblox/model/mqtt/Publish":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains xide/types xcf/model/Command".split(" "),
function(g,r,q,e,c,b,a,m,t,k){return g(m,{declaredClass:"xblox.model.mqtt.Publish",name:"Publish",topic:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-send",isCommand:!0,qos:0,retain:!1,path:null,onData:function(a){if(a&&a.topic&&a.topic==this.topic){this.getContext();var b=this[this._getContainer()],e=this._lastSettings,d=[];if(0<b.length)for(b=a,(this.path="value",_.isObject(a))&&(b=c.getAt(a,this.path,a)),a=0;a<this.items.length;a++){var h=this.items[a];h.enabled&&(h.override={args:[b]},
d.push(h.solve(this.scope,e)))}this.onSuccess(this,this._lastSettings);return d}},observed:["topic"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve:function(a,b,e,d,h,l){this._currentIndex=0;this._return=[];b=this._lastSettings=b||this._lastSettings;d=this.getInstance();1==e&&this._loop&&this.reset();e=this.args;h=this.getArgs(b);h[0]&&(e=h[0]);d&&(e=c.getJson(e,!0,!1),null!==e&&0!==e&&!0!==e&&!1!==e&&_.isObject(e)||(e={payload:this.args}),a=
a.expressionModel.replaceVariables(a,this.topic,!1,!1),d.callMethod("publishTopic",c.mixin({topic:a,qos:this.qos,retain:this.retain},e),this.id,this.id));b=b||{};this.onDidRun();this.onSuccess(this,b);return!0},toText:function(a,b,c,d){a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.makeEditable("name","top","text","Enter a name","inline")+" :: \x3c/span\x3e";this.topic&&(a+=this.makeEditable("topic","bottom","text","Enter a topic","inline"),this.startup&&(a+=this.getIcon("fa-bell inline-icon text-warning",
"text-align:right;float:right;","")),0<this.interval&&(a+=this.getIcon("fa-clock-o inline-icon text-warning","text-align:right;float:right","")));return a},canAdd:function(){return[]},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();b.push(c.createCI("qos",a.ECIType.ENUMERATION,this.qos,{group:"General",title:"QOS",dst:"qos",widget:{options:[{label:"0 - at most once",value:0},{label:"1 - at least once",value:1},{label:"2 - exactly once",value:2}]}}));b.push(c.createCI("arguments",
27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));b.push(c.createCI("topic",a.ECIType.STRING,this.topic,{group:"General",title:"Topic",dst:"topic",select:!0}));b.push(c.createCI("retain",a.ECIType.BOOL,this.retain,{group:"General",title:"Retain",dst:"retain"}));b.remove(_.find(b,{name:"send"}));b.remove(_.find(b,{name:"waitForResponse"}));return b}})})},"xblox/model/File/ReadJSON":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains dojo/promise/all xide/types module xdojo/has!xblox-ui?xfile/data/DriverStore xdojo/has!xblox-ui?xfile/views/FileGridLight".split(" "),
function(g,r,q,e,c,b,a,m,t,k,p){r("electronx");r("xcf-ui");r("php");return g([e,b],{declaredClass:"xblox.model.File.ReadJSON",name:"Read JSON",deferred:!1,sharable:!1,context:null,icon:"fa-file",observed:["path"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},getFileContent:function(a){new q;var b=this.getScope().ctx;b.getFileManager();(b=b.getDeviceManager().getInstanceByName("File-Server"))||console.error("ReadJSON : have no file server driver");
return b.callCommand("GetProg",{override:{args:[a]}})},processJSON:function(a,b){var d=this.jsonPath;this._lastResult=d?c.getAt(a,d):a;this.onSuccess(this,b);this.runByType(m.BLOCK_OUTLET.FINISH,b)},solve:function(a,b,d,e,l){this._currentIndex=0;this._return=[];b=this._lastSettings=b||this._lastSettings||{};d=""+this._get("path");this.getContext();this._getContainer();var n=new q,f=this;this.onRunThis(b);a=a.expressionModel.replaceVariables(a,d,null,null);this.getFileContent(a).then(function(a){(a=
a.content)&&(a=c.getJson(a,!0))&&f.processJSON(a,b)});this.getArgs(b);try{e&&e("Expression "+d+" evaluates to "+a)}catch(w){w=w||{},this.onDidRunItemError(n,w,b),this.onFailed(this,b),l&&l("invalid expression : \n"+d+": "+w)}return n},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.name+" :: \x3c/span\x3e";this.path&&(a+=this.path.substr(0,50));return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),b=this.getScope().ctx,
d=b.getDeviceManager().getInstanceByName("File-Server"),e=c.clone(m.DEFAULT_FILE_GRID_PERMISSIONS),b={ctx:b,owner:this,selection:"/",resizeToParent:!0,Module:p,permissions:e};if(d&&k){var e=function(a){return new k({data:[],config:l,mount:"none",options:n,driver:d,micromatch:"(*.json)|!(*.*)",glob:a})},l={},n={fields:m.FIELDS.SHOW_ISDIR|m.FIELDS.SHOW_OWNER|m.FIELDS.SHOW_SIZE|m.FIELDS.SHOW_FOLDER_SIZE|m.FIELDS.SHOW_MIME|m.FIELDS.SHOW_PERMISSIONS|m.FIELDS.SHOW_TIME|m.FIELDS.SHOW_MEDIA_INFO};b.leftStore=
e("/*");b.rightStore=e("/*")}a.push(c.createCI("path",4,this.path,{group:"General",title:"Path",dst:"path",filePickerOptions:b,widget:{item:this}}));a.push(c.createCI("jsonPath",13,this.jsonPath,{group:"General",title:"Select",dst:"jsonPath"}));return a}})})},"xblox/embedded_ui":function(){define(["xblox/embedded","xblox/factory/Blocks","xide/widgets/ScriptWidget"],function(){})},"xblox/views/BlockGrid":function(){define("dojo/_base/declare xide/types xide/utils xide/factory xblox/views/Grid xide/layout/_Accordion xide/views/CIViewMixin xaction/DefaultActions dojo/dom-class dojo/Deferred xide/views/History".split(" "),
function(g,r,q,e,c,b,a,m,t,k,p){function x(a){a.hightlightTimer&&(clearTimeout(a.hightlightTimer),a.hightlightTimer=null)}var y=r.ACTION;return g("xblox.views.BlockGrid",c,{highlightDelay:500,currentCIView:null,targetTop:null,lastSelectedTopTabTitle:"General",showHeader:!1,toolbarInitiallyHidden:!0,contextMenuArgs:{actionFilter:{quick:!0}},menuOrder:{File:110,Edit:100,View:90,Block:50,Settings:20,Navigation:10,Step:115,New:4,Window:1},permissions:[y.RELOAD,y.DELETE,y.CLIPBOARD,y.LAYOUT,y.COLUMNS,
y.SELECTION,y.DOWNLOAD,y.SAVE,y.SEARCH,"Step/Run","Step/Move Up","Step/Move Down",y.TOOLBAR,"Step/Properties","Step/Edit","Step/Back","Step/Pause",y.HEADER,y.CONTEXT_MENU],tabOrder:{Home:100,View:50,Settings:20},tabSettings:{Step:{width:"190px"},Show:{width:"130px"},Settings:{width:"100%"}},groupOrder:{Clipboard:110,File:100,Step:80,Open:70,Organize:60,Insert:10,Select:0},options:q.clone(r.DEFAULT_GRID_OPTIONS),columns:[{renderExpando:!0,label:"Name",field:"name",sortable:!1,formatter:function(a,
b){var c="";return b.toText?(c=b.toText(),'\x3cspan class\x3d"" style\x3d"width: 95%;"\x3e'+c+"\x3c/span\x3e"):a}}],getTypeMap:function(){return{}},getBlock:function(a){return this.blockScope.getBlockById(a)},formatOrder:function(a,b){if(b){var c=b.getParent(),e=b.index();if(c){for(var c=b.numberOfParents(),f="\x26nbsp;",w=0;w<c;w++)f+="\x26nbsp;";f+="";for(w=0;w<c;w++)f+="-";e=f+"\x26nbsp;"+e}else return"\x26nbsp;"+e;return e}return""},focus:function(a){if(a)return this.inherited(arguments)},postMixInProperties:function(){var a=
!1,b=this;_.each(this.columns,function(b){"order"==b.field&&(a=!0)});a||"basicVariables"===this.blockGroup||this.columns.unshift({label:"Line",field:"order",sortable:!1,hidden:!1,formatter:function(a,c){return b.formatOrder(a,c,b)}});this.inherited(arguments)},renderRow:function(a){if(this.collection){var b=this.inherited(arguments);0==a.enabled&&t.add(b,"disabledBlock");var c=$(b),e=a.getScope(),e=e?e.id:null;if(a.getStatusClass&&e){var e=a.getStatusClass(e),f=$(b);e&&!f[0].hightlightTimer&&this.mark($(b),
e.className,a,e.delay)}if(a.hasInlineEdits){if(c.__inline)return;c.__inline=!0;c=c.find(".editable");_.each(c,function(b){b.object=a;b=$(b);var c=b.attr("data-prop"),f=b.attr("display-type")||"text",c=a.getFieldOptions?a.getFieldOptions(c):null,f={type:f,placement:b.attr("pos")||"right",mode:b.attr("display-mode")||"popup",title:b.prop("data-title"),inputclass:"input-transparent",success:function(a,b){var c=$(this).attr("data-prop");this.object.set(c,b)}};c&&(f.source=c);b.editable(f);b.attr("tabIndex",
"-1")})}return b}},getCurrentParent:function(){var a=this.getHistory().getNow();return a?this.getBlock(a):null},addItem:function(a,b){if(!a)return!1;b=b||{};var c=this.getSelection()[0],n=a.proto||b.proto,f=a.ctrArgs||b.ctrArgs,w=null,u=null;c||(c=this.getCurrentParent());if(!c){var v=this.getSelection()[0];v&&(c=v)}f&&(f.id&&(f.id=q.createUUID()),f.parent&&(f.parent=null),f.parentId&&(f.parentId=null),f.items&&(f.items=[]));c&&n&&f?(c.owner&&c.dstField&&(w=c.dstField,c=c.owner),f.parentId=c.id,f.group=
null,f.parent=c,u=c.add(n,f,w),u.parent=c):!c&&n&&f&&("No Group"===f.group&&this.newRootItemGroup&&(f.group=this.newRootItemGroup),!f.group&&this.newRootItemGroup&&(f.group=this.newRootItemGroup),!f.group&&this.blockGroup&&(f.group=this.blockGroup),f.group&&this.newRootItemGroup&&f.group!==this.newRootItemGroup&&(f.group=this.newRootItemGroup),u=e.createBlock(n,f));u&&u.postCreate&&u.postCreate();if(u){c=this.getStore(c)||this.collection;n=c.getSync(u[c.idProperty]);n||(console.error("new block not in store"),
c.putSync(u));try{u.scope._emit(r.EVENTS.ON_ITEM_ADDED,{item:u,owner:u.scope})}catch(m){logError(m)}this._itemChanged("added",u,c);return n}console.error("didnt create block")},_itemChanged:function(a,b,c){function e(a,b){f.select(a,null,!0,{focus:!0,delay:1,append:!1,expand:!0},b)}c=c||this.getStore(b);var f=this;switch(a){case "added":f.refreshRoot();f.refresh();f.refreshCurrent();e(b);break;case "deleted":a=b.getParent();c=b.getPreviousBlock()||b.getNextBlock()||a;if(a){var w=a.getContainer();
w&&_.each(w,function(a){a.id==b.id&&w.remove(a)})}this.refresh();c&&e(c)}},printRootOrder:function(a){a=a||this.collection.storage.fullData;_.each(a,function(a,b){})},refreshAll:function(a){a||this._preserveSelection();this.refreshRoot();this.refresh();a||this._restoreSelection();var b=this;a&&setTimeout(function(){b.select(a,null,!0,{focus:!0})},30)},getStore:function(a){return a&&(_.isArray()&&(a=a[0]),a._store)?a._store:null},refreshRoot:function(){return this.set("collection",this.collection.filter(this.getRootFilter()))},
refresCurrent:function(){return this.set("collection",this.collection.filter(this.getRootFilter()))},getRootFilter:function(){return{group:this.blockGroup}},_onCIChanged:function(a,b,c,e,f){},clearPropertyPanel:function(){var a=this.getPropertyStruct();a.currentCIView&&(a.currentCIView.empty(),a.currentCIView=null);a.targetTop&&(q.destroy(a.targetTop,!0),a.targetTop=null);a._lastItem=null;this.setPropertyStruct(a)},getState:function(a){a=this.inherited(arguments)||{};var b=this.getRightPanel();a.properties=
b.isExpanded();return a},onCIChanged:function(a,b,c,e,f,w){c!==e&&(a=this.collection,b=this.collection.getSync(b.id),b.set(f,e),this.refreshActions(),b[f]=e,a.emit("update",{target:b,type:"update"}),b._store.emit("update",{target:b}),this._itemChanged("changed",b,a),b.onChangeField(f,e,w,this),(e=this.cell(b.id,"1"))&&e.column&&this.refreshCell(e).then(function(a){}),"enabled"===f&&this.refresh(),this._itemChanged("changed",b,a))},onShowProperties:function(a){var b=this._console;if(b&&a){var c=a.send||
a.method;b.getConsoleEditor().set("value",c);this._lastConsoleItem=a}},showProperties:function(c,e){function l(a,b){if(a){var c=a.title;b?v.lastSelectedTopTabTitle=c:b||v.lastSelectedTopTabTitle!==c||(v.lastSelectedTopTabTitle=null)}}var n=new k,f=c||this.getSelection()[0],w=this,u=w.getPanelSplitPosition(r.DOCKER.DOCK.RIGHT);if(f&&1!=u){u=this.getRightPanel("Properties",null,"DefaultTab",{});u.closeable(!1);var v=this.getPropertyStruct();if(f!=v._lastItem||!0===e){this.clearPropertyPanel();v=this.getPropertyStruct();
v._lastItem=c;var m=v.targetTop;m||(m=q.addWidget(b,{},null,u.containerNode,!0),$(m.domNode).addClass("CIView Accordion"),v.targetTop=m,w.addHandle("show",m._on("show",function(a){l(a.view,!0)})),w.addHandle("hide",m._on("hide",function(a){l(a.view,!1)})));_.each(m.getChildren(),function(a){m.removeChild(a)});v.currentCIView&&v.currentCIView.empty();if(f.getFields){for(var u=f.getFields(),g=0;g<u.length;g++)u[g].vertical=!0;g=new a({typeMap:w.getTypeMap(),tabContainerClass:b,tabContainer:v.targetTop,
delegate:this,viewStyle:"padding:0px;",autoSelectLast:!0,item:f,source:this.callee,options:{groupOrder:{General:1,Advanced:2,Script:3,Arguments:4,Description:5,Share:6}},cis:u});g.initWithCIS(u);v.currentCIView=g;if(f.onFieldsRendered)f.onFieldsRendered(f,u);w.addHandle("valueChanged",g._on("valueChanged",function(a){setTimeout(function(){w.onCIChanged&&w.onCIChanged(a.ci,f,a.oldValue,a.newValue,a.ci.dst)},10)}));m.getTab(v.lastSelectedTopTabTitle)?m.selectChild(v.lastSelectedTopTabTitle,!0):v.lastSelectedTopTabTitle=
null;this.setPropertyStruct(v);this.onShowProperties(f);return n}}}},onSelectionChanged:function(a,b){var c=a.selection[0],e=this,f=this.ctx,w=e.getActionStore(),u=this.getContextMenu(),v=this.getToolbar(),f=f.getWindowManager().getToolbar(),m=c&&c.getActions?c.getActions():null,g=this.getAction("Step/Enable");c&&(g.value=c.enabled);(c=w.query({global:!0}))&&!m&&(m=[]);_.each(c,function(a){(a=a.getActions?a.getActions(e.permissions,e):null)&&a.length&&(m=m.concat(a))});u&&u.removeCustomActions();
v&&v.removeCustomActions();f&&f.removeCustomActions();m&&!_.isEmpty(m)&&(u=this.addActions(m),w._emit("onActionsAdded",u))},startup:function(){if(!this._started){this.inherited(arguments);this._history=new p;this.propertyStruct||(this.propertyStruct={currentCIView:null,targetTop:null,_lastItem:null});this._dontSubscribeToHighligt=!0;$(this.domNode).addClass("blockGrid");var a=this,b=this.permissions||[],c=m.getDefaultActions(b,this),c=c.concat(this.getBlockActions(b));this.addActions(c);m.hasAction(b,
"Step/Properties")&&this._on("selectionChanged",function(b){var c=b.selection[0];clearTimeout(a._propsTimer);c?a._propsTimer=setTimeout(function(){a.getPropertyStruct();a.showProperties(c)},500):c||"clear"!=b.why||a.clearPropertyPanel()});this.addHandle("update",this.collection.on("update",function(b){var c=b.target;"update"===b.type&&"value"===b.property&&(b=a.toNode(b))&&a.mark(b,"successBlock",c)}));this.addHandle("added",this.collection._on("added",function(b){a._refreshTimer||(a._refreshTimer=
setTimeout(function(){a.refresh();delete a._refreshTimer;a._refreshTimer=null;b.target&&a.select(b.target,null,!0,{focus:!0,append:!1,expand:!0,delay:10})},10))}));this.addHandle("update",this.collection._on("update",function(b){var c=b.target,e=a.toNode(b);"update"===b.type&&"value"===b.property&&a.mark(e,"successBlock",c)}));this.subscribe(r.EVENTS.ON_RUN_BLOCK,function(b){a.mark(a.toNode(b),"activeBlock",b.target,b.timeout)});this.subscribe(r.EVENTS.ON_RUN_BLOCK_FAILED,function(b){a.mark(a.toNode(b),
"failedBlock",b.target,b.timeout)});this.subscribe(r.EVENTS.ON_RUN_BLOCK_SUCCESS,function(b){a.mark(a.toNode(b),"successBlock",b.target,b.timeout)});this._on("selectionChanged",this.onSelectionChanged,this)}},removeRow:function(a,b){(a=a.element||a)&&a.hightlightTimer&&!1===b&&x(a);return this.inherited(arguments)},mark:function(a,b,c,e){if(a&&this.isRendered(c)&&(c=c||{},!1!==this._highlight&&!0!==c.__ignoreChangeMark&&(e=0==e?!1:this.highlightDelay||500,a[0]._currentHighlightClass!==b))){delete a[0]._currentHighlightClass;
a[0]._currentHighlightClass=null;a[0]._currentHighlightClass=b;var f=c.getScope().id;a.removeClass("failedBlock successBlock activeBlock");a.addClass(b);c.setStatusClass(f,{className:b,delay:e});x(a[0]);!1!==e&&0<e&&(a[0].hightlightTimer=setTimeout(function(){a.removeClass(b);a.removeClass("failedBlock successBlock activeBlock");c.setStatusClass(f,null);delete a[0]._currentHighlightClass;a[0]._currentHighlightClass=null},e))}},toNode:function(a){if(a=a.target||a)if(a=this.row(a))if(a=a.element)return $(a);
return null}})})},"xblox/views/Grid":function(){define("xdojo/declare xide/types xgrid/ListRenderer xgrid/TreeRenderer xblox/views/ThumbRenderer xgrid/Grid xgrid/MultiRenderer xide/views/_LayoutMixin xgrid/Defaults xgrid/Layout xgrid/Focus xgrid/KeyboardNavigation dgrid/OnDemandGrid xide/mixins/EventedMixin xide/utils xblox/BlockActions xgrid/Search xide/widgets/_Widget".split(" "),function(g,r,q,e,c,b,a,m,t,k,p,x,y,d,h,l,n,f){c=[e,c];g=g.classFactory("multiRenderer",{},c,a.Implementation);r=b.createGridClass("xblox.views.Grid",
{options:h.clone(r.DEFAULT_GRID_OPTIONS)},{SELECTION:!0,KEYBOARD_SELECTION:!0,PAGINATION:!1,ACTIONS:r.GRID_FEATURES.ACTIONS,CONTEXT_MENU:r.GRID_FEATURES.CONTEXT_MENU,TOOLBAR:r.GRID_FEATURES.TOOLBAR,CLIPBOARD:r.GRID_FEATURES.CLIPBOARD,COLUMN_RESIZER:r.GRID_FEATURES.COLUMN_RESIZER,SPLIT:{CLASS:m},BLOCK_ACTIONS:{CLASS:l},SEARCH:{CLASS:n},WIDGET:{CLASS:f}},{RENDERER:g},{renderers:c,selectedRenderer:e},{GRID:y,LAYOUT:k,DEFAULTS:t,RENDERER:q,EVENTED:d,FOCUS:p});r.DEFAULT_RENDERERS=c;r.DEFAULT_MULTI_RENDERER=
g;return r})},"xblox/views/ThumbRenderer":function(){define(["xdojo/declare","xide/utils","dojo/dom-construct","xgrid/ThumbRenderer"],function(g,r,q,e){return g("xblox.views.ThumbRenderer",[e],{thumbSize:"400",resizeThumb:!0,deactivateRenderer:function(){$(this.domNode.parentNode).removeClass("metro");$(this.domNode).css("padding","");this.isThumbGrid=!1},activateRenderer:function(){$(this.domNode.parentNode).addClass("metro");$(this.contentNode).css("padding","8px");this.isThumbGrid=!0;this.refresh()},
renderRow:function(c){if(c.renderRow){var b=c.renderRow.apply(this,[c]);if(b)return b}var b=q.create("div",{className:"tile widget"}),a=!1,e="",g=c.icon?c.icon+" fa-5x":"fa fa-folder fa-5x",a=this._doubleWidthThumbs=!0,e=c.name,g=c.icon?c.icon+" fa-5x":"fa fa-folder fa-5x";c='\x3cdiv title\x3d"'+(e+"\n"+c.modified)+'" class\x3d"tile-content icon"\x3e'+('\x3cspan style\x3d"text-shadow: 2px 2px 5px rgba(0,0,0,0.3);font-size: 72px;opacity: 0.7" class\x3d"fa fa-6x '+g+'"\x3e\x3c/span\x3e')+'\x3c/div\x3e\x3cdiv class\x3d"brand opacity"\x3e\x3cspan class\x3d"thumbText text opacity ellipsis" style\x3d""\x3e'+
e+"\x3c/span\x3e\x3c/div\x3e";this._doubleWidthThumbs&&$(b).addClass("double");if(a)return b.innerHTML=c,b;b.innerHTML=c;return b}})})},"xblox/BlockActions":function(){define("xdojo/declare xdojo/has xide/utils xide/types xaction/DefaultActions xblox/views/BlockEditDialog xide/factory dojo/promise/all dojo/Deferred xide/views/History xfile/views/FilePreview xblox/views/BlockEditView xide/views/_CIPanelDialog xide/mixins/Electron xblox/model/variables/VariableAssignmentBlock xcf/model/Variable".split(" "),
function(g,r,q,e,c,b,a,m,t,k,p,x,y,d,h,l){var n={};g=g("xblox.BlockActions",[d],{clipboardCopy:function(){this.currentCutSelection=null;this.currentCopySelection=this.getSelection();n=null;n=this.currentCopySelection;var a=this.getClipboard();if(a){var b=this.blockScope.blocksToJson(this.currentCopySelection),b=JSON.stringify(b,null,2);a.writeText(b)}},download:function(){var a=this.blockScope.blocksToJson(),a=JSON.stringify(a);q.download("blocks.json",a)},save:function(){var a=this.userData.driver,
b=this.ctx.getFileManager(),c=this.blockScope,d=a.path.replace(".meta.json",".xblox"),a=a.scope;c&&b.setContent(a,d,c.toString(),function(){})},propertyStruct:{currentCIView:null,targetTop:null,_lastItem:null},getPropertyStruct:function(){return this.propertyStruct},setPropertyStruct:function(a){this.propertyStruct=a},onDrop:function(b,c,d,e,l,n){e=b.ctrArgs||{};var h=b.proto,m=!1;b.ctrArgs&&(e.scope=e.scope||c.scope,e.group=e.group||c.group,e.parentId=e.parentId||c.id,m=!0);if(m)c.parentId||n?n&&
c.canAdd&&null!=c.canAdd()&&c.add(h,e,null):(e.parentId=null,a.createBlock(h,e));else if("Moved"===l&&b.scope&&c.scope&&b.scope==c.scope)return b.group=null,c.scope.moveTo(b,c,d,n),b},_paste:function(a,b,c){if(a){var d=this.getSelection()[0],e,l=this.blockScope;if(b){if(!d){for(c=0;c<a.length;c++)d=a[c],d.parentId&&(d._parentOri=""+d.parentId,d.parentId=null);c=l.flatten(a);c=_.uniq(c,!1,function(a){return a.id});b=l.cloneBlocks2(c,this.newRootItemGroup);l.flatten(b);d=null;for(c=0;c<b.length;c++)l=
b[c],d||(d=l);for(c=0;c<a.length;c++)d=a[c],d._parentOri&&(d.parentId=d._parentOri,delete d._parentOri);return b}e=a[0].scope;if(e==d.scope){var n=d.canAdd()||!1,h=e.getBlockById(d.parentId);h||(h=d);c=l.flatten(a);c=_.uniq(c,!1,function(a){return a.id});a=e.cloneBlocks2(c);l=[];for(c=0;c<a.length;c++)e=a[c],e.parentId||(e.parentId=h.id,h.add(e),e=this.onDrop(e,d,!1,b,"Moved",n)),l.push(e);return l}}}},paste:function(a,b,c){if(a){var d=this.getSelection()[0],e,l=this.blockScope;if(b){if(!d){for(c=
0;c<a.length;c++)d=a[c],d.parentId&&(d._parentOri=""+d.parentId,d.parentId=null);c=l.flatten(a);c=_.uniq(c,!1,function(a){return a.id});b=l.cloneBlocks2(c,this.newRootItemGroup);l.flatten(b);d=null;for(c=0;c<b.length;c++){var n=b[c];d||(d=n)}for(c=0;c<a.length;c++)d=a[c],d._parentOri&&(d.parentId=d._parentOri,delete d._parentOri);return b}var h=a[0].scope,n=d.scope;if(h==n){var m=d.canAdd()||!1,g=h.getBlockById(d.parentId);g||(g=d);c=l.flatten(a);a=h.cloneBlocks2(c);l=[];h=d.getTopRoot();for(c=0;c<
a.length;c++){e=a[c];e.getTopRoot();if(e.parentId&&!h){var k=n.getBlockById(e.parentId);k&&_.find(a,{id:k.id})||(e.parentId=null)}e.parentId&&h&&(k=e.getTopRoot(),k.id&&h.id&&k.id!==d.id&&(e.parentId=null));e.parentId||(e.parentId=g.id,g.add(e),e=this.onDrop(e,d,!1,b,"Moved",m));l.push(e)}return l}}}},defaultActionResult:function(a){var b=new t;b.resolve({focus:!0,append:!1,delay:0,select:a,expand:!0});return b},setParentBlock:function(a){a=_.isString(a)?this.collection.getSync(a):a;this.set("collection",
this.collection.filter({parentId:a.id}));this.getHistory().push(a.id)},refreshCurrent:function(){var a=this.getHistory().getNow();a&&this.setParentBlock(a)},runAction:function(b){b=this.getAction(b);if(!b)return null;var c=this.getSelectedRenderer();if(c=c&&c.runAction?c.runAction.apply(this,[b]):null)return c;try{c=function(b,c,f){var d=new t;f=null;f=b==l?a.createBlock(b,{name:"No Title",scope:g.blockScope,group:c}):g.addItem({proto:b,ctrArgs:{scope:g.blockScope,group:c}});var e={select:[f],focus:!0,
append:!1};(b=g.refresh())&&b.then&&b.then(function(){d.resolve(e)});g.grids?_.each(g.grids,function(a){a&&a.refreshRoot&&(a.refreshRoot(),a.refresh(),a.refreshCurrent())}):g.refreshRoot&&(g.refreshRoot(),g.refresh(),g.refreshCurrent());return d};if(-1!==b.command.indexOf("Step/Insert")){var d=this.addItem(b.item,b),n=new t;n.resolve(d);return n}var h=this.getSelection(),m=h[0],g=this;if(b.command==e.ACTION.DOWNLOAD)return this.download();switch(b.command){case "File/Delete":return this.deleteBlock(h);
case "File/Reload":return this.refresh();case "Step/Run":return this.execute(h);case "Step/Stop":return this.stop(h);case "Step/Pause":return this.pause(h);case "Step/Back":return this.goBack();case "Step/Move Left":return this.reParentBlock(-1);case "Step/Move Right":return this.reParentBlock(1);case "Step/Move Up":return this.move(-1),this._itemChanged("moved",m);case "Step/Move Down":return this.move(1),this._itemChanged("moved",m);case "Step/Edit":return this.editBlock();case "Step/Open":return this.openBlock();
case "New/Variable":return console.error("new variable"),c(l,"Variables");case "File/Select/None":return this.deselectAll();case "Step/Enable":return _.each(h,function(a){a&&(a.enabled=!a.enabled);a.enabled?a.activate():a.deactivate()}),this.refreshRoot(),this.refreshCurrent(),this.defaultActionResult(h);case "View/Show/Properties":var n=new t,k=this.getRightPanel();(function(){var a=k.getSplitter();if(a){if(a.isCollapsed())return a.expand(),!0;k.collapse();return!1}})()&&this.showProperties(m);n.resolve({focus:!0,
append:!1,delay:500,select:h});this.onAfterAction("View/Show/Properties");return n;case "Step/Help":return this.showHelp(m)}}catch(p){logError(p)}return this.inherited(arguments)},reParentBlock:function(a){var b=this.getSelection()[0];if(!b)return!1;-1==a?b.unparent(this.blockGroup):b.reparent();this.deselectAll();this.refreshRoot();this.refreshCurrent();a=new t;a.resolve({focus:!0,append:!1,delay:100,select:b,expand:!0});return a},move:function(a){var b=this.getSelection();if(b&&b.length){var c=
this;_.each(b,function(b){b.move(b,a)}.bind(this));c.refresh();this.select(b,null,!0,{focus:!0,delay:10}).then(function(){c.refreshActions()})}},clipboardPaste:function(){var a=this.currentCopySelection||this.currentCutSelection||n,b=this.getClipboard();if(b&&(!a||!a[0])&&(b=b.readText()))try{var c=JSON.parse(b);if(c&&c.length){var d=this.blockScope.owner.getScope(q.createUUID(),null,!1).blocksFromJson(c);d&&d.length&&(a=d)}}catch(e){logError(e,"clipboard extraction from electron failed")}if(a&&a[0])return a=
this.paste(a,this,null!=this.currentCutSelection),c=new t,a&&(this.refreshRoot(),this.refreshCurrent(),c.resolve({focus:!0,append:!1,delay:2,select:a,expand:!0})),c},deleteBlock:function(a){var b=a[0],c=b.getParent(),b=b.next(null,-1)||b.next(null,1)||c;_.each(a,function(a){if(!a)return!1;a.remove&&a.remove();a.destroy&&a.destroy();var b=this.getStore(a);b&&(b.getSync(a[b.idProperty]),b.removeSync(a[b.idProperty]));a._destroyed=!0;a.scope._emit(e.EVENTS.ON_ITEM_REMOVED,{item:a});return!0},this);this.refreshRoot();
this.refreshCurrent();a=new t;a.resolve({focus:!0,append:!1,select:b});return a},editBlock2:function(a,b,c){function d(b){_.each(b,function(b){e.onCIChanged&&e.onCIChanged(b.ci,a,b.oldValue,b.newValue,b.ci.dst,l,b.props)});n.showProperties(a,!0)}if(a&&a.canEdit()){var e=this;b="Edit "+a.name;var l=a.getFields(),n=this;return(new y({title:b,containerClass:"CIDialog",onOk:function(a){d(a);this.headDfd.resolve(a)},onCancel:function(a){this.headDfd.resolve(a)},cis:l,CIViewClass:x,CIViewOptions:{delegate:this,
resizeToParent:!0,ciSort:!0,options:{groupOrder:{General:1,Send:2,Advanced:4,Description:5}},cis:l}})).show()}},_getText:function(a){r("debug")&&(a+="?time\x3d"+(new Date).getTime());try{var b;dojo.xhrGet({url:a,sync:!0,handleAs:"text",cache:!1,load:function(a){b=a}});return b||"No help avaiable"}catch(c){return!1}},getHelp:function(a){a=q.replaceAll(".","/",a.declaredClass);a=a.replace("xcf","xblox");a="xblox/docs/"+a.replace("xblox/model/","");a=this._getText(require.toUrl(a)+".md");if(!a)return!1;
"undefined"!==typeof showdown&&(a=(new showdown.Converter).makeHtml(a));return a},showHelp:function(a,b){function c(a,b){var d=e.getHelp(b);d&&a.html(d);a.addClass("xbloxHelp")}var d=this.row(a).element,e=this;if(this._preview)this._preview.open(),c(this._preview.preview,a);else{var l=new p({node:$(d),parent:$(d),ctx:e.ctx,container:b?b.containerNode:null,title:"Help"});b?l.buildRenderingEmbedded():l.buildRendering();l.init();l.exec();this._preview=l;this._preview.handler=this;l.onOpened=function(){c(l.preview,
a)};this.add(l,null,!1);e._on("selectionChanged",function(a){0!=e._preview.getstate()&&(a=e.getSelectedItem())&&(l.item=a,c(e._preview.preview,a))})}},getHistory:function(){this._history||(this._history=new k);return this._history},goBack:function(){function a(b){n.resolve({select:b?b:l.getRows()[0],focus:!0,append:!1,delay:250})}var b=this.collection,c=this.getHistory(),d=null,e=c.getNow(),l=this,n=new t;c.pop();(d=c.getNow())&&b.getSync(d)?(this.set("collection",this.collection.filter({parentId:d})),
a()):(b.reset(),this.refreshRoot(),a(b.getSync(e)));return n},openBlock:function(a,b,c){if(a=this.getSelection()[0]||a){b=new t;var d=this;this.setParentBlock(a);c=!0;(a=d.getRows()[0])||setTimeout(function(){d.contentNode.focus()},10);b.resolve({select:!1!==c?a:null,focus:!0,append:!1,delay:1});return b}},editBlock:function(a,b,c){if(a=this.getSelection()[0]||a){var d=new t;a.getChildren();this.editBlock2(a,null).then(function(){d.resolve({select:[a],focus:!0,append:!1,delay:1})});return d}},execute:function(a){var b=
this,c=[],d=[],l=e.EVENTS;a=_.isArray(a)?a:[a];_.each(a,function(a){var e=a._on(l.ON_RUN_BLOCK,function(c){b.mark(b.toNode(c),"activeBlock",a)}),f=a._on(l.ON_RUN_BLOCK_SUCCESS,function(c){b.mark(b.toNode(c),"successBlock",a)}),n=a._on(l.ON_RUN_BLOCK_FAILED,function(c){b.mark(b.toNode(c),"failedBlock",a)});if(a&&a.scope){try{var h=a.scope.solveBlock(a,{highlight:!0,force:!0,listener:b});c.push(h)}catch(m){logError(m,"excecuting block -  "+a.name+" failed! : ")}d=d.concat([e,n,f]);return!0}console.error("have no scope")});
m(c).then(function(){_.invoke(d,"remove")})},stop:function(a){a=_.isArray(a)?a:[a];_.each(a,function(a){if(a&&a.scope){try{a.stop(!0)}catch(b){logError(b,"stop block -  "+a.name+" failed! : ")}return!0}console.error("have no scope")})},pause:function(a){a=_.isArray(a)?a:[a];_.each(a,function(a){if(a&&a.scope){try{a.pause(!0)}catch(b){logError(b,"pause block -  "+a.name+" failed! : ")}return!0}console.error("have no scope")})},getAddActions:function(b){var c=this.inherited(arguments)||[];b=b||{};c=
a.getAllBlocks(this.blockScope,this,b,this.blockGroup,!1);this.publish(e.EVENTS.ON_BUILD_BLOCK_INFO_LIST_END,{items:c,view:this,owner:this.owner,item:b,group:this.blockGroup,scope:this.blockScope});this._emit(e.EVENTS.ON_BUILD_BLOCK_INFO_LIST_END,{items:c,view:this,owner:this.owner});return c},getBlockActions:function(a){function b(){var a=g.getSelection();return a&&a.length&&a[0]?a:null}function c(){return b()?!1:!0}function d(){var a=b();if(!a)return!0;a=a[0];return"Step/Move Up"===this.command?
!a.canMove(null,-1):!a.canMove(null,1)}function l(a,b){for(var c=0;c<b.length;c++){var d=b[c];p=d.name;var e=a+"/"+p,f=!_.isEmpty(d.items);n.push(g.createAction({label:p,command:e,icon:d.iconClass,tab:"Home",group:"Insert",mixin:q.mixin({item:d,quick:!0},t)}));f&&l(e,d.items)}}var n=this.inherited(arguments)||[],m=e.ACTION_ICON,g=this,k=g.getActionStore(),t={addPermission:!0};n.push(g.createAction({label:"Save",command:"File/Save",icon:"fa-save",tab:"Home",group:"File",keycombo:["ctrl s"],mixin:q.mixin({quick:!0},
t)}));n.push(g.createAction({label:"Save As",command:"File/Save As",icon:"fa-save",tab:"Home",group:"File",mixin:t}));n.push(this.createAction({label:"Open",command:"Step/Open",icon:"fa-folder-open",keycombo:["ctrl enter"],tab:"Home",group:"Navigation",shouldDisable:c,mixin:q.mixin({quick:!0},t)}));n.push(g.createAction({label:"Go up",command:"Step/Back",icon:m.GO_UP,tab:"Home",group:"Navigation",keycombo:["backspace"],mixin:{quick:!0}}));n.push(g.createAction({label:"Run",command:"Step/Run",icon:"text-success fa-play",
tab:"Home",group:"Step",keycombo:["r"],shouldDisable:c,mixin:q.mixin({quick:!0},t)}));n.push(g.createAction({label:"Stop",command:"Step/Stop",icon:"text-warning fa-stop",tab:"Home",group:"Step",keycombo:["s"],shouldDisable:c,mixin:q.mixin({quick:!0},t)}));n.push(g.createAction({label:"Pause",command:"Step/Pause",icon:"text-info fa-pause",tab:"Home",group:"Step",keycombo:["p"],shouldDisable:c,mixin:q.mixin({quick:!0},t)}));n.push(g.createAction({label:"MoveUp",command:"Step/Move Up",icon:"fa-arrow-up",
tab:"Home",group:"Move",keycombo:["alt up"],shouldDisable:d,mixin:q.mixin({quick:!0},t)}));n.push(g.createAction({label:"MoveDown",command:"Step/Move Down",icon:"fa-arrow-down",tab:"Home",group:"Move",keycombo:["alt down"],shouldDisable:d,mixin:q.mixin({quick:!0},t)}));n.push(g.createAction({label:"MoveLeft",command:"Step/Move Left",icon:"fa-arrow-left",tab:"Home",group:"Move",keycombo:["alt left"],shouldDisable:d,mixin:q.mixin({quick:!0},t)}));n.push(g.createAction({label:"MoveRight",command:"Step/Move Right",
icon:"fa-arrow-right",tab:"Home",group:"Move",keycombo:["alt right"],shouldDisable:function(){var a=g.getSelection();return a?(a=a[0])?"Step/Move Left"===this.command?!a.getParent():a.getParent():!0:!0},mixin:q.mixin({quick:!0},t)}));n.push(g.createAction({label:"Help",command:"Step/Help",icon:"fa-question",tab:"Home",group:"Step",keycombo:["h"],shouldDisable:c,mixin:q.mixin({quick:!0},t)}));n.push(g.createAction({label:"On",command:"Step/Enable",icon:"fa-toggle-off",tab:"Home",group:"Step",keycombo:["alt o"],
shouldDisable:c,mixin:q.mixin({actionType:"multiToggle",quick:!0},t),onCreate:function(a){a.set("value",!0);a.setVisibility(e.ACTION_VISIBILITY.RIBBON,{group:"Common"})},onChange:function(a,b){var c=g.getSelectedItem();c&&c.set("enabled",b);this.value=b;g.refreshActions()}}));n.push(this.createAction({label:"Variable",command:"New/Variable",icon:"fa-code",tab:"Home",group:"Insert",mixin:q.mixin({quick:!0},t)}));n.push(this.createAction({label:"Edit",command:"Step/Edit",icon:m.EDIT,keycombo:["f4",
"enter","dblclick"],tab:"Home",group:"Step",shouldDisable:c,mixin:q.mixin({quick:!0},t)}));n.push(g.createAction({label:"Properties",command:"View/Show/Properties",icon:"fa-gears",tab:"Home",group:"Show",keycombo:["alt p"],shouldDisable:c,mixin:q.mixin({actionType:"multiToggle",value:!0,quick:!0},t),onCreate:function(a){g.getRightPanel().getSplitter();a.set("value",!0)},onChange:function(a,b){var c=g.getRightPanel();var d=c.getSplitter();d?d.isCollapsed()?(d.expand(),c=!0):(c.collapse(),c=!1):c=void 0;
c&&g.showProperties(null);g.onAfterAction("View/Show/Properties");return!0}}));var m=this.getAddActions(),p="";n.push(g.createAction({label:"Add Block",command:"Step/Insert",icon:"fa-plus",tab:"Home",group:"Insert",mixin:q.mixin({quick:!0},t)}));l("Step/Insert",m);n.push(g.createAction({label:"Set Variable",command:"Step/Insert/Set Variable",icon:"fa-paper-plane",tab:"Home",group:"Step",mixin:q.mixin({global:!0,quick:!0,getActions:function(a,b){for(var c=g.blockScope.getVariables(),d=[],e=0;e<c.length;e++){var f=
c[e];d.push(g.createAction({label:f.name,command:"Step/Insert/Set Variable/"+f.name,icon:"fa-paper-plane",tab:"Home",group:"Step",mixin:q.mixin({item:f,proto:h,custom:!0,ctrArgs:{variable:f.id,variableId:f.id,scope:g.blockScope,value:"0"}},t)}))}return d}},t)}));this.blockScope.getVariables();n.push(g.createAction({label:"None",command:"Step/Insert/Set Variable/None",icon:"fa-paper-plane",tab:"Home",group:"Step",mixin:q.mixin({proto:h,item:h,quick:!0,ctrArgs:{scope:this.blockScope,value:"0"}},t)}));
this._emit("onAddActions",{actions:n,permissions:a,store:k});return n}});g.BLOCK_INSERT_ROOT_COMMAND="Step/Insert";return g})},"xblox/views/BlockEditDialog":function(){define(["dcl/dcl","xdojo/declare","xide/views/_CIDialog","xide/utils","xblox/views/BlockEditView"],function(g,r,q,e,c){return g(q,{bodyCSS:{height:"auto","min-height":"400px"},declaredClass:"xblock.views.BlockEditDialog",onSave:function(b,a){b.dst&&this.item[b.dst]&&(this.item[b.dst]=a)},__initWithCIS:function(b){this.cisView=e.addWidget(c,
{delegate:this,options:{groupOrder:{General:0,Advanced:1,Description:2}},cis:b},this,this.containerNode,!0)},__onOk:function(){for(var b=this.cisView.getCIS(),b=e.toOptions(b),a=0;a<b.length;a++){var c=b[a],g=c.dst;if(!(null==g||null==this.item[g]||null!=c.active&&!1===c.active&&!1===c.changed||this.item[c.dst]==c.value&&this.item[c.dst]===c.value)){if(this.item.onChangeField)this.item.onChangeField(c.dst,c.value);this.item[c.dst]=c.value}}if(this.delegate&&this.delegate.onOk)this.delegate.onOk(this,
this.item);try{this.hide()}catch(k){}return!0},initWithBlock:function(b){(b=b.getFields())&&this.initWithCIS(b)},startup:function(){this._started||(this.inherited(arguments),this.item&&this.initWithBlock(this.item),this.addActionButtons(),this.inherited(arguments))}})})},"xblox/views/BlockEditView":function(){define(["dcl/dcl","xide/views/CIView"],function(g,r){return g([r],{declaredClass:"xblox.views.BlockEditView",onSave:function(g,e){if(this.delegate&&this.delegate.onSave)this.delegate.onSave(g,
e)}})})},"xblox/manager/BlockManagerUI":function(){define(["dcl/dcl","xide/types","xide/utils","xblox/views/BlockEditDialog","xide/manager/BeanManager"],function(g,r,q,e,c){return g(c,{declaredClass:"xblox/manager/BlockManagerUI",blockTreeView:null,targetTop:null,targetBottom:null,currentCIView:null,lastSelectedTopTabTitle:null,updatePalette:!0,_contextChanged:!1,ignoreItemSelection:!1,renderNewTab:!1,onReloaded:function(){},onSetWidgetPropertyActions:function(b){},init:function(){},editBlock:function(b,
a,c){if(b.canEdit()){var g="Edit ",k=this;b.title?g+=b.title:b.name&&(g+=b.name);try{var p=new e({item:b,title:g,style:"width:400px",resizeable:!0,delegate:{onOk:function(e,d){a&&a(b);k.publish(r.EVENTS.ON_BLOCK_PROPERTY_CHANGED,{item:b});if(!1!==c)k.onBlockSelected({item:b,owner:this.currentCIView})}}})}catch(q){}p.show();p.resize()}},onCIUpdate:function(b){if(b.owner&&b.owner.source&&b.owner.source.delegate&&b.owner.item&&b.owner.delegate===this&&!b._processedBMUI){b._processedBMUI=!0;for(var a=
b.owner.getCIS(),c=b.owner.item,e=q.toOptions(a),g=0;g<e.length;g++){var p=e[g],x=p.dst;if(!(null==x||null==c[x]||null!=p.active&&!1===p.active&&!1===p.changed||c[p.dst]==p.value&&c[p.dst]===p.value)){if(c.onChangeField)c.onChangeField(p.dst,p.value,a,b.owner);c[p.dst]=p.value;c.set&&c.set(p.dst,p.value)}}this.publish(r.EVENTS.ON_BLOCK_PROPERTY_CHANGED,{item:c});b.owner.source.delegate.save()}},destroyWidgets:function(){},onActionContextChanged:function(b){},shouldChangeActionContext:function(b){return!(b&&
b.scope)},onReady:function(){this.subscribe([r.EVENTS.ON_CI_UPDATE])},onBlockSelected:function(b){},createBlockTreeView:function(b,a,c){return q.addWidget(BlockTreeView,{title:a||"Blocks",style:"padding:0px"},this,b,!0)}})})},"xblox/views/BlocksFileEditor":function(){define("dcl/dcl dojo/_base/lang dojo/_base/declare xide/factory xide/utils xblox/model/variables/Variable dojo/Deferred xide/views/_CIDialog xide/types xide/views/_LayoutMixin xblox/views/BlockGrid xaction/ActionProvider xide/layout/Container xdocker/Docker2 xide/views/_CIPanelDialog".split(" "),
function(g,r,q,e,c,b,a,m,t,k,p,x,y,d,h){m=g(k.dcl,{rootPanel:null,_lastTab:null,getDocker:function(){this._docker||(this._docker=d.createDefault(this.containerNode),this.add(this._docker));return this._docker},getRootContainer:function(a){if(this.rootPanel)return this.rootPanel;this.reparent=!0;var b=this.getDocker(),d=t.DOCKER;return this.rootPanel=b.addTab(null,c.mixin({icon:!1,closeable:!0,moveable:!0,tabOrientation:d.TAB.TOP,location:d.DOCK.STACKED},a))},createLayout:function(){this.rootPanel||
(this.rootPanel=this.getRootContainer({title:"test"}));return this.rootPanel},startup:function(){},getPropertyStruct:function(){return this.propertyStruct},setPropertyStruct:function(a){this.propertyStruct=a},getGroupContainer:function(){return this.rootPanel},createGroupView:function(a,b,d,e,g,h,m){a=t.DOCKER;b={icon:g,closeable:!0,moveable:!0,title:b,target:this._lastTab||this.rootPanel,tabOrientation:a.TAB.TOP,location:a.DOCK.STACKED};this._lastTab=m=this.getDocker().addTab(null,c.mixin(b,m));
this.tabs.push(m);return m}});q=q("BlockGrid",p,{_refresh:function(a){(a=this.getHistory().getNow())&&this.setParentBlock(a);return res},__select:function(a){return this.inherited(arguments)},move:function(a){var b=this.getSelection();if(b&&b.length){var c=this;_.each(b,function(b){b.move(b,a)});c.refreshRoot();c.refreshCurrent();this.select(b,null,!0,{focus:!0,delay:10}).then(function(){c.refreshActions()})}},reParentBlock:function(b){var c=this.getSelection()[0];if(!c)return!1;-1==b?c.unparent(this.blockGroup):
c.reparent();this.deselectAll();this.refreshRoot();this.refreshCurrent();b=new a;b.resolve({focus:!0,append:!1,delay:100,select:c,expand:!0});return b},defaultActionResult:function(b){var c=new a;c.resolve({focus:!0,append:!1,delay:0,select:b,expand:!0});return c},runAction:function(a){this.getSelection();this.getSelection();return this.inherited(arguments)}});return g([y,m,x.dcl],{declaredClass:"xblox.views.BlocksFileEditor",registerView:!1,_item:null,cssClass:"bloxEditor",blockManager:null,blockManagerClass:"xblox.manager.BlockManager",
model:null,store:null,tree:null,currentItem:null,didLoad:!1,selectable:!1,beanType:"BLOCK",newGroupPrefix:"",_debug:!1,blockScope:null,groupContainer:null,canAddGroups:!0,gridClass:q,activeGrid:null,activeTab:null,registerGrids:!0,visibileTab:null,setVisibleTab:function(a){this.visibileTab=a},getVisibleTab:function(){return this.visibileTab},constructor:function(a,b){c.mixin(this,a)},onGridAction:function(a){var b=t.ACTION;switch((a.action?a.action:a).command){case b.SAVE:return this.save()}},clearGroupViews:function(a){this.getGroupContainer();
_.each(this.tabs,function(a){a.destroy()});delete this.tabs;this.destroyWidgets()},getContainerLabel:function(a){var b=""+a;c.isNativeEvent(a)&&(b=b.replace("on",""));if(-1!==a.indexOf(t.EVENTS.ON_DRIVER_VARIABLE_CHANGED)){var d=this.ctx.getDeviceManager(),b=this.ctx.getDriverManager(),e=a.split("__")[1],d=(e=d.getDeviceByUrl(e))?d.getMetaValue(e,t.DEVICE_PROPERTY.CF_DEVICE_TITLE):"Invalid Device";a=b.getBlock(a);b="("+d+"/"+(a?a.name:"Unknown Variable")+")"}return b},addNewBlockGroup:function(a){if(a){var b=
this.blockScope,c=this.getContainerLabel(a),c=this.createGroupView(null,c,b,!0,"fa-bell");a=this.newGroupPrefix+a;b=this.createGroupedBlockView(c,a,b,{newRootItemGroup:a});this.activeGrid=c.grid=b;c.select()}},createGroupedBlockView:function(a,b,d,e,g){var h=this;g=g||this.gridClass;var m=d.blockStore;this._lastTab&&!this.__right&&(this.__right=this.getRightPanel(null,null,"DefaultFixed",{target:this._lastTab}));b={__right:this.__right,ctx:this.ctx,blockScope:d,blockGroup:b,attachDirect:!0,resizeToParent:!0,
collection:m.filter({group:b}),_parent:a,getPropertyStruct:this.getPropertyStruct,setPropertyStruct:this.setPropertyStruct};e&&r.mixin(b,e);var k=c.addWidget(g,b,null,a,!1);k.__editorActions||(k.__editorActions=!0,this.addGridActions(k,k));a.grid=k;k._on("selectionChanged",function(a){h._emit("selectionChanged",a)});k._on("onAfterAction",function(a){h.onGridAction(a)});a.on(t.DOCKER.EVENT.VISIBILITY_CHANGED,function(b){b?(h.setVisibleTab(a),k.onShow(),h.getRightPanel().getSplitter().isCollapsed()||
k.showProperties(k.getSelection()[0]),k.__last&&(k._restoreSelection(),k.focus(k.row(k.__last.focused)))):k.__last=k._preserveSelection()});this.registerGrids&&this.ctx.getWindowManager().registerView(k,!1);a._widgets||(a._widgets=[]);a.add(k);return k},getDeviceVariablesAsEventOptions:function(a){for(var b=[],c=function(a,b,c,d,e){d="";if(0<c)for(var f=0;f<c;f++)d+="\x26nbsp;",d+="\x26nbsp;",d+="\x26nbsp;";return{label:d+("\x3cspan style\x3d''\x3e"+a+"\x3c/span\x3e"),label2:e,value:b}},d=this.ctx.getDeviceManager(),
e=d.getDevices(!1,!0),g=0;g<e.length;g++){var h=e[g],k=h.driver;if(k){var m=d.getMetaValue(h,t.DEVICE_PROPERTY.CF_DEVICE_TITLE),h=d.getMetaValue(h,t.DEVICE_PROPERTY.CF_DEVICE_ID);b.push(c(m,k.id+"/"+k.id,a,!1));for(var p=k.blockScope.getVariables(),q=0;q<p.length;q++){var r=p[q];b.push(c(r.name,t.EVENTS.ON_DRIVER_VARIABLE_CHANGED+"__"+h+"__"+k.id+"__"+r.id,a+1,!1,m+"/"+r.name))}}}return b},openNewGroupDialog:function(){var a=[],b=function(a,b,c,d){var e="";if(0<c)for(var f=0;f<c;f++)e+="\x26nbsp;",
e+="\x26nbsp;",e+="\x26nbsp;";return{label:e+(!0!==d?"\x3cspan style\x3d''\x3e"+a+"\x3c/span\x3e":a),value:b,label2:a}};a.push(b("HTML","",0));a=a.concat([b("onclick","click",1),b("ondblclick","dblclick",1),b("onmousedown","mousedown",1),b("onmouseup","mouseup",1),b("onmouseover","mouseover",1),b("onmousemove","mousemove",1),b("onmouseout","mouseout",1),b("onkeypress","keypress",1),b("onkeydown","keydown",1),b("onkeyup","keyup",1),b("onfocus","focus",1),b("onblur","blur",1),b("onchange","change",
1),b("input","input",1),b("load","load",1)]);a.push(b('\x3cspan class\x3d"text-default"\x3eDevice Variable Changed\x3c/span\x3e',"",0,!0));var a=a.concat(this.getDeviceVariablesAsEventOptions(1)),d=this,a=new h({title:"Create a new block group",style:"width:500px;min-height:200px;",size:t.DIALOG_SIZE.SIZE_NORMAL,resizeable:!0,onOk:function(a){if(a&&a[0]&&"variable"===a[0].dst){a=a[0].newValue;var b=c.parse_url(a);c.urlArgs(b.host);d.addNewBlockGroup(t.EVENTS.ON_DRIVER_VARIABLE_CHANGED+"__"+a)}else a&&
a[0]&&d.addNewBlockGroup(a[0].newValue)},cis:[c.createCI("Event",t.ECIType.ENUMERATION,"",{group:"Event",delegate:null,options:a,value:"HTML",title:"Select an event \x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;",widget:{search:!0,"class":"xide.form.FilterSelect"}}),c.createCI("value","xcf.widgets.CommandPicker","",{group:"Event",title:" ",
dst:"variable",pickerType:"variable",value:" Select Driver Variable ",block:{scope:{ctx:d.ctx}},widget:{labelField:"name",valueField:"id",value:"Select Driver Variable",query:[{group:"basicVariables"},{group:"processVariables"}]}})]});this.add(a);return a.show()},onGroupsCreated:function(){},getActionStore:function(){return this.activeGrid?this.activeGrid.getActionStore():null},getTabContainer:function(){return this.groupContainer},onReloaded:function(){this.destroyWidgets();this.openItem(this._item)},
openItem:function(b){var c=new a;this._item=b;var d=this;this.getBlockManager().load(b.mount,b.path).then(function(a){d.initWithScope(a);c.resolve(d)});return c},initWithContent:function(a){var b=null;try{b=c.getJson(a)}catch(d){console.error("invalid block data")}b&&this.initWithData(b)},initWithScope:function(a){this.blockScope=a;var b=a.allGroups();-1==b.indexOf("Variables")&&b.push("Variables");-1==b.indexOf("Events")&&b.push("Events");-1==b.indexOf("On Load")&&b.push("On Load");this.renderGroups(b,
a)},getScopeUserData:function(){return{owner:this}},initWithData:function(a){this.onLoaded();var b=c.createUUID(),d=a,e=a;!r.isArray(a)&&r.isObject(a)&&(b=a.scopeId||b,d=a.blocks||[],e=a.variables||[]);this.blockManager=a=this.getBlockManager();for(var g=this.getScopeUserData(),b=a.getScope(b,g,!0),d=b.blocksFromJson(d),g=0;g<d.length;g++)d[g]._lastRunSettings={force:!1,highlight:!0};b.variablesFromJson(e);a.onBlocksReady(b);if(d)return this.initWithScope(b)},destroyWidgets:function(){this.blockManager&&
this.blockScope&&this.blockManager.removeScope(this.blockScope.id);this.blockManager=null},destroy:function(){this.destroyWidgets();delete this.tabs;delete this.propertyStruct;delete this.visualEditor;delete this.widget;delete this.params;delete this.pageEditor;delete this.editorContext;delete this.activeGrid;this.delegate=this.blockScope=this.__right=this.docker=this.ctx=this._parent=this.item=null},getBlockManager:function(){if(!this.blockManager){if(this.ctx.blockManager)return this.ctx.blockManager;
this.blockManager=e.createInstance(this.blockManagerClass,{ctx:this.ctx})}return this.blockManager},getActiveGrid:function(){return this.activeGrid},runAction:function(a){return"File/New Group"==a.command?(this.openNewGroupDialog(),null):this.getActiveGrid().runAction(arguments)},addGridActions:function(a,b){var d=[],e={addPermission:!0};d.push(this.createAction({label:"New Group",command:"File/New Group",icon:"fa-magic",tab:"Home",group:"File",keycombo:["f7"],mixin:c.mixin({quick:!0},e)}));d.push(this.createAction({label:"Delete Group",
command:"File/Delete Group",icon:"fa-remove",tab:"Home",group:"File",keycombo:["ctrl f7"],mixin:c.mixin({quick:!0},e)}));(b||this).addActions(d)},onShowGrid:function(a){},renderGroup:function(a,d,e){d=d||this.blockScope;var g=this,h=a.replace(this.newGroupPrefix,"");c.isNativeEvent(a)&&(h=h.replace("on",""));var h=this.getContainerLabel(a.replace(this.newGroupPrefix,"")),k="Variables"===a,h=this.createGroupView(null,h,d,!k,k?" fa-info-circle":"fa-bell",!k),k={};"Variables"===a&&(k.newRootItemFunction=
function(){try{new b({title:"No-Title-Yet",type:13,value:"No Value",enumType:"VariableType",save:!1,initialize:"",group:"Variables",id:c.createUUID(),scope:d})}catch(a){debugger}},k.onGridDataChanged=function(a){var b=a.item;b&&(b[a.field]=a.newValue);g.save()},k.showAllBlocks=!1,k.newRootItemLabel="New Variable",k.newRootItemIcon="fa-code",k.storeField="variableStore",k.gridParams={cssClass:"bloxGridView",getColumns:function(){return[{label:"Name",field:"title",sortable:!0},{label:"Value",field:"value",
sortable:!1}]}});k.newRootItemGroup=a;a=this.createGroupedBlockView(h,a,d,k,e);h.blockView=a;!this.activeGrid&&(this.activeGrid=a);return a},renderGroups:function(a,b){this._isCreating=!0;this.activeGrid=null;this.tabs=[];this._lastTab=null;this.setPropertyStruct({currentCIView:null,targetTop:null,_lastItem:null,id:c.createUUID()});for(var d=0;d<a.length;d++){var e=a[d];if(""!=this.newGroupPrefix||-1===e.indexOf("__"))try{var g=b.getBlocks({group:e});("Variables"===e||g&&g.length)&&this.renderGroup(e,
b)}catch(h){logError(h)}}this.tabs&&this.tabs[0]&&(this.tabs[0].silent=!0,this.tabs[0].select(),this.tabs[0].silent=!1)},onSave:function(a){this.save()},save:function(){if(this.blockScope){var a=this.ctx.getFileManager(),b=this.item;a.setContent(b.mount,b.path,this.blockScope.toString(),function(){})}}})})},"xblox/model/Block_UI":function(){define(["dcl/dcl","xide/utils","xide/types","xide/data/Source","xaction/ActionProvider"],function(g,r,q,e,c){return g([e.dcl,c.dcl],{_statusIcon:null,_statusClass:null,
getStatusIcon:function(){return this._statusIcon},getStatusClass:function(b){return this._statusClass?this._statusClass[b]:null},setStatusClass:function(b,a){this._statusClass||(this._statusClass={});delete this._statusClass[b];a&&(this._statusClass[b]=a)},declaredClass:"xblox.model.Block_UI",description:"No Description",canDelete:!0,renderBlockIcon:!0,_getText:function(b){var a;dojo.xhrGet({url:b,sync:!0,handleAs:"text",load:function(b){a=b}});return""+a+""},getHelp:function(){},getIcon:function(b,
a,c){return'\x3cspan style\x3d"'+(a||"")+'" class\x3d"'+b+'"\x3e\x3c/span\x3e '+(c||"")},makeEditable2:function(b,a,c,e,g){return'\x3ca tabIndex\x3d"-1" pos\x3d\''+a+"' display-mode\x3d'"+(g||"popup")+"' display-type\x3d'"+(c||"text")+"' data-prop\x3d'"+b+"' data-title\x3d'"+e+"' class\x3d'editable'  href\x3d'#'\x3e"+this[b]+"\x3c/a\x3e"},makeEditable:function(b,a,c,e,g){return"\x3ca  data-value\x3d'"+this[b]+"' tabIndex\x3d'-1' pos\x3d'"+a+"' display-mode\x3d'"+(g||"popup")+"' display-type\x3d'"+
(c||"text")+"' data-prop\x3d'"+b+"' data-title\x3d'"+e+"' class\x3d'editable'  href\x3d'#'\x3e"+this[b]+"\x3c/a\x3e"},canMove:function(b,a){b=b||this;if(!b)return!1;var c=b.getParent(),e=null;if(c){e=c[c._getContainer(b)];if(!e||2>e.length||!this.containsItem(e,b))return!1;c=this.indexOf(e,b);if(0>c+a||!e[c+a])return!1}else return e=this._store.storage.fullData,null!=this.next(e,a);return!0},move:function(b,a){b=b||this;if(!b)return!1;var c=b.getParent(),e=null,g=b._store;if(c){e=c[c._getContainer(b)];
if(!e||2>e.length||!this.containsItem(e,b))return!1;c=this.indexOf(e,b);if(0>c+a)return!1;g=e[c+a];if(!g)return!1;e[c+a]=b;e[c]=g}else{var p=function(a,b,c){var d=a.indexOf(b,a),e=b[d+c*r];if(e){if(!e.parentId&&e.group&&e.group===a.group)return q=d+c*r,e;r++;return p(a,b,c)}return null};g&&b.group&&(e=g.storage.fullData);var q=0,r=1,c=this.indexOf(e,b);if(0>c+a)return!1;var d=p(b,e,a);if(!d)return!1;e[q]=b;e[c]=d;g._reindex()}return!0},onActivity:function(b,a,c,e){e=e||{};e.target=b;this._emit(c,
e,b);this.publish(c,e,b)},onRun:function(b,a,c){var e=a&&a.highlight;if(b&&e)this.onActivity(b,a,q.EVENTS.ON_RUN_BLOCK,c);this._statusIcon="text-info fa-spinner fa-spin"},onFailed:function(b,a,c){var e=a&&a.highlight;if(b&&e)this.onActivity(b,a,q.EVENTS.ON_RUN_BLOCK_FAILED,c);this._statusIcon="text-danger fa-exclamation"},onSuccess:function(b,a,c){var e=a&&a.highlight;if(b&&e)this.onActivity(b,a,q.EVENTS.ON_RUN_BLOCK_SUCCESS,c);this._statusIcon="text-success fa-check"},canDisable:function(){return!0},
getDefaultFields:function(b,a,c){a=[];this.canDisable&&!1!==this.canDisable()&&a.push(r.createCI("enabled",0,this.enabled,{group:"General",title:"Enabled",dst:"enabled",actionTarget:"value",order:210}));a.push(r.createCI("description",26,this.description,{group:"Description",title:"Description",dst:"description",useACE:!1}));!1!==b&&a.push(r.createCI("icon",17,this.icon,{group:"General",title:"Icon",dst:"icon",useACE:!1,order:206}));!1!==c&&a.push(r.createCI("outlet",5,this.outlet,{group:"Special",
title:"Type",dst:"outlet",order:205,data:[{value:1,label:"Progress",title:"Excecuted when progress"},{value:2,label:"Error",title:"Excecuted when errors"},{value:4,label:"Paused",title:"Excecuted when paused"},{value:8,label:"Finish",title:"Excecuted when finish"},{value:16,label:"Stopped",title:"Excecuted when stopped"}],widget:{hex:!0}}));this.sharable&&a.push(r.createCI("enabled",13,this.shareTitle,{group:"Share",title:"Title",dst:"shareTitle",toolTip:"Enter an unique name to share this block!"}));
return a},getFields:function(){return this.getDefaultFields()},toFriendlyName:function(b){for(var a="[](){}".split(""),c=0;c<a.length;c++)b=b.replace(a[c],"");b=r.replaceAll("\x3d\x3d"," equals ",b);b=r.replaceAll("\x3c"," is less than ",b);b=r.replaceAll("\x3d\x3c"," is less than ",b);b=r.replaceAll("\x3e"," is greater than ",b);b=r.replaceAll("\x3e\x3d"," is greater than ",b);return b=r.replaceAll("'","",b)},getIconClass:function(){return this.icon},getBlockIcon:function(b){return 1==this.renderBlockIcon?
'\x3cspan class\x3d"xBloxIcon '+this.icon+'"\x3e'+(b||"")+"\x3c/span\x3e":""},onFieldsRendered:function(b,a){},onChangeField:function(b,a){"enabled"==b&&(1==a?this.activate():this.deactivate())},destroy:function(){this.setStatusClass(this.getScope().id,null)}})})},"xblox/RunScript":function(){define("dojo/_base/lang dojo/on dcl/dcl delite/register delite/CustomElement xide/factory/Events xide/utils/StringUtils xide/types/Types xblox/model/Referenced xide/mixins/EventedMixin xide/mixins/ReloadMixin xwire/Binding xwire/EventSource xwire/WidgetTarget".split(" "),
function(g,r,q,e,c,b,a,m,t,k,p,x,y,d,h){b={declaredClass:"xblox/RunScript",targetevent:"",sourceevent:"",sourceeventvaluepath:"",sourceeventnamepath:"",targetproperty:"",targetvariable:"",targetfilter:"",script:"",bidirectional:!1,blockGroup:"",block:"",_targetBlock:null,_targetReference:null,_appContext:null,_complete:!1,enabled:!0,stop:!1,_events:[],context:null,accept:"",transform:"",mode:0,_2wayHandle:null,binding:null,reset:function(){this._destroyHandles();this._2wayHandle&&this._2wayHandle.remove();
this.binding&&this.binding.destroy();delete this.binding;this._targetReference=this._appContext=null},onSettingsChanged:function(a){this.reset();if(this.enabled)this.onAppReady(null)},getChildren:function(){return[]},destroy:function(){this.onDestroy&&this.onDestroy();this.reset();delete this.binding},run:function(a,b){if(this.enabled){var c={};if(this.context&&this.context.delegate){if(this.context.delegate.isDesignMode&&this.context.delegate.isDesignMode())return;this.context.delegate.getBlockSettings&&
(c=this.context.delegate.getBlockSettings())}var d=this._targetBlock,e=this._targetReference;d&&e&&(d.context=e,d._targetReference=e,this.targetvariable&&this.targetvariable.length&&null!=b&&(d.override={variables:{}},d.override.variables[this.targetvariable]=b),d.solve(d.scope,c))}},onReady:function(){this._targetReference||this._setupTargetReference();this._targetReference&&!0===this.bidirectional&&this.sourceevent&&this.sourceevent.length&&!this.binding&&this._setup2WayBinding();if(!this._complete){this._targetReference||
console.error("have no target reference");this._targetBlock||console.error("have no target block");if(this._targetReference&&this._targetBlock){if(this.targetevent){this._complete=!0;g.mixin(this._targetReference,k.prototype);var b=this._targetReference.domNode||this._targetReference,c=this.targetevent,d=this._targetReference.declaredClass||this._targetReference.startup,e=null!=this._targetReference.on&&null!=this._targetReference["on"+a.capitalize(c)],h=null,m=null!=b.render&&null!=b.on,p=this;if(d&&
this._targetReference.baseClass&&-1!=this._targetReference.baseClass.indexOf("dijitContentPane")||null!=this._targetReference.render||null!=this._targetReference.on)d=!1;b?(m||e&&d?(b=this._targetReference,m?h=b.on(this.targetevent,function(a){this.stop&&(a.preventDefault(),a.stopImmediatePropagation());this.run(this.targetevent,a.currentTarget.value)}.bind(this)):(c="on"+a.capitalize(c),this._targetReference[c]=function(a,c){!0!==b.ignore&&p.run(p.targetevent,a)})):h=r(b,this.targetevent,function(a){this.run(this.targetevent)}.bind(this)),
h&&this._events.push(h)):console.error("have no target to wire")}}else console.error("invalid params, abort",this);this.binding&&this.binding.start()}},resolveBlock:function(a){var b=this._appContext.getDeviceManager();if(-1!==a.indexOf("://")&&b&&(a=b.getBlock(this.block)))return a},_setBlock:function(b){if((b=b||window.appContext)&&b.getBlockManager){this._appContext=b;var c=b.getBlockManager();b=b.getDeviceManager();var d=this;if(c){var e=this.block?this.block:this.getAttribute("block");if(e&&
0<e.length){var g=a.parse_url(e);-1!==e.indexOf("://")?b&&(c=b.getBlock(e))&&(d._targetBlock=c,d.onReady()):c.load(g.scheme,g.host).then(function(a){if(a=a.getBlockById(d.blockid))d._targetBlock=a,d.onReady()})}else if(this.scopeid)if(c=c.hasScope(d.scopeid))if(b=c.getBlockById(d.blockid))d._targetBlock=b,d.onReady();else{if(b=c.getVariableById(d.blockid))d._targetBlock=b,d.onReady()}else console.error("have no scope!")}}},initWithReference:function(a){1===a.nodeType&&(this._targetReference=a,this._setBlock(null))},
onReloaded:function(){},resolveFilter:function(a,b,c){this._targetBlock&&(b=this._targetBlock.scope.expressionModel.parseVariable(this._targetBlock.scope,{value:a},"",!1,!1,c,[b]));return b},_setup1WayBinding:function(){this._2wayHandle&&this._2wayHandle.remove();if(this._targetBlock){var a=new y({trigger:this.sourceevent,path:this.sourceeventvaluepath,filters:[{path:this.sourceeventnamepath,value:this._targetBlock.name}]}),b=new d({path:this.targetproperty,object:this._targetReference,targetFilter:this.targetfilter,
delegate:this});this._findbyTagAndName("D-SCRIPT","accept");this._findbyTagAndName("D-SCRIPT","transform");this.binding=a=new x({source:a,target:b,accept:this._findbyTagAndName("D-SCRIPT","accept"),transform:this._findbyTagAndName("D-SCRIPT","transform")});a.start()}else console.error("invalid params for one way binding")},_findbyTagAndName:function(a,b){for(var c=$(this).find(a),d=0;d<c.length;d++){var e=c[d];if($(e).attr("name")===b)return e}return null},_setup2WayBinding:function(){if(!this.binding){this._2wayHandle&&
this._2wayHandle.remove();var a=new y({trigger:this.sourceevent,path:this.sourceeventvaluepath,filters:[{path:this.sourceeventnamepath,value:this.targetvariable}]}),b=new d({path:"value",object:this._targetReference});this.binding=new x({source:a,target:b});this.binding.start()}},getEnclosingWidget:function(a){if(a){do if(1===a.nodeType&&a.render)return a;while(a=a.parentNode)}return null},_setupTargetReference:function(){for(var a=0,b=this,c=null;2>a&&!c;)b&&(b=b.parentNode,(c=this.getEnclosingWidget(b,
"widgetId"))||(c=this.getEnclosingWidget(b,"widgetid"))),a++;c?this.initWithReference(c):this.domNode&&this.domNode.parentNode?this.initWithReference(this.domNode.parentNode):this.parentNode&&this.initWithReference(this.parentNode)},onAppReady:function(a){this._targetReference||this._setupTargetReference();this._targetBlock||this._setBlock(a?a.context:null);this.mode=!0===this.bidirectional?0:1;if(0===this.mode){if(this._targetBlock&&this._targetReference&&!0===this.bidirectional&&this.sourceevent&&
this.sourceevent.length&&this._setup2WayBinding(),this._targetReference&&this._targetBlock)this.onReady()}else 1===this.mode&&this._targetBlock&&this._targetReference&&this.sourceevent&&this.sourceevent.length&&this.targetproperty&&this.targetproperty.length&&(this._setup1WayBinding(),this.binding&&this.binding.start());a&&a.context&&(this.context=a.context)},detachedCallback:function(){this._appContext&&this.destroy()},createdCallback:function(){},attachedCallback:function(){this._started||(this.initReload(),
this.subscribe(m.EVENTS.ON_APP_READY),this._started=!0)},detachCallback:function(){},render:function(){},postRender:function(){},startup:function(){this.inherited(arguments);this.onAppReady();this.initReload();this.subscribe(m.EVENTS.ON_APP_READY)}};q=q([k.dcl,p.dcl,t.dcl],b);q.Impl=b;return e("d-xscript",[HTMLElement,c,q])})},"xblox/CSSState":function(){define("dojo/on dcl/dcl delite/register delite/CustomElement xide/types/Types xblox/_State xide/utils xide/registry xdojo/has".split(" "),function(g,
r,q,e,c,b,a,m,t){var k=[],p,x,y,d=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g;t.add("dom-contains",function(a,b,c){return!!c.contains});g={_lastState:null,declaredClass:"xblox/CSSState",cssClass:"",addCssRule:function(a,b){p||(p=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(p),p=p.sheet||p.styleSheet,x=p.deleteRule?"deleteRule":"removeRule",y=p.cssRules?"cssRules":"rules");var c=k.length;k[c]=(p.cssRules||p.rules).length;p.addRule?p.addRule(a,b):p.insertRule(a+"{"+b+"}",
k[c]);return{get:function(a){return p[y][k[c]].style[a]},set:function(a,b){"undefined"!==typeof k[c]&&(p[y][k[c]].style[a]=b)},remove:function(){var a=k[c],b,d;if(void 0!==a)for(p[x](a),k[c]=void 0,b=c+1,d=k.length;b<d;b++)k[b]>a&&k[b]--},sheet:p}},escapeCssIdentifier:function(a,b){return"string"===typeof a?a.replace(d,b||"\\$1"):a},detachedCallback:function(){this._styles&&_.each(this._styles,function(a){a.remove()});delete this._styles},applyTo:function(b,c){this._lastState&&this._lastState.remove();
this._lastStateName=c;if(this._attached){var d=this.cssClass,e=b.id||a.createUUID(),g=b.tagName.replace(/\./g,"_")+"_"+e,e=""+this.innerHTML,e=e.replace(".style",""),e=e.replace(/<(?:.|\n)*?>/gm,""),e=e.replace("{",""),e=e.replace("}",""),e=e.replace(/(\r\n|\n|\r|\t)/gm,""),g=g+("_state_"+c);$(b).removeClass($(b).data("_lastCSSState"));$(b).removeClass($(b).data("_lastCSSClass"));$(b).removeClass(d);d?($(b).addClass(d),$(b).data("_lastCSSClass",d)):($(b).addClass(g),$(b).data("_lastCSSState",g),d=
"."+this.escapeCssIdentifier(g),this._styles||(this._styles=[]),d=this.addCssRule(d,e),this._styles.push(d))}}};r=r([b],g);r.Impl=g;return q("d-xstate-css",[HTMLElement,e,r])})},"xblox/_State":function(){define("dojo/_base/lang dojo/on dcl/dcl delite/register delite/CustomElement xide/factory/Events xide/utils/StringUtils xide/types/Types xblox/model/Referenced xide/mixins/EventedMixin xide/mixins/ReloadMixin xwire/Binding xwire/EventSource xwire/WidgetTarget".split(" "),function(g,r,q,e,c,b,a,m,
t,k,p,x,y,d){return q([k.dcl,t.dcl],{declaredClass:"xblox/_State",script:"",bidirectional:!1,_targetBlock:null,_targetReference:null,_complete:!1,enabled:!0,stop:!1,_events:[],context:null,name:"Default",isState:!0,_isState:function(){return!0},reset:function(){},getChildren:function(){return[]},destroy:function(){this.onDestroy&&this.onDestroy();this.reset()},run:function(a,b){},onReady:function(){},getEnclosingWidget:function(a){if(a){do if(1===a.nodeType&&a.render)return a;while(a=a.parentNode)
}return null},initWithReference:function(a){1===a.nodeType&&(this._targetReference=a)},_setupTargetReference:function(){for(var a=0,b=this,c=null;2>a&&!c;)b&&(b=b.parentNode,(c=this.getEnclosingWidget(b,"widgetId"))||(c=this.getEnclosingWidget(b,"widgetid"))),a++;c?(this.initWithReference(c),c._attached&&c.stateReady&&c.stateReady(this)):this.domNode&&this.domNode.parentNode?this.initWithReference(this.domNode.parentNode):this.parentNode&&this.initWithReference(this.parentNode)},onAppReady:function(a){this._setupTargetReference();
a&&a.context&&(this.context=a.context)},detachedCallback:function(){this._appContext&&this.destroy()},applyTo:function(a){},createdCallback:function(){this._targetReference||(this._setupTargetReference(),this._targetReference&&this._targetReference.stateReady&&this._targetReference.stateReady(this))},attachedCallback:function(){this._started||(this.onAppReady(),this.subscribe(m.EVENTS.ON_APP_READY),this._started=!0)}})})}}});
//# sourceMappingURL=xblox.js.map